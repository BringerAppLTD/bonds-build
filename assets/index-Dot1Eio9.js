function DQ(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in e)){const s=Object.getOwnPropertyDescriptor(n,i);s&&Object.defineProperty(e,i,s.get?s:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}})();var sc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Rf(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function LS(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}),r}var LB={exports:{}},xS={},xB={exports:{}},mr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DE=Symbol.for("react.element"),PQ=Symbol.for("react.portal"),kQ=Symbol.for("react.fragment"),LQ=Symbol.for("react.strict_mode"),xQ=Symbol.for("react.profiler"),MQ=Symbol.for("react.provider"),UQ=Symbol.for("react.context"),jQ=Symbol.for("react.forward_ref"),FQ=Symbol.for("react.suspense"),BQ=Symbol.for("react.memo"),VQ=Symbol.for("react.lazy"),dk=Symbol.iterator;function $Q(e){return e===null||typeof e!="object"?null:(e=dk&&e[dk]||e["@@iterator"],typeof e=="function"?e:null)}var MB={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},UB=Object.assign,jB={};function qm(e,t,r){this.props=e,this.context=t,this.refs=jB,this.updater=r||MB}qm.prototype.isReactComponent={};qm.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};qm.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function FB(){}FB.prototype=qm.prototype;function UN(e,t,r){this.props=e,this.context=t,this.refs=jB,this.updater=r||MB}var jN=UN.prototype=new FB;jN.constructor=UN;UB(jN,qm.prototype);jN.isPureReactComponent=!0;var lk=Array.isArray,BB=Object.prototype.hasOwnProperty,FN={current:null},VB={key:!0,ref:!0,__self:!0,__source:!0};function $B(e,t,r){var n,i={},s=null,o=null;if(t!=null)for(n in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(s=""+t.key),t)BB.call(t,n)&&!VB.hasOwnProperty(n)&&(i[n]=t[n]);var a=arguments.length-2;if(a===1)i.children=r;else if(1<a){for(var c=Array(a),d=0;d<a;d++)c[d]=arguments[d+2];i.children=c}if(e&&e.defaultProps)for(n in a=e.defaultProps,a)i[n]===void 0&&(i[n]=a[n]);return{$$typeof:DE,type:e,key:s,ref:o,props:i,_owner:FN.current}}function HQ(e,t){return{$$typeof:DE,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function BN(e){return typeof e=="object"&&e!==null&&e.$$typeof===DE}function zQ(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var uk=/\/+/g;function bT(e,t){return typeof e=="object"&&e!==null&&e.key!=null?zQ(""+e.key):t.toString(36)}function Hy(e,t,r,n,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case DE:case PQ:o=!0}}if(o)return o=e,i=i(o),e=n===""?"."+bT(o,0):n,lk(i)?(r="",e!=null&&(r=e.replace(uk,"$&/")+"/"),Hy(i,t,r,"",function(d){return d})):i!=null&&(BN(i)&&(i=HQ(i,r+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(uk,"$&/")+"/")+e)),t.push(i)),1;if(o=0,n=n===""?".":n+":",lk(e))for(var a=0;a<e.length;a++){s=e[a];var c=n+bT(s,a);o+=Hy(s,t,r,c,i)}else if(c=$Q(e),typeof c=="function")for(e=c.call(e),a=0;!(s=e.next()).done;)s=s.value,c=n+bT(s,a++),o+=Hy(s,t,r,c,i);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function pv(e,t,r){if(e==null)return e;var n=[],i=0;return Hy(e,n,"","",function(s){return t.call(r,s,i++)}),n}function WQ(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Ds={current:null},zy={transition:null},GQ={ReactCurrentDispatcher:Ds,ReactCurrentBatchConfig:zy,ReactCurrentOwner:FN};mr.Children={map:pv,forEach:function(e,t,r){pv(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return pv(e,function(){t++}),t},toArray:function(e){return pv(e,function(t){return t})||[]},only:function(e){if(!BN(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};mr.Component=qm;mr.Fragment=kQ;mr.Profiler=xQ;mr.PureComponent=UN;mr.StrictMode=LQ;mr.Suspense=FQ;mr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=GQ;mr.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=UB({},e.props),i=e.key,s=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,o=FN.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(c in t)BB.call(t,c)&&!VB.hasOwnProperty(c)&&(n[c]=t[c]===void 0&&a!==void 0?a[c]:t[c])}var c=arguments.length-2;if(c===1)n.children=r;else if(1<c){a=Array(c);for(var d=0;d<c;d++)a[d]=arguments[d+2];n.children=a}return{$$typeof:DE,type:e.type,key:i,ref:s,props:n,_owner:o}};mr.createContext=function(e){return e={$$typeof:UQ,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:MQ,_context:e},e.Consumer=e};mr.createElement=$B;mr.createFactory=function(e){var t=$B.bind(null,e);return t.type=e,t};mr.createRef=function(){return{current:null}};mr.forwardRef=function(e){return{$$typeof:jQ,render:e}};mr.isValidElement=BN;mr.lazy=function(e){return{$$typeof:VQ,_payload:{_status:-1,_result:e},_init:WQ}};mr.memo=function(e,t){return{$$typeof:BQ,type:e,compare:t===void 0?null:t}};mr.startTransition=function(e){var t=zy.transition;zy.transition={};try{e()}finally{zy.transition=t}};mr.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};mr.useCallback=function(e,t){return Ds.current.useCallback(e,t)};mr.useContext=function(e){return Ds.current.useContext(e)};mr.useDebugValue=function(){};mr.useDeferredValue=function(e){return Ds.current.useDeferredValue(e)};mr.useEffect=function(e,t){return Ds.current.useEffect(e,t)};mr.useId=function(){return Ds.current.useId()};mr.useImperativeHandle=function(e,t,r){return Ds.current.useImperativeHandle(e,t,r)};mr.useInsertionEffect=function(e,t){return Ds.current.useInsertionEffect(e,t)};mr.useLayoutEffect=function(e,t){return Ds.current.useLayoutEffect(e,t)};mr.useMemo=function(e,t){return Ds.current.useMemo(e,t)};mr.useReducer=function(e,t,r){return Ds.current.useReducer(e,t,r)};mr.useRef=function(e){return Ds.current.useRef(e)};mr.useState=function(e){return Ds.current.useState(e)};mr.useSyncExternalStore=function(e,t,r){return Ds.current.useSyncExternalStore(e,t,r)};mr.useTransition=function(){return Ds.current.useTransition()};mr.version="18.2.0";xB.exports=mr;var me=xB.exports;const Es=Rf(me),qQ=DQ({__proto__:null,default:Es},[me]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var KQ=me,YQ=Symbol.for("react.element"),JQ=Symbol.for("react.fragment"),XQ=Object.prototype.hasOwnProperty,QQ=KQ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ZQ={key:!0,ref:!0,__self:!0,__source:!0};function HB(e,t,r){var n,i={},s=null,o=null;r!==void 0&&(s=""+r),t.key!==void 0&&(s=""+t.key),t.ref!==void 0&&(o=t.ref);for(n in t)XQ.call(t,n)&&!ZQ.hasOwnProperty(n)&&(i[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)i[n]===void 0&&(i[n]=t[n]);return{$$typeof:YQ,type:e,key:s,ref:o,props:i,_owner:QQ.current}}xS.Fragment=JQ;xS.jsx=HB;xS.jsxs=HB;LB.exports=xS;var O=LB.exports,zB={exports:{}},Vo={},WB={exports:{}},GB={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(k,P){var y=k.length;k.push(P);e:for(;0<y;){var f=y-1>>>1,R=k[f];if(0<i(R,P))k[f]=P,k[y]=R,y=f;else break e}}function r(k){return k.length===0?null:k[0]}function n(k){if(k.length===0)return null;var P=k[0],y=k.pop();if(y!==P){k[0]=y;e:for(var f=0,R=k.length,B=R>>>1;f<B;){var q=2*(f+1)-1,F=k[q],te=q+1,G=k[te];if(0>i(F,y))te<R&&0>i(G,F)?(k[f]=G,k[te]=y,f=te):(k[f]=F,k[q]=y,f=q);else if(te<R&&0>i(G,y))k[f]=G,k[te]=y,f=te;else break e}}return P}function i(k,P){var y=k.sortIndex-P.sortIndex;return y!==0?y:k.id-P.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();e.unstable_now=function(){return o.now()-a}}var c=[],d=[],l=1,u=null,h=3,p=!1,_=!1,g=!1,E=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function I(k){for(var P=r(d);P!==null;){if(P.callback===null)n(d);else if(P.startTime<=k)n(d),P.sortIndex=P.expirationTime,t(c,P);else break;P=r(d)}}function N(k){if(g=!1,I(k),!_)if(r(c)!==null)_=!0,x(L);else{var P=r(d);P!==null&&D(N,P.startTime-k)}}function L(k,P){_=!1,g&&(g=!1,b(V),V=-1),p=!0;var y=h;try{for(I(P),u=r(c);u!==null&&(!(u.expirationTime>P)||k&&!H());){var f=u.callback;if(typeof f=="function"){u.callback=null,h=u.priorityLevel;var R=f(u.expirationTime<=P);P=e.unstable_now(),typeof R=="function"?u.callback=R:u===r(c)&&n(c),I(P)}else n(c);u=r(c)}if(u!==null)var B=!0;else{var q=r(d);q!==null&&D(N,q.startTime-P),B=!1}return B}finally{u=null,h=y,p=!1}}var U=!1,w=null,V=-1,z=5,K=-1;function H(){return!(e.unstable_now()-K<z)}function A(){if(w!==null){var k=e.unstable_now();K=k;var P=!0;try{P=w(!0,k)}finally{P?m():(U=!1,w=null)}}else U=!1}var m;if(typeof v=="function")m=function(){v(A)};else if(typeof MessageChannel<"u"){var S=new MessageChannel,T=S.port2;S.port1.onmessage=A,m=function(){T.postMessage(null)}}else m=function(){E(A,0)};function x(k){w=k,U||(U=!0,m())}function D(k,P){V=E(function(){k(e.unstable_now())},P)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(k){k.callback=null},e.unstable_continueExecution=function(){_||p||(_=!0,x(L))},e.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):z=0<k?Math.floor(1e3/k):5},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_getFirstCallbackNode=function(){return r(c)},e.unstable_next=function(k){switch(h){case 1:case 2:case 3:var P=3;break;default:P=h}var y=h;h=P;try{return k()}finally{h=y}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(k,P){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var y=h;h=k;try{return P()}finally{h=y}},e.unstable_scheduleCallback=function(k,P,y){var f=e.unstable_now();switch(typeof y=="object"&&y!==null?(y=y.delay,y=typeof y=="number"&&0<y?f+y:f):y=f,k){case 1:var R=-1;break;case 2:R=250;break;case 5:R=1073741823;break;case 4:R=1e4;break;default:R=5e3}return R=y+R,k={id:l++,callback:P,priorityLevel:k,startTime:y,expirationTime:R,sortIndex:-1},y>f?(k.sortIndex=y,t(d,k),r(c)===null&&k===r(d)&&(g?(b(V),V=-1):g=!0,D(N,y-f))):(k.sortIndex=R,t(c,k),_||p||(_=!0,x(L))),k},e.unstable_shouldYield=H,e.unstable_wrapCallback=function(k){var P=h;return function(){var y=h;h=P;try{return k.apply(this,arguments)}finally{h=y}}}})(GB);WB.exports=GB;var eZ=WB.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qB=me,Fo=eZ;function De(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var KB=new Set,E_={};function Af(e,t){vm(e,t),vm(e+"Capture",t)}function vm(e,t){for(E_[e]=t,e=0;e<t.length;e++)KB.add(t[e])}var El=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),bI=Object.prototype.hasOwnProperty,tZ=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,hk={},fk={};function rZ(e){return bI.call(fk,e)?!0:bI.call(hk,e)?!1:tZ.test(e)?fk[e]=!0:(hk[e]=!0,!1)}function nZ(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function iZ(e,t,r,n){if(t===null||typeof t>"u"||nZ(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Ps(e,t,r,n,i,s,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=o}var $i={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){$i[e]=new Ps(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];$i[t]=new Ps(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){$i[e]=new Ps(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){$i[e]=new Ps(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){$i[e]=new Ps(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){$i[e]=new Ps(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){$i[e]=new Ps(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){$i[e]=new Ps(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){$i[e]=new Ps(e,5,!1,e.toLowerCase(),null,!1,!1)});var VN=/[\-:]([a-z])/g;function $N(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(VN,$N);$i[t]=new Ps(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(VN,$N);$i[t]=new Ps(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(VN,$N);$i[t]=new Ps(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){$i[e]=new Ps(e,1,!1,e.toLowerCase(),null,!1,!1)});$i.xlinkHref=new Ps("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){$i[e]=new Ps(e,1,!1,e.toLowerCase(),null,!0,!0)});function HN(e,t,r,n){var i=$i.hasOwnProperty(t)?$i[t]:null;(i!==null?i.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(iZ(t,r,i,n)&&(r=null),n||i===null?rZ(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):i.mustUseProperty?e[i.propertyName]=r===null?i.type===3?!1:"":r:(t=i.attributeName,n=i.attributeNamespace,r===null?e.removeAttribute(t):(i=i.type,r=i===3||i===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var Al=qB.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,mv=Symbol.for("react.element"),Tp=Symbol.for("react.portal"),Rp=Symbol.for("react.fragment"),zN=Symbol.for("react.strict_mode"),SI=Symbol.for("react.profiler"),YB=Symbol.for("react.provider"),JB=Symbol.for("react.context"),WN=Symbol.for("react.forward_ref"),wI=Symbol.for("react.suspense"),TI=Symbol.for("react.suspense_list"),GN=Symbol.for("react.memo"),ql=Symbol.for("react.lazy"),XB=Symbol.for("react.offscreen"),pk=Symbol.iterator;function F0(e){return e===null||typeof e!="object"?null:(e=pk&&e[pk]||e["@@iterator"],typeof e=="function"?e:null)}var On=Object.assign,ST;function wg(e){if(ST===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);ST=t&&t[1]||""}return`
`+ST+e}var wT=!1;function TT(e,t){if(!e||wT)return"";wT=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(d){var n=d}Reflect.construct(e,[],t)}else{try{t.call()}catch(d){n=d}e.call(t.prototype)}else{try{throw Error()}catch(d){n=d}e()}}catch(d){if(d&&n&&typeof d.stack=="string"){for(var i=d.stack.split(`
`),s=n.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var c=`
`+i[o].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=o&&0<=a);break}}}finally{wT=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?wg(e):""}function sZ(e){switch(e.tag){case 5:return wg(e.type);case 16:return wg("Lazy");case 13:return wg("Suspense");case 19:return wg("SuspenseList");case 0:case 2:case 15:return e=TT(e.type,!1),e;case 11:return e=TT(e.type.render,!1),e;case 1:return e=TT(e.type,!0),e;default:return""}}function RI(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Rp:return"Fragment";case Tp:return"Portal";case SI:return"Profiler";case zN:return"StrictMode";case wI:return"Suspense";case TI:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case JB:return(e.displayName||"Context")+".Consumer";case YB:return(e._context.displayName||"Context")+".Provider";case WN:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case GN:return t=e.displayName||null,t!==null?t:RI(e.type)||"Memo";case ql:t=e._payload,e=e._init;try{return RI(e(t))}catch{}}return null}function oZ(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return RI(t);case 8:return t===zN?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Lu(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function QB(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function aZ(e){var t=QB(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var i=r.get,s=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(o){n=""+o,s.call(this,o)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function gv(e){e._valueTracker||(e._valueTracker=aZ(e))}function ZB(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=QB(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function Jb(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function AI(e,t){var r=t.checked;return On({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function mk(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=Lu(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function eV(e,t){t=t.checked,t!=null&&HN(e,"checked",t,!1)}function CI(e,t){eV(e,t);var r=Lu(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?II(e,t.type,r):t.hasOwnProperty("defaultValue")&&II(e,t.type,Lu(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function gk(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function II(e,t,r){(t!=="number"||Jb(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var Tg=Array.isArray;function Xp(e,t,r,n){if(e=e.options,t){t={};for(var i=0;i<r.length;i++)t["$"+r[i]]=!0;for(r=0;r<e.length;r++)i=t.hasOwnProperty("$"+e[r].value),e[r].selected!==i&&(e[r].selected=i),i&&n&&(e[r].defaultSelected=!0)}else{for(r=""+Lu(r),t=null,i=0;i<e.length;i++){if(e[i].value===r){e[i].selected=!0,n&&(e[i].defaultSelected=!0);return}t!==null||e[i].disabled||(t=e[i])}t!==null&&(t.selected=!0)}}function OI(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(De(91));return On({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function _k(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(De(92));if(Tg(r)){if(1<r.length)throw Error(De(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:Lu(r)}}function tV(e,t){var r=Lu(t.value),n=Lu(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function Ek(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function rV(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function NI(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?rV(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var _v,nV=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,i){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,i)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(_v=_v||document.createElement("div"),_v.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=_v.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function v_(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var zg={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},cZ=["Webkit","ms","Moz","O"];Object.keys(zg).forEach(function(e){cZ.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),zg[t]=zg[e]})});function iV(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||zg.hasOwnProperty(e)&&zg[e]?(""+t).trim():t+"px"}function sV(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,i=iV(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,i):e[r]=i}}var dZ=On({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function DI(e,t){if(t){if(dZ[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(De(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(De(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(De(61))}if(t.style!=null&&typeof t.style!="object")throw Error(De(62))}}function PI(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var kI=null;function qN(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var LI=null,Qp=null,Zp=null;function vk(e){if(e=LE(e)){if(typeof LI!="function")throw Error(De(280));var t=e.stateNode;t&&(t=BS(t),LI(e.stateNode,e.type,t))}}function oV(e){Qp?Zp?Zp.push(e):Zp=[e]:Qp=e}function aV(){if(Qp){var e=Qp,t=Zp;if(Zp=Qp=null,vk(e),t)for(e=0;e<t.length;e++)vk(t[e])}}function cV(e,t){return e(t)}function dV(){}var RT=!1;function lV(e,t,r){if(RT)return e(t,r);RT=!0;try{return cV(e,t,r)}finally{RT=!1,(Qp!==null||Zp!==null)&&(dV(),aV())}}function y_(e,t){var r=e.stateNode;if(r===null)return null;var n=BS(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(De(231,t,typeof r));return r}var xI=!1;if(El)try{var B0={};Object.defineProperty(B0,"passive",{get:function(){xI=!0}}),window.addEventListener("test",B0,B0),window.removeEventListener("test",B0,B0)}catch{xI=!1}function lZ(e,t,r,n,i,s,o,a,c){var d=Array.prototype.slice.call(arguments,3);try{t.apply(r,d)}catch(l){this.onError(l)}}var Wg=!1,Xb=null,Qb=!1,MI=null,uZ={onError:function(e){Wg=!0,Xb=e}};function hZ(e,t,r,n,i,s,o,a,c){Wg=!1,Xb=null,lZ.apply(uZ,arguments)}function fZ(e,t,r,n,i,s,o,a,c){if(hZ.apply(this,arguments),Wg){if(Wg){var d=Xb;Wg=!1,Xb=null}else throw Error(De(198));Qb||(Qb=!0,MI=d)}}function Cf(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function uV(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function yk(e){if(Cf(e)!==e)throw Error(De(188))}function pZ(e){var t=e.alternate;if(!t){if(t=Cf(e),t===null)throw Error(De(188));return t!==e?null:e}for(var r=e,n=t;;){var i=r.return;if(i===null)break;var s=i.alternate;if(s===null){if(n=i.return,n!==null){r=n;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===r)return yk(i),e;if(s===n)return yk(i),t;s=s.sibling}throw Error(De(188))}if(r.return!==n.return)r=i,n=s;else{for(var o=!1,a=i.child;a;){if(a===r){o=!0,r=i,n=s;break}if(a===n){o=!0,n=i,r=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===r){o=!0,r=s,n=i;break}if(a===n){o=!0,n=s,r=i;break}a=a.sibling}if(!o)throw Error(De(189))}}if(r.alternate!==n)throw Error(De(190))}if(r.tag!==3)throw Error(De(188));return r.stateNode.current===r?e:t}function hV(e){return e=pZ(e),e!==null?fV(e):null}function fV(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=fV(e);if(t!==null)return t;e=e.sibling}return null}var pV=Fo.unstable_scheduleCallback,bk=Fo.unstable_cancelCallback,mZ=Fo.unstable_shouldYield,gZ=Fo.unstable_requestPaint,Yn=Fo.unstable_now,_Z=Fo.unstable_getCurrentPriorityLevel,KN=Fo.unstable_ImmediatePriority,mV=Fo.unstable_UserBlockingPriority,Zb=Fo.unstable_NormalPriority,EZ=Fo.unstable_LowPriority,gV=Fo.unstable_IdlePriority,MS=null,rd=null;function vZ(e){if(rd&&typeof rd.onCommitFiberRoot=="function")try{rd.onCommitFiberRoot(MS,e,void 0,(e.current.flags&128)===128)}catch{}}var hc=Math.clz32?Math.clz32:SZ,yZ=Math.log,bZ=Math.LN2;function SZ(e){return e>>>=0,e===0?32:31-(yZ(e)/bZ|0)|0}var Ev=64,vv=4194304;function Rg(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function e1(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,i=e.suspendedLanes,s=e.pingedLanes,o=r&268435455;if(o!==0){var a=o&~i;a!==0?n=Rg(a):(s&=o,s!==0&&(n=Rg(s)))}else o=r&~i,o!==0?n=Rg(o):s!==0&&(n=Rg(s));if(n===0)return 0;if(t!==0&&t!==n&&!(t&i)&&(i=n&-n,s=t&-t,i>=s||i===16&&(s&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-hc(t),i=1<<r,n|=e[r],t&=~i;return n}function wZ(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function TZ(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,i=e.expirationTimes,s=e.pendingLanes;0<s;){var o=31-hc(s),a=1<<o,c=i[o];c===-1?(!(a&r)||a&n)&&(i[o]=wZ(a,t)):c<=t&&(e.expiredLanes|=a),s&=~a}}function UI(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function _V(){var e=Ev;return Ev<<=1,!(Ev&4194240)&&(Ev=64),e}function AT(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function PE(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-hc(t),e[t]=r}function RZ(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var i=31-hc(r),s=1<<i;t[i]=0,n[i]=-1,e[i]=-1,r&=~s}}function YN(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-hc(r),i=1<<n;i&t|e[n]&t&&(e[n]|=t),r&=~i}}var Gr=0;function EV(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var vV,JN,yV,bV,SV,jI=!1,yv=[],Eu=null,vu=null,yu=null,b_=new Map,S_=new Map,eu=[],AZ="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sk(e,t){switch(e){case"focusin":case"focusout":Eu=null;break;case"dragenter":case"dragleave":vu=null;break;case"mouseover":case"mouseout":yu=null;break;case"pointerover":case"pointerout":b_.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":S_.delete(t.pointerId)}}function V0(e,t,r,n,i,s){return e===null||e.nativeEvent!==s?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:s,targetContainers:[i]},t!==null&&(t=LE(t),t!==null&&JN(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,i!==null&&t.indexOf(i)===-1&&t.push(i),e)}function CZ(e,t,r,n,i){switch(t){case"focusin":return Eu=V0(Eu,e,t,r,n,i),!0;case"dragenter":return vu=V0(vu,e,t,r,n,i),!0;case"mouseover":return yu=V0(yu,e,t,r,n,i),!0;case"pointerover":var s=i.pointerId;return b_.set(s,V0(b_.get(s)||null,e,t,r,n,i)),!0;case"gotpointercapture":return s=i.pointerId,S_.set(s,V0(S_.get(s)||null,e,t,r,n,i)),!0}return!1}function wV(e){var t=kh(e.target);if(t!==null){var r=Cf(t);if(r!==null){if(t=r.tag,t===13){if(t=uV(r),t!==null){e.blockedOn=t,SV(e.priority,function(){yV(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Wy(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=FI(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);kI=n,r.target.dispatchEvent(n),kI=null}else return t=LE(r),t!==null&&JN(t),e.blockedOn=r,!1;t.shift()}return!0}function wk(e,t,r){Wy(e)&&r.delete(t)}function IZ(){jI=!1,Eu!==null&&Wy(Eu)&&(Eu=null),vu!==null&&Wy(vu)&&(vu=null),yu!==null&&Wy(yu)&&(yu=null),b_.forEach(wk),S_.forEach(wk)}function $0(e,t){e.blockedOn===t&&(e.blockedOn=null,jI||(jI=!0,Fo.unstable_scheduleCallback(Fo.unstable_NormalPriority,IZ)))}function w_(e){function t(i){return $0(i,e)}if(0<yv.length){$0(yv[0],e);for(var r=1;r<yv.length;r++){var n=yv[r];n.blockedOn===e&&(n.blockedOn=null)}}for(Eu!==null&&$0(Eu,e),vu!==null&&$0(vu,e),yu!==null&&$0(yu,e),b_.forEach(t),S_.forEach(t),r=0;r<eu.length;r++)n=eu[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<eu.length&&(r=eu[0],r.blockedOn===null);)wV(r),r.blockedOn===null&&eu.shift()}var em=Al.ReactCurrentBatchConfig,t1=!0;function OZ(e,t,r,n){var i=Gr,s=em.transition;em.transition=null;try{Gr=1,XN(e,t,r,n)}finally{Gr=i,em.transition=s}}function NZ(e,t,r,n){var i=Gr,s=em.transition;em.transition=null;try{Gr=4,XN(e,t,r,n)}finally{Gr=i,em.transition=s}}function XN(e,t,r,n){if(t1){var i=FI(e,t,r,n);if(i===null)MT(e,t,n,r1,r),Sk(e,n);else if(CZ(i,e,t,r,n))n.stopPropagation();else if(Sk(e,n),t&4&&-1<AZ.indexOf(e)){for(;i!==null;){var s=LE(i);if(s!==null&&vV(s),s=FI(e,t,r,n),s===null&&MT(e,t,n,r1,r),s===i)break;i=s}i!==null&&n.stopPropagation()}else MT(e,t,n,null,r)}}var r1=null;function FI(e,t,r,n){if(r1=null,e=qN(n),e=kh(e),e!==null)if(t=Cf(e),t===null)e=null;else if(r=t.tag,r===13){if(e=uV(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return r1=e,null}function TV(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(_Z()){case KN:return 1;case mV:return 4;case Zb:case EZ:return 16;case gV:return 536870912;default:return 16}default:return 16}}var du=null,QN=null,Gy=null;function RV(){if(Gy)return Gy;var e,t=QN,r=t.length,n,i="value"in du?du.value:du.textContent,s=i.length;for(e=0;e<r&&t[e]===i[e];e++);var o=r-e;for(n=1;n<=o&&t[r-n]===i[s-n];n++);return Gy=i.slice(e,1<n?1-n:void 0)}function qy(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function bv(){return!0}function Tk(){return!1}function $o(e){function t(r,n,i,s,o){this._reactName=r,this._targetInst=i,this.type=n,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in e)e.hasOwnProperty(a)&&(r=e[a],this[a]=r?r(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?bv:Tk,this.isPropagationStopped=Tk,this}return On(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=bv)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=bv)},persist:function(){},isPersistent:bv}),t}var Km={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ZN=$o(Km),kE=On({},Km,{view:0,detail:0}),DZ=$o(kE),CT,IT,H0,US=On({},kE,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:eD,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==H0&&(H0&&e.type==="mousemove"?(CT=e.screenX-H0.screenX,IT=e.screenY-H0.screenY):IT=CT=0,H0=e),CT)},movementY:function(e){return"movementY"in e?e.movementY:IT}}),Rk=$o(US),PZ=On({},US,{dataTransfer:0}),kZ=$o(PZ),LZ=On({},kE,{relatedTarget:0}),OT=$o(LZ),xZ=On({},Km,{animationName:0,elapsedTime:0,pseudoElement:0}),MZ=$o(xZ),UZ=On({},Km,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),jZ=$o(UZ),FZ=On({},Km,{data:0}),Ak=$o(FZ),BZ={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},VZ={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$Z={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function HZ(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=$Z[e])?!!t[e]:!1}function eD(){return HZ}var zZ=On({},kE,{key:function(e){if(e.key){var t=BZ[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=qy(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?VZ[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:eD,charCode:function(e){return e.type==="keypress"?qy(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?qy(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),WZ=$o(zZ),GZ=On({},US,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ck=$o(GZ),qZ=On({},kE,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:eD}),KZ=$o(qZ),YZ=On({},Km,{propertyName:0,elapsedTime:0,pseudoElement:0}),JZ=$o(YZ),XZ=On({},US,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),QZ=$o(XZ),ZZ=[9,13,27,32],tD=El&&"CompositionEvent"in window,Gg=null;El&&"documentMode"in document&&(Gg=document.documentMode);var eee=El&&"TextEvent"in window&&!Gg,AV=El&&(!tD||Gg&&8<Gg&&11>=Gg),Ik=" ",Ok=!1;function CV(e,t){switch(e){case"keyup":return ZZ.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function IV(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Ap=!1;function tee(e,t){switch(e){case"compositionend":return IV(t);case"keypress":return t.which!==32?null:(Ok=!0,Ik);case"textInput":return e=t.data,e===Ik&&Ok?null:e;default:return null}}function ree(e,t){if(Ap)return e==="compositionend"||!tD&&CV(e,t)?(e=RV(),Gy=QN=du=null,Ap=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return AV&&t.locale!=="ko"?null:t.data;default:return null}}var nee={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Nk(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!nee[e.type]:t==="textarea"}function OV(e,t,r,n){oV(n),t=n1(t,"onChange"),0<t.length&&(r=new ZN("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var qg=null,T_=null;function iee(e){BV(e,0)}function jS(e){var t=Op(e);if(ZB(t))return e}function see(e,t){if(e==="change")return t}var NV=!1;if(El){var NT;if(El){var DT="oninput"in document;if(!DT){var Dk=document.createElement("div");Dk.setAttribute("oninput","return;"),DT=typeof Dk.oninput=="function"}NT=DT}else NT=!1;NV=NT&&(!document.documentMode||9<document.documentMode)}function Pk(){qg&&(qg.detachEvent("onpropertychange",DV),T_=qg=null)}function DV(e){if(e.propertyName==="value"&&jS(T_)){var t=[];OV(t,T_,e,qN(e)),lV(iee,t)}}function oee(e,t,r){e==="focusin"?(Pk(),qg=t,T_=r,qg.attachEvent("onpropertychange",DV)):e==="focusout"&&Pk()}function aee(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return jS(T_)}function cee(e,t){if(e==="click")return jS(t)}function dee(e,t){if(e==="input"||e==="change")return jS(t)}function lee(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var _c=typeof Object.is=="function"?Object.is:lee;function R_(e,t){if(_c(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var i=r[n];if(!bI.call(t,i)||!_c(e[i],t[i]))return!1}return!0}function kk(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Lk(e,t){var r=kk(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=kk(r)}}function PV(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?PV(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function kV(){for(var e=window,t=Jb();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=Jb(e.document)}return t}function rD(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function uee(e){var t=kV(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&PV(r.ownerDocument.documentElement,r)){if(n!==null&&rD(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var i=r.textContent.length,s=Math.min(n.start,i);n=n.end===void 0?s:Math.min(n.end,i),!e.extend&&s>n&&(i=n,n=s,s=i),i=Lk(r,s);var o=Lk(r,n);i&&o&&(e.rangeCount!==1||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(i.node,i.offset),e.removeAllRanges(),s>n?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var hee=El&&"documentMode"in document&&11>=document.documentMode,Cp=null,BI=null,Kg=null,VI=!1;function xk(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;VI||Cp==null||Cp!==Jb(n)||(n=Cp,"selectionStart"in n&&rD(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Kg&&R_(Kg,n)||(Kg=n,n=n1(BI,"onSelect"),0<n.length&&(t=new ZN("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=Cp)))}function Sv(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var Ip={animationend:Sv("Animation","AnimationEnd"),animationiteration:Sv("Animation","AnimationIteration"),animationstart:Sv("Animation","AnimationStart"),transitionend:Sv("Transition","TransitionEnd")},PT={},LV={};El&&(LV=document.createElement("div").style,"AnimationEvent"in window||(delete Ip.animationend.animation,delete Ip.animationiteration.animation,delete Ip.animationstart.animation),"TransitionEvent"in window||delete Ip.transitionend.transition);function FS(e){if(PT[e])return PT[e];if(!Ip[e])return e;var t=Ip[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in LV)return PT[e]=t[r];return e}var xV=FS("animationend"),MV=FS("animationiteration"),UV=FS("animationstart"),jV=FS("transitionend"),FV=new Map,Mk="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Wu(e,t){FV.set(e,t),Af(t,[e])}for(var kT=0;kT<Mk.length;kT++){var LT=Mk[kT],fee=LT.toLowerCase(),pee=LT[0].toUpperCase()+LT.slice(1);Wu(fee,"on"+pee)}Wu(xV,"onAnimationEnd");Wu(MV,"onAnimationIteration");Wu(UV,"onAnimationStart");Wu("dblclick","onDoubleClick");Wu("focusin","onFocus");Wu("focusout","onBlur");Wu(jV,"onTransitionEnd");vm("onMouseEnter",["mouseout","mouseover"]);vm("onMouseLeave",["mouseout","mouseover"]);vm("onPointerEnter",["pointerout","pointerover"]);vm("onPointerLeave",["pointerout","pointerover"]);Af("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Af("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Af("onBeforeInput",["compositionend","keypress","textInput","paste"]);Af("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Af("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Af("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ag="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mee=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ag));function Uk(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,fZ(n,t,void 0,e),e.currentTarget=null}function BV(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],i=n.event;n=n.listeners;e:{var s=void 0;if(t)for(var o=n.length-1;0<=o;o--){var a=n[o],c=a.instance,d=a.currentTarget;if(a=a.listener,c!==s&&i.isPropagationStopped())break e;Uk(i,a,d),s=c}else for(o=0;o<n.length;o++){if(a=n[o],c=a.instance,d=a.currentTarget,a=a.listener,c!==s&&i.isPropagationStopped())break e;Uk(i,a,d),s=c}}}if(Qb)throw e=MI,Qb=!1,MI=null,e}function dn(e,t){var r=t[GI];r===void 0&&(r=t[GI]=new Set);var n=e+"__bubble";r.has(n)||(VV(t,e,2,!1),r.add(n))}function xT(e,t,r){var n=0;t&&(n|=4),VV(r,e,n,t)}var wv="_reactListening"+Math.random().toString(36).slice(2);function A_(e){if(!e[wv]){e[wv]=!0,KB.forEach(function(r){r!=="selectionchange"&&(mee.has(r)||xT(r,!1,e),xT(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[wv]||(t[wv]=!0,xT("selectionchange",!1,t))}}function VV(e,t,r,n){switch(TV(t)){case 1:var i=OZ;break;case 4:i=NZ;break;default:i=XN}r=i.bind(null,t,r,e),i=void 0,!xI||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(i=!0),n?i!==void 0?e.addEventListener(t,r,{capture:!0,passive:i}):e.addEventListener(t,r,!0):i!==void 0?e.addEventListener(t,r,{passive:i}):e.addEventListener(t,r,!1)}function MT(e,t,r,n,i){var s=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var a=n.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=n.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;o=o.return}for(;a!==null;){if(o=kh(a),o===null)return;if(c=o.tag,c===5||c===6){n=s=o;continue e}a=a.parentNode}}n=n.return}lV(function(){var d=s,l=qN(r),u=[];e:{var h=FV.get(e);if(h!==void 0){var p=ZN,_=e;switch(e){case"keypress":if(qy(r)===0)break e;case"keydown":case"keyup":p=WZ;break;case"focusin":_="focus",p=OT;break;case"focusout":_="blur",p=OT;break;case"beforeblur":case"afterblur":p=OT;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=Rk;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=kZ;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=KZ;break;case xV:case MV:case UV:p=MZ;break;case jV:p=JZ;break;case"scroll":p=DZ;break;case"wheel":p=QZ;break;case"copy":case"cut":case"paste":p=jZ;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=Ck}var g=(t&4)!==0,E=!g&&e==="scroll",b=g?h!==null?h+"Capture":null:h;g=[];for(var v=d,I;v!==null;){I=v;var N=I.stateNode;if(I.tag===5&&N!==null&&(I=N,b!==null&&(N=y_(v,b),N!=null&&g.push(C_(v,N,I)))),E)break;v=v.return}0<g.length&&(h=new p(h,_,null,r,l),u.push({event:h,listeners:g}))}}if(!(t&7)){e:{if(h=e==="mouseover"||e==="pointerover",p=e==="mouseout"||e==="pointerout",h&&r!==kI&&(_=r.relatedTarget||r.fromElement)&&(kh(_)||_[vl]))break e;if((p||h)&&(h=l.window===l?l:(h=l.ownerDocument)?h.defaultView||h.parentWindow:window,p?(_=r.relatedTarget||r.toElement,p=d,_=_?kh(_):null,_!==null&&(E=Cf(_),_!==E||_.tag!==5&&_.tag!==6)&&(_=null)):(p=null,_=d),p!==_)){if(g=Rk,N="onMouseLeave",b="onMouseEnter",v="mouse",(e==="pointerout"||e==="pointerover")&&(g=Ck,N="onPointerLeave",b="onPointerEnter",v="pointer"),E=p==null?h:Op(p),I=_==null?h:Op(_),h=new g(N,v+"leave",p,r,l),h.target=E,h.relatedTarget=I,N=null,kh(l)===d&&(g=new g(b,v+"enter",_,r,l),g.target=I,g.relatedTarget=E,N=g),E=N,p&&_)t:{for(g=p,b=_,v=0,I=g;I;I=$f(I))v++;for(I=0,N=b;N;N=$f(N))I++;for(;0<v-I;)g=$f(g),v--;for(;0<I-v;)b=$f(b),I--;for(;v--;){if(g===b||b!==null&&g===b.alternate)break t;g=$f(g),b=$f(b)}g=null}else g=null;p!==null&&jk(u,h,p,g,!1),_!==null&&E!==null&&jk(u,E,_,g,!0)}}e:{if(h=d?Op(d):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var L=see;else if(Nk(h))if(NV)L=dee;else{L=aee;var U=oee}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(L=cee);if(L&&(L=L(e,d))){OV(u,L,r,l);break e}U&&U(e,h,d),e==="focusout"&&(U=h._wrapperState)&&U.controlled&&h.type==="number"&&II(h,"number",h.value)}switch(U=d?Op(d):window,e){case"focusin":(Nk(U)||U.contentEditable==="true")&&(Cp=U,BI=d,Kg=null);break;case"focusout":Kg=BI=Cp=null;break;case"mousedown":VI=!0;break;case"contextmenu":case"mouseup":case"dragend":VI=!1,xk(u,r,l);break;case"selectionchange":if(hee)break;case"keydown":case"keyup":xk(u,r,l)}var w;if(tD)e:{switch(e){case"compositionstart":var V="onCompositionStart";break e;case"compositionend":V="onCompositionEnd";break e;case"compositionupdate":V="onCompositionUpdate";break e}V=void 0}else Ap?CV(e,r)&&(V="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(V="onCompositionStart");V&&(AV&&r.locale!=="ko"&&(Ap||V!=="onCompositionStart"?V==="onCompositionEnd"&&Ap&&(w=RV()):(du=l,QN="value"in du?du.value:du.textContent,Ap=!0)),U=n1(d,V),0<U.length&&(V=new Ak(V,e,null,r,l),u.push({event:V,listeners:U}),w?V.data=w:(w=IV(r),w!==null&&(V.data=w)))),(w=eee?tee(e,r):ree(e,r))&&(d=n1(d,"onBeforeInput"),0<d.length&&(l=new Ak("onBeforeInput","beforeinput",null,r,l),u.push({event:l,listeners:d}),l.data=w))}BV(u,t)})}function C_(e,t,r){return{instance:e,listener:t,currentTarget:r}}function n1(e,t){for(var r=t+"Capture",n=[];e!==null;){var i=e,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=y_(e,r),s!=null&&n.unshift(C_(e,s,i)),s=y_(e,t),s!=null&&n.push(C_(e,s,i))),e=e.return}return n}function $f(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function jk(e,t,r,n,i){for(var s=t._reactName,o=[];r!==null&&r!==n;){var a=r,c=a.alternate,d=a.stateNode;if(c!==null&&c===n)break;a.tag===5&&d!==null&&(a=d,i?(c=y_(r,s),c!=null&&o.unshift(C_(r,c,a))):i||(c=y_(r,s),c!=null&&o.push(C_(r,c,a)))),r=r.return}o.length!==0&&e.push({event:t,listeners:o})}var gee=/\r\n?/g,_ee=/\u0000|\uFFFD/g;function Fk(e){return(typeof e=="string"?e:""+e).replace(gee,`
`).replace(_ee,"")}function Tv(e,t,r){if(t=Fk(t),Fk(e)!==t&&r)throw Error(De(425))}function i1(){}var $I=null,HI=null;function zI(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var WI=typeof setTimeout=="function"?setTimeout:void 0,Eee=typeof clearTimeout=="function"?clearTimeout:void 0,Bk=typeof Promise=="function"?Promise:void 0,vee=typeof queueMicrotask=="function"?queueMicrotask:typeof Bk<"u"?function(e){return Bk.resolve(null).then(e).catch(yee)}:WI;function yee(e){setTimeout(function(){throw e})}function UT(e,t){var r=t,n=0;do{var i=r.nextSibling;if(e.removeChild(r),i&&i.nodeType===8)if(r=i.data,r==="/$"){if(n===0){e.removeChild(i),w_(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=i}while(r);w_(t)}function bu(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Vk(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var Ym=Math.random().toString(36).slice(2),Yc="__reactFiber$"+Ym,I_="__reactProps$"+Ym,vl="__reactContainer$"+Ym,GI="__reactEvents$"+Ym,bee="__reactListeners$"+Ym,See="__reactHandles$"+Ym;function kh(e){var t=e[Yc];if(t)return t;for(var r=e.parentNode;r;){if(t=r[vl]||r[Yc]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=Vk(e);e!==null;){if(r=e[Yc])return r;e=Vk(e)}return t}e=r,r=e.parentNode}return null}function LE(e){return e=e[Yc]||e[vl],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Op(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(De(33))}function BS(e){return e[I_]||null}var qI=[],Np=-1;function Gu(e){return{current:e}}function mn(e){0>Np||(e.current=qI[Np],qI[Np]=null,Np--)}function sn(e,t){Np++,qI[Np]=e.current,e.current=t}var xu={},ls=Gu(xu),so=Gu(!1),af=xu;function ym(e,t){var r=e.type.contextTypes;if(!r)return xu;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in r)i[s]=t[s];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function oo(e){return e=e.childContextTypes,e!=null}function s1(){mn(so),mn(ls)}function $k(e,t,r){if(ls.current!==xu)throw Error(De(168));sn(ls,t),sn(so,r)}function $V(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var i in n)if(!(i in t))throw Error(De(108,oZ(e)||"Unknown",i));return On({},r,n)}function o1(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||xu,af=ls.current,sn(ls,e),sn(so,so.current),!0}function Hk(e,t,r){var n=e.stateNode;if(!n)throw Error(De(169));r?(e=$V(e,t,af),n.__reactInternalMemoizedMergedChildContext=e,mn(so),mn(ls),sn(ls,e)):mn(so),sn(so,r)}var il=null,VS=!1,jT=!1;function HV(e){il===null?il=[e]:il.push(e)}function wee(e){VS=!0,HV(e)}function qu(){if(!jT&&il!==null){jT=!0;var e=0,t=Gr;try{var r=il;for(Gr=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}il=null,VS=!1}catch(i){throw il!==null&&(il=il.slice(e+1)),pV(KN,qu),i}finally{Gr=t,jT=!1}}return null}var Dp=[],Pp=0,a1=null,c1=0,Sa=[],wa=0,cf=null,ll=1,ul="";function yh(e,t){Dp[Pp++]=c1,Dp[Pp++]=a1,a1=e,c1=t}function zV(e,t,r){Sa[wa++]=ll,Sa[wa++]=ul,Sa[wa++]=cf,cf=e;var n=ll;e=ul;var i=32-hc(n)-1;n&=~(1<<i),r+=1;var s=32-hc(t)+i;if(30<s){var o=i-i%5;s=(n&(1<<o)-1).toString(32),n>>=o,i-=o,ll=1<<32-hc(t)+i|r<<i|n,ul=s+e}else ll=1<<s|r<<i|n,ul=e}function nD(e){e.return!==null&&(yh(e,1),zV(e,1,0))}function iD(e){for(;e===a1;)a1=Dp[--Pp],Dp[Pp]=null,c1=Dp[--Pp],Dp[Pp]=null;for(;e===cf;)cf=Sa[--wa],Sa[wa]=null,ul=Sa[--wa],Sa[wa]=null,ll=Sa[--wa],Sa[wa]=null}var Mo=null,No=null,En=!1,oc=null;function WV(e,t){var r=Ia(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function zk(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Mo=e,No=bu(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Mo=e,No=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=cf!==null?{id:ll,overflow:ul}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=Ia(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,Mo=e,No=null,!0):!1;default:return!1}}function KI(e){return(e.mode&1)!==0&&(e.flags&128)===0}function YI(e){if(En){var t=No;if(t){var r=t;if(!zk(e,t)){if(KI(e))throw Error(De(418));t=bu(r.nextSibling);var n=Mo;t&&zk(e,t)?WV(n,r):(e.flags=e.flags&-4097|2,En=!1,Mo=e)}}else{if(KI(e))throw Error(De(418));e.flags=e.flags&-4097|2,En=!1,Mo=e}}}function Wk(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Mo=e}function Rv(e){if(e!==Mo)return!1;if(!En)return Wk(e),En=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!zI(e.type,e.memoizedProps)),t&&(t=No)){if(KI(e))throw GV(),Error(De(418));for(;t;)WV(e,t),t=bu(t.nextSibling)}if(Wk(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(De(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){No=bu(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}No=null}}else No=Mo?bu(e.stateNode.nextSibling):null;return!0}function GV(){for(var e=No;e;)e=bu(e.nextSibling)}function bm(){No=Mo=null,En=!1}function sD(e){oc===null?oc=[e]:oc.push(e)}var Tee=Al.ReactCurrentBatchConfig;function Qa(e,t){if(e&&e.defaultProps){t=On({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}var d1=Gu(null),l1=null,kp=null,oD=null;function aD(){oD=kp=l1=null}function cD(e){var t=d1.current;mn(d1),e._currentValue=t}function JI(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function tm(e,t){l1=e,oD=kp=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(to=!0),e.firstContext=null)}function Pa(e){var t=e._currentValue;if(oD!==e)if(e={context:e,memoizedValue:t,next:null},kp===null){if(l1===null)throw Error(De(308));kp=e,l1.dependencies={lanes:0,firstContext:e}}else kp=kp.next=e;return t}var Lh=null;function dD(e){Lh===null?Lh=[e]:Lh.push(e)}function qV(e,t,r,n){var i=t.interleaved;return i===null?(r.next=r,dD(t)):(r.next=i.next,i.next=r),t.interleaved=r,yl(e,n)}function yl(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var Kl=!1;function lD(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function KV(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ml(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Su(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,Ar&2){var i=n.pending;return i===null?t.next=t:(t.next=i.next,i.next=t),n.pending=t,yl(e,r)}return i=n.interleaved,i===null?(t.next=t,dD(n)):(t.next=i.next,i.next=t),n.interleaved=t,yl(e,r)}function Ky(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,YN(e,r)}}function Gk(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var i=null,s=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};s===null?i=s=o:s=s.next=o,r=r.next}while(r!==null);s===null?i=s=t:s=s.next=t}else i=s=t;r={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function u1(e,t,r,n){var i=e.updateQueue;Kl=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var c=a,d=c.next;c.next=null,o===null?s=d:o.next=d,o=c;var l=e.alternate;l!==null&&(l=l.updateQueue,a=l.lastBaseUpdate,a!==o&&(a===null?l.firstBaseUpdate=d:a.next=d,l.lastBaseUpdate=c))}if(s!==null){var u=i.baseState;o=0,l=d=c=null,a=s;do{var h=a.lane,p=a.eventTime;if((n&h)===h){l!==null&&(l=l.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var _=e,g=a;switch(h=t,p=r,g.tag){case 1:if(_=g.payload,typeof _=="function"){u=_.call(p,u,h);break e}u=_;break e;case 3:_.flags=_.flags&-65537|128;case 0:if(_=g.payload,h=typeof _=="function"?_.call(p,u,h):_,h==null)break e;u=On({},u,h);break e;case 2:Kl=!0}}a.callback!==null&&a.lane!==0&&(e.flags|=64,h=i.effects,h===null?i.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},l===null?(d=l=p,c=u):l=l.next=p,o|=h;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;h=a,a=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(!0);if(l===null&&(c=u),i.baseState=c,i.firstBaseUpdate=d,i.lastBaseUpdate=l,t=i.shared.interleaved,t!==null){i=t;do o|=i.lane,i=i.next;while(i!==t)}else s===null&&(i.shared.lanes=0);lf|=o,e.lanes=o,e.memoizedState=u}}function qk(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],i=n.callback;if(i!==null){if(n.callback=null,n=r,typeof i!="function")throw Error(De(191,i));i.call(n)}}}var YV=new qB.Component().refs;function XI(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:On({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var $S={isMounted:function(e){return(e=e._reactInternals)?Cf(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=As(),i=Tu(e),s=ml(n,i);s.payload=t,r!=null&&(s.callback=r),t=Su(e,s,i),t!==null&&(fc(t,e,i,n),Ky(t,e,i))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=As(),i=Tu(e),s=ml(n,i);s.tag=1,s.payload=t,r!=null&&(s.callback=r),t=Su(e,s,i),t!==null&&(fc(t,e,i,n),Ky(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=As(),n=Tu(e),i=ml(r,n);i.tag=2,t!=null&&(i.callback=t),t=Su(e,i,n),t!==null&&(fc(t,e,n,r),Ky(t,e,n))}};function Kk(e,t,r,n,i,s,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,s,o):t.prototype&&t.prototype.isPureReactComponent?!R_(r,n)||!R_(i,s):!0}function JV(e,t,r){var n=!1,i=xu,s=t.contextType;return typeof s=="object"&&s!==null?s=Pa(s):(i=oo(t)?af:ls.current,n=t.contextTypes,s=(n=n!=null)?ym(e,i):xu),t=new t(r,s),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=$S,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=s),t}function Yk(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&$S.enqueueReplaceState(t,t.state,null)}function QI(e,t,r,n){var i=e.stateNode;i.props=r,i.state=e.memoizedState,i.refs=YV,lD(e);var s=t.contextType;typeof s=="object"&&s!==null?i.context=Pa(s):(s=oo(t)?af:ls.current,i.context=ym(e,s)),i.state=e.memoizedState,s=t.getDerivedStateFromProps,typeof s=="function"&&(XI(e,t,s,r),i.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(t=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),t!==i.state&&$S.enqueueReplaceState(i,i.state,null),u1(e,r,i,n),i.state=e.memoizedState),typeof i.componentDidMount=="function"&&(e.flags|=4194308)}function z0(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(De(309));var n=r.stateNode}if(!n)throw Error(De(147,e));var i=n,s=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===s?t.ref:(t=function(o){var a=i.refs;a===YV&&(a=i.refs={}),o===null?delete a[s]:a[s]=o},t._stringRef=s,t)}if(typeof e!="string")throw Error(De(284));if(!r._owner)throw Error(De(290,e))}return e}function Av(e,t){throw e=Object.prototype.toString.call(t),Error(De(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Jk(e){var t=e._init;return t(e._payload)}function XV(e){function t(b,v){if(e){var I=b.deletions;I===null?(b.deletions=[v],b.flags|=16):I.push(v)}}function r(b,v){if(!e)return null;for(;v!==null;)t(b,v),v=v.sibling;return null}function n(b,v){for(b=new Map;v!==null;)v.key!==null?b.set(v.key,v):b.set(v.index,v),v=v.sibling;return b}function i(b,v){return b=Ru(b,v),b.index=0,b.sibling=null,b}function s(b,v,I){return b.index=I,e?(I=b.alternate,I!==null?(I=I.index,I<v?(b.flags|=2,v):I):(b.flags|=2,v)):(b.flags|=1048576,v)}function o(b){return e&&b.alternate===null&&(b.flags|=2),b}function a(b,v,I,N){return v===null||v.tag!==6?(v=WT(I,b.mode,N),v.return=b,v):(v=i(v,I),v.return=b,v)}function c(b,v,I,N){var L=I.type;return L===Rp?l(b,v,I.props.children,N,I.key):v!==null&&(v.elementType===L||typeof L=="object"&&L!==null&&L.$$typeof===ql&&Jk(L)===v.type)?(N=i(v,I.props),N.ref=z0(b,v,I),N.return=b,N):(N=eb(I.type,I.key,I.props,null,b.mode,N),N.ref=z0(b,v,I),N.return=b,N)}function d(b,v,I,N){return v===null||v.tag!==4||v.stateNode.containerInfo!==I.containerInfo||v.stateNode.implementation!==I.implementation?(v=GT(I,b.mode,N),v.return=b,v):(v=i(v,I.children||[]),v.return=b,v)}function l(b,v,I,N,L){return v===null||v.tag!==7?(v=Jh(I,b.mode,N,L),v.return=b,v):(v=i(v,I),v.return=b,v)}function u(b,v,I){if(typeof v=="string"&&v!==""||typeof v=="number")return v=WT(""+v,b.mode,I),v.return=b,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case mv:return I=eb(v.type,v.key,v.props,null,b.mode,I),I.ref=z0(b,null,v),I.return=b,I;case Tp:return v=GT(v,b.mode,I),v.return=b,v;case ql:var N=v._init;return u(b,N(v._payload),I)}if(Tg(v)||F0(v))return v=Jh(v,b.mode,I,null),v.return=b,v;Av(b,v)}return null}function h(b,v,I,N){var L=v!==null?v.key:null;if(typeof I=="string"&&I!==""||typeof I=="number")return L!==null?null:a(b,v,""+I,N);if(typeof I=="object"&&I!==null){switch(I.$$typeof){case mv:return I.key===L?c(b,v,I,N):null;case Tp:return I.key===L?d(b,v,I,N):null;case ql:return L=I._init,h(b,v,L(I._payload),N)}if(Tg(I)||F0(I))return L!==null?null:l(b,v,I,N,null);Av(b,I)}return null}function p(b,v,I,N,L){if(typeof N=="string"&&N!==""||typeof N=="number")return b=b.get(I)||null,a(v,b,""+N,L);if(typeof N=="object"&&N!==null){switch(N.$$typeof){case mv:return b=b.get(N.key===null?I:N.key)||null,c(v,b,N,L);case Tp:return b=b.get(N.key===null?I:N.key)||null,d(v,b,N,L);case ql:var U=N._init;return p(b,v,I,U(N._payload),L)}if(Tg(N)||F0(N))return b=b.get(I)||null,l(v,b,N,L,null);Av(v,N)}return null}function _(b,v,I,N){for(var L=null,U=null,w=v,V=v=0,z=null;w!==null&&V<I.length;V++){w.index>V?(z=w,w=null):z=w.sibling;var K=h(b,w,I[V],N);if(K===null){w===null&&(w=z);break}e&&w&&K.alternate===null&&t(b,w),v=s(K,v,V),U===null?L=K:U.sibling=K,U=K,w=z}if(V===I.length)return r(b,w),En&&yh(b,V),L;if(w===null){for(;V<I.length;V++)w=u(b,I[V],N),w!==null&&(v=s(w,v,V),U===null?L=w:U.sibling=w,U=w);return En&&yh(b,V),L}for(w=n(b,w);V<I.length;V++)z=p(w,b,V,I[V],N),z!==null&&(e&&z.alternate!==null&&w.delete(z.key===null?V:z.key),v=s(z,v,V),U===null?L=z:U.sibling=z,U=z);return e&&w.forEach(function(H){return t(b,H)}),En&&yh(b,V),L}function g(b,v,I,N){var L=F0(I);if(typeof L!="function")throw Error(De(150));if(I=L.call(I),I==null)throw Error(De(151));for(var U=L=null,w=v,V=v=0,z=null,K=I.next();w!==null&&!K.done;V++,K=I.next()){w.index>V?(z=w,w=null):z=w.sibling;var H=h(b,w,K.value,N);if(H===null){w===null&&(w=z);break}e&&w&&H.alternate===null&&t(b,w),v=s(H,v,V),U===null?L=H:U.sibling=H,U=H,w=z}if(K.done)return r(b,w),En&&yh(b,V),L;if(w===null){for(;!K.done;V++,K=I.next())K=u(b,K.value,N),K!==null&&(v=s(K,v,V),U===null?L=K:U.sibling=K,U=K);return En&&yh(b,V),L}for(w=n(b,w);!K.done;V++,K=I.next())K=p(w,b,V,K.value,N),K!==null&&(e&&K.alternate!==null&&w.delete(K.key===null?V:K.key),v=s(K,v,V),U===null?L=K:U.sibling=K,U=K);return e&&w.forEach(function(A){return t(b,A)}),En&&yh(b,V),L}function E(b,v,I,N){if(typeof I=="object"&&I!==null&&I.type===Rp&&I.key===null&&(I=I.props.children),typeof I=="object"&&I!==null){switch(I.$$typeof){case mv:e:{for(var L=I.key,U=v;U!==null;){if(U.key===L){if(L=I.type,L===Rp){if(U.tag===7){r(b,U.sibling),v=i(U,I.props.children),v.return=b,b=v;break e}}else if(U.elementType===L||typeof L=="object"&&L!==null&&L.$$typeof===ql&&Jk(L)===U.type){r(b,U.sibling),v=i(U,I.props),v.ref=z0(b,U,I),v.return=b,b=v;break e}r(b,U);break}else t(b,U);U=U.sibling}I.type===Rp?(v=Jh(I.props.children,b.mode,N,I.key),v.return=b,b=v):(N=eb(I.type,I.key,I.props,null,b.mode,N),N.ref=z0(b,v,I),N.return=b,b=N)}return o(b);case Tp:e:{for(U=I.key;v!==null;){if(v.key===U)if(v.tag===4&&v.stateNode.containerInfo===I.containerInfo&&v.stateNode.implementation===I.implementation){r(b,v.sibling),v=i(v,I.children||[]),v.return=b,b=v;break e}else{r(b,v);break}else t(b,v);v=v.sibling}v=GT(I,b.mode,N),v.return=b,b=v}return o(b);case ql:return U=I._init,E(b,v,U(I._payload),N)}if(Tg(I))return _(b,v,I,N);if(F0(I))return g(b,v,I,N);Av(b,I)}return typeof I=="string"&&I!==""||typeof I=="number"?(I=""+I,v!==null&&v.tag===6?(r(b,v.sibling),v=i(v,I),v.return=b,b=v):(r(b,v),v=WT(I,b.mode,N),v.return=b,b=v),o(b)):r(b,v)}return E}var Sm=XV(!0),QV=XV(!1),xE={},nd=Gu(xE),O_=Gu(xE),N_=Gu(xE);function xh(e){if(e===xE)throw Error(De(174));return e}function uD(e,t){switch(sn(N_,t),sn(O_,e),sn(nd,xE),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:NI(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=NI(t,e)}mn(nd),sn(nd,t)}function wm(){mn(nd),mn(O_),mn(N_)}function ZV(e){xh(N_.current);var t=xh(nd.current),r=NI(t,e.type);t!==r&&(sn(O_,e),sn(nd,r))}function hD(e){O_.current===e&&(mn(nd),mn(O_))}var Tn=Gu(0);function h1(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var FT=[];function fD(){for(var e=0;e<FT.length;e++)FT[e]._workInProgressVersionPrimary=null;FT.length=0}var Yy=Al.ReactCurrentDispatcher,BT=Al.ReactCurrentBatchConfig,df=0,Cn=null,hi=null,Ti=null,f1=!1,Yg=!1,D_=0,Ree=0;function Yi(){throw Error(De(321))}function pD(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!_c(e[r],t[r]))return!1;return!0}function mD(e,t,r,n,i,s){if(df=s,Cn=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Yy.current=e===null||e.memoizedState===null?Oee:Nee,e=r(n,i),Yg){s=0;do{if(Yg=!1,D_=0,25<=s)throw Error(De(301));s+=1,Ti=hi=null,t.updateQueue=null,Yy.current=Dee,e=r(n,i)}while(Yg)}if(Yy.current=p1,t=hi!==null&&hi.next!==null,df=0,Ti=hi=Cn=null,f1=!1,t)throw Error(De(300));return e}function gD(){var e=D_!==0;return D_=0,e}function Fc(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ti===null?Cn.memoizedState=Ti=e:Ti=Ti.next=e,Ti}function ka(){if(hi===null){var e=Cn.alternate;e=e!==null?e.memoizedState:null}else e=hi.next;var t=Ti===null?Cn.memoizedState:Ti.next;if(t!==null)Ti=t,hi=e;else{if(e===null)throw Error(De(310));hi=e,e={memoizedState:hi.memoizedState,baseState:hi.baseState,baseQueue:hi.baseQueue,queue:hi.queue,next:null},Ti===null?Cn.memoizedState=Ti=e:Ti=Ti.next=e}return Ti}function P_(e,t){return typeof t=="function"?t(e):t}function VT(e){var t=ka(),r=t.queue;if(r===null)throw Error(De(311));r.lastRenderedReducer=e;var n=hi,i=n.baseQueue,s=r.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}n.baseQueue=i=s,r.pending=null}if(i!==null){s=i.next,n=n.baseState;var a=o=null,c=null,d=s;do{var l=d.lane;if((df&l)===l)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),n=d.hasEagerState?d.eagerState:e(n,d.action);else{var u={lane:l,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(a=c=u,o=n):c=c.next=u,Cn.lanes|=l,lf|=l}d=d.next}while(d!==null&&d!==s);c===null?o=n:c.next=a,_c(n,t.memoizedState)||(to=!0),t.memoizedState=n,t.baseState=o,t.baseQueue=c,r.lastRenderedState=n}if(e=r.interleaved,e!==null){i=e;do s=i.lane,Cn.lanes|=s,lf|=s,i=i.next;while(i!==e)}else i===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function $T(e){var t=ka(),r=t.queue;if(r===null)throw Error(De(311));r.lastRenderedReducer=e;var n=r.dispatch,i=r.pending,s=t.memoizedState;if(i!==null){r.pending=null;var o=i=i.next;do s=e(s,o.action),o=o.next;while(o!==i);_c(s,t.memoizedState)||(to=!0),t.memoizedState=s,t.baseQueue===null&&(t.baseState=s),r.lastRenderedState=s}return[s,n]}function e$(){}function t$(e,t){var r=Cn,n=ka(),i=t(),s=!_c(n.memoizedState,i);if(s&&(n.memoizedState=i,to=!0),n=n.queue,_D(i$.bind(null,r,n,e),[e]),n.getSnapshot!==t||s||Ti!==null&&Ti.memoizedState.tag&1){if(r.flags|=2048,k_(9,n$.bind(null,r,n,i,t),void 0,null),Oi===null)throw Error(De(349));df&30||r$(r,t,i)}return i}function r$(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Cn.updateQueue,t===null?(t={lastEffect:null,stores:null},Cn.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function n$(e,t,r,n){t.value=r,t.getSnapshot=n,s$(t)&&o$(e)}function i$(e,t,r){return r(function(){s$(t)&&o$(e)})}function s$(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!_c(e,r)}catch{return!0}}function o$(e){var t=yl(e,1);t!==null&&fc(t,e,1,-1)}function Xk(e){var t=Fc();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:P_,lastRenderedState:e},t.queue=e,e=e.dispatch=Iee.bind(null,Cn,e),[t.memoizedState,e]}function k_(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=Cn.updateQueue,t===null?(t={lastEffect:null,stores:null},Cn.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function a$(){return ka().memoizedState}function Jy(e,t,r,n){var i=Fc();Cn.flags|=e,i.memoizedState=k_(1|t,r,void 0,n===void 0?null:n)}function HS(e,t,r,n){var i=ka();n=n===void 0?null:n;var s=void 0;if(hi!==null){var o=hi.memoizedState;if(s=o.destroy,n!==null&&pD(n,o.deps)){i.memoizedState=k_(t,r,s,n);return}}Cn.flags|=e,i.memoizedState=k_(1|t,r,s,n)}function Qk(e,t){return Jy(8390656,8,e,t)}function _D(e,t){return HS(2048,8,e,t)}function c$(e,t){return HS(4,2,e,t)}function d$(e,t){return HS(4,4,e,t)}function l$(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function u$(e,t,r){return r=r!=null?r.concat([e]):null,HS(4,4,l$.bind(null,t,e),r)}function ED(){}function h$(e,t){var r=ka();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&pD(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function f$(e,t){var r=ka();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&pD(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function p$(e,t,r){return df&21?(_c(r,t)||(r=_V(),Cn.lanes|=r,lf|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,to=!0),e.memoizedState=r)}function Aee(e,t){var r=Gr;Gr=r!==0&&4>r?r:4,e(!0);var n=BT.transition;BT.transition={};try{e(!1),t()}finally{Gr=r,BT.transition=n}}function m$(){return ka().memoizedState}function Cee(e,t,r){var n=Tu(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},g$(e))_$(t,r);else if(r=qV(e,t,r,n),r!==null){var i=As();fc(r,e,n,i),E$(r,t,n)}}function Iee(e,t,r){var n=Tu(e),i={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(g$(e))_$(t,i);else{var s=e.alternate;if(e.lanes===0&&(s===null||s.lanes===0)&&(s=t.lastRenderedReducer,s!==null))try{var o=t.lastRenderedState,a=s(o,r);if(i.hasEagerState=!0,i.eagerState=a,_c(a,o)){var c=t.interleaved;c===null?(i.next=i,dD(t)):(i.next=c.next,c.next=i),t.interleaved=i;return}}catch{}finally{}r=qV(e,t,i,n),r!==null&&(i=As(),fc(r,e,n,i),E$(r,t,n))}}function g$(e){var t=e.alternate;return e===Cn||t!==null&&t===Cn}function _$(e,t){Yg=f1=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function E$(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,YN(e,r)}}var p1={readContext:Pa,useCallback:Yi,useContext:Yi,useEffect:Yi,useImperativeHandle:Yi,useInsertionEffect:Yi,useLayoutEffect:Yi,useMemo:Yi,useReducer:Yi,useRef:Yi,useState:Yi,useDebugValue:Yi,useDeferredValue:Yi,useTransition:Yi,useMutableSource:Yi,useSyncExternalStore:Yi,useId:Yi,unstable_isNewReconciler:!1},Oee={readContext:Pa,useCallback:function(e,t){return Fc().memoizedState=[e,t===void 0?null:t],e},useContext:Pa,useEffect:Qk,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,Jy(4194308,4,l$.bind(null,t,e),r)},useLayoutEffect:function(e,t){return Jy(4194308,4,e,t)},useInsertionEffect:function(e,t){return Jy(4,2,e,t)},useMemo:function(e,t){var r=Fc();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=Fc();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=Cee.bind(null,Cn,e),[n.memoizedState,e]},useRef:function(e){var t=Fc();return e={current:e},t.memoizedState=e},useState:Xk,useDebugValue:ED,useDeferredValue:function(e){return Fc().memoizedState=e},useTransition:function(){var e=Xk(!1),t=e[0];return e=Aee.bind(null,e[1]),Fc().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=Cn,i=Fc();if(En){if(r===void 0)throw Error(De(407));r=r()}else{if(r=t(),Oi===null)throw Error(De(349));df&30||r$(n,t,r)}i.memoizedState=r;var s={value:r,getSnapshot:t};return i.queue=s,Qk(i$.bind(null,n,s,e),[e]),n.flags|=2048,k_(9,n$.bind(null,n,s,r,t),void 0,null),r},useId:function(){var e=Fc(),t=Oi.identifierPrefix;if(En){var r=ul,n=ll;r=(n&~(1<<32-hc(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=D_++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=Ree++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Nee={readContext:Pa,useCallback:h$,useContext:Pa,useEffect:_D,useImperativeHandle:u$,useInsertionEffect:c$,useLayoutEffect:d$,useMemo:f$,useReducer:VT,useRef:a$,useState:function(){return VT(P_)},useDebugValue:ED,useDeferredValue:function(e){var t=ka();return p$(t,hi.memoizedState,e)},useTransition:function(){var e=VT(P_)[0],t=ka().memoizedState;return[e,t]},useMutableSource:e$,useSyncExternalStore:t$,useId:m$,unstable_isNewReconciler:!1},Dee={readContext:Pa,useCallback:h$,useContext:Pa,useEffect:_D,useImperativeHandle:u$,useInsertionEffect:c$,useLayoutEffect:d$,useMemo:f$,useReducer:$T,useRef:a$,useState:function(){return $T(P_)},useDebugValue:ED,useDeferredValue:function(e){var t=ka();return hi===null?t.memoizedState=e:p$(t,hi.memoizedState,e)},useTransition:function(){var e=$T(P_)[0],t=ka().memoizedState;return[e,t]},useMutableSource:e$,useSyncExternalStore:t$,useId:m$,unstable_isNewReconciler:!1};function Tm(e,t){try{var r="",n=t;do r+=sZ(n),n=n.return;while(n);var i=r}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:e,source:t,stack:i,digest:null}}function HT(e,t,r){return{value:e,source:null,stack:null,digest:t??null}}function ZI(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var Pee=typeof WeakMap=="function"?WeakMap:Map;function v$(e,t,r){r=ml(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){g1||(g1=!0,dO=n),ZI(e,t)},r}function y$(e,t,r){r=ml(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var i=t.value;r.payload=function(){return n(i)},r.callback=function(){ZI(e,t)}}var s=e.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(r.callback=function(){ZI(e,t),typeof n!="function"&&(wu===null?wu=new Set([this]):wu.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),r}function Zk(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new Pee;var i=new Set;n.set(t,i)}else i=n.get(t),i===void 0&&(i=new Set,n.set(t,i));i.has(r)||(i.add(r),e=Gee.bind(null,e,t,r),t.then(e,e))}function eL(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function tL(e,t,r,n,i){return e.mode&1?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=ml(-1,1),t.tag=2,Su(r,t,1))),r.lanes|=1),e)}var kee=Al.ReactCurrentOwner,to=!1;function vs(e,t,r,n){t.child=e===null?QV(t,null,r,n):Sm(t,e.child,r,n)}function rL(e,t,r,n,i){r=r.render;var s=t.ref;return tm(t,i),n=mD(e,t,r,n,s,i),r=gD(),e!==null&&!to?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,bl(e,t,i)):(En&&r&&nD(t),t.flags|=1,vs(e,t,n,i),t.child)}function nL(e,t,r,n,i){if(e===null){var s=r.type;return typeof s=="function"&&!AD(s)&&s.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=s,b$(e,t,s,n,i)):(e=eb(r.type,null,n,t,t.mode,i),e.ref=t.ref,e.return=t,t.child=e)}if(s=e.child,!(e.lanes&i)){var o=s.memoizedProps;if(r=r.compare,r=r!==null?r:R_,r(o,n)&&e.ref===t.ref)return bl(e,t,i)}return t.flags|=1,e=Ru(s,n),e.ref=t.ref,e.return=t,t.child=e}function b$(e,t,r,n,i){if(e!==null){var s=e.memoizedProps;if(R_(s,n)&&e.ref===t.ref)if(to=!1,t.pendingProps=n=s,(e.lanes&i)!==0)e.flags&131072&&(to=!0);else return t.lanes=e.lanes,bl(e,t,i)}return eO(e,t,r,n,i)}function S$(e,t,r){var n=t.pendingProps,i=n.children,s=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},sn(xp,Ao),Ao|=r;else{if(!(r&1073741824))return e=s!==null?s.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,sn(xp,Ao),Ao|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=s!==null?s.baseLanes:r,sn(xp,Ao),Ao|=n}else s!==null?(n=s.baseLanes|r,t.memoizedState=null):n=r,sn(xp,Ao),Ao|=n;return vs(e,t,i,r),t.child}function w$(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function eO(e,t,r,n,i){var s=oo(r)?af:ls.current;return s=ym(t,s),tm(t,i),r=mD(e,t,r,n,s,i),n=gD(),e!==null&&!to?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,bl(e,t,i)):(En&&n&&nD(t),t.flags|=1,vs(e,t,r,i),t.child)}function iL(e,t,r,n,i){if(oo(r)){var s=!0;o1(t)}else s=!1;if(tm(t,i),t.stateNode===null)Xy(e,t),JV(t,r,n),QI(t,r,n,i),n=!0;else if(e===null){var o=t.stateNode,a=t.memoizedProps;o.props=a;var c=o.context,d=r.contextType;typeof d=="object"&&d!==null?d=Pa(d):(d=oo(r)?af:ls.current,d=ym(t,d));var l=r.getDerivedStateFromProps,u=typeof l=="function"||typeof o.getSnapshotBeforeUpdate=="function";u||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==n||c!==d)&&Yk(t,o,n,d),Kl=!1;var h=t.memoizedState;o.state=h,u1(t,n,o,i),c=t.memoizedState,a!==n||h!==c||so.current||Kl?(typeof l=="function"&&(XI(t,r,l,n),c=t.memoizedState),(a=Kl||Kk(t,r,a,n,h,c,d))?(u||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=c),o.props=n,o.state=c,o.context=d,n=a):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{o=t.stateNode,KV(e,t),a=t.memoizedProps,d=t.type===t.elementType?a:Qa(t.type,a),o.props=d,u=t.pendingProps,h=o.context,c=r.contextType,typeof c=="object"&&c!==null?c=Pa(c):(c=oo(r)?af:ls.current,c=ym(t,c));var p=r.getDerivedStateFromProps;(l=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==u||h!==c)&&Yk(t,o,n,c),Kl=!1,h=t.memoizedState,o.state=h,u1(t,n,o,i);var _=t.memoizedState;a!==u||h!==_||so.current||Kl?(typeof p=="function"&&(XI(t,r,p,n),_=t.memoizedState),(d=Kl||Kk(t,r,d,n,h,_,c)||!1)?(l||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,_,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,_,c)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=_),o.props=n,o.state=_,o.context=c,n=d):(typeof o.componentDidUpdate!="function"||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),n=!1)}return tO(e,t,r,n,s,i)}function tO(e,t,r,n,i,s){w$(e,t);var o=(t.flags&128)!==0;if(!n&&!o)return i&&Hk(t,r,!1),bl(e,t,s);n=t.stateNode,kee.current=t;var a=o&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&o?(t.child=Sm(t,e.child,null,s),t.child=Sm(t,null,a,s)):vs(e,t,a,s),t.memoizedState=n.state,i&&Hk(t,r,!0),t.child}function T$(e){var t=e.stateNode;t.pendingContext?$k(e,t.pendingContext,t.pendingContext!==t.context):t.context&&$k(e,t.context,!1),uD(e,t.containerInfo)}function sL(e,t,r,n,i){return bm(),sD(i),t.flags|=256,vs(e,t,r,n),t.child}var rO={dehydrated:null,treeContext:null,retryLane:0};function nO(e){return{baseLanes:e,cachePool:null,transitions:null}}function R$(e,t,r){var n=t.pendingProps,i=Tn.current,s=!1,o=(t.flags&128)!==0,a;if((a=o)||(a=e!==null&&e.memoizedState===null?!1:(i&2)!==0),a?(s=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(i|=1),sn(Tn,i&1),e===null)return YI(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=n.children,e=n.fallback,s?(n=t.mode,s=t.child,o={mode:"hidden",children:o},!(n&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=GS(o,n,0,null),e=Jh(e,n,r,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=nO(r),t.memoizedState=rO,e):vD(t,o));if(i=e.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return Lee(e,t,o,n,a,i,r);if(s){s=n.fallback,o=t.mode,i=e.child,a=i.sibling;var c={mode:"hidden",children:n.children};return!(o&1)&&t.child!==i?(n=t.child,n.childLanes=0,n.pendingProps=c,t.deletions=null):(n=Ru(i,c),n.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=Ru(a,s):(s=Jh(s,o,r,null),s.flags|=2),s.return=t,n.return=t,n.sibling=s,t.child=n,n=s,s=t.child,o=e.child.memoizedState,o=o===null?nO(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=e.childLanes&~r,t.memoizedState=rO,n}return s=e.child,e=s.sibling,n=Ru(s,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function vD(e,t){return t=GS({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Cv(e,t,r,n){return n!==null&&sD(n),Sm(t,e.child,null,r),e=vD(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Lee(e,t,r,n,i,s,o){if(r)return t.flags&256?(t.flags&=-257,n=HT(Error(De(422))),Cv(e,t,o,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(s=n.fallback,i=t.mode,n=GS({mode:"visible",children:n.children},i,0,null),s=Jh(s,i,o,null),s.flags|=2,n.return=t,s.return=t,n.sibling=s,t.child=n,t.mode&1&&Sm(t,e.child,null,o),t.child.memoizedState=nO(o),t.memoizedState=rO,s);if(!(t.mode&1))return Cv(e,t,o,null);if(i.data==="$!"){if(n=i.nextSibling&&i.nextSibling.dataset,n)var a=n.dgst;return n=a,s=Error(De(419)),n=HT(s,n),Cv(e,t,o,n)}if(a=(o&e.childLanes)!==0,to||a){if(n=Oi,n!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(n.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,yl(e,i),fc(n,e,i,-1))}return RD(),n=HT(Error(De(421))),Cv(e,t,o,n)}return i.data==="$?"?(t.flags|=128,t.child=e.child,t=qee.bind(null,e),i._reactRetry=t,null):(e=s.treeContext,No=bu(i.nextSibling),Mo=t,En=!0,oc=null,e!==null&&(Sa[wa++]=ll,Sa[wa++]=ul,Sa[wa++]=cf,ll=e.id,ul=e.overflow,cf=t),t=vD(t,n.children),t.flags|=4096,t)}function oL(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),JI(e.return,t,r)}function zT(e,t,r,n,i){var s=e.memoizedState;s===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:i}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=r,s.tailMode=i)}function A$(e,t,r){var n=t.pendingProps,i=n.revealOrder,s=n.tail;if(vs(e,t,n.children,r),n=Tn.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&oL(e,r,t);else if(e.tag===19)oL(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(sn(Tn,n),!(t.mode&1))t.memoizedState=null;else switch(i){case"forwards":for(r=t.child,i=null;r!==null;)e=r.alternate,e!==null&&h1(e)===null&&(i=r),r=r.sibling;r=i,r===null?(i=t.child,t.child=null):(i=r.sibling,r.sibling=null),zT(t,!1,i,r,s);break;case"backwards":for(r=null,i=t.child,t.child=null;i!==null;){if(e=i.alternate,e!==null&&h1(e)===null){t.child=i;break}e=i.sibling,i.sibling=r,r=i,i=e}zT(t,!0,r,null,s);break;case"together":zT(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Xy(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function bl(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),lf|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(De(153));if(t.child!==null){for(e=t.child,r=Ru(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Ru(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function xee(e,t,r){switch(t.tag){case 3:T$(t),bm();break;case 5:ZV(t);break;case 1:oo(t.type)&&o1(t);break;case 4:uD(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,i=t.memoizedProps.value;sn(d1,n._currentValue),n._currentValue=i;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(sn(Tn,Tn.current&1),t.flags|=128,null):r&t.child.childLanes?R$(e,t,r):(sn(Tn,Tn.current&1),e=bl(e,t,r),e!==null?e.sibling:null);sn(Tn,Tn.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return A$(e,t,r);t.flags|=128}if(i=t.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),sn(Tn,Tn.current),n)break;return null;case 22:case 23:return t.lanes=0,S$(e,t,r)}return bl(e,t,r)}var C$,iO,I$,O$;C$=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};iO=function(){};I$=function(e,t,r,n){var i=e.memoizedProps;if(i!==n){e=t.stateNode,xh(nd.current);var s=null;switch(r){case"input":i=AI(e,i),n=AI(e,n),s=[];break;case"select":i=On({},i,{value:void 0}),n=On({},n,{value:void 0}),s=[];break;case"textarea":i=OI(e,i),n=OI(e,n),s=[];break;default:typeof i.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=i1)}DI(r,n);var o;r=null;for(d in i)if(!n.hasOwnProperty(d)&&i.hasOwnProperty(d)&&i[d]!=null)if(d==="style"){var a=i[d];for(o in a)a.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(E_.hasOwnProperty(d)?s||(s=[]):(s=s||[]).push(d,null));for(d in n){var c=n[d];if(a=i!=null?i[d]:void 0,n.hasOwnProperty(d)&&c!==a&&(c!=null||a!=null))if(d==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(r||(r={}),r[o]=c[o])}else r||(s||(s=[]),s.push(d,r)),r=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(s=s||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(E_.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&dn("scroll",e),s||a===c||(s=[])):(s=s||[]).push(d,c))}r&&(s=s||[]).push("style",r);var d=s;(t.updateQueue=d)&&(t.flags|=4)}};O$=function(e,t,r,n){r!==n&&(t.flags|=4)};function W0(e,t){if(!En)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Ji(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var i=e.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags&14680064,n|=i.flags&14680064,i.return=e,i=i.sibling;else for(i=e.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function Mee(e,t,r){var n=t.pendingProps;switch(iD(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ji(t),null;case 1:return oo(t.type)&&s1(),Ji(t),null;case 3:return n=t.stateNode,wm(),mn(so),mn(ls),fD(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(Rv(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,oc!==null&&(hO(oc),oc=null))),iO(e,t),Ji(t),null;case 5:hD(t);var i=xh(N_.current);if(r=t.type,e!==null&&t.stateNode!=null)I$(e,t,r,n,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(De(166));return Ji(t),null}if(e=xh(nd.current),Rv(t)){n=t.stateNode,r=t.type;var s=t.memoizedProps;switch(n[Yc]=t,n[I_]=s,e=(t.mode&1)!==0,r){case"dialog":dn("cancel",n),dn("close",n);break;case"iframe":case"object":case"embed":dn("load",n);break;case"video":case"audio":for(i=0;i<Ag.length;i++)dn(Ag[i],n);break;case"source":dn("error",n);break;case"img":case"image":case"link":dn("error",n),dn("load",n);break;case"details":dn("toggle",n);break;case"input":mk(n,s),dn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!s.multiple},dn("invalid",n);break;case"textarea":_k(n,s),dn("invalid",n)}DI(r,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?n.textContent!==a&&(s.suppressHydrationWarning!==!0&&Tv(n.textContent,a,e),i=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Tv(n.textContent,a,e),i=["children",""+a]):E_.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&dn("scroll",n)}switch(r){case"input":gv(n),gk(n,s,!0);break;case"textarea":gv(n),Ek(n);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(n.onclick=i1)}n=i,t.updateQueue=n,n!==null&&(t.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=rV(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=o.createElement(r,{is:n.is}):(e=o.createElement(r),r==="select"&&(o=e,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):e=o.createElementNS(e,r),e[Yc]=t,e[I_]=n,C$(e,t,!1,!1),t.stateNode=e;e:{switch(o=PI(r,n),r){case"dialog":dn("cancel",e),dn("close",e),i=n;break;case"iframe":case"object":case"embed":dn("load",e),i=n;break;case"video":case"audio":for(i=0;i<Ag.length;i++)dn(Ag[i],e);i=n;break;case"source":dn("error",e),i=n;break;case"img":case"image":case"link":dn("error",e),dn("load",e),i=n;break;case"details":dn("toggle",e),i=n;break;case"input":mk(e,n),i=AI(e,n),dn("invalid",e);break;case"option":i=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},i=On({},n,{value:void 0}),dn("invalid",e);break;case"textarea":_k(e,n),i=OI(e,n),dn("invalid",e);break;default:i=n}DI(r,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var c=a[s];s==="style"?sV(e,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&nV(e,c)):s==="children"?typeof c=="string"?(r!=="textarea"||c!=="")&&v_(e,c):typeof c=="number"&&v_(e,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(E_.hasOwnProperty(s)?c!=null&&s==="onScroll"&&dn("scroll",e):c!=null&&HN(e,s,c,o))}switch(r){case"input":gv(e),gk(e,n,!1);break;case"textarea":gv(e),Ek(e);break;case"option":n.value!=null&&e.setAttribute("value",""+Lu(n.value));break;case"select":e.multiple=!!n.multiple,s=n.value,s!=null?Xp(e,!!n.multiple,s,!1):n.defaultValue!=null&&Xp(e,!!n.multiple,n.defaultValue,!0);break;default:typeof i.onClick=="function"&&(e.onclick=i1)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Ji(t),null;case 6:if(e&&t.stateNode!=null)O$(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(De(166));if(r=xh(N_.current),xh(nd.current),Rv(t)){if(n=t.stateNode,r=t.memoizedProps,n[Yc]=t,(s=n.nodeValue!==r)&&(e=Mo,e!==null))switch(e.tag){case 3:Tv(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Tv(n.nodeValue,r,(e.mode&1)!==0)}s&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[Yc]=t,t.stateNode=n}return Ji(t),null;case 13:if(mn(Tn),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(En&&No!==null&&t.mode&1&&!(t.flags&128))GV(),bm(),t.flags|=98560,s=!1;else if(s=Rv(t),n!==null&&n.dehydrated!==null){if(e===null){if(!s)throw Error(De(318));if(s=t.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(De(317));s[Yc]=t}else bm(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Ji(t),s=!1}else oc!==null&&(hO(oc),oc=null),s=!0;if(!s)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||Tn.current&1?pi===0&&(pi=3):RD())),t.updateQueue!==null&&(t.flags|=4),Ji(t),null);case 4:return wm(),iO(e,t),e===null&&A_(t.stateNode.containerInfo),Ji(t),null;case 10:return cD(t.type._context),Ji(t),null;case 17:return oo(t.type)&&s1(),Ji(t),null;case 19:if(mn(Tn),s=t.memoizedState,s===null)return Ji(t),null;if(n=(t.flags&128)!==0,o=s.rendering,o===null)if(n)W0(s,!1);else{if(pi!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=h1(e),o!==null){for(t.flags|=128,W0(s,!1),n=o.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)s=r,e=n,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,e=o.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return sn(Tn,Tn.current&1|2),t.child}e=e.sibling}s.tail!==null&&Yn()>Rm&&(t.flags|=128,n=!0,W0(s,!1),t.lanes=4194304)}else{if(!n)if(e=h1(o),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),W0(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!En)return Ji(t),null}else 2*Yn()-s.renderingStartTime>Rm&&r!==1073741824&&(t.flags|=128,n=!0,W0(s,!1),t.lanes=4194304);s.isBackwards?(o.sibling=t.child,t.child=o):(r=s.last,r!==null?r.sibling=o:t.child=o,s.last=o)}return s.tail!==null?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Yn(),t.sibling=null,r=Tn.current,sn(Tn,n?r&1|2:r&1),t):(Ji(t),null);case 22:case 23:return TD(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?Ao&1073741824&&(Ji(t),t.subtreeFlags&6&&(t.flags|=8192)):Ji(t),null;case 24:return null;case 25:return null}throw Error(De(156,t.tag))}function Uee(e,t){switch(iD(t),t.tag){case 1:return oo(t.type)&&s1(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return wm(),mn(so),mn(ls),fD(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return hD(t),null;case 13:if(mn(Tn),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(De(340));bm()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return mn(Tn),null;case 4:return wm(),null;case 10:return cD(t.type._context),null;case 22:case 23:return TD(),null;case 24:return null;default:return null}}var Iv=!1,cs=!1,jee=typeof WeakSet=="function"?WeakSet:Set,et=null;function Lp(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){Mn(e,t,n)}else r.current=null}function sO(e,t,r){try{r()}catch(n){Mn(e,t,n)}}var aL=!1;function Fee(e,t){if($I=t1,e=kV(),rD(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var i=n.anchorOffset,s=n.focusNode;n=n.focusOffset;try{r.nodeType,s.nodeType}catch{r=null;break e}var o=0,a=-1,c=-1,d=0,l=0,u=e,h=null;t:for(;;){for(var p;u!==r||i!==0&&u.nodeType!==3||(a=o+i),u!==s||n!==0&&u.nodeType!==3||(c=o+n),u.nodeType===3&&(o+=u.nodeValue.length),(p=u.firstChild)!==null;)h=u,u=p;for(;;){if(u===e)break t;if(h===r&&++d===i&&(a=o),h===s&&++l===n&&(c=o),(p=u.nextSibling)!==null)break;u=h,h=u.parentNode}u=p}r=a===-1||c===-1?null:{start:a,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(HI={focusedElem:e,selectionRange:r},t1=!1,et=t;et!==null;)if(t=et,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,et=e;else for(;et!==null;){t=et;try{var _=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(_!==null){var g=_.memoizedProps,E=_.memoizedState,b=t.stateNode,v=b.getSnapshotBeforeUpdate(t.elementType===t.type?g:Qa(t.type,g),E);b.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var I=t.stateNode.containerInfo;I.nodeType===1?I.textContent="":I.nodeType===9&&I.documentElement&&I.removeChild(I.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(De(163))}}catch(N){Mn(t,t.return,N)}if(e=t.sibling,e!==null){e.return=t.return,et=e;break}et=t.return}return _=aL,aL=!1,_}function Jg(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do{if((i.tag&e)===e){var s=i.destroy;i.destroy=void 0,s!==void 0&&sO(t,r,s)}i=i.next}while(i!==n)}}function zS(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function oO(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function N$(e){var t=e.alternate;t!==null&&(e.alternate=null,N$(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Yc],delete t[I_],delete t[GI],delete t[bee],delete t[See])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function D$(e){return e.tag===5||e.tag===3||e.tag===4}function cL(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||D$(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function aO(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=i1));else if(n!==4&&(e=e.child,e!==null))for(aO(e,t,r),e=e.sibling;e!==null;)aO(e,t,r),e=e.sibling}function cO(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(cO(e,t,r),e=e.sibling;e!==null;)cO(e,t,r),e=e.sibling}var Ui=null,tc=!1;function Pl(e,t,r){for(r=r.child;r!==null;)P$(e,t,r),r=r.sibling}function P$(e,t,r){if(rd&&typeof rd.onCommitFiberUnmount=="function")try{rd.onCommitFiberUnmount(MS,r)}catch{}switch(r.tag){case 5:cs||Lp(r,t);case 6:var n=Ui,i=tc;Ui=null,Pl(e,t,r),Ui=n,tc=i,Ui!==null&&(tc?(e=Ui,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Ui.removeChild(r.stateNode));break;case 18:Ui!==null&&(tc?(e=Ui,r=r.stateNode,e.nodeType===8?UT(e.parentNode,r):e.nodeType===1&&UT(e,r),w_(e)):UT(Ui,r.stateNode));break;case 4:n=Ui,i=tc,Ui=r.stateNode.containerInfo,tc=!0,Pl(e,t,r),Ui=n,tc=i;break;case 0:case 11:case 14:case 15:if(!cs&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){i=n=n.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&sO(r,t,o),i=i.next}while(i!==n)}Pl(e,t,r);break;case 1:if(!cs&&(Lp(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(a){Mn(r,t,a)}Pl(e,t,r);break;case 21:Pl(e,t,r);break;case 22:r.mode&1?(cs=(n=cs)||r.memoizedState!==null,Pl(e,t,r),cs=n):Pl(e,t,r);break;default:Pl(e,t,r)}}function dL(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new jee),t.forEach(function(n){var i=Kee.bind(null,e,n);r.has(n)||(r.add(n),n.then(i,i))})}}function Va(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var i=r[n];try{var s=e,o=t,a=o;e:for(;a!==null;){switch(a.tag){case 5:Ui=a.stateNode,tc=!1;break e;case 3:Ui=a.stateNode.containerInfo,tc=!0;break e;case 4:Ui=a.stateNode.containerInfo,tc=!0;break e}a=a.return}if(Ui===null)throw Error(De(160));P$(s,o,i),Ui=null,tc=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(d){Mn(i,t,d)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)k$(t,e),t=t.sibling}function k$(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Va(t,e),Ac(e),n&4){try{Jg(3,e,e.return),zS(3,e)}catch(g){Mn(e,e.return,g)}try{Jg(5,e,e.return)}catch(g){Mn(e,e.return,g)}}break;case 1:Va(t,e),Ac(e),n&512&&r!==null&&Lp(r,r.return);break;case 5:if(Va(t,e),Ac(e),n&512&&r!==null&&Lp(r,r.return),e.flags&32){var i=e.stateNode;try{v_(i,"")}catch(g){Mn(e,e.return,g)}}if(n&4&&(i=e.stateNode,i!=null)){var s=e.memoizedProps,o=r!==null?r.memoizedProps:s,a=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&eV(i,s),PI(a,o);var d=PI(a,s);for(o=0;o<c.length;o+=2){var l=c[o],u=c[o+1];l==="style"?sV(i,u):l==="dangerouslySetInnerHTML"?nV(i,u):l==="children"?v_(i,u):HN(i,l,u,d)}switch(a){case"input":CI(i,s);break;case"textarea":tV(i,s);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var p=s.value;p!=null?Xp(i,!!s.multiple,p,!1):h!==!!s.multiple&&(s.defaultValue!=null?Xp(i,!!s.multiple,s.defaultValue,!0):Xp(i,!!s.multiple,s.multiple?[]:"",!1))}i[I_]=s}catch(g){Mn(e,e.return,g)}}break;case 6:if(Va(t,e),Ac(e),n&4){if(e.stateNode===null)throw Error(De(162));i=e.stateNode,s=e.memoizedProps;try{i.nodeValue=s}catch(g){Mn(e,e.return,g)}}break;case 3:if(Va(t,e),Ac(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{w_(t.containerInfo)}catch(g){Mn(e,e.return,g)}break;case 4:Va(t,e),Ac(e);break;case 13:Va(t,e),Ac(e),i=e.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(SD=Yn())),n&4&&dL(e);break;case 22:if(l=r!==null&&r.memoizedState!==null,e.mode&1?(cs=(d=cs)||l,Va(t,e),cs=d):Va(t,e),Ac(e),n&8192){if(d=e.memoizedState!==null,(e.stateNode.isHidden=d)&&!l&&e.mode&1)for(et=e,l=e.child;l!==null;){for(u=et=l;et!==null;){switch(h=et,p=h.child,h.tag){case 0:case 11:case 14:case 15:Jg(4,h,h.return);break;case 1:Lp(h,h.return);var _=h.stateNode;if(typeof _.componentWillUnmount=="function"){n=h,r=h.return;try{t=n,_.props=t.memoizedProps,_.state=t.memoizedState,_.componentWillUnmount()}catch(g){Mn(n,r,g)}}break;case 5:Lp(h,h.return);break;case 22:if(h.memoizedState!==null){uL(u);continue}}p!==null?(p.return=h,et=p):uL(u)}l=l.sibling}e:for(l=null,u=e;;){if(u.tag===5){if(l===null){l=u;try{i=u.stateNode,d?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=u.stateNode,c=u.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=iV("display",o))}catch(g){Mn(e,e.return,g)}}}else if(u.tag===6){if(l===null)try{u.stateNode.nodeValue=d?"":u.memoizedProps}catch(g){Mn(e,e.return,g)}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===e)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===e)break e;for(;u.sibling===null;){if(u.return===null||u.return===e)break e;l===u&&(l=null),u=u.return}l===u&&(l=null),u.sibling.return=u.return,u=u.sibling}}break;case 19:Va(t,e),Ac(e),n&4&&dL(e);break;case 21:break;default:Va(t,e),Ac(e)}}function Ac(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(D$(r)){var n=r;break e}r=r.return}throw Error(De(160))}switch(n.tag){case 5:var i=n.stateNode;n.flags&32&&(v_(i,""),n.flags&=-33);var s=cL(e);cO(e,s,i);break;case 3:case 4:var o=n.stateNode.containerInfo,a=cL(e);aO(e,a,o);break;default:throw Error(De(161))}}catch(c){Mn(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Bee(e,t,r){et=e,L$(e)}function L$(e,t,r){for(var n=(e.mode&1)!==0;et!==null;){var i=et,s=i.child;if(i.tag===22&&n){var o=i.memoizedState!==null||Iv;if(!o){var a=i.alternate,c=a!==null&&a.memoizedState!==null||cs;a=Iv;var d=cs;if(Iv=o,(cs=c)&&!d)for(et=i;et!==null;)o=et,c=o.child,o.tag===22&&o.memoizedState!==null?hL(i):c!==null?(c.return=o,et=c):hL(i);for(;s!==null;)et=s,L$(s),s=s.sibling;et=i,Iv=a,cs=d}lL(e)}else i.subtreeFlags&8772&&s!==null?(s.return=i,et=s):lL(e)}}function lL(e){for(;et!==null;){var t=et;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:cs||zS(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!cs)if(r===null)n.componentDidMount();else{var i=t.elementType===t.type?r.memoizedProps:Qa(t.type,r.memoizedProps);n.componentDidUpdate(i,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;s!==null&&qk(t,s,n);break;case 3:var o=t.updateQueue;if(o!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}qk(t,o,r)}break;case 5:var a=t.stateNode;if(r===null&&t.flags&4){r=a;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&r.focus();break;case"img":c.src&&(r.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var d=t.alternate;if(d!==null){var l=d.memoizedState;if(l!==null){var u=l.dehydrated;u!==null&&w_(u)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(De(163))}cs||t.flags&512&&oO(t)}catch(h){Mn(t,t.return,h)}}if(t===e){et=null;break}if(r=t.sibling,r!==null){r.return=t.return,et=r;break}et=t.return}}function uL(e){for(;et!==null;){var t=et;if(t===e){et=null;break}var r=t.sibling;if(r!==null){r.return=t.return,et=r;break}et=t.return}}function hL(e){for(;et!==null;){var t=et;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{zS(4,t)}catch(c){Mn(t,r,c)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var i=t.return;try{n.componentDidMount()}catch(c){Mn(t,i,c)}}var s=t.return;try{oO(t)}catch(c){Mn(t,s,c)}break;case 5:var o=t.return;try{oO(t)}catch(c){Mn(t,o,c)}}}catch(c){Mn(t,t.return,c)}if(t===e){et=null;break}var a=t.sibling;if(a!==null){a.return=t.return,et=a;break}et=t.return}}var Vee=Math.ceil,m1=Al.ReactCurrentDispatcher,yD=Al.ReactCurrentOwner,Na=Al.ReactCurrentBatchConfig,Ar=0,Oi=null,ti=null,Vi=0,Ao=0,xp=Gu(0),pi=0,L_=null,lf=0,WS=0,bD=0,Xg=null,Ys=null,SD=0,Rm=1/0,tl=null,g1=!1,dO=null,wu=null,Ov=!1,lu=null,_1=0,Qg=0,lO=null,Qy=-1,Zy=0;function As(){return Ar&6?Yn():Qy!==-1?Qy:Qy=Yn()}function Tu(e){return e.mode&1?Ar&2&&Vi!==0?Vi&-Vi:Tee.transition!==null?(Zy===0&&(Zy=_V()),Zy):(e=Gr,e!==0||(e=window.event,e=e===void 0?16:TV(e.type)),e):1}function fc(e,t,r,n){if(50<Qg)throw Qg=0,lO=null,Error(De(185));PE(e,r,n),(!(Ar&2)||e!==Oi)&&(e===Oi&&(!(Ar&2)&&(WS|=r),pi===4&&tu(e,Vi)),ao(e,n),r===1&&Ar===0&&!(t.mode&1)&&(Rm=Yn()+500,VS&&qu()))}function ao(e,t){var r=e.callbackNode;TZ(e,t);var n=e1(e,e===Oi?Vi:0);if(n===0)r!==null&&bk(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&bk(r),t===1)e.tag===0?wee(fL.bind(null,e)):HV(fL.bind(null,e)),vee(function(){!(Ar&6)&&qu()}),r=null;else{switch(EV(n)){case 1:r=KN;break;case 4:r=mV;break;case 16:r=Zb;break;case 536870912:r=gV;break;default:r=Zb}r=$$(r,x$.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function x$(e,t){if(Qy=-1,Zy=0,Ar&6)throw Error(De(327));var r=e.callbackNode;if(rm()&&e.callbackNode!==r)return null;var n=e1(e,e===Oi?Vi:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=E1(e,n);else{t=n;var i=Ar;Ar|=2;var s=U$();(Oi!==e||Vi!==t)&&(tl=null,Rm=Yn()+500,Yh(e,t));do try{zee();break}catch(a){M$(e,a)}while(!0);aD(),m1.current=s,Ar=i,ti!==null?t=0:(Oi=null,Vi=0,t=pi)}if(t!==0){if(t===2&&(i=UI(e),i!==0&&(n=i,t=uO(e,i))),t===1)throw r=L_,Yh(e,0),tu(e,n),ao(e,Yn()),r;if(t===6)tu(e,n);else{if(i=e.current.alternate,!(n&30)&&!$ee(i)&&(t=E1(e,n),t===2&&(s=UI(e),s!==0&&(n=s,t=uO(e,s))),t===1))throw r=L_,Yh(e,0),tu(e,n),ao(e,Yn()),r;switch(e.finishedWork=i,e.finishedLanes=n,t){case 0:case 1:throw Error(De(345));case 2:bh(e,Ys,tl);break;case 3:if(tu(e,n),(n&130023424)===n&&(t=SD+500-Yn(),10<t)){if(e1(e,0)!==0)break;if(i=e.suspendedLanes,(i&n)!==n){As(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=WI(bh.bind(null,e,Ys,tl),t);break}bh(e,Ys,tl);break;case 4:if(tu(e,n),(n&4194240)===n)break;for(t=e.eventTimes,i=-1;0<n;){var o=31-hc(n);s=1<<o,o=t[o],o>i&&(i=o),n&=~s}if(n=i,n=Yn()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Vee(n/1960))-n,10<n){e.timeoutHandle=WI(bh.bind(null,e,Ys,tl),n);break}bh(e,Ys,tl);break;case 5:bh(e,Ys,tl);break;default:throw Error(De(329))}}}return ao(e,Yn()),e.callbackNode===r?x$.bind(null,e):null}function uO(e,t){var r=Xg;return e.current.memoizedState.isDehydrated&&(Yh(e,t).flags|=256),e=E1(e,t),e!==2&&(t=Ys,Ys=r,t!==null&&hO(t)),e}function hO(e){Ys===null?Ys=e:Ys.push.apply(Ys,e)}function $ee(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var i=r[n],s=i.getSnapshot;i=i.value;try{if(!_c(s(),i))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function tu(e,t){for(t&=~bD,t&=~WS,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-hc(t),n=1<<r;e[r]=-1,t&=~n}}function fL(e){if(Ar&6)throw Error(De(327));rm();var t=e1(e,0);if(!(t&1))return ao(e,Yn()),null;var r=E1(e,t);if(e.tag!==0&&r===2){var n=UI(e);n!==0&&(t=n,r=uO(e,n))}if(r===1)throw r=L_,Yh(e,0),tu(e,t),ao(e,Yn()),r;if(r===6)throw Error(De(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,bh(e,Ys,tl),ao(e,Yn()),null}function wD(e,t){var r=Ar;Ar|=1;try{return e(t)}finally{Ar=r,Ar===0&&(Rm=Yn()+500,VS&&qu())}}function uf(e){lu!==null&&lu.tag===0&&!(Ar&6)&&rm();var t=Ar;Ar|=1;var r=Na.transition,n=Gr;try{if(Na.transition=null,Gr=1,e)return e()}finally{Gr=n,Na.transition=r,Ar=t,!(Ar&6)&&qu()}}function TD(){Ao=xp.current,mn(xp)}function Yh(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,Eee(r)),ti!==null)for(r=ti.return;r!==null;){var n=r;switch(iD(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&s1();break;case 3:wm(),mn(so),mn(ls),fD();break;case 5:hD(n);break;case 4:wm();break;case 13:mn(Tn);break;case 19:mn(Tn);break;case 10:cD(n.type._context);break;case 22:case 23:TD()}r=r.return}if(Oi=e,ti=e=Ru(e.current,null),Vi=Ao=t,pi=0,L_=null,bD=WS=lf=0,Ys=Xg=null,Lh!==null){for(t=0;t<Lh.length;t++)if(r=Lh[t],n=r.interleaved,n!==null){r.interleaved=null;var i=n.next,s=r.pending;if(s!==null){var o=s.next;s.next=i,n.next=o}r.pending=n}Lh=null}return e}function M$(e,t){do{var r=ti;try{if(aD(),Yy.current=p1,f1){for(var n=Cn.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}f1=!1}if(df=0,Ti=hi=Cn=null,Yg=!1,D_=0,yD.current=null,r===null||r.return===null){pi=1,L_=t,ti=null;break}e:{var s=e,o=r.return,a=r,c=t;if(t=Vi,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,l=a,u=l.tag;if(!(l.mode&1)&&(u===0||u===11||u===15)){var h=l.alternate;h?(l.updateQueue=h.updateQueue,l.memoizedState=h.memoizedState,l.lanes=h.lanes):(l.updateQueue=null,l.memoizedState=null)}var p=eL(o);if(p!==null){p.flags&=-257,tL(p,o,a,s,t),p.mode&1&&Zk(s,d,t),t=p,c=d;var _=t.updateQueue;if(_===null){var g=new Set;g.add(c),t.updateQueue=g}else _.add(c);break e}else{if(!(t&1)){Zk(s,d,t),RD();break e}c=Error(De(426))}}else if(En&&a.mode&1){var E=eL(o);if(E!==null){!(E.flags&65536)&&(E.flags|=256),tL(E,o,a,s,t),sD(Tm(c,a));break e}}s=c=Tm(c,a),pi!==4&&(pi=2),Xg===null?Xg=[s]:Xg.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t;var b=v$(s,c,t);Gk(s,b);break e;case 1:a=c;var v=s.type,I=s.stateNode;if(!(s.flags&128)&&(typeof v.getDerivedStateFromError=="function"||I!==null&&typeof I.componentDidCatch=="function"&&(wu===null||!wu.has(I)))){s.flags|=65536,t&=-t,s.lanes|=t;var N=y$(s,a,t);Gk(s,N);break e}}s=s.return}while(s!==null)}F$(r)}catch(L){t=L,ti===r&&r!==null&&(ti=r=r.return);continue}break}while(!0)}function U$(){var e=m1.current;return m1.current=p1,e===null?p1:e}function RD(){(pi===0||pi===3||pi===2)&&(pi=4),Oi===null||!(lf&268435455)&&!(WS&268435455)||tu(Oi,Vi)}function E1(e,t){var r=Ar;Ar|=2;var n=U$();(Oi!==e||Vi!==t)&&(tl=null,Yh(e,t));do try{Hee();break}catch(i){M$(e,i)}while(!0);if(aD(),Ar=r,m1.current=n,ti!==null)throw Error(De(261));return Oi=null,Vi=0,pi}function Hee(){for(;ti!==null;)j$(ti)}function zee(){for(;ti!==null&&!mZ();)j$(ti)}function j$(e){var t=V$(e.alternate,e,Ao);e.memoizedProps=e.pendingProps,t===null?F$(e):ti=t,yD.current=null}function F$(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=Uee(r,t),r!==null){r.flags&=32767,ti=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{pi=6,ti=null;return}}else if(r=Mee(r,t,Ao),r!==null){ti=r;return}if(t=t.sibling,t!==null){ti=t;return}ti=t=e}while(t!==null);pi===0&&(pi=5)}function bh(e,t,r){var n=Gr,i=Na.transition;try{Na.transition=null,Gr=1,Wee(e,t,r,n)}finally{Na.transition=i,Gr=n}return null}function Wee(e,t,r,n){do rm();while(lu!==null);if(Ar&6)throw Error(De(327));r=e.finishedWork;var i=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(De(177));e.callbackNode=null,e.callbackPriority=0;var s=r.lanes|r.childLanes;if(RZ(e,s),e===Oi&&(ti=Oi=null,Vi=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||Ov||(Ov=!0,$$(Zb,function(){return rm(),null})),s=(r.flags&15990)!==0,r.subtreeFlags&15990||s){s=Na.transition,Na.transition=null;var o=Gr;Gr=1;var a=Ar;Ar|=4,yD.current=null,Fee(e,r),k$(r,e),uee(HI),t1=!!$I,HI=$I=null,e.current=r,Bee(r),gZ(),Ar=a,Gr=o,Na.transition=s}else e.current=r;if(Ov&&(Ov=!1,lu=e,_1=i),s=e.pendingLanes,s===0&&(wu=null),vZ(r.stateNode),ao(e,Yn()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)i=t[r],n(i.value,{componentStack:i.stack,digest:i.digest});if(g1)throw g1=!1,e=dO,dO=null,e;return _1&1&&e.tag!==0&&rm(),s=e.pendingLanes,s&1?e===lO?Qg++:(Qg=0,lO=e):Qg=0,qu(),null}function rm(){if(lu!==null){var e=EV(_1),t=Na.transition,r=Gr;try{if(Na.transition=null,Gr=16>e?16:e,lu===null)var n=!1;else{if(e=lu,lu=null,_1=0,Ar&6)throw Error(De(331));var i=Ar;for(Ar|=4,et=e.current;et!==null;){var s=et,o=s.child;if(et.flags&16){var a=s.deletions;if(a!==null){for(var c=0;c<a.length;c++){var d=a[c];for(et=d;et!==null;){var l=et;switch(l.tag){case 0:case 11:case 15:Jg(8,l,s)}var u=l.child;if(u!==null)u.return=l,et=u;else for(;et!==null;){l=et;var h=l.sibling,p=l.return;if(N$(l),l===d){et=null;break}if(h!==null){h.return=p,et=h;break}et=p}}}var _=s.alternate;if(_!==null){var g=_.child;if(g!==null){_.child=null;do{var E=g.sibling;g.sibling=null,g=E}while(g!==null)}}et=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,et=o;else e:for(;et!==null;){if(s=et,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Jg(9,s,s.return)}var b=s.sibling;if(b!==null){b.return=s.return,et=b;break e}et=s.return}}var v=e.current;for(et=v;et!==null;){o=et;var I=o.child;if(o.subtreeFlags&2064&&I!==null)I.return=o,et=I;else e:for(o=v;et!==null;){if(a=et,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:zS(9,a)}}catch(L){Mn(a,a.return,L)}if(a===o){et=null;break e}var N=a.sibling;if(N!==null){N.return=a.return,et=N;break e}et=a.return}}if(Ar=i,qu(),rd&&typeof rd.onPostCommitFiberRoot=="function")try{rd.onPostCommitFiberRoot(MS,e)}catch{}n=!0}return n}finally{Gr=r,Na.transition=t}}return!1}function pL(e,t,r){t=Tm(r,t),t=v$(e,t,1),e=Su(e,t,1),t=As(),e!==null&&(PE(e,1,t),ao(e,t))}function Mn(e,t,r){if(e.tag===3)pL(e,e,r);else for(;t!==null;){if(t.tag===3){pL(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(wu===null||!wu.has(n))){e=Tm(r,e),e=y$(t,e,1),t=Su(t,e,1),e=As(),t!==null&&(PE(t,1,e),ao(t,e));break}}t=t.return}}function Gee(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=As(),e.pingedLanes|=e.suspendedLanes&r,Oi===e&&(Vi&r)===r&&(pi===4||pi===3&&(Vi&130023424)===Vi&&500>Yn()-SD?Yh(e,0):bD|=r),ao(e,t)}function B$(e,t){t===0&&(e.mode&1?(t=vv,vv<<=1,!(vv&130023424)&&(vv=4194304)):t=1);var r=As();e=yl(e,t),e!==null&&(PE(e,t,r),ao(e,r))}function qee(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),B$(e,r)}function Kee(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,i=e.memoizedState;i!==null&&(r=i.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(De(314))}n!==null&&n.delete(t),B$(e,r)}var V$;V$=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||so.current)to=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return to=!1,xee(e,t,r);to=!!(e.flags&131072)}else to=!1,En&&t.flags&1048576&&zV(t,c1,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;Xy(e,t),e=t.pendingProps;var i=ym(t,ls.current);tm(t,r),i=mD(null,t,n,e,i,r);var s=gD();return t.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,oo(n)?(s=!0,o1(t)):s=!1,t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,lD(t),i.updater=$S,t.stateNode=i,i._reactInternals=t,QI(t,n,e,r),t=tO(null,t,n,!0,s,r)):(t.tag=0,En&&s&&nD(t),vs(null,t,i,r),t=t.child),t;case 16:n=t.elementType;e:{switch(Xy(e,t),e=t.pendingProps,i=n._init,n=i(n._payload),t.type=n,i=t.tag=Jee(n),e=Qa(n,e),i){case 0:t=eO(null,t,n,e,r);break e;case 1:t=iL(null,t,n,e,r);break e;case 11:t=rL(null,t,n,e,r);break e;case 14:t=nL(null,t,n,Qa(n.type,e),r);break e}throw Error(De(306,n,""))}return t;case 0:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:Qa(n,i),eO(e,t,n,i,r);case 1:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:Qa(n,i),iL(e,t,n,i,r);case 3:e:{if(T$(t),e===null)throw Error(De(387));n=t.pendingProps,s=t.memoizedState,i=s.element,KV(e,t),u1(t,n,null,r);var o=t.memoizedState;if(n=o.element,s.isDehydrated)if(s={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=s,t.memoizedState=s,t.flags&256){i=Tm(Error(De(423)),t),t=sL(e,t,n,r,i);break e}else if(n!==i){i=Tm(Error(De(424)),t),t=sL(e,t,n,r,i);break e}else for(No=bu(t.stateNode.containerInfo.firstChild),Mo=t,En=!0,oc=null,r=QV(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(bm(),n===i){t=bl(e,t,r);break e}vs(e,t,n,r)}t=t.child}return t;case 5:return ZV(t),e===null&&YI(t),n=t.type,i=t.pendingProps,s=e!==null?e.memoizedProps:null,o=i.children,zI(n,i)?o=null:s!==null&&zI(n,s)&&(t.flags|=32),w$(e,t),vs(e,t,o,r),t.child;case 6:return e===null&&YI(t),null;case 13:return R$(e,t,r);case 4:return uD(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=Sm(t,null,n,r):vs(e,t,n,r),t.child;case 11:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:Qa(n,i),rL(e,t,n,i,r);case 7:return vs(e,t,t.pendingProps,r),t.child;case 8:return vs(e,t,t.pendingProps.children,r),t.child;case 12:return vs(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,i=t.pendingProps,s=t.memoizedProps,o=i.value,sn(d1,n._currentValue),n._currentValue=o,s!==null)if(_c(s.value,o)){if(s.children===i.children&&!so.current){t=bl(e,t,r);break e}}else for(s=t.child,s!==null&&(s.return=t);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var c=a.firstContext;c!==null;){if(c.context===n){if(s.tag===1){c=ml(-1,r&-r),c.tag=2;var d=s.updateQueue;if(d!==null){d=d.shared;var l=d.pending;l===null?c.next=c:(c.next=l.next,l.next=c),d.pending=c}}s.lanes|=r,c=s.alternate,c!==null&&(c.lanes|=r),JI(s.return,r,t),a.lanes|=r;break}c=c.next}}else if(s.tag===10)o=s.type===t.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(De(341));o.lanes|=r,a=o.alternate,a!==null&&(a.lanes|=r),JI(o,r,t),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===t){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}vs(e,t,i.children,r),t=t.child}return t;case 9:return i=t.type,n=t.pendingProps.children,tm(t,r),i=Pa(i),n=n(i),t.flags|=1,vs(e,t,n,r),t.child;case 14:return n=t.type,i=Qa(n,t.pendingProps),i=Qa(n.type,i),nL(e,t,n,i,r);case 15:return b$(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:Qa(n,i),Xy(e,t),t.tag=1,oo(n)?(e=!0,o1(t)):e=!1,tm(t,r),JV(t,n,i),QI(t,n,i,r),tO(null,t,n,!0,e,r);case 19:return A$(e,t,r);case 22:return S$(e,t,r)}throw Error(De(156,t.tag))};function $$(e,t){return pV(e,t)}function Yee(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ia(e,t,r,n){return new Yee(e,t,r,n)}function AD(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Jee(e){if(typeof e=="function")return AD(e)?1:0;if(e!=null){if(e=e.$$typeof,e===WN)return 11;if(e===GN)return 14}return 2}function Ru(e,t){var r=e.alternate;return r===null?(r=Ia(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function eb(e,t,r,n,i,s){var o=2;if(n=e,typeof e=="function")AD(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case Rp:return Jh(r.children,i,s,t);case zN:o=8,i|=8;break;case SI:return e=Ia(12,r,t,i|2),e.elementType=SI,e.lanes=s,e;case wI:return e=Ia(13,r,t,i),e.elementType=wI,e.lanes=s,e;case TI:return e=Ia(19,r,t,i),e.elementType=TI,e.lanes=s,e;case XB:return GS(r,i,s,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case YB:o=10;break e;case JB:o=9;break e;case WN:o=11;break e;case GN:o=14;break e;case ql:o=16,n=null;break e}throw Error(De(130,e==null?e:typeof e,""))}return t=Ia(o,r,t,i),t.elementType=e,t.type=n,t.lanes=s,t}function Jh(e,t,r,n){return e=Ia(7,e,n,t),e.lanes=r,e}function GS(e,t,r,n){return e=Ia(22,e,n,t),e.elementType=XB,e.lanes=r,e.stateNode={isHidden:!1},e}function WT(e,t,r){return e=Ia(6,e,null,t),e.lanes=r,e}function GT(e,t,r){return t=Ia(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Xee(e,t,r,n,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=AT(0),this.expirationTimes=AT(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=AT(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function CD(e,t,r,n,i,s,o,a,c){return e=new Xee(e,t,r,a,c),t===1?(t=1,s===!0&&(t|=8)):t=0,s=Ia(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},lD(s),e}function Qee(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Tp,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function H$(e){if(!e)return xu;e=e._reactInternals;e:{if(Cf(e)!==e||e.tag!==1)throw Error(De(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(oo(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(De(171))}if(e.tag===1){var r=e.type;if(oo(r))return $V(e,r,t)}return t}function z$(e,t,r,n,i,s,o,a,c){return e=CD(r,n,!0,e,i,s,o,a,c),e.context=H$(null),r=e.current,n=As(),i=Tu(r),s=ml(n,i),s.callback=t??null,Su(r,s,i),e.current.lanes=i,PE(e,i,n),ao(e,n),e}function qS(e,t,r,n){var i=t.current,s=As(),o=Tu(i);return r=H$(r),t.context===null?t.context=r:t.pendingContext=r,t=ml(s,o),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=Su(i,t,o),e!==null&&(fc(e,i,o,s),Ky(e,i,o)),o}function v1(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function mL(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function ID(e,t){mL(e,t),(e=e.alternate)&&mL(e,t)}function Zee(){return null}var W$=typeof reportError=="function"?reportError:function(e){console.error(e)};function OD(e){this._internalRoot=e}KS.prototype.render=OD.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(De(409));qS(e,t,null,null)};KS.prototype.unmount=OD.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;uf(function(){qS(null,e,null,null)}),t[vl]=null}};function KS(e){this._internalRoot=e}KS.prototype.unstable_scheduleHydration=function(e){if(e){var t=bV();e={blockedOn:null,target:e,priority:t};for(var r=0;r<eu.length&&t!==0&&t<eu[r].priority;r++);eu.splice(r,0,e),r===0&&wV(e)}};function ND(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function YS(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function gL(){}function ete(e,t,r,n,i){if(i){if(typeof n=="function"){var s=n;n=function(){var d=v1(o);s.call(d)}}var o=z$(t,n,e,0,null,!1,!1,"",gL);return e._reactRootContainer=o,e[vl]=o.current,A_(e.nodeType===8?e.parentNode:e),uf(),o}for(;i=e.lastChild;)e.removeChild(i);if(typeof n=="function"){var a=n;n=function(){var d=v1(c);a.call(d)}}var c=CD(e,0,!1,null,null,!1,!1,"",gL);return e._reactRootContainer=c,e[vl]=c.current,A_(e.nodeType===8?e.parentNode:e),uf(function(){qS(t,c,r,n)}),c}function JS(e,t,r,n,i){var s=r._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var c=v1(o);a.call(c)}}qS(t,o,e,i)}else o=ete(r,t,e,i,n);return v1(o)}vV=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=Rg(t.pendingLanes);r!==0&&(YN(t,r|1),ao(t,Yn()),!(Ar&6)&&(Rm=Yn()+500,qu()))}break;case 13:uf(function(){var n=yl(e,1);if(n!==null){var i=As();fc(n,e,1,i)}}),ID(e,1)}};JN=function(e){if(e.tag===13){var t=yl(e,134217728);if(t!==null){var r=As();fc(t,e,134217728,r)}ID(e,134217728)}};yV=function(e){if(e.tag===13){var t=Tu(e),r=yl(e,t);if(r!==null){var n=As();fc(r,e,t,n)}ID(e,t)}};bV=function(){return Gr};SV=function(e,t){var r=Gr;try{return Gr=e,t()}finally{Gr=r}};LI=function(e,t,r){switch(t){case"input":if(CI(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var i=BS(n);if(!i)throw Error(De(90));ZB(n),CI(n,i)}}}break;case"textarea":tV(e,r);break;case"select":t=r.value,t!=null&&Xp(e,!!r.multiple,t,!1)}};cV=wD;dV=uf;var tte={usingClientEntryPoint:!1,Events:[LE,Op,BS,oV,aV,wD]},G0={findFiberByHostInstance:kh,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},rte={bundleType:G0.bundleType,version:G0.version,rendererPackageName:G0.rendererPackageName,rendererConfig:G0.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Al.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=hV(e),e===null?null:e.stateNode},findFiberByHostInstance:G0.findFiberByHostInstance||Zee,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Nv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Nv.isDisabled&&Nv.supportsFiber)try{MS=Nv.inject(rte),rd=Nv}catch{}}Vo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tte;Vo.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ND(t))throw Error(De(200));return Qee(e,t,null,r)};Vo.createRoot=function(e,t){if(!ND(e))throw Error(De(299));var r=!1,n="",i=W$;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(i=t.onRecoverableError)),t=CD(e,1,!1,null,null,r,!1,n,i),e[vl]=t.current,A_(e.nodeType===8?e.parentNode:e),new OD(t)};Vo.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(De(188)):(e=Object.keys(e).join(","),Error(De(268,e)));return e=hV(t),e=e===null?null:e.stateNode,e};Vo.flushSync=function(e){return uf(e)};Vo.hydrate=function(e,t,r){if(!YS(t))throw Error(De(200));return JS(null,e,t,!0,r)};Vo.hydrateRoot=function(e,t,r){if(!ND(e))throw Error(De(405));var n=r!=null&&r.hydratedSources||null,i=!1,s="",o=W$;if(r!=null&&(r.unstable_strictMode===!0&&(i=!0),r.identifierPrefix!==void 0&&(s=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),t=z$(t,null,e,1,r??null,i,!1,s,o),e[vl]=t.current,A_(e),n)for(e=0;e<n.length;e++)r=n[e],i=r._getVersion,i=i(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,i]:t.mutableSourceEagerHydrationData.push(r,i);return new KS(t)};Vo.render=function(e,t,r){if(!YS(t))throw Error(De(200));return JS(null,e,t,!1,r)};Vo.unmountComponentAtNode=function(e){if(!YS(e))throw Error(De(40));return e._reactRootContainer?(uf(function(){JS(null,null,e,!1,function(){e._reactRootContainer=null,e[vl]=null})}),!0):!1};Vo.unstable_batchedUpdates=wD;Vo.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!YS(r))throw Error(De(200));if(e==null||e._reactInternals===void 0)throw Error(De(38));return JS(e,t,r,!1,n)};Vo.version="18.2.0-next-9e3b772b8-20220608";function G$(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(G$)}catch(e){console.error(e)}}G$(),zB.exports=Vo;var nte=zB.exports;/**
 * @remix-run/router v1.15.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function x_(){return x_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},x_.apply(this,arguments)}var uu;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(uu||(uu={}));const _L="popstate";function ite(e){e===void 0&&(e={});function t(n,i){let{pathname:s,search:o,hash:a}=n.location;return fO("",{pathname:s,search:o,hash:a},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function r(n,i){return typeof i=="string"?i:y1(i)}return ote(t,r,null,e)}function ni(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function q$(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function ste(){return Math.random().toString(36).substr(2,8)}function EL(e,t){return{usr:e.state,key:e.key,idx:t}}function fO(e,t,r,n){return r===void 0&&(r=null),x_({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Jm(t):t,{state:r,key:t&&t.key||n||ste()})}function y1(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Jm(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function ote(e,t,r,n){n===void 0&&(n={});let{window:i=document.defaultView,v5Compat:s=!1}=n,o=i.history,a=uu.Pop,c=null,d=l();d==null&&(d=0,o.replaceState(x_({},o.state,{idx:d}),""));function l(){return(o.state||{idx:null}).idx}function u(){a=uu.Pop;let E=l(),b=E==null?null:E-d;d=E,c&&c({action:a,location:g.location,delta:b})}function h(E,b){a=uu.Push;let v=fO(g.location,E,b);d=l()+1;let I=EL(v,d),N=g.createHref(v);try{o.pushState(I,"",N)}catch(L){if(L instanceof DOMException&&L.name==="DataCloneError")throw L;i.location.assign(N)}s&&c&&c({action:a,location:g.location,delta:1})}function p(E,b){a=uu.Replace;let v=fO(g.location,E,b);d=l();let I=EL(v,d),N=g.createHref(v);o.replaceState(I,"",N),s&&c&&c({action:a,location:g.location,delta:0})}function _(E){let b=i.location.origin!=="null"?i.location.origin:i.location.href,v=typeof E=="string"?E:y1(E);return v=v.replace(/ $/,"%20"),ni(b,"No window.location.(origin|href) available to create URL for href: "+v),new URL(v,b)}let g={get action(){return a},get location(){return e(i,o)},listen(E){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(_L,u),c=E,()=>{i.removeEventListener(_L,u),c=null}},createHref(E){return t(i,E)},createURL:_,encodeLocation(E){let b=_(E);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:h,replace:p,go(E){return o.go(E)}};return g}var vL;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(vL||(vL={}));function ate(e,t,r){r="/";let n=typeof t=="string"?Jm(t):t,i=DD(n.pathname||"/",r);if(i==null)return null;let s=K$(e);cte(s);let o=null;for(let a=0;o==null&&a<s.length;++a){let c=yte(i);o=_te(s[a],c)}return o}function K$(e,t,r,n){t=[],r===void 0&&(r=[]),n===void 0&&(n="");let i=(s,o,a)=>{let c={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};c.relativePath.startsWith("/")&&(ni(c.relativePath.startsWith(n),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(n.length));let d=Au([n,c.relativePath]),l=r.concat(c);s.children&&s.children.length>0&&(ni(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),K$(s.children,t,l,d)),!(s.path==null&&!s.index)&&t.push({path:d,score:mte(d,s.index),routesMeta:l})};return e.forEach((s,o)=>{var a;if(s.path===""||!((a=s.path)!=null&&a.includes("?")))i(s,o);else for(let c of Y$(s.path))i(s,o,c)}),t}function Y$(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,i=r.endsWith("?"),s=r.replace(/\?$/,"");if(n.length===0)return i?[s,""]:[s];let o=Y$(n.join("/")),a=[];return a.push(...o.map(c=>c===""?s:[s,c].join("/"))),i&&a.push(...o),a.map(c=>e.startsWith("/")&&c===""?"/":c)}function cte(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:gte(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const dte=/^:[\w-]+$/,lte=3,ute=2,hte=1,fte=10,pte=-2,yL=e=>e==="*";function mte(e,t){let r=e.split("/"),n=r.length;return r.some(yL)&&(n+=pte),t&&(n+=ute),r.filter(i=>!yL(i)).reduce((i,s)=>i+(dte.test(s)?lte:s===""?hte:fte),n)}function gte(e,t){return e.length===t.length&&e.slice(0,-1).every((n,i)=>n===t[i])?e[e.length-1]-t[t.length-1]:0}function _te(e,t){let{routesMeta:r}=e,n={},i="/",s=[];for(let o=0;o<r.length;++o){let a=r[o],c=o===r.length-1,d=i==="/"?t:t.slice(i.length)||"/",l=Ete({path:a.relativePath,caseSensitive:a.caseSensitive,end:c},d);if(!l)return null;Object.assign(n,l.params);let u=a.route;s.push({params:n,pathname:Au([i,l.pathname]),pathnameBase:Tte(Au([i,l.pathnameBase])),route:u}),l.pathnameBase!=="/"&&(i=Au([i,l.pathnameBase]))}return s}function Ete(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=vte(e.path,e.caseSensitive,e.end),i=t.match(r);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:n.reduce((d,l,u)=>{let{paramName:h,isOptional:p}=l;if(h==="*"){let g=a[u]||"";o=s.slice(0,s.length-g.length).replace(/(.)\/+$/,"$1")}const _=a[u];return p&&!_?d[h]=void 0:d[h]=(_||"").replace(/%2F/g,"/"),d},{}),pathname:s,pathnameBase:o,pattern:e}}function vte(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),q$(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,c)=>(n.push({paramName:a,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),i+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?i+="\\/*$":e!==""&&e!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,t?void 0:"i"),n]}function yte(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return q$(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function DD(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function bte(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:i=""}=typeof e=="string"?Jm(e):e;return{pathname:r?r.startsWith("/")?r:Ste(r,t):t,search:Rte(n),hash:Ate(i)}}function Ste(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(i=>{i===".."?r.length>1&&r.pop():i!=="."&&r.push(i)}),r.length>1?r.join("/"):"/"}function qT(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function wte(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function PD(e,t){let r=wte(e);return t?r.map((n,i)=>i===e.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function kD(e,t,r,n){n===void 0&&(n=!1);let i;typeof e=="string"?i=Jm(e):(i=x_({},e),ni(!i.pathname||!i.pathname.includes("?"),qT("?","pathname","search",i)),ni(!i.pathname||!i.pathname.includes("#"),qT("#","pathname","hash",i)),ni(!i.search||!i.search.includes("#"),qT("#","search","hash",i)));let s=e===""||i.pathname==="",o=s?"/":i.pathname,a;if(o==null)a=r;else{let u=t.length-1;if(!n&&o.startsWith("..")){let h=o.split("/");for(;h[0]==="..";)h.shift(),u-=1;i.pathname=h.join("/")}a=u>=0?t[u]:"/"}let c=bte(i,a),d=o&&o!=="/"&&o.endsWith("/"),l=(s||o===".")&&r.endsWith("/");return!c.pathname.endsWith("/")&&(d||l)&&(c.pathname+="/"),c}const Au=e=>e.join("/").replace(/\/\/+/g,"/"),Tte=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),Rte=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,Ate=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e,J$=["post","put","patch","delete"];new Set(J$);const Cte=["get",...J$];new Set(Cte);/**
 * React Router v6.22.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function M_(){return M_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},M_.apply(this,arguments)}const LD=me.createContext(null),Ku=me.createContext(null),XS=me.createContext(null),If=me.createContext({outlet:null,matches:[],isDataRoute:!1});function Ite(e,t){let{relative:r}=t===void 0?{}:t;Xm()||ni(!1);let{basename:n,navigator:i}=me.useContext(Ku),{hash:s,pathname:o,search:a}=Q$(e,{relative:r}),c=o;return n!=="/"&&(c=o==="/"?n:Au([n,o])),i.createHref({pathname:c,search:a,hash:s})}function Xm(){return me.useContext(XS)!=null}function Qm(){return Xm()||ni(!1),me.useContext(XS).location}function X$(e){me.useContext(Ku).static||me.useLayoutEffect(e)}function Ho(){let{isDataRoute:e}=me.useContext(If);return e?Ute():Ote()}function Ote(){Xm()||ni(!1);let e=me.useContext(LD),{basename:t,future:r,navigator:n}=me.useContext(Ku),{matches:i}=me.useContext(If),{pathname:s}=Qm(),o=JSON.stringify(PD(i,r.v7_relativeSplatPath)),a=me.useRef(!1);return X$(()=>{a.current=!0}),me.useCallback(function(d,l){if(l===void 0&&(l={}),!a.current)return;if(typeof d=="number"){n.go(d);return}let u=kD(d,JSON.parse(o),s,l.relative==="path");e==null&&t!=="/"&&(u.pathname=u.pathname==="/"?t:Au([t,u.pathname])),(l.replace?n.replace:n.push)(u,l.state,l)},[t,n,o,s,e])}function Q$(e,t){let{relative:r}=t===void 0?{}:t,{future:n}=me.useContext(Ku),{matches:i}=me.useContext(If),{pathname:s}=Qm(),o=JSON.stringify(PD(i,n.v7_relativeSplatPath));return me.useMemo(()=>kD(e,JSON.parse(o),s,r==="path"),[e,o,s,r])}function Nte(e,t){return Dte(e,t)}function Dte(e,t,r,n){Xm()||ni(!1);let{navigator:i}=me.useContext(Ku),{matches:s}=me.useContext(If),o=s[s.length-1],a=o?o.params:{};o&&o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let d=Qm(),l;if(t){var u;let E=typeof t=="string"?Jm(t):t;c==="/"||(u=E.pathname)!=null&&u.startsWith(c)||ni(!1),l=E}else l=d;let h=l.pathname||"/",p=h;if(c!=="/"){let E=c.replace(/^\//,"").split("/");p="/"+h.replace(/^\//,"").split("/").slice(E.length).join("/")}let _=ate(e,{pathname:p}),g=kte(_&&_.map(E=>Object.assign({},E,{params:Object.assign({},a,E.params),pathname:Au([c,i.encodeLocation?i.encodeLocation(E.pathname).pathname:E.pathname]),pathnameBase:E.pathnameBase==="/"?c:Au([c,i.encodeLocation?i.encodeLocation(E.pathnameBase).pathname:E.pathnameBase])})),s,r);return t&&g?me.createElement(XS.Provider,{value:{location:M_({pathname:"/",search:"",hash:"",state:null,key:"default"},l),navigationType:uu.Pop}},g):g}function Pte(e){let{routeContext:t,match:r,children:n}=e,i=me.useContext(LD);return i&&i.static&&i.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=r.route.id),me.createElement(If.Provider,{value:t},n)}function kte(e,t,r,n){var i;if(t===void 0&&(t=[]),r=null,e==null){var s;if((s=r)!=null&&s.errors)e=r.matches;else return null}let o=e,a=(i=r)==null?void 0:i.errors;if(a!=null){let c=o.findIndex(d=>d.route.id&&(a==null?void 0:a[d.route.id]));c>=0||ni(!1),o=o.slice(0,Math.min(o.length,c+1))}return o.reduceRight((c,d,l)=>{let u=t.concat(o.slice(0,l+1));return(()=>{let p;return d.route.Component?p=me.createElement(d.route.Component,null):d.route.element?p=d.route.element:p=c,me.createElement(Pte,{match:d,routeContext:{outlet:c,matches:u,isDataRoute:r!=null},children:p})})()},null)}var Z$=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(Z$||{}),eH=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(eH||{});function Lte(e){let t=me.useContext(LD);return t||ni(!1),t}function xte(e){let t=me.useContext(If);return t||ni(!1),t}function Mte(e){let t=xte(),r=t.matches[t.matches.length-1];return r.route.id||ni(!1),r.route.id}function Ute(){let{router:e}=Lte(Z$.UseNavigateStable),t=Mte(eH.UseNavigateStable),r=me.useRef(!1);return X$(()=>{r.current=!0}),me.useCallback(function(i,s){s===void 0&&(s={}),r.current&&(typeof i=="number"?e.navigate(i):e.navigate(i,M_({fromRouteId:t},s)))},[e,t])}function Xi(e){let{to:t,replace:r,state:n,relative:i}=e;Xm()||ni(!1);let{future:s,static:o}=me.useContext(Ku),{matches:a}=me.useContext(If),{pathname:c}=Qm(),d=Ho(),l=kD(t,PD(a,s.v7_relativeSplatPath),c,i==="path"),u=JSON.stringify(l);return me.useEffect(()=>d(JSON.parse(u),{replace:r,state:n,relative:i}),[d,u,i,r,n]),null}function Hn(e){ni(!1)}function jte(e){let{basename:t="/",children:r=null,location:n,navigationType:i=uu.Pop,navigator:s,static:o=!1,future:a}=e;Xm()&&ni(!1);let c=t.replace(/^\/*/,"/"),d=me.useMemo(()=>({basename:c,navigator:s,static:o,future:M_({v7_relativeSplatPath:!1},a)}),[c,a,s,o]);typeof n=="string"&&(n=Jm(n));let{pathname:l="/",search:u="",hash:h="",state:p=null,key:_="default"}=n,g=me.useMemo(()=>{let E=DD(l,c);return E==null?null:{location:{pathname:E,search:u,hash:h,state:p,key:_},navigationType:i}},[c,l,u,h,p,_,i]);return g==null?null:me.createElement(Ku.Provider,{value:d},me.createElement(XS.Provider,{children:r,value:g}))}function Fte(e){let{children:t,location:r}=e;return Nte(pO(t),r)}new Promise(()=>{});function pO(e,t){t===void 0&&(t=[]);let r=[];return me.Children.forEach(e,(n,i)=>{if(!me.isValidElement(n))return;let s=[...t,i];if(n.type===me.Fragment){r.push.apply(r,pO(n.props.children,s));return}n.type!==Hn&&ni(!1),!n.props.index||!n.props.children||ni(!1);let o={id:n.props.id||s.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(o.children=pO(n.props.children,s)),r.push(o)}),r}/**
 * React Router DOM v6.22.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function mO(){return mO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},mO.apply(this,arguments)}function Bte(e,t){if(e==null)return{};var r={},n=Object.keys(e),i,s;for(s=0;s<n.length;s++)i=n[s],!(t.indexOf(i)>=0)&&(r[i]=e[i]);return r}function Vte(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function $te(e,t){return e.button===0&&(!t||t==="_self")&&!Vte(e)}const Hte=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],zte="6";try{window.__reactRouterVersion=zte}catch{}const Wte="startTransition",bL=qQ[Wte];function Gte(e){let{basename:t,children:r,future:n,window:i}=e,s=me.useRef();s.current==null&&(s.current=ite({window:i,v5Compat:!0}));let o=s.current,[a,c]=me.useState({action:o.action,location:o.location}),{v7_startTransition:d}=n||{},l=me.useCallback(u=>{d&&bL?bL(()=>c(u)):c(u)},[c,d]);return me.useLayoutEffect(()=>o.listen(l),[o,l]),me.createElement(jte,{basename:t,children:r,location:a.location,navigationType:a.action,navigator:o,future:n})}const qte=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Kte=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,tr=me.forwardRef(function(t,r){let{onClick:n,relative:i,reloadDocument:s,replace:o,state:a,target:c,to:d,preventScrollReset:l,unstable_viewTransition:u}=t,h=Bte(t,Hte),{basename:p}=me.useContext(Ku),_,g=!1;if(typeof d=="string"&&Kte.test(d)&&(_=d,qte))try{let I=new URL(window.location.href),N=d.startsWith("//")?new URL(I.protocol+d):new URL(d),L=DD(N.pathname,p);N.origin===I.origin&&L!=null?d=L+N.search+N.hash:g=!0}catch{}let E=Ite(d,{relative:i}),b=Yte(d,{replace:o,state:a,target:c,preventScrollReset:l,relative:i,unstable_viewTransition:u});function v(I){n&&n(I),I.defaultPrevented||b(I)}return me.createElement("a",mO({},h,{href:_||E,onClick:g||s?n:v,ref:r,target:c}))});var SL;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(SL||(SL={}));var wL;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(wL||(wL={}));function Yte(e,t){let{target:r,replace:n,state:i,preventScrollReset:s,relative:o,unstable_viewTransition:a}=t===void 0?{}:t,c=Ho(),d=Qm(),l=Q$(e,{relative:o});return me.useCallback(u=>{if($te(u,r)){u.preventDefault();let h=n!==void 0?n:y1(d)===y1(l);c(e,{replace:h,state:i,preventScrollReset:s,relative:o,unstable_viewTransition:a})}},[d,c,l,n,i,r,e,s,o,a])}var gO={},TL=nte;gO.createRoot=TL.createRoot,gO.hydrateRoot=TL.hydrateRoot;function Jte(){return O.jsx(O.Fragment,{children:O.jsx(tr,{to:"/login",style:{textDecoration:"none"},children:O.jsx("div",{style:{display:"flex",marginBottom:20,justifyContent:"center"},children:O.jsx("h5",{style:{color:"white",paddingLeft:150,paddingRight:150},children:"Login Instead"})})})})}var ME=e=>e.type==="checkbox",Mp=e=>e instanceof Date,ys=e=>e==null;const tH=e=>typeof e=="object";var ii=e=>!ys(e)&&!Array.isArray(e)&&tH(e)&&!Mp(e),Xte=e=>ii(e)&&e.target?ME(e.target)?e.target.checked:e.target.value:e,Qte=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,Zte=(e,t)=>e.has(Qte(t)),ere=e=>{const t=e.constructor&&e.constructor.prototype;return ii(t)&&t.hasOwnProperty("isPrototypeOf")},xD=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function ua(e){let t;const r=Array.isArray(e);if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set(e);else if(!(xD&&(e instanceof Blob||e instanceof FileList))&&(r||ii(e)))if(t=r?[]:{},!r&&!ere(e))t=e;else for(const n in e)e.hasOwnProperty(n)&&(t[n]=ua(e[n]));else return e;return t}var QS=e=>Array.isArray(e)?e.filter(Boolean):[],Gn=e=>e===void 0,it=(e,t,r)=>{if(!t||!ii(e))return r;const n=QS(t.split(/[,[\].]+?/)).reduce((i,s)=>ys(i)?i:i[s],e);return Gn(n)||n===e?Gn(e[t])?r:e[t]:n},Wc=e=>typeof e=="boolean",MD=e=>/^\w*$/.test(e),rH=e=>QS(e.replace(/["|']|\]/g,"").split(/\.|\[/)),un=(e,t,r)=>{let n=-1;const i=MD(t)?[t]:rH(t),s=i.length,o=s-1;for(;++n<s;){const a=i[n];let c=r;if(n!==o){const d=e[a];c=ii(d)||Array.isArray(d)?d:isNaN(+i[n+1])?{}:[]}if(a==="__proto__")return;e[a]=c,e=e[a]}return e};const RL={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},ac={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Vd={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};Es.createContext(null);var tre=(e,t,r,n=!0)=>{const i={defaultValues:t._defaultValues};for(const s in e)Object.defineProperty(i,s,{get:()=>{const o=s;return t._proxyFormState[o]!==ac.all&&(t._proxyFormState[o]=!n||ac.all),e[o]}});return i},Ws=e=>ii(e)&&!Object.keys(e).length,rre=(e,t,r,n)=>{r(e);const{name:i,...s}=e;return Ws(s)||Object.keys(s).length>=Object.keys(t).length||Object.keys(s).find(o=>t[o]===ac.all)},tb=e=>Array.isArray(e)?e:[e];function nre(e){const t=Es.useRef(e);t.current=e,Es.useEffect(()=>{const r=!e.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{r&&r.unsubscribe()}},[e.disabled])}var Zc=e=>typeof e=="string",ire=(e,t,r,n,i)=>Zc(e)?(n&&t.watch.add(e),it(r,e,i)):Array.isArray(e)?e.map(s=>(n&&t.watch.add(s),it(r,s))):(n&&(t.watchAll=!0),r),sre=(e,t,r,n,i)=>t?{...r[e],types:{...r[e]&&r[e].types?r[e].types:{},[n]:i||!0}}:{},AL=e=>({isOnSubmit:!e||e===ac.onSubmit,isOnBlur:e===ac.onBlur,isOnChange:e===ac.onChange,isOnAll:e===ac.all,isOnTouch:e===ac.onTouched}),CL=(e,t,r)=>!r&&(t.watchAll||t.watch.has(e)||[...t.watch].some(n=>e.startsWith(n)&&/^\.\w+/.test(e.slice(n.length))));const Zg=(e,t,r,n)=>{for(const i of r||Object.keys(e)){const s=it(e,i);if(s){const{_f:o,...a}=s;if(o){if(o.refs&&o.refs[0]&&t(o.refs[0],i)&&!n)return!0;if(o.ref&&t(o.ref,o.name)&&!n)return!0;if(Zg(a,t))break}else if(ii(a)&&Zg(a,t))break}}};var ore=(e,t,r)=>{const n=tb(it(e,r));return un(n,"root",t[r]),un(e,r,n),e},UD=e=>e.type==="file",hl=e=>typeof e=="function",b1=e=>{if(!xD)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},rb=e=>Zc(e),jD=e=>e.type==="radio",S1=e=>e instanceof RegExp;const IL={value:!1,isValid:!1},OL={value:!0,isValid:!0};var nH=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(r=>r&&r.checked&&!r.disabled).map(r=>r.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!Gn(e[0].attributes.value)?Gn(e[0].value)||e[0].value===""?OL:{value:e[0].value,isValid:!0}:OL:IL}return IL};const NL={isValid:!1,value:null};var iH=e=>Array.isArray(e)?e.reduce((t,r)=>r&&r.checked&&!r.disabled?{isValid:!0,value:r.value}:t,NL):NL;function DL(e,t,r="validate"){if(rb(e)||Array.isArray(e)&&e.every(rb)||Wc(e)&&!e)return{type:r,message:rb(e)?e:"",ref:t}}var Hf=e=>ii(e)&&!S1(e)?e:{value:e,message:""},PL=async(e,t,r,n,i)=>{const{ref:s,refs:o,required:a,maxLength:c,minLength:d,min:l,max:u,pattern:h,validate:p,name:_,valueAsNumber:g,mount:E,disabled:b}=e._f,v=it(t,_);if(!E||b)return{};const I=o?o[0]:s,N=A=>{n&&I.reportValidity&&(I.setCustomValidity(Wc(A)?"":A||""),I.reportValidity())},L={},U=jD(s),w=ME(s),V=U||w,z=(g||UD(s))&&Gn(s.value)&&Gn(v)||b1(s)&&s.value===""||v===""||Array.isArray(v)&&!v.length,K=sre.bind(null,_,r,L),H=(A,m,S,T=Vd.maxLength,x=Vd.minLength)=>{const D=A?m:S;L[_]={type:A?T:x,message:D,ref:s,...K(A?T:x,D)}};if(i?!Array.isArray(v)||!v.length:a&&(!V&&(z||ys(v))||Wc(v)&&!v||w&&!nH(o).isValid||U&&!iH(o).isValid)){const{value:A,message:m}=rb(a)?{value:!!a,message:a}:Hf(a);if(A&&(L[_]={type:Vd.required,message:m,ref:I,...K(Vd.required,m)},!r))return N(m),L}if(!z&&(!ys(l)||!ys(u))){let A,m;const S=Hf(u),T=Hf(l);if(!ys(v)&&!isNaN(v)){const x=s.valueAsNumber||v&&+v;ys(S.value)||(A=x>S.value),ys(T.value)||(m=x<T.value)}else{const x=s.valueAsDate||new Date(v),D=y=>new Date(new Date().toDateString()+" "+y),k=s.type=="time",P=s.type=="week";Zc(S.value)&&v&&(A=k?D(v)>D(S.value):P?v>S.value:x>new Date(S.value)),Zc(T.value)&&v&&(m=k?D(v)<D(T.value):P?v<T.value:x<new Date(T.value))}if((A||m)&&(H(!!A,S.message,T.message,Vd.max,Vd.min),!r))return N(L[_].message),L}if((c||d)&&!z&&(Zc(v)||i&&Array.isArray(v))){const A=Hf(c),m=Hf(d),S=!ys(A.value)&&v.length>+A.value,T=!ys(m.value)&&v.length<+m.value;if((S||T)&&(H(S,A.message,m.message),!r))return N(L[_].message),L}if(h&&!z&&Zc(v)){const{value:A,message:m}=Hf(h);if(S1(A)&&!v.match(A)&&(L[_]={type:Vd.pattern,message:m,ref:s,...K(Vd.pattern,m)},!r))return N(m),L}if(p){if(hl(p)){const A=await p(v,t),m=DL(A,I);if(m&&(L[_]={...m,...K(Vd.validate,m.message)},!r))return N(m.message),L}else if(ii(p)){let A={};for(const m in p){if(!Ws(A)&&!r)break;const S=DL(await p[m](v,t),I,m);S&&(A={...S,...K(m,S.message)},N(S.message),r&&(L[_]=A))}if(!Ws(A)&&(L[_]={ref:I,...A},!r))return L}}return N(!0),L};function are(e,t){const r=t.slice(0,-1).length;let n=0;for(;n<r;)e=Gn(e)?n++:e[t[n++]];return e}function cre(e){for(const t in e)if(e.hasOwnProperty(t)&&!Gn(e[t]))return!1;return!0}function di(e,t){const r=Array.isArray(t)?t:MD(t)?[t]:rH(t),n=r.length===1?e:are(e,r),i=r.length-1,s=r[i];return n&&delete n[s],i!==0&&(ii(n)&&Ws(n)||Array.isArray(n)&&cre(n))&&di(e,r.slice(0,-1)),e}var KT=()=>{let e=[];return{get observers(){return e},next:i=>{for(const s of e)s.next&&s.next(i)},subscribe:i=>(e.push(i),{unsubscribe:()=>{e=e.filter(s=>s!==i)}}),unsubscribe:()=>{e=[]}}},w1=e=>ys(e)||!tH(e);function ru(e,t){if(w1(e)||w1(t))return e===t;if(Mp(e)&&Mp(t))return e.getTime()===t.getTime();const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(const i of r){const s=e[i];if(!n.includes(i))return!1;if(i!=="ref"){const o=t[i];if(Mp(s)&&Mp(o)||ii(s)&&ii(o)||Array.isArray(s)&&Array.isArray(o)?!ru(s,o):s!==o)return!1}}return!0}var sH=e=>e.type==="select-multiple",dre=e=>jD(e)||ME(e),YT=e=>b1(e)&&e.isConnected,oH=e=>{for(const t in e)if(hl(e[t]))return!0;return!1};function T1(e,t={}){const r=Array.isArray(e);if(ii(e)||r)for(const n in e)Array.isArray(e[n])||ii(e[n])&&!oH(e[n])?(t[n]=Array.isArray(e[n])?[]:{},T1(e[n],t[n])):ys(e[n])||(t[n]=!0);return t}function aH(e,t,r){const n=Array.isArray(e);if(ii(e)||n)for(const i in e)Array.isArray(e[i])||ii(e[i])&&!oH(e[i])?Gn(t)||w1(r[i])?r[i]=Array.isArray(e[i])?T1(e[i],[]):{...T1(e[i])}:aH(e[i],ys(t)?{}:t[i],r[i]):r[i]=!ru(e[i],t[i]);return r}var Dv=(e,t)=>aH(e,t,T1(t)),cH=(e,{valueAsNumber:t,valueAsDate:r,setValueAs:n})=>Gn(e)?e:t?e===""?NaN:e&&+e:r&&Zc(e)?new Date(e):n?n(e):e;function JT(e){const t=e.ref;if(!(e.refs?e.refs.every(r=>r.disabled):t.disabled))return UD(t)?t.files:jD(t)?iH(e.refs).value:sH(t)?[...t.selectedOptions].map(({value:r})=>r):ME(t)?nH(e.refs).value:cH(Gn(t.value)?e.ref.value:t.value,e)}var lre=(e,t,r,n)=>{const i={};for(const s of e){const o=it(t,s);o&&un(i,s,o._f)}return{criteriaMode:r,names:[...e],fields:i,shouldUseNativeValidation:n}},q0=e=>Gn(e)?e:S1(e)?e.source:ii(e)?S1(e.value)?e.value.source:e.value:e;const kL="AsyncFunction";var ure=e=>(!e||!e.validate)&&!!(hl(e.validate)&&e.validate.constructor.name===kL||ii(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===kL)),hre=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate);function LL(e,t,r){const n=it(e,r);if(n||MD(r))return{error:n,name:r};const i=r.split(".");for(;i.length;){const s=i.join("."),o=it(t,s),a=it(e,s);if(o&&!Array.isArray(o)&&r!==s)return{name:r};if(a&&a.type)return{name:s,error:a};i.pop()}return{name:r}}var fre=(e,t,r,n,i)=>i.isOnAll?!1:!r&&i.isOnTouch?!(t||e):(r?n.isOnBlur:i.isOnBlur)?!e:(r?n.isOnChange:i.isOnChange)?e:!0,pre=(e,t)=>!QS(it(e,t)).length&&di(e,t);const mre={mode:ac.onSubmit,reValidateMode:ac.onChange,shouldFocusError:!0};function gre(e={}){let t={...mre,...e},r={submitCount:0,isDirty:!1,isLoading:hl(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},n={},i=ii(t.defaultValues)||ii(t.values)?ua(t.defaultValues||t.values)||{}:{},s=t.shouldUnregister?{}:ua(i),o={action:!1,mount:!1,watch:!1},a={mount:new Set,unMount:new Set,array:new Set,watch:new Set},c,d=0;const l={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},u={values:KT(),array:KT(),state:KT()},h=AL(t.mode),p=AL(t.reValidateMode),_=t.criteriaMode===ac.all,g=Q=>re=>{clearTimeout(d),d=setTimeout(Q,re)},E=async Q=>{if(l.isValid||Q){const re=t.resolver?Ws((await V()).errors):await K(n,!0);re!==r.isValid&&u.state.next({isValid:re})}},b=(Q,re)=>{(l.isValidating||l.validatingFields)&&((Q||Array.from(a.mount)).forEach(ne=>{ne&&(re?un(r.validatingFields,ne,re):di(r.validatingFields,ne))}),u.state.next({validatingFields:r.validatingFields,isValidating:!Ws(r.validatingFields)}))},v=(Q,re=[],ne,oe,ce=!0,ue=!0)=>{if(oe&&ne){if(o.action=!0,ue&&Array.isArray(it(n,Q))){const fe=ne(it(n,Q),oe.argA,oe.argB);ce&&un(n,Q,fe)}if(ue&&Array.isArray(it(r.errors,Q))){const fe=ne(it(r.errors,Q),oe.argA,oe.argB);ce&&un(r.errors,Q,fe),pre(r.errors,Q)}if(l.touchedFields&&ue&&Array.isArray(it(r.touchedFields,Q))){const fe=ne(it(r.touchedFields,Q),oe.argA,oe.argB);ce&&un(r.touchedFields,Q,fe)}l.dirtyFields&&(r.dirtyFields=Dv(i,s)),u.state.next({name:Q,isDirty:A(Q,re),dirtyFields:r.dirtyFields,errors:r.errors,isValid:r.isValid})}else un(s,Q,re)},I=(Q,re)=>{un(r.errors,Q,re),u.state.next({errors:r.errors})},N=Q=>{r.errors=Q,u.state.next({errors:r.errors,isValid:!1})},L=(Q,re,ne,oe)=>{const ce=it(n,Q);if(ce){const ue=it(s,Q,Gn(ne)?it(i,Q):ne);Gn(ue)||oe&&oe.defaultChecked||re?un(s,Q,re?ue:JT(ce._f)):T(Q,ue),o.mount&&E()}},U=(Q,re,ne,oe,ce)=>{let ue=!1,fe=!1;const ye={name:Q},Le=!!(it(n,Q)&&it(n,Q)._f&&it(n,Q)._f.disabled);if(!ne||oe){l.isDirty&&(fe=r.isDirty,r.isDirty=ye.isDirty=A(),ue=fe!==ye.isDirty);const ke=Le||ru(it(i,Q),re);fe=!!(!Le&&it(r.dirtyFields,Q)),ke||Le?di(r.dirtyFields,Q):un(r.dirtyFields,Q,!0),ye.dirtyFields=r.dirtyFields,ue=ue||l.dirtyFields&&fe!==!ke}if(ne){const ke=it(r.touchedFields,Q);ke||(un(r.touchedFields,Q,ne),ye.touchedFields=r.touchedFields,ue=ue||l.touchedFields&&ke!==ne)}return ue&&ce&&u.state.next(ye),ue?ye:{}},w=(Q,re,ne,oe)=>{const ce=it(r.errors,Q),ue=l.isValid&&Wc(re)&&r.isValid!==re;if(e.delayError&&ne?(c=g(()=>I(Q,ne)),c(e.delayError)):(clearTimeout(d),c=null,ne?un(r.errors,Q,ne):di(r.errors,Q)),(ne?!ru(ce,ne):ce)||!Ws(oe)||ue){const fe={...oe,...ue&&Wc(re)?{isValid:re}:{},errors:r.errors,name:Q};r={...r,...fe},u.state.next(fe)}},V=async Q=>{b(Q,!0);const re=await t.resolver(s,t.context,lre(Q||a.mount,n,t.criteriaMode,t.shouldUseNativeValidation));return b(Q),re},z=async Q=>{const{errors:re}=await V(Q);if(Q)for(const ne of Q){const oe=it(re,ne);oe?un(r.errors,ne,oe):di(r.errors,ne)}else r.errors=re;return re},K=async(Q,re,ne={valid:!0})=>{for(const oe in Q){const ce=Q[oe];if(ce){const{_f:ue,...fe}=ce;if(ue){const ye=a.array.has(ue.name),Le=ce._f&&ure(ce._f);Le&&l.validatingFields&&b([oe],!0);const ke=await PL(ce,s,_,t.shouldUseNativeValidation&&!re,ye);if(Le&&l.validatingFields&&b([oe]),ke[ue.name]&&(ne.valid=!1,re))break;!re&&(it(ke,ue.name)?ye?ore(r.errors,ke,ue.name):un(r.errors,ue.name,ke[ue.name]):di(r.errors,ue.name))}!Ws(fe)&&await K(fe,re,ne)}}return ne.valid},H=()=>{for(const Q of a.unMount){const re=it(n,Q);re&&(re._f.refs?re._f.refs.every(ne=>!YT(ne)):!YT(re._f.ref))&&te(Q)}a.unMount=new Set},A=(Q,re)=>(Q&&re&&un(s,Q,re),!ru(f(),i)),m=(Q,re,ne)=>ire(Q,a,{...o.mount?s:Gn(re)?i:Zc(Q)?{[Q]:re}:re},ne,re),S=Q=>QS(it(o.mount?s:i,Q,e.shouldUnregister?it(i,Q,[]):[])),T=(Q,re,ne={})=>{const oe=it(n,Q);let ce=re;if(oe){const ue=oe._f;ue&&(!ue.disabled&&un(s,Q,cH(re,ue)),ce=b1(ue.ref)&&ys(re)?"":re,sH(ue.ref)?[...ue.ref.options].forEach(fe=>fe.selected=ce.includes(fe.value)):ue.refs?ME(ue.ref)?ue.refs.length>1?ue.refs.forEach(fe=>(!fe.defaultChecked||!fe.disabled)&&(fe.checked=Array.isArray(ce)?!!ce.find(ye=>ye===fe.value):ce===fe.value)):ue.refs[0]&&(ue.refs[0].checked=!!ce):ue.refs.forEach(fe=>fe.checked=fe.value===ce):UD(ue.ref)?ue.ref.value="":(ue.ref.value=ce,ue.ref.type||u.values.next({name:Q,values:{...s}})))}(ne.shouldDirty||ne.shouldTouch)&&U(Q,ce,ne.shouldTouch,ne.shouldDirty,!0),ne.shouldValidate&&y(Q)},x=(Q,re,ne)=>{for(const oe in re){const ce=re[oe],ue=`${Q}.${oe}`,fe=it(n,ue);(a.array.has(Q)||!w1(ce)||fe&&!fe._f)&&!Mp(ce)?x(ue,ce,ne):T(ue,ce,ne)}},D=(Q,re,ne={})=>{const oe=it(n,Q),ce=a.array.has(Q),ue=ua(re);un(s,Q,ue),ce?(u.array.next({name:Q,values:{...s}}),(l.isDirty||l.dirtyFields)&&ne.shouldDirty&&u.state.next({name:Q,dirtyFields:Dv(i,s),isDirty:A(Q,ue)})):oe&&!oe._f&&!ys(ue)?x(Q,ue,ne):T(Q,ue,ne),CL(Q,a)&&u.state.next({...r}),u.values.next({name:o.mount?Q:void 0,values:{...s}})},k=async Q=>{o.mount=!0;const re=Q.target;let ne=re.name,oe=!0;const ce=it(n,ne),ue=()=>re.type?JT(ce._f):Xte(Q),fe=ye=>{oe=Number.isNaN(ye)||ru(ye,it(s,ne,ye))};if(ce){let ye,Le;const ke=ue(),Pe=Q.type===RL.BLUR||Q.type===RL.FOCUS_OUT,Qe=!hre(ce._f)&&!t.resolver&&!it(r.errors,ne)&&!ce._f.deps||fre(Pe,it(r.touchedFields,ne),r.isSubmitted,p,h),ze=CL(ne,a,Pe);un(s,ne,ke),Pe?(ce._f.onBlur&&ce._f.onBlur(Q),c&&c(0)):ce._f.onChange&&ce._f.onChange(Q);const Ue=U(ne,ke,Pe,!1),st=!Ws(Ue)||ze;if(!Pe&&u.values.next({name:ne,type:Q.type,values:{...s}}),Qe)return l.isValid&&(e.mode==="onBlur"?Pe&&E():E()),st&&u.state.next({name:ne,...ze?{}:Ue});if(!Pe&&ze&&u.state.next({...r}),t.resolver){const{errors:ct}=await V([ne]);if(fe(ke),oe){const Ve=LL(r.errors,n,ne),ot=LL(ct,n,Ve.name||ne);ye=ot.error,ne=ot.name,Le=Ws(ct)}}else b([ne],!0),ye=(await PL(ce,s,_,t.shouldUseNativeValidation))[ne],b([ne]),fe(ke),oe&&(ye?Le=!1:l.isValid&&(Le=await K(n,!0)));oe&&(ce._f.deps&&y(ce._f.deps),w(ne,Le,ye,Ue))}},P=(Q,re)=>{if(it(r.errors,re)&&Q.focus)return Q.focus(),1},y=async(Q,re={})=>{let ne,oe;const ce=tb(Q);if(t.resolver){const ue=await z(Gn(Q)?Q:ce);ne=Ws(ue),oe=Q?!ce.some(fe=>it(ue,fe)):ne}else Q?(oe=(await Promise.all(ce.map(async ue=>{const fe=it(n,ue);return await K(fe&&fe._f?{[ue]:fe}:fe)}))).every(Boolean),!(!oe&&!r.isValid)&&E()):oe=ne=await K(n);return u.state.next({...!Zc(Q)||l.isValid&&ne!==r.isValid?{}:{name:Q},...t.resolver||!Q?{isValid:ne}:{},errors:r.errors}),re.shouldFocus&&!oe&&Zg(n,P,Q?ce:a.mount),oe},f=Q=>{const re={...o.mount?s:i};return Gn(Q)?re:Zc(Q)?it(re,Q):Q.map(ne=>it(re,ne))},R=(Q,re)=>({invalid:!!it((re||r).errors,Q),isDirty:!!it((re||r).dirtyFields,Q),error:it((re||r).errors,Q),isValidating:!!it(r.validatingFields,Q),isTouched:!!it((re||r).touchedFields,Q)}),B=Q=>{Q&&tb(Q).forEach(re=>di(r.errors,re)),u.state.next({errors:Q?r.errors:{}})},q=(Q,re,ne)=>{const oe=(it(n,Q,{_f:{}})._f||{}).ref,ce=it(r.errors,Q)||{},{ref:ue,message:fe,type:ye,...Le}=ce;un(r.errors,Q,{...Le,...re,ref:oe}),u.state.next({name:Q,errors:r.errors,isValid:!1}),ne&&ne.shouldFocus&&oe&&oe.focus&&oe.focus()},F=(Q,re)=>hl(Q)?u.values.subscribe({next:ne=>Q(m(void 0,re),ne)}):m(Q,re,!0),te=(Q,re={})=>{for(const ne of Q?tb(Q):a.mount)a.mount.delete(ne),a.array.delete(ne),re.keepValue||(di(n,ne),di(s,ne)),!re.keepError&&di(r.errors,ne),!re.keepDirty&&di(r.dirtyFields,ne),!re.keepTouched&&di(r.touchedFields,ne),!re.keepIsValidating&&di(r.validatingFields,ne),!t.shouldUnregister&&!re.keepDefaultValue&&di(i,ne);u.values.next({values:{...s}}),u.state.next({...r,...re.keepDirty?{isDirty:A()}:{}}),!re.keepIsValid&&E()},G=({disabled:Q,name:re,field:ne,fields:oe,value:ce})=>{if(Wc(Q)&&o.mount||Q){const ue=Q?void 0:Gn(ce)?JT(ne?ne._f:it(oe,re)._f):ce;un(s,re,ue),U(re,ue,!1,!1,!0)}},Y=(Q,re={})=>{let ne=it(n,Q);const oe=Wc(re.disabled)||Wc(e.disabled);return un(n,Q,{...ne||{},_f:{...ne&&ne._f?ne._f:{ref:{name:Q}},name:Q,mount:!0,...re}}),a.mount.add(Q),ne?G({field:ne,disabled:Wc(re.disabled)?re.disabled:e.disabled,name:Q,value:re.value}):L(Q,!0,re.value),{...oe?{disabled:re.disabled||e.disabled}:{},...t.progressive?{required:!!re.required,min:q0(re.min),max:q0(re.max),minLength:q0(re.minLength),maxLength:q0(re.maxLength),pattern:q0(re.pattern)}:{},name:Q,onChange:k,onBlur:k,ref:ce=>{if(ce){Y(Q,re),ne=it(n,Q);const ue=Gn(ce.value)&&ce.querySelectorAll&&ce.querySelectorAll("input,select,textarea")[0]||ce,fe=dre(ue),ye=ne._f.refs||[];if(fe?ye.find(Le=>Le===ue):ue===ne._f.ref)return;un(n,Q,{_f:{...ne._f,...fe?{refs:[...ye.filter(YT),ue,...Array.isArray(it(i,Q))?[{}]:[]],ref:{type:ue.type,name:Q}}:{ref:ue}}}),L(Q,!1,void 0,ue)}else ne=it(n,Q,{}),ne._f&&(ne._f.mount=!1),(t.shouldUnregister||re.shouldUnregister)&&!(Zte(a.array,Q)&&o.action)&&a.unMount.add(Q)}}},X=()=>t.shouldFocusError&&Zg(n,P,a.mount),M=Q=>{Wc(Q)&&(u.state.next({disabled:Q}),Zg(n,(re,ne)=>{const oe=it(n,ne);oe&&(re.disabled=oe._f.disabled||Q,Array.isArray(oe._f.refs)&&oe._f.refs.forEach(ce=>{ce.disabled=oe._f.disabled||Q}))},0,!1))},J=(Q,re)=>async ne=>{let oe;ne&&(ne.preventDefault&&ne.preventDefault(),ne.persist&&ne.persist());let ce=ua(s);if(u.state.next({isSubmitting:!0}),t.resolver){const{errors:ue,values:fe}=await V();r.errors=ue,ce=fe}else await K(n);if(di(r.errors,"root"),Ws(r.errors)){u.state.next({errors:{}});try{await Q(ce,ne)}catch(ue){oe=ue}}else re&&await re({...r.errors},ne),X(),setTimeout(X);if(u.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Ws(r.errors)&&!oe,submitCount:r.submitCount+1,errors:r.errors}),oe)throw oe},de=(Q,re={})=>{it(n,Q)&&(Gn(re.defaultValue)?D(Q,ua(it(i,Q))):(D(Q,re.defaultValue),un(i,Q,ua(re.defaultValue))),re.keepTouched||di(r.touchedFields,Q),re.keepDirty||(di(r.dirtyFields,Q),r.isDirty=re.defaultValue?A(Q,ua(it(i,Q))):A()),re.keepError||(di(r.errors,Q),l.isValid&&E()),u.state.next({...r}))},he=(Q,re={})=>{const ne=Q?ua(Q):i,oe=ua(ne),ce=Ws(Q),ue=ce?i:oe;if(re.keepDefaultValues||(i=ne),!re.keepValues){if(re.keepDirtyValues)for(const fe of a.mount)it(r.dirtyFields,fe)?un(ue,fe,it(s,fe)):D(fe,it(ue,fe));else{if(xD&&Gn(Q))for(const fe of a.mount){const ye=it(n,fe);if(ye&&ye._f){const Le=Array.isArray(ye._f.refs)?ye._f.refs[0]:ye._f.ref;if(b1(Le)){const ke=Le.closest("form");if(ke){ke.reset();break}}}}n={}}s=e.shouldUnregister?re.keepDefaultValues?ua(i):{}:ua(ue),u.array.next({values:{...ue}}),u.values.next({values:{...ue}})}a={mount:re.keepDirtyValues?a.mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},o.mount=!l.isValid||!!re.keepIsValid||!!re.keepDirtyValues,o.watch=!!e.shouldUnregister,u.state.next({submitCount:re.keepSubmitCount?r.submitCount:0,isDirty:ce?!1:re.keepDirty?r.isDirty:!!(re.keepDefaultValues&&!ru(Q,i)),isSubmitted:re.keepIsSubmitted?r.isSubmitted:!1,dirtyFields:ce?{}:re.keepDirtyValues?re.keepDefaultValues&&s?Dv(i,s):r.dirtyFields:re.keepDefaultValues&&Q?Dv(i,Q):re.keepDirty?r.dirtyFields:{},touchedFields:re.keepTouched?r.touchedFields:{},errors:re.keepErrors?r.errors:{},isSubmitSuccessful:re.keepIsSubmitSuccessful?r.isSubmitSuccessful:!1,isSubmitting:!1})},Se=(Q,re)=>he(hl(Q)?Q(s):Q,re);return{control:{register:Y,unregister:te,getFieldState:R,handleSubmit:J,setError:q,_executeSchema:V,_getWatch:m,_getDirty:A,_updateValid:E,_removeUnmounted:H,_updateFieldArray:v,_updateDisabledField:G,_getFieldArray:S,_reset:he,_resetDefaultValues:()=>hl(t.defaultValues)&&t.defaultValues().then(Q=>{Se(Q,t.resetOptions),u.state.next({isLoading:!1})}),_updateFormState:Q=>{r={...r,...Q}},_disableForm:M,_subjects:u,_proxyFormState:l,_setErrors:N,get _fields(){return n},get _formValues(){return s},get _state(){return o},set _state(Q){o=Q},get _defaultValues(){return i},get _names(){return a},set _names(Q){a=Q},get _formState(){return r},set _formState(Q){r=Q},get _options(){return t},set _options(Q){t={...t,...Q}}},trigger:y,register:Y,handleSubmit:J,watch:F,setValue:D,getValues:f,reset:Se,resetField:de,clearErrors:B,unregister:te,setError:q,setFocus:(Q,re={})=>{const ne=it(n,Q),oe=ne&&ne._f;if(oe){const ce=oe.refs?oe.refs[0]:oe.ref;ce.focus&&(ce.focus(),re.shouldSelect&&ce.select())}},getFieldState:R}}function dH(e={}){const t=Es.useRef(),r=Es.useRef(),[n,i]=Es.useState({isDirty:!1,isValidating:!1,isLoading:hl(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,defaultValues:hl(e.defaultValues)?void 0:e.defaultValues});t.current||(t.current={...gre(e),formState:n});const s=t.current.control;return s._options=e,nre({subject:s._subjects.state,next:o=>{rre(o,s._proxyFormState,s._updateFormState)&&i({...s._formState})}}),Es.useEffect(()=>s._disableForm(e.disabled),[s,e.disabled]),Es.useEffect(()=>{if(s._proxyFormState.isDirty){const o=s._getDirty();o!==n.isDirty&&s._subjects.state.next({isDirty:o})}},[s,n.isDirty]),Es.useEffect(()=>{e.values&&!ru(e.values,r.current)?(s._reset(e.values,s._options.resetOptions),r.current=e.values,i(o=>({...o}))):s._resetDefaultValues()},[e.values,s]),Es.useEffect(()=>{e.errors&&s._setErrors(e.errors)},[e.errors,s]),Es.useEffect(()=>{s._state.mount||(s._updateValid(),s._state.mount=!0),s._state.watch&&(s._state.watch=!1,s._subjects.state.next({...s._formState})),s._removeUnmounted()}),Es.useEffect(()=>{e.shouldUnregister&&s._subjects.values.next({values:s._getWatch()})},[e.shouldUnregister,s]),t.current.formState=tre(n,s),t.current}function lH(e,t){return function(){return e.apply(t,arguments)}}const{toString:_re}=Object.prototype,{getPrototypeOf:FD}=Object,ZS=(e=>t=>{const r=_re.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),bc=e=>(e=e.toLowerCase(),t=>ZS(t)===e),ew=e=>t=>typeof t===e,{isArray:Zm}=Array,U_=ew("undefined");function Ere(e){return e!==null&&!U_(e)&&e.constructor!==null&&!U_(e.constructor)&&Uo(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const uH=bc("ArrayBuffer");function vre(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&uH(e.buffer),t}const yre=ew("string"),Uo=ew("function"),hH=ew("number"),tw=e=>e!==null&&typeof e=="object",bre=e=>e===!0||e===!1,nb=e=>{if(ZS(e)!=="object")return!1;const t=FD(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},Sre=bc("Date"),wre=bc("File"),Tre=bc("Blob"),Rre=bc("FileList"),Are=e=>tw(e)&&Uo(e.pipe),Cre=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Uo(e.append)&&((t=ZS(e))==="formdata"||t==="object"&&Uo(e.toString)&&e.toString()==="[object FormData]"))},Ire=bc("URLSearchParams"),[Ore,Nre,Dre,Pre]=["ReadableStream","Request","Response","Headers"].map(bc),kre=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function UE(e,t,{allOwnKeys:r=!1}={}){if(e===null||typeof e>"u")return;let n,i;if(typeof e!="object"&&(e=[e]),Zm(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{const s=r?Object.getOwnPropertyNames(e):Object.keys(e),o=s.length;let a;for(n=0;n<o;n++)a=s[n],t.call(null,e[a],a,e)}}function fH(e,t){t=t.toLowerCase();const r=Object.keys(e);let n=r.length,i;for(;n-- >0;)if(i=r[n],t===i.toLowerCase())return i;return null}const Mh=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,pH=e=>!U_(e)&&e!==Mh;function _O(){const{caseless:e}=pH(this)&&this||{},t={},r=(n,i)=>{const s=e&&fH(t,i)||i;nb(t[s])&&nb(n)?t[s]=_O(t[s],n):nb(n)?t[s]=_O({},n):Zm(n)?t[s]=n.slice():t[s]=n};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&UE(arguments[n],r);return t}const Lre=(e,t,r,{allOwnKeys:n}={})=>(UE(t,(i,s)=>{r&&Uo(i)?e[s]=lH(i,r):e[s]=i},{allOwnKeys:n}),e),xre=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),Mre=(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},Ure=(e,t,r,n)=>{let i,s,o;const a={};if(t=t||{},e==null)return t;do{for(i=Object.getOwnPropertyNames(e),s=i.length;s-- >0;)o=i[s],(!n||n(o,e,t))&&!a[o]&&(t[o]=e[o],a[o]=!0);e=r!==!1&&FD(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},jre=(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return n!==-1&&n===r},Fre=e=>{if(!e)return null;if(Zm(e))return e;let t=e.length;if(!hH(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},Bre=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&FD(Uint8Array)),Vre=(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let i;for(;(i=n.next())&&!i.done;){const s=i.value;t.call(e,s[0],s[1])}},$re=(e,t)=>{let r;const n=[];for(;(r=e.exec(t))!==null;)n.push(r);return n},Hre=bc("HTMLFormElement"),zre=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,n,i){return n.toUpperCase()+i}),xL=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),Wre=bc("RegExp"),mH=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};UE(r,(i,s)=>{let o;(o=t(i,s,e))!==!1&&(n[s]=o||i)}),Object.defineProperties(e,n)},Gre=e=>{mH(e,(t,r)=>{if(Uo(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=e[r];if(Uo(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},qre=(e,t)=>{const r={},n=i=>{i.forEach(s=>{r[s]=!0})};return Zm(e)?n(e):n(String(e).split(t)),r},Kre=()=>{},Yre=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,XT="abcdefghijklmnopqrstuvwxyz",ML="0123456789",gH={DIGIT:ML,ALPHA:XT,ALPHA_DIGIT:XT+XT.toUpperCase()+ML},Jre=(e=16,t=gH.ALPHA_DIGIT)=>{let r="";const{length:n}=t;for(;e--;)r+=t[Math.random()*n|0];return r};function Xre(e){return!!(e&&Uo(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])}const Qre=e=>{const t=new Array(10),r=(n,i)=>{if(tw(n)){if(t.indexOf(n)>=0)return;if(!("toJSON"in n)){t[i]=n;const s=Zm(n)?[]:{};return UE(n,(o,a)=>{const c=r(o,i+1);!U_(c)&&(s[a]=c)}),t[i]=void 0,s}}return n};return r(e,0)},Zre=bc("AsyncFunction"),ene=e=>e&&(tw(e)||Uo(e))&&Uo(e.then)&&Uo(e.catch),_H=((e,t)=>e?setImmediate:t?((r,n)=>(Mh.addEventListener("message",({source:i,data:s})=>{i===Mh&&s===r&&n.length&&n.shift()()},!1),i=>{n.push(i),Mh.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",Uo(Mh.postMessage)),tne=typeof queueMicrotask<"u"?queueMicrotask.bind(Mh):typeof process<"u"&&process.nextTick||_H,ge={isArray:Zm,isArrayBuffer:uH,isBuffer:Ere,isFormData:Cre,isArrayBufferView:vre,isString:yre,isNumber:hH,isBoolean:bre,isObject:tw,isPlainObject:nb,isReadableStream:Ore,isRequest:Nre,isResponse:Dre,isHeaders:Pre,isUndefined:U_,isDate:Sre,isFile:wre,isBlob:Tre,isRegExp:Wre,isFunction:Uo,isStream:Are,isURLSearchParams:Ire,isTypedArray:Bre,isFileList:Rre,forEach:UE,merge:_O,extend:Lre,trim:kre,stripBOM:xre,inherits:Mre,toFlatObject:Ure,kindOf:ZS,kindOfTest:bc,endsWith:jre,toArray:Fre,forEachEntry:Vre,matchAll:$re,isHTMLForm:Hre,hasOwnProperty:xL,hasOwnProp:xL,reduceDescriptors:mH,freezeMethods:Gre,toObjectSet:qre,toCamelCase:zre,noop:Kre,toFiniteNumber:Yre,findKey:fH,global:Mh,isContextDefined:pH,ALPHABET:gH,generateString:Jre,isSpecCompliantForm:Xre,toJSONObject:Qre,isAsyncFn:Zre,isThenable:ene,setImmediate:_H,asap:tne};function Kt(e,t,r,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}ge.inherits(Kt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ge.toJSONObject(this.config),code:this.code,status:this.status}}});const EH=Kt.prototype,vH={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{vH[e]={value:e}});Object.defineProperties(Kt,vH);Object.defineProperty(EH,"isAxiosError",{value:!0});Kt.from=(e,t,r,n,i,s)=>{const o=Object.create(EH);return ge.toFlatObject(e,o,function(c){return c!==Error.prototype},a=>a!=="isAxiosError"),Kt.call(o,e.message,t,r,n,i),o.cause=e,o.name=e.name,s&&Object.assign(o,s),o};const rne=null;function EO(e){return ge.isPlainObject(e)||ge.isArray(e)}function yH(e){return ge.endsWith(e,"[]")?e.slice(0,-2):e}function UL(e,t,r){return e?e.concat(t).map(function(i,s){return i=yH(i),!r&&s?"["+i+"]":i}).join(r?".":""):t}function nne(e){return ge.isArray(e)&&!e.some(EO)}const ine=ge.toFlatObject(ge,{},null,function(t){return/^is[A-Z]/.test(t)});function rw(e,t,r){if(!ge.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,r=ge.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,E){return!ge.isUndefined(E[g])});const n=r.metaTokens,i=r.visitor||l,s=r.dots,o=r.indexes,c=(r.Blob||typeof Blob<"u"&&Blob)&&ge.isSpecCompliantForm(t);if(!ge.isFunction(i))throw new TypeError("visitor must be a function");function d(_){if(_===null)return"";if(ge.isDate(_))return _.toISOString();if(!c&&ge.isBlob(_))throw new Kt("Blob is not supported. Use a Buffer instead.");return ge.isArrayBuffer(_)||ge.isTypedArray(_)?c&&typeof Blob=="function"?new Blob([_]):Buffer.from(_):_}function l(_,g,E){let b=_;if(_&&!E&&typeof _=="object"){if(ge.endsWith(g,"{}"))g=n?g:g.slice(0,-2),_=JSON.stringify(_);else if(ge.isArray(_)&&nne(_)||(ge.isFileList(_)||ge.endsWith(g,"[]"))&&(b=ge.toArray(_)))return g=yH(g),b.forEach(function(I,N){!(ge.isUndefined(I)||I===null)&&t.append(o===!0?UL([g],N,s):o===null?g:g+"[]",d(I))}),!1}return EO(_)?!0:(t.append(UL(E,g,s),d(_)),!1)}const u=[],h=Object.assign(ine,{defaultVisitor:l,convertValue:d,isVisitable:EO});function p(_,g){if(!ge.isUndefined(_)){if(u.indexOf(_)!==-1)throw Error("Circular reference detected in "+g.join("."));u.push(_),ge.forEach(_,function(b,v){(!(ge.isUndefined(b)||b===null)&&i.call(t,b,ge.isString(v)?v.trim():v,g,h))===!0&&p(b,g?g.concat(v):[v])}),u.pop()}}if(!ge.isObject(e))throw new TypeError("data must be an object");return p(e),t}function jL(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function BD(e,t){this._pairs=[],e&&rw(e,this,t)}const bH=BD.prototype;bH.append=function(t,r){this._pairs.push([t,r])};bH.toString=function(t){const r=t?function(n){return t.call(this,n,jL)}:jL;return this._pairs.map(function(i){return r(i[0])+"="+r(i[1])},"").join("&")};function sne(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function SH(e,t,r){if(!t)return e;const n=r&&r.encode||sne,i=r&&r.serialize;let s;if(i?s=i(t,r):s=ge.isURLSearchParams(t)?t.toString():new BD(t,r).toString(n),s){const o=e.indexOf("#");o!==-1&&(e=e.slice(0,o)),e+=(e.indexOf("?")===-1?"?":"&")+s}return e}class FL{constructor(){this.handlers=[]}use(t,r,n){return this.handlers.push({fulfilled:t,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){ge.forEach(this.handlers,function(n){n!==null&&t(n)})}}const wH={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},one=typeof URLSearchParams<"u"?URLSearchParams:BD,ane=typeof FormData<"u"?FormData:null,cne=typeof Blob<"u"?Blob:null,dne={isBrowser:!0,classes:{URLSearchParams:one,FormData:ane,Blob:cne},protocols:["http","https","file","blob","url","data"]},VD=typeof window<"u"&&typeof document<"u",vO=typeof navigator=="object"&&navigator||void 0,lne=VD&&(!vO||["ReactNative","NativeScript","NS"].indexOf(vO.product)<0),une=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",hne=VD&&window.location.href||"http://localhost",fne=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:VD,hasStandardBrowserEnv:lne,hasStandardBrowserWebWorkerEnv:une,navigator:vO,origin:hne},Symbol.toStringTag,{value:"Module"})),co={...fne,...dne};function pne(e,t){return rw(e,new co.classes.URLSearchParams,Object.assign({visitor:function(r,n,i,s){return co.isNode&&ge.isBuffer(r)?(this.append(n,r.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},t))}function mne(e){return ge.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function gne(e){const t={},r=Object.keys(e);let n;const i=r.length;let s;for(n=0;n<i;n++)s=r[n],t[s]=e[s];return t}function TH(e){function t(r,n,i,s){let o=r[s++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),c=s>=r.length;return o=!o&&ge.isArray(i)?i.length:o,c?(ge.hasOwnProp(i,o)?i[o]=[i[o],n]:i[o]=n,!a):((!i[o]||!ge.isObject(i[o]))&&(i[o]=[]),t(r,n,i[o],s)&&ge.isArray(i[o])&&(i[o]=gne(i[o])),!a)}if(ge.isFormData(e)&&ge.isFunction(e.entries)){const r={};return ge.forEachEntry(e,(n,i)=>{t(mne(n),i,r,0)}),r}return null}function _ne(e,t,r){if(ge.isString(e))try{return(t||JSON.parse)(e),ge.trim(e)}catch(n){if(n.name!=="SyntaxError")throw n}return(0,JSON.stringify)(e)}const jE={transitional:wH,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const n=r.getContentType()||"",i=n.indexOf("application/json")>-1,s=ge.isObject(t);if(s&&ge.isHTMLForm(t)&&(t=new FormData(t)),ge.isFormData(t))return i?JSON.stringify(TH(t)):t;if(ge.isArrayBuffer(t)||ge.isBuffer(t)||ge.isStream(t)||ge.isFile(t)||ge.isBlob(t)||ge.isReadableStream(t))return t;if(ge.isArrayBufferView(t))return t.buffer;if(ge.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let a;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return pne(t,this.formSerializer).toString();if((a=ge.isFileList(t))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return rw(a?{"files[]":t}:t,c&&new c,this.formSerializer)}}return s||i?(r.setContentType("application/json",!1),_ne(t)):t}],transformResponse:[function(t){const r=this.transitional||jE.transitional,n=r&&r.forcedJSONParsing,i=this.responseType==="json";if(ge.isResponse(t)||ge.isReadableStream(t))return t;if(t&&ge.isString(t)&&(n&&!this.responseType||i)){const o=!(r&&r.silentJSONParsing)&&i;try{return JSON.parse(t)}catch(a){if(o)throw a.name==="SyntaxError"?Kt.from(a,Kt.ERR_BAD_RESPONSE,this,null,this.response):a}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:co.classes.FormData,Blob:co.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ge.forEach(["delete","get","head","post","put","patch"],e=>{jE.headers[e]={}});const Ene=ge.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),vne=e=>{const t={};let r,n,i;return e&&e.split(`
`).forEach(function(o){i=o.indexOf(":"),r=o.substring(0,i).trim().toLowerCase(),n=o.substring(i+1).trim(),!(!r||t[r]&&Ene[r])&&(r==="set-cookie"?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t},BL=Symbol("internals");function K0(e){return e&&String(e).trim().toLowerCase()}function ib(e){return e===!1||e==null?e:ge.isArray(e)?e.map(ib):String(e)}function yne(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}const bne=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function QT(e,t,r,n,i){if(ge.isFunction(n))return n.call(this,t,r);if(i&&(t=r),!!ge.isString(t)){if(ge.isString(n))return t.indexOf(n)!==-1;if(ge.isRegExp(n))return n.test(t)}}function Sne(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,n)=>r.toUpperCase()+n)}function wne(e,t){const r=ge.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+r,{value:function(i,s,o){return this[n].call(this,t,i,s,o)},configurable:!0})})}class lo{constructor(t){t&&this.set(t)}set(t,r,n){const i=this;function s(a,c,d){const l=K0(c);if(!l)throw new Error("header name must be a non-empty string");const u=ge.findKey(i,l);(!u||i[u]===void 0||d===!0||d===void 0&&i[u]!==!1)&&(i[u||c]=ib(a))}const o=(a,c)=>ge.forEach(a,(d,l)=>s(d,l,c));if(ge.isPlainObject(t)||t instanceof this.constructor)o(t,r);else if(ge.isString(t)&&(t=t.trim())&&!bne(t))o(vne(t),r);else if(ge.isHeaders(t))for(const[a,c]of t.entries())s(c,a,n);else t!=null&&s(r,t,n);return this}get(t,r){if(t=K0(t),t){const n=ge.findKey(this,t);if(n){const i=this[n];if(!r)return i;if(r===!0)return yne(i);if(ge.isFunction(r))return r.call(this,i,n);if(ge.isRegExp(r))return r.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=K0(t),t){const n=ge.findKey(this,t);return!!(n&&this[n]!==void 0&&(!r||QT(this,this[n],n,r)))}return!1}delete(t,r){const n=this;let i=!1;function s(o){if(o=K0(o),o){const a=ge.findKey(n,o);a&&(!r||QT(n,n[a],a,r))&&(delete n[a],i=!0)}}return ge.isArray(t)?t.forEach(s):s(t),i}clear(t){const r=Object.keys(this);let n=r.length,i=!1;for(;n--;){const s=r[n];(!t||QT(this,this[s],s,t,!0))&&(delete this[s],i=!0)}return i}normalize(t){const r=this,n={};return ge.forEach(this,(i,s)=>{const o=ge.findKey(n,s);if(o){r[o]=ib(i),delete r[s];return}const a=t?Sne(s):String(s).trim();a!==s&&delete r[s],r[a]=ib(i),n[a]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return ge.forEach(this,(n,i)=>{n!=null&&n!==!1&&(r[i]=t&&ge.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const n=new this(t);return r.forEach(i=>n.set(i)),n}static accessor(t){const n=(this[BL]=this[BL]={accessors:{}}).accessors,i=this.prototype;function s(o){const a=K0(o);n[a]||(wne(i,o),n[a]=!0)}return ge.isArray(t)?t.forEach(s):s(t),this}}lo.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ge.reduceDescriptors(lo.prototype,({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(n){this[r]=n}}});ge.freezeMethods(lo);function ZT(e,t){const r=this||jE,n=t||r,i=lo.from(n.headers);let s=n.data;return ge.forEach(e,function(a){s=a.call(r,s,i.normalize(),t?t.status:void 0)}),i.normalize(),s}function RH(e){return!!(e&&e.__CANCEL__)}function e0(e,t,r){Kt.call(this,e??"canceled",Kt.ERR_CANCELED,t,r),this.name="CanceledError"}ge.inherits(e0,Kt,{__CANCEL__:!0});function AH(e,t,r){const n=r.config.validateStatus;!r.status||!n||n(r.status)?e(r):t(new Kt("Request failed with status code "+r.status,[Kt.ERR_BAD_REQUEST,Kt.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function Tne(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function Rne(e,t){e=e||10;const r=new Array(e),n=new Array(e);let i=0,s=0,o;return t=t!==void 0?t:1e3,function(c){const d=Date.now(),l=n[s];o||(o=d),r[i]=c,n[i]=d;let u=s,h=0;for(;u!==i;)h+=r[u++],u=u%e;if(i=(i+1)%e,i===s&&(s=(s+1)%e),d-o<t)return;const p=l&&d-l;return p?Math.round(h*1e3/p):void 0}}function Ane(e,t){let r=0,n=1e3/t,i,s;const o=(d,l=Date.now())=>{r=l,i=null,s&&(clearTimeout(s),s=null),e.apply(null,d)};return[(...d)=>{const l=Date.now(),u=l-r;u>=n?o(d,l):(i=d,s||(s=setTimeout(()=>{s=null,o(i)},n-u)))},()=>i&&o(i)]}const R1=(e,t,r=3)=>{let n=0;const i=Rne(50,250);return Ane(s=>{const o=s.loaded,a=s.lengthComputable?s.total:void 0,c=o-n,d=i(c),l=o<=a;n=o;const u={loaded:o,total:a,progress:a?o/a:void 0,bytes:c,rate:d||void 0,estimated:d&&a&&l?(a-o)/d:void 0,event:s,lengthComputable:a!=null,[t?"download":"upload"]:!0};e(u)},r)},VL=(e,t)=>{const r=e!=null;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},$L=e=>(...t)=>ge.asap(()=>e(...t)),Cne=co.hasStandardBrowserEnv?function(){const t=co.navigator&&/(msie|trident)/i.test(co.navigator.userAgent),r=document.createElement("a");let n;function i(s){let o=s;return t&&(r.setAttribute("href",o),o=r.href),r.setAttribute("href",o),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return n=i(window.location.href),function(o){const a=ge.isString(o)?i(o):o;return a.protocol===n.protocol&&a.host===n.host}}():function(){return function(){return!0}}(),Ine=co.hasStandardBrowserEnv?{write(e,t,r,n,i,s){const o=[e+"="+encodeURIComponent(t)];ge.isNumber(r)&&o.push("expires="+new Date(r).toGMTString()),ge.isString(n)&&o.push("path="+n),ge.isString(i)&&o.push("domain="+i),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function One(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function Nne(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function CH(e,t){return e&&!One(t)?Nne(e,t):t}const HL=e=>e instanceof lo?{...e}:e;function hf(e,t){t=t||{};const r={};function n(d,l,u){return ge.isPlainObject(d)&&ge.isPlainObject(l)?ge.merge.call({caseless:u},d,l):ge.isPlainObject(l)?ge.merge({},l):ge.isArray(l)?l.slice():l}function i(d,l,u){if(ge.isUndefined(l)){if(!ge.isUndefined(d))return n(void 0,d,u)}else return n(d,l,u)}function s(d,l){if(!ge.isUndefined(l))return n(void 0,l)}function o(d,l){if(ge.isUndefined(l)){if(!ge.isUndefined(d))return n(void 0,d)}else return n(void 0,l)}function a(d,l,u){if(u in t)return n(d,l);if(u in e)return n(void 0,d)}const c={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(d,l)=>i(HL(d),HL(l),!0)};return ge.forEach(Object.keys(Object.assign({},e,t)),function(l){const u=c[l]||i,h=u(e[l],t[l],l);ge.isUndefined(h)&&u!==a||(r[l]=h)}),r}const IH=e=>{const t=hf({},e);let{data:r,withXSRFToken:n,xsrfHeaderName:i,xsrfCookieName:s,headers:o,auth:a}=t;t.headers=o=lo.from(o),t.url=SH(CH(t.baseURL,t.url),e.params,e.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let c;if(ge.isFormData(r)){if(co.hasStandardBrowserEnv||co.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((c=o.getContentType())!==!1){const[d,...l]=c?c.split(";").map(u=>u.trim()).filter(Boolean):[];o.setContentType([d||"multipart/form-data",...l].join("; "))}}if(co.hasStandardBrowserEnv&&(n&&ge.isFunction(n)&&(n=n(t)),n||n!==!1&&Cne(t.url))){const d=i&&s&&Ine.read(s);d&&o.set(i,d)}return t},Dne=typeof XMLHttpRequest<"u",Pne=Dne&&function(e){return new Promise(function(r,n){const i=IH(e);let s=i.data;const o=lo.from(i.headers).normalize();let{responseType:a,onUploadProgress:c,onDownloadProgress:d}=i,l,u,h,p,_;function g(){p&&p(),_&&_(),i.cancelToken&&i.cancelToken.unsubscribe(l),i.signal&&i.signal.removeEventListener("abort",l)}let E=new XMLHttpRequest;E.open(i.method.toUpperCase(),i.url,!0),E.timeout=i.timeout;function b(){if(!E)return;const I=lo.from("getAllResponseHeaders"in E&&E.getAllResponseHeaders()),L={data:!a||a==="text"||a==="json"?E.responseText:E.response,status:E.status,statusText:E.statusText,headers:I,config:e,request:E};AH(function(w){r(w),g()},function(w){n(w),g()},L),E=null}"onloadend"in E?E.onloadend=b:E.onreadystatechange=function(){!E||E.readyState!==4||E.status===0&&!(E.responseURL&&E.responseURL.indexOf("file:")===0)||setTimeout(b)},E.onabort=function(){E&&(n(new Kt("Request aborted",Kt.ECONNABORTED,e,E)),E=null)},E.onerror=function(){n(new Kt("Network Error",Kt.ERR_NETWORK,e,E)),E=null},E.ontimeout=function(){let N=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const L=i.transitional||wH;i.timeoutErrorMessage&&(N=i.timeoutErrorMessage),n(new Kt(N,L.clarifyTimeoutError?Kt.ETIMEDOUT:Kt.ECONNABORTED,e,E)),E=null},s===void 0&&o.setContentType(null),"setRequestHeader"in E&&ge.forEach(o.toJSON(),function(N,L){E.setRequestHeader(L,N)}),ge.isUndefined(i.withCredentials)||(E.withCredentials=!!i.withCredentials),a&&a!=="json"&&(E.responseType=i.responseType),d&&([h,_]=R1(d,!0),E.addEventListener("progress",h)),c&&E.upload&&([u,p]=R1(c),E.upload.addEventListener("progress",u),E.upload.addEventListener("loadend",p)),(i.cancelToken||i.signal)&&(l=I=>{E&&(n(!I||I.type?new e0(null,e,E):I),E.abort(),E=null)},i.cancelToken&&i.cancelToken.subscribe(l),i.signal&&(i.signal.aborted?l():i.signal.addEventListener("abort",l)));const v=Tne(i.url);if(v&&co.protocols.indexOf(v)===-1){n(new Kt("Unsupported protocol "+v+":",Kt.ERR_BAD_REQUEST,e));return}E.send(s||null)})},kne=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let n=new AbortController,i;const s=function(d){if(!i){i=!0,a();const l=d instanceof Error?d:this.reason;n.abort(l instanceof Kt?l:new e0(l instanceof Error?l.message:l))}};let o=t&&setTimeout(()=>{o=null,s(new Kt(`timeout ${t} of ms exceeded`,Kt.ETIMEDOUT))},t);const a=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach(d=>{d.unsubscribe?d.unsubscribe(s):d.removeEventListener("abort",s)}),e=null)};e.forEach(d=>d.addEventListener("abort",s));const{signal:c}=n;return c.unsubscribe=()=>ge.asap(a),c}},Lne=function*(e,t){let r=e.byteLength;if(r<t){yield e;return}let n=0,i;for(;n<r;)i=n+t,yield e.slice(n,i),n=i},xne=async function*(e,t){for await(const r of Mne(e))yield*Lne(r,t)},Mne=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:r,value:n}=await t.read();if(r)break;yield n}}finally{await t.cancel()}},zL=(e,t,r,n)=>{const i=xne(e,t);let s=0,o,a=c=>{o||(o=!0,n&&n(c))};return new ReadableStream({async pull(c){try{const{done:d,value:l}=await i.next();if(d){a(),c.close();return}let u=l.byteLength;if(r){let h=s+=u;r(h)}c.enqueue(new Uint8Array(l))}catch(d){throw a(d),d}},cancel(c){return a(c),i.return()}},{highWaterMark:2})},nw=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",OH=nw&&typeof ReadableStream=="function",Une=nw&&(typeof TextEncoder=="function"?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),NH=(e,...t)=>{try{return!!e(...t)}catch{return!1}},jne=OH&&NH(()=>{let e=!1;const t=new Request(co.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),WL=64*1024,yO=OH&&NH(()=>ge.isReadableStream(new Response("").body)),A1={stream:yO&&(e=>e.body)};nw&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!A1[t]&&(A1[t]=ge.isFunction(e[t])?r=>r[t]():(r,n)=>{throw new Kt(`Response type '${t}' is not supported`,Kt.ERR_NOT_SUPPORT,n)})})})(new Response);const Fne=async e=>{if(e==null)return 0;if(ge.isBlob(e))return e.size;if(ge.isSpecCompliantForm(e))return(await new Request(co.origin,{method:"POST",body:e}).arrayBuffer()).byteLength;if(ge.isArrayBufferView(e)||ge.isArrayBuffer(e))return e.byteLength;if(ge.isURLSearchParams(e)&&(e=e+""),ge.isString(e))return(await Une(e)).byteLength},Bne=async(e,t)=>{const r=ge.toFiniteNumber(e.getContentLength());return r??Fne(t)},Vne=nw&&(async e=>{let{url:t,method:r,data:n,signal:i,cancelToken:s,timeout:o,onDownloadProgress:a,onUploadProgress:c,responseType:d,headers:l,withCredentials:u="same-origin",fetchOptions:h}=IH(e);d=d?(d+"").toLowerCase():"text";let p=kne([i,s&&s.toAbortSignal()],o),_;const g=p&&p.unsubscribe&&(()=>{p.unsubscribe()});let E;try{if(c&&jne&&r!=="get"&&r!=="head"&&(E=await Bne(l,n))!==0){let L=new Request(t,{method:"POST",body:n,duplex:"half"}),U;if(ge.isFormData(n)&&(U=L.headers.get("content-type"))&&l.setContentType(U),L.body){const[w,V]=VL(E,R1($L(c)));n=zL(L.body,WL,w,V)}}ge.isString(u)||(u=u?"include":"omit");const b="credentials"in Request.prototype;_=new Request(t,{...h,signal:p,method:r.toUpperCase(),headers:l.normalize().toJSON(),body:n,duplex:"half",credentials:b?u:void 0});let v=await fetch(_);const I=yO&&(d==="stream"||d==="response");if(yO&&(a||I&&g)){const L={};["status","statusText","headers"].forEach(z=>{L[z]=v[z]});const U=ge.toFiniteNumber(v.headers.get("content-length")),[w,V]=a&&VL(U,R1($L(a),!0))||[];v=new Response(zL(v.body,WL,w,()=>{V&&V(),g&&g()}),L)}d=d||"text";let N=await A1[ge.findKey(A1,d)||"text"](v,e);return!I&&g&&g(),await new Promise((L,U)=>{AH(L,U,{data:N,headers:lo.from(v.headers),status:v.status,statusText:v.statusText,config:e,request:_})})}catch(b){throw g&&g(),b&&b.name==="TypeError"&&/fetch/i.test(b.message)?Object.assign(new Kt("Network Error",Kt.ERR_NETWORK,e,_),{cause:b.cause||b}):Kt.from(b,b&&b.code,e,_)}}),bO={http:rne,xhr:Pne,fetch:Vne};ge.forEach(bO,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const GL=e=>`- ${e}`,$ne=e=>ge.isFunction(e)||e===null||e===!1,DH={getAdapter:e=>{e=ge.isArray(e)?e:[e];const{length:t}=e;let r,n;const i={};for(let s=0;s<t;s++){r=e[s];let o;if(n=r,!$ne(r)&&(n=bO[(o=String(r)).toLowerCase()],n===void 0))throw new Kt(`Unknown adapter '${o}'`);if(n)break;i[o||"#"+s]=n}if(!n){const s=Object.entries(i).map(([a,c])=>`adapter ${a} `+(c===!1?"is not supported by the environment":"is not available in the build"));let o=t?s.length>1?`since :
`+s.map(GL).join(`
`):" "+GL(s[0]):"as no adapter specified";throw new Kt("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return n},adapters:bO};function eR(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new e0(null,e)}function qL(e){return eR(e),e.headers=lo.from(e.headers),e.data=ZT.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),DH.getAdapter(e.adapter||jE.adapter)(e).then(function(n){return eR(e),n.data=ZT.call(e,e.transformResponse,n),n.headers=lo.from(n.headers),n},function(n){return RH(n)||(eR(e),n&&n.response&&(n.response.data=ZT.call(e,e.transformResponse,n.response),n.response.headers=lo.from(n.response.headers))),Promise.reject(n)})}const PH="1.7.7",$D={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{$D[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const KL={};$D.transitional=function(t,r,n){function i(s,o){return"[Axios v"+PH+"] Transitional option '"+s+"'"+o+(n?". "+n:"")}return(s,o,a)=>{if(t===!1)throw new Kt(i(o," has been removed"+(r?" in "+r:"")),Kt.ERR_DEPRECATED);return r&&!KL[o]&&(KL[o]=!0,console.warn(i(o," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(s,o,a):!0}};function Hne(e,t,r){if(typeof e!="object")throw new Kt("options must be an object",Kt.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let i=n.length;for(;i-- >0;){const s=n[i],o=t[s];if(o){const a=e[s],c=a===void 0||o(a,s,e);if(c!==!0)throw new Kt("option "+s+" must be "+c,Kt.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new Kt("Unknown option "+s,Kt.ERR_BAD_OPTION)}}const SO={assertOptions:Hne,validators:$D},kl=SO.validators;class Xh{constructor(t){this.defaults=t,this.interceptors={request:new FL,response:new FL}}async request(t,r){try{return await this._request(t,r)}catch(n){if(n instanceof Error){let i;Error.captureStackTrace?Error.captureStackTrace(i={}):i=new Error;const s=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?s&&!String(n.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+s):n.stack=s}catch{}}throw n}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=hf(this.defaults,r);const{transitional:n,paramsSerializer:i,headers:s}=r;n!==void 0&&SO.assertOptions(n,{silentJSONParsing:kl.transitional(kl.boolean),forcedJSONParsing:kl.transitional(kl.boolean),clarifyTimeoutError:kl.transitional(kl.boolean)},!1),i!=null&&(ge.isFunction(i)?r.paramsSerializer={serialize:i}:SO.assertOptions(i,{encode:kl.function,serialize:kl.function},!0)),r.method=(r.method||this.defaults.method||"get").toLowerCase();let o=s&&ge.merge(s.common,s[r.method]);s&&ge.forEach(["delete","get","head","post","put","patch","common"],_=>{delete s[_]}),r.headers=lo.concat(o,s);const a=[];let c=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(r)===!1||(c=c&&g.synchronous,a.unshift(g.fulfilled,g.rejected))});const d=[];this.interceptors.response.forEach(function(g){d.push(g.fulfilled,g.rejected)});let l,u=0,h;if(!c){const _=[qL.bind(this),void 0];for(_.unshift.apply(_,a),_.push.apply(_,d),h=_.length,l=Promise.resolve(r);u<h;)l=l.then(_[u++],_[u++]);return l}h=a.length;let p=r;for(u=0;u<h;){const _=a[u++],g=a[u++];try{p=_(p)}catch(E){g.call(this,E);break}}try{l=qL.call(this,p)}catch(_){return Promise.reject(_)}for(u=0,h=d.length;u<h;)l=l.then(d[u++],d[u++]);return l}getUri(t){t=hf(this.defaults,t);const r=CH(t.baseURL,t.url);return SH(r,t.params,t.paramsSerializer)}}ge.forEach(["delete","get","head","options"],function(t){Xh.prototype[t]=function(r,n){return this.request(hf(n||{},{method:t,url:r,data:(n||{}).data}))}});ge.forEach(["post","put","patch"],function(t){function r(n){return function(s,o,a){return this.request(hf(a||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}Xh.prototype[t]=r(),Xh.prototype[t+"Form"]=r(!0)});class HD{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(s){r=s});const n=this;this.promise.then(i=>{if(!n._listeners)return;let s=n._listeners.length;for(;s-- >0;)n._listeners[s](i);n._listeners=null}),this.promise.then=i=>{let s;const o=new Promise(a=>{n.subscribe(a),s=a}).then(i);return o.cancel=function(){n.unsubscribe(s)},o},t(function(s,o,a){n.reason||(n.reason=new e0(s,o,a),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=n=>{t.abort(n)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new HD(function(i){t=i}),cancel:t}}}function zne(e){return function(r){return e.apply(null,r)}}function Wne(e){return ge.isObject(e)&&e.isAxiosError===!0}const wO={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(wO).forEach(([e,t])=>{wO[t]=e});function kH(e){const t=new Xh(e),r=lH(Xh.prototype.request,t);return ge.extend(r,Xh.prototype,t,{allOwnKeys:!0}),ge.extend(r,t,null,{allOwnKeys:!0}),r.create=function(i){return kH(hf(e,i))},r}const xr=kH(jE);xr.Axios=Xh;xr.CanceledError=e0;xr.CancelToken=HD;xr.isCancel=RH;xr.VERSION=PH;xr.toFormData=rw;xr.AxiosError=Kt;xr.Cancel=xr.CanceledError;xr.all=function(t){return Promise.all(t)};xr.spread=zne;xr.isAxiosError=Wne;xr.mergeConfig=hf;xr.AxiosHeaders=lo;xr.formToJSON=e=>TH(ge.isHTMLForm(e)?new FormData(e):e);xr.getAdapter=DH.getAdapter;xr.HttpStatusCode=wO;xr.default=xr;function Gne(){const e=Ho(),{register:t,handleSubmit:r,formState:{errors:n}}=dH(),i=async s=>{try{await xr.post("http://localhost:5000/signup",s),e("/home"),localStorage.setItem("token",response.data.token)}catch(o){alert(o.response.data.error)}};return O.jsx(O.Fragment,{children:O.jsx("center",{children:O.jsxs("section",{style:{backgroundColor:"aqua",borderRadius:30},children:[O.jsx("h1",{style:{color:"black"},children:"Sign Up ❤️"}),O.jsxs("form",{onSubmit:r(i),children:[O.jsx("label",{htmlFor:"username",style:{color:"black"},children:"Username:"}),O.jsx("input",{type:"text",placeholder:"Username",...t("username",{required:"Username is required"})}),n.username&&O.jsx("p",{children:n.username.message}),O.jsx("label",{htmlFor:"email",style:{color:"black"},children:"Email:"}),O.jsx("input",{type:"email",placeholder:"Email",...t("email",{required:"Email is required"})}),n.email&&O.jsx("p",{children:n.email.message}),O.jsx("label",{htmlFor:"password",style:{color:"black"},children:"Password:"}),O.jsx("input",{type:"password",placeholder:"Password",...t("password",{required:"Password is required"})}),n.password&&O.jsx("p",{children:n.password.message}),O.jsx("button",{type:"submit",style:{cursor:"pointer"},children:"Sign Up"})]})]})})})}const LH="/assets/bonds-B36rkIiD.png";function iw(){return O.jsx(O.Fragment,{children:O.jsx("center",{children:O.jsxs("div",{style:{display:"flex",justifyContent:"center",width:"50%"},children:[O.jsx("h1",{style:{color:"white",width:"50%",marginTop:23},children:"Bonds"}),O.jsx("a",{href:"/",target:"_blank",style:{width:"50%"},children:O.jsx("img",{src:LH,style:{height:100,width:100},className:"logo react",alt:"Bonds logo"})})]})})})}function mi(){return O.jsx(O.Fragment,{children:O.jsx("center",{children:O.jsx("p",{style:{fontSize:14,marginTop:8},children:"Copyright ©️ 2024 Bringer App Ltd. All rights reserved."})})})}function qne(){return O.jsxs(O.Fragment,{children:[O.jsx(iw,{}),O.jsx(Jte,{}),O.jsx(Gne,{}),O.jsx(mi,{})]})}function zD(){return O.jsx(O.Fragment,{children:O.jsx(tr,{to:"/signup",style:{textDecoration:"none"},children:O.jsx("div",{style:{display:"flex",marginBottom:30,justifyContent:"center"},children:O.jsx("h5",{style:{color:"white",paddingLeft:150,paddingRight:150},children:"Sign Up Instead"})})})})}function Kne(){const[e,t]=me.useState(!1),[r,n]=me.useState(""),i=Ho(),{register:s,handleSubmit:o,formState:{errors:a}}=dH(),c=async d=>{t(!0),n("");try{const l=await xr.post("http://localhost:5000/login",d);i("/home"),localStorage.setItem("token",l.data.token)}catch{n("Invalid credentials, please try again.")}finally{t(!1)}};return O.jsx(O.Fragment,{children:O.jsx("center",{children:O.jsxs("section",{style:{borderRadius:20,height:420,justifyContent:"center",backgroundColor:"aqua"},children:[e&&O.jsx("p",{children:"Loading..."})," ",r&&O.jsx("p",{style:{color:"red"},children:r}),O.jsx("form",{onSubmit:o(c),children:O.jsxs("center",{children:[O.jsx("h3",{style:{paddingTop:6,color:"black"},children:"Login 💚"}),O.jsx("label",{htmlFor:"username",style:{color:"black"},children:"Username:"}),O.jsx("br",{}),O.jsx("input",{type:"text",placeholder:"Username",...s("username",{required:"Username is required"})}),a.username&&O.jsx("p",{children:a.username.message}),O.jsx("br",{}),O.jsx("br",{}),O.jsx("label",{htmlFor:"password",style:{color:"black"},children:"Password:"}),O.jsx("br",{}),O.jsx("input",{type:"password",placeholder:"Password",...s("password",{required:"Password is required"})}),a.password&&O.jsx("p",{children:a.password.message}),O.jsx("br",{}),O.jsx(tr,{to:"/forgotpassword",style:{textDecoration:"none"},children:O.jsx("h5",{style:{marginTop:20,color:"black"},children:"Forgot Password?"})}),O.jsx("button",{type:"submit",disabled:e,style:{paddingLeft:60,paddingRight:60,paddingTop:10,paddingBottom:10,fontSize:16,fontWeight:"bold",cursor:"pointer"},children:"Login"})]})})]})})})}function Yne(){return O.jsxs(O.Fragment,{children:[O.jsx(iw,{}),O.jsx(zD,{}),O.jsx(Kne,{}),O.jsx(mi,{})]})}function Jne(){return O.jsx(O.Fragment,{children:O.jsx("div",{style:{borderRadius:20,paddingLeft:20,paddingRight:20,height:420,marginLeft:500,marginRight:500,justifyContent:"center",backgroundColor:"aqua"},children:O.jsx("form",{style:{},children:O.jsxs("center",{children:[O.jsx("h3",{style:{paddingTop:12,color:"black"},children:"Forgot Password 😕"}),O.jsx("br",{}),O.jsx("br",{}),O.jsx("p",{style:{color:"black"},children:"Enter email address below to change password:"}),O.jsx("p",{style:{marginTop:20,color:"black"},children:"email address:"}),O.jsx("input",{type:"email"}),O.jsx("br",{}),O.jsx("br",{}),O.jsx(tr,{to:"/resetpassword",children:O.jsx("button",{style:{paddingLeft:60,paddingRight:60,paddingTop:10,paddingBottom:10,fontSize:16,fontWeight:"bold",cursor:"pointer"},children:"Reset Password"})})]})})})})}function Xne(){return O.jsxs(O.Fragment,{children:[O.jsx(iw,{}),O.jsx(zD,{}),O.jsx(Jne,{}),O.jsx(mi,{})]})}function Qne(){return O.jsx(O.Fragment,{children:O.jsx("div",{style:{borderRadius:20,paddingLeft:20,paddingRight:20,height:630,marginLeft:500,marginRight:500,justifyContent:"center",backgroundColor:"aqua"},children:O.jsx("form",{style:{},children:O.jsxs("center",{children:[O.jsx("h3",{style:{paddingTop:12,color:"black"},children:"Reset Password"}),O.jsx("br",{}),O.jsx("br",{}),O.jsx("p",{style:{color:"black"},children:"A six digit pin has been sent to ak...@outlook.com. Enter it below to reset your password."}),O.jsx("p",{style:{marginTop:20,color:"black"},children:"six digit pin:"}),O.jsx("input",{type:"text"}),O.jsx("br",{}),O.jsx("p",{style:{marginTop:20,color:"black"},children:"new password:"}),O.jsx("input",{type:"text"}),O.jsx("br",{}),O.jsx("p",{style:{marginTop:20,color:"black"},children:"confirm new password:"}),O.jsx("input",{type:"text"}),O.jsx("br",{}),O.jsx(tr,{to:"/resetpassword",children:O.jsx("button",{style:{paddingLeft:60,paddingRight:60,paddingTop:10,paddingBottom:10,fontSize:16,fontWeight:"bold",cursor:"pointer"},children:"Reset Password"})})]})})})})}function Zne(){return O.jsxs(O.Fragment,{children:[O.jsx(iw,{}),O.jsx(zD,{}),O.jsx(Qne,{}),O.jsx(mi,{})]})}function xH(){return O.jsx(O.Fragment,{children:O.jsx(tr,{to:"/home",style:{textDecoration:"none"},children:O.jsx("h1",{style:{textAlign:"left",paddingLeft:20},children:"Bonds"})})})}function eie(e){return O.jsx(O.Fragment,{children:O.jsx(tr,{to:"/bondhighlight",style:{textDecoration:"none"},children:O.jsxs("div",{style:{cursor:"pointer"},children:[O.jsx("div",{style:{display:"flex",marginLeft:40},children:O.jsx("img",{src:e.img,style:{height:68,width:76,borderTopLeftRadius:50,borderBottomRightRadius:50,border:"4px solid aqua"}})}),O.jsx("p",{style:{paddingLeft:35,fontSize:16,display:"inline",whiteSpace:"nowrap"},children:O.jsx("b",{children:e.name})})]})})})}function tie(e){return O.jsx(O.Fragment,{children:O.jsxs("div",{className:"yourAdmirerItem",style:{marginBottom:12,width:460,height:193,border:"3px solid yellow",borderRadius:14},children:[O.jsx("img",{src:e.bgImg,className:"dateImage"}),O.jsxs("div",{className:"dateImageContent",children:[O.jsx("div",{style:{float:"left",marginLeft:40,marginTop:33},children:O.jsxs(tr,{to:"/activedate",style:{textDecoration:"none"},children:[O.jsx("img",{src:e.artistImg,style:{borderRadius:40,width:80,height:80,border:"4px solid limegreen"}}),O.jsx("p",{style:{fontSize:17},children:O.jsx("b",{children:e.name})})]})}),O.jsxs("div",{style:{marginTop:53,float:"right",marginRight:20},children:[O.jsx(tr,{to:"/activedate",style:{textDecoration:"none"},children:O.jsx("button",{style:{float:"center",fontSize:17,borderRadius:25,paddingRight:40,paddingLeft:40,cursor:"pointer"},children:O.jsx("b",{children:e.status==="Ongoing"?"Join":e.status==="Finished"?"Watch Bond":e.status==="Not Yet Started"&&"JOIN & WAIT"})})}),O.jsxs("p",{style:{float:"center",fontSize:17},children:[O.jsx("span",{style:{color:e.status==="Ongoing"?"limegreen":e.status==="Finished"?"red":e.status==="Not Yet Started"&&"yellow",fontSize:20},children:"• "})," ",e.status]})]})]})]})})}const WD="/assets/myPic-CA19-zfc.png",rie="/assets/ini-C0Gg5Xwn.jpg",nie="/assets/beyonce-DzpshlB0.jfif",iie="/assets/chisom-BJ4RVSOd.jpg",MH="/assets/eyhit-De7dmm7x.jpeg",sw="/assets/jimmy-C88E3poj.jpg",sie="/assets/cruel2-DRDJFmnc.jpg",YL="/assets/santino-BDJoa8zE.jfif",oie="/assets/drake-cfClWwhl.png",aie="/assets/drake-C8XFpIt3.jfif",cie="/assets/ccp-Cpi4Dhrl.jpg",TO=[{username:"brileyakang",profilePhoto:WD,walletAddr:"0xdk...5392",location:"Tokyo",bio:"life is but a journey, each trip leaves a landmark for the next mile.",dates:[{id:1,songPic:MH,ownerPic:sw,timeStarting:"2:00PM",artistName:"Odunsi (The Engine)",songTitle:"No PDA!"}],ongoingBonds:[{_id:"890dhsd089h8sd807dsh0h90sdh0",bgImg:sie,artistImg:YL,name:"ojiims",status:"Ongoing"},{_id:"sd88sdhf89ehe39h3hphw9phehp83",bgImg:oie,artistImg:aie,name:"somiethebeast",status:"Finished"},{_id:"0d8hchw08wrfhwp83h939h4h3fp3h",bgImg:cie,artistImg:YL,name:"ojiims",status:"Not Yet Started"}],myBonds:[{img:rie,name:"Organized ...",content:"https://IPFS-LINK"},{img:nie,name:"Beyonce",content:"https://IPFS-LINK"},{img:iie,name:"Chisom",content:"https://IPFS-LINK"}]}],die=()=>{const e=xr.create({baseURL:"http://localhost:5000/"});return me.useEffect(()=>{const t=xr.interceptors.request.use(n=>n,function(n){return promise.reject(n)}),r=xr.interceptors.response.use(n=>n,function(n){return Promise.reject(n)});return()=>{e.interceptors.request.eject(t),e.interceptors.response.eject(r)}},[e]),e};class Cg extends Error{}Cg.prototype.name="InvalidTokenError";function lie(e){return decodeURIComponent(atob(e).replace(/(.)/g,(t,r)=>{let n=r.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}function uie(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return lie(t)}catch{return atob(t)}}function t0(e,t){if(typeof e!="string")throw new Cg("Invalid token specified: must be a string");t||(t={});const r=t.header===!0?0:1,n=e.split(".")[r];if(typeof n!="string")throw new Cg(`Invalid token specified: missing part #${r+1}`);let i;try{i=uie(n)}catch(s){throw new Cg(`Invalid token specified: invalid base64 for part #${r+1} (${s.message})`)}try{return JSON.parse(i)}catch(s){throw new Cg(`Invalid token specified: invalid json for part #${r+1} (${s.message})`)}}function hie(){const[e,t]=me.useState(""),[r,n]=me.useState(""),i=Ho();me.useEffect(()=>{const _=localStorage.getItem("token");if(_)try{const g=t0(_);t(g.username);const E=new Date(g.exp*1e3);n(`Token expires at (Date):, ${E}`)}catch{console.error("Invalid token"),i("/login")}else i("/login")},[i]),console.log("Hiiiii",localStorage.getItem("token"));const s=e.charAt(0).toUpperCase()+e.slice(1),o=die(),[a,c]=me.useState([]);me.useEffect(()=>{(async()=>{const g=await o.get(`/users/${e}/myBonds`);console.log(g.data),c(g.data)})()},[]);const[d,l]=me.useState([]);me.useEffect(()=>{(async()=>{const g=await o.get(`/users/${e}/ongoingBonds`);console.log(g.data),l(g.data)})()},[]);const u=a.map(_=>O.jsx(eie,{img:_.img,name:_.name},_.name)),h=d.map(_=>O.jsx(tie,{bgImg:_.bgImg,artistImg:_.artistImg,name:_.name,status:_.status},_.bgImg)),p={dave:{bondId:"dave"},ojims:{bondId:"ojims"}};return O.jsx(O.Fragment,{children:O.jsxs("div",{style:{color:"white",width:"80%",marginTop:0,float:"left"},children:[O.jsx(xH,{}),O.jsx("h4",{style:{textAlign:"left",paddingLeft:20,whiteSpace:"nowrap"},children:"My Bonds"}),O.jsxs("div",{style:{marginLeft:20,display:"flex",justifyContent:"flex-start"},children:[O.jsx(tr,{to:"/formabond",style:{textDecoration:"none"},children:O.jsxs("div",{style:{cursor:"pointer"},children:[O.jsx("div",{style:{display:"flex"},children:O.jsx("img",{src:WD,style:{height:68,width:76,borderTopLeftRadius:50,borderBottomRightRadius:50,border:"4px solid transparent"}})}),O.jsxs("p",{style:{fontSize:16,display:"inline",whiteSpace:"nowrap"},children:[s,", form a bond"]})]})}),O.jsx("div",{style:{overflowX:"auto",display:"flex",scrollbarWidth:"thin"},children:u})]}),O.jsx("h5",{style:{textAlign:"left",paddingLeft:40,whiteSpace:"nowrap"},children:"Your Adorers"}),O.jsxs("div",{style:{overflowY:"auto",display:"flow",height:220,marginLeft:15,justifyContent:"center"},children:[O.jsx(tr,{to:`/activedate?bondId=${p.dave.bondId}`,children:O.jsx("h1",{children:"Dave"})}),O.jsx(tr,{to:`/activedate?bondId=${p.ojims.bondId}`,children:O.jsx("h1",{children:"Ojims"})}),h]})]})})}const fie="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD8AAAA/CAYAAABXXxDfAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAMySURBVGhD7Zs9TypBFIaHSygQOhWBikBiopRWhgIKgxbCH1D8AZrYqNHGxspYmJgQEloKCmrE1lJRIaGzo5DQUKBUrKtzmc3hetHha2d2wcw8yRt3Nrsz59kd90PEgjsgQfkDP4VEyouKlBcVKS8qUl5UpPwkSCaTWiYKebY3m6OjI/I+oeX4+BjWmo/p8oeHh//EuyEHYxKYJl+r1fDBwcEP8W7W1tbw3d0dbG0OpsgTKY/HQ5X+PwsLC7hYLMJexmO4/NPTE3a73VRZWshBKpVKsLexGCpPzqLL5aJKDgqZAY+Pj9CLcRgmT6b67OwsVW6UzM3N4fv7e+jNGLjLv7+/49vbW11n/HtIH+TuQPo0Aq7yqqri7e1tbLFYqDJ6k0gkcKvVglH4wU1eURRNnFY8j3i9XlwoFGA0PnCRb7fbeGtri1o0z8zMzOBqtQqjssMsb/QZ/56dnR1u1wAm+UajYap4NxsbG/jm5gaq0I9u+evra+12RCvOjDidTuYDoEueiNvtdmpRZoZcA1gugmPL5/N57HA4qMVMIqQWcjL0MJY8ESfTjVbEJENq0nMARpInV1fS+TSKd0NqOzk5wW9vb1D1cIbKv76+4vX1dWyz2aiDTlui0ahW8ygMlG82m1pntEGmOeRWOMoBGCi/ublJ7fw3JB6Pg0V/Bv71tl6vw9LvY5TaB/5nxvPzM8pms9Cik0qlUOdJD1rm0Hm4Qru7u9Ci03nXQIuLi9Dqg3b+GVheXv4x5YxOMBiE0dlg/tDi8/MTlsyD15jy4ypRkfKiIuVFRcqLCrP8x8cHLA3H6/WicrmMKpVKT/b392GL0VAUBZYYgSc93YTDYeojKC0+nw/26uX8/Jy6fb9cXl7Cnmwwn/nT01Nks9mgNZjOeEhVVWh9Mc7sIaysrMASG8zykUgEra6uQst4zs7OUCgUghYbzPJWqxVdXV2hWCwGa/rTbrdhqRfabPjO0tISuri40GYaGZMHXL9p8fDwoL1xdX4n0cvLC6z9wu12o1wu96P4TCaD0uk0tHrZ29tDgUAA+f1+ND8/D2v5IL9mIipSXlSkvKhIeVGR8qIi5cUEob+aEx2kV7V54gAAAABJRU5ErkJggg==",pie="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD8AAAA/CAYAAABXXxDfAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAU7SURBVGhD7ZnZK35dFMeXecg8U6K4oMyzSCIuSEQo01/gv3HrjgsiKeJCcYWMmTOUkHnIPA/v+37X72zvebz4vc7Z5xed51N6nrOfY5/9XXvttddex+avfyCTYqt8mhKreLNiFW9WrOLNilW8WbGKNyuG5/ZbW1t0f39PNjY2Ssu/2NvbU3h4uHL15zFE/MXFBU1NTdHGxgZtbm7Sw8PDf8TjsUJ8aGgopaamkpeXl/Lrn0GqeHQ1NDRE09PTdHp6ym0Q+N6sC56envj/PDw8KDExkQoKCj69XybSxENEX18fjY6OkoODA9nafi2cvLy80OPjI8XExFB6ejpFRkYqvxiHFPHr6+vU3d3Ns21nZ6e0/hKEv49mEo+GkdSGggEcHR2purqaoqKilFZj0C3+/Pycmpqa6O7ujl1cgHXu7u5OcXFxlJCQoLRasri4SDMzM3R2dsaCBTAYjFhVVUXR0dFKq3x0iccge3p6aHx8nF0doLvn52fKzs6mlJQU8vPz4/aPgLcgRgwODrIHCM+BBwQEBFBjY6OFN8lEl/je3l4aHh4mJycnpeXXoPPy8ig/P19p+X/Mz8/TyMgIbW9vv4pFHEEQrKio4GvZaE5yjo+PaW5u7nXGAVw9Nzf3y8JBbGwslZeX83cxHzAClsbu7i5fy0aTeLj72NgYXV1dvQYruDpmHFuVVnx9famwsPBVPAIlEiR4BLxANprFY9ZFgMO1j48P5eTk8LVWYMisrCwKDAzkPgGesbS0xMtJNprELywscHQXWxgGmpmZaRGxtSIMoJ59zDqMLRtN4rEGRcoK4UhLk5KSlF/1Ex8fT/7+/ryUAD4RCGWjSTwCkTpxwXd1oqIX9KfuHxix3ckb8Q/EKt6sSBEve82Dt2veCDSNWOzBAINEIoKMTxY46Nze3loYQP1MWWgSn5ycTK6urrwXY4CXl5d8jpcxQPSJ7BEHHngTrpE/pKWlKXfIQ5N4ZHM4rgqxyO9xNBXVGz0gZZ6cnLQ4JcLQvzsdakGTeKScyMKEeMw+EpG2tja6ubnhNi0ghUUf6uwR/WZkZJCzszNfy0RzlEKBAlmYOHDARXd2djj11cLy8jIfj1HtFQkNjOvt7c3FTSPQdZ5fWVmhjo4OnjHMFLrCZ1hYGFVWVpKbm5ty5+egDNbc3Mzf1ecDeEBJSQl7mRHoLmN1dXXRxMTEa0ED3cEbcDxFYETOj/jwHtfX1zQ7O8trHLuFeruEu6OICSNizRuBbvGYnfb2dlpdXbUobGDwcFsYISIiQmm1BDX9g4MDFv02d4cBsdaLioqk5xAC3eIB9nlhgLeHHhgAhngP3PuZMBi2traWqzxGIEU8wEytra1xDIAxfidMDYYAA8Fo+BP/B8PhuFxXV8fFTNlIEy/A2kXCg6iP11bqcvZ7wGgIjHhZgRnu7OzkpEksA/zu6elJDQ0NXOGRiXTxgqOjIzo8POT6GwLbWy/AYxEkEcmxZQYFBXH73t4etbS0vGsAeEBwcDC3ycAw8XrY399nA+CFiPAcYYD6+vpXQ+nFmDCqE4hDoMMWCdEARoAxWltbpR2ivqV4EBISwrOsPkPAACcnJ/yGSAbfVjyAAWpqajg+iNWJOIE4glfhevnW4gEMgExRXbeHBwwMDPBZQA/fXjwifmlpKR9uUC4XoB1pMXYFrXx78QCJT1lZGRsACRRiADwBJz4XFxflrq/zLbe6j4Do/v5+fn2FgkpxcbGube9HiRegYoRZ18uPFC+LH7HmjcIq3qxYxZsVq3izYhVvVqzizQnR35U8qRReBmthAAAAAElFTkSuQmCC",mie="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD4AAAA/CAYAAAC4nXvhAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAY1SURBVGhD7ZpZTxRLGIY/VJQloAKCgICKCBINGgQEErnXcAkJ/gT+Df+AYLgBLkASrgyJ0Ug0RkEBJSwihLALsoOI5zxlt4FxlqruZs6JM08ymaG6ma636tuqamJ+/otEICes94gjKjzSiAqPNKLCI42o8EgjbJXb9+/fZXJyUmJiYqyWXxwcHEhaWpqkpKRYLeHh2ISvrq7K1taWLC8vy9TUlCQkJEhqaqqcOHHUyBBu33fu3Dm5cuWKnDx5UjIyMqw7jgfPhW9sbMj79++VIMjOzpZLly4pwQgKBBbB/378+FHdu7OzI8XFxZKenm7d4S2eCd/d3ZX+/n7Z3NyUoqIiyczM/MOsTVhfX5eBgQGhe9euXVPf5yWeCB8fH5f5+XnJzc1VsxsIHjU6OqreecXFxcnly5etq/7BBUZGRtTn8vJyOXXqlPrsFtfCP336pHy0oKBAkpKSrNaj7O/vy5MnT2RxcVH5u/3IM2fOKFe4fv263L9/X7UFYmFhQT5//ix3794N6jK6uBKOaP79xo0bVstRuDY8PCwvX75UncZ3D88Y1xkU2vmO2tragIMHzH5fX5+Ulpa6Nn3HeZwgFEw0EKC6urpUGjt9+vQfZkoMiI2NVTNIQHzz5o11xT9kBWacQfzx44fV6gxHwhENoUR3dnbK9va2EhcK/P3p06fy7Nkzq8U/Fy9eVMGOQcJanGIsnEDDTAUTDfj90NCQkT/yvW/fvrX+CgwpjnzPvaRBJxgJJ2VNT0+rdBWKUGbrDwZpbW1NxY5QIB7XmZmZsVrMMBI+ODioIrAOpDfTuMmM4yJfv361WoJz69YtGRsb+10smaAtnDSErwbL0+GG/ly4cEG+fPlitehjJJwU4ltrByIrK8u4csNC4uPj1aJFF2INBZQpWiooQzEnFhG63Llzx9jUSVHkcV13AtIkkd5UvJZwFg88QCct2SQmJirxuvmWQSK4VVRUWC36nD17Vr59+2Y00FrCqb5u3rxp/aUH5SiVGJ3SEU9QI0VVVVVZLfrk5OSoqs4ktWkJZyRN/RUQ39jYKCUlJUqYb8HB99JZ3svKyuThw4fWFXNMZhtC1uqkJUpOOqYb2Hxhxnt6en4vNHgkLwaG4FRTU+N644Hgy6zjXjqEFE7BMjc3p4R7wWHhlKmszryAlR9LXl1XCTmFTkw8GPjx1atXJT8/3zPRwECa9NWZ7f4FhE34xMSE2kr68OGDevEZ0/yvOFYfp5QkMLJKwweJ7LY58lhqA8yd4Mf7vXv3HG8uLi0tqZVjdXW11RKckMIRjQDdqI4IZvf58+eqmrKFUpz4+iCPtnM8nylXWXiwDXX+/HnVrsurV69U/NAduJBKKAfZ8WRJGgo2HTo6OqS5uVmJp9Jj6cjLX+Chzb7OveT0169fS1NTk7x7985oo2FlZcXoUEJrz43lKCUoIxoIqju2mdiAMNl88Add4oX5P3r0KOg+HFCu0kdcRffZWsGNbWN8NRBsRbW1takZdysasATcChdrbW1Vi6RgULgwOCbP1hLO8Q+myLGQL8w0olm9Oa3sAkHwI7g+fvw4qHjuoS4wQaun+CDlJb5+GGa6vb1dBSivRdsw4AhraWlRJu0LcYD4gyuaoN3b27dvq3rYfjgPw6ftffHjBPE8u7e312r5BXGAaO4k1Wr3mIfn5eWpFMUMIxrz88KndcDs2XvnfM5mdnZW9cs09YHRVLHfhlhSDdVXuEQDAY90R32AtTHbVH6FhYXWHWYY2ygHdwQ0u/AIJ8QaCipmnpKXLSo2OpxgLJwg19DQoCqsvb09qzV8YGUvXrxQG59uzs8cRSX8qq6uLuziSZlY2oMHD1xvXGhVboGgE+RwTI/g468s9QoGmJK0vr5ebV1j9m5wJRwION3d3SqnU7m57ZAvzDIDSvXI5qVXPw1xLdyGkpbTUZaH5HU668YC6BaDSinKUjPUDwdM8Uw4YPqcYPJDAA7/7NpdN+3ZYhkwKjHOwskiJgcZungq3IY8i3CqKtIP1oAVBEqBduWXnJysdl1xl8rKSsepSodjEX4YghKLGwaCn3H4lreUvPx+hsN+dl0RHw6OXfj/FUd5/G8gKjzSiAqPNKLCI42o8EgjQoWL/AOVhWaPO0zuXwAAAABJRU5ErkJggg==";function mo(){return O.jsx(O.Fragment,{children:O.jsxs("div",{style:{width:"20%",display:"flow",height:"610px",marginTop:0,borderTopRightRadius:40,borderBottomRightRadius:40,backgroundColor:"rgb(2, 244, 35)",zIndex:100},children:[O.jsx("div",{style:{borderTopRightRadius:40},className:"sidebar-element",children:O.jsx(tr,{to:"/home",style:{textDecoration:"none"},children:O.jsx("img",{src:fie,style:{borderRadius:35,marginTop:20},className:"sidebar-icons",alt:"Bonds logo"})})}),O.jsx("div",{style:{},className:"sidebar-element",children:O.jsx(tr,{to:"/search",style:{textDecoration:"none"},children:O.jsx("img",{src:pie,style:{borderRadius:35,marginTop:8},className:"sidebar-icons",alt:"Bonds logo"})})}),O.jsx("div",{style:{},className:"sidebar-element",children:O.jsx(tr,{to:"/options",style:{textDecoration:"none"},children:O.jsx("img",{src:LH,style:{borderRadius:35,marginTop:8},className:"sidebar-icons",alt:"Bonds logo"})})}),O.jsx("div",{style:{},className:"sidebar-element",children:O.jsx(tr,{to:"/myprofile",style:{textDecoration:"none"},children:O.jsx("img",{src:mie,style:{borderRadius:35,marginTop:8},className:"sidebar-icons",alt:"Bonds logo"})})}),O.jsx("div",{style:{paddingLeft:6,paddingTop:8,paddingBottom:8},className:"sidebar-element",children:O.jsx(tr,{to:"/connectwallet",style:{textDecoration:"none"},children:O.jsx("center",{children:O.jsxs("p",{style:{fontWeight:"bold",cursor:"pointer"},className:"sidebar-text",children:["Connect ",O.jsx("br",{}),"Wallet"]})})})})]})})}function gie(){return O.jsx(O.Fragment,{children:O.jsx("div",{children:O.jsxs("center",{children:[O.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",width:"50%",minWidth:300,height:"100%",backgroundColor:"rgb(119, 63, 248)",borderRadius:40},children:[O.jsx(hie,{}),O.jsx(mo,{})]}),O.jsx(mi,{})]})})})}function _ie(e){return O.jsx(O.Fragment,{children:O.jsx(tr,{to:"/ownedAsset",style:{textDecoration:"none"},children:O.jsxs("div",{style:{cursor:"pointer"},children:[O.jsx("div",{style:{display:"flex",marginLeft:40},children:O.jsx("img",{src:e.bgImg,style:{height:68,width:76,borderTopLeftRadius:50,borderBottomRightRadius:50,border:"4px solid transparent"}})}),O.jsx("p",{style:{paddingLeft:35,fontSize:16,display:"inline",whiteSpace:"nowrap"},children:O.jsx("b",{children:e.songTitle})})]})})})}function Eie(e){return O.jsx(O.Fragment,{children:O.jsxs("div",{className:"yourAdmirerItem",style:{marginBottom:12,width:460,height:193,border:"3px solid yellow",borderRadius:14},children:[O.jsx("img",{src:e.bgImg,className:"dateImage"}),O.jsxs("div",{className:"dateImageContent",children:[O.jsx("div",{style:{float:"left",marginLeft:40,marginTop:80},children:O.jsxs(tr,{to:"/ongoingswap",style:{textDecoration:"none"},children:[O.jsx("img",{src:e.artistImg,style:{borderRadius:40,width:80,height:80,border:"4px solid limegreen"}}),O.jsx("p",{style:{fontSize:17},children:O.jsx("b",{children:e.name})})]})}),O.jsxs("div",{style:{marginTop:93,float:"right",marginRight:20,lineHeight:.1},children:[O.jsx(tr,{to:"/ongoingswap",style:{textDecoration:"none"},children:O.jsx("button",{style:{float:"center",fontSize:17,borderRadius:25,paddingRight:40,paddingLeft:40,cursor:"pointer"},children:O.jsx("b",{children:"Partake"})})}),O.jsx("p",{style:{float:"center",fontSize:17,paddingTop:12},children:e.timeRemaining})]})]})]})})}const vie="/assets/bonds_black-Chr25ipy.png",UH=[{_id:"093209489435934953it3t943i9r3i340934",bgImg:MH,profileImg:sw,username:"thejvictor",artistName:"Odunsi (The Engine)",songTitle:"No PDA!"}],jH="/assets/betty-Bm-jMpi9.jpg",yie="/assets/betty2-DoFmiN85.jpg",bie=[{artistImg:jH,bgImg:yie,name:"Pa Salieu",timeRemaining:"54 minutes remaining"}];function Sie(){const[e,t]=me.useState(""),[r,n]=me.useState([]),i=Ho();me.useEffect(()=>{const u=localStorage.getItem("token");if(u)try{const h=t0(u);t(h.userId)}catch{console.error("Invalid token")}else i("/home")},[i]);const s=localStorage.getItem("token");me.useEffect(()=>{(async()=>{try{const h=await xr.get(`http://localhost:5000/ownedAssets/${e}`,{headers:{Authorization:`Bearer ${s}`}});n(h.data)}catch(h){console.error("Error fetching songs:",h)}})()},[e,s]);const o=u=>u.length>10?u.substring(0,10)+"...":u,a=r.map(u=>O.jsx(_ie,{songTitle:o(u.songName),bgImg:`http://localhost:5000/ownedAssetCoverArt/${u.coverArtId}`},u._id)),c=bie.map(u=>O.jsx(Eie,{artistImg:u.artistImg,bgImg:u.bgImg,name:u.name,timeRemaining:u.timeRemaining})),d=r.length,l=`Assets(${d})`;return console.log(d),O.jsx(O.Fragment,{children:O.jsxs("div",{style:{color:"white",width:"80%",marginTop:0,float:"left"},children:[O.jsx(xH,{}),O.jsxs("h4",{style:{textAlign:"left",paddingLeft:20,whiteSpace:"nowrap"},children:["Owned ",O.jsx("span",{style:{color:"yellowgreen"},children:l})]}),O.jsxs("div",{style:{marginLeft:25,display:"flex",justifyContent:"flex-start",paddingBottom:10},children:[O.jsx(tr,{to:"/uploadAsset",style:{textDecoration:"none"},children:O.jsxs("div",{style:{cursor:"pointer"},children:[O.jsx("div",{style:{display:"flex"},children:O.jsx("img",{src:vie,style:{height:68,width:76,borderTopLeftRadius:50,borderBottomRightRadius:50,border:"4px solid limegreen"}})}),O.jsx("p",{style:{fontSize:16,display:"inline",whiteSpace:"nowrap"},children:"Upload Music"})]})}),O.jsx("div",{style:{overflowX:"auto",display:"flex",scrollbarWidth:"thin"},children:a})]}),O.jsxs("div",{style:{lineHeight:.1},children:[O.jsx("h5",{style:{textAlign:"left",paddingLeft:25,whiteSpace:"nowrap"},children:"All swaps"}),O.jsx("h5",{style:{textAlign:"left",paddingLeft:25,whiteSpace:"nowrap"},children:O.jsx("i",{children:"(From the genres you love)"})})]}),O.jsx("div",{style:{overflowY:"auto",display:"flow",height:220,marginLeft:15},children:c})]})})}function wie(){return O.jsx(O.Fragment,{children:O.jsxs("center",{children:[O.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",width:"50%",minWidth:300,height:"100%",backgroundColor:"rgb(119, 63, 248)",borderRadius:40},children:[O.jsx(Sie,{}),O.jsx(mo,{})]}),O.jsx(mi,{})]})})}function Tie(){return O.jsx(O.Fragment,{children:O.jsxs("div",{style:{color:"white",width:"80%",marginTop:0,float:"left"},children:[O.jsxs("div",{style:{display:"flex",marginTop:20},children:[O.jsx(tr,{to:"/options",style:{textDecoration:"none"},children:O.jsx("p",{style:{width:"17%",whiteSpace:"nowrap"},children:" Back"})}),O.jsx("p",{style:{width:"80%"},children:O.jsx("b",{children:"Owned Music"})})]}),O.jsxs("div",{className:"ownedNft-Bg-Image",style:{height:147,width:147,borderRadius:12},children:[O.jsx("p",{style:{textAlign:"end",fontSize:12,color:"white",paddingRight:15,paddingTop:10},children:"You"}),O.jsx("p",{style:{color:"white"},children:O.jsx("b",{children:"YE : DONDA 2"})})]}),O.jsx(tr,{to:"/sellNFT",style:{textDecoration:"none"},children:O.jsx("button",{style:{cursor:"pointer",backgroundColor:"black",color:"white",paddingTop:12,paddingBottom:12,paddingLeft:33,paddingRight:33},children:"Sell Album"})}),O.jsx("button",{style:{cursor:"pointer",backgroundColor:"black",color:"white",paddingTop:12,paddingBottom:12,paddingLeft:33,paddingRight:33},children:"Form a Bond"})]})})}function Rie(){return O.jsx(O.Fragment,{children:O.jsxs("center",{children:[O.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",width:"50%",minWidth:300,height:"100%",backgroundColor:"rgb(119, 63, 248)",borderRadius:40},children:[O.jsx(Tie,{}),O.jsx(mo,{})]}),O.jsx(mi,{})]})})}function Aie(){return O.jsx(O.Fragment,{children:O.jsxs("div",{style:{color:"white",width:"80%",marginTop:0,float:"left"},children:[O.jsxs("div",{style:{display:"flex",marginTop:20},children:[O.jsx(tr,{to:"/ownedNFT",style:{textDecoration:"none"},children:O.jsx("p",{style:{width:"17%",whiteSpace:"nowrap"},children:" Back"})}),O.jsx("p",{style:{width:"80%"},children:O.jsx("b",{children:"Sell NFT"})})]}),O.jsxs("div",{className:"ownedNft-Bg-Image",style:{height:147,width:147,borderRadius:12},children:[O.jsx("p",{style:{textAlign:"end",fontSize:12,color:"white",paddingRight:15,paddingTop:10},children:"You"}),O.jsx("p",{style:{color:"white"},children:O.jsx("b",{children:"YE : DONDA 2"})})]}),O.jsxs("div",{style:{marginTop:40,whiteSpace:"nowrap"},children:[O.jsx("p",{style:{fontSize:16},children:O.jsx("b",{children:"Set Swap Start Price:"})}),O.jsx("input",{style:{backgroundColor:"black",color:"white"},type:"range"}),O.jsx("p",{style:{fontSize:16},children:"Swaps finish after 24 hours"})]}),O.jsx("button",{style:{whiteSpace:"nowrap",backgroundColor:"white",color:"black",paddingTop:6,paddingBottom:6,paddingLeft:66,paddingRight:66},children:"Schedule Swap"})]})})}function Cie(){return O.jsx(O.Fragment,{children:O.jsxs("center",{children:[O.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",width:"50%",minWidth:300,height:"100%",backgroundColor:"rgb(119, 63, 248)",borderRadius:40},children:[O.jsx(Aie,{}),O.jsx(mo,{})]}),O.jsx(mi,{})]})})}const FH="/assets/bonds_white-D64gT95t.png";function Iie(){const[e,t]=me.useState(""),[r,n]=me.useState(""),[i,s]=me.useState(""),[o,a]=me.useState(null),[c,d]=me.useState(null),[l,u]=me.useState(!1),h=Ho();me.useEffect(()=>{const b=localStorage.getItem("token");if(b)try{const v=t0(b);t(v.username)}catch{console.error("Invalid token")}else h("/home")},[h]);const p=e,_=b=>{a(b.target.files[0])},g=b=>{d(b.target.files[0])},E=async b=>{b.preventDefault();const v=new FormData;v.append("songName",r),v.append("artistName",i),v.append("audioFile",o),v.append("coverArt",c);try{u(!0);const I=localStorage.getItem("token");console.log(I);const N=await xr.post(`http://localhost:5000/new-ownedAsset/${p}`,v,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${I}`}});console.log("Upload successful:",N.data),alert("Music has been successfully uploaded!"),h("/options")}catch(I){console.error("Upload error:",I),alert("An error occurred during upload. Please try again.")}finally{u(!1)}};return O.jsx(O.Fragment,{children:O.jsxs("div",{style:{color:"white",width:"80%",marginTop:0,float:"left"},children:[O.jsxs("div",{style:{display:"flex",marginTop:20},children:[O.jsx(tr,{to:"/options",style:{textDecoration:"none"},children:O.jsx("p",{style:{width:"17%",whiteSpace:"nowrap"},children:" Back"})}),O.jsx("p",{style:{width:"90%"},children:O.jsx("b",{children:"Upload Music"})})]}),O.jsxs("div",{style:{marginTop:10,whiteSpace:"wrap"},children:[O.jsx("br",{}),O.jsxs("form",{onSubmit:E,children:[O.jsx("input",{type:"text",placeholder:"Song Name",value:r,onChange:b=>n(b.target.value),style:{width:214,height:17,fontSize:12}}),O.jsx("br",{}),O.jsx("input",{type:"text",placeholder:"Artist Name",value:i,onChange:b=>s(b.target.value),style:{width:214,height:17,fontSize:12}}),O.jsx("br",{}),O.jsx("p",{style:{fontSize:16},children:"Upload Full Song:"}),O.jsx("input",{type:"file",accept:"audio/*",onChange:_}),O.jsx("br",{}),O.jsx("p",{style:{fontSize:16},children:"Upload Song Cover Image:"}),O.jsx("input",{type:"file",accept:"image/*",onChange:g}),O.jsx("button",{type:"submit",style:{backgroundColor:l?"#ccc":"#4CAF50",cursor:l?"not-allowed":"pointer"},disabled:l,children:l?"Uploading...":"Upload Music"})]})]})]})})}function Oie(){return O.jsx(O.Fragment,{children:O.jsxs("center",{children:[O.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",width:"50%",minWidth:300,height:"100%",backgroundColor:"rgb(119, 63, 248)",borderRadius:40},children:[O.jsx(Iie,{contractAddress:"0xd9145CCE52D386f254917e481eB44e9943F39138"}),O.jsx(mo,{})]}),O.jsx(mi,{})]})})}const Nie="/assets/betty-CdsHJmSH.mp3",Die="modulepreload",Pie=function(e){return"/"+e},JL={},kie=function(t,r,n){let i=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),o=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));i=Promise.all(r.map(a=>{if(a=Pie(a),a in JL)return;JL[a]=!0;const c=a.endsWith(".css"),d=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${d}`))return;const l=document.createElement("link");if(l.rel=c?"stylesheet":Die,c||(l.as="script",l.crossOrigin=""),l.href=a,o&&l.setAttribute("nonce",o),document.head.appendChild(l),c)return new Promise((u,h)=>{l.addEventListener("load",u),l.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${a}`)))})}))}return i.then(()=>t()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})},Lie=Symbol(),XL=Object.getPrototypeOf,RO=new WeakMap,xie=e=>e&&(RO.has(e)?RO.get(e):XL(e)===Object.prototype||XL(e)===Array.prototype),Mie=e=>xie(e)&&e[Lie]||null,QL=(e,t=!0)=>{RO.set(e,t)};var C1={VITE_APIKEY:"AIzaSyDGGzVqu4wd9f7kCA3_sYjCn4unuGRu9ck",VITE_AUTHDOMAIN:"bonds-live-app.firebaseapp.com",VITE_PROJECTID:"bonds-live-app",VITE_STORAGEBUCKET:"bonds-live-app.appspot.com",VITE_MESSAGINGSENDERID:"532381019367",VITE_APPID:"1:532381019367:web:9055d189d78452e0bf4642",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const tR=e=>typeof e=="object"&&e!==null,Yl=new WeakMap,Pv=new WeakSet,Uie=(e=Object.is,t=(d,l)=>new Proxy(d,l),r=d=>tR(d)&&!Pv.has(d)&&(Array.isArray(d)||!(Symbol.iterator in d))&&!(d instanceof WeakMap)&&!(d instanceof WeakSet)&&!(d instanceof Error)&&!(d instanceof Number)&&!(d instanceof Date)&&!(d instanceof String)&&!(d instanceof RegExp)&&!(d instanceof ArrayBuffer),n=d=>{switch(d.status){case"fulfilled":return d.value;case"rejected":throw d.reason;default:throw d}},i=new WeakMap,s=(d,l,u=n)=>{const h=i.get(d);if((h==null?void 0:h[0])===l)return h[1];const p=Array.isArray(d)?[]:Object.create(Object.getPrototypeOf(d));return QL(p,!0),i.set(d,[l,p]),Reflect.ownKeys(d).forEach(_=>{if(Object.getOwnPropertyDescriptor(p,_))return;const g=Reflect.get(d,_),E={value:g,enumerable:!0,configurable:!0};if(Pv.has(g))QL(g,!1);else if(g instanceof Promise)delete E.value,E.get=()=>u(g);else if(Yl.has(g)){const[b,v]=Yl.get(g);E.value=s(b,v(),u)}Object.defineProperty(p,_,E)}),Object.preventExtensions(p)},o=new WeakMap,a=[1,1],c=d=>{if(!tR(d))throw new Error("object required");const l=o.get(d);if(l)return l;let u=a[0];const h=new Set,p=(z,K=++a[0])=>{u!==K&&(u=K,h.forEach(H=>H(z,K)))};let _=a[1];const g=(z=++a[1])=>(_!==z&&!h.size&&(_=z,b.forEach(([K])=>{const H=K[1](z);H>u&&(u=H)})),u),E=z=>(K,H)=>{const A=[...K];A[1]=[z,...A[1]],p(A,H)},b=new Map,v=(z,K)=>{if((C1?"production":void 0)!=="production"&&b.has(z))throw new Error("prop listener already exists");if(h.size){const H=K[3](E(z));b.set(z,[K,H])}else b.set(z,[K])},I=z=>{var K;const H=b.get(z);H&&(b.delete(z),(K=H[1])==null||K.call(H))},N=z=>(h.add(z),h.size===1&&b.forEach(([H,A],m)=>{if((C1?"production":void 0)!=="production"&&A)throw new Error("remove already exists");const S=H[3](E(m));b.set(m,[H,S])}),()=>{h.delete(z),h.size===0&&b.forEach(([H,A],m)=>{A&&(A(),b.set(m,[H]))})}),L=Array.isArray(d)?[]:Object.create(Object.getPrototypeOf(d)),w=t(L,{deleteProperty(z,K){const H=Reflect.get(z,K);I(K);const A=Reflect.deleteProperty(z,K);return A&&p(["delete",[K],H]),A},set(z,K,H,A){const m=Reflect.has(z,K),S=Reflect.get(z,K,A);if(m&&(e(S,H)||o.has(H)&&e(S,o.get(H))))return!0;I(K),tR(H)&&(H=Mie(H)||H);let T=H;if(H instanceof Promise)H.then(x=>{H.status="fulfilled",H.value=x,p(["resolve",[K],x])}).catch(x=>{H.status="rejected",H.reason=x,p(["reject",[K],x])});else{!Yl.has(H)&&r(H)&&(T=c(H));const x=!Pv.has(T)&&Yl.get(T);x&&v(K,x)}return Reflect.set(z,K,T,A),p(["set",[K],H,S]),!0}});o.set(d,w);const V=[L,g,s,N];return Yl.set(w,V),Reflect.ownKeys(d).forEach(z=>{const K=Object.getOwnPropertyDescriptor(d,z);"value"in K&&(w[z]=d[z],delete K.value,delete K.writable),Object.defineProperty(L,z,K)}),w})=>[c,Yl,Pv,e,t,r,n,i,s,o,a],[jie]=Uie();function Yu(e={}){return jie(e)}function Of(e,t,r){const n=Yl.get(e);(C1?"production":void 0)!=="production"&&!n&&console.warn("Please use proxy object");let i;const s=[],o=n[3];let a=!1;const d=o(l=>{s.push(l),i||(i=Promise.resolve().then(()=>{i=void 0,a&&t(s.splice(0))}))});return a=!0,()=>{a=!1,d()}}function Fie(e,t){const r=Yl.get(e);(C1?"production":void 0)!=="production"&&!r&&console.warn("Please use proxy object");const[n,i,s]=r;return s(n,i(),t)}const _i=Yu({history:["ConnectWallet"],view:"ConnectWallet",data:void 0}),BH={state:_i,subscribe(e){return Of(_i,()=>e(_i))},push(e,t){e!==_i.view&&(_i.view=e,t&&(_i.data=t),_i.history.push(e))},reset(e){_i.view=e,_i.history=[e]},replace(e){_i.history.length>1&&(_i.history[_i.history.length-1]=e,_i.view=e)},goBack(){if(_i.history.length>1){_i.history.pop();const[e]=_i.history.slice(-1);_i.view=e}},setData(e){_i.data=e}},os={WALLETCONNECT_DEEPLINK_CHOICE:"WALLETCONNECT_DEEPLINK_CHOICE",WCM_VERSION:"WCM_VERSION",RECOMMENDED_WALLET_AMOUNT:9,isMobile(){return typeof window<"u"?!!(window.matchMedia("(pointer:coarse)").matches||/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini/u.test(navigator.userAgent)):!1},isAndroid(){return os.isMobile()&&navigator.userAgent.toLowerCase().includes("android")},isIos(){const e=navigator.userAgent.toLowerCase();return os.isMobile()&&(e.includes("iphone")||e.includes("ipad"))},isHttpUrl(e){return e.startsWith("http://")||e.startsWith("https://")},isArray(e){return Array.isArray(e)&&e.length>0},formatNativeUrl(e,t,r){if(os.isHttpUrl(e))return this.formatUniversalUrl(e,t,r);let n=e;n.includes("://")||(n=e.replaceAll("/","").replaceAll(":",""),n=`${n}://`),n.endsWith("/")||(n=`${n}/`),this.setWalletConnectDeepLink(n,r);const i=encodeURIComponent(t);return`${n}wc?uri=${i}`},formatUniversalUrl(e,t,r){if(!os.isHttpUrl(e))return this.formatNativeUrl(e,t,r);let n=e;n.endsWith("/")||(n=`${n}/`),this.setWalletConnectDeepLink(n,r);const i=encodeURIComponent(t);return`${n}wc?uri=${i}`},async wait(e){return new Promise(t=>{setTimeout(t,e)})},openHref(e,t){window.open(e,t,"noreferrer noopener")},setWalletConnectDeepLink(e,t){try{localStorage.setItem(os.WALLETCONNECT_DEEPLINK_CHOICE,JSON.stringify({href:e,name:t}))}catch{console.info("Unable to set WalletConnect deep link")}},setWalletConnectAndroidDeepLink(e){try{const[t]=e.split("?");localStorage.setItem(os.WALLETCONNECT_DEEPLINK_CHOICE,JSON.stringify({href:t,name:"Android"}))}catch{console.info("Unable to set WalletConnect android deep link")}},removeWalletConnectDeepLink(){try{localStorage.removeItem(os.WALLETCONNECT_DEEPLINK_CHOICE)}catch{console.info("Unable to remove WalletConnect deep link")}},setModalVersionInStorage(){try{typeof localStorage<"u"&&localStorage.setItem(os.WCM_VERSION,"0.0.6")}catch{console.info("Unable to set Web3Modal version in storage")}},getWalletRouterData(){var e;const t=(e=BH.state.data)==null?void 0:e.Wallet;if(!t)throw new Error('Missing "Wallet" view data');return t}},Bie=typeof location<"u"&&(location.hostname.includes("localhost")||location.protocol.includes("https")),Qi=Yu({enabled:Bie,userSessionId:"",events:[],connectedWalletId:void 0}),Vie={state:Qi,subscribe(e){return Of(Qi.events,()=>e(Fie(Qi.events[Qi.events.length-1])))},initialize(){Qi.enabled&&typeof(crypto==null?void 0:crypto.randomUUID)<"u"&&(Qi.userSessionId=crypto.randomUUID())},setConnectedWalletId(e){Qi.connectedWalletId=e},click(e){if(Qi.enabled){const t={type:"CLICK",name:e.name,userSessionId:Qi.userSessionId,timestamp:Date.now(),data:e};Qi.events.push(t)}},track(e){if(Qi.enabled){const t={type:"TRACK",name:e.name,userSessionId:Qi.userSessionId,timestamp:Date.now(),data:e};Qi.events.push(t)}},view(e){if(Qi.enabled){const t={type:"VIEW",name:e.name,userSessionId:Qi.userSessionId,timestamp:Date.now(),data:e};Qi.events.push(t)}}},Cc=Yu({chains:void 0,walletConnectUri:void 0,isAuth:!1,isCustomDesktop:!1,isCustomMobile:!1,isDataLoaded:!1,isUiLoaded:!1}),cc={state:Cc,subscribe(e){return Of(Cc,()=>e(Cc))},setChains(e){Cc.chains=e},setWalletConnectUri(e){Cc.walletConnectUri=e},setIsCustomDesktop(e){Cc.isCustomDesktop=e},setIsCustomMobile(e){Cc.isCustomMobile=e},setIsDataLoaded(e){Cc.isDataLoaded=e},setIsUiLoaded(e){Cc.isUiLoaded=e},setIsAuth(e){Cc.isAuth=e}},kv=Yu({projectId:"",mobileWallets:void 0,desktopWallets:void 0,walletImages:void 0,chains:void 0,enableAuthMode:!1,enableExplorer:!0,explorerExcludedWalletIds:void 0,explorerRecommendedWalletIds:void 0,termsOfServiceUrl:void 0,privacyPolicyUrl:void 0}),Am={state:kv,subscribe(e){return Of(kv,()=>e(kv))},setConfig(e){var t,r;Vie.initialize(),cc.setChains(e.chains),cc.setIsAuth(!!e.enableAuthMode),cc.setIsCustomMobile(!!((t=e.mobileWallets)!=null&&t.length)),cc.setIsCustomDesktop(!!((r=e.desktopWallets)!=null&&r.length)),os.setModalVersionInStorage(),Object.assign(kv,e)}};var $ie=Object.defineProperty,ZL=Object.getOwnPropertySymbols,Hie=Object.prototype.hasOwnProperty,zie=Object.prototype.propertyIsEnumerable,ex=(e,t,r)=>t in e?$ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Wie=(e,t)=>{for(var r in t||(t={}))Hie.call(t,r)&&ex(e,r,t[r]);if(ZL)for(var r of ZL(t))zie.call(t,r)&&ex(e,r,t[r]);return e};const AO="https://explorer-api.walletconnect.com",CO="wcm",IO="js-0.0.6";async function Lv(e,t){const r=Wie({sdkType:CO,sdkVersion:IO},t),n=new URL(e,AO);return n.searchParams.append("projectId",Am.state.projectId),Object.entries(r).forEach(([i,s])=>{s&&n.searchParams.append(i,String(s))}),(await fetch(n)).json()}const ah={async getDesktopListings(e){return Lv("/w3m/v1/getDesktopListings",e)},async getMobileListings(e){return Lv("/w3m/v1/getMobileListings",e)},async getInjectedListings(e){return Lv("/w3m/v1/getInjectedListings",e)},async getAllListings(e){return Lv("/w3m/v1/getAllListings",e)},getWalletImageUrl(e){return`${AO}/w3m/v1/getWalletImage/${e}?projectId=${Am.state.projectId}&sdkType=${CO}&sdkVersion=${IO}`},getAssetImageUrl(e){return`${AO}/w3m/v1/getAssetImage/${e}?projectId=${Am.state.projectId}&sdkType=${CO}&sdkVersion=${IO}`}};var Gie=Object.defineProperty,tx=Object.getOwnPropertySymbols,qie=Object.prototype.hasOwnProperty,Kie=Object.prototype.propertyIsEnumerable,rx=(e,t,r)=>t in e?Gie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Yie=(e,t)=>{for(var r in t||(t={}))qie.call(t,r)&&rx(e,r,t[r]);if(tx)for(var r of tx(t))Kie.call(t,r)&&rx(e,r,t[r]);return e};const nx=os.isMobile(),Ic=Yu({wallets:{listings:[],total:0,page:1},search:{listings:[],total:0,page:1},recomendedWallets:[]}),e5e={state:Ic,async getRecomendedWallets(){const{explorerRecommendedWalletIds:e,explorerExcludedWalletIds:t}=Am.state;if(e==="NONE"||t==="ALL"&&!e)return Ic.recomendedWallets;if(os.isArray(e)){const r={recommendedIds:e.join(",")},{listings:n}=await ah.getAllListings(r),i=Object.values(n);n&&i.sort&&i.sort((s,o)=>{const a=e.indexOf(s.id),c=e.indexOf(o.id);return a-c}),Ic.recomendedWallets=i}else{const{chains:r,isAuth:n}=cc.state,i=r==null?void 0:r.join(","),s=os.isArray(t),o={page:1,sdks:n?"auth_v1":void 0,entries:os.RECOMMENDED_WALLET_AMOUNT,chains:i,version:2,excludedIds:s?t.join(","):void 0},{listings:a}=nx?await ah.getMobileListings(o):await ah.getDesktopListings(o);Ic.recomendedWallets=Object.values(a)}return Ic.recomendedWallets},async getWallets(e){const t=Yie({},e),{explorerRecommendedWalletIds:r,explorerExcludedWalletIds:n}=Am.state,{recomendedWallets:i}=Ic;if(n==="ALL")return Ic.wallets;i.length?t.excludedIds=i.map(u=>u.id).join(","):os.isArray(r)&&(t.excludedIds=r.join(",")),os.isArray(n)&&(t.excludedIds=[t.excludedIds,n].filter(Boolean).join(",")),cc.state.isAuth&&(t.sdks="auth_v1");const{page:s,search:o}=e,{listings:a,total:c}=nx?await ah.getMobileListings(t):await ah.getDesktopListings(t),d=Object.values(a),l=o?"search":"wallets";return Ic[l]={listings:[...Ic[l].listings,...d],total:c,page:s??1},{listings:d,total:c}},getWalletImageUrl(e){return ah.getWalletImageUrl(e)},getAssetImageUrl(e){return ah.getAssetImageUrl(e)},resetSearch(){Ic.search={listings:[],total:0,page:1}}},zf=Yu({open:!1}),rR={state:zf,subscribe(e){return Of(zf,()=>e(zf))},async open(e){return new Promise(t=>{const{isUiLoaded:r,isDataLoaded:n}=cc.state;if(os.removeWalletConnectDeepLink(),cc.setWalletConnectUri(e==null?void 0:e.uri),cc.setChains(e==null?void 0:e.chains),BH.reset("ConnectWallet"),r&&n)zf.open=!0,t();else{const i=setInterval(()=>{const s=cc.state;s.isUiLoaded&&s.isDataLoaded&&(clearInterval(i),zf.open=!0,t())},200)}})},close(){zf.open=!1}};var Jie=Object.defineProperty,ix=Object.getOwnPropertySymbols,Xie=Object.prototype.hasOwnProperty,Qie=Object.prototype.propertyIsEnumerable,sx=(e,t,r)=>t in e?Jie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Zie=(e,t)=>{for(var r in t||(t={}))Xie.call(t,r)&&sx(e,r,t[r]);if(ix)for(var r of ix(t))Qie.call(t,r)&&sx(e,r,t[r]);return e};function ese(){return typeof matchMedia<"u"&&matchMedia("(prefers-color-scheme: dark)").matches}const Y0=Yu({themeMode:ese()?"dark":"light"}),ox={state:Y0,subscribe(e){return Of(Y0,()=>e(Y0))},setThemeConfig(e){const{themeMode:t,themeVariables:r}=e;t&&(Y0.themeMode=t),r&&(Y0.themeVariables=Zie({},r))}},ch=Yu({open:!1,message:"",variant:"success"}),t5e={state:ch,subscribe(e){return Of(ch,()=>e(ch))},openToast(e,t){ch.open=!0,ch.message=e,ch.variant=t},closeToast(){ch.open=!1}};let tse=class{constructor(t){this.openModal=rR.open,this.closeModal=rR.close,this.subscribeModal=rR.subscribe,this.setTheme=ox.setThemeConfig,ox.setThemeConfig(t),Am.setConfig(t),this.initUi()}async initUi(){if(typeof window<"u"){await kie(()=>import("./index-DgNKYhUD.js"),[]);const t=document.createElement("wcm-modal");document.body.insertAdjacentElement("beforeend",t),cc.setIsUiLoaded(!0)}}};var GD={exports:{}},nm=typeof Reflect=="object"?Reflect:null,ax=nm&&typeof nm.apply=="function"?nm.apply:function(t,r,n){return Function.prototype.apply.call(t,r,n)},sb;nm&&typeof nm.ownKeys=="function"?sb=nm.ownKeys:Object.getOwnPropertySymbols?sb=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:sb=function(t){return Object.getOwnPropertyNames(t)};function rse(e){console&&console.warn&&console.warn(e)}var VH=Number.isNaN||function(t){return t!==t};function Yr(){Yr.init.call(this)}GD.exports=Yr;GD.exports.once=ose;Yr.EventEmitter=Yr;Yr.prototype._events=void 0;Yr.prototype._eventsCount=0;Yr.prototype._maxListeners=void 0;var cx=10;function ow(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(Yr,"defaultMaxListeners",{enumerable:!0,get:function(){return cx},set:function(e){if(typeof e!="number"||e<0||VH(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");cx=e}});Yr.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Yr.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||VH(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function $H(e){return e._maxListeners===void 0?Yr.defaultMaxListeners:e._maxListeners}Yr.prototype.getMaxListeners=function(){return $H(this)};Yr.prototype.emit=function(t){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var i=t==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(r.length>0&&(o=r[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[t];if(c===void 0)return!1;if(typeof c=="function")ax(c,this,r);else for(var d=c.length,l=qH(c,d),n=0;n<d;++n)ax(l[n],this,r);return!0};function HH(e,t,r,n){var i,s,o;if(ow(r),s=e._events,s===void 0?(s=e._events=Object.create(null),e._eventsCount=0):(s.newListener!==void 0&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),o=s[t]),o===void 0)o=s[t]=r,++e._eventsCount;else if(typeof o=="function"?o=s[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),i=$H(e),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=o.length,rse(a)}return e}Yr.prototype.addListener=function(t,r){return HH(this,t,r,!1)};Yr.prototype.on=Yr.prototype.addListener;Yr.prototype.prependListener=function(t,r){return HH(this,t,r,!0)};function nse(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function zH(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=nse.bind(n);return i.listener=r,n.wrapFn=i,i}Yr.prototype.once=function(t,r){return ow(r),this.on(t,zH(this,t,r)),this};Yr.prototype.prependOnceListener=function(t,r){return ow(r),this.prependListener(t,zH(this,t,r)),this};Yr.prototype.removeListener=function(t,r){var n,i,s,o,a;if(ow(r),i=this._events,i===void 0)return this;if(n=i[t],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||r));else if(typeof n!="function"){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===r||n[o].listener===r){a=n[o].listener,s=o;break}if(s<0)return this;s===0?n.shift():ise(n,s),n.length===1&&(i[t]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",t,a||r)}return this};Yr.prototype.off=Yr.prototype.removeListener;Yr.prototype.removeAllListeners=function(t){var r,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[t]),this;if(arguments.length===0){var s=Object.keys(n),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[t],typeof r=="function")this.removeListener(t,r);else if(r!==void 0)for(i=r.length-1;i>=0;i--)this.removeListener(t,r[i]);return this};function WH(e,t,r){var n=e._events;if(n===void 0)return[];var i=n[t];return i===void 0?[]:typeof i=="function"?r?[i.listener||i]:[i]:r?sse(i):qH(i,i.length)}Yr.prototype.listeners=function(t){return WH(this,t,!0)};Yr.prototype.rawListeners=function(t){return WH(this,t,!1)};Yr.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):GH.call(e,t)};Yr.prototype.listenerCount=GH;function GH(e){var t=this._events;if(t!==void 0){var r=t[e];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}Yr.prototype.eventNames=function(){return this._eventsCount>0?sb(this._events):[]};function qH(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function ise(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function sse(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}function ose(e,t){return new Promise(function(r,n){function i(o){e.removeListener(t,s),n(o)}function s(){typeof e.removeListener=="function"&&e.removeListener("error",i),r([].slice.call(arguments))}KH(e,t,s,{once:!0}),t!=="error"&&ase(e,i,{once:!0})})}function ase(e,t,r){typeof e.on=="function"&&KH(e,"error",t,r)}function KH(e,t,r,n){if(typeof e.on=="function")n.once?e.once(t,r):e.on(t,r);else if(typeof e.addEventListener=="function")e.addEventListener(t,function i(s){n.once&&e.removeEventListener(t,i),r(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var Sc=GD.exports;const aw=Rf(Sc),cse=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,dse=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,lse=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function use(e,t){if(e==="__proto__"||e==="constructor"&&t&&typeof t=="object"&&"prototype"in t){hse(e);return}return t}function hse(e){console.warn(`[destr] Dropping "${e}" key to prevent prototype pollution.`)}function xv(e,t={}){if(typeof e!="string")return e;const r=e.trim();if(e[0]==='"'&&e.endsWith('"')&&!e.includes("\\"))return r.slice(1,-1);if(r.length<=9){const n=r.toLowerCase();if(n==="true")return!0;if(n==="false")return!1;if(n==="undefined")return;if(n==="null")return null;if(n==="nan")return Number.NaN;if(n==="infinity")return Number.POSITIVE_INFINITY;if(n==="-infinity")return Number.NEGATIVE_INFINITY}if(!lse.test(e)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return e}try{if(cse.test(e)||dse.test(e)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(e,use)}return JSON.parse(e)}catch(n){if(t.strict)throw n;return e}}function fse(e){return!e||typeof e.then!="function"?Promise.resolve(e):e}function Si(e,...t){try{return fse(e(...t))}catch(r){return Promise.reject(r)}}function pse(e){const t=typeof e;return e===null||t!=="object"&&t!=="function"}function mse(e){const t=Object.getPrototypeOf(e);return!t||t.isPrototypeOf(Object)}function ob(e){if(pse(e))return String(e);if(mse(e)||Array.isArray(e))return JSON.stringify(e);if(typeof e.toJSON=="function")return ob(e.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function YH(){if(typeof Buffer>"u")throw new TypeError("[unstorage] Buffer is not supported!")}const OO="base64:";function gse(e){if(typeof e=="string")return e;YH();const t=Buffer.from(e).toString("base64");return OO+t}function _se(e){return typeof e!="string"||!e.startsWith(OO)?e:(YH(),Buffer.from(e.slice(OO.length),"base64"))}function $s(e){return e?e.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function Ese(...e){return $s(e.join(":"))}function Mv(e){return e=$s(e),e?e+":":""}const vse="memory",yse=()=>{const e=new Map;return{name:vse,getInstance:()=>e,hasItem(t){return e.has(t)},getItem(t){return e.get(t)??null},getItemRaw(t){return e.get(t)??null},setItem(t,r){e.set(t,r)},setItemRaw(t,r){e.set(t,r)},removeItem(t){e.delete(t)},getKeys(){return[...e.keys()]},clear(){e.clear()},dispose(){e.clear()}}};function bse(e={}){const t={mounts:{"":e.driver||yse()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=d=>{for(const l of t.mountpoints)if(d.startsWith(l))return{base:l,relativeKey:d.slice(l.length),driver:t.mounts[l]};return{base:"",relativeKey:d,driver:t.mounts[""]}},n=(d,l)=>t.mountpoints.filter(u=>u.startsWith(d)||l&&d.startsWith(u)).map(u=>({relativeBase:d.length>u.length?d.slice(u.length):void 0,mountpoint:u,driver:t.mounts[u]})),i=(d,l)=>{if(t.watching){l=$s(l);for(const u of t.watchListeners)u(d,l)}},s=async()=>{if(!t.watching){t.watching=!0;for(const d in t.mounts)t.unwatch[d]=await dx(t.mounts[d],i,d)}},o=async()=>{if(t.watching){for(const d in t.unwatch)await t.unwatch[d]();t.unwatch={},t.watching=!1}},a=(d,l,u)=>{const h=new Map,p=_=>{let g=h.get(_.base);return g||(g={driver:_.driver,base:_.base,items:[]},h.set(_.base,g)),g};for(const _ of d){const g=typeof _=="string",E=$s(g?_:_.key),b=g?void 0:_.value,v=g||!_.options?l:{...l,..._.options},I=r(E);p(I).items.push({key:E,value:b,relativeKey:I.relativeKey,options:v})}return Promise.all([...h.values()].map(_=>u(_))).then(_=>_.flat())},c={hasItem(d,l={}){d=$s(d);const{relativeKey:u,driver:h}=r(d);return Si(h.hasItem,u,l)},getItem(d,l={}){d=$s(d);const{relativeKey:u,driver:h}=r(d);return Si(h.getItem,u,l).then(p=>xv(p))},getItems(d,l){return a(d,l,u=>u.driver.getItems?Si(u.driver.getItems,u.items.map(h=>({key:h.relativeKey,options:h.options})),l).then(h=>h.map(p=>({key:Ese(u.base,p.key),value:xv(p.value)}))):Promise.all(u.items.map(h=>Si(u.driver.getItem,h.relativeKey,h.options).then(p=>({key:h.key,value:xv(p)})))))},getItemRaw(d,l={}){d=$s(d);const{relativeKey:u,driver:h}=r(d);return h.getItemRaw?Si(h.getItemRaw,u,l):Si(h.getItem,u,l).then(p=>_se(p))},async setItem(d,l,u={}){if(l===void 0)return c.removeItem(d);d=$s(d);const{relativeKey:h,driver:p}=r(d);p.setItem&&(await Si(p.setItem,h,ob(l),u),p.watch||i("update",d))},async setItems(d,l){await a(d,l,async u=>{if(u.driver.setItems)return Si(u.driver.setItems,u.items.map(h=>({key:h.relativeKey,value:ob(h.value),options:h.options})),l);u.driver.setItem&&await Promise.all(u.items.map(h=>Si(u.driver.setItem,h.relativeKey,ob(h.value),h.options)))})},async setItemRaw(d,l,u={}){if(l===void 0)return c.removeItem(d,u);d=$s(d);const{relativeKey:h,driver:p}=r(d);if(p.setItemRaw)await Si(p.setItemRaw,h,l,u);else if(p.setItem)await Si(p.setItem,h,gse(l),u);else return;p.watch||i("update",d)},async removeItem(d,l={}){typeof l=="boolean"&&(l={removeMeta:l}),d=$s(d);const{relativeKey:u,driver:h}=r(d);h.removeItem&&(await Si(h.removeItem,u,l),(l.removeMeta||l.removeMata)&&await Si(h.removeItem,u+"$",l),h.watch||i("remove",d))},async getMeta(d,l={}){typeof l=="boolean"&&(l={nativeOnly:l}),d=$s(d);const{relativeKey:u,driver:h}=r(d),p=Object.create(null);if(h.getMeta&&Object.assign(p,await Si(h.getMeta,u,l)),!l.nativeOnly){const _=await Si(h.getItem,u+"$",l).then(g=>xv(g));_&&typeof _=="object"&&(typeof _.atime=="string"&&(_.atime=new Date(_.atime)),typeof _.mtime=="string"&&(_.mtime=new Date(_.mtime)),Object.assign(p,_))}return p},setMeta(d,l,u={}){return this.setItem(d+"$",l,u)},removeMeta(d,l={}){return this.removeItem(d+"$",l)},async getKeys(d,l={}){d=Mv(d);const u=n(d,!0);let h=[];const p=[];for(const _ of u){const g=await Si(_.driver.getKeys,_.relativeBase,l);for(const E of g){const b=_.mountpoint+$s(E);h.some(v=>b.startsWith(v))||p.push(b)}h=[_.mountpoint,...h.filter(E=>!E.startsWith(_.mountpoint))]}return d?p.filter(_=>_.startsWith(d)&&_[_.length-1]!=="$"):p.filter(_=>_[_.length-1]!=="$")},async clear(d,l={}){d=Mv(d),await Promise.all(n(d,!1).map(async u=>{if(u.driver.clear)return Si(u.driver.clear,u.relativeBase,l);if(u.driver.removeItem){const h=await u.driver.getKeys(u.relativeBase||"",l);return Promise.all(h.map(p=>u.driver.removeItem(p,l)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(d=>lx(d)))},async watch(d){return await s(),t.watchListeners.push(d),async()=>{t.watchListeners=t.watchListeners.filter(l=>l!==d),t.watchListeners.length===0&&await o()}},async unwatch(){t.watchListeners=[],await o()},mount(d,l){if(d=Mv(d),d&&t.mounts[d])throw new Error(`already mounted at ${d}`);return d&&(t.mountpoints.push(d),t.mountpoints.sort((u,h)=>h.length-u.length)),t.mounts[d]=l,t.watching&&Promise.resolve(dx(l,i,d)).then(u=>{t.unwatch[d]=u}).catch(console.error),c},async unmount(d,l=!0){d=Mv(d),!(!d||!t.mounts[d])&&(t.watching&&d in t.unwatch&&(t.unwatch[d](),delete t.unwatch[d]),l&&await lx(t.mounts[d]),t.mountpoints=t.mountpoints.filter(u=>u!==d),delete t.mounts[d])},getMount(d=""){d=$s(d)+":";const l=r(d);return{driver:l.driver,base:l.base}},getMounts(d="",l={}){return d=$s(d),n(d,l.parents).map(h=>({driver:h.driver,base:h.mountpoint}))},keys:(d,l={})=>c.getKeys(d,l),get:(d,l={})=>c.getItem(d,l),set:(d,l,u={})=>c.setItem(d,l,u),has:(d,l={})=>c.hasItem(d,l),del:(d,l={})=>c.removeItem(d,l),remove:(d,l={})=>c.removeItem(d,l)};return c}function dx(e,t,r){return e.watch?e.watch((n,i)=>t(n,r+i)):()=>{}}async function lx(e){typeof e.dispose=="function"&&await Si(e.dispose)}function Nf(e){return new Promise((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)})}function JH(e,t){const r=indexedDB.open(e);r.onupgradeneeded=()=>r.result.createObjectStore(t);const n=Nf(r);return(i,s)=>n.then(o=>s(o.transaction(t,i).objectStore(t)))}let nR;function FE(){return nR||(nR=JH("keyval-store","keyval")),nR}function ux(e,t=FE()){return t("readonly",r=>Nf(r.get(e)))}function Sse(e,t,r=FE()){return r("readwrite",n=>(n.put(t,e),Nf(n.transaction)))}function wse(e,t=FE()){return t("readwrite",r=>(r.delete(e),Nf(r.transaction)))}function Tse(e=FE()){return e("readwrite",t=>(t.clear(),Nf(t.transaction)))}function Rse(e,t){return e.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},Nf(e.transaction)}function Ase(e=FE()){return e("readonly",t=>{if(t.getAllKeys)return Nf(t.getAllKeys());const r=[];return Rse(t,n=>r.push(n.key)).then(()=>r)})}const Cse=e=>JSON.stringify(e,(t,r)=>typeof r=="bigint"?r.toString()+"n":r),Ise=e=>{const t=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=e.replace(t,'$1"$2n"$3');return JSON.parse(r,(n,i)=>typeof i=="string"&&i.match(/^\d+n$/)?BigInt(i.substring(0,i.length-1)):i)};function cw(e){if(typeof e!="string")throw new Error(`Cannot safe json parse value of type ${typeof e}`);try{return Ise(e)}catch{return e}}function ff(e){return typeof e=="string"?e:Cse(e)||""}const Ose="idb-keyval";var Nse=(e={})=>{const t=e.base&&e.base.length>0?`${e.base}:`:"",r=i=>t+i;let n;return e.dbName&&e.storeName&&(n=JH(e.dbName,e.storeName)),{name:Ose,options:e,async hasItem(i){return!(typeof await ux(r(i),n)>"u")},async getItem(i){return await ux(r(i),n)??null},setItem(i,s){return Sse(r(i),s,n)},removeItem(i){return wse(r(i),n)},getKeys(){return Ase(n)},clear(){return Tse(n)}}};const Dse="WALLET_CONNECT_V2_INDEXED_DB",Pse="keyvaluestorage";let kse=class{constructor(){this.indexedDb=bse({driver:Nse({dbName:Dse,storeName:Pse})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const r=await this.indexedDb.getItem(t);if(r!==null)return r}async setItem(t,r){await this.indexedDb.setItem(t,ff(r))}async removeItem(t){await this.indexedDb.removeItem(t)}};var iR=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ab={exports:{}};(function(){let e;function t(){}e=t,e.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},e.prototype.setItem=function(r,n){this[r]=String(n)},e.prototype.removeItem=function(r){delete this[r]},e.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},e.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},e.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof iR<"u"&&iR.localStorage?ab.exports=iR.localStorage:typeof window<"u"&&window.localStorage?ab.exports=window.localStorage:ab.exports=new t})();function Lse(e){var t;return[e[0],cw((t=e[1])!=null?t:"")]}let xse=class{constructor(){this.localStorage=ab.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Lse)}async getItem(t){const r=this.localStorage.getItem(t);if(r!==null)return cw(r)}async setItem(t,r){this.localStorage.setItem(t,ff(r))}async removeItem(t){this.localStorage.removeItem(t)}};const Mse="wc_storage_version",hx=1,Use=async(e,t,r)=>{const n=Mse,i=await t.getItem(n);if(i&&i>=hx){r(t);return}const s=await e.getKeys();if(!s.length){r(t);return}const o=[];for(;s.length;){const a=s.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const d=await e.getItem(a);await t.setItem(a,d),o.push(a)}}await t.setItem(n,hx),r(t),jse(e,o)},jse=async(e,t)=>{t.length&&t.forEach(async r=>{await e.removeItem(r)})};let Fse=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const t=new xse;this.storage=t;try{const r=new kse;Use(t,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,r){return await this.initialize(),this.storage.setItem(t,r)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),t())},20)})}};var r0={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var NO=function(e,t){return NO=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},NO(e,t)};function Bse(e,t){NO(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var DO=function(){return DO=Object.assign||function(t){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},DO.apply(this,arguments)};function Vse(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}function $se(e,t,r,n){var i=arguments.length,s=i<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s}function Hse(e,t){return function(r,n){t(r,n,e)}}function zse(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function Wse(e,t,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{d(n.next(l))}catch(u){o(u)}}function c(l){try{d(n.throw(l))}catch(u){o(u)}}function d(l){l.done?s(l.value):i(l.value).then(a,c)}d((n=n.apply(e,t||[])).next())})}function Gse(e,t){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(d){return function(l){return c([d,l])}}function c(d){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=d[0]&2?i.return:d[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,d[1])).done)return s;switch(i=0,s&&(d=[d[0]&2,s.value]),d[0]){case 0:case 1:s=d;break;case 4:return r.label++,{value:d[1],done:!1};case 5:r.label++,i=d[1],d=[0];continue;case 7:d=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(d[0]===6||d[0]===2)){r=0;continue}if(d[0]===3&&(!s||d[1]>s[0]&&d[1]<s[3])){r.label=d[1];break}if(d[0]===6&&r.label<s[1]){r.label=s[1],s=d;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(d);break}s[2]&&r.ops.pop(),r.trys.pop();continue}d=t.call(e,r)}catch(l){d=[6,l],i=0}finally{n=s=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function qse(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}function Kse(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=e[r])}function PO(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function XH(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,s=[],o;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}function Yse(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(XH(arguments[t]));return e}function Jse(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),i=0,t=0;t<r;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n}function j_(e){return this instanceof j_?(this.v=e,this):new j_(e)}function Xse(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(h){n[h]&&(i[h]=function(p){return new Promise(function(_,g){s.push([h,p,_,g])>1||a(h,p)})})}function a(h,p){try{c(n[h](p))}catch(_){u(s[0][3],_)}}function c(h){h.value instanceof j_?Promise.resolve(h.value.v).then(d,l):u(s[0][2],h)}function d(h){a("next",h)}function l(h){a("throw",h)}function u(h,p){h(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Qse(e){var t,r;return t={},n("next"),n("throw",function(i){throw i}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(i,s){t[i]=e[i]?function(o){return(r=!r)?{value:j_(e[i](o)),done:i==="return"}:s?s(o):o}:s}}function Zse(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof PO=="function"?PO(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=e[s]&&function(o){return new Promise(function(a,c){o=e[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(d){s({value:d,done:a})},o)}}function eoe(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function toe(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function roe(e){return e&&e.__esModule?e:{default:e}}function noe(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function ioe(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r}const soe=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return DO},__asyncDelegator:Qse,__asyncGenerator:Xse,__asyncValues:Zse,__await:j_,__awaiter:Wse,__classPrivateFieldGet:noe,__classPrivateFieldSet:ioe,__createBinding:qse,__decorate:$se,__exportStar:Kse,__extends:Bse,__generator:Gse,__importDefault:roe,__importStar:toe,__makeTemplateObject:eoe,__metadata:zse,__param:Hse,__read:XH,__rest:Vse,__spread:Yse,__spreadArrays:Jse,__values:PO},Symbol.toStringTag,{value:"Module"})),Cl=LS(soe);var J0={},Ge={},sR={},X0={},fx;function ooe(){if(fx)return X0;fx=1,Object.defineProperty(X0,"__esModule",{value:!0}),X0.delay=void 0;function e(t){return new Promise(r=>{setTimeout(()=>{r(!0)},t)})}return X0.delay=e,X0}var dh={},oR={},lh={},px;function aoe(){return px||(px=1,Object.defineProperty(lh,"__esModule",{value:!0}),lh.ONE_THOUSAND=lh.ONE_HUNDRED=void 0,lh.ONE_HUNDRED=100,lh.ONE_THOUSAND=1e3),lh}var aR={},mx;function coe(){return mx||(mx=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ONE_YEAR=e.FOUR_WEEKS=e.THREE_WEEKS=e.TWO_WEEKS=e.ONE_WEEK=e.THIRTY_DAYS=e.SEVEN_DAYS=e.FIVE_DAYS=e.THREE_DAYS=e.ONE_DAY=e.TWENTY_FOUR_HOURS=e.TWELVE_HOURS=e.SIX_HOURS=e.THREE_HOURS=e.ONE_HOUR=e.SIXTY_MINUTES=e.THIRTY_MINUTES=e.TEN_MINUTES=e.FIVE_MINUTES=e.ONE_MINUTE=e.SIXTY_SECONDS=e.THIRTY_SECONDS=e.TEN_SECONDS=e.FIVE_SECONDS=e.ONE_SECOND=void 0,e.ONE_SECOND=1,e.FIVE_SECONDS=5,e.TEN_SECONDS=10,e.THIRTY_SECONDS=30,e.SIXTY_SECONDS=60,e.ONE_MINUTE=e.SIXTY_SECONDS,e.FIVE_MINUTES=e.ONE_MINUTE*5,e.TEN_MINUTES=e.ONE_MINUTE*10,e.THIRTY_MINUTES=e.ONE_MINUTE*30,e.SIXTY_MINUTES=e.ONE_MINUTE*60,e.ONE_HOUR=e.SIXTY_MINUTES,e.THREE_HOURS=e.ONE_HOUR*3,e.SIX_HOURS=e.ONE_HOUR*6,e.TWELVE_HOURS=e.ONE_HOUR*12,e.TWENTY_FOUR_HOURS=e.ONE_HOUR*24,e.ONE_DAY=e.TWENTY_FOUR_HOURS,e.THREE_DAYS=e.ONE_DAY*3,e.FIVE_DAYS=e.ONE_DAY*5,e.SEVEN_DAYS=e.ONE_DAY*7,e.THIRTY_DAYS=e.ONE_DAY*30,e.ONE_WEEK=e.SEVEN_DAYS,e.TWO_WEEKS=e.ONE_WEEK*2,e.THREE_WEEKS=e.ONE_WEEK*3,e.FOUR_WEEKS=e.ONE_WEEK*4,e.ONE_YEAR=e.ONE_DAY*365}(aR)),aR}var gx;function QH(){return gx||(gx=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=Cl;t.__exportStar(aoe(),e),t.__exportStar(coe(),e)}(oR)),oR}var _x;function doe(){if(_x)return dh;_x=1,Object.defineProperty(dh,"__esModule",{value:!0}),dh.fromMiliseconds=dh.toMiliseconds=void 0;const e=QH();function t(n){return n*e.ONE_THOUSAND}dh.toMiliseconds=t;function r(n){return Math.floor(n/e.ONE_THOUSAND)}return dh.fromMiliseconds=r,dh}var Ex;function loe(){return Ex||(Ex=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=Cl;t.__exportStar(ooe(),e),t.__exportStar(doe(),e)}(sR)),sR}var Wf={},vx;function uoe(){if(vx)return Wf;vx=1,Object.defineProperty(Wf,"__esModule",{value:!0}),Wf.Watch=void 0;class e{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const n=this.get(r);if(typeof n.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const i=Date.now()-n.started;this.timestamps.set(r,{started:n.started,elapsed:i})}get(r){const n=this.timestamps.get(r);if(typeof n>"u")throw new Error(`No timestamp found for label: ${r}`);return n}elapsed(r){const n=this.get(r);return n.elapsed||Date.now()-n.started}}return Wf.Watch=e,Wf.default=e,Wf}var cR={},Q0={},yx;function hoe(){if(yx)return Q0;yx=1,Object.defineProperty(Q0,"__esModule",{value:!0}),Q0.IWatch=void 0;class e{}return Q0.IWatch=e,Q0}var bx;function foe(){return bx||(bx=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Cl.__exportStar(hoe(),e)}(cR)),cR}(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=Cl;t.__exportStar(loe(),e),t.__exportStar(uoe(),e),t.__exportStar(foe(),e),t.__exportStar(QH(),e)})(Ge);var dR={},Z0={};class Df{}const poe=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Df},Symbol.toStringTag,{value:"Module"})),moe=LS(poe);var Sx;function goe(){if(Sx)return Z0;Sx=1,Object.defineProperty(Z0,"__esModule",{value:!0}),Z0.IHeartBeat=void 0;const e=moe;class t extends e.IEvents{constructor(n){super()}}return Z0.IHeartBeat=t,Z0}var wx;function ZH(){return wx||(wx=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Cl.__exportStar(goe(),e)}(dR)),dR}var lR={},uh={},Tx;function _oe(){if(Tx)return uh;Tx=1,Object.defineProperty(uh,"__esModule",{value:!0}),uh.HEARTBEAT_EVENTS=uh.HEARTBEAT_INTERVAL=void 0;const e=Ge;return uh.HEARTBEAT_INTERVAL=e.FIVE_SECONDS,uh.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},uh}var Rx;function ez(){return Rx||(Rx=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Cl.__exportStar(_oe(),e)}(lR)),lR}var Ax;function Eoe(){if(Ax)return J0;Ax=1,Object.defineProperty(J0,"__esModule",{value:!0}),J0.HeartBeat=void 0;const e=Cl,t=Sc,r=Ge,n=ZH(),i=ez();class s extends n.IHeartBeat{constructor(a){super(a),this.events=new t.EventEmitter,this.interval=i.HEARTBEAT_INTERVAL,this.interval=(a==null?void 0:a.interval)||i.HEARTBEAT_INTERVAL}static init(a){return e.__awaiter(this,void 0,void 0,function*(){const c=new s(a);return yield c.init(),c})}init(){return e.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(a,c){this.events.on(a,c)}once(a,c){this.events.once(a,c)}off(a,c){this.events.off(a,c)}removeListener(a,c){this.events.removeListener(a,c)}initialize(){return e.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(i.HEARTBEAT_EVENTS.pulse)}}return J0.HeartBeat=s,J0}(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=Cl;t.__exportStar(Eoe(),e),t.__exportStar(ZH(),e),t.__exportStar(ez(),e)})(r0);function voe(e){try{return JSON.stringify(e)}catch{return'"[Circular]"'}}var yoe=boe;function boe(e,t,r){var n=r&&r.stringify||voe,i=1;if(typeof e=="object"&&e!==null){var s=t.length+i;if(s===1)return e;var o=new Array(s);o[0]=n(e);for(var a=1;a<s;a++)o[a]=n(t[a]);return o.join(" ")}if(typeof e!="string")return e;var c=t.length;if(c===0)return e;for(var d="",l=1-i,u=-1,h=e&&e.length||0,p=0;p<h;){if(e.charCodeAt(p)===37&&p+1<h){switch(u=u>-1?u:0,e.charCodeAt(p+1)){case 100:case 102:if(l>=c||t[l]==null)break;u<p&&(d+=e.slice(u,p)),d+=Number(t[l]),u=p+2,p++;break;case 105:if(l>=c||t[l]==null)break;u<p&&(d+=e.slice(u,p)),d+=Math.floor(Number(t[l])),u=p+2,p++;break;case 79:case 111:case 106:if(l>=c||t[l]===void 0)break;u<p&&(d+=e.slice(u,p));var _=typeof t[l];if(_==="string"){d+="'"+t[l]+"'",u=p+2,p++;break}if(_==="function"){d+=t[l].name||"<anonymous>",u=p+2,p++;break}d+=n(t[l]),u=p+2,p++;break;case 115:if(l>=c)break;u<p&&(d+=e.slice(u,p)),d+=String(t[l]),u=p+2,p++;break;case 37:u<p&&(d+=e.slice(u,p)),d+="%",u=p+2,p++,l--;break}++l}++p}return u===-1?e:(u<h&&(d+=e.slice(u)),d)}const Cx=yoe;var mp=id;const F_=Doe().console||{},Soe={mapHttpRequest:Uv,mapHttpResponse:Uv,wrapRequestSerializer:uR,wrapResponseSerializer:uR,wrapErrorSerializer:uR,req:Uv,res:Uv,err:Coe};function woe(e,t){return Array.isArray(e)?e.filter(function(n){return n!=="!stdSerializers.err"}):e===!0?Object.keys(t):!1}function id(e){e=e||{},e.browser=e.browser||{};const t=e.browser.transmit;if(t&&typeof t.send!="function")throw Error("pino: transmit option must have a send function");const r=e.browser.write||F_;e.browser.write&&(e.browser.asObject=!0);const n=e.serializers||{},i=woe(e.browser.serialize,n);let s=e.browser.serialize;Array.isArray(e.browser.serialize)&&e.browser.serialize.indexOf("!stdSerializers.err")>-1&&(s=!1);const o=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),e.enabled===!1&&(e.level="silent");const a=e.level||"info",c=Object.create(r);c.log||(c.log=B_),Object.defineProperty(c,"levelVal",{get:l}),Object.defineProperty(c,"level",{get:u,set:h});const d={transmit:t,serialize:i,asObject:e.browser.asObject,levels:o,timestamp:Ioe(e)};c.levels=id.levels,c.level=a,c.setMaxListeners=c.getMaxListeners=c.emit=c.addListener=c.on=c.prependListener=c.once=c.prependOnceListener=c.removeListener=c.removeAllListeners=c.listeners=c.listenerCount=c.eventNames=c.write=c.flush=B_,c.serializers=n,c._serialize=i,c._stdErrSerialize=s,c.child=p,t&&(c._logEvent=kO());function l(){return this.level==="silent"?1/0:this.levels.values[this.level]}function u(){return this._level}function h(_){if(_!=="silent"&&!this.levels.values[_])throw Error("unknown level "+_);this._level=_,Gf(d,c,"error","log"),Gf(d,c,"fatal","error"),Gf(d,c,"warn","error"),Gf(d,c,"info","log"),Gf(d,c,"debug","log"),Gf(d,c,"trace","log")}function p(_,g){if(!_)throw new Error("missing bindings for child Pino");g=g||{},i&&_.serializers&&(g.serializers=_.serializers);const E=g.serializers;if(i&&E){var b=Object.assign({},n,E),v=e.browser.serialize===!0?Object.keys(b):i;delete _.serializers,dw([_],v,b,this._stdErrSerialize)}function I(N){this._childLevel=(N._childLevel|0)+1,this.error=qf(N,_,"error"),this.fatal=qf(N,_,"fatal"),this.warn=qf(N,_,"warn"),this.info=qf(N,_,"info"),this.debug=qf(N,_,"debug"),this.trace=qf(N,_,"trace"),b&&(this.serializers=b,this._serialize=v),t&&(this._logEvent=kO([].concat(N._logEvent.bindings,_)))}return I.prototype=this,new I(this)}return c}id.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};id.stdSerializers=Soe;id.stdTimeFunctions=Object.assign({},{nullTime:tz,epochTime:rz,unixTime:Ooe,isoTime:Noe});function Gf(e,t,r,n){const i=Object.getPrototypeOf(t);t[r]=t.levelVal>t.levels.values[r]?B_:i[r]?i[r]:F_[r]||F_[n]||B_,Toe(e,t,r)}function Toe(e,t,r){!e.transmit&&t[r]===B_||(t[r]=function(n){return function(){const s=e.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===F_?F_:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];if(e.serialize&&!e.asObject&&dw(o,this._serialize,this.serializers,this._stdErrSerialize),e.asObject?n.call(a,Roe(this,r,o,s)):n.apply(a,o),e.transmit){const d=e.transmit.level||t.level,l=id.levels.values[d],u=id.levels.values[r];if(u<l)return;Aoe(this,{ts:s,methodLevel:r,methodValue:u,transmitLevel:d,transmitValue:id.levels.values[e.transmit.level||t.level],send:e.transmit.send,val:t.levelVal},o)}}}(t[r]))}function Roe(e,t,r,n){e._serialize&&dw(r,e._serialize,e.serializers,e._stdErrSerialize);const i=r.slice();let s=i[0];const o={};n&&(o.time=n),o.level=id.levels.values[t];let a=(e._childLevel|0)+1;if(a<1&&(a=1),s!==null&&typeof s=="object"){for(;a--&&typeof i[0]=="object";)Object.assign(o,i.shift());s=i.length?Cx(i.shift(),i):void 0}else typeof s=="string"&&(s=Cx(i.shift(),i));return s!==void 0&&(o.msg=s),o}function dw(e,t,r,n){for(const i in e)if(n&&e[i]instanceof Error)e[i]=id.stdSerializers.err(e[i]);else if(typeof e[i]=="object"&&!Array.isArray(e[i]))for(const s in e[i])t&&t.indexOf(s)>-1&&s in r&&(e[i][s]=r[s](e[i][s]))}function qf(e,t,r){return function(){const n=new Array(1+arguments.length);n[0]=t;for(var i=1;i<n.length;i++)n[i]=arguments[i-1];return e[r].apply(this,n)}}function Aoe(e,t,r){const n=t.send,i=t.ts,s=t.methodLevel,o=t.methodValue,a=t.val,c=e._logEvent.bindings;dw(r,e._serialize||Object.keys(e.serializers),e.serializers,e._stdErrSerialize===void 0?!0:e._stdErrSerialize),e._logEvent.ts=i,e._logEvent.messages=r.filter(function(d){return c.indexOf(d)===-1}),e._logEvent.level.label=s,e._logEvent.level.value=o,n(s,e._logEvent,a),e._logEvent=kO(c)}function kO(e){return{ts:0,messages:[],bindings:e||[],level:{label:"",value:0}}}function Coe(e){const t={type:e.constructor.name,msg:e.message,stack:e.stack};for(const r in e)t[r]===void 0&&(t[r]=e[r]);return t}function Ioe(e){return typeof e.timestamp=="function"?e.timestamp:e.timestamp===!1?tz:rz}function Uv(){return{}}function uR(e){return e}function B_(){}function tz(){return!1}function rz(){return Date.now()}function Ooe(){return Math.round(Date.now()/1e3)}function Noe(){return new Date(Date.now()).toISOString()}function Doe(){function e(t){return typeof t<"u"&&t}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return e(self)||e(window)||e(this)||{}}}const lw=Rf(mp),Poe={level:"info"},BE="custom_context",qD=1e3*1024;let koe=class{constructor(t){this.nodeValue=t,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},Ix=class{constructor(t){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=t,this.sizeInBytes=0}append(t){const r=new koe(t);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${t} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const t=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=t.size}toArray(){const t=[];let r=this.head;for(;r!==null;)t.push(r.value),r=r.next;return t}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let t=this.head;return{next:()=>{if(!t)return{done:!0,value:null};const r=t.value;return t=t.next,{done:!1,value:r}}}}},nz=class{constructor(t,r=qD){this.level=t??"error",this.levelValue=mp.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new Ix(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(t,r){r===mp.levels.values.error?console.error(t):r===mp.levels.values.warn?console.warn(t):r===mp.levels.values.debug?console.debug(t):r===mp.levels.values.trace?console.trace(t):console.log(t)}appendToLogs(t){this.logs.append(ff({timestamp:new Date().toISOString(),log:t}));const r=typeof t=="string"?JSON.parse(t).level:t.level;r>=this.levelValue&&this.forwardToConsole(t,r)}getLogs(){return this.logs}clearLogs(){this.logs=new Ix(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(t){const r=this.getLogArray();return r.push(ff({extraMetadata:t})),new Blob(r,{type:"application/json"})}},Loe=class{constructor(t,r=qD){this.baseChunkLogger=new nz(t,r)}write(t){this.baseChunkLogger.appendToLogs(t)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(t){return this.baseChunkLogger.logsToBlob(t)}downloadLogsBlobInBrowser(t){const r=URL.createObjectURL(this.logsToBlob(t)),n=document.createElement("a");n.href=r,n.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}},xoe=class{constructor(t,r=qD){this.baseChunkLogger=new nz(t,r)}write(t){this.baseChunkLogger.appendToLogs(t)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(t){return this.baseChunkLogger.logsToBlob(t)}};var Moe=Object.defineProperty,Uoe=Object.defineProperties,joe=Object.getOwnPropertyDescriptors,Ox=Object.getOwnPropertySymbols,Foe=Object.prototype.hasOwnProperty,Boe=Object.prototype.propertyIsEnumerable,Nx=(e,t,r)=>t in e?Moe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,I1=(e,t)=>{for(var r in t||(t={}))Foe.call(t,r)&&Nx(e,r,t[r]);if(Ox)for(var r of Ox(t))Boe.call(t,r)&&Nx(e,r,t[r]);return e},O1=(e,t)=>Uoe(e,joe(t));function KD(e){return O1(I1({},e),{level:(e==null?void 0:e.level)||Poe.level})}function Voe(e,t=BE){return e[t]||""}function $oe(e,t,r=BE){return e[r]=t,e}function go(e,t=BE){let r="";return typeof e.bindings>"u"?r=Voe(e,t):r=e.bindings().context||"",r}function Hoe(e,t,r=BE){const n=go(e,r);return n.trim()?`${n}/${t}`:t}function _o(e,t,r=BE){const n=Hoe(e,t,r),i=e.child({context:n});return $oe(i,n,r)}function zoe(e){var t,r;const n=new Loe((t=e.opts)==null?void 0:t.level,e.maxSizeInBytes);return{logger:lw(O1(I1({},e.opts),{level:"trace",browser:O1(I1({},(r=e.opts)==null?void 0:r.browser),{write:i=>n.write(i)})})),chunkLoggerController:n}}function Woe(e){var t;const r=new xoe((t=e.opts)==null?void 0:t.level,e.maxSizeInBytes);return{logger:lw(O1(I1({},e.opts),{level:"trace"}),r),chunkLoggerController:r}}function Goe(e){return typeof e.loggerOverride<"u"&&typeof e.loggerOverride!="string"?{logger:e.loggerOverride,chunkLoggerController:null}:typeof window<"u"?zoe(e):Woe(e)}let qoe=class extends Df{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}},Koe=class extends Df{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}},Yoe=class{constructor(t,r){this.logger=t,this.core=r}},Joe=class extends Df{constructor(t,r){super(),this.relayer=t,this.logger=r}},Xoe=class extends Df{constructor(t){super()}},Qoe=class{constructor(t,r,n,i){this.core=t,this.logger=r,this.name=n}},Zoe=class extends Df{constructor(t,r){super(),this.relayer=t,this.logger=r}},eae=class extends Df{constructor(t,r){super(),this.core=t,this.logger=r}},tae=class{constructor(t,r){this.projectId=t,this.logger=r}},rae=class{constructor(t,r){this.projectId=t,this.logger=r}},nae=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},iae=class{constructor(t){this.client=t}};var YD={},n0={},uw={},hw={};Object.defineProperty(hw,"__esModule",{value:!0});hw.BrowserRandomSource=void 0;const Dx=65536;class sae{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const t=typeof self<"u"?self.crypto||self.msCrypto:null;t&&t.getRandomValues!==void 0&&(this._crypto=t,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(t){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const r=new Uint8Array(t);for(let n=0;n<r.length;n+=Dx)this._crypto.getRandomValues(r.subarray(n,n+Math.min(r.length-n,Dx)));return r}}hw.BrowserRandomSource=sae;function oae(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var fw={},zo={};Object.defineProperty(zo,"__esModule",{value:!0});function aae(e){for(var t=0;t<e.length;t++)e[t]=0;return e}zo.wipe=aae;const cae={},dae=Object.freeze(Object.defineProperty({__proto__:null,default:cae},Symbol.toStringTag,{value:"Module"})),JD=LS(dae);Object.defineProperty(fw,"__esModule",{value:!0});fw.NodeRandomSource=void 0;const lae=zo;class uae{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof oae<"u"){const t=JD;t&&t.randomBytes&&(this._crypto=t,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(t){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let r=this._crypto.randomBytes(t);if(r.length!==t)throw new Error("NodeRandomSource: got fewer bytes than requested");const n=new Uint8Array(t);for(let i=0;i<n.length;i++)n[i]=r[i];return(0,lae.wipe)(r),n}}fw.NodeRandomSource=uae;Object.defineProperty(uw,"__esModule",{value:!0});uw.SystemRandomSource=void 0;const hae=hw,fae=fw;class pae{constructor(){if(this.isAvailable=!1,this.name="",this._source=new hae.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new fae.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(t){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(t)}}uw.SystemRandomSource=pae;var Xt={},iz={};(function(e){Object.defineProperty(e,"__esModule",{value:!0});function t(a,c){var d=a>>>16&65535,l=a&65535,u=c>>>16&65535,h=c&65535;return l*h+(d*h+l*u<<16>>>0)|0}e.mul=Math.imul||t;function r(a,c){return a+c|0}e.add=r;function n(a,c){return a-c|0}e.sub=n;function i(a,c){return a<<c|a>>>32-c}e.rotl=i;function s(a,c){return a<<32-c|a>>>c}e.rotr=s;function o(a){return typeof a=="number"&&isFinite(a)&&Math.floor(a)===a}e.isInteger=Number.isInteger||o,e.MAX_SAFE_INTEGER=9007199254740991,e.isSafeInteger=function(a){return e.isInteger(a)&&a>=-e.MAX_SAFE_INTEGER&&a<=e.MAX_SAFE_INTEGER}})(iz);Object.defineProperty(Xt,"__esModule",{value:!0});var sz=iz;function mae(e,t){return t===void 0&&(t=0),(e[t+0]<<8|e[t+1])<<16>>16}Xt.readInt16BE=mae;function gae(e,t){return t===void 0&&(t=0),(e[t+0]<<8|e[t+1])>>>0}Xt.readUint16BE=gae;function _ae(e,t){return t===void 0&&(t=0),(e[t+1]<<8|e[t])<<16>>16}Xt.readInt16LE=_ae;function Eae(e,t){return t===void 0&&(t=0),(e[t+1]<<8|e[t])>>>0}Xt.readUint16LE=Eae;function oz(e,t,r){return t===void 0&&(t=new Uint8Array(2)),r===void 0&&(r=0),t[r+0]=e>>>8,t[r+1]=e>>>0,t}Xt.writeUint16BE=oz;Xt.writeInt16BE=oz;function az(e,t,r){return t===void 0&&(t=new Uint8Array(2)),r===void 0&&(r=0),t[r+0]=e>>>0,t[r+1]=e>>>8,t}Xt.writeUint16LE=az;Xt.writeInt16LE=az;function LO(e,t){return t===void 0&&(t=0),e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}Xt.readInt32BE=LO;function xO(e,t){return t===void 0&&(t=0),(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}Xt.readUint32BE=xO;function MO(e,t){return t===void 0&&(t=0),e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]}Xt.readInt32LE=MO;function UO(e,t){return t===void 0&&(t=0),(e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t])>>>0}Xt.readUint32LE=UO;function N1(e,t,r){return t===void 0&&(t=new Uint8Array(4)),r===void 0&&(r=0),t[r+0]=e>>>24,t[r+1]=e>>>16,t[r+2]=e>>>8,t[r+3]=e>>>0,t}Xt.writeUint32BE=N1;Xt.writeInt32BE=N1;function D1(e,t,r){return t===void 0&&(t=new Uint8Array(4)),r===void 0&&(r=0),t[r+0]=e>>>0,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24,t}Xt.writeUint32LE=D1;Xt.writeInt32LE=D1;function vae(e,t){t===void 0&&(t=0);var r=LO(e,t),n=LO(e,t+4);return r*4294967296+n-(n>>31)*4294967296}Xt.readInt64BE=vae;function yae(e,t){t===void 0&&(t=0);var r=xO(e,t),n=xO(e,t+4);return r*4294967296+n}Xt.readUint64BE=yae;function bae(e,t){t===void 0&&(t=0);var r=MO(e,t),n=MO(e,t+4);return n*4294967296+r-(r>>31)*4294967296}Xt.readInt64LE=bae;function Sae(e,t){t===void 0&&(t=0);var r=UO(e,t),n=UO(e,t+4);return n*4294967296+r}Xt.readUint64LE=Sae;function cz(e,t,r){return t===void 0&&(t=new Uint8Array(8)),r===void 0&&(r=0),N1(e/4294967296>>>0,t,r),N1(e>>>0,t,r+4),t}Xt.writeUint64BE=cz;Xt.writeInt64BE=cz;function dz(e,t,r){return t===void 0&&(t=new Uint8Array(8)),r===void 0&&(r=0),D1(e>>>0,t,r),D1(e/4294967296>>>0,t,r+4),t}Xt.writeUint64LE=dz;Xt.writeInt64LE=dz;function wae(e,t,r){if(r===void 0&&(r=0),e%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(e/8>t.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var n=0,i=1,s=e/8+r-1;s>=r;s--)n+=t[s]*i,i*=256;return n}Xt.readUintBE=wae;function Tae(e,t,r){if(r===void 0&&(r=0),e%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(e/8>t.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var n=0,i=1,s=r;s<r+e/8;s++)n+=t[s]*i,i*=256;return n}Xt.readUintLE=Tae;function Rae(e,t,r,n){if(r===void 0&&(r=new Uint8Array(e/8)),n===void 0&&(n=0),e%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!sz.isSafeInteger(t))throw new Error("writeUintBE value must be an integer");for(var i=1,s=e/8+n-1;s>=n;s--)r[s]=t/i&255,i*=256;return r}Xt.writeUintBE=Rae;function Aae(e,t,r,n){if(r===void 0&&(r=new Uint8Array(e/8)),n===void 0&&(n=0),e%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!sz.isSafeInteger(t))throw new Error("writeUintLE value must be an integer");for(var i=1,s=n;s<n+e/8;s++)r[s]=t/i&255,i*=256;return r}Xt.writeUintLE=Aae;function Cae(e,t){t===void 0&&(t=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.getFloat32(t)}Xt.readFloat32BE=Cae;function Iae(e,t){t===void 0&&(t=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.getFloat32(t,!0)}Xt.readFloat32LE=Iae;function Oae(e,t){t===void 0&&(t=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.getFloat64(t)}Xt.readFloat64BE=Oae;function Nae(e,t){t===void 0&&(t=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.getFloat64(t,!0)}Xt.readFloat64LE=Nae;function Dae(e,t,r){t===void 0&&(t=new Uint8Array(4)),r===void 0&&(r=0);var n=new DataView(t.buffer,t.byteOffset,t.byteLength);return n.setFloat32(r,e),t}Xt.writeFloat32BE=Dae;function Pae(e,t,r){t===void 0&&(t=new Uint8Array(4)),r===void 0&&(r=0);var n=new DataView(t.buffer,t.byteOffset,t.byteLength);return n.setFloat32(r,e,!0),t}Xt.writeFloat32LE=Pae;function kae(e,t,r){t===void 0&&(t=new Uint8Array(8)),r===void 0&&(r=0);var n=new DataView(t.buffer,t.byteOffset,t.byteLength);return n.setFloat64(r,e),t}Xt.writeFloat64BE=kae;function Lae(e,t,r){t===void 0&&(t=new Uint8Array(8)),r===void 0&&(r=0);var n=new DataView(t.buffer,t.byteOffset,t.byteLength);return n.setFloat64(r,e,!0),t}Xt.writeFloat64LE=Lae;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.randomStringForEntropy=e.randomString=e.randomUint32=e.randomBytes=e.defaultRandomSource=void 0;const t=uw,r=Xt,n=zo;e.defaultRandomSource=new t.SystemRandomSource;function i(d,l=e.defaultRandomSource){return l.randomBytes(d)}e.randomBytes=i;function s(d=e.defaultRandomSource){const l=i(4,d),u=(0,r.readUint32LE)(l);return(0,n.wipe)(l),u}e.randomUint32=s;const o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function a(d,l=o,u=e.defaultRandomSource){if(l.length<2)throw new Error("randomString charset is too short");if(l.length>256)throw new Error("randomString charset is too long");let h="";const p=l.length,_=256-256%p;for(;d>0;){const g=i(Math.ceil(d*256/_),u);for(let E=0;E<g.length&&d>0;E++){const b=g[E];b<_&&(h+=l.charAt(b%p),d--)}(0,n.wipe)(g)}return h}e.randomString=a;function c(d,l=o,u=e.defaultRandomSource){const h=Math.ceil(d/(Math.log(l.length)/Math.LN2));return a(h,l,u)}e.randomStringForEntropy=c})(n0);var lz={};(function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Xt,r=zo;e.DIGEST_LENGTH=64,e.BLOCK_SIZE=128;var n=function(){function a(){this.digestLength=e.DIGEST_LENGTH,this.blockSize=e.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return a.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},a.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},a.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},a.prototype.update=function(c,d){if(d===void 0&&(d=c.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var l=0;if(this._bytesHashed+=d,this._bufferLength>0){for(;this._bufferLength<e.BLOCK_SIZE&&d>0;)this._buffer[this._bufferLength++]=c[l++],d--;this._bufferLength===this.blockSize&&(s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(d>=this.blockSize&&(l=s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,c,l,d),d%=this.blockSize);d>0;)this._buffer[this._bufferLength++]=c[l++],d--;return this},a.prototype.finish=function(c){if(!this._finished){var d=this._bytesHashed,l=this._bufferLength,u=d/536870912|0,h=d<<3,p=d%128<112?128:256;this._buffer[l]=128;for(var _=l+1;_<p-8;_++)this._buffer[_]=0;t.writeUint32BE(u,this._buffer,p-8),t.writeUint32BE(h,this._buffer,p-4),s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,p),this._finished=!0}for(var _=0;_<this.digestLength/8;_++)t.writeUint32BE(this._stateHi[_],c,_*8),t.writeUint32BE(this._stateLo[_],c,_*8+4);return this},a.prototype.digest=function(){var c=new Uint8Array(this.digestLength);return this.finish(c),c},a.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},a.prototype.restoreState=function(c){return this._stateHi.set(c.stateHi),this._stateLo.set(c.stateLo),this._bufferLength=c.bufferLength,c.buffer&&this._buffer.set(c.buffer),this._bytesHashed=c.bytesHashed,this._finished=!1,this},a.prototype.cleanSavedState=function(c){r.wipe(c.stateHi),r.wipe(c.stateLo),c.buffer&&r.wipe(c.buffer),c.bufferLength=0,c.bytesHashed=0},a}();e.SHA512=n;var i=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function s(a,c,d,l,u,h,p){for(var _=d[0],g=d[1],E=d[2],b=d[3],v=d[4],I=d[5],N=d[6],L=d[7],U=l[0],w=l[1],V=l[2],z=l[3],K=l[4],H=l[5],A=l[6],m=l[7],S,T,x,D,k,P,y,f;p>=128;){for(var R=0;R<16;R++){var B=8*R+h;a[R]=t.readUint32BE(u,B),c[R]=t.readUint32BE(u,B+4)}for(var R=0;R<80;R++){var q=_,F=g,te=E,G=b,Y=v,X=I,M=N,J=L,de=U,he=w,Se=V,Te=z,Re=K,Ne=H,Q=A,re=m;if(S=L,T=m,k=T&65535,P=T>>>16,y=S&65535,f=S>>>16,S=(v>>>14|K<<18)^(v>>>18|K<<14)^(K>>>9|v<<23),T=(K>>>14|v<<18)^(K>>>18|v<<14)^(v>>>9|K<<23),k+=T&65535,P+=T>>>16,y+=S&65535,f+=S>>>16,S=v&I^~v&N,T=K&H^~K&A,k+=T&65535,P+=T>>>16,y+=S&65535,f+=S>>>16,S=i[R*2],T=i[R*2+1],k+=T&65535,P+=T>>>16,y+=S&65535,f+=S>>>16,S=a[R%16],T=c[R%16],k+=T&65535,P+=T>>>16,y+=S&65535,f+=S>>>16,P+=k>>>16,y+=P>>>16,f+=y>>>16,x=y&65535|f<<16,D=k&65535|P<<16,S=x,T=D,k=T&65535,P=T>>>16,y=S&65535,f=S>>>16,S=(_>>>28|U<<4)^(U>>>2|_<<30)^(U>>>7|_<<25),T=(U>>>28|_<<4)^(_>>>2|U<<30)^(_>>>7|U<<25),k+=T&65535,P+=T>>>16,y+=S&65535,f+=S>>>16,S=_&g^_&E^g&E,T=U&w^U&V^w&V,k+=T&65535,P+=T>>>16,y+=S&65535,f+=S>>>16,P+=k>>>16,y+=P>>>16,f+=y>>>16,J=y&65535|f<<16,re=k&65535|P<<16,S=G,T=Te,k=T&65535,P=T>>>16,y=S&65535,f=S>>>16,S=x,T=D,k+=T&65535,P+=T>>>16,y+=S&65535,f+=S>>>16,P+=k>>>16,y+=P>>>16,f+=y>>>16,G=y&65535|f<<16,Te=k&65535|P<<16,g=q,E=F,b=te,v=G,I=Y,N=X,L=M,_=J,w=de,V=he,z=Se,K=Te,H=Re,A=Ne,m=Q,U=re,R%16===15)for(var B=0;B<16;B++)S=a[B],T=c[B],k=T&65535,P=T>>>16,y=S&65535,f=S>>>16,S=a[(B+9)%16],T=c[(B+9)%16],k+=T&65535,P+=T>>>16,y+=S&65535,f+=S>>>16,x=a[(B+1)%16],D=c[(B+1)%16],S=(x>>>1|D<<31)^(x>>>8|D<<24)^x>>>7,T=(D>>>1|x<<31)^(D>>>8|x<<24)^(D>>>7|x<<25),k+=T&65535,P+=T>>>16,y+=S&65535,f+=S>>>16,x=a[(B+14)%16],D=c[(B+14)%16],S=(x>>>19|D<<13)^(D>>>29|x<<3)^x>>>6,T=(D>>>19|x<<13)^(x>>>29|D<<3)^(D>>>6|x<<26),k+=T&65535,P+=T>>>16,y+=S&65535,f+=S>>>16,P+=k>>>16,y+=P>>>16,f+=y>>>16,a[B]=y&65535|f<<16,c[B]=k&65535|P<<16}S=_,T=U,k=T&65535,P=T>>>16,y=S&65535,f=S>>>16,S=d[0],T=l[0],k+=T&65535,P+=T>>>16,y+=S&65535,f+=S>>>16,P+=k>>>16,y+=P>>>16,f+=y>>>16,d[0]=_=y&65535|f<<16,l[0]=U=k&65535|P<<16,S=g,T=w,k=T&65535,P=T>>>16,y=S&65535,f=S>>>16,S=d[1],T=l[1],k+=T&65535,P+=T>>>16,y+=S&65535,f+=S>>>16,P+=k>>>16,y+=P>>>16,f+=y>>>16,d[1]=g=y&65535|f<<16,l[1]=w=k&65535|P<<16,S=E,T=V,k=T&65535,P=T>>>16,y=S&65535,f=S>>>16,S=d[2],T=l[2],k+=T&65535,P+=T>>>16,y+=S&65535,f+=S>>>16,P+=k>>>16,y+=P>>>16,f+=y>>>16,d[2]=E=y&65535|f<<16,l[2]=V=k&65535|P<<16,S=b,T=z,k=T&65535,P=T>>>16,y=S&65535,f=S>>>16,S=d[3],T=l[3],k+=T&65535,P+=T>>>16,y+=S&65535,f+=S>>>16,P+=k>>>16,y+=P>>>16,f+=y>>>16,d[3]=b=y&65535|f<<16,l[3]=z=k&65535|P<<16,S=v,T=K,k=T&65535,P=T>>>16,y=S&65535,f=S>>>16,S=d[4],T=l[4],k+=T&65535,P+=T>>>16,y+=S&65535,f+=S>>>16,P+=k>>>16,y+=P>>>16,f+=y>>>16,d[4]=v=y&65535|f<<16,l[4]=K=k&65535|P<<16,S=I,T=H,k=T&65535,P=T>>>16,y=S&65535,f=S>>>16,S=d[5],T=l[5],k+=T&65535,P+=T>>>16,y+=S&65535,f+=S>>>16,P+=k>>>16,y+=P>>>16,f+=y>>>16,d[5]=I=y&65535|f<<16,l[5]=H=k&65535|P<<16,S=N,T=A,k=T&65535,P=T>>>16,y=S&65535,f=S>>>16,S=d[6],T=l[6],k+=T&65535,P+=T>>>16,y+=S&65535,f+=S>>>16,P+=k>>>16,y+=P>>>16,f+=y>>>16,d[6]=N=y&65535|f<<16,l[6]=A=k&65535|P<<16,S=L,T=m,k=T&65535,P=T>>>16,y=S&65535,f=S>>>16,S=d[7],T=l[7],k+=T&65535,P+=T>>>16,y+=S&65535,f+=S>>>16,P+=k>>>16,y+=P>>>16,f+=y>>>16,d[7]=L=y&65535|f<<16,l[7]=m=k&65535|P<<16,h+=128,p-=128}return h}function o(a){var c=new n;c.update(a);var d=c.digest();return c.clean(),d}e.hash=o})(lz);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.convertSecretKeyToX25519=e.convertPublicKeyToX25519=e.verify=e.sign=e.extractPublicKeyFromSecretKey=e.generateKeyPair=e.generateKeyPairFromSeed=e.SEED_LENGTH=e.SECRET_KEY_LENGTH=e.PUBLIC_KEY_LENGTH=e.SIGNATURE_LENGTH=void 0;const t=n0,r=lz,n=zo;e.SIGNATURE_LENGTH=64,e.PUBLIC_KEY_LENGTH=32,e.SECRET_KEY_LENGTH=64,e.SEED_LENGTH=32;function i(G){const Y=new Float64Array(16);if(G)for(let X=0;X<G.length;X++)Y[X]=G[X];return Y}const s=new Uint8Array(32);s[0]=9;const o=i(),a=i([1]),c=i([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),d=i([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),l=i([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),u=i([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),h=i([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function p(G,Y){for(let X=0;X<16;X++)G[X]=Y[X]|0}function _(G){let Y=1;for(let X=0;X<16;X++){let M=G[X]+Y+65535;Y=Math.floor(M/65536),G[X]=M-Y*65536}G[0]+=Y-1+37*(Y-1)}function g(G,Y,X){const M=~(X-1);for(let J=0;J<16;J++){const de=M&(G[J]^Y[J]);G[J]^=de,Y[J]^=de}}function E(G,Y){const X=i(),M=i();for(let J=0;J<16;J++)M[J]=Y[J];_(M),_(M),_(M);for(let J=0;J<2;J++){X[0]=M[0]-65517;for(let he=1;he<15;he++)X[he]=M[he]-65535-(X[he-1]>>16&1),X[he-1]&=65535;X[15]=M[15]-32767-(X[14]>>16&1);const de=X[15]>>16&1;X[14]&=65535,g(M,X,1-de)}for(let J=0;J<16;J++)G[2*J]=M[J]&255,G[2*J+1]=M[J]>>8}function b(G,Y){let X=0;for(let M=0;M<32;M++)X|=G[M]^Y[M];return(1&X-1>>>8)-1}function v(G,Y){const X=new Uint8Array(32),M=new Uint8Array(32);return E(X,G),E(M,Y),b(X,M)}function I(G){const Y=new Uint8Array(32);return E(Y,G),Y[0]&1}function N(G,Y){for(let X=0;X<16;X++)G[X]=Y[2*X]+(Y[2*X+1]<<8);G[15]&=32767}function L(G,Y,X){for(let M=0;M<16;M++)G[M]=Y[M]+X[M]}function U(G,Y,X){for(let M=0;M<16;M++)G[M]=Y[M]-X[M]}function w(G,Y,X){let M,J,de=0,he=0,Se=0,Te=0,Re=0,Ne=0,Q=0,re=0,ne=0,oe=0,ce=0,ue=0,fe=0,ye=0,Le=0,ke=0,Pe=0,Qe=0,ze=0,Ue=0,st=0,ct=0,Ve=0,ot=0,nr=0,ut=0,lr=0,Wt=0,pt=0,br=0,wr=0,Ke=X[0],wt=X[1],Ct=X[2],Ye=X[3],It=X[4],Tt=X[5],tt=X[6],kt=X[7],Lt=X[8],rt=X[9],xt=X[10],Ot=X[11],Je=X[12],gt=X[13],Mt=X[14],nt=X[15];M=Y[0],de+=M*Ke,he+=M*wt,Se+=M*Ct,Te+=M*Ye,Re+=M*It,Ne+=M*Tt,Q+=M*tt,re+=M*kt,ne+=M*Lt,oe+=M*rt,ce+=M*xt,ue+=M*Ot,fe+=M*Je,ye+=M*gt,Le+=M*Mt,ke+=M*nt,M=Y[1],he+=M*Ke,Se+=M*wt,Te+=M*Ct,Re+=M*Ye,Ne+=M*It,Q+=M*Tt,re+=M*tt,ne+=M*kt,oe+=M*Lt,ce+=M*rt,ue+=M*xt,fe+=M*Ot,ye+=M*Je,Le+=M*gt,ke+=M*Mt,Pe+=M*nt,M=Y[2],Se+=M*Ke,Te+=M*wt,Re+=M*Ct,Ne+=M*Ye,Q+=M*It,re+=M*Tt,ne+=M*tt,oe+=M*kt,ce+=M*Lt,ue+=M*rt,fe+=M*xt,ye+=M*Ot,Le+=M*Je,ke+=M*gt,Pe+=M*Mt,Qe+=M*nt,M=Y[3],Te+=M*Ke,Re+=M*wt,Ne+=M*Ct,Q+=M*Ye,re+=M*It,ne+=M*Tt,oe+=M*tt,ce+=M*kt,ue+=M*Lt,fe+=M*rt,ye+=M*xt,Le+=M*Ot,ke+=M*Je,Pe+=M*gt,Qe+=M*Mt,ze+=M*nt,M=Y[4],Re+=M*Ke,Ne+=M*wt,Q+=M*Ct,re+=M*Ye,ne+=M*It,oe+=M*Tt,ce+=M*tt,ue+=M*kt,fe+=M*Lt,ye+=M*rt,Le+=M*xt,ke+=M*Ot,Pe+=M*Je,Qe+=M*gt,ze+=M*Mt,Ue+=M*nt,M=Y[5],Ne+=M*Ke,Q+=M*wt,re+=M*Ct,ne+=M*Ye,oe+=M*It,ce+=M*Tt,ue+=M*tt,fe+=M*kt,ye+=M*Lt,Le+=M*rt,ke+=M*xt,Pe+=M*Ot,Qe+=M*Je,ze+=M*gt,Ue+=M*Mt,st+=M*nt,M=Y[6],Q+=M*Ke,re+=M*wt,ne+=M*Ct,oe+=M*Ye,ce+=M*It,ue+=M*Tt,fe+=M*tt,ye+=M*kt,Le+=M*Lt,ke+=M*rt,Pe+=M*xt,Qe+=M*Ot,ze+=M*Je,Ue+=M*gt,st+=M*Mt,ct+=M*nt,M=Y[7],re+=M*Ke,ne+=M*wt,oe+=M*Ct,ce+=M*Ye,ue+=M*It,fe+=M*Tt,ye+=M*tt,Le+=M*kt,ke+=M*Lt,Pe+=M*rt,Qe+=M*xt,ze+=M*Ot,Ue+=M*Je,st+=M*gt,ct+=M*Mt,Ve+=M*nt,M=Y[8],ne+=M*Ke,oe+=M*wt,ce+=M*Ct,ue+=M*Ye,fe+=M*It,ye+=M*Tt,Le+=M*tt,ke+=M*kt,Pe+=M*Lt,Qe+=M*rt,ze+=M*xt,Ue+=M*Ot,st+=M*Je,ct+=M*gt,Ve+=M*Mt,ot+=M*nt,M=Y[9],oe+=M*Ke,ce+=M*wt,ue+=M*Ct,fe+=M*Ye,ye+=M*It,Le+=M*Tt,ke+=M*tt,Pe+=M*kt,Qe+=M*Lt,ze+=M*rt,Ue+=M*xt,st+=M*Ot,ct+=M*Je,Ve+=M*gt,ot+=M*Mt,nr+=M*nt,M=Y[10],ce+=M*Ke,ue+=M*wt,fe+=M*Ct,ye+=M*Ye,Le+=M*It,ke+=M*Tt,Pe+=M*tt,Qe+=M*kt,ze+=M*Lt,Ue+=M*rt,st+=M*xt,ct+=M*Ot,Ve+=M*Je,ot+=M*gt,nr+=M*Mt,ut+=M*nt,M=Y[11],ue+=M*Ke,fe+=M*wt,ye+=M*Ct,Le+=M*Ye,ke+=M*It,Pe+=M*Tt,Qe+=M*tt,ze+=M*kt,Ue+=M*Lt,st+=M*rt,ct+=M*xt,Ve+=M*Ot,ot+=M*Je,nr+=M*gt,ut+=M*Mt,lr+=M*nt,M=Y[12],fe+=M*Ke,ye+=M*wt,Le+=M*Ct,ke+=M*Ye,Pe+=M*It,Qe+=M*Tt,ze+=M*tt,Ue+=M*kt,st+=M*Lt,ct+=M*rt,Ve+=M*xt,ot+=M*Ot,nr+=M*Je,ut+=M*gt,lr+=M*Mt,Wt+=M*nt,M=Y[13],ye+=M*Ke,Le+=M*wt,ke+=M*Ct,Pe+=M*Ye,Qe+=M*It,ze+=M*Tt,Ue+=M*tt,st+=M*kt,ct+=M*Lt,Ve+=M*rt,ot+=M*xt,nr+=M*Ot,ut+=M*Je,lr+=M*gt,Wt+=M*Mt,pt+=M*nt,M=Y[14],Le+=M*Ke,ke+=M*wt,Pe+=M*Ct,Qe+=M*Ye,ze+=M*It,Ue+=M*Tt,st+=M*tt,ct+=M*kt,Ve+=M*Lt,ot+=M*rt,nr+=M*xt,ut+=M*Ot,lr+=M*Je,Wt+=M*gt,pt+=M*Mt,br+=M*nt,M=Y[15],ke+=M*Ke,Pe+=M*wt,Qe+=M*Ct,ze+=M*Ye,Ue+=M*It,st+=M*Tt,ct+=M*tt,Ve+=M*kt,ot+=M*Lt,nr+=M*rt,ut+=M*xt,lr+=M*Ot,Wt+=M*Je,pt+=M*gt,br+=M*Mt,wr+=M*nt,de+=38*Pe,he+=38*Qe,Se+=38*ze,Te+=38*Ue,Re+=38*st,Ne+=38*ct,Q+=38*Ve,re+=38*ot,ne+=38*nr,oe+=38*ut,ce+=38*lr,ue+=38*Wt,fe+=38*pt,ye+=38*br,Le+=38*wr,J=1,M=de+J+65535,J=Math.floor(M/65536),de=M-J*65536,M=he+J+65535,J=Math.floor(M/65536),he=M-J*65536,M=Se+J+65535,J=Math.floor(M/65536),Se=M-J*65536,M=Te+J+65535,J=Math.floor(M/65536),Te=M-J*65536,M=Re+J+65535,J=Math.floor(M/65536),Re=M-J*65536,M=Ne+J+65535,J=Math.floor(M/65536),Ne=M-J*65536,M=Q+J+65535,J=Math.floor(M/65536),Q=M-J*65536,M=re+J+65535,J=Math.floor(M/65536),re=M-J*65536,M=ne+J+65535,J=Math.floor(M/65536),ne=M-J*65536,M=oe+J+65535,J=Math.floor(M/65536),oe=M-J*65536,M=ce+J+65535,J=Math.floor(M/65536),ce=M-J*65536,M=ue+J+65535,J=Math.floor(M/65536),ue=M-J*65536,M=fe+J+65535,J=Math.floor(M/65536),fe=M-J*65536,M=ye+J+65535,J=Math.floor(M/65536),ye=M-J*65536,M=Le+J+65535,J=Math.floor(M/65536),Le=M-J*65536,M=ke+J+65535,J=Math.floor(M/65536),ke=M-J*65536,de+=J-1+37*(J-1),J=1,M=de+J+65535,J=Math.floor(M/65536),de=M-J*65536,M=he+J+65535,J=Math.floor(M/65536),he=M-J*65536,M=Se+J+65535,J=Math.floor(M/65536),Se=M-J*65536,M=Te+J+65535,J=Math.floor(M/65536),Te=M-J*65536,M=Re+J+65535,J=Math.floor(M/65536),Re=M-J*65536,M=Ne+J+65535,J=Math.floor(M/65536),Ne=M-J*65536,M=Q+J+65535,J=Math.floor(M/65536),Q=M-J*65536,M=re+J+65535,J=Math.floor(M/65536),re=M-J*65536,M=ne+J+65535,J=Math.floor(M/65536),ne=M-J*65536,M=oe+J+65535,J=Math.floor(M/65536),oe=M-J*65536,M=ce+J+65535,J=Math.floor(M/65536),ce=M-J*65536,M=ue+J+65535,J=Math.floor(M/65536),ue=M-J*65536,M=fe+J+65535,J=Math.floor(M/65536),fe=M-J*65536,M=ye+J+65535,J=Math.floor(M/65536),ye=M-J*65536,M=Le+J+65535,J=Math.floor(M/65536),Le=M-J*65536,M=ke+J+65535,J=Math.floor(M/65536),ke=M-J*65536,de+=J-1+37*(J-1),G[0]=de,G[1]=he,G[2]=Se,G[3]=Te,G[4]=Re,G[5]=Ne,G[6]=Q,G[7]=re,G[8]=ne,G[9]=oe,G[10]=ce,G[11]=ue,G[12]=fe,G[13]=ye,G[14]=Le,G[15]=ke}function V(G,Y){w(G,Y,Y)}function z(G,Y){const X=i();let M;for(M=0;M<16;M++)X[M]=Y[M];for(M=253;M>=0;M--)V(X,X),M!==2&&M!==4&&w(X,X,Y);for(M=0;M<16;M++)G[M]=X[M]}function K(G,Y){const X=i();let M;for(M=0;M<16;M++)X[M]=Y[M];for(M=250;M>=0;M--)V(X,X),M!==1&&w(X,X,Y);for(M=0;M<16;M++)G[M]=X[M]}function H(G,Y){const X=i(),M=i(),J=i(),de=i(),he=i(),Se=i(),Te=i(),Re=i(),Ne=i();U(X,G[1],G[0]),U(Ne,Y[1],Y[0]),w(X,X,Ne),L(M,G[0],G[1]),L(Ne,Y[0],Y[1]),w(M,M,Ne),w(J,G[3],Y[3]),w(J,J,d),w(de,G[2],Y[2]),L(de,de,de),U(he,M,X),U(Se,de,J),L(Te,de,J),L(Re,M,X),w(G[0],he,Se),w(G[1],Re,Te),w(G[2],Te,Se),w(G[3],he,Re)}function A(G,Y,X){for(let M=0;M<4;M++)g(G[M],Y[M],X)}function m(G,Y){const X=i(),M=i(),J=i();z(J,Y[2]),w(X,Y[0],J),w(M,Y[1],J),E(G,M),G[31]^=I(X)<<7}function S(G,Y,X){p(G[0],o),p(G[1],a),p(G[2],a),p(G[3],o);for(let M=255;M>=0;--M){const J=X[M/8|0]>>(M&7)&1;A(G,Y,J),H(Y,G),H(G,G),A(G,Y,J)}}function T(G,Y){const X=[i(),i(),i(),i()];p(X[0],l),p(X[1],u),p(X[2],a),w(X[3],l,u),S(G,X,Y)}function x(G){if(G.length!==e.SEED_LENGTH)throw new Error(`ed25519: seed must be ${e.SEED_LENGTH} bytes`);const Y=(0,r.hash)(G);Y[0]&=248,Y[31]&=127,Y[31]|=64;const X=new Uint8Array(32),M=[i(),i(),i(),i()];T(M,Y),m(X,M);const J=new Uint8Array(64);return J.set(G),J.set(X,32),{publicKey:X,secretKey:J}}e.generateKeyPairFromSeed=x;function D(G){const Y=(0,t.randomBytes)(32,G),X=x(Y);return(0,n.wipe)(Y),X}e.generateKeyPair=D;function k(G){if(G.length!==e.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${e.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(G.subarray(32))}e.extractPublicKeyFromSecretKey=k;const P=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function y(G,Y){let X,M,J,de;for(M=63;M>=32;--M){for(X=0,J=M-32,de=M-12;J<de;++J)Y[J]+=X-16*Y[M]*P[J-(M-32)],X=Math.floor((Y[J]+128)/256),Y[J]-=X*256;Y[J]+=X,Y[M]=0}for(X=0,J=0;J<32;J++)Y[J]+=X-(Y[31]>>4)*P[J],X=Y[J]>>8,Y[J]&=255;for(J=0;J<32;J++)Y[J]-=X*P[J];for(M=0;M<32;M++)Y[M+1]+=Y[M]>>8,G[M]=Y[M]&255}function f(G){const Y=new Float64Array(64);for(let X=0;X<64;X++)Y[X]=G[X];for(let X=0;X<64;X++)G[X]=0;y(G,Y)}function R(G,Y){const X=new Float64Array(64),M=[i(),i(),i(),i()],J=(0,r.hash)(G.subarray(0,32));J[0]&=248,J[31]&=127,J[31]|=64;const de=new Uint8Array(64);de.set(J.subarray(32),32);const he=new r.SHA512;he.update(de.subarray(32)),he.update(Y);const Se=he.digest();he.clean(),f(Se),T(M,Se),m(de,M),he.reset(),he.update(de.subarray(0,32)),he.update(G.subarray(32)),he.update(Y);const Te=he.digest();f(Te);for(let Re=0;Re<32;Re++)X[Re]=Se[Re];for(let Re=0;Re<32;Re++)for(let Ne=0;Ne<32;Ne++)X[Re+Ne]+=Te[Re]*J[Ne];return y(de.subarray(32),X),de}e.sign=R;function B(G,Y){const X=i(),M=i(),J=i(),de=i(),he=i(),Se=i(),Te=i();return p(G[2],a),N(G[1],Y),V(J,G[1]),w(de,J,c),U(J,J,G[2]),L(de,G[2],de),V(he,de),V(Se,he),w(Te,Se,he),w(X,Te,J),w(X,X,de),K(X,X),w(X,X,J),w(X,X,de),w(X,X,de),w(G[0],X,de),V(M,G[0]),w(M,M,de),v(M,J)&&w(G[0],G[0],h),V(M,G[0]),w(M,M,de),v(M,J)?-1:(I(G[0])===Y[31]>>7&&U(G[0],o,G[0]),w(G[3],G[0],G[1]),0)}function q(G,Y,X){const M=new Uint8Array(32),J=[i(),i(),i(),i()],de=[i(),i(),i(),i()];if(X.length!==e.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${e.SIGNATURE_LENGTH} bytes`);if(B(de,G))return!1;const he=new r.SHA512;he.update(X.subarray(0,32)),he.update(G),he.update(Y);const Se=he.digest();return f(Se),S(J,de,Se),T(de,X.subarray(32)),H(J,de),m(M,J),!b(X,M)}e.verify=q;function F(G){let Y=[i(),i(),i(),i()];if(B(Y,G))throw new Error("Ed25519: invalid public key");let X=i(),M=i(),J=Y[1];L(X,a,J),U(M,a,J),z(M,M),w(X,X,M);let de=new Uint8Array(32);return E(de,X),de}e.convertPublicKeyToX25519=F;function te(G){const Y=(0,r.hash)(G.subarray(0,32));Y[0]&=248,Y[31]&=127,Y[31]|=64;const X=new Uint8Array(Y.subarray(0,32));return(0,n.wipe)(Y),X}e.convertSecretKeyToX25519=te})(YD);const xae="EdDSA",Mae="JWT",uz=".",hz="base64url",Uae="utf8",jae="utf8",Fae=":",Bae="did",Vae="key",Px="base58btc",$ae="z",Hae="K36",zae=32;function fz(e=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(e):new Uint8Array(e)}function jO(e,t){t||(t=e.reduce((i,s)=>i+s.length,0));const r=fz(t);let n=0;for(const i of e)r.set(i,n),n+=i.length;return r}function Wae(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),d=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function u(_){if(_ instanceof Uint8Array||(ArrayBuffer.isView(_)?_=new Uint8Array(_.buffer,_.byteOffset,_.byteLength):Array.isArray(_)&&(_=Uint8Array.from(_))),!(_ instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(_.length===0)return"";for(var g=0,E=0,b=0,v=_.length;b!==v&&_[b]===0;)b++,g++;for(var I=(v-b)*l+1>>>0,N=new Uint8Array(I);b!==v;){for(var L=_[b],U=0,w=I-1;(L!==0||U<E)&&w!==-1;w--,U++)L+=256*N[w]>>>0,N[w]=L%a>>>0,L=L/a>>>0;if(L!==0)throw new Error("Non-zero carry");E=U,b++}for(var V=I-E;V!==I&&N[V]===0;)V++;for(var z=c.repeat(g);V<I;++V)z+=e.charAt(N[V]);return z}function h(_){if(typeof _!="string")throw new TypeError("Expected String");if(_.length===0)return new Uint8Array;var g=0;if(_[g]!==" "){for(var E=0,b=0;_[g]===c;)E++,g++;for(var v=(_.length-g)*d+1>>>0,I=new Uint8Array(v);_[g];){var N=r[_.charCodeAt(g)];if(N===255)return;for(var L=0,U=v-1;(N!==0||L<b)&&U!==-1;U--,L++)N+=a*I[U]>>>0,I[U]=N%256>>>0,N=N/256>>>0;if(N!==0)throw new Error("Non-zero carry");b=L,g++}if(_[g]!==" "){for(var w=v-b;w!==v&&I[w]===0;)w++;for(var V=new Uint8Array(E+(v-w)),z=E;w!==v;)V[z++]=I[w++];return V}}}function p(_){var g=h(_);if(g)return g;throw new Error(`Non-${t} character`)}return{encode:u,decodeUnsafe:h,decode:p}}var Gae=Wae,qae=Gae;const Kae=e=>{if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},Yae=e=>new TextEncoder().encode(e),Jae=e=>new TextDecoder().decode(e);let Xae=class{constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},Qae=class{constructor(t,r,n){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return pz(this,t)}};class Zae{constructor(t){this.decoders=t}or(t){return pz(this,t)}decode(t){const r=t[0],n=this.decoders[r];if(n)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const pz=(e,t)=>new Zae({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class ece{constructor(t,r,n,i){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new Xae(t,r,n),this.decoder=new Qae(t,r,i)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const pw=({name:e,prefix:t,encode:r,decode:n})=>new ece(e,t,r,n),VE=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=qae(r,t);return pw({prefix:e,name:t,encode:n,decode:s=>Kae(i(s))})},tce=(e,t,r,n)=>{const i={};for(let l=0;l<t.length;++l)i[t[l]]=l;let s=e.length;for(;e[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,d=0;for(let l=0;l<s;++l){const u=i[e[l]];if(u===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|u,a+=r,a>=8&&(a-=8,o[d++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},rce=(e,t,r)=>{const n=t[t.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},zi=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>pw({prefix:t,name:e,encode(i){return rce(i,n,r)},decode(i){return tce(i,n,r,e)}}),nce=pw({prefix:"\0",name:"identity",encode:e=>Jae(e),decode:e=>Yae(e)}),ice=Object.freeze(Object.defineProperty({__proto__:null,identity:nce},Symbol.toStringTag,{value:"Module"})),sce=zi({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),oce=Object.freeze(Object.defineProperty({__proto__:null,base2:sce},Symbol.toStringTag,{value:"Module"})),ace=zi({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),cce=Object.freeze(Object.defineProperty({__proto__:null,base8:ace},Symbol.toStringTag,{value:"Module"})),dce=VE({prefix:"9",name:"base10",alphabet:"0123456789"}),lce=Object.freeze(Object.defineProperty({__proto__:null,base10:dce},Symbol.toStringTag,{value:"Module"})),uce=zi({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),hce=zi({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),fce=Object.freeze(Object.defineProperty({__proto__:null,base16:uce,base16upper:hce},Symbol.toStringTag,{value:"Module"})),pce=zi({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),mce=zi({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),gce=zi({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),_ce=zi({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Ece=zi({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),vce=zi({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),yce=zi({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),bce=zi({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Sce=zi({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),wce=Object.freeze(Object.defineProperty({__proto__:null,base32:pce,base32hex:Ece,base32hexpad:yce,base32hexpadupper:bce,base32hexupper:vce,base32pad:gce,base32padupper:_ce,base32upper:mce,base32z:Sce},Symbol.toStringTag,{value:"Module"})),Tce=VE({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Rce=VE({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Ace=Object.freeze(Object.defineProperty({__proto__:null,base36:Tce,base36upper:Rce},Symbol.toStringTag,{value:"Module"})),Cce=VE({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Ice=VE({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Oce=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Cce,base58flickr:Ice},Symbol.toStringTag,{value:"Module"})),Nce=zi({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Dce=zi({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Pce=zi({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),kce=zi({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Lce=Object.freeze(Object.defineProperty({__proto__:null,base64:Nce,base64pad:Dce,base64url:Pce,base64urlpad:kce},Symbol.toStringTag,{value:"Module"})),mz=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),xce=mz.reduce((e,t,r)=>(e[r]=t,e),[]),Mce=mz.reduce((e,t,r)=>(e[t.codePointAt(0)]=r,e),[]);function Uce(e){return e.reduce((t,r)=>(t+=xce[r],t),"")}function jce(e){const t=[];for(const r of e){const n=Mce[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}const Fce=pw({prefix:"🚀",name:"base256emoji",encode:Uce,decode:jce}),Bce=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Fce},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const kx={...ice,...oce,...cce,...lce,...fce,...wce,...Ace,...Oce,...Lce,...Bce};function gz(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const Lx=gz("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),hR=gz("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);const t=fz(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),_z={utf8:Lx,"utf-8":Lx,hex:kx.base16,latin1:hR,ascii:hR,binary:hR,...kx};function Is(e,t="utf8"){const r=_z[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8"):r.encoder.encode(e).substring(1)}function ro(e,t="utf8"){const r=_z[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(e,"utf8"):r.decoder.decode(`${r.prefix}${e}`)}function P1(e){return Is(ro(ff(e),Uae),hz)}function Ez(e){const t=ro(Hae,Px),r=$ae+Is(jO([t,e]),Px);return[Bae,Vae,r].join(Fae)}function Vce(e){return Is(e,hz)}function $ce(e){return ro([P1(e.header),P1(e.payload)].join(uz),jae)}function Hce(e){return[P1(e.header),P1(e.payload),Vce(e.signature)].join(uz)}function xx(e=n0.randomBytes(zae)){return YD.generateKeyPairFromSeed(e)}async function zce(e,t,r,n,i=Ge.fromMiliseconds(Date.now())){const s={alg:xae,typ:Mae},o=Ez(n.publicKey),a=i+r,c={iss:o,sub:e,aud:t,iat:i,exp:a},d=$ce({header:s,payload:c}),l=YD.sign(n.secretKey,d);return Hce({header:s,payload:c,signature:l})}var Mx=function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,s;n<i;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))},Wce=function(){function e(t,r,n){this.name=t,this.version=r,this.os=n,this.type="browser"}return e}(),Gce=function(){function e(t){this.version=t,this.type="node",this.name="node",this.os=process.platform}return e}(),qce=function(){function e(t,r,n,i){this.name=t,this.version=r,this.os=n,this.bot=i,this.type="bot-device"}return e}(),Kce=function(){function e(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return e}(),Yce=function(){function e(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return e}(),Jce=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Xce=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Ux=3,Qce=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Jce]],jx=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Zce(e){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Yce:typeof navigator<"u"?tde(navigator.userAgent):nde()}function ede(e){return e!==""&&Qce.reduce(function(t,r){var n=r[0],i=r[1];if(t)return t;var s=i.exec(e);return!!s&&[n,s]},!1)}function tde(e){var t=ede(e);if(!t)return null;var r=t[0],n=t[1];if(r==="searchbot")return new Kce;var i=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);i?i.length<Ux&&(i=Mx(Mx([],i,!0),ide(Ux-i.length),!0)):i=[];var s=i.join("."),o=rde(e),a=Xce.exec(e);return a&&a[1]?new qce(r,s,o,a[1]):new Wce(r,s,o)}function rde(e){for(var t=0,r=jx.length;t<r;t++){var n=jx[t],i=n[0],s=n[1],o=s.exec(e);if(o)return i}return null}function nde(){var e=typeof process<"u"&&process.version;return e?new Gce(process.version.slice(1)):null}function ide(e){for(var t=[],r=0;r<e;r++)t.push("0");return t}var nn={};Object.defineProperty(nn,"__esModule",{value:!0});nn.getLocalStorage=nn.getLocalStorageOrThrow=nn.getCrypto=nn.getCryptoOrThrow=vz=nn.getLocation=nn.getLocationOrThrow=QD=nn.getNavigator=nn.getNavigatorOrThrow=XD=nn.getDocument=nn.getDocumentOrThrow=nn.getFromWindowOrThrow=nn.getFromWindow=void 0;function Pf(e){let t;return typeof window<"u"&&typeof window[e]<"u"&&(t=window[e]),t}nn.getFromWindow=Pf;function i0(e){const t=Pf(e);if(!t)throw new Error(`${e} is not defined in Window`);return t}nn.getFromWindowOrThrow=i0;function sde(){return i0("document")}nn.getDocumentOrThrow=sde;function ode(){return Pf("document")}var XD=nn.getDocument=ode;function ade(){return i0("navigator")}nn.getNavigatorOrThrow=ade;function cde(){return Pf("navigator")}var QD=nn.getNavigator=cde;function dde(){return i0("location")}nn.getLocationOrThrow=dde;function lde(){return Pf("location")}var vz=nn.getLocation=lde;function ude(){return i0("crypto")}nn.getCryptoOrThrow=ude;function hde(){return Pf("crypto")}nn.getCrypto=hde;function fde(){return i0("localStorage")}nn.getLocalStorageOrThrow=fde;function pde(){return Pf("localStorage")}nn.getLocalStorage=pde;var ZD={};Object.defineProperty(ZD,"__esModule",{value:!0});var yz=ZD.getWindowMetadata=void 0;const Fx=nn;function mde(){let e,t;try{e=Fx.getDocumentOrThrow(),t=Fx.getLocationOrThrow()}catch{return null}function r(){const u=e.getElementsByTagName("link"),h=[];for(let p=0;p<u.length;p++){const _=u[p],g=_.getAttribute("rel");if(g&&g.toLowerCase().indexOf("icon")>-1){const E=_.getAttribute("href");if(E)if(E.toLowerCase().indexOf("https:")===-1&&E.toLowerCase().indexOf("http:")===-1&&E.indexOf("//")!==0){let b=t.protocol+"//"+t.host;if(E.indexOf("/")===0)b+=E;else{const v=t.pathname.split("/");v.pop();const I=v.join("/");b+=I+"/"+E}h.push(b)}else if(E.indexOf("//")===0){const b=t.protocol+E;h.push(b)}else h.push(E)}}return h}function n(...u){const h=e.getElementsByTagName("meta");for(let p=0;p<h.length;p++){const _=h[p],g=["itemprop","property","name"].map(E=>_.getAttribute(E)).filter(E=>E?u.includes(E):!1);if(g.length&&g){const E=_.getAttribute("content");if(E)return E}}return""}function i(){let u=n("name","og:site_name","og:title","twitter:title");return u||(u=e.title),u}function s(){return n("description","og:description","twitter:description","keywords")}const o=i(),a=s(),c=t.origin,d=r();return{description:a,url:c,icons:d,name:o}}yz=ZD.getWindowMetadata=mde;var V_={},gde=e=>encodeURIComponent(e).replace(/[!'()*]/g,t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`),bz="%[a-f0-9]{2}",Bx=new RegExp("("+bz+")|([^%]+?)","gi"),Vx=new RegExp("("+bz+")+","gi");function FO(e,t){try{return[decodeURIComponent(e.join(""))]}catch{}if(e.length===1)return e;t=t||1;var r=e.slice(0,t),n=e.slice(t);return Array.prototype.concat.call([],FO(r),FO(n))}function _de(e){try{return decodeURIComponent(e)}catch{for(var t=e.match(Bx)||[],r=1;r<t.length;r++)e=FO(t,r).join(""),t=e.match(Bx)||[];return e}}function Ede(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},r=Vx.exec(e);r;){try{t[r[0]]=decodeURIComponent(r[0])}catch{var n=_de(r[0]);n!==r[0]&&(t[r[0]]=n)}r=Vx.exec(e)}t["%C2"]="�";for(var i=Object.keys(t),s=0;s<i.length;s++){var o=i[s];e=e.replace(new RegExp(o,"g"),t[o])}return e}var vde=function(e){if(typeof e!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch{return Ede(e)}},yde=(e,t)=>{if(!(typeof e=="string"&&typeof t=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(t==="")return[e];const r=e.indexOf(t);return r===-1?[e]:[e.slice(0,r),e.slice(r+t.length)]},bde=function(e,t){for(var r={},n=Object.keys(e),i=Array.isArray(t),s=0;s<n.length;s++){var o=n[s],a=e[o];(i?t.indexOf(o)!==-1:t(o,a,e))&&(r[o]=a)}return r};(function(e){const t=gde,r=vde,n=yde,i=bde,s=v=>v==null,o=Symbol("encodeFragmentIdentifier");function a(v){switch(v.arrayFormat){case"index":return I=>(N,L)=>{const U=N.length;return L===void 0||v.skipNull&&L===null||v.skipEmptyString&&L===""?N:L===null?[...N,[l(I,v),"[",U,"]"].join("")]:[...N,[l(I,v),"[",l(U,v),"]=",l(L,v)].join("")]};case"bracket":return I=>(N,L)=>L===void 0||v.skipNull&&L===null||v.skipEmptyString&&L===""?N:L===null?[...N,[l(I,v),"[]"].join("")]:[...N,[l(I,v),"[]=",l(L,v)].join("")];case"colon-list-separator":return I=>(N,L)=>L===void 0||v.skipNull&&L===null||v.skipEmptyString&&L===""?N:L===null?[...N,[l(I,v),":list="].join("")]:[...N,[l(I,v),":list=",l(L,v)].join("")];case"comma":case"separator":case"bracket-separator":{const I=v.arrayFormat==="bracket-separator"?"[]=":"=";return N=>(L,U)=>U===void 0||v.skipNull&&U===null||v.skipEmptyString&&U===""?L:(U=U===null?"":U,L.length===0?[[l(N,v),I,l(U,v)].join("")]:[[L,l(U,v)].join(v.arrayFormatSeparator)])}default:return I=>(N,L)=>L===void 0||v.skipNull&&L===null||v.skipEmptyString&&L===""?N:L===null?[...N,l(I,v)]:[...N,[l(I,v),"=",l(L,v)].join("")]}}function c(v){let I;switch(v.arrayFormat){case"index":return(N,L,U)=>{if(I=/\[(\d*)\]$/.exec(N),N=N.replace(/\[\d*\]$/,""),!I){U[N]=L;return}U[N]===void 0&&(U[N]={}),U[N][I[1]]=L};case"bracket":return(N,L,U)=>{if(I=/(\[\])$/.exec(N),N=N.replace(/\[\]$/,""),!I){U[N]=L;return}if(U[N]===void 0){U[N]=[L];return}U[N]=[].concat(U[N],L)};case"colon-list-separator":return(N,L,U)=>{if(I=/(:list)$/.exec(N),N=N.replace(/:list$/,""),!I){U[N]=L;return}if(U[N]===void 0){U[N]=[L];return}U[N]=[].concat(U[N],L)};case"comma":case"separator":return(N,L,U)=>{const w=typeof L=="string"&&L.includes(v.arrayFormatSeparator),V=typeof L=="string"&&!w&&u(L,v).includes(v.arrayFormatSeparator);L=V?u(L,v):L;const z=w||V?L.split(v.arrayFormatSeparator).map(K=>u(K,v)):L===null?L:u(L,v);U[N]=z};case"bracket-separator":return(N,L,U)=>{const w=/(\[\])$/.test(N);if(N=N.replace(/\[\]$/,""),!w){U[N]=L&&u(L,v);return}const V=L===null?[]:L.split(v.arrayFormatSeparator).map(z=>u(z,v));if(U[N]===void 0){U[N]=V;return}U[N]=[].concat(U[N],V)};default:return(N,L,U)=>{if(U[N]===void 0){U[N]=L;return}U[N]=[].concat(U[N],L)}}}function d(v){if(typeof v!="string"||v.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function l(v,I){return I.encode?I.strict?t(v):encodeURIComponent(v):v}function u(v,I){return I.decode?r(v):v}function h(v){return Array.isArray(v)?v.sort():typeof v=="object"?h(Object.keys(v)).sort((I,N)=>Number(I)-Number(N)).map(I=>v[I]):v}function p(v){const I=v.indexOf("#");return I!==-1&&(v=v.slice(0,I)),v}function _(v){let I="";const N=v.indexOf("#");return N!==-1&&(I=v.slice(N)),I}function g(v){v=p(v);const I=v.indexOf("?");return I===-1?"":v.slice(I+1)}function E(v,I){return I.parseNumbers&&!Number.isNaN(Number(v))&&typeof v=="string"&&v.trim()!==""?v=Number(v):I.parseBooleans&&v!==null&&(v.toLowerCase()==="true"||v.toLowerCase()==="false")&&(v=v.toLowerCase()==="true"),v}function b(v,I){I=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},I),d(I.arrayFormatSeparator);const N=c(I),L=Object.create(null);if(typeof v!="string"||(v=v.trim().replace(/^[?#&]/,""),!v))return L;for(const U of v.split("&")){if(U==="")continue;let[w,V]=n(I.decode?U.replace(/\+/g," "):U,"=");V=V===void 0?null:["comma","separator","bracket-separator"].includes(I.arrayFormat)?V:u(V,I),N(u(w,I),V,L)}for(const U of Object.keys(L)){const w=L[U];if(typeof w=="object"&&w!==null)for(const V of Object.keys(w))w[V]=E(w[V],I);else L[U]=E(w,I)}return I.sort===!1?L:(I.sort===!0?Object.keys(L).sort():Object.keys(L).sort(I.sort)).reduce((U,w)=>{const V=L[w];return V&&typeof V=="object"&&!Array.isArray(V)?U[w]=h(V):U[w]=V,U},Object.create(null))}e.extract=g,e.parse=b,e.stringify=(v,I)=>{if(!v)return"";I=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},I),d(I.arrayFormatSeparator);const N=V=>I.skipNull&&s(v[V])||I.skipEmptyString&&v[V]==="",L=a(I),U={};for(const V of Object.keys(v))N(V)||(U[V]=v[V]);const w=Object.keys(U);return I.sort!==!1&&w.sort(I.sort),w.map(V=>{const z=v[V];return z===void 0?"":z===null?l(V,I):Array.isArray(z)?z.length===0&&I.arrayFormat==="bracket-separator"?l(V,I)+"[]":z.reduce(L(V),[]).join("&"):l(V,I)+"="+l(z,I)}).filter(V=>V.length>0).join("&")},e.parseUrl=(v,I)=>{I=Object.assign({decode:!0},I);const[N,L]=n(v,"#");return Object.assign({url:N.split("?")[0]||"",query:b(g(v),I)},I&&I.parseFragmentIdentifier&&L?{fragmentIdentifier:u(L,I)}:{})},e.stringifyUrl=(v,I)=>{I=Object.assign({encode:!0,strict:!0,[o]:!0},I);const N=p(v.url).split("?")[0]||"",L=e.extract(v.url),U=e.parse(L,{sort:!1}),w=Object.assign(U,v.query);let V=e.stringify(w,I);V&&(V=`?${V}`);let z=_(v.url);return v.fragmentIdentifier&&(z=`#${I[o]?l(v.fragmentIdentifier,I):v.fragmentIdentifier}`),`${N}${V}${z}`},e.pick=(v,I,N)=>{N=Object.assign({parseFragmentIdentifier:!0,[o]:!1},N);const{url:L,query:U,fragmentIdentifier:w}=e.parseUrl(v,N);return e.stringifyUrl({url:L,query:i(U,I),fragmentIdentifier:w},N)},e.exclude=(v,I,N)=>{const L=Array.isArray(I)?U=>!I.includes(U):(U,w)=>!I(U,w);return e.pick(v,L,N)}})(V_);var eP={},mw={};Object.defineProperty(mw,"__esModule",{value:!0});var Zi=Xt,BO=zo,Sde=20;function wde(e,t,r){for(var n=1634760805,i=857760878,s=2036477234,o=1797285236,a=r[3]<<24|r[2]<<16|r[1]<<8|r[0],c=r[7]<<24|r[6]<<16|r[5]<<8|r[4],d=r[11]<<24|r[10]<<16|r[9]<<8|r[8],l=r[15]<<24|r[14]<<16|r[13]<<8|r[12],u=r[19]<<24|r[18]<<16|r[17]<<8|r[16],h=r[23]<<24|r[22]<<16|r[21]<<8|r[20],p=r[27]<<24|r[26]<<16|r[25]<<8|r[24],_=r[31]<<24|r[30]<<16|r[29]<<8|r[28],g=t[3]<<24|t[2]<<16|t[1]<<8|t[0],E=t[7]<<24|t[6]<<16|t[5]<<8|t[4],b=t[11]<<24|t[10]<<16|t[9]<<8|t[8],v=t[15]<<24|t[14]<<16|t[13]<<8|t[12],I=n,N=i,L=s,U=o,w=a,V=c,z=d,K=l,H=u,A=h,m=p,S=_,T=g,x=E,D=b,k=v,P=0;P<Sde;P+=2)I=I+w|0,T^=I,T=T>>>16|T<<16,H=H+T|0,w^=H,w=w>>>20|w<<12,N=N+V|0,x^=N,x=x>>>16|x<<16,A=A+x|0,V^=A,V=V>>>20|V<<12,L=L+z|0,D^=L,D=D>>>16|D<<16,m=m+D|0,z^=m,z=z>>>20|z<<12,U=U+K|0,k^=U,k=k>>>16|k<<16,S=S+k|0,K^=S,K=K>>>20|K<<12,L=L+z|0,D^=L,D=D>>>24|D<<8,m=m+D|0,z^=m,z=z>>>25|z<<7,U=U+K|0,k^=U,k=k>>>24|k<<8,S=S+k|0,K^=S,K=K>>>25|K<<7,N=N+V|0,x^=N,x=x>>>24|x<<8,A=A+x|0,V^=A,V=V>>>25|V<<7,I=I+w|0,T^=I,T=T>>>24|T<<8,H=H+T|0,w^=H,w=w>>>25|w<<7,I=I+V|0,k^=I,k=k>>>16|k<<16,m=m+k|0,V^=m,V=V>>>20|V<<12,N=N+z|0,T^=N,T=T>>>16|T<<16,S=S+T|0,z^=S,z=z>>>20|z<<12,L=L+K|0,x^=L,x=x>>>16|x<<16,H=H+x|0,K^=H,K=K>>>20|K<<12,U=U+w|0,D^=U,D=D>>>16|D<<16,A=A+D|0,w^=A,w=w>>>20|w<<12,L=L+K|0,x^=L,x=x>>>24|x<<8,H=H+x|0,K^=H,K=K>>>25|K<<7,U=U+w|0,D^=U,D=D>>>24|D<<8,A=A+D|0,w^=A,w=w>>>25|w<<7,N=N+z|0,T^=N,T=T>>>24|T<<8,S=S+T|0,z^=S,z=z>>>25|z<<7,I=I+V|0,k^=I,k=k>>>24|k<<8,m=m+k|0,V^=m,V=V>>>25|V<<7;Zi.writeUint32LE(I+n|0,e,0),Zi.writeUint32LE(N+i|0,e,4),Zi.writeUint32LE(L+s|0,e,8),Zi.writeUint32LE(U+o|0,e,12),Zi.writeUint32LE(w+a|0,e,16),Zi.writeUint32LE(V+c|0,e,20),Zi.writeUint32LE(z+d|0,e,24),Zi.writeUint32LE(K+l|0,e,28),Zi.writeUint32LE(H+u|0,e,32),Zi.writeUint32LE(A+h|0,e,36),Zi.writeUint32LE(m+p|0,e,40),Zi.writeUint32LE(S+_|0,e,44),Zi.writeUint32LE(T+g|0,e,48),Zi.writeUint32LE(x+E|0,e,52),Zi.writeUint32LE(D+b|0,e,56),Zi.writeUint32LE(k+v|0,e,60)}function Sz(e,t,r,n,i){if(i===void 0&&(i=0),e.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(n.length<r.length)throw new Error("ChaCha: destination is shorter than source");var s,o;if(i===0){if(t.length!==8&&t.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");s=new Uint8Array(16),o=s.length-t.length,s.set(t,o)}else{if(t.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");s=t,o=i}for(var a=new Uint8Array(64),c=0;c<r.length;c+=64){wde(a,s,e);for(var d=c;d<c+64&&d<r.length;d++)n[d]=r[d]^a[d-c];Rde(s,0,o)}return BO.wipe(a),i===0&&BO.wipe(s),n}mw.streamXOR=Sz;function Tde(e,t,r,n){return n===void 0&&(n=0),BO.wipe(r),Sz(e,t,r,r,n)}mw.stream=Tde;function Rde(e,t,r){for(var n=1;r--;)n=n+(e[t]&255)|0,e[t]=n&255,n>>>=8,t++;if(n>0)throw new Error("ChaCha: counter overflow")}var wz={},Ju={};Object.defineProperty(Ju,"__esModule",{value:!0});function Ade(e,t,r){return~(e-1)&t|e-1&r}Ju.select=Ade;function Cde(e,t){return(e|0)-(t|0)-1>>>31&1}Ju.lessOrEqual=Cde;function Tz(e,t){if(e.length!==t.length)return 0;for(var r=0,n=0;n<e.length;n++)r|=e[n]^t[n];return 1&r-1>>>8}Ju.compare=Tz;function Ide(e,t){return e.length===0||t.length===0?!1:Tz(e,t)!==0}Ju.equal=Ide;(function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Ju,r=zo;e.DIGEST_LENGTH=16;var n=function(){function o(a){this.digestLength=e.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var c=a[0]|a[1]<<8;this._r[0]=c&8191;var d=a[2]|a[3]<<8;this._r[1]=(c>>>13|d<<3)&8191;var l=a[4]|a[5]<<8;this._r[2]=(d>>>10|l<<6)&7939;var u=a[6]|a[7]<<8;this._r[3]=(l>>>7|u<<9)&8191;var h=a[8]|a[9]<<8;this._r[4]=(u>>>4|h<<12)&255,this._r[5]=h>>>1&8190;var p=a[10]|a[11]<<8;this._r[6]=(h>>>14|p<<2)&8191;var _=a[12]|a[13]<<8;this._r[7]=(p>>>11|_<<5)&8065;var g=a[14]|a[15]<<8;this._r[8]=(_>>>8|g<<8)&8191,this._r[9]=g>>>5&127,this._pad[0]=a[16]|a[17]<<8,this._pad[1]=a[18]|a[19]<<8,this._pad[2]=a[20]|a[21]<<8,this._pad[3]=a[22]|a[23]<<8,this._pad[4]=a[24]|a[25]<<8,this._pad[5]=a[26]|a[27]<<8,this._pad[6]=a[28]|a[29]<<8,this._pad[7]=a[30]|a[31]<<8}return o.prototype._blocks=function(a,c,d){for(var l=this._fin?0:2048,u=this._h[0],h=this._h[1],p=this._h[2],_=this._h[3],g=this._h[4],E=this._h[5],b=this._h[6],v=this._h[7],I=this._h[8],N=this._h[9],L=this._r[0],U=this._r[1],w=this._r[2],V=this._r[3],z=this._r[4],K=this._r[5],H=this._r[6],A=this._r[7],m=this._r[8],S=this._r[9];d>=16;){var T=a[c+0]|a[c+1]<<8;u+=T&8191;var x=a[c+2]|a[c+3]<<8;h+=(T>>>13|x<<3)&8191;var D=a[c+4]|a[c+5]<<8;p+=(x>>>10|D<<6)&8191;var k=a[c+6]|a[c+7]<<8;_+=(D>>>7|k<<9)&8191;var P=a[c+8]|a[c+9]<<8;g+=(k>>>4|P<<12)&8191,E+=P>>>1&8191;var y=a[c+10]|a[c+11]<<8;b+=(P>>>14|y<<2)&8191;var f=a[c+12]|a[c+13]<<8;v+=(y>>>11|f<<5)&8191;var R=a[c+14]|a[c+15]<<8;I+=(f>>>8|R<<8)&8191,N+=R>>>5|l;var B=0,q=B;q+=u*L,q+=h*(5*S),q+=p*(5*m),q+=_*(5*A),q+=g*(5*H),B=q>>>13,q&=8191,q+=E*(5*K),q+=b*(5*z),q+=v*(5*V),q+=I*(5*w),q+=N*(5*U),B+=q>>>13,q&=8191;var F=B;F+=u*U,F+=h*L,F+=p*(5*S),F+=_*(5*m),F+=g*(5*A),B=F>>>13,F&=8191,F+=E*(5*H),F+=b*(5*K),F+=v*(5*z),F+=I*(5*V),F+=N*(5*w),B+=F>>>13,F&=8191;var te=B;te+=u*w,te+=h*U,te+=p*L,te+=_*(5*S),te+=g*(5*m),B=te>>>13,te&=8191,te+=E*(5*A),te+=b*(5*H),te+=v*(5*K),te+=I*(5*z),te+=N*(5*V),B+=te>>>13,te&=8191;var G=B;G+=u*V,G+=h*w,G+=p*U,G+=_*L,G+=g*(5*S),B=G>>>13,G&=8191,G+=E*(5*m),G+=b*(5*A),G+=v*(5*H),G+=I*(5*K),G+=N*(5*z),B+=G>>>13,G&=8191;var Y=B;Y+=u*z,Y+=h*V,Y+=p*w,Y+=_*U,Y+=g*L,B=Y>>>13,Y&=8191,Y+=E*(5*S),Y+=b*(5*m),Y+=v*(5*A),Y+=I*(5*H),Y+=N*(5*K),B+=Y>>>13,Y&=8191;var X=B;X+=u*K,X+=h*z,X+=p*V,X+=_*w,X+=g*U,B=X>>>13,X&=8191,X+=E*L,X+=b*(5*S),X+=v*(5*m),X+=I*(5*A),X+=N*(5*H),B+=X>>>13,X&=8191;var M=B;M+=u*H,M+=h*K,M+=p*z,M+=_*V,M+=g*w,B=M>>>13,M&=8191,M+=E*U,M+=b*L,M+=v*(5*S),M+=I*(5*m),M+=N*(5*A),B+=M>>>13,M&=8191;var J=B;J+=u*A,J+=h*H,J+=p*K,J+=_*z,J+=g*V,B=J>>>13,J&=8191,J+=E*w,J+=b*U,J+=v*L,J+=I*(5*S),J+=N*(5*m),B+=J>>>13,J&=8191;var de=B;de+=u*m,de+=h*A,de+=p*H,de+=_*K,de+=g*z,B=de>>>13,de&=8191,de+=E*V,de+=b*w,de+=v*U,de+=I*L,de+=N*(5*S),B+=de>>>13,de&=8191;var he=B;he+=u*S,he+=h*m,he+=p*A,he+=_*H,he+=g*K,B=he>>>13,he&=8191,he+=E*z,he+=b*V,he+=v*w,he+=I*U,he+=N*L,B+=he>>>13,he&=8191,B=(B<<2)+B|0,B=B+q|0,q=B&8191,B=B>>>13,F+=B,u=q,h=F,p=te,_=G,g=Y,E=X,b=M,v=J,I=de,N=he,c+=16,d-=16}this._h[0]=u,this._h[1]=h,this._h[2]=p,this._h[3]=_,this._h[4]=g,this._h[5]=E,this._h[6]=b,this._h[7]=v,this._h[8]=I,this._h[9]=N},o.prototype.finish=function(a,c){c===void 0&&(c=0);var d=new Uint16Array(10),l,u,h,p;if(this._leftover){for(p=this._leftover,this._buffer[p++]=1;p<16;p++)this._buffer[p]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(l=this._h[1]>>>13,this._h[1]&=8191,p=2;p<10;p++)this._h[p]+=l,l=this._h[p]>>>13,this._h[p]&=8191;for(this._h[0]+=l*5,l=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=l,l=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=l,d[0]=this._h[0]+5,l=d[0]>>>13,d[0]&=8191,p=1;p<10;p++)d[p]=this._h[p]+l,l=d[p]>>>13,d[p]&=8191;for(d[9]-=8192,u=(l^1)-1,p=0;p<10;p++)d[p]&=u;for(u=~u,p=0;p<10;p++)this._h[p]=this._h[p]&u|d[p];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,h=this._h[0]+this._pad[0],this._h[0]=h&65535,p=1;p<8;p++)h=(this._h[p]+this._pad[p]|0)+(h>>>16)|0,this._h[p]=h&65535;return a[c+0]=this._h[0]>>>0,a[c+1]=this._h[0]>>>8,a[c+2]=this._h[1]>>>0,a[c+3]=this._h[1]>>>8,a[c+4]=this._h[2]>>>0,a[c+5]=this._h[2]>>>8,a[c+6]=this._h[3]>>>0,a[c+7]=this._h[3]>>>8,a[c+8]=this._h[4]>>>0,a[c+9]=this._h[4]>>>8,a[c+10]=this._h[5]>>>0,a[c+11]=this._h[5]>>>8,a[c+12]=this._h[6]>>>0,a[c+13]=this._h[6]>>>8,a[c+14]=this._h[7]>>>0,a[c+15]=this._h[7]>>>8,this._finished=!0,this},o.prototype.update=function(a){var c=0,d=a.length,l;if(this._leftover){l=16-this._leftover,l>d&&(l=d);for(var u=0;u<l;u++)this._buffer[this._leftover+u]=a[c+u];if(d-=l,c+=l,this._leftover+=l,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(d>=16&&(l=d-d%16,this._blocks(a,c,l),c+=l,d-=l),d){for(var u=0;u<d;u++)this._buffer[this._leftover+u]=a[c+u];this._leftover+=d}return this},o.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var a=new Uint8Array(16);return this.finish(a),a},o.prototype.clean=function(){return r.wipe(this._buffer),r.wipe(this._r),r.wipe(this._h),r.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},o}();e.Poly1305=n;function i(o,a){var c=new n(o);c.update(a);var d=c.digest();return c.clean(),d}e.oneTimeAuth=i;function s(o,a){return o.length!==e.DIGEST_LENGTH||a.length!==e.DIGEST_LENGTH?!1:t.equal(o,a)}e.equal=s})(wz);(function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=mw,r=wz,n=zo,i=Xt,s=Ju;e.KEY_LENGTH=32,e.NONCE_LENGTH=12,e.TAG_LENGTH=16;var o=new Uint8Array(16),a=function(){function c(d){if(this.nonceLength=e.NONCE_LENGTH,this.tagLength=e.TAG_LENGTH,d.length!==e.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(d)}return c.prototype.seal=function(d,l,u,h){if(d.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var p=new Uint8Array(16);p.set(d,p.length-d.length);var _=new Uint8Array(32);t.stream(this._key,p,_,4);var g=l.length+this.tagLength,E;if(h){if(h.length!==g)throw new Error("ChaCha20Poly1305: incorrect destination length");E=h}else E=new Uint8Array(g);return t.streamXOR(this._key,p,l,E,4),this._authenticate(E.subarray(E.length-this.tagLength,E.length),_,E.subarray(0,E.length-this.tagLength),u),n.wipe(p),E},c.prototype.open=function(d,l,u,h){if(d.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(l.length<this.tagLength)return null;var p=new Uint8Array(16);p.set(d,p.length-d.length);var _=new Uint8Array(32);t.stream(this._key,p,_,4);var g=new Uint8Array(this.tagLength);if(this._authenticate(g,_,l.subarray(0,l.length-this.tagLength),u),!s.equal(g,l.subarray(l.length-this.tagLength,l.length)))return null;var E=l.length-this.tagLength,b;if(h){if(h.length!==E)throw new Error("ChaCha20Poly1305: incorrect destination length");b=h}else b=new Uint8Array(E);return t.streamXOR(this._key,p,l.subarray(0,l.length-this.tagLength),b,4),n.wipe(p),b},c.prototype.clean=function(){return n.wipe(this._key),this},c.prototype._authenticate=function(d,l,u,h){var p=new r.Poly1305(l);h&&(p.update(h),h.length%16>0&&p.update(o.subarray(h.length%16))),p.update(u),u.length%16>0&&p.update(o.subarray(u.length%16));var _=new Uint8Array(8);h&&i.writeUint64LE(h.length,_),p.update(_),i.writeUint64LE(u.length,_),p.update(_);for(var g=p.digest(),E=0;E<g.length;E++)d[E]=g[E];p.clean(),n.wipe(g),n.wipe(_)},c}();e.ChaCha20Poly1305=a})(eP);var Rz={},$E={},tP={};Object.defineProperty(tP,"__esModule",{value:!0});function Ode(e){return typeof e.saveState<"u"&&typeof e.restoreState<"u"&&typeof e.cleanSavedState<"u"}tP.isSerializableHash=Ode;Object.defineProperty($E,"__esModule",{value:!0});var Oc=tP,Nde=Ju,Dde=zo,Az=function(){function e(t,r){this._finished=!1,this._inner=new t,this._outer=new t,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var n=new Uint8Array(this.blockSize);r.length>this.blockSize?this._inner.update(r).finish(n).clean():n.set(r);for(var i=0;i<n.length;i++)n[i]^=54;this._inner.update(n);for(var i=0;i<n.length;i++)n[i]^=106;this._outer.update(n),Oc.isSerializableHash(this._inner)&&Oc.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),Dde.wipe(n)}return e.prototype.reset=function(){if(!Oc.isSerializableHash(this._inner)||!Oc.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},e.prototype.clean=function(){Oc.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),Oc.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},e.prototype.update=function(t){return this._inner.update(t),this},e.prototype.finish=function(t){return this._finished?(this._outer.finish(t),this):(this._inner.finish(t),this._outer.update(t.subarray(0,this.digestLength)).finish(t),this._finished=!0,this)},e.prototype.digest=function(){var t=new Uint8Array(this.digestLength);return this.finish(t),t},e.prototype.saveState=function(){if(!Oc.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},e.prototype.restoreState=function(t){if(!Oc.isSerializableHash(this._inner)||!Oc.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(t),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},e.prototype.cleanSavedState=function(t){if(!Oc.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(t)},e}();$E.HMAC=Az;function Pde(e,t,r){var n=new Az(e,t);n.update(r);var i=n.digest();return n.clean(),i}$E.hmac=Pde;$E.equal=Nde.equal;Object.defineProperty(Rz,"__esModule",{value:!0});var $x=$E,Hx=zo,kde=function(){function e(t,r,n,i){n===void 0&&(n=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=t,this._info=i;var s=$x.hmac(this._hash,n,r);this._hmac=new $x.HMAC(t,s),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return e.prototype._fillBuffer=function(){this._counter[0]++;var t=this._counter[0];if(t===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),t>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},e.prototype.expand=function(t){for(var r=new Uint8Array(t),n=0;n<r.length;n++)this._bufpos===this._buffer.length&&this._fillBuffer(),r[n]=this._buffer[this._bufpos++];return r},e.prototype.clean=function(){this._hmac.clean(),Hx.wipe(this._buffer),Hx.wipe(this._counter),this._bufpos=0},e}(),Lde=Rz.HKDF=kde,gw={};(function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Xt,r=zo;e.DIGEST_LENGTH=32,e.BLOCK_SIZE=64;var n=function(){function a(){this.digestLength=e.DIGEST_LENGTH,this.blockSize=e.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return a.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},a.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},a.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._temp),this.reset()},a.prototype.update=function(c,d){if(d===void 0&&(d=c.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var l=0;if(this._bytesHashed+=d,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&d>0;)this._buffer[this._bufferLength++]=c[l++],d--;this._bufferLength===this.blockSize&&(s(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(d>=this.blockSize&&(l=s(this._temp,this._state,c,l,d),d%=this.blockSize);d>0;)this._buffer[this._bufferLength++]=c[l++],d--;return this},a.prototype.finish=function(c){if(!this._finished){var d=this._bytesHashed,l=this._bufferLength,u=d/536870912|0,h=d<<3,p=d%64<56?64:128;this._buffer[l]=128;for(var _=l+1;_<p-8;_++)this._buffer[_]=0;t.writeUint32BE(u,this._buffer,p-8),t.writeUint32BE(h,this._buffer,p-4),s(this._temp,this._state,this._buffer,0,p),this._finished=!0}for(var _=0;_<this.digestLength/4;_++)t.writeUint32BE(this._state[_],c,_*4);return this},a.prototype.digest=function(){var c=new Uint8Array(this.digestLength);return this.finish(c),c},a.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},a.prototype.restoreState=function(c){return this._state.set(c.state),this._bufferLength=c.bufferLength,c.buffer&&this._buffer.set(c.buffer),this._bytesHashed=c.bytesHashed,this._finished=!1,this},a.prototype.cleanSavedState=function(c){r.wipe(c.state),c.buffer&&r.wipe(c.buffer),c.bufferLength=0,c.bytesHashed=0},a}();e.SHA256=n;var i=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function s(a,c,d,l,u){for(;u>=64;){for(var h=c[0],p=c[1],_=c[2],g=c[3],E=c[4],b=c[5],v=c[6],I=c[7],N=0;N<16;N++){var L=l+N*4;a[N]=t.readUint32BE(d,L)}for(var N=16;N<64;N++){var U=a[N-2],w=(U>>>17|U<<15)^(U>>>19|U<<13)^U>>>10;U=a[N-15];var V=(U>>>7|U<<25)^(U>>>18|U<<14)^U>>>3;a[N]=(w+a[N-7]|0)+(V+a[N-16]|0)}for(var N=0;N<64;N++){var w=(((E>>>6|E<<26)^(E>>>11|E<<21)^(E>>>25|E<<7))+(E&b^~E&v)|0)+(I+(i[N]+a[N]|0)|0)|0,V=((h>>>2|h<<30)^(h>>>13|h<<19)^(h>>>22|h<<10))+(h&p^h&_^p&_)|0;I=v,v=b,b=E,E=g+w|0,g=_,_=p,p=h,h=w+V|0}c[0]+=h,c[1]+=p,c[2]+=_,c[3]+=g,c[4]+=E,c[5]+=b,c[6]+=v,c[7]+=I,l+=64,u-=64}return l}function o(a){var c=new n;c.update(a);var d=c.digest();return c.clean(),d}e.hash=o})(gw);var rP={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.sharedKey=e.generateKeyPair=e.generateKeyPairFromSeed=e.scalarMultBase=e.scalarMult=e.SHARED_KEY_LENGTH=e.SECRET_KEY_LENGTH=e.PUBLIC_KEY_LENGTH=void 0;const t=n0,r=zo;e.PUBLIC_KEY_LENGTH=32,e.SECRET_KEY_LENGTH=32,e.SHARED_KEY_LENGTH=32;function n(N){const L=new Float64Array(16);if(N)for(let U=0;U<N.length;U++)L[U]=N[U];return L}const i=new Uint8Array(32);i[0]=9;const s=n([56129,1]);function o(N){let L=1;for(let U=0;U<16;U++){let w=N[U]+L+65535;L=Math.floor(w/65536),N[U]=w-L*65536}N[0]+=L-1+37*(L-1)}function a(N,L,U){const w=~(U-1);for(let V=0;V<16;V++){const z=w&(N[V]^L[V]);N[V]^=z,L[V]^=z}}function c(N,L){const U=n(),w=n();for(let V=0;V<16;V++)w[V]=L[V];o(w),o(w),o(w);for(let V=0;V<2;V++){U[0]=w[0]-65517;for(let K=1;K<15;K++)U[K]=w[K]-65535-(U[K-1]>>16&1),U[K-1]&=65535;U[15]=w[15]-32767-(U[14]>>16&1);const z=U[15]>>16&1;U[14]&=65535,a(w,U,1-z)}for(let V=0;V<16;V++)N[2*V]=w[V]&255,N[2*V+1]=w[V]>>8}function d(N,L){for(let U=0;U<16;U++)N[U]=L[2*U]+(L[2*U+1]<<8);N[15]&=32767}function l(N,L,U){for(let w=0;w<16;w++)N[w]=L[w]+U[w]}function u(N,L,U){for(let w=0;w<16;w++)N[w]=L[w]-U[w]}function h(N,L,U){let w,V,z=0,K=0,H=0,A=0,m=0,S=0,T=0,x=0,D=0,k=0,P=0,y=0,f=0,R=0,B=0,q=0,F=0,te=0,G=0,Y=0,X=0,M=0,J=0,de=0,he=0,Se=0,Te=0,Re=0,Ne=0,Q=0,re=0,ne=U[0],oe=U[1],ce=U[2],ue=U[3],fe=U[4],ye=U[5],Le=U[6],ke=U[7],Pe=U[8],Qe=U[9],ze=U[10],Ue=U[11],st=U[12],ct=U[13],Ve=U[14],ot=U[15];w=L[0],z+=w*ne,K+=w*oe,H+=w*ce,A+=w*ue,m+=w*fe,S+=w*ye,T+=w*Le,x+=w*ke,D+=w*Pe,k+=w*Qe,P+=w*ze,y+=w*Ue,f+=w*st,R+=w*ct,B+=w*Ve,q+=w*ot,w=L[1],K+=w*ne,H+=w*oe,A+=w*ce,m+=w*ue,S+=w*fe,T+=w*ye,x+=w*Le,D+=w*ke,k+=w*Pe,P+=w*Qe,y+=w*ze,f+=w*Ue,R+=w*st,B+=w*ct,q+=w*Ve,F+=w*ot,w=L[2],H+=w*ne,A+=w*oe,m+=w*ce,S+=w*ue,T+=w*fe,x+=w*ye,D+=w*Le,k+=w*ke,P+=w*Pe,y+=w*Qe,f+=w*ze,R+=w*Ue,B+=w*st,q+=w*ct,F+=w*Ve,te+=w*ot,w=L[3],A+=w*ne,m+=w*oe,S+=w*ce,T+=w*ue,x+=w*fe,D+=w*ye,k+=w*Le,P+=w*ke,y+=w*Pe,f+=w*Qe,R+=w*ze,B+=w*Ue,q+=w*st,F+=w*ct,te+=w*Ve,G+=w*ot,w=L[4],m+=w*ne,S+=w*oe,T+=w*ce,x+=w*ue,D+=w*fe,k+=w*ye,P+=w*Le,y+=w*ke,f+=w*Pe,R+=w*Qe,B+=w*ze,q+=w*Ue,F+=w*st,te+=w*ct,G+=w*Ve,Y+=w*ot,w=L[5],S+=w*ne,T+=w*oe,x+=w*ce,D+=w*ue,k+=w*fe,P+=w*ye,y+=w*Le,f+=w*ke,R+=w*Pe,B+=w*Qe,q+=w*ze,F+=w*Ue,te+=w*st,G+=w*ct,Y+=w*Ve,X+=w*ot,w=L[6],T+=w*ne,x+=w*oe,D+=w*ce,k+=w*ue,P+=w*fe,y+=w*ye,f+=w*Le,R+=w*ke,B+=w*Pe,q+=w*Qe,F+=w*ze,te+=w*Ue,G+=w*st,Y+=w*ct,X+=w*Ve,M+=w*ot,w=L[7],x+=w*ne,D+=w*oe,k+=w*ce,P+=w*ue,y+=w*fe,f+=w*ye,R+=w*Le,B+=w*ke,q+=w*Pe,F+=w*Qe,te+=w*ze,G+=w*Ue,Y+=w*st,X+=w*ct,M+=w*Ve,J+=w*ot,w=L[8],D+=w*ne,k+=w*oe,P+=w*ce,y+=w*ue,f+=w*fe,R+=w*ye,B+=w*Le,q+=w*ke,F+=w*Pe,te+=w*Qe,G+=w*ze,Y+=w*Ue,X+=w*st,M+=w*ct,J+=w*Ve,de+=w*ot,w=L[9],k+=w*ne,P+=w*oe,y+=w*ce,f+=w*ue,R+=w*fe,B+=w*ye,q+=w*Le,F+=w*ke,te+=w*Pe,G+=w*Qe,Y+=w*ze,X+=w*Ue,M+=w*st,J+=w*ct,de+=w*Ve,he+=w*ot,w=L[10],P+=w*ne,y+=w*oe,f+=w*ce,R+=w*ue,B+=w*fe,q+=w*ye,F+=w*Le,te+=w*ke,G+=w*Pe,Y+=w*Qe,X+=w*ze,M+=w*Ue,J+=w*st,de+=w*ct,he+=w*Ve,Se+=w*ot,w=L[11],y+=w*ne,f+=w*oe,R+=w*ce,B+=w*ue,q+=w*fe,F+=w*ye,te+=w*Le,G+=w*ke,Y+=w*Pe,X+=w*Qe,M+=w*ze,J+=w*Ue,de+=w*st,he+=w*ct,Se+=w*Ve,Te+=w*ot,w=L[12],f+=w*ne,R+=w*oe,B+=w*ce,q+=w*ue,F+=w*fe,te+=w*ye,G+=w*Le,Y+=w*ke,X+=w*Pe,M+=w*Qe,J+=w*ze,de+=w*Ue,he+=w*st,Se+=w*ct,Te+=w*Ve,Re+=w*ot,w=L[13],R+=w*ne,B+=w*oe,q+=w*ce,F+=w*ue,te+=w*fe,G+=w*ye,Y+=w*Le,X+=w*ke,M+=w*Pe,J+=w*Qe,de+=w*ze,he+=w*Ue,Se+=w*st,Te+=w*ct,Re+=w*Ve,Ne+=w*ot,w=L[14],B+=w*ne,q+=w*oe,F+=w*ce,te+=w*ue,G+=w*fe,Y+=w*ye,X+=w*Le,M+=w*ke,J+=w*Pe,de+=w*Qe,he+=w*ze,Se+=w*Ue,Te+=w*st,Re+=w*ct,Ne+=w*Ve,Q+=w*ot,w=L[15],q+=w*ne,F+=w*oe,te+=w*ce,G+=w*ue,Y+=w*fe,X+=w*ye,M+=w*Le,J+=w*ke,de+=w*Pe,he+=w*Qe,Se+=w*ze,Te+=w*Ue,Re+=w*st,Ne+=w*ct,Q+=w*Ve,re+=w*ot,z+=38*F,K+=38*te,H+=38*G,A+=38*Y,m+=38*X,S+=38*M,T+=38*J,x+=38*de,D+=38*he,k+=38*Se,P+=38*Te,y+=38*Re,f+=38*Ne,R+=38*Q,B+=38*re,V=1,w=z+V+65535,V=Math.floor(w/65536),z=w-V*65536,w=K+V+65535,V=Math.floor(w/65536),K=w-V*65536,w=H+V+65535,V=Math.floor(w/65536),H=w-V*65536,w=A+V+65535,V=Math.floor(w/65536),A=w-V*65536,w=m+V+65535,V=Math.floor(w/65536),m=w-V*65536,w=S+V+65535,V=Math.floor(w/65536),S=w-V*65536,w=T+V+65535,V=Math.floor(w/65536),T=w-V*65536,w=x+V+65535,V=Math.floor(w/65536),x=w-V*65536,w=D+V+65535,V=Math.floor(w/65536),D=w-V*65536,w=k+V+65535,V=Math.floor(w/65536),k=w-V*65536,w=P+V+65535,V=Math.floor(w/65536),P=w-V*65536,w=y+V+65535,V=Math.floor(w/65536),y=w-V*65536,w=f+V+65535,V=Math.floor(w/65536),f=w-V*65536,w=R+V+65535,V=Math.floor(w/65536),R=w-V*65536,w=B+V+65535,V=Math.floor(w/65536),B=w-V*65536,w=q+V+65535,V=Math.floor(w/65536),q=w-V*65536,z+=V-1+37*(V-1),V=1,w=z+V+65535,V=Math.floor(w/65536),z=w-V*65536,w=K+V+65535,V=Math.floor(w/65536),K=w-V*65536,w=H+V+65535,V=Math.floor(w/65536),H=w-V*65536,w=A+V+65535,V=Math.floor(w/65536),A=w-V*65536,w=m+V+65535,V=Math.floor(w/65536),m=w-V*65536,w=S+V+65535,V=Math.floor(w/65536),S=w-V*65536,w=T+V+65535,V=Math.floor(w/65536),T=w-V*65536,w=x+V+65535,V=Math.floor(w/65536),x=w-V*65536,w=D+V+65535,V=Math.floor(w/65536),D=w-V*65536,w=k+V+65535,V=Math.floor(w/65536),k=w-V*65536,w=P+V+65535,V=Math.floor(w/65536),P=w-V*65536,w=y+V+65535,V=Math.floor(w/65536),y=w-V*65536,w=f+V+65535,V=Math.floor(w/65536),f=w-V*65536,w=R+V+65535,V=Math.floor(w/65536),R=w-V*65536,w=B+V+65535,V=Math.floor(w/65536),B=w-V*65536,w=q+V+65535,V=Math.floor(w/65536),q=w-V*65536,z+=V-1+37*(V-1),N[0]=z,N[1]=K,N[2]=H,N[3]=A,N[4]=m,N[5]=S,N[6]=T,N[7]=x,N[8]=D,N[9]=k,N[10]=P,N[11]=y,N[12]=f,N[13]=R,N[14]=B,N[15]=q}function p(N,L){h(N,L,L)}function _(N,L){const U=n();for(let w=0;w<16;w++)U[w]=L[w];for(let w=253;w>=0;w--)p(U,U),w!==2&&w!==4&&h(U,U,L);for(let w=0;w<16;w++)N[w]=U[w]}function g(N,L){const U=new Uint8Array(32),w=new Float64Array(80),V=n(),z=n(),K=n(),H=n(),A=n(),m=n();for(let D=0;D<31;D++)U[D]=N[D];U[31]=N[31]&127|64,U[0]&=248,d(w,L);for(let D=0;D<16;D++)z[D]=w[D];V[0]=H[0]=1;for(let D=254;D>=0;--D){const k=U[D>>>3]>>>(D&7)&1;a(V,z,k),a(K,H,k),l(A,V,K),u(V,V,K),l(K,z,H),u(z,z,H),p(H,A),p(m,V),h(V,K,V),h(K,z,A),l(A,V,K),u(V,V,K),p(z,V),u(K,H,m),h(V,K,s),l(V,V,H),h(K,K,V),h(V,H,m),h(H,z,w),p(z,A),a(V,z,k),a(K,H,k)}for(let D=0;D<16;D++)w[D+16]=V[D],w[D+32]=K[D],w[D+48]=z[D],w[D+64]=H[D];const S=w.subarray(32),T=w.subarray(16);_(S,S),h(T,T,S);const x=new Uint8Array(32);return c(x,T),x}e.scalarMult=g;function E(N){return g(N,i)}e.scalarMultBase=E;function b(N){if(N.length!==e.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${e.SECRET_KEY_LENGTH} bytes`);const L=new Uint8Array(N);return{publicKey:E(L),secretKey:L}}e.generateKeyPairFromSeed=b;function v(N){const L=(0,t.randomBytes)(32,N),U=b(L);return(0,r.wipe)(L),U}e.generateKeyPair=v;function I(N,L,U=!1){if(N.length!==e.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(L.length!==e.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const w=g(N,L);if(U){let V=0;for(let z=0;z<w.length;z++)V|=w[z];if(V===0)throw new Error("X25519: invalid shared key")}return w}e.sharedKey=I})(rP);const xde={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}},Mde=":";function fR(e){const[t,r]=e.split(Mde);return{namespace:t,reference:r}}function Cz(e,t){return e.includes(":")?[e]:t.chains||[]}var Ude=Object.defineProperty,zx=Object.getOwnPropertySymbols,jde=Object.prototype.hasOwnProperty,Fde=Object.prototype.propertyIsEnumerable,Wx=(e,t,r)=>t in e?Ude(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Gx=(e,t)=>{for(var r in t||(t={}))jde.call(t,r)&&Wx(e,r,t[r]);if(zx)for(var r of zx(t))Fde.call(t,r)&&Wx(e,r,t[r]);return e};const Bde="ReactNative",Do={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Vde="js";function $_(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function s0(){return!XD()&&!!QD()&&navigator.product===Bde}function o0(){return!$_()&&!!QD()&&!!XD()}function HE(){return s0()?Do.reactNative:$_()?Do.node:o0()?Do.browser:Do.unknown}function $de(){var e;try{return s0()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(e=global.Application)==null?void 0:e.applicationId:void 0}catch{return}}function Hde(e,t){let r=V_.parse(e);return r=Gx(Gx({},r),t),e=V_.stringify(r),e}function zde(){return yz()||{name:"",description:"",url:"",icons:[""]}}function Wde(){if(HE()===Do.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:n}=global.Platform;return[r,n].join("-")}const e=Zce();if(e===null)return"unknown";const t=e.os?e.os.replace(" ","").toLowerCase():"unknown";return e.type==="browser"?[t,e.name,e.version].join("-"):[t,e.version].join("-")}function Gde(){var e;const t=HE();return t===Do.browser?[t,((e=vz())==null?void 0:e.host)||"unknown"].join(":"):t}function qde(e,t,r){const n=Wde(),i=Gde();return[[e,t].join("-"),[Vde,r].join("-"),n,i].join("/")}function Kde({protocol:e,version:t,relayUrl:r,sdkVersion:n,auth:i,projectId:s,useOnCloseEvent:o,bundleId:a}){const c=r.split("?"),d=qde(e,t,n),l={auth:i,ua:d,projectId:s,useOnCloseEvent:o||void 0,origin:a||void 0},u=Hde(c[1]||"",l);return c[0]+"?"+u}function Uh(e,t){return e.filter(r=>t.includes(r)).length===e.length}function Iz(e){return Object.fromEntries(e.entries())}function Oz(e){return new Map(Object.entries(e))}function Sh(e=Ge.FIVE_MINUTES,t){const r=Ge.toMiliseconds(e||Ge.FIVE_MINUTES);let n,i,s;return{resolve:o=>{s&&n&&(clearTimeout(s),n(o))},reject:o=>{s&&i&&(clearTimeout(s),i(o))},done:()=>new Promise((o,a)=>{s=setTimeout(()=>{a(new Error(t))},r),n=o,i=a})}}function H_(e,t,r){return new Promise(async(n,i)=>{const s=setTimeout(()=>i(new Error(r)),t);try{const o=await e;n(o)}catch(o){i(o)}clearTimeout(s)})}function Nz(e,t){if(typeof t=="string"&&t.startsWith(`${e}:`))return t;if(e.toLowerCase()==="topic"){if(typeof t!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}else if(e.toLowerCase()==="id"){if(typeof t!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${e}`)}function Yde(e){return Nz("topic",e)}function Jde(e){return Nz("id",e)}function Dz(e){const[t,r]=e.split(":"),n={id:void 0,topic:void 0};if(t==="topic"&&typeof r=="string")n.topic=r;else if(t==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${r}`);return n}function ss(e,t){return Ge.fromMiliseconds(Date.now()+Ge.toMiliseconds(e))}function Jl(e){return Date.now()>=Ge.toMiliseconds(e)}function ur(e,t){return`${e}${t?`:${t}`:""}`}function Xde(e=[],t=[]){return[...new Set([...e,...t])]}async function Qde({id:e,topic:t,wcDeepLink:r}){try{if(!r)return;const n=typeof r=="string"?JSON.parse(r):r;let i=n==null?void 0:n.href;if(typeof i!="string")return;i.endsWith("/")&&(i=i.slice(0,-1));const s=`${i}/wc?requestId=${e}&sessionTopic=${t}`,o=HE();o===Do.browser?s.startsWith("https://")||s.startsWith("http://")?window.open(s,"_blank","noreferrer noopener"):window.open(s,"_self","noreferrer noopener"):o===Do.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(s)}catch(n){console.error(n)}}async function Zde(e,t){try{return await e.getItem(t)||(o0()?localStorage.getItem(t):void 0)}catch(r){console.error(r)}}var Pz=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ele(e){var t=e.default;if(typeof t=="function"){var r=function(){return t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}),r}var kz={exports:{}};/**
* [js-sha3]{@link https://github.com/emn178/js-sha3}
*
* @version 0.8.0
* @author Chen, Yi-Cyuan [emn178@gmail.com]
* @copyright Chen, Yi-Cyuan 2015-2018
* @license MIT
*/(function(e){(function(){var t="input is invalid type",r="finalize already called",n=typeof window=="object",i=n?window:{};i.JS_SHA3_NO_WINDOW&&(n=!1);var s=!n&&typeof self=="object",o=!i.JS_SHA3_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;o?i=Pz:s&&(i=self);var a=!i.JS_SHA3_NO_COMMON_JS&&!0&&e.exports,c=!i.JS_SHA3_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",d="0123456789abcdef".split(""),l=[31,7936,2031616,520093696],u=[4,1024,262144,67108864],h=[1,256,65536,16777216],p=[6,1536,393216,100663296],_=[0,8,16,24],g=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],E=[224,256,384,512],b=[128,256],v=["hex","buffer","arrayBuffer","array","digest"],I={128:168,256:136};(i.JS_SHA3_NO_NODE_JS||!Array.isArray)&&(Array.isArray=function(F){return Object.prototype.toString.call(F)==="[object Array]"}),c&&(i.JS_SHA3_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)&&(ArrayBuffer.isView=function(F){return typeof F=="object"&&F.buffer&&F.buffer.constructor===ArrayBuffer});for(var N=function(F,te,G){return function(Y){return new R(F,te,F).update(Y)[G]()}},L=function(F,te,G){return function(Y,X){return new R(F,te,X).update(Y)[G]()}},U=function(F,te,G){return function(Y,X,M,J){return S["cshake"+F].update(Y,X,M,J)[G]()}},w=function(F,te,G){return function(Y,X,M,J){return S["kmac"+F].update(Y,X,M,J)[G]()}},V=function(F,te,G,Y){for(var X=0;X<v.length;++X){var M=v[X];F[M]=te(G,Y,M)}return F},z=function(F,te){var G=N(F,te,"hex");return G.create=function(){return new R(F,te,F)},G.update=function(Y){return G.create().update(Y)},V(G,N,F,te)},K=function(F,te){var G=L(F,te,"hex");return G.create=function(Y){return new R(F,te,Y)},G.update=function(Y,X){return G.create(X).update(Y)},V(G,L,F,te)},H=function(F,te){var G=I[F],Y=U(F,te,"hex");return Y.create=function(X,M,J){return!M&&!J?S["shake"+F].create(X):new R(F,te,X).bytepad([M,J],G)},Y.update=function(X,M,J,de){return Y.create(M,J,de).update(X)},V(Y,U,F,te)},A=function(F,te){var G=I[F],Y=w(F,te,"hex");return Y.create=function(X,M,J){return new B(F,te,M).bytepad(["KMAC",J],G).bytepad([X],G)},Y.update=function(X,M,J,de){return Y.create(X,J,de).update(M)},V(Y,w,F,te)},m=[{name:"keccak",padding:h,bits:E,createMethod:z},{name:"sha3",padding:p,bits:E,createMethod:z},{name:"shake",padding:l,bits:b,createMethod:K},{name:"cshake",padding:u,bits:b,createMethod:H},{name:"kmac",padding:u,bits:b,createMethod:A}],S={},T=[],x=0;x<m.length;++x)for(var D=m[x],k=D.bits,P=0;P<k.length;++P){var y=D.name+"_"+k[P];if(T.push(y),S[y]=D.createMethod(k[P],D.padding),D.name!=="sha3"){var f=D.name+k[P];T.push(f),S[f]=S[y]}}function R(F,te,G){this.blocks=[],this.s=[],this.padding=te,this.outputBits=G,this.reset=!0,this.finalized=!1,this.block=0,this.start=0,this.blockCount=1600-(F<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=G>>5,this.extraBytes=(G&31)>>3;for(var Y=0;Y<50;++Y)this.s[Y]=0}R.prototype.update=function(F){if(this.finalized)throw new Error(r);var te,G=typeof F;if(G!=="string"){if(G==="object"){if(F===null)throw new Error(t);if(c&&F.constructor===ArrayBuffer)F=new Uint8Array(F);else if(!Array.isArray(F)&&(!c||!ArrayBuffer.isView(F)))throw new Error(t)}else throw new Error(t);te=!0}for(var Y=this.blocks,X=this.byteCount,M=F.length,J=this.blockCount,de=0,he=this.s,Se,Te;de<M;){if(this.reset)for(this.reset=!1,Y[0]=this.block,Se=1;Se<J+1;++Se)Y[Se]=0;if(te)for(Se=this.start;de<M&&Se<X;++de)Y[Se>>2]|=F[de]<<_[Se++&3];else for(Se=this.start;de<M&&Se<X;++de)Te=F.charCodeAt(de),Te<128?Y[Se>>2]|=Te<<_[Se++&3]:Te<2048?(Y[Se>>2]|=(192|Te>>6)<<_[Se++&3],Y[Se>>2]|=(128|Te&63)<<_[Se++&3]):Te<55296||Te>=57344?(Y[Se>>2]|=(224|Te>>12)<<_[Se++&3],Y[Se>>2]|=(128|Te>>6&63)<<_[Se++&3],Y[Se>>2]|=(128|Te&63)<<_[Se++&3]):(Te=65536+((Te&1023)<<10|F.charCodeAt(++de)&1023),Y[Se>>2]|=(240|Te>>18)<<_[Se++&3],Y[Se>>2]|=(128|Te>>12&63)<<_[Se++&3],Y[Se>>2]|=(128|Te>>6&63)<<_[Se++&3],Y[Se>>2]|=(128|Te&63)<<_[Se++&3]);if(this.lastByteIndex=Se,Se>=X){for(this.start=Se-X,this.block=Y[J],Se=0;Se<J;++Se)he[Se]^=Y[Se];q(he),this.reset=!0}else this.start=Se}return this},R.prototype.encode=function(F,te){var G=F&255,Y=1,X=[G];for(F=F>>8,G=F&255;G>0;)X.unshift(G),F=F>>8,G=F&255,++Y;return te?X.push(Y):X.unshift(Y),this.update(X),X.length},R.prototype.encodeString=function(F){var te,G=typeof F;if(G!=="string"){if(G==="object"){if(F===null)throw new Error(t);if(c&&F.constructor===ArrayBuffer)F=new Uint8Array(F);else if(!Array.isArray(F)&&(!c||!ArrayBuffer.isView(F)))throw new Error(t)}else throw new Error(t);te=!0}var Y=0,X=F.length;if(te)Y=X;else for(var M=0;M<F.length;++M){var J=F.charCodeAt(M);J<128?Y+=1:J<2048?Y+=2:J<55296||J>=57344?Y+=3:(J=65536+((J&1023)<<10|F.charCodeAt(++M)&1023),Y+=4)}return Y+=this.encode(Y*8),this.update(F),Y},R.prototype.bytepad=function(F,te){for(var G=this.encode(te),Y=0;Y<F.length;++Y)G+=this.encodeString(F[Y]);var X=te-G%te,M=[];return M.length=X,this.update(M),this},R.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var F=this.blocks,te=this.lastByteIndex,G=this.blockCount,Y=this.s;if(F[te>>2]|=this.padding[te&3],this.lastByteIndex===this.byteCount)for(F[0]=F[G],te=1;te<G+1;++te)F[te]=0;for(F[G-1]|=2147483648,te=0;te<G;++te)Y[te]^=F[te];q(Y)}},R.prototype.toString=R.prototype.hex=function(){this.finalize();for(var F=this.blockCount,te=this.s,G=this.outputBlocks,Y=this.extraBytes,X=0,M=0,J="",de;M<G;){for(X=0;X<F&&M<G;++X,++M)de=te[X],J+=d[de>>4&15]+d[de&15]+d[de>>12&15]+d[de>>8&15]+d[de>>20&15]+d[de>>16&15]+d[de>>28&15]+d[de>>24&15];M%F===0&&(q(te),X=0)}return Y&&(de=te[X],J+=d[de>>4&15]+d[de&15],Y>1&&(J+=d[de>>12&15]+d[de>>8&15]),Y>2&&(J+=d[de>>20&15]+d[de>>16&15])),J},R.prototype.arrayBuffer=function(){this.finalize();var F=this.blockCount,te=this.s,G=this.outputBlocks,Y=this.extraBytes,X=0,M=0,J=this.outputBits>>3,de;Y?de=new ArrayBuffer(G+1<<2):de=new ArrayBuffer(J);for(var he=new Uint32Array(de);M<G;){for(X=0;X<F&&M<G;++X,++M)he[M]=te[X];M%F===0&&q(te)}return Y&&(he[X]=te[X],de=de.slice(0,J)),de},R.prototype.buffer=R.prototype.arrayBuffer,R.prototype.digest=R.prototype.array=function(){this.finalize();for(var F=this.blockCount,te=this.s,G=this.outputBlocks,Y=this.extraBytes,X=0,M=0,J=[],de,he;M<G;){for(X=0;X<F&&M<G;++X,++M)de=M<<2,he=te[X],J[de]=he&255,J[de+1]=he>>8&255,J[de+2]=he>>16&255,J[de+3]=he>>24&255;M%F===0&&q(te)}return Y&&(de=M<<2,he=te[X],J[de]=he&255,Y>1&&(J[de+1]=he>>8&255),Y>2&&(J[de+2]=he>>16&255)),J};function B(F,te,G){R.call(this,F,te,G)}B.prototype=new R,B.prototype.finalize=function(){return this.encode(this.outputBits,!0),R.prototype.finalize.call(this)};var q=function(F){var te,G,Y,X,M,J,de,he,Se,Te,Re,Ne,Q,re,ne,oe,ce,ue,fe,ye,Le,ke,Pe,Qe,ze,Ue,st,ct,Ve,ot,nr,ut,lr,Wt,pt,br,wr,Ke,wt,Ct,Ye,It,Tt,tt,kt,Lt,rt,xt,Ot,Je,gt,Mt,nt,Mr,Ur,Nt,sr,Ls,xs,Ms,Us,js,Qn;for(Y=0;Y<48;Y+=2)X=F[0]^F[10]^F[20]^F[30]^F[40],M=F[1]^F[11]^F[21]^F[31]^F[41],J=F[2]^F[12]^F[22]^F[32]^F[42],de=F[3]^F[13]^F[23]^F[33]^F[43],he=F[4]^F[14]^F[24]^F[34]^F[44],Se=F[5]^F[15]^F[25]^F[35]^F[45],Te=F[6]^F[16]^F[26]^F[36]^F[46],Re=F[7]^F[17]^F[27]^F[37]^F[47],Ne=F[8]^F[18]^F[28]^F[38]^F[48],Q=F[9]^F[19]^F[29]^F[39]^F[49],te=Ne^(J<<1|de>>>31),G=Q^(de<<1|J>>>31),F[0]^=te,F[1]^=G,F[10]^=te,F[11]^=G,F[20]^=te,F[21]^=G,F[30]^=te,F[31]^=G,F[40]^=te,F[41]^=G,te=X^(he<<1|Se>>>31),G=M^(Se<<1|he>>>31),F[2]^=te,F[3]^=G,F[12]^=te,F[13]^=G,F[22]^=te,F[23]^=G,F[32]^=te,F[33]^=G,F[42]^=te,F[43]^=G,te=J^(Te<<1|Re>>>31),G=de^(Re<<1|Te>>>31),F[4]^=te,F[5]^=G,F[14]^=te,F[15]^=G,F[24]^=te,F[25]^=G,F[34]^=te,F[35]^=G,F[44]^=te,F[45]^=G,te=he^(Ne<<1|Q>>>31),G=Se^(Q<<1|Ne>>>31),F[6]^=te,F[7]^=G,F[16]^=te,F[17]^=G,F[26]^=te,F[27]^=G,F[36]^=te,F[37]^=G,F[46]^=te,F[47]^=G,te=Te^(X<<1|M>>>31),G=Re^(M<<1|X>>>31),F[8]^=te,F[9]^=G,F[18]^=te,F[19]^=G,F[28]^=te,F[29]^=G,F[38]^=te,F[39]^=G,F[48]^=te,F[49]^=G,re=F[0],ne=F[1],Lt=F[11]<<4|F[10]>>>28,rt=F[10]<<4|F[11]>>>28,ct=F[20]<<3|F[21]>>>29,Ve=F[21]<<3|F[20]>>>29,Ms=F[31]<<9|F[30]>>>23,Us=F[30]<<9|F[31]>>>23,It=F[40]<<18|F[41]>>>14,Tt=F[41]<<18|F[40]>>>14,Wt=F[2]<<1|F[3]>>>31,pt=F[3]<<1|F[2]>>>31,oe=F[13]<<12|F[12]>>>20,ce=F[12]<<12|F[13]>>>20,xt=F[22]<<10|F[23]>>>22,Ot=F[23]<<10|F[22]>>>22,ot=F[33]<<13|F[32]>>>19,nr=F[32]<<13|F[33]>>>19,js=F[42]<<2|F[43]>>>30,Qn=F[43]<<2|F[42]>>>30,Mr=F[5]<<30|F[4]>>>2,Ur=F[4]<<30|F[5]>>>2,br=F[14]<<6|F[15]>>>26,wr=F[15]<<6|F[14]>>>26,ue=F[25]<<11|F[24]>>>21,fe=F[24]<<11|F[25]>>>21,Je=F[34]<<15|F[35]>>>17,gt=F[35]<<15|F[34]>>>17,ut=F[45]<<29|F[44]>>>3,lr=F[44]<<29|F[45]>>>3,Qe=F[6]<<28|F[7]>>>4,ze=F[7]<<28|F[6]>>>4,Nt=F[17]<<23|F[16]>>>9,sr=F[16]<<23|F[17]>>>9,Ke=F[26]<<25|F[27]>>>7,wt=F[27]<<25|F[26]>>>7,ye=F[36]<<21|F[37]>>>11,Le=F[37]<<21|F[36]>>>11,Mt=F[47]<<24|F[46]>>>8,nt=F[46]<<24|F[47]>>>8,tt=F[8]<<27|F[9]>>>5,kt=F[9]<<27|F[8]>>>5,Ue=F[18]<<20|F[19]>>>12,st=F[19]<<20|F[18]>>>12,Ls=F[29]<<7|F[28]>>>25,xs=F[28]<<7|F[29]>>>25,Ct=F[38]<<8|F[39]>>>24,Ye=F[39]<<8|F[38]>>>24,ke=F[48]<<14|F[49]>>>18,Pe=F[49]<<14|F[48]>>>18,F[0]=re^~oe&ue,F[1]=ne^~ce&fe,F[10]=Qe^~Ue&ct,F[11]=ze^~st&Ve,F[20]=Wt^~br&Ke,F[21]=pt^~wr&wt,F[30]=tt^~Lt&xt,F[31]=kt^~rt&Ot,F[40]=Mr^~Nt&Ls,F[41]=Ur^~sr&xs,F[2]=oe^~ue&ye,F[3]=ce^~fe&Le,F[12]=Ue^~ct&ot,F[13]=st^~Ve&nr,F[22]=br^~Ke&Ct,F[23]=wr^~wt&Ye,F[32]=Lt^~xt&Je,F[33]=rt^~Ot&gt,F[42]=Nt^~Ls&Ms,F[43]=sr^~xs&Us,F[4]=ue^~ye&ke,F[5]=fe^~Le&Pe,F[14]=ct^~ot&ut,F[15]=Ve^~nr&lr,F[24]=Ke^~Ct&It,F[25]=wt^~Ye&Tt,F[34]=xt^~Je&Mt,F[35]=Ot^~gt&nt,F[44]=Ls^~Ms&js,F[45]=xs^~Us&Qn,F[6]=ye^~ke&re,F[7]=Le^~Pe&ne,F[16]=ot^~ut&Qe,F[17]=nr^~lr&ze,F[26]=Ct^~It&Wt,F[27]=Ye^~Tt&pt,F[36]=Je^~Mt&tt,F[37]=gt^~nt&kt,F[46]=Ms^~js&Mr,F[47]=Us^~Qn&Ur,F[8]=ke^~re&oe,F[9]=Pe^~ne&ce,F[18]=ut^~Qe&Ue,F[19]=lr^~ze&st,F[28]=It^~Wt&br,F[29]=Tt^~pt&wr,F[38]=Mt^~tt&Lt,F[39]=nt^~kt&rt,F[48]=js^~Mr&Nt,F[49]=Qn^~Ur&sr,F[0]^=g[Y],F[1]^=g[Y+1]};if(a)e.exports=S;else for(x=0;x<T.length;++x)i[T[x]]=S[T[x]]})()})(kz);var tle=kz.exports;const rle="logger/5.7.0";let qx=!1,Kx=!1;const cb={debug:1,default:2,info:2,warning:3,error:4,off:5};let Yx=cb.default,pR=null;function nle(){try{const e=[];if(["NFD","NFC","NFKD","NFKC"].forEach(t=>{try{if("test".normalize(t)!=="test")throw new Error("bad normalize")}catch{e.push(t)}}),e.length)throw new Error("missing "+e.join(", "));if("é".normalize("NFD")!=="é")throw new Error("broken implementation")}catch(e){return e.message}return null}const Jx=nle();var VO;(function(e){e.DEBUG="DEBUG",e.INFO="INFO",e.WARNING="WARNING",e.ERROR="ERROR",e.OFF="OFF"})(VO||(VO={}));var Za;(function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.NOT_IMPLEMENTED="NOT_IMPLEMENTED",e.UNSUPPORTED_OPERATION="UNSUPPORTED_OPERATION",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.TIMEOUT="TIMEOUT",e.BUFFER_OVERRUN="BUFFER_OVERRUN",e.NUMERIC_FAULT="NUMERIC_FAULT",e.MISSING_NEW="MISSING_NEW",e.INVALID_ARGUMENT="INVALID_ARGUMENT",e.MISSING_ARGUMENT="MISSING_ARGUMENT",e.UNEXPECTED_ARGUMENT="UNEXPECTED_ARGUMENT",e.CALL_EXCEPTION="CALL_EXCEPTION",e.INSUFFICIENT_FUNDS="INSUFFICIENT_FUNDS",e.NONCE_EXPIRED="NONCE_EXPIRED",e.REPLACEMENT_UNDERPRICED="REPLACEMENT_UNDERPRICED",e.UNPREDICTABLE_GAS_LIMIT="UNPREDICTABLE_GAS_LIMIT",e.TRANSACTION_REPLACED="TRANSACTION_REPLACED",e.ACTION_REJECTED="ACTION_REJECTED"})(Za||(Za={}));const Xx="0123456789abcdef";let Bi=class ci{constructor(t){Object.defineProperty(this,"version",{enumerable:!0,value:t,writable:!1})}_log(t,r){const n=t.toLowerCase();cb[n]==null&&this.throwArgumentError("invalid log level name","logLevel",t),!(Yx>cb[n])&&console.log.apply(console,r)}debug(...t){this._log(ci.levels.DEBUG,t)}info(...t){this._log(ci.levels.INFO,t)}warn(...t){this._log(ci.levels.WARNING,t)}makeError(t,r,n){if(Kx)return this.makeError("censored error",r,{});r||(r=ci.errors.UNKNOWN_ERROR),n||(n={});const i=[];Object.keys(n).forEach(c=>{const d=n[c];try{if(d instanceof Uint8Array){let l="";for(let u=0;u<d.length;u++)l+=Xx[d[u]>>4],l+=Xx[d[u]&15];i.push(c+"=Uint8Array(0x"+l+")")}else i.push(c+"="+JSON.stringify(d))}catch{i.push(c+"="+JSON.stringify(n[c].toString()))}}),i.push(`code=${r}`),i.push(`version=${this.version}`);const s=t;let o="";switch(r){case Za.NUMERIC_FAULT:{o="NUMERIC_FAULT";const c=t;switch(c){case"overflow":case"underflow":case"division-by-zero":o+="-"+c;break;case"negative-power":case"negative-width":o+="-unsupported";break;case"unbound-bitwise-result":o+="-unbound-result";break}break}case Za.CALL_EXCEPTION:case Za.INSUFFICIENT_FUNDS:case Za.MISSING_NEW:case Za.NONCE_EXPIRED:case Za.REPLACEMENT_UNDERPRICED:case Za.TRANSACTION_REPLACED:case Za.UNPREDICTABLE_GAS_LIMIT:o=r;break}o&&(t+=" [ See: https://links.ethers.org/v5-errors-"+o+" ]"),i.length&&(t+=" ("+i.join(", ")+")");const a=new Error(t);return a.reason=s,a.code=r,Object.keys(n).forEach(function(c){a[c]=n[c]}),a}throwError(t,r,n){throw this.makeError(t,r,n)}throwArgumentError(t,r,n){return this.throwError(t,ci.errors.INVALID_ARGUMENT,{argument:r,value:n})}assert(t,r,n,i){t||this.throwError(r,n,i)}assertArgument(t,r,n,i){t||this.throwArgumentError(r,n,i)}checkNormalize(t){Jx&&this.throwError("platform missing String.prototype.normalize",ci.errors.UNSUPPORTED_OPERATION,{operation:"String.prototype.normalize",form:Jx})}checkSafeUint53(t,r){typeof t=="number"&&(r==null&&(r="value not safe"),(t<0||t>=9007199254740991)&&this.throwError(r,ci.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"out-of-safe-range",value:t}),t%1&&this.throwError(r,ci.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"non-integer",value:t}))}checkArgumentCount(t,r,n){n?n=": "+n:n="",t<r&&this.throwError("missing argument"+n,ci.errors.MISSING_ARGUMENT,{count:t,expectedCount:r}),t>r&&this.throwError("too many arguments"+n,ci.errors.UNEXPECTED_ARGUMENT,{count:t,expectedCount:r})}checkNew(t,r){(t===Object||t==null)&&this.throwError("missing new",ci.errors.MISSING_NEW,{name:r.name})}checkAbstract(t,r){t===r?this.throwError("cannot instantiate abstract class "+JSON.stringify(r.name)+" directly; use a sub-class",ci.errors.UNSUPPORTED_OPERATION,{name:t.name,operation:"new"}):(t===Object||t==null)&&this.throwError("missing new",ci.errors.MISSING_NEW,{name:r.name})}static globalLogger(){return pR||(pR=new ci(rle)),pR}static setCensorship(t,r){if(!t&&r&&this.globalLogger().throwError("cannot permanently disable censorship",ci.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"}),qx){if(!t)return;this.globalLogger().throwError("error censorship permanent",ci.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"})}Kx=!!t,qx=!!r}static setLogLevel(t){const r=cb[t.toLowerCase()];if(r==null){ci.globalLogger().warn("invalid log level - "+t);return}Yx=r}static from(t){return new ci(t)}};Bi.errors=Za,Bi.levels=VO;const ile="bytes/5.7.0",Wn=new Bi(ile);function Lz(e){return!!e.toHexString}function im(e){return e.slice||(e.slice=function(){const t=Array.prototype.slice.call(arguments);return im(new Uint8Array(Array.prototype.slice.apply(e,t)))}),e}function sle(e){return jo(e)&&!(e.length%2)||a0(e)}function Qx(e){return typeof e=="number"&&e==e&&e%1===0}function a0(e){if(e==null)return!1;if(e.constructor===Uint8Array)return!0;if(typeof e=="string"||!Qx(e.length)||e.length<0)return!1;for(let t=0;t<e.length;t++){const r=e[t];if(!Qx(r)||r<0||r>=256)return!1}return!0}function jn(e,t){if(t||(t={}),typeof e=="number"){Wn.checkSafeUint53(e,"invalid arrayify value");const r=[];for(;e;)r.unshift(e&255),e=parseInt(String(e/256));return r.length===0&&r.push(0),im(new Uint8Array(r))}if(t.allowMissingPrefix&&typeof e=="string"&&e.substring(0,2)!=="0x"&&(e="0x"+e),Lz(e)&&(e=e.toHexString()),jo(e)){let r=e.substring(2);r.length%2&&(t.hexPad==="left"?r="0"+r:t.hexPad==="right"?r+="0":Wn.throwArgumentError("hex data is odd-length","value",e));const n=[];for(let i=0;i<r.length;i+=2)n.push(parseInt(r.substring(i,i+2),16));return im(new Uint8Array(n))}return a0(e)?im(new Uint8Array(e)):Wn.throwArgumentError("invalid arrayify value","value",e)}function ole(e){const t=e.map(i=>jn(i)),r=t.reduce((i,s)=>i+s.length,0),n=new Uint8Array(r);return t.reduce((i,s)=>(n.set(s,i),i+s.length),0),im(n)}function ale(e,t){e=jn(e),e.length>t&&Wn.throwArgumentError("value out of range","value",arguments[0]);const r=new Uint8Array(t);return r.set(e,t-e.length),im(r)}function jo(e,t){return!(typeof e!="string"||!e.match(/^0x[0-9A-Fa-f]*$/)||t&&e.length!==2+2*t)}const mR="0123456789abcdef";function Gs(e,t){if(t||(t={}),typeof e=="number"){Wn.checkSafeUint53(e,"invalid hexlify value");let r="";for(;e;)r=mR[e&15]+r,e=Math.floor(e/16);return r.length?(r.length%2&&(r="0"+r),"0x"+r):"0x00"}if(typeof e=="bigint")return e=e.toString(16),e.length%2?"0x0"+e:"0x"+e;if(t.allowMissingPrefix&&typeof e=="string"&&e.substring(0,2)!=="0x"&&(e="0x"+e),Lz(e))return e.toHexString();if(jo(e))return e.length%2&&(t.hexPad==="left"?e="0x0"+e.substring(2):t.hexPad==="right"?e+="0":Wn.throwArgumentError("hex data is odd-length","value",e)),e.toLowerCase();if(a0(e)){let r="0x";for(let n=0;n<e.length;n++){let i=e[n];r+=mR[(i&240)>>4]+mR[i&15]}return r}return Wn.throwArgumentError("invalid hexlify value","value",e)}function cle(e){if(typeof e!="string")e=Gs(e);else if(!jo(e)||e.length%2)return null;return(e.length-2)/2}function Zx(e,t,r){return typeof e!="string"?e=Gs(e):(!jo(e)||e.length%2)&&Wn.throwArgumentError("invalid hexData","value",e),t=2+2*t,"0x"+e.substring(t)}function sd(e,t){for(typeof e!="string"?e=Gs(e):jo(e)||Wn.throwArgumentError("invalid hex string","value",e),e.length>2*t+2&&Wn.throwArgumentError("value out of range","value",arguments[1]);e.length<2*t+2;)e="0x0"+e.substring(2);return e}function xz(e){const t={r:"0x",s:"0x",_vs:"0x",recoveryParam:0,v:0,yParityAndS:"0x",compact:"0x"};if(sle(e)){let r=jn(e);r.length===64?(t.v=27+(r[32]>>7),r[32]&=127,t.r=Gs(r.slice(0,32)),t.s=Gs(r.slice(32,64))):r.length===65?(t.r=Gs(r.slice(0,32)),t.s=Gs(r.slice(32,64)),t.v=r[64]):Wn.throwArgumentError("invalid signature string","signature",e),t.v<27&&(t.v===0||t.v===1?t.v+=27:Wn.throwArgumentError("signature invalid v byte","signature",e)),t.recoveryParam=1-t.v%2,t.recoveryParam&&(r[32]|=128),t._vs=Gs(r.slice(32,64))}else{if(t.r=e.r,t.s=e.s,t.v=e.v,t.recoveryParam=e.recoveryParam,t._vs=e._vs,t._vs!=null){const i=ale(jn(t._vs),32);t._vs=Gs(i);const s=i[0]>=128?1:0;t.recoveryParam==null?t.recoveryParam=s:t.recoveryParam!==s&&Wn.throwArgumentError("signature recoveryParam mismatch _vs","signature",e),i[0]&=127;const o=Gs(i);t.s==null?t.s=o:t.s!==o&&Wn.throwArgumentError("signature v mismatch _vs","signature",e)}if(t.recoveryParam==null)t.v==null?Wn.throwArgumentError("signature missing v and recoveryParam","signature",e):t.v===0||t.v===1?t.recoveryParam=t.v:t.recoveryParam=1-t.v%2;else if(t.v==null)t.v=27+t.recoveryParam;else{const i=t.v===0||t.v===1?t.v:1-t.v%2;t.recoveryParam!==i&&Wn.throwArgumentError("signature recoveryParam mismatch v","signature",e)}t.r==null||!jo(t.r)?Wn.throwArgumentError("signature missing or invalid r","signature",e):t.r=sd(t.r,32),t.s==null||!jo(t.s)?Wn.throwArgumentError("signature missing or invalid s","signature",e):t.s=sd(t.s,32);const r=jn(t.s);r[0]>=128&&Wn.throwArgumentError("signature s out of range","signature",e),t.recoveryParam&&(r[0]|=128);const n=Gs(r);t._vs&&(jo(t._vs)||Wn.throwArgumentError("signature invalid _vs","signature",e),t._vs=sd(t._vs,32)),t._vs==null?t._vs=n:t._vs!==n&&Wn.throwArgumentError("signature _vs mismatch v and s","signature",e)}return t.yParityAndS=t._vs,t.compact=t.r+t.yParityAndS.substring(2),t}function nP(e){return"0x"+tle.keccak_256(jn(e))}var Mz={exports:{}},dle={},lle=Object.freeze({__proto__:null,default:dle}),ule=ele(lle);(function(e){(function(t,r){function n(m,S){if(!m)throw new Error(S||"Assertion failed")}function i(m,S){m.super_=S;var T=function(){};T.prototype=S.prototype,m.prototype=new T,m.prototype.constructor=m}function s(m,S,T){if(s.isBN(m))return m;this.negative=0,this.words=null,this.length=0,this.red=null,m!==null&&((S==="le"||S==="be")&&(T=S,S=10),this._init(m||0,S||10,T||"be"))}typeof t=="object"?t.exports=s:r.BN=s,s.BN=s,s.wordSize=26;var o;try{typeof window<"u"&&typeof window.Buffer<"u"?o=window.Buffer:o=ule.Buffer}catch{}s.isBN=function(m){return m instanceof s?!0:m!==null&&typeof m=="object"&&m.constructor.wordSize===s.wordSize&&Array.isArray(m.words)},s.max=function(m,S){return m.cmp(S)>0?m:S},s.min=function(m,S){return m.cmp(S)<0?m:S},s.prototype._init=function(m,S,T){if(typeof m=="number")return this._initNumber(m,S,T);if(typeof m=="object")return this._initArray(m,S,T);S==="hex"&&(S=16),n(S===(S|0)&&S>=2&&S<=36),m=m.toString().replace(/\s+/g,"");var x=0;m[0]==="-"&&(x++,this.negative=1),x<m.length&&(S===16?this._parseHex(m,x,T):(this._parseBase(m,S,x),T==="le"&&this._initArray(this.toArray(),S,T)))},s.prototype._initNumber=function(m,S,T){m<0&&(this.negative=1,m=-m),m<67108864?(this.words=[m&67108863],this.length=1):m<4503599627370496?(this.words=[m&67108863,m/67108864&67108863],this.length=2):(n(m<9007199254740992),this.words=[m&67108863,m/67108864&67108863,1],this.length=3),T==="le"&&this._initArray(this.toArray(),S,T)},s.prototype._initArray=function(m,S,T){if(n(typeof m.length=="number"),m.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(m.length/3),this.words=new Array(this.length);for(var x=0;x<this.length;x++)this.words[x]=0;var D,k,P=0;if(T==="be")for(x=m.length-1,D=0;x>=0;x-=3)k=m[x]|m[x-1]<<8|m[x-2]<<16,this.words[D]|=k<<P&67108863,this.words[D+1]=k>>>26-P&67108863,P+=24,P>=26&&(P-=26,D++);else if(T==="le")for(x=0,D=0;x<m.length;x+=3)k=m[x]|m[x+1]<<8|m[x+2]<<16,this.words[D]|=k<<P&67108863,this.words[D+1]=k>>>26-P&67108863,P+=24,P>=26&&(P-=26,D++);return this._strip()};function a(m,S){var T=m.charCodeAt(S);if(T>=48&&T<=57)return T-48;if(T>=65&&T<=70)return T-55;if(T>=97&&T<=102)return T-87;n(!1,"Invalid character in "+m)}function c(m,S,T){var x=a(m,T);return T-1>=S&&(x|=a(m,T-1)<<4),x}s.prototype._parseHex=function(m,S,T){this.length=Math.ceil((m.length-S)/6),this.words=new Array(this.length);for(var x=0;x<this.length;x++)this.words[x]=0;var D=0,k=0,P;if(T==="be")for(x=m.length-1;x>=S;x-=2)P=c(m,S,x)<<D,this.words[k]|=P&67108863,D>=18?(D-=18,k+=1,this.words[k]|=P>>>26):D+=8;else{var y=m.length-S;for(x=y%2===0?S+1:S;x<m.length;x+=2)P=c(m,S,x)<<D,this.words[k]|=P&67108863,D>=18?(D-=18,k+=1,this.words[k]|=P>>>26):D+=8}this._strip()};function d(m,S,T,x){for(var D=0,k=0,P=Math.min(m.length,T),y=S;y<P;y++){var f=m.charCodeAt(y)-48;D*=x,f>=49?k=f-49+10:f>=17?k=f-17+10:k=f,n(f>=0&&k<x,"Invalid character"),D+=k}return D}s.prototype._parseBase=function(m,S,T){this.words=[0],this.length=1;for(var x=0,D=1;D<=67108863;D*=S)x++;x--,D=D/S|0;for(var k=m.length-T,P=k%x,y=Math.min(k,k-P)+T,f=0,R=T;R<y;R+=x)f=d(m,R,R+x,S),this.imuln(D),this.words[0]+f<67108864?this.words[0]+=f:this._iaddn(f);if(P!==0){var B=1;for(f=d(m,R,m.length,S),R=0;R<P;R++)B*=S;this.imuln(B),this.words[0]+f<67108864?this.words[0]+=f:this._iaddn(f)}this._strip()},s.prototype.copy=function(m){m.words=new Array(this.length);for(var S=0;S<this.length;S++)m.words[S]=this.words[S];m.length=this.length,m.negative=this.negative,m.red=this.red};function l(m,S){m.words=S.words,m.length=S.length,m.negative=S.negative,m.red=S.red}if(s.prototype._move=function(m){l(m,this)},s.prototype.clone=function(){var m=new s(null);return this.copy(m),m},s.prototype._expand=function(m){for(;this.length<m;)this.words[this.length++]=0;return this},s.prototype._strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},s.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},typeof Symbol<"u"&&typeof Symbol.for=="function")try{s.prototype[Symbol.for("nodejs.util.inspect.custom")]=u}catch{s.prototype.inspect=u}else s.prototype.inspect=u;function u(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var h=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],p=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],_=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];s.prototype.toString=function(m,S){m=m||10,S=S|0||1;var T;if(m===16||m==="hex"){T="";for(var x=0,D=0,k=0;k<this.length;k++){var P=this.words[k],y=((P<<x|D)&16777215).toString(16);D=P>>>24-x&16777215,x+=2,x>=26&&(x-=26,k--),D!==0||k!==this.length-1?T=h[6-y.length]+y+T:T=y+T}for(D!==0&&(T=D.toString(16)+T);T.length%S!==0;)T="0"+T;return this.negative!==0&&(T="-"+T),T}if(m===(m|0)&&m>=2&&m<=36){var f=p[m],R=_[m];T="";var B=this.clone();for(B.negative=0;!B.isZero();){var q=B.modrn(R).toString(m);B=B.idivn(R),B.isZero()?T=q+T:T=h[f-q.length]+q+T}for(this.isZero()&&(T="0"+T);T.length%S!==0;)T="0"+T;return this.negative!==0&&(T="-"+T),T}n(!1,"Base should be between 2 and 36")},s.prototype.toNumber=function(){var m=this.words[0];return this.length===2?m+=this.words[1]*67108864:this.length===3&&this.words[2]===1?m+=4503599627370496+this.words[1]*67108864:this.length>2&&n(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-m:m},s.prototype.toJSON=function(){return this.toString(16,2)},o&&(s.prototype.toBuffer=function(m,S){return this.toArrayLike(o,m,S)}),s.prototype.toArray=function(m,S){return this.toArrayLike(Array,m,S)};var g=function(m,S){return m.allocUnsafe?m.allocUnsafe(S):new m(S)};s.prototype.toArrayLike=function(m,S,T){this._strip();var x=this.byteLength(),D=T||Math.max(1,x);n(x<=D,"byte array longer than desired length"),n(D>0,"Requested array length <= 0");var k=g(m,D),P=S==="le"?"LE":"BE";return this["_toArrayLike"+P](k,x),k},s.prototype._toArrayLikeLE=function(m,S){for(var T=0,x=0,D=0,k=0;D<this.length;D++){var P=this.words[D]<<k|x;m[T++]=P&255,T<m.length&&(m[T++]=P>>8&255),T<m.length&&(m[T++]=P>>16&255),k===6?(T<m.length&&(m[T++]=P>>24&255),x=0,k=0):(x=P>>>24,k+=2)}if(T<m.length)for(m[T++]=x;T<m.length;)m[T++]=0},s.prototype._toArrayLikeBE=function(m,S){for(var T=m.length-1,x=0,D=0,k=0;D<this.length;D++){var P=this.words[D]<<k|x;m[T--]=P&255,T>=0&&(m[T--]=P>>8&255),T>=0&&(m[T--]=P>>16&255),k===6?(T>=0&&(m[T--]=P>>24&255),x=0,k=0):(x=P>>>24,k+=2)}if(T>=0)for(m[T--]=x;T>=0;)m[T--]=0},Math.clz32?s.prototype._countBits=function(m){return 32-Math.clz32(m)}:s.prototype._countBits=function(m){var S=m,T=0;return S>=4096&&(T+=13,S>>>=13),S>=64&&(T+=7,S>>>=7),S>=8&&(T+=4,S>>>=4),S>=2&&(T+=2,S>>>=2),T+S},s.prototype._zeroBits=function(m){if(m===0)return 26;var S=m,T=0;return S&8191||(T+=13,S>>>=13),S&127||(T+=7,S>>>=7),S&15||(T+=4,S>>>=4),S&3||(T+=2,S>>>=2),S&1||T++,T},s.prototype.bitLength=function(){var m=this.words[this.length-1],S=this._countBits(m);return(this.length-1)*26+S};function E(m){for(var S=new Array(m.bitLength()),T=0;T<S.length;T++){var x=T/26|0,D=T%26;S[T]=m.words[x]>>>D&1}return S}s.prototype.zeroBits=function(){if(this.isZero())return 0;for(var m=0,S=0;S<this.length;S++){var T=this._zeroBits(this.words[S]);if(m+=T,T!==26)break}return m},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.toTwos=function(m){return this.negative!==0?this.abs().inotn(m).iaddn(1):this.clone()},s.prototype.fromTwos=function(m){return this.testn(m-1)?this.notn(m).iaddn(1).ineg():this.clone()},s.prototype.isNeg=function(){return this.negative!==0},s.prototype.neg=function(){return this.clone().ineg()},s.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},s.prototype.iuor=function(m){for(;this.length<m.length;)this.words[this.length++]=0;for(var S=0;S<m.length;S++)this.words[S]=this.words[S]|m.words[S];return this._strip()},s.prototype.ior=function(m){return n((this.negative|m.negative)===0),this.iuor(m)},s.prototype.or=function(m){return this.length>m.length?this.clone().ior(m):m.clone().ior(this)},s.prototype.uor=function(m){return this.length>m.length?this.clone().iuor(m):m.clone().iuor(this)},s.prototype.iuand=function(m){var S;this.length>m.length?S=m:S=this;for(var T=0;T<S.length;T++)this.words[T]=this.words[T]&m.words[T];return this.length=S.length,this._strip()},s.prototype.iand=function(m){return n((this.negative|m.negative)===0),this.iuand(m)},s.prototype.and=function(m){return this.length>m.length?this.clone().iand(m):m.clone().iand(this)},s.prototype.uand=function(m){return this.length>m.length?this.clone().iuand(m):m.clone().iuand(this)},s.prototype.iuxor=function(m){var S,T;this.length>m.length?(S=this,T=m):(S=m,T=this);for(var x=0;x<T.length;x++)this.words[x]=S.words[x]^T.words[x];if(this!==S)for(;x<S.length;x++)this.words[x]=S.words[x];return this.length=S.length,this._strip()},s.prototype.ixor=function(m){return n((this.negative|m.negative)===0),this.iuxor(m)},s.prototype.xor=function(m){return this.length>m.length?this.clone().ixor(m):m.clone().ixor(this)},s.prototype.uxor=function(m){return this.length>m.length?this.clone().iuxor(m):m.clone().iuxor(this)},s.prototype.inotn=function(m){n(typeof m=="number"&&m>=0);var S=Math.ceil(m/26)|0,T=m%26;this._expand(S),T>0&&S--;for(var x=0;x<S;x++)this.words[x]=~this.words[x]&67108863;return T>0&&(this.words[x]=~this.words[x]&67108863>>26-T),this._strip()},s.prototype.notn=function(m){return this.clone().inotn(m)},s.prototype.setn=function(m,S){n(typeof m=="number"&&m>=0);var T=m/26|0,x=m%26;return this._expand(T+1),S?this.words[T]=this.words[T]|1<<x:this.words[T]=this.words[T]&~(1<<x),this._strip()},s.prototype.iadd=function(m){var S;if(this.negative!==0&&m.negative===0)return this.negative=0,S=this.isub(m),this.negative^=1,this._normSign();if(this.negative===0&&m.negative!==0)return m.negative=0,S=this.isub(m),m.negative=1,S._normSign();var T,x;this.length>m.length?(T=this,x=m):(T=m,x=this);for(var D=0,k=0;k<x.length;k++)S=(T.words[k]|0)+(x.words[k]|0)+D,this.words[k]=S&67108863,D=S>>>26;for(;D!==0&&k<T.length;k++)S=(T.words[k]|0)+D,this.words[k]=S&67108863,D=S>>>26;if(this.length=T.length,D!==0)this.words[this.length]=D,this.length++;else if(T!==this)for(;k<T.length;k++)this.words[k]=T.words[k];return this},s.prototype.add=function(m){var S;return m.negative!==0&&this.negative===0?(m.negative=0,S=this.sub(m),m.negative^=1,S):m.negative===0&&this.negative!==0?(this.negative=0,S=m.sub(this),this.negative=1,S):this.length>m.length?this.clone().iadd(m):m.clone().iadd(this)},s.prototype.isub=function(m){if(m.negative!==0){m.negative=0;var S=this.iadd(m);return m.negative=1,S._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(m),this.negative=1,this._normSign();var T=this.cmp(m);if(T===0)return this.negative=0,this.length=1,this.words[0]=0,this;var x,D;T>0?(x=this,D=m):(x=m,D=this);for(var k=0,P=0;P<D.length;P++)S=(x.words[P]|0)-(D.words[P]|0)+k,k=S>>26,this.words[P]=S&67108863;for(;k!==0&&P<x.length;P++)S=(x.words[P]|0)+k,k=S>>26,this.words[P]=S&67108863;if(k===0&&P<x.length&&x!==this)for(;P<x.length;P++)this.words[P]=x.words[P];return this.length=Math.max(this.length,P),x!==this&&(this.negative=1),this._strip()},s.prototype.sub=function(m){return this.clone().isub(m)};function b(m,S,T){T.negative=S.negative^m.negative;var x=m.length+S.length|0;T.length=x,x=x-1|0;var D=m.words[0]|0,k=S.words[0]|0,P=D*k,y=P&67108863,f=P/67108864|0;T.words[0]=y;for(var R=1;R<x;R++){for(var B=f>>>26,q=f&67108863,F=Math.min(R,S.length-1),te=Math.max(0,R-m.length+1);te<=F;te++){var G=R-te|0;D=m.words[G]|0,k=S.words[te]|0,P=D*k+q,B+=P/67108864|0,q=P&67108863}T.words[R]=q|0,f=B|0}return f!==0?T.words[R]=f|0:T.length--,T._strip()}var v=function(m,S,T){var x=m.words,D=S.words,k=T.words,P=0,y,f,R,B=x[0]|0,q=B&8191,F=B>>>13,te=x[1]|0,G=te&8191,Y=te>>>13,X=x[2]|0,M=X&8191,J=X>>>13,de=x[3]|0,he=de&8191,Se=de>>>13,Te=x[4]|0,Re=Te&8191,Ne=Te>>>13,Q=x[5]|0,re=Q&8191,ne=Q>>>13,oe=x[6]|0,ce=oe&8191,ue=oe>>>13,fe=x[7]|0,ye=fe&8191,Le=fe>>>13,ke=x[8]|0,Pe=ke&8191,Qe=ke>>>13,ze=x[9]|0,Ue=ze&8191,st=ze>>>13,ct=D[0]|0,Ve=ct&8191,ot=ct>>>13,nr=D[1]|0,ut=nr&8191,lr=nr>>>13,Wt=D[2]|0,pt=Wt&8191,br=Wt>>>13,wr=D[3]|0,Ke=wr&8191,wt=wr>>>13,Ct=D[4]|0,Ye=Ct&8191,It=Ct>>>13,Tt=D[5]|0,tt=Tt&8191,kt=Tt>>>13,Lt=D[6]|0,rt=Lt&8191,xt=Lt>>>13,Ot=D[7]|0,Je=Ot&8191,gt=Ot>>>13,Mt=D[8]|0,nt=Mt&8191,Mr=Mt>>>13,Ur=D[9]|0,Nt=Ur&8191,sr=Ur>>>13;T.negative=m.negative^S.negative,T.length=19,y=Math.imul(q,Ve),f=Math.imul(q,ot),f=f+Math.imul(F,Ve)|0,R=Math.imul(F,ot);var Ls=(P+y|0)+((f&8191)<<13)|0;P=(R+(f>>>13)|0)+(Ls>>>26)|0,Ls&=67108863,y=Math.imul(G,Ve),f=Math.imul(G,ot),f=f+Math.imul(Y,Ve)|0,R=Math.imul(Y,ot),y=y+Math.imul(q,ut)|0,f=f+Math.imul(q,lr)|0,f=f+Math.imul(F,ut)|0,R=R+Math.imul(F,lr)|0;var xs=(P+y|0)+((f&8191)<<13)|0;P=(R+(f>>>13)|0)+(xs>>>26)|0,xs&=67108863,y=Math.imul(M,Ve),f=Math.imul(M,ot),f=f+Math.imul(J,Ve)|0,R=Math.imul(J,ot),y=y+Math.imul(G,ut)|0,f=f+Math.imul(G,lr)|0,f=f+Math.imul(Y,ut)|0,R=R+Math.imul(Y,lr)|0,y=y+Math.imul(q,pt)|0,f=f+Math.imul(q,br)|0,f=f+Math.imul(F,pt)|0,R=R+Math.imul(F,br)|0;var Ms=(P+y|0)+((f&8191)<<13)|0;P=(R+(f>>>13)|0)+(Ms>>>26)|0,Ms&=67108863,y=Math.imul(he,Ve),f=Math.imul(he,ot),f=f+Math.imul(Se,Ve)|0,R=Math.imul(Se,ot),y=y+Math.imul(M,ut)|0,f=f+Math.imul(M,lr)|0,f=f+Math.imul(J,ut)|0,R=R+Math.imul(J,lr)|0,y=y+Math.imul(G,pt)|0,f=f+Math.imul(G,br)|0,f=f+Math.imul(Y,pt)|0,R=R+Math.imul(Y,br)|0,y=y+Math.imul(q,Ke)|0,f=f+Math.imul(q,wt)|0,f=f+Math.imul(F,Ke)|0,R=R+Math.imul(F,wt)|0;var Us=(P+y|0)+((f&8191)<<13)|0;P=(R+(f>>>13)|0)+(Us>>>26)|0,Us&=67108863,y=Math.imul(Re,Ve),f=Math.imul(Re,ot),f=f+Math.imul(Ne,Ve)|0,R=Math.imul(Ne,ot),y=y+Math.imul(he,ut)|0,f=f+Math.imul(he,lr)|0,f=f+Math.imul(Se,ut)|0,R=R+Math.imul(Se,lr)|0,y=y+Math.imul(M,pt)|0,f=f+Math.imul(M,br)|0,f=f+Math.imul(J,pt)|0,R=R+Math.imul(J,br)|0,y=y+Math.imul(G,Ke)|0,f=f+Math.imul(G,wt)|0,f=f+Math.imul(Y,Ke)|0,R=R+Math.imul(Y,wt)|0,y=y+Math.imul(q,Ye)|0,f=f+Math.imul(q,It)|0,f=f+Math.imul(F,Ye)|0,R=R+Math.imul(F,It)|0;var js=(P+y|0)+((f&8191)<<13)|0;P=(R+(f>>>13)|0)+(js>>>26)|0,js&=67108863,y=Math.imul(re,Ve),f=Math.imul(re,ot),f=f+Math.imul(ne,Ve)|0,R=Math.imul(ne,ot),y=y+Math.imul(Re,ut)|0,f=f+Math.imul(Re,lr)|0,f=f+Math.imul(Ne,ut)|0,R=R+Math.imul(Ne,lr)|0,y=y+Math.imul(he,pt)|0,f=f+Math.imul(he,br)|0,f=f+Math.imul(Se,pt)|0,R=R+Math.imul(Se,br)|0,y=y+Math.imul(M,Ke)|0,f=f+Math.imul(M,wt)|0,f=f+Math.imul(J,Ke)|0,R=R+Math.imul(J,wt)|0,y=y+Math.imul(G,Ye)|0,f=f+Math.imul(G,It)|0,f=f+Math.imul(Y,Ye)|0,R=R+Math.imul(Y,It)|0,y=y+Math.imul(q,tt)|0,f=f+Math.imul(q,kt)|0,f=f+Math.imul(F,tt)|0,R=R+Math.imul(F,kt)|0;var Qn=(P+y|0)+((f&8191)<<13)|0;P=(R+(f>>>13)|0)+(Qn>>>26)|0,Qn&=67108863,y=Math.imul(ce,Ve),f=Math.imul(ce,ot),f=f+Math.imul(ue,Ve)|0,R=Math.imul(ue,ot),y=y+Math.imul(re,ut)|0,f=f+Math.imul(re,lr)|0,f=f+Math.imul(ne,ut)|0,R=R+Math.imul(ne,lr)|0,y=y+Math.imul(Re,pt)|0,f=f+Math.imul(Re,br)|0,f=f+Math.imul(Ne,pt)|0,R=R+Math.imul(Ne,br)|0,y=y+Math.imul(he,Ke)|0,f=f+Math.imul(he,wt)|0,f=f+Math.imul(Se,Ke)|0,R=R+Math.imul(Se,wt)|0,y=y+Math.imul(M,Ye)|0,f=f+Math.imul(M,It)|0,f=f+Math.imul(J,Ye)|0,R=R+Math.imul(J,It)|0,y=y+Math.imul(G,tt)|0,f=f+Math.imul(G,kt)|0,f=f+Math.imul(Y,tt)|0,R=R+Math.imul(Y,kt)|0,y=y+Math.imul(q,rt)|0,f=f+Math.imul(q,xt)|0,f=f+Math.imul(F,rt)|0,R=R+Math.imul(F,xt)|0;var Nd=(P+y|0)+((f&8191)<<13)|0;P=(R+(f>>>13)|0)+(Nd>>>26)|0,Nd&=67108863,y=Math.imul(ye,Ve),f=Math.imul(ye,ot),f=f+Math.imul(Le,Ve)|0,R=Math.imul(Le,ot),y=y+Math.imul(ce,ut)|0,f=f+Math.imul(ce,lr)|0,f=f+Math.imul(ue,ut)|0,R=R+Math.imul(ue,lr)|0,y=y+Math.imul(re,pt)|0,f=f+Math.imul(re,br)|0,f=f+Math.imul(ne,pt)|0,R=R+Math.imul(ne,br)|0,y=y+Math.imul(Re,Ke)|0,f=f+Math.imul(Re,wt)|0,f=f+Math.imul(Ne,Ke)|0,R=R+Math.imul(Ne,wt)|0,y=y+Math.imul(he,Ye)|0,f=f+Math.imul(he,It)|0,f=f+Math.imul(Se,Ye)|0,R=R+Math.imul(Se,It)|0,y=y+Math.imul(M,tt)|0,f=f+Math.imul(M,kt)|0,f=f+Math.imul(J,tt)|0,R=R+Math.imul(J,kt)|0,y=y+Math.imul(G,rt)|0,f=f+Math.imul(G,xt)|0,f=f+Math.imul(Y,rt)|0,R=R+Math.imul(Y,xt)|0,y=y+Math.imul(q,Je)|0,f=f+Math.imul(q,gt)|0,f=f+Math.imul(F,Je)|0,R=R+Math.imul(F,gt)|0;var Dd=(P+y|0)+((f&8191)<<13)|0;P=(R+(f>>>13)|0)+(Dd>>>26)|0,Dd&=67108863,y=Math.imul(Pe,Ve),f=Math.imul(Pe,ot),f=f+Math.imul(Qe,Ve)|0,R=Math.imul(Qe,ot),y=y+Math.imul(ye,ut)|0,f=f+Math.imul(ye,lr)|0,f=f+Math.imul(Le,ut)|0,R=R+Math.imul(Le,lr)|0,y=y+Math.imul(ce,pt)|0,f=f+Math.imul(ce,br)|0,f=f+Math.imul(ue,pt)|0,R=R+Math.imul(ue,br)|0,y=y+Math.imul(re,Ke)|0,f=f+Math.imul(re,wt)|0,f=f+Math.imul(ne,Ke)|0,R=R+Math.imul(ne,wt)|0,y=y+Math.imul(Re,Ye)|0,f=f+Math.imul(Re,It)|0,f=f+Math.imul(Ne,Ye)|0,R=R+Math.imul(Ne,It)|0,y=y+Math.imul(he,tt)|0,f=f+Math.imul(he,kt)|0,f=f+Math.imul(Se,tt)|0,R=R+Math.imul(Se,kt)|0,y=y+Math.imul(M,rt)|0,f=f+Math.imul(M,xt)|0,f=f+Math.imul(J,rt)|0,R=R+Math.imul(J,xt)|0,y=y+Math.imul(G,Je)|0,f=f+Math.imul(G,gt)|0,f=f+Math.imul(Y,Je)|0,R=R+Math.imul(Y,gt)|0,y=y+Math.imul(q,nt)|0,f=f+Math.imul(q,Mr)|0,f=f+Math.imul(F,nt)|0,R=R+Math.imul(F,Mr)|0;var Pd=(P+y|0)+((f&8191)<<13)|0;P=(R+(f>>>13)|0)+(Pd>>>26)|0,Pd&=67108863,y=Math.imul(Ue,Ve),f=Math.imul(Ue,ot),f=f+Math.imul(st,Ve)|0,R=Math.imul(st,ot),y=y+Math.imul(Pe,ut)|0,f=f+Math.imul(Pe,lr)|0,f=f+Math.imul(Qe,ut)|0,R=R+Math.imul(Qe,lr)|0,y=y+Math.imul(ye,pt)|0,f=f+Math.imul(ye,br)|0,f=f+Math.imul(Le,pt)|0,R=R+Math.imul(Le,br)|0,y=y+Math.imul(ce,Ke)|0,f=f+Math.imul(ce,wt)|0,f=f+Math.imul(ue,Ke)|0,R=R+Math.imul(ue,wt)|0,y=y+Math.imul(re,Ye)|0,f=f+Math.imul(re,It)|0,f=f+Math.imul(ne,Ye)|0,R=R+Math.imul(ne,It)|0,y=y+Math.imul(Re,tt)|0,f=f+Math.imul(Re,kt)|0,f=f+Math.imul(Ne,tt)|0,R=R+Math.imul(Ne,kt)|0,y=y+Math.imul(he,rt)|0,f=f+Math.imul(he,xt)|0,f=f+Math.imul(Se,rt)|0,R=R+Math.imul(Se,xt)|0,y=y+Math.imul(M,Je)|0,f=f+Math.imul(M,gt)|0,f=f+Math.imul(J,Je)|0,R=R+Math.imul(J,gt)|0,y=y+Math.imul(G,nt)|0,f=f+Math.imul(G,Mr)|0,f=f+Math.imul(Y,nt)|0,R=R+Math.imul(Y,Mr)|0,y=y+Math.imul(q,Nt)|0,f=f+Math.imul(q,sr)|0,f=f+Math.imul(F,Nt)|0,R=R+Math.imul(F,sr)|0;var kd=(P+y|0)+((f&8191)<<13)|0;P=(R+(f>>>13)|0)+(kd>>>26)|0,kd&=67108863,y=Math.imul(Ue,ut),f=Math.imul(Ue,lr),f=f+Math.imul(st,ut)|0,R=Math.imul(st,lr),y=y+Math.imul(Pe,pt)|0,f=f+Math.imul(Pe,br)|0,f=f+Math.imul(Qe,pt)|0,R=R+Math.imul(Qe,br)|0,y=y+Math.imul(ye,Ke)|0,f=f+Math.imul(ye,wt)|0,f=f+Math.imul(Le,Ke)|0,R=R+Math.imul(Le,wt)|0,y=y+Math.imul(ce,Ye)|0,f=f+Math.imul(ce,It)|0,f=f+Math.imul(ue,Ye)|0,R=R+Math.imul(ue,It)|0,y=y+Math.imul(re,tt)|0,f=f+Math.imul(re,kt)|0,f=f+Math.imul(ne,tt)|0,R=R+Math.imul(ne,kt)|0,y=y+Math.imul(Re,rt)|0,f=f+Math.imul(Re,xt)|0,f=f+Math.imul(Ne,rt)|0,R=R+Math.imul(Ne,xt)|0,y=y+Math.imul(he,Je)|0,f=f+Math.imul(he,gt)|0,f=f+Math.imul(Se,Je)|0,R=R+Math.imul(Se,gt)|0,y=y+Math.imul(M,nt)|0,f=f+Math.imul(M,Mr)|0,f=f+Math.imul(J,nt)|0,R=R+Math.imul(J,Mr)|0,y=y+Math.imul(G,Nt)|0,f=f+Math.imul(G,sr)|0,f=f+Math.imul(Y,Nt)|0,R=R+Math.imul(Y,sr)|0;var Ld=(P+y|0)+((f&8191)<<13)|0;P=(R+(f>>>13)|0)+(Ld>>>26)|0,Ld&=67108863,y=Math.imul(Ue,pt),f=Math.imul(Ue,br),f=f+Math.imul(st,pt)|0,R=Math.imul(st,br),y=y+Math.imul(Pe,Ke)|0,f=f+Math.imul(Pe,wt)|0,f=f+Math.imul(Qe,Ke)|0,R=R+Math.imul(Qe,wt)|0,y=y+Math.imul(ye,Ye)|0,f=f+Math.imul(ye,It)|0,f=f+Math.imul(Le,Ye)|0,R=R+Math.imul(Le,It)|0,y=y+Math.imul(ce,tt)|0,f=f+Math.imul(ce,kt)|0,f=f+Math.imul(ue,tt)|0,R=R+Math.imul(ue,kt)|0,y=y+Math.imul(re,rt)|0,f=f+Math.imul(re,xt)|0,f=f+Math.imul(ne,rt)|0,R=R+Math.imul(ne,xt)|0,y=y+Math.imul(Re,Je)|0,f=f+Math.imul(Re,gt)|0,f=f+Math.imul(Ne,Je)|0,R=R+Math.imul(Ne,gt)|0,y=y+Math.imul(he,nt)|0,f=f+Math.imul(he,Mr)|0,f=f+Math.imul(Se,nt)|0,R=R+Math.imul(Se,Mr)|0,y=y+Math.imul(M,Nt)|0,f=f+Math.imul(M,sr)|0,f=f+Math.imul(J,Nt)|0,R=R+Math.imul(J,sr)|0;var Xo=(P+y|0)+((f&8191)<<13)|0;P=(R+(f>>>13)|0)+(Xo>>>26)|0,Xo&=67108863,y=Math.imul(Ue,Ke),f=Math.imul(Ue,wt),f=f+Math.imul(st,Ke)|0,R=Math.imul(st,wt),y=y+Math.imul(Pe,Ye)|0,f=f+Math.imul(Pe,It)|0,f=f+Math.imul(Qe,Ye)|0,R=R+Math.imul(Qe,It)|0,y=y+Math.imul(ye,tt)|0,f=f+Math.imul(ye,kt)|0,f=f+Math.imul(Le,tt)|0,R=R+Math.imul(Le,kt)|0,y=y+Math.imul(ce,rt)|0,f=f+Math.imul(ce,xt)|0,f=f+Math.imul(ue,rt)|0,R=R+Math.imul(ue,xt)|0,y=y+Math.imul(re,Je)|0,f=f+Math.imul(re,gt)|0,f=f+Math.imul(ne,Je)|0,R=R+Math.imul(ne,gt)|0,y=y+Math.imul(Re,nt)|0,f=f+Math.imul(Re,Mr)|0,f=f+Math.imul(Ne,nt)|0,R=R+Math.imul(Ne,Mr)|0,y=y+Math.imul(he,Nt)|0,f=f+Math.imul(he,sr)|0,f=f+Math.imul(Se,Nt)|0,R=R+Math.imul(Se,sr)|0;var xd=(P+y|0)+((f&8191)<<13)|0;P=(R+(f>>>13)|0)+(xd>>>26)|0,xd&=67108863,y=Math.imul(Ue,Ye),f=Math.imul(Ue,It),f=f+Math.imul(st,Ye)|0,R=Math.imul(st,It),y=y+Math.imul(Pe,tt)|0,f=f+Math.imul(Pe,kt)|0,f=f+Math.imul(Qe,tt)|0,R=R+Math.imul(Qe,kt)|0,y=y+Math.imul(ye,rt)|0,f=f+Math.imul(ye,xt)|0,f=f+Math.imul(Le,rt)|0,R=R+Math.imul(Le,xt)|0,y=y+Math.imul(ce,Je)|0,f=f+Math.imul(ce,gt)|0,f=f+Math.imul(ue,Je)|0,R=R+Math.imul(ue,gt)|0,y=y+Math.imul(re,nt)|0,f=f+Math.imul(re,Mr)|0,f=f+Math.imul(ne,nt)|0,R=R+Math.imul(ne,Mr)|0,y=y+Math.imul(Re,Nt)|0,f=f+Math.imul(Re,sr)|0,f=f+Math.imul(Ne,Nt)|0,R=R+Math.imul(Ne,sr)|0;var Md=(P+y|0)+((f&8191)<<13)|0;P=(R+(f>>>13)|0)+(Md>>>26)|0,Md&=67108863,y=Math.imul(Ue,tt),f=Math.imul(Ue,kt),f=f+Math.imul(st,tt)|0,R=Math.imul(st,kt),y=y+Math.imul(Pe,rt)|0,f=f+Math.imul(Pe,xt)|0,f=f+Math.imul(Qe,rt)|0,R=R+Math.imul(Qe,xt)|0,y=y+Math.imul(ye,Je)|0,f=f+Math.imul(ye,gt)|0,f=f+Math.imul(Le,Je)|0,R=R+Math.imul(Le,gt)|0,y=y+Math.imul(ce,nt)|0,f=f+Math.imul(ce,Mr)|0,f=f+Math.imul(ue,nt)|0,R=R+Math.imul(ue,Mr)|0,y=y+Math.imul(re,Nt)|0,f=f+Math.imul(re,sr)|0,f=f+Math.imul(ne,Nt)|0,R=R+Math.imul(ne,sr)|0;var qi=(P+y|0)+((f&8191)<<13)|0;P=(R+(f>>>13)|0)+(qi>>>26)|0,qi&=67108863,y=Math.imul(Ue,rt),f=Math.imul(Ue,xt),f=f+Math.imul(st,rt)|0,R=Math.imul(st,xt),y=y+Math.imul(Pe,Je)|0,f=f+Math.imul(Pe,gt)|0,f=f+Math.imul(Qe,Je)|0,R=R+Math.imul(Qe,gt)|0,y=y+Math.imul(ye,nt)|0,f=f+Math.imul(ye,Mr)|0,f=f+Math.imul(Le,nt)|0,R=R+Math.imul(Le,Mr)|0,y=y+Math.imul(ce,Nt)|0,f=f+Math.imul(ce,sr)|0,f=f+Math.imul(ue,Nt)|0,R=R+Math.imul(ue,sr)|0;var Ud=(P+y|0)+((f&8191)<<13)|0;P=(R+(f>>>13)|0)+(Ud>>>26)|0,Ud&=67108863,y=Math.imul(Ue,Je),f=Math.imul(Ue,gt),f=f+Math.imul(st,Je)|0,R=Math.imul(st,gt),y=y+Math.imul(Pe,nt)|0,f=f+Math.imul(Pe,Mr)|0,f=f+Math.imul(Qe,nt)|0,R=R+Math.imul(Qe,Mr)|0,y=y+Math.imul(ye,Nt)|0,f=f+Math.imul(ye,sr)|0,f=f+Math.imul(Le,Nt)|0,R=R+Math.imul(Le,sr)|0;var jd=(P+y|0)+((f&8191)<<13)|0;P=(R+(f>>>13)|0)+(jd>>>26)|0,jd&=67108863,y=Math.imul(Ue,nt),f=Math.imul(Ue,Mr),f=f+Math.imul(st,nt)|0,R=Math.imul(st,Mr),y=y+Math.imul(Pe,Nt)|0,f=f+Math.imul(Pe,sr)|0,f=f+Math.imul(Qe,Nt)|0,R=R+Math.imul(Qe,sr)|0;var Fd=(P+y|0)+((f&8191)<<13)|0;P=(R+(f>>>13)|0)+(Fd>>>26)|0,Fd&=67108863,y=Math.imul(Ue,Nt),f=Math.imul(Ue,sr),f=f+Math.imul(st,Nt)|0,R=Math.imul(st,sr);var M0=(P+y|0)+((f&8191)<<13)|0;return P=(R+(f>>>13)|0)+(M0>>>26)|0,M0&=67108863,k[0]=Ls,k[1]=xs,k[2]=Ms,k[3]=Us,k[4]=js,k[5]=Qn,k[6]=Nd,k[7]=Dd,k[8]=Pd,k[9]=kd,k[10]=Ld,k[11]=Xo,k[12]=xd,k[13]=Md,k[14]=qi,k[15]=Ud,k[16]=jd,k[17]=Fd,k[18]=M0,P!==0&&(k[19]=P,T.length++),T};Math.imul||(v=b);function I(m,S,T){T.negative=S.negative^m.negative,T.length=m.length+S.length;for(var x=0,D=0,k=0;k<T.length-1;k++){var P=D;D=0;for(var y=x&67108863,f=Math.min(k,S.length-1),R=Math.max(0,k-m.length+1);R<=f;R++){var B=k-R,q=m.words[B]|0,F=S.words[R]|0,te=q*F,G=te&67108863;P=P+(te/67108864|0)|0,G=G+y|0,y=G&67108863,P=P+(G>>>26)|0,D+=P>>>26,P&=67108863}T.words[k]=y,x=P,P=D}return x!==0?T.words[k]=x:T.length--,T._strip()}function N(m,S,T){return I(m,S,T)}s.prototype.mulTo=function(m,S){var T,x=this.length+m.length;return this.length===10&&m.length===10?T=v(this,m,S):x<63?T=b(this,m,S):x<1024?T=I(this,m,S):T=N(this,m,S),T},s.prototype.mul=function(m){var S=new s(null);return S.words=new Array(this.length+m.length),this.mulTo(m,S)},s.prototype.mulf=function(m){var S=new s(null);return S.words=new Array(this.length+m.length),N(this,m,S)},s.prototype.imul=function(m){return this.clone().mulTo(m,this)},s.prototype.imuln=function(m){var S=m<0;S&&(m=-m),n(typeof m=="number"),n(m<67108864);for(var T=0,x=0;x<this.length;x++){var D=(this.words[x]|0)*m,k=(D&67108863)+(T&67108863);T>>=26,T+=D/67108864|0,T+=k>>>26,this.words[x]=k&67108863}return T!==0&&(this.words[x]=T,this.length++),S?this.ineg():this},s.prototype.muln=function(m){return this.clone().imuln(m)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.imul(this.clone())},s.prototype.pow=function(m){var S=E(m);if(S.length===0)return new s(1);for(var T=this,x=0;x<S.length&&S[x]===0;x++,T=T.sqr());if(++x<S.length)for(var D=T.sqr();x<S.length;x++,D=D.sqr())S[x]!==0&&(T=T.mul(D));return T},s.prototype.iushln=function(m){n(typeof m=="number"&&m>=0);var S=m%26,T=(m-S)/26,x=67108863>>>26-S<<26-S,D;if(S!==0){var k=0;for(D=0;D<this.length;D++){var P=this.words[D]&x,y=(this.words[D]|0)-P<<S;this.words[D]=y|k,k=P>>>26-S}k&&(this.words[D]=k,this.length++)}if(T!==0){for(D=this.length-1;D>=0;D--)this.words[D+T]=this.words[D];for(D=0;D<T;D++)this.words[D]=0;this.length+=T}return this._strip()},s.prototype.ishln=function(m){return n(this.negative===0),this.iushln(m)},s.prototype.iushrn=function(m,S,T){n(typeof m=="number"&&m>=0);var x;S?x=(S-S%26)/26:x=0;var D=m%26,k=Math.min((m-D)/26,this.length),P=67108863^67108863>>>D<<D,y=T;if(x-=k,x=Math.max(0,x),y){for(var f=0;f<k;f++)y.words[f]=this.words[f];y.length=k}if(k!==0)if(this.length>k)for(this.length-=k,f=0;f<this.length;f++)this.words[f]=this.words[f+k];else this.words[0]=0,this.length=1;var R=0;for(f=this.length-1;f>=0&&(R!==0||f>=x);f--){var B=this.words[f]|0;this.words[f]=R<<26-D|B>>>D,R=B&P}return y&&R!==0&&(y.words[y.length++]=R),this.length===0&&(this.words[0]=0,this.length=1),this._strip()},s.prototype.ishrn=function(m,S,T){return n(this.negative===0),this.iushrn(m,S,T)},s.prototype.shln=function(m){return this.clone().ishln(m)},s.prototype.ushln=function(m){return this.clone().iushln(m)},s.prototype.shrn=function(m){return this.clone().ishrn(m)},s.prototype.ushrn=function(m){return this.clone().iushrn(m)},s.prototype.testn=function(m){n(typeof m=="number"&&m>=0);var S=m%26,T=(m-S)/26,x=1<<S;if(this.length<=T)return!1;var D=this.words[T];return!!(D&x)},s.prototype.imaskn=function(m){n(typeof m=="number"&&m>=0);var S=m%26,T=(m-S)/26;if(n(this.negative===0,"imaskn works only with positive numbers"),this.length<=T)return this;if(S!==0&&T++,this.length=Math.min(T,this.length),S!==0){var x=67108863^67108863>>>S<<S;this.words[this.length-1]&=x}return this._strip()},s.prototype.maskn=function(m){return this.clone().imaskn(m)},s.prototype.iaddn=function(m){return n(typeof m=="number"),n(m<67108864),m<0?this.isubn(-m):this.negative!==0?this.length===1&&(this.words[0]|0)<=m?(this.words[0]=m-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(m),this.negative=1,this):this._iaddn(m)},s.prototype._iaddn=function(m){this.words[0]+=m;for(var S=0;S<this.length&&this.words[S]>=67108864;S++)this.words[S]-=67108864,S===this.length-1?this.words[S+1]=1:this.words[S+1]++;return this.length=Math.max(this.length,S+1),this},s.prototype.isubn=function(m){if(n(typeof m=="number"),n(m<67108864),m<0)return this.iaddn(-m);if(this.negative!==0)return this.negative=0,this.iaddn(m),this.negative=1,this;if(this.words[0]-=m,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var S=0;S<this.length&&this.words[S]<0;S++)this.words[S]+=67108864,this.words[S+1]-=1;return this._strip()},s.prototype.addn=function(m){return this.clone().iaddn(m)},s.prototype.subn=function(m){return this.clone().isubn(m)},s.prototype.iabs=function(){return this.negative=0,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(m,S,T){var x=m.length+T,D;this._expand(x);var k,P=0;for(D=0;D<m.length;D++){k=(this.words[D+T]|0)+P;var y=(m.words[D]|0)*S;k-=y&67108863,P=(k>>26)-(y/67108864|0),this.words[D+T]=k&67108863}for(;D<this.length-T;D++)k=(this.words[D+T]|0)+P,P=k>>26,this.words[D+T]=k&67108863;if(P===0)return this._strip();for(n(P===-1),P=0,D=0;D<this.length;D++)k=-(this.words[D]|0)+P,P=k>>26,this.words[D]=k&67108863;return this.negative=1,this._strip()},s.prototype._wordDiv=function(m,S){var T=this.length-m.length,x=this.clone(),D=m,k=D.words[D.length-1]|0,P=this._countBits(k);T=26-P,T!==0&&(D=D.ushln(T),x.iushln(T),k=D.words[D.length-1]|0);var y=x.length-D.length,f;if(S!=="mod"){f=new s(null),f.length=y+1,f.words=new Array(f.length);for(var R=0;R<f.length;R++)f.words[R]=0}var B=x.clone()._ishlnsubmul(D,1,y);B.negative===0&&(x=B,f&&(f.words[y]=1));for(var q=y-1;q>=0;q--){var F=(x.words[D.length+q]|0)*67108864+(x.words[D.length+q-1]|0);for(F=Math.min(F/k|0,67108863),x._ishlnsubmul(D,F,q);x.negative!==0;)F--,x.negative=0,x._ishlnsubmul(D,1,q),x.isZero()||(x.negative^=1);f&&(f.words[q]=F)}return f&&f._strip(),x._strip(),S!=="div"&&T!==0&&x.iushrn(T),{div:f||null,mod:x}},s.prototype.divmod=function(m,S,T){if(n(!m.isZero()),this.isZero())return{div:new s(0),mod:new s(0)};var x,D,k;return this.negative!==0&&m.negative===0?(k=this.neg().divmod(m,S),S!=="mod"&&(x=k.div.neg()),S!=="div"&&(D=k.mod.neg(),T&&D.negative!==0&&D.iadd(m)),{div:x,mod:D}):this.negative===0&&m.negative!==0?(k=this.divmod(m.neg(),S),S!=="mod"&&(x=k.div.neg()),{div:x,mod:k.mod}):this.negative&m.negative?(k=this.neg().divmod(m.neg(),S),S!=="div"&&(D=k.mod.neg(),T&&D.negative!==0&&D.isub(m)),{div:k.div,mod:D}):m.length>this.length||this.cmp(m)<0?{div:new s(0),mod:this}:m.length===1?S==="div"?{div:this.divn(m.words[0]),mod:null}:S==="mod"?{div:null,mod:new s(this.modrn(m.words[0]))}:{div:this.divn(m.words[0]),mod:new s(this.modrn(m.words[0]))}:this._wordDiv(m,S)},s.prototype.div=function(m){return this.divmod(m,"div",!1).div},s.prototype.mod=function(m){return this.divmod(m,"mod",!1).mod},s.prototype.umod=function(m){return this.divmod(m,"mod",!0).mod},s.prototype.divRound=function(m){var S=this.divmod(m);if(S.mod.isZero())return S.div;var T=S.div.negative!==0?S.mod.isub(m):S.mod,x=m.ushrn(1),D=m.andln(1),k=T.cmp(x);return k<0||D===1&&k===0?S.div:S.div.negative!==0?S.div.isubn(1):S.div.iaddn(1)},s.prototype.modrn=function(m){var S=m<0;S&&(m=-m),n(m<=67108863);for(var T=(1<<26)%m,x=0,D=this.length-1;D>=0;D--)x=(T*x+(this.words[D]|0))%m;return S?-x:x},s.prototype.modn=function(m){return this.modrn(m)},s.prototype.idivn=function(m){var S=m<0;S&&(m=-m),n(m<=67108863);for(var T=0,x=this.length-1;x>=0;x--){var D=(this.words[x]|0)+T*67108864;this.words[x]=D/m|0,T=D%m}return this._strip(),S?this.ineg():this},s.prototype.divn=function(m){return this.clone().idivn(m)},s.prototype.egcd=function(m){n(m.negative===0),n(!m.isZero());var S=this,T=m.clone();S.negative!==0?S=S.umod(m):S=S.clone();for(var x=new s(1),D=new s(0),k=new s(0),P=new s(1),y=0;S.isEven()&&T.isEven();)S.iushrn(1),T.iushrn(1),++y;for(var f=T.clone(),R=S.clone();!S.isZero();){for(var B=0,q=1;!(S.words[0]&q)&&B<26;++B,q<<=1);if(B>0)for(S.iushrn(B);B-- >0;)(x.isOdd()||D.isOdd())&&(x.iadd(f),D.isub(R)),x.iushrn(1),D.iushrn(1);for(var F=0,te=1;!(T.words[0]&te)&&F<26;++F,te<<=1);if(F>0)for(T.iushrn(F);F-- >0;)(k.isOdd()||P.isOdd())&&(k.iadd(f),P.isub(R)),k.iushrn(1),P.iushrn(1);S.cmp(T)>=0?(S.isub(T),x.isub(k),D.isub(P)):(T.isub(S),k.isub(x),P.isub(D))}return{a:k,b:P,gcd:T.iushln(y)}},s.prototype._invmp=function(m){n(m.negative===0),n(!m.isZero());var S=this,T=m.clone();S.negative!==0?S=S.umod(m):S=S.clone();for(var x=new s(1),D=new s(0),k=T.clone();S.cmpn(1)>0&&T.cmpn(1)>0;){for(var P=0,y=1;!(S.words[0]&y)&&P<26;++P,y<<=1);if(P>0)for(S.iushrn(P);P-- >0;)x.isOdd()&&x.iadd(k),x.iushrn(1);for(var f=0,R=1;!(T.words[0]&R)&&f<26;++f,R<<=1);if(f>0)for(T.iushrn(f);f-- >0;)D.isOdd()&&D.iadd(k),D.iushrn(1);S.cmp(T)>=0?(S.isub(T),x.isub(D)):(T.isub(S),D.isub(x))}var B;return S.cmpn(1)===0?B=x:B=D,B.cmpn(0)<0&&B.iadd(m),B},s.prototype.gcd=function(m){if(this.isZero())return m.abs();if(m.isZero())return this.abs();var S=this.clone(),T=m.clone();S.negative=0,T.negative=0;for(var x=0;S.isEven()&&T.isEven();x++)S.iushrn(1),T.iushrn(1);do{for(;S.isEven();)S.iushrn(1);for(;T.isEven();)T.iushrn(1);var D=S.cmp(T);if(D<0){var k=S;S=T,T=k}else if(D===0||T.cmpn(1)===0)break;S.isub(T)}while(!0);return T.iushln(x)},s.prototype.invm=function(m){return this.egcd(m).a.umod(m)},s.prototype.isEven=function(){return(this.words[0]&1)===0},s.prototype.isOdd=function(){return(this.words[0]&1)===1},s.prototype.andln=function(m){return this.words[0]&m},s.prototype.bincn=function(m){n(typeof m=="number");var S=m%26,T=(m-S)/26,x=1<<S;if(this.length<=T)return this._expand(T+1),this.words[T]|=x,this;for(var D=x,k=T;D!==0&&k<this.length;k++){var P=this.words[k]|0;P+=D,D=P>>>26,P&=67108863,this.words[k]=P}return D!==0&&(this.words[k]=D,this.length++),this},s.prototype.isZero=function(){return this.length===1&&this.words[0]===0},s.prototype.cmpn=function(m){var S=m<0;if(this.negative!==0&&!S)return-1;if(this.negative===0&&S)return 1;this._strip();var T;if(this.length>1)T=1;else{S&&(m=-m),n(m<=67108863,"Number is too big");var x=this.words[0]|0;T=x===m?0:x<m?-1:1}return this.negative!==0?-T|0:T},s.prototype.cmp=function(m){if(this.negative!==0&&m.negative===0)return-1;if(this.negative===0&&m.negative!==0)return 1;var S=this.ucmp(m);return this.negative!==0?-S|0:S},s.prototype.ucmp=function(m){if(this.length>m.length)return 1;if(this.length<m.length)return-1;for(var S=0,T=this.length-1;T>=0;T--){var x=this.words[T]|0,D=m.words[T]|0;if(x!==D){x<D?S=-1:x>D&&(S=1);break}}return S},s.prototype.gtn=function(m){return this.cmpn(m)===1},s.prototype.gt=function(m){return this.cmp(m)===1},s.prototype.gten=function(m){return this.cmpn(m)>=0},s.prototype.gte=function(m){return this.cmp(m)>=0},s.prototype.ltn=function(m){return this.cmpn(m)===-1},s.prototype.lt=function(m){return this.cmp(m)===-1},s.prototype.lten=function(m){return this.cmpn(m)<=0},s.prototype.lte=function(m){return this.cmp(m)<=0},s.prototype.eqn=function(m){return this.cmpn(m)===0},s.prototype.eq=function(m){return this.cmp(m)===0},s.red=function(m){return new H(m)},s.prototype.toRed=function(m){return n(!this.red,"Already a number in reduction context"),n(this.negative===0,"red works only with positives"),m.convertTo(this)._forceRed(m)},s.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(m){return this.red=m,this},s.prototype.forceRed=function(m){return n(!this.red,"Already a number in reduction context"),this._forceRed(m)},s.prototype.redAdd=function(m){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,m)},s.prototype.redIAdd=function(m){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,m)},s.prototype.redSub=function(m){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,m)},s.prototype.redISub=function(m){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,m)},s.prototype.redShl=function(m){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,m)},s.prototype.redMul=function(m){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,m),this.red.mul(this,m)},s.prototype.redIMul=function(m){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,m),this.red.imul(this,m)},s.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(m){return n(this.red&&!m.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,m)};var L={k256:null,p224:null,p192:null,p25519:null};function U(m,S){this.name=m,this.p=new s(S,16),this.n=this.p.bitLength(),this.k=new s(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}U.prototype._tmp=function(){var m=new s(null);return m.words=new Array(Math.ceil(this.n/13)),m},U.prototype.ireduce=function(m){var S=m,T;do this.split(S,this.tmp),S=this.imulK(S),S=S.iadd(this.tmp),T=S.bitLength();while(T>this.n);var x=T<this.n?-1:S.ucmp(this.p);return x===0?(S.words[0]=0,S.length=1):x>0?S.isub(this.p):S.strip!==void 0?S.strip():S._strip(),S},U.prototype.split=function(m,S){m.iushrn(this.n,0,S)},U.prototype.imulK=function(m){return m.imul(this.k)};function w(){U.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}i(w,U),w.prototype.split=function(m,S){for(var T=4194303,x=Math.min(m.length,9),D=0;D<x;D++)S.words[D]=m.words[D];if(S.length=x,m.length<=9){m.words[0]=0,m.length=1;return}var k=m.words[9];for(S.words[S.length++]=k&T,D=10;D<m.length;D++){var P=m.words[D]|0;m.words[D-10]=(P&T)<<4|k>>>22,k=P}k>>>=22,m.words[D-10]=k,k===0&&m.length>10?m.length-=10:m.length-=9},w.prototype.imulK=function(m){m.words[m.length]=0,m.words[m.length+1]=0,m.length+=2;for(var S=0,T=0;T<m.length;T++){var x=m.words[T]|0;S+=x*977,m.words[T]=S&67108863,S=x*64+(S/67108864|0)}return m.words[m.length-1]===0&&(m.length--,m.words[m.length-1]===0&&m.length--),m};function V(){U.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}i(V,U);function z(){U.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}i(z,U);function K(){U.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}i(K,U),K.prototype.imulK=function(m){for(var S=0,T=0;T<m.length;T++){var x=(m.words[T]|0)*19+S,D=x&67108863;x>>>=26,m.words[T]=D,S=x}return S!==0&&(m.words[m.length++]=S),m},s._prime=function(m){if(L[m])return L[m];var S;if(m==="k256")S=new w;else if(m==="p224")S=new V;else if(m==="p192")S=new z;else if(m==="p25519")S=new K;else throw new Error("Unknown prime "+m);return L[m]=S,S};function H(m){if(typeof m=="string"){var S=s._prime(m);this.m=S.p,this.prime=S}else n(m.gtn(1),"modulus must be greater than 1"),this.m=m,this.prime=null}H.prototype._verify1=function(m){n(m.negative===0,"red works only with positives"),n(m.red,"red works only with red numbers")},H.prototype._verify2=function(m,S){n((m.negative|S.negative)===0,"red works only with positives"),n(m.red&&m.red===S.red,"red works only with red numbers")},H.prototype.imod=function(m){return this.prime?this.prime.ireduce(m)._forceRed(this):(l(m,m.umod(this.m)._forceRed(this)),m)},H.prototype.neg=function(m){return m.isZero()?m.clone():this.m.sub(m)._forceRed(this)},H.prototype.add=function(m,S){this._verify2(m,S);var T=m.add(S);return T.cmp(this.m)>=0&&T.isub(this.m),T._forceRed(this)},H.prototype.iadd=function(m,S){this._verify2(m,S);var T=m.iadd(S);return T.cmp(this.m)>=0&&T.isub(this.m),T},H.prototype.sub=function(m,S){this._verify2(m,S);var T=m.sub(S);return T.cmpn(0)<0&&T.iadd(this.m),T._forceRed(this)},H.prototype.isub=function(m,S){this._verify2(m,S);var T=m.isub(S);return T.cmpn(0)<0&&T.iadd(this.m),T},H.prototype.shl=function(m,S){return this._verify1(m),this.imod(m.ushln(S))},H.prototype.imul=function(m,S){return this._verify2(m,S),this.imod(m.imul(S))},H.prototype.mul=function(m,S){return this._verify2(m,S),this.imod(m.mul(S))},H.prototype.isqr=function(m){return this.imul(m,m.clone())},H.prototype.sqr=function(m){return this.mul(m,m)},H.prototype.sqrt=function(m){if(m.isZero())return m.clone();var S=this.m.andln(3);if(n(S%2===1),S===3){var T=this.m.add(new s(1)).iushrn(2);return this.pow(m,T)}for(var x=this.m.subn(1),D=0;!x.isZero()&&x.andln(1)===0;)D++,x.iushrn(1);n(!x.isZero());var k=new s(1).toRed(this),P=k.redNeg(),y=this.m.subn(1).iushrn(1),f=this.m.bitLength();for(f=new s(2*f*f).toRed(this);this.pow(f,y).cmp(P)!==0;)f.redIAdd(P);for(var R=this.pow(f,x),B=this.pow(m,x.addn(1).iushrn(1)),q=this.pow(m,x),F=D;q.cmp(k)!==0;){for(var te=q,G=0;te.cmp(k)!==0;G++)te=te.redSqr();n(G<F);var Y=this.pow(R,new s(1).iushln(F-G-1));B=B.redMul(Y),R=Y.redSqr(),q=q.redMul(R),F=G}return B},H.prototype.invm=function(m){var S=m._invmp(this.m);return S.negative!==0?(S.negative=0,this.imod(S).redNeg()):this.imod(S)},H.prototype.pow=function(m,S){if(S.isZero())return new s(1).toRed(this);if(S.cmpn(1)===0)return m.clone();var T=4,x=new Array(1<<T);x[0]=new s(1).toRed(this),x[1]=m;for(var D=2;D<x.length;D++)x[D]=this.mul(x[D-1],m);var k=x[0],P=0,y=0,f=S.bitLength()%26;for(f===0&&(f=26),D=S.length-1;D>=0;D--){for(var R=S.words[D],B=f-1;B>=0;B--){var q=R>>B&1;if(k!==x[0]&&(k=this.sqr(k)),q===0&&P===0){y=0;continue}P<<=1,P|=q,y++,!(y!==T&&(D!==0||B!==0))&&(k=this.mul(k,x[P]),y=0,P=0)}f=26}return k},H.prototype.convertTo=function(m){var S=m.umod(this.m);return S===m?S.clone():S},H.prototype.convertFrom=function(m){var S=m.clone();return S.red=null,S},s.mont=function(m){return new A(m)};function A(m){H.call(this,m),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new s(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}i(A,H),A.prototype.convertTo=function(m){return this.imod(m.ushln(this.shift))},A.prototype.convertFrom=function(m){var S=this.imod(m.mul(this.rinv));return S.red=null,S},A.prototype.imul=function(m,S){if(m.isZero()||S.isZero())return m.words[0]=0,m.length=1,m;var T=m.imul(S),x=T.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),D=T.isub(x).iushrn(this.shift),k=D;return D.cmp(this.m)>=0?k=D.isub(this.m):D.cmpn(0)<0&&(k=D.iadd(this.m)),k._forceRed(this)},A.prototype.mul=function(m,S){if(m.isZero()||S.isZero())return new s(0)._forceRed(this);var T=m.mul(S),x=T.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),D=T.isub(x).iushrn(this.shift),k=D;return D.cmp(this.m)>=0?k=D.isub(this.m):D.cmpn(0)<0&&(k=D.iadd(this.m)),k._forceRed(this)},A.prototype.invm=function(m){var S=this.imod(m._invmp(this.m).mul(this.r2));return S._forceRed(this)}})(e,Pz)})(Mz);var zt=Mz.exports;const Uz="bignumber/5.7.0";var k1=zt.BN;const rl=new Bi(Uz),gR={},eM=9007199254740991;function hle(e){return e!=null&&(Os.isBigNumber(e)||typeof e=="number"&&e%1===0||typeof e=="string"&&!!e.match(/^-?[0-9]+$/)||jo(e)||typeof e=="bigint"||a0(e))}let tM=!1,Os=class Ka{constructor(t,r){t!==gR&&rl.throwError("cannot call constructor directly; use BigNumber.from",Bi.errors.UNSUPPORTED_OPERATION,{operation:"new (BigNumber)"}),this._hex=r,this._isBigNumber=!0,Object.freeze(this)}fromTwos(t){return Fs(fr(this).fromTwos(t))}toTwos(t){return Fs(fr(this).toTwos(t))}abs(){return this._hex[0]==="-"?Ka.from(this._hex.substring(1)):this}add(t){return Fs(fr(this).add(fr(t)))}sub(t){return Fs(fr(this).sub(fr(t)))}div(t){return Ka.from(t).isZero()&&ea("division-by-zero","div"),Fs(fr(this).div(fr(t)))}mul(t){return Fs(fr(this).mul(fr(t)))}mod(t){const r=fr(t);return r.isNeg()&&ea("division-by-zero","mod"),Fs(fr(this).umod(r))}pow(t){const r=fr(t);return r.isNeg()&&ea("negative-power","pow"),Fs(fr(this).pow(r))}and(t){const r=fr(t);return(this.isNegative()||r.isNeg())&&ea("unbound-bitwise-result","and"),Fs(fr(this).and(r))}or(t){const r=fr(t);return(this.isNegative()||r.isNeg())&&ea("unbound-bitwise-result","or"),Fs(fr(this).or(r))}xor(t){const r=fr(t);return(this.isNegative()||r.isNeg())&&ea("unbound-bitwise-result","xor"),Fs(fr(this).xor(r))}mask(t){return(this.isNegative()||t<0)&&ea("negative-width","mask"),Fs(fr(this).maskn(t))}shl(t){return(this.isNegative()||t<0)&&ea("negative-width","shl"),Fs(fr(this).shln(t))}shr(t){return(this.isNegative()||t<0)&&ea("negative-width","shr"),Fs(fr(this).shrn(t))}eq(t){return fr(this).eq(fr(t))}lt(t){return fr(this).lt(fr(t))}lte(t){return fr(this).lte(fr(t))}gt(t){return fr(this).gt(fr(t))}gte(t){return fr(this).gte(fr(t))}isNegative(){return this._hex[0]==="-"}isZero(){return fr(this).isZero()}toNumber(){try{return fr(this).toNumber()}catch{ea("overflow","toNumber",this.toString())}return null}toBigInt(){try{return BigInt(this.toString())}catch{}return rl.throwError("this platform does not support BigInt",Bi.errors.UNSUPPORTED_OPERATION,{value:this.toString()})}toString(){return arguments.length>0&&(arguments[0]===10?tM||(tM=!0,rl.warn("BigNumber.toString does not accept any parameters; base-10 is assumed")):arguments[0]===16?rl.throwError("BigNumber.toString does not accept any parameters; use bigNumber.toHexString()",Bi.errors.UNEXPECTED_ARGUMENT,{}):rl.throwError("BigNumber.toString does not accept parameters",Bi.errors.UNEXPECTED_ARGUMENT,{})),fr(this).toString(10)}toHexString(){return this._hex}toJSON(t){return{type:"BigNumber",hex:this.toHexString()}}static from(t){if(t instanceof Ka)return t;if(typeof t=="string")return t.match(/^-?0x[0-9a-f]+$/i)?new Ka(gR,z_(t)):t.match(/^-?[0-9]+$/)?new Ka(gR,z_(new k1(t))):rl.throwArgumentError("invalid BigNumber string","value",t);if(typeof t=="number")return t%1&&ea("underflow","BigNumber.from",t),(t>=eM||t<=-eM)&&ea("overflow","BigNumber.from",t),Ka.from(String(t));const r=t;if(typeof r=="bigint")return Ka.from(r.toString());if(a0(r))return Ka.from(Gs(r));if(r)if(r.toHexString){const n=r.toHexString();if(typeof n=="string")return Ka.from(n)}else{let n=r._hex;if(n==null&&r.type==="BigNumber"&&(n=r.hex),typeof n=="string"&&(jo(n)||n[0]==="-"&&jo(n.substring(1))))return Ka.from(n)}return rl.throwArgumentError("invalid BigNumber value","value",t)}static isBigNumber(t){return!!(t&&t._isBigNumber)}};function z_(e){if(typeof e!="string")return z_(e.toString(16));if(e[0]==="-")return e=e.substring(1),e[0]==="-"&&rl.throwArgumentError("invalid hex","value",e),e=z_(e),e==="0x00"?e:"-"+e;if(e.substring(0,2)!=="0x"&&(e="0x"+e),e==="0x")return"0x00";for(e.length%2&&(e="0x0"+e.substring(2));e.length>4&&e.substring(0,4)==="0x00";)e="0x"+e.substring(4);return e}function Fs(e){return Os.from(z_(e))}function fr(e){const t=Os.from(e).toHexString();return t[0]==="-"?new k1("-"+t.substring(3),16):new k1(t.substring(2),16)}function ea(e,t,r){const n={fault:e,operation:t};return r!=null&&(n.value=r),rl.throwError(e,Bi.errors.NUMERIC_FAULT,n)}function fle(e){return new k1(e,36).toString(16)}const Ts=new Bi(Uz),e_={},jz=Os.from(0),Fz=Os.from(-1);function Bz(e,t,r,n){const i={fault:t,operation:r};return n!==void 0&&(i.value=n),Ts.throwError(e,Bi.errors.NUMERIC_FAULT,i)}let t_="0";for(;t_.length<256;)t_+=t_;function iP(e){if(typeof e!="number")try{e=Os.from(e).toNumber()}catch{}return typeof e=="number"&&e>=0&&e<=256&&!(e%1)?"1"+t_.substring(0,e):Ts.throwArgumentError("invalid decimal size","decimals",e)}function _R(e,t){t==null&&(t=0);const r=iP(t);e=Os.from(e);const n=e.lt(jz);n&&(e=e.mul(Fz));let i=e.mod(r).toString();for(;i.length<r.length-1;)i="0"+i;i=i.match(/^([0-9]*[1-9]|0)(0*)/)[1];const s=e.div(r).toString();return r.length===1?e=s:e=s+"."+i,n&&(e="-"+e),e}function $d(e,t){t==null&&(t=0);const r=iP(t);(typeof e!="string"||!e.match(/^-?[0-9.]+$/))&&Ts.throwArgumentError("invalid decimal value","value",e);const n=e.substring(0,1)==="-";n&&(e=e.substring(1)),e==="."&&Ts.throwArgumentError("missing value","value",e);const i=e.split(".");i.length>2&&Ts.throwArgumentError("too many decimal points","value",e);let s=i[0],o=i[1];for(s||(s="0"),o||(o="0");o[o.length-1]==="0";)o=o.substring(0,o.length-1);for(o.length>r.length-1&&Bz("fractional component exceeds decimals","underflow","parseFixed"),o===""&&(o="0");o.length<r.length-1;)o+="0";const a=Os.from(s),c=Os.from(o);let d=a.mul(r).add(c);return n&&(d=d.mul(Fz)),d}let ER=class $O{constructor(t,r,n,i){t!==e_&&Ts.throwError("cannot use FixedFormat constructor; use FixedFormat.from",Bi.errors.UNSUPPORTED_OPERATION,{operation:"new FixedFormat"}),this.signed=r,this.width=n,this.decimals=i,this.name=(r?"":"u")+"fixed"+String(n)+"x"+String(i),this._multiplier=iP(i),Object.freeze(this)}static from(t){if(t instanceof $O)return t;typeof t=="number"&&(t=`fixed128x${t}`);let r=!0,n=128,i=18;if(typeof t=="string"){if(t!=="fixed")if(t==="ufixed")r=!1;else{const s=t.match(/^(u?)fixed([0-9]+)x([0-9]+)$/);s||Ts.throwArgumentError("invalid fixed format","format",t),r=s[1]!=="u",n=parseInt(s[2]),i=parseInt(s[3])}}else if(t){const s=(o,a,c)=>t[o]==null?c:(typeof t[o]!==a&&Ts.throwArgumentError("invalid fixed format ("+o+" not "+a+")","format."+o,t[o]),t[o]);r=s("signed","boolean",r),n=s("width","number",n),i=s("decimals","number",i)}return n%8&&Ts.throwArgumentError("invalid fixed format width (not byte aligned)","format.width",n),i>80&&Ts.throwArgumentError("invalid fixed format (decimals too large)","format.decimals",i),new $O(e_,r,n,i)}},Vz=class fs{constructor(t,r,n,i){t!==e_&&Ts.throwError("cannot use FixedNumber constructor; use FixedNumber.from",Bi.errors.UNSUPPORTED_OPERATION,{operation:"new FixedFormat"}),this.format=i,this._hex=r,this._value=n,this._isFixedNumber=!0,Object.freeze(this)}_checkFormat(t){this.format.name!==t.format.name&&Ts.throwArgumentError("incompatible format; use fixedNumber.toFormat","other",t)}addUnsafe(t){this._checkFormat(t);const r=$d(this._value,this.format.decimals),n=$d(t._value,t.format.decimals);return fs.fromValue(r.add(n),this.format.decimals,this.format)}subUnsafe(t){this._checkFormat(t);const r=$d(this._value,this.format.decimals),n=$d(t._value,t.format.decimals);return fs.fromValue(r.sub(n),this.format.decimals,this.format)}mulUnsafe(t){this._checkFormat(t);const r=$d(this._value,this.format.decimals),n=$d(t._value,t.format.decimals);return fs.fromValue(r.mul(n).div(this.format._multiplier),this.format.decimals,this.format)}divUnsafe(t){this._checkFormat(t);const r=$d(this._value,this.format.decimals),n=$d(t._value,t.format.decimals);return fs.fromValue(r.mul(this.format._multiplier).div(n),this.format.decimals,this.format)}floor(){const t=this.toString().split(".");t.length===1&&t.push("0");let r=fs.from(t[0],this.format);const n=!t[1].match(/^(0*)$/);return this.isNegative()&&n&&(r=r.subUnsafe(rM.toFormat(r.format))),r}ceiling(){const t=this.toString().split(".");t.length===1&&t.push("0");let r=fs.from(t[0],this.format);const n=!t[1].match(/^(0*)$/);return!this.isNegative()&&n&&(r=r.addUnsafe(rM.toFormat(r.format))),r}round(t){t==null&&(t=0);const r=this.toString().split(".");if(r.length===1&&r.push("0"),(t<0||t>80||t%1)&&Ts.throwArgumentError("invalid decimal count","decimals",t),r[1].length<=t)return this;const n=fs.from("1"+t_.substring(0,t),this.format),i=ple.toFormat(this.format);return this.mulUnsafe(n).addUnsafe(i).floor().divUnsafe(n)}isZero(){return this._value==="0.0"||this._value==="0"}isNegative(){return this._value[0]==="-"}toString(){return this._value}toHexString(t){if(t==null)return this._hex;t%8&&Ts.throwArgumentError("invalid byte width","width",t);const r=Os.from(this._hex).fromTwos(this.format.width).toTwos(t).toHexString();return sd(r,t/8)}toUnsafeFloat(){return parseFloat(this.toString())}toFormat(t){return fs.fromString(this._value,t)}static fromValue(t,r,n){return n==null&&r!=null&&!hle(r)&&(n=r,r=null),r==null&&(r=0),n==null&&(n="fixed"),fs.fromString(_R(t,r),ER.from(n))}static fromString(t,r){r==null&&(r="fixed");const n=ER.from(r),i=$d(t,n.decimals);!n.signed&&i.lt(jz)&&Bz("unsigned value cannot be negative","overflow","value",t);let s=null;n.signed?s=i.toTwos(n.width).toHexString():(s=i.toHexString(),s=sd(s,n.width/8));const o=_R(i,n.decimals);return new fs(e_,s,o,n)}static fromBytes(t,r){r==null&&(r="fixed");const n=ER.from(r);if(jn(t).length>n.width/8)throw new Error("overflow");let i=Os.from(t);n.signed&&(i=i.fromTwos(n.width));const s=i.toTwos((n.signed?0:1)+n.width).toHexString(),o=_R(i,n.decimals);return new fs(e_,s,o,n)}static from(t,r){if(typeof t=="string")return fs.fromString(t,r);if(a0(t))return fs.fromBytes(t,r);try{return fs.fromValue(t,0,r)}catch(n){if(n.code!==Bi.errors.INVALID_ARGUMENT)throw n}return Ts.throwArgumentError("invalid FixedNumber value","value",t)}static isFixedNumber(t){return!!(t&&t._isFixedNumber)}};const rM=Vz.from(1),ple=Vz.from("0.5"),mle="strings/5.7.0",gle=new Bi(mle);var L1;(function(e){e.current="",e.NFC="NFC",e.NFD="NFD",e.NFKC="NFKC",e.NFKD="NFKD"})(L1||(L1={}));var nM;(function(e){e.UNEXPECTED_CONTINUE="unexpected continuation byte",e.BAD_PREFIX="bad codepoint prefix",e.OVERRUN="string overrun",e.MISSING_CONTINUE="missing continuation byte",e.OUT_OF_RANGE="out of UTF-8 range",e.UTF16_SURROGATE="UTF-16 surrogate",e.OVERLONG="overlong representation"})(nM||(nM={}));function vR(e,t=L1.current){t!=L1.current&&(gle.checkNormalize(),e=e.normalize(t));let r=[];for(let n=0;n<e.length;n++){const i=e.charCodeAt(n);if(i<128)r.push(i);else if(i<2048)r.push(i>>6|192),r.push(i&63|128);else if((i&64512)==55296){n++;const s=e.charCodeAt(n);if(n>=e.length||(s&64512)!==56320)throw new Error("invalid utf-8 string");const o=65536+((i&1023)<<10)+(s&1023);r.push(o>>18|240),r.push(o>>12&63|128),r.push(o>>6&63|128),r.push(o&63|128)}else r.push(i>>12|224),r.push(i>>6&63|128),r.push(i&63|128)}return jn(r)}function _le(e){if(e.length%4!==0)throw new Error("bad data");let t=[];for(let r=0;r<e.length;r+=4)t.push(parseInt(e.substring(r,r+4),16));return t}function yR(e,t){t||(t=function(i){return[parseInt(i,16)]});let r=0,n={};return e.split(",").forEach(i=>{let s=i.split(":");r+=parseInt(s[0],16),n[r]=t(s[1])}),n}function iM(e){let t=0;return e.split(",").map(r=>{let n=r.split("-");n.length===1?n[1]="0":n[1]===""&&(n[1]="1");let i=t+parseInt(n[0],16);return t=parseInt(n[1],16),{l:i,h:t}})}iM("221,13-1b,5f-,40-10,51-f,11-3,3-3,2-2,2-4,8,2,15,2d,28-8,88,48,27-,3-5,11-20,27-,8,28,3-5,12,18,b-a,1c-4,6-16,2-d,2-2,2,1b-4,17-9,8f-,10,f,1f-2,1c-34,33-14e,4,36-,13-,6-2,1a-f,4,9-,3-,17,8,2-2,5-,2,8-,3-,4-8,2-3,3,6-,16-6,2-,7-3,3-,17,8,3,3,3-,2,6-3,3-,4-a,5,2-6,10-b,4,8,2,4,17,8,3,6-,b,4,4-,2-e,2-4,b-10,4,9-,3-,17,8,3-,5-,9-2,3-,4-7,3-3,3,4-3,c-10,3,7-2,4,5-2,3,2,3-2,3-2,4-2,9,4-3,6-2,4,5-8,2-e,d-d,4,9,4,18,b,6-3,8,4,5-6,3-8,3-3,b-11,3,9,4,18,b,6-3,8,4,5-6,3-6,2,3-3,b-11,3,9,4,18,11-3,7-,4,5-8,2-7,3-3,b-11,3,13-2,19,a,2-,8-2,2-3,7,2,9-11,4-b,3b-3,1e-24,3,2-,3,2-,2-5,5,8,4,2,2-,3,e,4-,6,2,7-,b-,3-21,49,23-5,1c-3,9,25,10-,2-2f,23,6,3,8-2,5-5,1b-45,27-9,2a-,2-3,5b-4,45-4,53-5,8,40,2,5-,8,2,5-,28,2,5-,20,2,5-,8,2,5-,8,8,18,20,2,5-,8,28,14-5,1d-22,56-b,277-8,1e-2,52-e,e,8-a,18-8,15-b,e,4,3-b,5e-2,b-15,10,b-5,59-7,2b-555,9d-3,5b-5,17-,7-,27-,7-,9,2,2,2,20-,36,10,f-,7,14-,4,a,54-3,2-6,6-5,9-,1c-10,13-1d,1c-14,3c-,10-6,32-b,240-30,28-18,c-14,a0,115-,3,66-,b-76,5,5-,1d,24,2,5-2,2,8-,35-2,19,f-10,1d-3,311-37f,1b,5a-b,d7-19,d-3,41,57-,68-4,29-3,5f,29-37,2e-2,25-c,2c-2,4e-3,30,78-3,64-,20,19b7-49,51a7-59,48e-2,38-738,2ba5-5b,222f-,3c-94,8-b,6-4,1b,6,2,3,3,6d-20,16e-f,41-,37-7,2e-2,11-f,5-b,18-,b,14,5-3,6,88-,2,bf-2,7-,7-,7-,4-2,8,8-9,8-2ff,20,5-b,1c-b4,27-,27-cbb1,f7-9,28-2,b5-221,56,48,3-,2-,3-,5,d,2,5,3,42,5-,9,8,1d,5,6,2-2,8,153-3,123-3,33-27fd,a6da-5128,21f-5df,3-fffd,3-fffd,3-fffd,3-fffd,3-fffd,3-fffd,3-fffd,3-fffd,3-fffd,3-fffd,3-fffd,3,2-1d,61-ff7d"),"ad,34f,1806,180b,180c,180d,200b,200c,200d,2060,feff".split(",").map(e=>parseInt(e,16)),yR("b5:3bc,c3:ff,7:73,2:253,5:254,3:256,1:257,5:259,1:25b,3:260,1:263,2:269,1:268,5:26f,1:272,2:275,7:280,3:283,5:288,3:28a,1:28b,5:292,3f:195,1:1bf,29:19e,125:3b9,8b:3b2,1:3b8,1:3c5,3:3c6,1:3c0,1a:3ba,1:3c1,1:3c3,2:3b8,1:3b5,1bc9:3b9,1c:1f76,1:1f77,f:1f7a,1:1f7b,d:1f78,1:1f79,1:1f7c,1:1f7d,107:63,5:25b,4:68,1:68,1:68,3:69,1:69,1:6c,3:6e,4:70,1:71,1:72,1:72,1:72,7:7a,2:3c9,2:7a,2:6b,1:e5,1:62,1:63,3:65,1:66,2:6d,b:3b3,1:3c0,6:64,1b574:3b8,1a:3c3,20:3b8,1a:3c3,20:3b8,1a:3c3,20:3b8,1a:3c3,20:3b8,1a:3c3"),yR("179:1,2:1,2:1,5:1,2:1,a:4f,a:1,8:1,2:1,2:1,3:1,5:1,3:1,4:1,2:1,3:1,4:1,8:2,1:1,2:2,1:1,2:2,27:2,195:26,2:25,1:25,1:25,2:40,2:3f,1:3f,33:1,11:-6,1:-9,1ac7:-3a,6d:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,9:-8,1:-8,1:-8,1:-8,1:-8,1:-8,b:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,9:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,9:-8,1:-8,1:-8,1:-8,1:-8,1:-8,c:-8,2:-8,2:-8,2:-8,9:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,49:-8,1:-8,1:-4a,1:-4a,d:-56,1:-56,1:-56,1:-56,d:-8,1:-8,f:-8,1:-8,3:-7"),yR("df:00730073,51:00690307,19:02BC006E,a7:006A030C,18a:002003B9,16:03B903080301,20:03C503080301,1d7:05650582,190f:00680331,1:00740308,1:0077030A,1:0079030A,1:006102BE,b6:03C50313,2:03C503130300,2:03C503130301,2:03C503130342,2a:1F0003B9,1:1F0103B9,1:1F0203B9,1:1F0303B9,1:1F0403B9,1:1F0503B9,1:1F0603B9,1:1F0703B9,1:1F0003B9,1:1F0103B9,1:1F0203B9,1:1F0303B9,1:1F0403B9,1:1F0503B9,1:1F0603B9,1:1F0703B9,1:1F2003B9,1:1F2103B9,1:1F2203B9,1:1F2303B9,1:1F2403B9,1:1F2503B9,1:1F2603B9,1:1F2703B9,1:1F2003B9,1:1F2103B9,1:1F2203B9,1:1F2303B9,1:1F2403B9,1:1F2503B9,1:1F2603B9,1:1F2703B9,1:1F6003B9,1:1F6103B9,1:1F6203B9,1:1F6303B9,1:1F6403B9,1:1F6503B9,1:1F6603B9,1:1F6703B9,1:1F6003B9,1:1F6103B9,1:1F6203B9,1:1F6303B9,1:1F6403B9,1:1F6503B9,1:1F6603B9,1:1F6703B9,3:1F7003B9,1:03B103B9,1:03AC03B9,2:03B10342,1:03B1034203B9,5:03B103B9,6:1F7403B9,1:03B703B9,1:03AE03B9,2:03B70342,1:03B7034203B9,5:03B703B9,6:03B903080300,1:03B903080301,3:03B90342,1:03B903080342,b:03C503080300,1:03C503080301,1:03C10313,2:03C50342,1:03C503080342,b:1F7C03B9,1:03C903B9,1:03CE03B9,2:03C90342,1:03C9034203B9,5:03C903B9,ac:00720073,5b:00B00063,6:00B00066,d:006E006F,a:0073006D,1:00740065006C,1:0074006D,124f:006800700061,2:00610075,2:006F0076,b:00700061,1:006E0061,1:03BC0061,1:006D0061,1:006B0061,1:006B0062,1:006D0062,1:00670062,3:00700066,1:006E0066,1:03BC0066,4:0068007A,1:006B0068007A,1:006D0068007A,1:00670068007A,1:00740068007A,15:00700061,1:006B00700061,1:006D00700061,1:006700700061,8:00700076,1:006E0076,1:03BC0076,1:006D0076,1:006B0076,1:006D0076,1:00700077,1:006E0077,1:03BC0077,1:006D0077,1:006B0077,1:006D0077,1:006B03C9,1:006D03C9,2:00620071,3:00632215006B0067,1:0063006F002E,1:00640062,1:00670079,2:00680070,2:006B006B,1:006B006D,9:00700068,2:00700070006D,1:00700072,2:00730076,1:00770062,c723:00660066,1:00660069,1:0066006C,1:006600660069,1:00660066006C,1:00730074,1:00730074,d:05740576,1:05740565,1:0574056B,1:057E0576,1:0574056D",_le),iM("80-20,2a0-,39c,32,f71,18e,7f2-f,19-7,30-4,7-5,f81-b,5,a800-20ff,4d1-1f,110,fa-6,d174-7,2e84-,ffff-,ffff-,ffff-,ffff-,ffff-,ffff-,ffff-,ffff-,ffff-,ffff-,ffff-,ffff-,2,1f-5f,ff7f-20001");function Ele(e){e=atob(e);const t=[];for(let r=0;r<e.length;r++)t.push(e.charCodeAt(r));return jn(t)}function $z(e,t){const r=[],n=r.forEach;return function(s,o){n.call(s,function(a){r.push(a)})}(e),r}function vle(e){const t={};for(let r=0;r<e.length;r++){const n=e[r];t[n[0]]=n[1]}return t}function yle(e){let t=0;function r(){return e[t++]<<8|e[t++]}let n=r(),i=1,s=[0,1];for(let L=1;L<n;L++)s.push(i+=r());let o=r(),a=t;t+=o;let c=0,d=0;function l(){return c==0&&(d=d<<8|e[t++],c=8),d>>--c&1}const u=31,h=Math.pow(2,u),p=h>>>1,_=p>>1,g=h-1;let E=0;for(let L=0;L<u;L++)E=E<<1|l();let b=[],v=0,I=h;for(;;){let L=Math.floor(((E-v+1)*i-1)/I),U=0,w=n;for(;w-U>1;){let K=U+w>>>1;L<s[K]?w=K:U=K}if(U==0)break;b.push(U);let V=v+Math.floor(I*s[U]/i),z=v+Math.floor(I*s[U+1]/i)-1;for(;!((V^z)&p);)E=E<<1&g|l(),V=V<<1&g,z=z<<1&g|1;for(;V&~z&_;)E=E&p|E<<1&g>>>1|l(),V=V<<1^p,z=(z^p)<<1|p|1;v=V,I=1+z-V}let N=n-4;return b.map(L=>{switch(L-N){case 3:return N+65792+(e[a++]<<16|e[a++]<<8|e[a++]);case 2:return N+256+(e[a++]<<8|e[a++]);case 1:return N+e[a++];default:return L-1}})}function ble(e){let t=0;return()=>e[t++]}function Sle(e){return ble(yle(e))}function wle(e){return e&1?~e>>1:e>>1}function Tle(e,t){let r=Array(e);for(let n=0;n<e;n++)r[n]=1+t();return r}function sM(e,t){let r=Array(e);for(let n=0,i=-1;n<e;n++)r[n]=i+=1+t();return r}function Rle(e,t){let r=Array(e);for(let n=0,i=0;n<e;n++)r[n]=i+=wle(t());return r}function x1(e,t){let r=sM(e(),e),n=e(),i=sM(n,e),s=Tle(n,e);for(let o=0;o<n;o++)for(let a=0;a<s[o];a++)r.push(i[o]+a);return t?r.map(o=>t[o]):r}function Ale(e){let t=[];for(;;){let r=e();if(r==0)break;t.push(Ile(r,e))}for(;;){let r=e()-1;if(r<0)break;t.push(Ole(r,e))}return vle($z(t))}function Cle(e){let t=[];for(;;){let r=e();if(r==0)break;t.push(r)}return t}function Hz(e,t,r){let n=Array(e).fill(void 0).map(()=>[]);for(let i=0;i<t;i++)Rle(e,r).forEach((s,o)=>n[o].push(s));return n}function Ile(e,t){let r=1+t(),n=t(),i=Cle(t),s=Hz(i.length,1+e,t);return $z(s.map((o,a)=>{const c=o[0],d=o.slice(1);return Array(i[a]).fill(void 0).map((l,u)=>{let h=u*n;return[c+u*r,d.map(p=>p+h)]})}))}function Ole(e,t){let r=1+t();return Hz(r,1+e,t).map(n=>[n[0],n.slice(1)])}function Nle(e){let t=x1(e).sort((n,i)=>n-i);return r();function r(){let n=[];for(;;){let d=x1(e,t);if(d.length==0)break;n.push({set:new Set(d),node:r()})}n.sort((d,l)=>l.set.size-d.set.size);let i=e(),s=i%3;i=i/3|0;let o=!!(i&1);i>>=1;let a=i==1,c=i==2;return{branches:n,valid:s,fe0f:o,save:a,check:c}}}function Dle(){return Sle(Ele("AEQF2AO2DEsA2wIrAGsBRABxAN8AZwCcAEwAqgA0AGwAUgByADcATAAVAFYAIQAyACEAKAAYAFgAGwAjABQAMAAmADIAFAAfABQAKwATACoADgAbAA8AHQAYABoAGQAxADgALAAoADwAEwA9ABMAGgARAA4ADwAWABMAFgAIAA8AHgQXBYMA5BHJAS8JtAYoAe4AExozi0UAH21tAaMnBT8CrnIyhrMDhRgDygIBUAEHcoFHUPe8AXBjAewCjgDQR8IICIcEcQLwATXCDgzvHwBmBoHNAqsBdBcUAykgDhAMShskMgo8AY8jqAQfAUAfHw8BDw87MioGlCIPBwZCa4ELatMAAMspJVgsDl8AIhckSg8XAHdvTwBcIQEiDT4OPhUqbyECAEoAS34Aej8Ybx83JgT/Xw8gHxZ/7w8RICxPHA9vBw+Pfw8PHwAPFv+fAsAvCc8vEr8ivwD/EQ8Bol8OEBa/A78hrwAPCU8vESNvvwWfHwNfAVoDHr+ZAAED34YaAdJPAK7PLwSEgDLHAGo1Pz8Pvx9fUwMrpb8O/58VTzAPIBoXIyQJNF8hpwIVAT8YGAUADDNBaX3RAMomJCg9EhUeA29MABsZBTMNJipjOhc19gcIDR8bBwQHEggCWi6DIgLuAQYA+BAFCha3A5XiAEsqM7UFFgFLhAMjFTMYE1Klnw74nRVBG/ASCm0BYRN/BrsU3VoWy+S0vV8LQx+vN8gF2AC2AK5EAWwApgYDKmAAroQ0NDQ0AT+OCg7wAAIHRAbpNgVcBV0APTA5BfbPFgMLzcYL/QqqA82eBALKCjQCjqYCht0/k2+OAsXQAoP3ASTKDgDw6ACKAUYCMpIKJpRaAE4A5womABzZvs0REEKiACIQAd5QdAECAj4Ywg/wGqY2AVgAYADYvAoCGAEubA0gvAY2ALAAbpbvqpyEAGAEpgQAJgAG7gAgAEACmghUFwCqAMpAINQIwC4DthRAAPcycKgApoIdABwBfCisABoATwBqASIAvhnSBP8aH/ECeAKXAq40NjgDBTwFYQU6AXs3oABgAD4XNgmcCY1eCl5tIFZeUqGgyoNHABgAEQAaABNwWQAmABMATPMa3T34ADldyprmM1M2XociUQgLzvwAXT3xABgAEQAaABNwIGFAnADD8AAgAD4BBJWzaCcIAIEBFMAWwKoAAdq9BWAF5wLQpALEtQAKUSGkahR4GnJM+gsAwCgeFAiUAECQ0BQuL8AAIAAAADKeIheclvFqQAAETr4iAMxIARMgAMIoHhQIAn0E0pDQFC4HhznoAAAAIAI2C0/4lvFqQAAETgBJJwYCAy4ABgYAFAA8MBKYEH4eRhTkAjYeFcgACAYAeABsOqyQ5gRwDayqugEgaIIAtgoACgDmEABmBAWGme5OBJJA2m4cDeoAmITWAXwrMgOgAGwBCh6CBXYF1Tzg1wKAAFdiuABRAFwAXQBsAG8AdgBrAHYAbwCEAHEwfxQBVE5TEQADVFhTBwBDANILAqcCzgLTApQCrQL6vAAMAL8APLhNBKkE6glGKTAU4Dr4N2EYEwBCkABKk8rHAbYBmwIoAiU4Ajf/Aq4CowCAANIChzgaNBsCsTgeODcFXrgClQKdAqQBiQGYAqsCsjTsNHsfNPA0ixsAWTWiOAMFPDQSNCk2BDZHNow2TTZUNhk28Jk9VzI3QkEoAoICoQKwAqcAQAAxBV4FXbS9BW47YkIXP1ciUqs05DS/FwABUwJW11e6nHuYZmSh/RAYA8oMKvZ8KASoUAJYWAJ6ILAsAZSoqjpgA0ocBIhmDgDWAAawRDQoAAcuAj5iAHABZiR2AIgiHgCaAU68ACxuHAG0ygM8MiZIAlgBdF4GagJqAPZOHAMuBgoATkYAsABiAHgAMLoGDPj0HpKEBAAOJgAuALggTAHWAeAMEDbd20Uege0ADwAWADkAQgA9OHd+2MUQZBBhBgNNDkxxPxUQArEPqwvqERoM1irQ090ANK4H8ANYB/ADWANYB/AH8ANYB/ADWANYA1gDWBwP8B/YxRBkD00EcgWTBZAE2wiIJk4RhgctCNdUEnQjHEwDSgEBIypJITuYMxAlR0wRTQgIATZHbKx9PQNMMbBU+pCnA9AyVDlxBgMedhKlAC8PeCE1uk6DekxxpQpQT7NX9wBFBgASqwAS5gBJDSgAUCwGPQBI4zTYABNGAE2bAE3KAExdGABKaAbgAFBXAFCOAFBJABI2SWdObALDOq0//QomCZhvwHdTBkIQHCemEPgMNAG2ATwN7kvZBPIGPATKH34ZGg/OlZ0Ipi3eDO4m5C6igFsj9iqEBe5L9TzeC05RaQ9aC2YJ5DpkgU8DIgEOIowK3g06CG4Q9ArKbA3mEUYHOgPWSZsApgcCCxIdNhW2JhFirQsKOXgG/Br3C5AmsBMqev0F1BoiBk4BKhsAANAu6IWxWjJcHU9gBgQLJiPIFKlQIQ0mQLh4SRocBxYlqgKSQ3FKiFE3HpQh9zw+DWcuFFF9B/Y8BhlQC4I8n0asRQ8R0z6OPUkiSkwtBDaALDAnjAnQD4YMunxzAVoJIgmyDHITMhEYN8YIOgcaLpclJxYIIkaWYJsE+KAD9BPSAwwFQAlCBxQDthwuEy8VKgUOgSXYAvQ21i60ApBWgQEYBcwPJh/gEFFH4Q7qCJwCZgOEJewALhUiABginAhEZABgj9lTBi7MCMhqbSN1A2gU6GIRdAeSDlgHqBw0FcAc4nDJXgyGCSiksAlcAXYJmgFgBOQICjVcjKEgQmdUi1kYnCBiQUBd/QIyDGYVoES+h3kCjA9sEhwBNgF0BzoNAgJ4Ee4RbBCWCOyGBTW2M/k6JgRQIYQgEgooA1BszwsoJvoM+WoBpBJjAw00PnfvZ6xgtyUX/gcaMsZBYSHyC5NPzgydGsIYQ1QvGeUHwAP0GvQn60FYBgADpAQUOk4z7wS+C2oIjAlAAEoOpBgH2BhrCnKM0QEyjAG4mgNYkoQCcJAGOAcMAGgMiAV65gAeAqgIpAAGANADWAA6Aq4HngAaAIZCAT4DKDABIuYCkAOUCDLMAZYwAfQqBBzEDBYA+DhuSwLDsgKAa2ajBd5ZAo8CSjYBTiYEBk9IUgOwcuIA3ABMBhTgSAEWrEvMG+REAeBwLADIAPwABjYHBkIBzgH0bgC4AWALMgmjtLYBTuoqAIQAFmwB2AKKAN4ANgCA8gFUAE4FWvoF1AJQSgESMhksWGIBvAMgATQBDgB6BsyOpsoIIARuB9QCEBwV4gLvLwe2AgMi4BPOQsYCvd9WADIXUu5eZwqoCqdeaAC0YTQHMnM9UQAPH6k+yAdy/BZIiQImSwBQ5gBQQzSaNTFWSTYBpwGqKQK38AFtqwBI/wK37gK3rQK3sAK6280C0gK33AK3zxAAUEIAUD9SklKDArekArw5AEQAzAHCO147WTteO1k7XjtZO147WTteO1kDmChYI03AVU0oJqkKbV9GYewMpw3VRMk6ShPcYFJgMxPJLbgUwhXPJVcZPhq9JwYl5VUKDwUt1GYxCC00dhe9AEApaYNCY4ceMQpMHOhTklT5LRwAskujM7ANrRsWREEFSHXuYisWDwojAmSCAmJDXE6wXDchAqH4AmiZAmYKAp+FOBwMAmY8AmYnBG8EgAN/FAN+kzkHOXgYOYM6JCQCbB4CMjc4CwJtyAJtr/CLADRoRiwBaADfAOIASwYHmQyOAP8MwwAOtgJ3MAJ2o0ACeUxEAni7Hl3cRa9G9AJ8QAJ6yQJ9CgJ88UgBSH5kJQAsFklZSlwWGErNAtECAtDNSygDiFADh+dExpEzAvKiXQQDA69Lz0wuJgTQTU1NsAKLQAKK2cIcCB5EaAa4Ao44Ao5dQZiCAo7aAo5deVG1UzYLUtVUhgKT/AKTDQDqAB1VH1WwVdEHLBwplocy4nhnRTw6ApegAu+zWCKpAFomApaQApZ9nQCqWa1aCoJOADwClrYClk9cRVzSApnMApllXMtdCBoCnJw5wzqeApwXAp+cAp65iwAeEDIrEAKd8gKekwC2PmE1YfACntQCoG8BqgKeoCACnk+mY8lkKCYsAiewAiZ/AqD8AqBN2AKmMAKlzwKoAAB+AqfzaH1osgAESmodatICrOQCrK8CrWgCrQMCVx4CVd0CseLYAx9PbJgCsr4OArLpGGzhbWRtSWADJc4Ctl08QG6RAylGArhfArlIFgK5K3hwN3DiAr0aAy2zAzISAr6JcgMDM3ICvhtzI3NQAsPMAsMFc4N0TDZGdOEDPKgDPJsDPcACxX0CxkgCxhGKAshqUgLIRQLJUALJLwJkngLd03h6YniveSZL0QMYpGcDAmH1GfSVJXsMXpNevBICz2wCz20wTFTT9BSgAMeuAs90ASrrA04TfkwGAtwoAtuLAtJQA1JdA1NgAQIDVY2AikABzBfuYUZ2AILPg44C2sgC2d+EEYRKpz0DhqYAMANkD4ZyWvoAVgLfZgLeuXR4AuIw7RUB8zEoAfScAfLTiALr9ALpcXoAAur6AurlAPpIAboC7ooC652Wq5cEAu5AA4XhmHpw4XGiAvMEAGoDjheZlAL3FAORbwOSiAL3mQL52gL4Z5odmqy8OJsfA52EAv77ARwAOp8dn7QDBY4DpmsDptoA0sYDBmuhiaIGCgMMSgFgASACtgNGAJwEgLpoBgC8BGzAEowcggCEDC6kdjoAJAM0C5IKRoABZCgiAIzw3AYBLACkfng9ogigkgNmWAN6AEQCvrkEVqTGAwCsBRbAA+4iQkMCHR072jI2PTbUNsk2RjY5NvA23TZKNiU3EDcZN5I+RTxDRTBCJkK5VBYKFhZfwQCWygU3AJBRHpu+OytgNxa61A40GMsYjsn7BVwFXQVcBV0FaAVdBVwFXQVcBV0FXAVdBVwFXUsaCNyKAK4AAQUHBwKU7oICoW1e7jAEzgPxA+YDwgCkBFDAwADABKzAAOxFLhitA1UFTDeyPkM+bj51QkRCuwTQWWQ8X+0AWBYzsACNA8xwzAGm7EZ/QisoCTAbLDs6fnLfb8H2GccsbgFw13M1HAVkBW/Jxsm9CNRO8E8FDD0FBQw9FkcClOYCoMFegpDfADgcMiA2AJQACB8AsigKAIzIEAJKeBIApY5yPZQIAKQiHb4fvj5BKSRPQrZCOz0oXyxgOywfKAnGbgMClQaCAkILXgdeCD9IIGUgQj5fPoY+dT52Ao5CM0dAX9BTVG9SDzFwWTQAbxBzJF/lOEIQQglCCkKJIAls5AcClQICoKPMODEFxhi6KSAbiyfIRrMjtCgdWCAkPlFBIitCsEJRzAbMAV/OEyQzDg0OAQQEJ36i328/Mk9AybDJsQlq3tDRApUKAkFzXf1d/j9uALYP6hCoFgCTGD8kPsFKQiobrm0+zj0KSD8kPnVCRBwMDyJRTHFgMTJa5rwXQiQ2YfI/JD7BMEJEHGINTw4TOFlIRzwJO0icMQpyPyQ+wzJCRBv6DVgnKB01NgUKj2bwYzMqCoBkznBgEF+zYDIocwRIX+NgHj4HICNfh2C4CwdwFWpTG/lgUhYGAwRfv2Ts8mAaXzVgml/XYIJfuWC4HI1gUF9pYJZgMR6ilQHMAOwLAlDRefC0in4AXAEJA6PjCwc0IamOANMMCAECRQDFNRTZBgd+CwQlRA+r6+gLBDEFBnwUBXgKATIArwAGRAAHA3cDdAN2A3kDdwN9A3oDdQN7A30DfAN4A3oDfQAYEAAlAtYASwMAUAFsAHcKAHcAmgB3AHUAdQB2AHVu8UgAygDAAHcAdQB1AHYAdQALCgB3AAsAmgB3AAsCOwB3AAtu8UgAygDAAHgKAJoAdwB3AHUAdQB2AHUAeAB1AHUAdgB1bvFIAMoAwAALCgCaAHcACwB3AAsCOwB3AAtu8UgAygDAAH4ACwGgALcBpwC6AahdAu0COwLtbvFIAMoAwAALCgCaAu0ACwLtAAsCOwLtAAtu8UgAygDAA24ACwNvAAu0VsQAAzsAABCkjUIpAAsAUIusOggWcgMeBxVsGwL67U/2HlzmWOEeOgALASvuAAseAfpKUpnpGgYJDCIZM6YyARUE9ThqAD5iXQgnAJYJPnOzw0ZAEZxEKsIAkA4DhAHnTAIDxxUDK0lxCQlPYgIvIQVYJQBVqE1GakUAKGYiDToSBA1EtAYAXQJYAIF8GgMHRyAAIAjOe9YncekRAA0KACUrjwE7Ayc6AAYWAqaiKG4McEcqANoN3+Mg9TwCBhIkuCny+JwUQ29L008JluRxu3K+oAdqiHOqFH0AG5SUIfUJ5SxCGfxdipRzqTmT4V5Zb+r1Uo4Vm+NqSSEl2mNvR2JhIa8SpYO6ntdwFXHCWTCK8f2+Hxo7uiG3drDycAuKIMP5bhi06ACnqArH1rz4Rqg//lm6SgJGEVbF9xJHISaR6HxqxSnkw6shDnelHKNEfGUXSJRJ1GcsmtJw25xrZMDK9gXSm1/YMkdX4/6NKYOdtk/NQ3/NnDASjTc3fPjIjW/5sVfVObX2oTDWkr1dF9f3kxBsD3/3aQO8hPfRz+e0uEiJqt1161griu7gz8hDDwtpy+F+BWtefnKHZPAxcZoWbnznhJpy0e842j36bcNzGnIEusgGX0a8ZxsnjcSsPDZ09yZ36fCQbriHeQ72JRMILNl6ePPf2HWoVwgWAm1fb3V2sAY0+B6rAXqSwPBgseVmoqsBTSrm91+XasMYYySI8eeRxH3ZvHkMz3BQ5aJ3iUVbYPNM3/7emRtjlsMgv/9VyTsyt/mK+8fgWeT6SoFaclXqn42dAIsvAarF5vNNWHzKSkKQ/8Hfk5ZWK7r9yliOsooyBjRhfkHP4Q2DkWXQi6FG/9r/IwbmkV5T7JSopHKn1pJwm9tb5Ot0oyN1Z2mPpKXHTxx2nlK08fKk1hEYA8WgVVWL5lgx0iTv+KdojJeU23ZDjmiubXOxVXJKKi2Wjuh2HLZOFLiSC7Tls5SMh4f+Pj6xUSrNjFqLGehRNB8lC0QSLNmkJJx/wSG3MnjE9T1CkPwJI0wH2lfzwETIiVqUxg0dfu5q39Gt+hwdcxkhhNvQ4TyrBceof3Mhs/IxFci1HmHr4FMZgXEEczPiGCx0HRwzAqDq2j9AVm1kwN0mRVLWLylgtoPNapF5cY4Y1wJh/e0BBwZj44YgZrDNqvD/9Hv7GFYdUQeDJuQ3EWI4HaKqavU1XjC/n41kT4L79kqGq0kLhdTZvgP3TA3fS0ozVz+5piZsoOtIvBUFoMKbNcmBL6YxxaUAusHB38XrS8dQMnQwJfUUkpRoGr5AUeWicvBTzyK9g77+yCkf5PAysL7r/JjcZgrbvRpMW9iyaxZvKO6ceZN2EwIxKwVFPuvFuiEPGCoagbMo+SpydLrXqBzNCDGFCrO/rkcwa2xhokQZ5CdZ0AsU3JfSqJ6n5I14YA+P/uAgfhPU84Tlw7cEFfp7AEE8ey4sP12PTt4Cods1GRgDOB5xvyiR5m+Bx8O5nBCNctU8BevfV5A08x6RHd5jcwPTMDSZJOedIZ1cGQ704lxbAzqZOP05ZxaOghzSdvFBHYqomATARyAADK4elP8Ly3IrUZKfWh23Xy20uBUmLS4Pfagu9+oyVa2iPgqRP3F2CTUsvJ7+RYnN8fFZbU/HVvxvcFFDKkiTqV5UBZ3Gz54JAKByi9hkKMZJvuGgcSYXFmw08UyoQyVdfTD1/dMkCHXcTGAKeROgArsvmRrQTLUOXioOHGK2QkjHuoYFgXciZoTJd6Fs5q1QX1G+p/e26hYsEf7QZD1nnIyl/SFkNtYYmmBhpBrxl9WbY0YpHWRuw2Ll/tj9mD8P4snVzJl4F9J+1arVeTb9E5r2ILH04qStjxQNwn3m4YNqxmaNbLAqW2TN6LidwuJRqS+NXbtqxoeDXpxeGWmxzSkWxjkyCkX4NQRme6q5SAcC+M7+9ETfA/EwrzQajKakCwYyeunP6ZFlxU2oMEn1Pz31zeStW74G406ZJFCl1wAXIoUKkWotYEpOuXB1uVNxJ63dpJEqfxBeptwIHNrPz8BllZoIcBoXwgfJ+8VAUnVPvRvexnw0Ma/WiGYuJO5y8QTvEYBigFmhUxY5RqzE8OcywN/8m4UYrlaniJO75XQ6KSo9+tWHlu+hMi0UVdiKQp7NelnoZUzNaIyBPVeOwK6GNp+FfHuPOoyhaWuNvTYFkvxscMQWDh+zeFCFkgwbXftiV23ywJ4+uwRqmg9k3KzwIQpzppt8DBBOMbrqwQM5Gb05sEwdKzMiAqOloaA/lr0KA+1pr0/+HiWoiIjHA/wir2nIuS3PeU/ji3O6ZwoxcR1SZ9FhtLC5S0FIzFhbBWcGVP/KpxOPSiUoAdWUpqKH++6Scz507iCcxYI6rdMBICPJZea7OcmeFw5mObJSiqpjg2UoWNIs+cFhyDSt6geV5qgi3FunmwwDoGSMgerFOZGX1m0dMCYo5XOruxO063dwENK9DbnVM9wYFREzh4vyU1WYYJ/LRRp6oxgjqP/X5a8/4Af6p6NWkQferzBmXme0zY/4nwMJm/wd1tIqSwGz+E3xPEAOoZlJit3XddD7/BT1pllzOx+8bmQtANQ/S6fZexc6qi3W+Q2xcmXTUhuS5mpHQRvcxZUN0S5+PL9lXWUAaRZhEH8hTdAcuNMMCuVNKTEGtSUKNi3O6KhSaTzck8csZ2vWRZ+d7mW8c4IKwXIYd25S/zIftPkwPzufjEvOHWVD1m+FjpDVUTV0DGDuHj6QnaEwLu/dEgdLQOg9E1Sro9XHJ8ykLAwtPu+pxqKDuFexqON1sKQm7rwbE1E68UCfA/erovrTCG+DBSNg0l4goDQvZN6uNlbyLpcZAwj2UclycvLpIZMgv4yRlpb3YuMftozorbcGVHt/VeDV3+Fdf1TP0iuaCsPi2G4XeGhsyF1ubVDxkoJhmniQ0/jSg/eYML9KLfnCFgISWkp91eauR3IQvED0nAPXK+6hPCYs+n3+hCZbiskmVMG2da+0EsZPonUeIY8EbfusQXjsK/eFDaosbPjEfQS0RKG7yj5GG69M7MeO1HmiUYocgygJHL6M1qzUDDwUSmr99V7Sdr2F3JjQAJY+F0yH33Iv3+C9M38eML7gTgmNu/r2bUMiPvpYbZ6v1/IaESirBHNa7mPKn4dEmYg7v/+HQgPN1G79jBQ1+soydfDC2r+h2Bl/KIc5KjMK7OH6nb1jLsNf0EHVe2KBiE51ox636uyG6Lho0t3J34L5QY/ilE3mikaF4HKXG1mG1rCevT1Vv6GavltxoQe/bMrpZvRggnBxSEPEeEzkEdOxTnPXHVjUYdw8JYvjB/o7Eegc3Ma+NUxLLnsK0kJlinPmUHzHGtrk5+CAbVzFOBqpyy3QVUnzTDfC/0XD94/okH+OB+i7g9lolhWIjSnfIb+Eq43ZXOWmwvjyV/qqD+t0e+7mTEM74qP/Ozt8nmC7mRpyu63OB4KnUzFc074SqoyPUAgM+/TJGFo6T44EHnQU4X4z6qannVqgw/U7zCpwcmXV1AubIrvOmkKHazJAR55ePjp5tLBsN8vAqs3NAHdcEHOR2xQ0lsNAFzSUuxFQCFYvXLZJdOj9p4fNq6p0HBGUik2YzaI4xySy91KzhQ0+q1hjxvImRwPRf76tChlRkhRCi74NXZ9qUNeIwP+s5p+3m5nwPdNOHgSLD79n7O9m1n1uDHiMntq4nkYwV5OZ1ENbXxFd4PgrlvavZsyUO4MqYlqqn1O8W/I1dEZq5dXhrbETLaZIbC2Kj/Aa/QM+fqUOHdf0tXAQ1huZ3cmWECWSXy/43j35+Mvq9xws7JKseriZ1pEWKc8qlzNrGPUGcVgOa9cPJYIJsGnJTAUsEcDOEVULO5x0rXBijc1lgXEzQQKhROf8zIV82w8eswc78YX11KYLWQRcgHNJElBxfXr72lS2RBSl07qTKorO2uUDZr3sFhYsvnhLZn0A94KRzJ/7DEGIAhW5ZWFpL8gEwu1aLA9MuWZzNwl8Oze9Y+bX+v9gywRVnoB5I/8kXTXU3141yRLYrIOOz6SOnyHNy4SieqzkBXharjfjqq1q6tklaEbA8Qfm2DaIPs7OTq/nvJBjKfO2H9bH2cCMh1+5gspfycu8f/cuuRmtDjyqZ7uCIMyjdV3a+p3fqmXsRx4C8lujezIFHnQiVTXLXuI1XrwN3+siYYj2HHTvESUx8DlOTXpak9qFRK+L3mgJ1WsD7F4cu1aJoFoYQnu+wGDMOjJM3kiBQWHCcvhJ/HRdxodOQp45YZaOTA22Nb4XKCVxqkbwMYFhzYQYIAnCW8FW14uf98jhUG2zrKhQQ0q0CEq0t5nXyvUyvR8DvD69LU+g3i+HFWQMQ8PqZuHD+sNKAV0+M6EJC0szq7rEr7B5bQ8BcNHzvDMc9eqB5ZCQdTf80Obn4uzjwpYU7SISdtV0QGa9D3Wrh2BDQtpBKxaNFV+/Cy2P/Sv+8s7Ud0Fd74X4+o/TNztWgETUapy+majNQ68Lq3ee0ZO48VEbTZYiH1Co4OlfWef82RWeyUXo7woM03PyapGfikTnQinoNq5z5veLpeMV3HCAMTaZmA1oGLAn7XS3XYsz+XK7VMQsc4XKrmDXOLU/pSXVNUq8dIqTba///3x6LiLS6xs1xuCAYSfcQ3+rQgmu7uvf3THKt5Ooo97TqcbRqxx7EASizaQCBQllG/rYxVapMLgtLbZS64w1MDBMXX+PQpBKNwqUKOf2DDRDUXQf9EhOS0Qj4nTmlA8dzSLz/G1d+Ud8MTy/6ghhdiLpeerGY/UlDOfiuqFsMUU5/UYlP+BAmgRLuNpvrUaLlVkrqDievNVEAwF+4CoM1MZTmjxjJMsKJq+u8Zd7tNCUFy6LiyYXRJQ4VyvEQFFaCGKsxIwQkk7EzZ6LTJq2hUuPhvAW+gQnSG6J+MszC+7QCRHcnqDdyNRJ6T9xyS87A6MDutbzKGvGktpbXqtzWtXb9HsfK2cBMomjN9a4y+TaJLnXxAeX/HWzmf4cR4vALt/P4w4qgKY04ml4ZdLOinFYS6cup3G/1ie4+t1eOnpBNlqGqs75ilzkT4+DsZQxNvaSKJ//6zIbbk/M7LOhFmRc/1R+kBtz7JFGdZm/COotIdvQoXpTqP/1uqEUmCb/QWoGLMwO5ANcHzxdY48IGP5+J+zKOTBFZ4Pid+GTM+Wq12MV/H86xEJptBa6T+p3kgpwLedManBHC2GgNrFpoN2xnrMz9WFWX/8/ygSBkavq2Uv7FdCsLEYLu9LLIvAU0bNRDtzYl+/vXmjpIvuJFYjmI0im6QEYqnIeMsNjXG4vIutIGHijeAG/9EDBozKV5cldkHbLxHh25vT+ZEzbhXlqvpzKJwcEgfNwLAKFeo0/pvEE10XDB+EXRTXtSzJozQKFFAJhMxYkVaCW+E9AL7tMeU8acxidHqzb6lX4691UsDpy/LLRmT+epgW56+5Cw8tB4kMUv6s9lh3eRKbyGs+H/4mQMaYzPTf2OOdokEn+zzgvoD3FqNKk8QqGAXVsqcGdXrT62fSPkR2vROFi68A6se86UxRUk4cajfPyCC4G5wDhD+zNq4jodQ4u4n/m37Lr36n4LIAAsVr02dFi9AiwA81MYs2rm4eDlDNmdMRvEKRHfBwW5DdMNp0jPFZMeARqF/wL4XBfd+EMLBfMzpH5GH6NaW+1vrvMdg+VxDzatk3MXgO3ro3P/DpcC6+Mo4MySJhKJhSR01SGGGp5hPWmrrUgrv3lDnP+HhcI3nt3YqBoVAVTBAQT5iuhTg8nvPtd8ZeYj6w1x6RqGUBrSku7+N1+BaasZvjTk64RoIDlL8brpEcJx3OmY7jLoZsswdtmhfC/G21llXhITOwmvRDDeTTPbyASOa16cF5/A1fZAidJpqju3wYAy9avPR1ya6eNp9K8XYrrtuxlqi+bDKwlfrYdR0RRiKRVTLOH85+ZY7XSmzRpfZBJjaTa81VDcJHpZnZnSQLASGYW9l51ZV/h7eVzTi3Hv6hUsgc/51AqJRTkpbFVLXXszoBL8nBX0u/0jBLT8nH+fJePbrwURT58OY+UieRjd1vs04w0VG5VN2U6MoGZkQzKN/ptz0Q366dxoTGmj7i1NQGHi9GgnquXFYdrCfZBmeb7s0T6yrdlZH5cZuwHFyIJ/kAtGsTg0xH5taAAq44BAk1CPk9KVVbqQzrCUiFdF/6gtlPQ8bHHc1G1W92MXGZ5HEHftyLYs8mbD/9xYRUWkHmlM0zC2ilJlnNgV4bfALpQghxOUoZL7VTqtCHIaQSXm+YUMnpkXybnV+A6xlm2CVy8fn0Xlm2XRa0+zzOa21JWWmixfiPMSCZ7qA4rS93VN3pkpF1s5TonQjisHf7iU9ZGvUPOAKZcR1pbeVf/Ul7OhepGCaId9wOtqo7pJ7yLcBZ0pFkOF28y4zEI/kcUNmutBHaQpBdNM8vjCS6HZRokkeo88TBAjGyG7SR+6vUgTcyK9Imalj0kuxz0wmK+byQU11AiJFk/ya5dNduRClcnU64yGu/ieWSeOos1t3ep+RPIWQ2pyTYVbZltTbsb7NiwSi3AV+8KLWk7LxCnfZUetEM8ThnsSoGH38/nyAwFguJp8FjvlHtcWZuU4hPva0rHfr0UhOOJ/F6vS62FW7KzkmRll2HEc7oUq4fyi5T70Vl7YVIfsPHUCdHesf9Lk7WNVWO75JDkYbMI8TOW8JKVtLY9d6UJRITO8oKo0xS+o99Yy04iniGHAaGj88kEWgwv0OrHdY/nr76DOGNS59hXCGXzTKUvDl9iKpLSWYN1lxIeyywdNpTkhay74w2jFT6NS8qkjo5CxA1yfSYwp6AJIZNKIeEK5PJAW7ORgWgwp0VgzYpqovMrWxbu+DGZ6Lhie1RAqpzm8VUzKJOH3mCzWuTOLsN3VT/dv2eeYe9UjbR8YTBsLz7q60VN1sU51k+um1f8JxD5pPhbhSC8rRaB454tmh6YUWrJI3+GWY0qeWioj/tbkYITOkJaeuGt4JrJvHA+l0Gu7kY7XOaa05alMnRWVCXqFgLIwSY4uF59Ue5SU4QKuc/HamDxbr0x6csCetXGoP7Qn1Bk/J9DsynO/UD6iZ1Hyrz+jit0hDCwi/E9OjgKTbB3ZQKQ/0ZOvevfNHG0NK4Aj3Cp7NpRk07RT1i/S0EL93Ag8GRgKI9CfpajKyK6+Jj/PI1KO5/85VAwz2AwzP8FTBb075IxCXv6T9RVvWT2tUaqxDS92zrGUbWzUYk9mSs82pECH+fkqsDt93VW++4YsR/dHCYcQSYTO/KaBMDj9LSD/J/+z20Kq8XvZUAIHtm9hRPP3ItbuAu2Hm5lkPs92pd7kCxgRs0xOVBnZ13ccdA0aunrwv9SdqElJRC3g+oCu+nXyCgmXUs9yMjTMAIHfxZV+aPKcZeUBWt057Xo85Ks1Ir5gzEHCWqZEhrLZMuF11ziGtFQUds/EESajhagzcKsxamcSZxGth4UII+adPhQkUnx2WyN+4YWR+r3f8MnkyGFuR4zjzxJS8WsQYR5PTyRaD9ixa6Mh741nBHbzfjXHskGDq179xaRNrCIB1z1xRfWfjqw2pHc1zk9xlPpL8sQWAIuETZZhbnmL54rceXVNRvUiKrrqIkeogsl0XXb17ylNb0f4GA9Wd44vffEG8FSZGHEL2fbaTGRcSiCeA8PmA/f6Hz8HCS76fXUHwgwkzSwlI71ekZ7Fapmlk/KC+Hs8hUcw3N2LN5LhkVYyizYFl/uPeVP5lsoJHhhfWvvSWruCUW1ZcJOeuTbrDgywJ/qG07gZJplnTvLcYdNaH0KMYOYMGX+rB4NGPFmQsNaIwlWrfCezxre8zXBrsMT+edVLbLqN1BqB76JH4BvZTqUIMfGwPGEn+EnmTV86fPBaYbFL3DFEhjB45CewkXEAtJxk4/Ms2pPXnaRqdky0HOYdcUcE2zcXq4vaIvW2/v0nHFJH2XXe22ueDmq/18XGtELSq85j9X8q0tcNSSKJIX8FTuJF/Pf8j5PhqG2u+osvsLxYrvvfeVJL+4tkcXcr9JV7v0ERmj/X6fM3NC4j6dS1+9Umr2oPavqiAydTZPLMNRGY23LO9zAVDly7jD+70G5TPPLdhRIl4WxcYjLnM+SNcJ26FOrkrISUtPObIz5Zb3AG612krnpy15RMW+1cQjlnWFI6538qky9axd2oJmHIHP08KyP0ubGO+TQNOYuv2uh17yCIvR8VcStw7o1g0NM60sk+8Tq7YfIBJrtp53GkvzXH7OA0p8/n/u1satf/VJhtR1l8Wa6Gmaug7haSpaCaYQax6ta0mkutlb+eAOSG1aobM81D9A4iS1RRlzBBoVX6tU1S6WE2N9ORY6DfeLRC4l9Rvr5h95XDWB2mR1d4WFudpsgVYwiTwT31ljskD8ZyDOlm5DkGh9N/UB/0AI5Xvb8ZBmai2hQ4BWMqFwYnzxwB26YHSOv9WgY3JXnvoN+2R4rqGVh/LLDMtpFP+SpMGJNWvbIl5SOodbCczW2RKleksPoUeGEzrjtKHVdtZA+kfqO+rVx/iclCqwoopepvJpSTDjT+b9GWylGRF8EDbGlw6eUzmJM95Ovoz+kwLX3c2fTjFeYEsE7vUZm3mqdGJuKh2w9/QGSaqRHs99aScGOdDqkFcACoqdbBoQqqjamhH6Q9ng39JCg3lrGJwd50Qk9ovnqBTr8MME7Ps2wiVfygUmPoUBJJfJWX5Nda0nuncbFkA=="))}const jv=Dle();new Set(x1(jv)),new Set(x1(jv)),Ale(jv),Nle(jv);const Ple=new Uint8Array(32);Ple.fill(0);const kle=`Ethereum Signed Message:
`;function zz(e){return typeof e=="string"&&(e=vR(e)),nP(ole([vR(kle),vR(String(e.length)),e]))}const Lle="address/5.7.0",Ig=new Bi(Lle);function oM(e){jo(e,20)||Ig.throwArgumentError("invalid address","address",e),e=e.toLowerCase();const t=e.substring(2).split(""),r=new Uint8Array(40);for(let i=0;i<40;i++)r[i]=t[i].charCodeAt(0);const n=jn(nP(r));for(let i=0;i<40;i+=2)n[i>>1]>>4>=8&&(t[i]=t[i].toUpperCase()),(n[i>>1]&15)>=8&&(t[i+1]=t[i+1].toUpperCase());return"0x"+t.join("")}const xle=9007199254740991;function Mle(e){return Math.log10?Math.log10(e):Math.log(e)/Math.LN10}const sP={};for(let e=0;e<10;e++)sP[String(e)]=String(e);for(let e=0;e<26;e++)sP[String.fromCharCode(65+e)]=String(10+e);const aM=Math.floor(Mle(xle));function Ule(e){e=e.toUpperCase(),e=e.substring(4)+e.substring(0,2)+"00";let t=e.split("").map(n=>sP[n]).join("");for(;t.length>=aM;){let n=t.substring(0,aM);t=parseInt(n,10)%97+t.substring(n.length)}let r=String(98-parseInt(t,10)%97);for(;r.length<2;)r="0"+r;return r}function jle(e){let t=null;if(typeof e!="string"&&Ig.throwArgumentError("invalid address","address",e),e.match(/^(0x)?[0-9a-fA-F]{40}$/))e.substring(0,2)!=="0x"&&(e="0x"+e),t=oM(e),e.match(/([A-F].*[a-f])|([a-f].*[A-F])/)&&t!==e&&Ig.throwArgumentError("bad address checksum","address",e);else if(e.match(/^XE[0-9]{2}[0-9A-Za-z]{30,31}$/)){for(e.substring(2,4)!==Ule(e)&&Ig.throwArgumentError("bad icap checksum","address",e),t=fle(e.substring(4));t.length<40;)t="0"+t;t=oM("0x"+t)}else Ig.throwArgumentError("invalid address","address",e);return t}function eg(e,t,r){Object.defineProperty(e,t,{enumerable:!0,value:r,writable:!1})}const Fle=new Uint8Array(32);Fle.fill(0),Os.from(-1);const Ble=Os.from(0),Vle=Os.from(1);Os.from("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),sd(Vle.toHexString(),32),sd(Ble.toHexString(),32);var Bc={},gr={},zE=Wz;function Wz(e,t){if(!e)throw new Error(t||"Assertion failed")}Wz.equal=function(e,t,r){if(e!=t)throw new Error(r||"Assertion failed: "+e+" != "+t)};var HO={exports:{}};typeof Object.create=="function"?HO.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:HO.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}};var $le=zE,Hle=HO.exports;gr.inherits=Hle;function zle(e,t){return(e.charCodeAt(t)&64512)!==55296||t<0||t+1>=e.length?!1:(e.charCodeAt(t+1)&64512)===56320}function Wle(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var r=[];if(typeof e=="string")if(t){if(t==="hex")for(e=e.replace(/[^a-z0-9]+/ig,""),e.length%2!==0&&(e="0"+e),i=0;i<e.length;i+=2)r.push(parseInt(e[i]+e[i+1],16))}else for(var n=0,i=0;i<e.length;i++){var s=e.charCodeAt(i);s<128?r[n++]=s:s<2048?(r[n++]=s>>6|192,r[n++]=s&63|128):zle(e,i)?(s=65536+((s&1023)<<10)+(e.charCodeAt(++i)&1023),r[n++]=s>>18|240,r[n++]=s>>12&63|128,r[n++]=s>>6&63|128,r[n++]=s&63|128):(r[n++]=s>>12|224,r[n++]=s>>6&63|128,r[n++]=s&63|128)}else for(i=0;i<e.length;i++)r[i]=e[i]|0;return r}gr.toArray=Wle;function Gle(e){for(var t="",r=0;r<e.length;r++)t+=qz(e[r].toString(16));return t}gr.toHex=Gle;function Gz(e){var t=e>>>24|e>>>8&65280|e<<8&16711680|(e&255)<<24;return t>>>0}gr.htonl=Gz;function qle(e,t){for(var r="",n=0;n<e.length;n++){var i=e[n];t==="little"&&(i=Gz(i)),r+=Kz(i.toString(16))}return r}gr.toHex32=qle;function qz(e){return e.length===1?"0"+e:e}gr.zero2=qz;function Kz(e){return e.length===7?"0"+e:e.length===6?"00"+e:e.length===5?"000"+e:e.length===4?"0000"+e:e.length===3?"00000"+e:e.length===2?"000000"+e:e.length===1?"0000000"+e:e}gr.zero8=Kz;function Kle(e,t,r,n){var i=r-t;$le(i%4===0);for(var s=new Array(i/4),o=0,a=t;o<s.length;o++,a+=4){var c;n==="big"?c=e[a]<<24|e[a+1]<<16|e[a+2]<<8|e[a+3]:c=e[a+3]<<24|e[a+2]<<16|e[a+1]<<8|e[a],s[o]=c>>>0}return s}gr.join32=Kle;function Yle(e,t){for(var r=new Array(e.length*4),n=0,i=0;n<e.length;n++,i+=4){var s=e[n];t==="big"?(r[i]=s>>>24,r[i+1]=s>>>16&255,r[i+2]=s>>>8&255,r[i+3]=s&255):(r[i+3]=s>>>24,r[i+2]=s>>>16&255,r[i+1]=s>>>8&255,r[i]=s&255)}return r}gr.split32=Yle;function Jle(e,t){return e>>>t|e<<32-t}gr.rotr32=Jle;function Xle(e,t){return e<<t|e>>>32-t}gr.rotl32=Xle;function Qle(e,t){return e+t>>>0}gr.sum32=Qle;function Zle(e,t,r){return e+t+r>>>0}gr.sum32_3=Zle;function eue(e,t,r,n){return e+t+r+n>>>0}gr.sum32_4=eue;function tue(e,t,r,n,i){return e+t+r+n+i>>>0}gr.sum32_5=tue;function rue(e,t,r,n){var i=e[t],s=e[t+1],o=n+s>>>0,a=(o<n?1:0)+r+i;e[t]=a>>>0,e[t+1]=o}gr.sum64=rue;function nue(e,t,r,n){var i=t+n>>>0,s=(i<t?1:0)+e+r;return s>>>0}gr.sum64_hi=nue;function iue(e,t,r,n){var i=t+n;return i>>>0}gr.sum64_lo=iue;function sue(e,t,r,n,i,s,o,a){var c=0,d=t;d=d+n>>>0,c+=d<t?1:0,d=d+s>>>0,c+=d<s?1:0,d=d+a>>>0,c+=d<a?1:0;var l=e+r+i+o+c;return l>>>0}gr.sum64_4_hi=sue;function oue(e,t,r,n,i,s,o,a){var c=t+n+s+a;return c>>>0}gr.sum64_4_lo=oue;function aue(e,t,r,n,i,s,o,a,c,d){var l=0,u=t;u=u+n>>>0,l+=u<t?1:0,u=u+s>>>0,l+=u<s?1:0,u=u+a>>>0,l+=u<a?1:0,u=u+d>>>0,l+=u<d?1:0;var h=e+r+i+o+c+l;return h>>>0}gr.sum64_5_hi=aue;function cue(e,t,r,n,i,s,o,a,c,d){var l=t+n+s+a+d;return l>>>0}gr.sum64_5_lo=cue;function due(e,t,r){var n=t<<32-r|e>>>r;return n>>>0}gr.rotr64_hi=due;function lue(e,t,r){var n=e<<32-r|t>>>r;return n>>>0}gr.rotr64_lo=lue;function uue(e,t,r){return e>>>r}gr.shr64_hi=uue;function hue(e,t,r){var n=e<<32-r|t>>>r;return n>>>0}gr.shr64_lo=hue;var c0={},cM=gr,fue=zE;function Fv(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}c0.BlockHash=Fv,Fv.prototype.update=function(e,t){if(e=cM.toArray(e,t),this.pending?this.pending=this.pending.concat(e):this.pending=e,this.pendingTotal+=e.length,this.pending.length>=this._delta8){e=this.pending;var r=e.length%this._delta8;this.pending=e.slice(e.length-r,e.length),this.pending.length===0&&(this.pending=null),e=cM.join32(e,0,e.length-r,this.endian);for(var n=0;n<e.length;n+=this._delta32)this._update(e,n,n+this._delta32)}return this},Fv.prototype.digest=function(e){return this.update(this._pad()),fue(this.pending===null),this._digest(e)},Fv.prototype._pad=function(){var e=this.pendingTotal,t=this._delta8,r=t-(e+this.padLength)%t,n=new Array(r+this.padLength);n[0]=128;for(var i=1;i<r;i++)n[i]=0;if(e<<=3,this.endian==="big"){for(var s=8;s<this.padLength;s++)n[i++]=0;n[i++]=0,n[i++]=0,n[i++]=0,n[i++]=0,n[i++]=e>>>24&255,n[i++]=e>>>16&255,n[i++]=e>>>8&255,n[i++]=e&255}else for(n[i++]=e&255,n[i++]=e>>>8&255,n[i++]=e>>>16&255,n[i++]=e>>>24&255,n[i++]=0,n[i++]=0,n[i++]=0,n[i++]=0,s=8;s<this.padLength;s++)n[i++]=0;return n};var gp={},wd={},pue=gr,od=pue.rotr32;function mue(e,t,r,n){if(e===0)return Yz(t,r,n);if(e===1||e===3)return Xz(t,r,n);if(e===2)return Jz(t,r,n)}wd.ft_1=mue;function Yz(e,t,r){return e&t^~e&r}wd.ch32=Yz;function Jz(e,t,r){return e&t^e&r^t&r}wd.maj32=Jz;function Xz(e,t,r){return e^t^r}wd.p32=Xz;function gue(e){return od(e,2)^od(e,13)^od(e,22)}wd.s0_256=gue;function _ue(e){return od(e,6)^od(e,11)^od(e,25)}wd.s1_256=_ue;function Eue(e){return od(e,7)^od(e,18)^e>>>3}wd.g0_256=Eue;function vue(e){return od(e,17)^od(e,19)^e>>>10}wd.g1_256=vue;var Cm=gr,yue=c0,bue=wd,bR=Cm.rotl32,tg=Cm.sum32,Sue=Cm.sum32_5,wue=bue.ft_1,Qz=yue.BlockHash,Tue=[1518500249,1859775393,2400959708,3395469782];function Gc(){if(!(this instanceof Gc))return new Gc;Qz.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}Cm.inherits(Gc,Qz);var Rue=Gc;Gc.blockSize=512,Gc.outSize=160,Gc.hmacStrength=80,Gc.padLength=64,Gc.prototype._update=function(e,t){for(var r=this.W,n=0;n<16;n++)r[n]=e[t+n];for(;n<r.length;n++)r[n]=bR(r[n-3]^r[n-8]^r[n-14]^r[n-16],1);var i=this.h[0],s=this.h[1],o=this.h[2],a=this.h[3],c=this.h[4];for(n=0;n<r.length;n++){var d=~~(n/20),l=Sue(bR(i,5),wue(d,s,o,a),c,r[n],Tue[d]);c=a,a=o,o=bR(s,30),s=i,i=l}this.h[0]=tg(this.h[0],i),this.h[1]=tg(this.h[1],s),this.h[2]=tg(this.h[2],o),this.h[3]=tg(this.h[3],a),this.h[4]=tg(this.h[4],c)},Gc.prototype._digest=function(e){return e==="hex"?Cm.toHex32(this.h,"big"):Cm.split32(this.h,"big")};var Im=gr,Aue=c0,d0=wd,Cue=zE,$a=Im.sum32,Iue=Im.sum32_4,Oue=Im.sum32_5,Nue=d0.ch32,Due=d0.maj32,Pue=d0.s0_256,kue=d0.s1_256,Lue=d0.g0_256,xue=d0.g1_256,Zz=Aue.BlockHash,Mue=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function qc(){if(!(this instanceof qc))return new qc;Zz.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=Mue,this.W=new Array(64)}Im.inherits(qc,Zz);var eW=qc;qc.blockSize=512,qc.outSize=256,qc.hmacStrength=192,qc.padLength=64,qc.prototype._update=function(e,t){for(var r=this.W,n=0;n<16;n++)r[n]=e[t+n];for(;n<r.length;n++)r[n]=Iue(xue(r[n-2]),r[n-7],Lue(r[n-15]),r[n-16]);var i=this.h[0],s=this.h[1],o=this.h[2],a=this.h[3],c=this.h[4],d=this.h[5],l=this.h[6],u=this.h[7];for(Cue(this.k.length===r.length),n=0;n<r.length;n++){var h=Oue(u,kue(c),Nue(c,d,l),this.k[n],r[n]),p=$a(Pue(i),Due(i,s,o));u=l,l=d,d=c,c=$a(a,h),a=o,o=s,s=i,i=$a(h,p)}this.h[0]=$a(this.h[0],i),this.h[1]=$a(this.h[1],s),this.h[2]=$a(this.h[2],o),this.h[3]=$a(this.h[3],a),this.h[4]=$a(this.h[4],c),this.h[5]=$a(this.h[5],d),this.h[6]=$a(this.h[6],l),this.h[7]=$a(this.h[7],u)},qc.prototype._digest=function(e){return e==="hex"?Im.toHex32(this.h,"big"):Im.split32(this.h,"big")};var zO=gr,tW=eW;function al(){if(!(this instanceof al))return new al;tW.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}zO.inherits(al,tW);var Uue=al;al.blockSize=512,al.outSize=224,al.hmacStrength=192,al.padLength=64,al.prototype._digest=function(e){return e==="hex"?zO.toHex32(this.h.slice(0,7),"big"):zO.split32(this.h.slice(0,7),"big")};var ho=gr,jue=c0,Fue=zE,ad=ho.rotr64_hi,cd=ho.rotr64_lo,rW=ho.shr64_hi,nW=ho.shr64_lo,Ll=ho.sum64,SR=ho.sum64_hi,wR=ho.sum64_lo,Bue=ho.sum64_4_hi,Vue=ho.sum64_4_lo,$ue=ho.sum64_5_hi,Hue=ho.sum64_5_lo,iW=jue.BlockHash,zue=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function rc(){if(!(this instanceof rc))return new rc;iW.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=zue,this.W=new Array(160)}ho.inherits(rc,iW);var sW=rc;rc.blockSize=1024,rc.outSize=512,rc.hmacStrength=192,rc.padLength=128,rc.prototype._prepareBlock=function(e,t){for(var r=this.W,n=0;n<32;n++)r[n]=e[t+n];for(;n<r.length;n+=2){var i=the(r[n-4],r[n-3]),s=rhe(r[n-4],r[n-3]),o=r[n-14],a=r[n-13],c=Zue(r[n-30],r[n-29]),d=ehe(r[n-30],r[n-29]),l=r[n-32],u=r[n-31];r[n]=Bue(i,s,o,a,c,d,l,u),r[n+1]=Vue(i,s,o,a,c,d,l,u)}},rc.prototype._update=function(e,t){this._prepareBlock(e,t);var r=this.W,n=this.h[0],i=this.h[1],s=this.h[2],o=this.h[3],a=this.h[4],c=this.h[5],d=this.h[6],l=this.h[7],u=this.h[8],h=this.h[9],p=this.h[10],_=this.h[11],g=this.h[12],E=this.h[13],b=this.h[14],v=this.h[15];Fue(this.k.length===r.length);for(var I=0;I<r.length;I+=2){var N=b,L=v,U=Xue(u,h),w=Que(u,h),V=Wue(u,h,p,_,g),z=Gue(u,h,p,_,g,E),K=this.k[I],H=this.k[I+1],A=r[I],m=r[I+1],S=$ue(N,L,U,w,V,z,K,H,A,m),T=Hue(N,L,U,w,V,z,K,H,A,m);N=Yue(n,i),L=Jue(n,i),U=que(n,i,s,o,a),w=Kue(n,i,s,o,a,c);var x=SR(N,L,U,w),D=wR(N,L,U,w);b=g,v=E,g=p,E=_,p=u,_=h,u=SR(d,l,S,T),h=wR(l,l,S,T),d=a,l=c,a=s,c=o,s=n,o=i,n=SR(S,T,x,D),i=wR(S,T,x,D)}Ll(this.h,0,n,i),Ll(this.h,2,s,o),Ll(this.h,4,a,c),Ll(this.h,6,d,l),Ll(this.h,8,u,h),Ll(this.h,10,p,_),Ll(this.h,12,g,E),Ll(this.h,14,b,v)},rc.prototype._digest=function(e){return e==="hex"?ho.toHex32(this.h,"big"):ho.split32(this.h,"big")};function Wue(e,t,r,n,i){var s=e&r^~e&i;return s<0&&(s+=4294967296),s}function Gue(e,t,r,n,i,s){var o=t&n^~t&s;return o<0&&(o+=4294967296),o}function que(e,t,r,n,i){var s=e&r^e&i^r&i;return s<0&&(s+=4294967296),s}function Kue(e,t,r,n,i,s){var o=t&n^t&s^n&s;return o<0&&(o+=4294967296),o}function Yue(e,t){var r=ad(e,t,28),n=ad(t,e,2),i=ad(t,e,7),s=r^n^i;return s<0&&(s+=4294967296),s}function Jue(e,t){var r=cd(e,t,28),n=cd(t,e,2),i=cd(t,e,7),s=r^n^i;return s<0&&(s+=4294967296),s}function Xue(e,t){var r=ad(e,t,14),n=ad(e,t,18),i=ad(t,e,9),s=r^n^i;return s<0&&(s+=4294967296),s}function Que(e,t){var r=cd(e,t,14),n=cd(e,t,18),i=cd(t,e,9),s=r^n^i;return s<0&&(s+=4294967296),s}function Zue(e,t){var r=ad(e,t,1),n=ad(e,t,8),i=rW(e,t,7),s=r^n^i;return s<0&&(s+=4294967296),s}function ehe(e,t){var r=cd(e,t,1),n=cd(e,t,8),i=nW(e,t,7),s=r^n^i;return s<0&&(s+=4294967296),s}function the(e,t){var r=ad(e,t,19),n=ad(t,e,29),i=rW(e,t,6),s=r^n^i;return s<0&&(s+=4294967296),s}function rhe(e,t){var r=cd(e,t,19),n=cd(t,e,29),i=nW(e,t,6),s=r^n^i;return s<0&&(s+=4294967296),s}var WO=gr,oW=sW;function cl(){if(!(this instanceof cl))return new cl;oW.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}WO.inherits(cl,oW);var nhe=cl;cl.blockSize=1024,cl.outSize=384,cl.hmacStrength=192,cl.padLength=128,cl.prototype._digest=function(e){return e==="hex"?WO.toHex32(this.h.slice(0,12),"big"):WO.split32(this.h.slice(0,12),"big")},gp.sha1=Rue,gp.sha224=Uue,gp.sha256=eW,gp.sha384=nhe,gp.sha512=sW;var aW={},Qh=gr,ihe=c0,Bv=Qh.rotl32,dM=Qh.sum32,rg=Qh.sum32_3,lM=Qh.sum32_4,cW=ihe.BlockHash;function Vc(){if(!(this instanceof Vc))return new Vc;cW.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}Qh.inherits(Vc,cW),aW.ripemd160=Vc,Vc.blockSize=512,Vc.outSize=160,Vc.hmacStrength=192,Vc.padLength=64,Vc.prototype._update=function(e,t){for(var r=this.h[0],n=this.h[1],i=this.h[2],s=this.h[3],o=this.h[4],a=r,c=n,d=i,l=s,u=o,h=0;h<80;h++){var p=dM(Bv(lM(r,uM(h,n,i,s),e[ahe[h]+t],she(h)),dhe[h]),o);r=o,o=s,s=Bv(i,10),i=n,n=p,p=dM(Bv(lM(a,uM(79-h,c,d,l),e[che[h]+t],ohe(h)),lhe[h]),u),a=u,u=l,l=Bv(d,10),d=c,c=p}p=rg(this.h[1],i,l),this.h[1]=rg(this.h[2],s,u),this.h[2]=rg(this.h[3],o,a),this.h[3]=rg(this.h[4],r,c),this.h[4]=rg(this.h[0],n,d),this.h[0]=p},Vc.prototype._digest=function(e){return e==="hex"?Qh.toHex32(this.h,"little"):Qh.split32(this.h,"little")};function uM(e,t,r,n){return e<=15?t^r^n:e<=31?t&r|~t&n:e<=47?(t|~r)^n:e<=63?t&n|r&~n:t^(r|~n)}function she(e){return e<=15?0:e<=31?1518500249:e<=47?1859775393:e<=63?2400959708:2840853838}function ohe(e){return e<=15?1352829926:e<=31?1548603684:e<=47?1836072691:e<=63?2053994217:0}var ahe=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],che=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],dhe=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],lhe=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],uhe=gr,hhe=zE;function sm(e,t,r){if(!(this instanceof sm))return new sm(e,t,r);this.Hash=e,this.blockSize=e.blockSize/8,this.outSize=e.outSize/8,this.inner=null,this.outer=null,this._init(uhe.toArray(t,r))}var fhe=sm;sm.prototype._init=function(e){e.length>this.blockSize&&(e=new this.Hash().update(e).digest()),hhe(e.length<=this.blockSize);for(var t=e.length;t<this.blockSize;t++)e.push(0);for(t=0;t<e.length;t++)e[t]^=54;for(this.inner=new this.Hash().update(e),t=0;t<e.length;t++)e[t]^=106;this.outer=new this.Hash().update(e)},sm.prototype.update=function(e,t){return this.inner.update(e,t),this},sm.prototype.digest=function(e){return this.outer.update(this.inner.digest()),this.outer.digest(e)},function(e){var t=e;t.utils=gr,t.common=c0,t.sha=gp,t.ripemd=aW,t.hmac=fhe,t.sha1=t.sha.sha1,t.sha256=t.sha.sha256,t.sha224=t.sha.sha224,t.sha384=t.sha.sha384,t.sha512=t.sha.sha512,t.ripemd160=t.ripemd.ripemd160}(Bc);function l0(e,t,r){return r={path:t,exports:{},require:function(n,i){return phe(n,i??r.path)}},e(r,r.exports),r.exports}function phe(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var oP=dW;function dW(e,t){if(!e)throw new Error(t||"Assertion failed")}dW.equal=function(e,t,r){if(e!=t)throw new Error(r||"Assertion failed: "+e+" != "+t)};var dc=l0(function(e,t){var r=t;function n(o,a){if(Array.isArray(o))return o.slice();if(!o)return[];var c=[];if(typeof o!="string"){for(var d=0;d<o.length;d++)c[d]=o[d]|0;return c}if(a==="hex"){o=o.replace(/[^a-z0-9]+/ig,""),o.length%2!==0&&(o="0"+o);for(var d=0;d<o.length;d+=2)c.push(parseInt(o[d]+o[d+1],16))}else for(var d=0;d<o.length;d++){var l=o.charCodeAt(d),u=l>>8,h=l&255;u?c.push(u,h):c.push(h)}return c}r.toArray=n;function i(o){return o.length===1?"0"+o:o}r.zero2=i;function s(o){for(var a="",c=0;c<o.length;c++)a+=i(o[c].toString(16));return a}r.toHex=s,r.encode=function(o,a){return a==="hex"?s(o):o}}),Bo=l0(function(e,t){var r=t;r.assert=oP,r.toArray=dc.toArray,r.zero2=dc.zero2,r.toHex=dc.toHex,r.encode=dc.encode;function n(c,d,l){var u=new Array(Math.max(c.bitLength(),l)+1);u.fill(0);for(var h=1<<d+1,p=c.clone(),_=0;_<u.length;_++){var g,E=p.andln(h-1);p.isOdd()?(E>(h>>1)-1?g=(h>>1)-E:g=E,p.isubn(g)):g=0,u[_]=g,p.iushrn(1)}return u}r.getNAF=n;function i(c,d){var l=[[],[]];c=c.clone(),d=d.clone();for(var u=0,h=0,p;c.cmpn(-u)>0||d.cmpn(-h)>0;){var _=c.andln(3)+u&3,g=d.andln(3)+h&3;_===3&&(_=-1),g===3&&(g=-1);var E;_&1?(p=c.andln(7)+u&7,(p===3||p===5)&&g===2?E=-_:E=_):E=0,l[0].push(E);var b;g&1?(p=d.andln(7)+h&7,(p===3||p===5)&&_===2?b=-g:b=g):b=0,l[1].push(b),2*u===E+1&&(u=1-u),2*h===b+1&&(h=1-h),c.iushrn(1),d.iushrn(1)}return l}r.getJSF=i;function s(c,d,l){var u="_"+d;c.prototype[d]=function(){return this[u]!==void 0?this[u]:this[u]=l.call(this)}}r.cachedProperty=s;function o(c){return typeof c=="string"?r.toArray(c,"hex"):c}r.parseBytes=o;function a(c){return new zt(c,"hex","le")}r.intFromLE=a}),Vv=Bo.getNAF,mhe=Bo.getJSF,M1=Bo.assert;function nu(e,t){this.type=e,this.p=new zt(t.p,16),this.red=t.prime?zt.red(t.prime):zt.mont(this.p),this.zero=new zt(0).toRed(this.red),this.one=new zt(1).toRed(this.red),this.two=new zt(2).toRed(this.red),this.n=t.n&&new zt(t.n,16),this.g=t.g&&this.pointFromJSON(t.g,t.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var r=this.n&&this.p.div(this.n);!r||r.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}var kf=nu;nu.prototype.point=function(){throw new Error("Not implemented")},nu.prototype.validate=function(){throw new Error("Not implemented")},nu.prototype._fixedNafMul=function(e,t){M1(e.precomputed);var r=e._getDoubles(),n=Vv(t,1,this._bitLength),i=(1<<r.step+1)-(r.step%2===0?2:1);i/=3;var s=[],o,a;for(o=0;o<n.length;o+=r.step){a=0;for(var c=o+r.step-1;c>=o;c--)a=(a<<1)+n[c];s.push(a)}for(var d=this.jpoint(null,null,null),l=this.jpoint(null,null,null),u=i;u>0;u--){for(o=0;o<s.length;o++)a=s[o],a===u?l=l.mixedAdd(r.points[o]):a===-u&&(l=l.mixedAdd(r.points[o].neg()));d=d.add(l)}return d.toP()},nu.prototype._wnafMul=function(e,t){var r=4,n=e._getNAFPoints(r);r=n.wnd;for(var i=n.points,s=Vv(t,r,this._bitLength),o=this.jpoint(null,null,null),a=s.length-1;a>=0;a--){for(var c=0;a>=0&&s[a]===0;a--)c++;if(a>=0&&c++,o=o.dblp(c),a<0)break;var d=s[a];M1(d!==0),e.type==="affine"?d>0?o=o.mixedAdd(i[d-1>>1]):o=o.mixedAdd(i[-d-1>>1].neg()):d>0?o=o.add(i[d-1>>1]):o=o.add(i[-d-1>>1].neg())}return e.type==="affine"?o.toP():o},nu.prototype._wnafMulAdd=function(e,t,r,n,i){var s=this._wnafT1,o=this._wnafT2,a=this._wnafT3,c=0,d,l,u;for(d=0;d<n;d++){u=t[d];var h=u._getNAFPoints(e);s[d]=h.wnd,o[d]=h.points}for(d=n-1;d>=1;d-=2){var p=d-1,_=d;if(s[p]!==1||s[_]!==1){a[p]=Vv(r[p],s[p],this._bitLength),a[_]=Vv(r[_],s[_],this._bitLength),c=Math.max(a[p].length,c),c=Math.max(a[_].length,c);continue}var g=[t[p],null,null,t[_]];t[p].y.cmp(t[_].y)===0?(g[1]=t[p].add(t[_]),g[2]=t[p].toJ().mixedAdd(t[_].neg())):t[p].y.cmp(t[_].y.redNeg())===0?(g[1]=t[p].toJ().mixedAdd(t[_]),g[2]=t[p].add(t[_].neg())):(g[1]=t[p].toJ().mixedAdd(t[_]),g[2]=t[p].toJ().mixedAdd(t[_].neg()));var E=[-3,-1,-5,-7,0,7,5,1,3],b=mhe(r[p],r[_]);for(c=Math.max(b[0].length,c),a[p]=new Array(c),a[_]=new Array(c),l=0;l<c;l++){var v=b[0][l]|0,I=b[1][l]|0;a[p][l]=E[(v+1)*3+(I+1)],a[_][l]=0,o[p]=g}}var N=this.jpoint(null,null,null),L=this._wnafT4;for(d=c;d>=0;d--){for(var U=0;d>=0;){var w=!0;for(l=0;l<n;l++)L[l]=a[l][d]|0,L[l]!==0&&(w=!1);if(!w)break;U++,d--}if(d>=0&&U++,N=N.dblp(U),d<0)break;for(l=0;l<n;l++){var V=L[l];V!==0&&(V>0?u=o[l][V-1>>1]:V<0&&(u=o[l][-V-1>>1].neg()),u.type==="affine"?N=N.mixedAdd(u):N=N.add(u))}}for(d=0;d<n;d++)o[d]=null;return i?N:N.toP()};function ta(e,t){this.curve=e,this.type=t,this.precomputed=null}nu.BasePoint=ta,ta.prototype.eq=function(){throw new Error("Not implemented")},ta.prototype.validate=function(){return this.curve.validate(this)},nu.prototype.decodePoint=function(e,t){e=Bo.toArray(e,t);var r=this.p.byteLength();if((e[0]===4||e[0]===6||e[0]===7)&&e.length-1===2*r){e[0]===6?M1(e[e.length-1]%2===0):e[0]===7&&M1(e[e.length-1]%2===1);var n=this.point(e.slice(1,1+r),e.slice(1+r,1+2*r));return n}else if((e[0]===2||e[0]===3)&&e.length-1===r)return this.pointFromX(e.slice(1,1+r),e[0]===3);throw new Error("Unknown point format")},ta.prototype.encodeCompressed=function(e){return this.encode(e,!0)},ta.prototype._encode=function(e){var t=this.curve.p.byteLength(),r=this.getX().toArray("be",t);return e?[this.getY().isEven()?2:3].concat(r):[4].concat(r,this.getY().toArray("be",t))},ta.prototype.encode=function(e,t){return Bo.encode(this._encode(t),e)},ta.prototype.precompute=function(e){if(this.precomputed)return this;var t={doubles:null,naf:null,beta:null};return t.naf=this._getNAFPoints(8),t.doubles=this._getDoubles(4,e),t.beta=this._getBeta(),this.precomputed=t,this},ta.prototype._hasDoubles=function(e){if(!this.precomputed)return!1;var t=this.precomputed.doubles;return t?t.points.length>=Math.ceil((e.bitLength()+1)/t.step):!1},ta.prototype._getDoubles=function(e,t){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var r=[this],n=this,i=0;i<t;i+=e){for(var s=0;s<e;s++)n=n.dbl();r.push(n)}return{step:e,points:r}},ta.prototype._getNAFPoints=function(e){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var t=[this],r=(1<<e)-1,n=r===1?null:this.dbl(),i=1;i<r;i++)t[i]=t[i-1].add(n);return{wnd:e,points:t}},ta.prototype._getBeta=function(){return null},ta.prototype.dblp=function(e){for(var t=this,r=0;r<e;r++)t=t.dbl();return t};var aP=l0(function(e){typeof Object.create=="function"?e.exports=function(t,r){r&&(t.super_=r,t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(t,r){if(r){t.super_=r;var n=function(){};n.prototype=r.prototype,t.prototype=new n,t.prototype.constructor=t}}}),ghe=Bo.assert;function ba(e){kf.call(this,"short",e),this.a=new zt(e.a,16).toRed(this.red),this.b=new zt(e.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=this.a.fromRed().cmpn(0)===0,this.threeA=this.a.fromRed().sub(this.p).cmpn(-3)===0,this.endo=this._getEndomorphism(e),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}aP(ba,kf);var _he=ba;ba.prototype._getEndomorphism=function(e){if(!(!this.zeroA||!this.g||!this.n||this.p.modn(3)!==1)){var t,r;if(e.beta)t=new zt(e.beta,16).toRed(this.red);else{var n=this._getEndoRoots(this.p);t=n[0].cmp(n[1])<0?n[0]:n[1],t=t.toRed(this.red)}if(e.lambda)r=new zt(e.lambda,16);else{var i=this._getEndoRoots(this.n);this.g.mul(i[0]).x.cmp(this.g.x.redMul(t))===0?r=i[0]:(r=i[1],ghe(this.g.mul(r).x.cmp(this.g.x.redMul(t))===0))}var s;return e.basis?s=e.basis.map(function(o){return{a:new zt(o.a,16),b:new zt(o.b,16)}}):s=this._getEndoBasis(r),{beta:t,lambda:r,basis:s}}},ba.prototype._getEndoRoots=function(e){var t=e===this.p?this.red:zt.mont(e),r=new zt(2).toRed(t).redInvm(),n=r.redNeg(),i=new zt(3).toRed(t).redNeg().redSqrt().redMul(r),s=n.redAdd(i).fromRed(),o=n.redSub(i).fromRed();return[s,o]},ba.prototype._getEndoBasis=function(e){for(var t=this.n.ushrn(Math.floor(this.n.bitLength()/2)),r=e,n=this.n.clone(),i=new zt(1),s=new zt(0),o=new zt(0),a=new zt(1),c,d,l,u,h,p,_,g=0,E,b;r.cmpn(0)!==0;){var v=n.div(r);E=n.sub(v.mul(r)),b=o.sub(v.mul(i));var I=a.sub(v.mul(s));if(!l&&E.cmp(t)<0)c=_.neg(),d=i,l=E.neg(),u=b;else if(l&&++g===2)break;_=E,n=r,r=E,o=i,i=b,a=s,s=I}h=E.neg(),p=b;var N=l.sqr().add(u.sqr()),L=h.sqr().add(p.sqr());return L.cmp(N)>=0&&(h=c,p=d),l.negative&&(l=l.neg(),u=u.neg()),h.negative&&(h=h.neg(),p=p.neg()),[{a:l,b:u},{a:h,b:p}]},ba.prototype._endoSplit=function(e){var t=this.endo.basis,r=t[0],n=t[1],i=n.b.mul(e).divRound(this.n),s=r.b.neg().mul(e).divRound(this.n),o=i.mul(r.a),a=s.mul(n.a),c=i.mul(r.b),d=s.mul(n.b),l=e.sub(o).sub(a),u=c.add(d).neg();return{k1:l,k2:u}},ba.prototype.pointFromX=function(e,t){e=new zt(e,16),e.red||(e=e.toRed(this.red));var r=e.redSqr().redMul(e).redIAdd(e.redMul(this.a)).redIAdd(this.b),n=r.redSqrt();if(n.redSqr().redSub(r).cmp(this.zero)!==0)throw new Error("invalid point");var i=n.fromRed().isOdd();return(t&&!i||!t&&i)&&(n=n.redNeg()),this.point(e,n)},ba.prototype.validate=function(e){if(e.inf)return!0;var t=e.x,r=e.y,n=this.a.redMul(t),i=t.redSqr().redMul(t).redIAdd(n).redIAdd(this.b);return r.redSqr().redISub(i).cmpn(0)===0},ba.prototype._endoWnafMulAdd=function(e,t,r){for(var n=this._endoWnafT1,i=this._endoWnafT2,s=0;s<e.length;s++){var o=this._endoSplit(t[s]),a=e[s],c=a._getBeta();o.k1.negative&&(o.k1.ineg(),a=a.neg(!0)),o.k2.negative&&(o.k2.ineg(),c=c.neg(!0)),n[s*2]=a,n[s*2+1]=c,i[s*2]=o.k1,i[s*2+1]=o.k2}for(var d=this._wnafMulAdd(1,n,i,s*2,r),l=0;l<s*2;l++)n[l]=null,i[l]=null;return d};function Ei(e,t,r,n){kf.BasePoint.call(this,e,"affine"),t===null&&r===null?(this.x=null,this.y=null,this.inf=!0):(this.x=new zt(t,16),this.y=new zt(r,16),n&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}aP(Ei,kf.BasePoint),ba.prototype.point=function(e,t,r){return new Ei(this,e,t,r)},ba.prototype.pointFromJSON=function(e,t){return Ei.fromJSON(this,e,t)},Ei.prototype._getBeta=function(){if(this.curve.endo){var e=this.precomputed;if(e&&e.beta)return e.beta;var t=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(e){var r=this.curve,n=function(i){return r.point(i.x.redMul(r.endo.beta),i.y)};e.beta=t,t.precomputed={beta:null,naf:e.naf&&{wnd:e.naf.wnd,points:e.naf.points.map(n)},doubles:e.doubles&&{step:e.doubles.step,points:e.doubles.points.map(n)}}}return t}},Ei.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},Ei.fromJSON=function(e,t,r){typeof t=="string"&&(t=JSON.parse(t));var n=e.point(t[0],t[1],r);if(!t[2])return n;function i(o){return e.point(o[0],o[1],r)}var s=t[2];return n.precomputed={beta:null,doubles:s.doubles&&{step:s.doubles.step,points:[n].concat(s.doubles.points.map(i))},naf:s.naf&&{wnd:s.naf.wnd,points:[n].concat(s.naf.points.map(i))}},n},Ei.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},Ei.prototype.isInfinity=function(){return this.inf},Ei.prototype.add=function(e){if(this.inf)return e;if(e.inf)return this;if(this.eq(e))return this.dbl();if(this.neg().eq(e))return this.curve.point(null,null);if(this.x.cmp(e.x)===0)return this.curve.point(null,null);var t=this.y.redSub(e.y);t.cmpn(0)!==0&&(t=t.redMul(this.x.redSub(e.x).redInvm()));var r=t.redSqr().redISub(this.x).redISub(e.x),n=t.redMul(this.x.redSub(r)).redISub(this.y);return this.curve.point(r,n)},Ei.prototype.dbl=function(){if(this.inf)return this;var e=this.y.redAdd(this.y);if(e.cmpn(0)===0)return this.curve.point(null,null);var t=this.curve.a,r=this.x.redSqr(),n=e.redInvm(),i=r.redAdd(r).redIAdd(r).redIAdd(t).redMul(n),s=i.redSqr().redISub(this.x.redAdd(this.x)),o=i.redMul(this.x.redSub(s)).redISub(this.y);return this.curve.point(s,o)},Ei.prototype.getX=function(){return this.x.fromRed()},Ei.prototype.getY=function(){return this.y.fromRed()},Ei.prototype.mul=function(e){return e=new zt(e,16),this.isInfinity()?this:this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve.endo?this.curve._endoWnafMulAdd([this],[e]):this.curve._wnafMul(this,e)},Ei.prototype.mulAdd=function(e,t,r){var n=[this,t],i=[e,r];return this.curve.endo?this.curve._endoWnafMulAdd(n,i):this.curve._wnafMulAdd(1,n,i,2)},Ei.prototype.jmulAdd=function(e,t,r){var n=[this,t],i=[e,r];return this.curve.endo?this.curve._endoWnafMulAdd(n,i,!0):this.curve._wnafMulAdd(1,n,i,2,!0)},Ei.prototype.eq=function(e){return this===e||this.inf===e.inf&&(this.inf||this.x.cmp(e.x)===0&&this.y.cmp(e.y)===0)},Ei.prototype.neg=function(e){if(this.inf)return this;var t=this.curve.point(this.x,this.y.redNeg());if(e&&this.precomputed){var r=this.precomputed,n=function(i){return i.neg()};t.precomputed={naf:r.naf&&{wnd:r.naf.wnd,points:r.naf.points.map(n)},doubles:r.doubles&&{step:r.doubles.step,points:r.doubles.points.map(n)}}}return t},Ei.prototype.toJ=function(){if(this.inf)return this.curve.jpoint(null,null,null);var e=this.curve.jpoint(this.x,this.y,this.curve.one);return e};function xi(e,t,r,n){kf.BasePoint.call(this,e,"jacobian"),t===null&&r===null&&n===null?(this.x=this.curve.one,this.y=this.curve.one,this.z=new zt(0)):(this.x=new zt(t,16),this.y=new zt(r,16),this.z=new zt(n,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}aP(xi,kf.BasePoint),ba.prototype.jpoint=function(e,t,r){return new xi(this,e,t,r)},xi.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var e=this.z.redInvm(),t=e.redSqr(),r=this.x.redMul(t),n=this.y.redMul(t).redMul(e);return this.curve.point(r,n)},xi.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},xi.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var t=e.z.redSqr(),r=this.z.redSqr(),n=this.x.redMul(t),i=e.x.redMul(r),s=this.y.redMul(t.redMul(e.z)),o=e.y.redMul(r.redMul(this.z)),a=n.redSub(i),c=s.redSub(o);if(a.cmpn(0)===0)return c.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var d=a.redSqr(),l=d.redMul(a),u=n.redMul(d),h=c.redSqr().redIAdd(l).redISub(u).redISub(u),p=c.redMul(u.redISub(h)).redISub(s.redMul(l)),_=this.z.redMul(e.z).redMul(a);return this.curve.jpoint(h,p,_)},xi.prototype.mixedAdd=function(e){if(this.isInfinity())return e.toJ();if(e.isInfinity())return this;var t=this.z.redSqr(),r=this.x,n=e.x.redMul(t),i=this.y,s=e.y.redMul(t).redMul(this.z),o=r.redSub(n),a=i.redSub(s);if(o.cmpn(0)===0)return a.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var c=o.redSqr(),d=c.redMul(o),l=r.redMul(c),u=a.redSqr().redIAdd(d).redISub(l).redISub(l),h=a.redMul(l.redISub(u)).redISub(i.redMul(d)),p=this.z.redMul(o);return this.curve.jpoint(u,h,p)},xi.prototype.dblp=function(e){if(e===0)return this;if(this.isInfinity())return this;if(!e)return this.dbl();var t;if(this.curve.zeroA||this.curve.threeA){var r=this;for(t=0;t<e;t++)r=r.dbl();return r}var n=this.curve.a,i=this.curve.tinv,s=this.x,o=this.y,a=this.z,c=a.redSqr().redSqr(),d=o.redAdd(o);for(t=0;t<e;t++){var l=s.redSqr(),u=d.redSqr(),h=u.redSqr(),p=l.redAdd(l).redIAdd(l).redIAdd(n.redMul(c)),_=s.redMul(u),g=p.redSqr().redISub(_.redAdd(_)),E=_.redISub(g),b=p.redMul(E);b=b.redIAdd(b).redISub(h);var v=d.redMul(a);t+1<e&&(c=c.redMul(h)),s=g,a=v,d=b}return this.curve.jpoint(s,d.redMul(i),a)},xi.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},xi.prototype._zeroDbl=function(){var e,t,r;if(this.zOne){var n=this.x.redSqr(),i=this.y.redSqr(),s=i.redSqr(),o=this.x.redAdd(i).redSqr().redISub(n).redISub(s);o=o.redIAdd(o);var a=n.redAdd(n).redIAdd(n),c=a.redSqr().redISub(o).redISub(o),d=s.redIAdd(s);d=d.redIAdd(d),d=d.redIAdd(d),e=c,t=a.redMul(o.redISub(c)).redISub(d),r=this.y.redAdd(this.y)}else{var l=this.x.redSqr(),u=this.y.redSqr(),h=u.redSqr(),p=this.x.redAdd(u).redSqr().redISub(l).redISub(h);p=p.redIAdd(p);var _=l.redAdd(l).redIAdd(l),g=_.redSqr(),E=h.redIAdd(h);E=E.redIAdd(E),E=E.redIAdd(E),e=g.redISub(p).redISub(p),t=_.redMul(p.redISub(e)).redISub(E),r=this.y.redMul(this.z),r=r.redIAdd(r)}return this.curve.jpoint(e,t,r)},xi.prototype._threeDbl=function(){var e,t,r;if(this.zOne){var n=this.x.redSqr(),i=this.y.redSqr(),s=i.redSqr(),o=this.x.redAdd(i).redSqr().redISub(n).redISub(s);o=o.redIAdd(o);var a=n.redAdd(n).redIAdd(n).redIAdd(this.curve.a),c=a.redSqr().redISub(o).redISub(o);e=c;var d=s.redIAdd(s);d=d.redIAdd(d),d=d.redIAdd(d),t=a.redMul(o.redISub(c)).redISub(d),r=this.y.redAdd(this.y)}else{var l=this.z.redSqr(),u=this.y.redSqr(),h=this.x.redMul(u),p=this.x.redSub(l).redMul(this.x.redAdd(l));p=p.redAdd(p).redIAdd(p);var _=h.redIAdd(h);_=_.redIAdd(_);var g=_.redAdd(_);e=p.redSqr().redISub(g),r=this.y.redAdd(this.z).redSqr().redISub(u).redISub(l);var E=u.redSqr();E=E.redIAdd(E),E=E.redIAdd(E),E=E.redIAdd(E),t=p.redMul(_.redISub(e)).redISub(E)}return this.curve.jpoint(e,t,r)},xi.prototype._dbl=function(){var e=this.curve.a,t=this.x,r=this.y,n=this.z,i=n.redSqr().redSqr(),s=t.redSqr(),o=r.redSqr(),a=s.redAdd(s).redIAdd(s).redIAdd(e.redMul(i)),c=t.redAdd(t);c=c.redIAdd(c);var d=c.redMul(o),l=a.redSqr().redISub(d.redAdd(d)),u=d.redISub(l),h=o.redSqr();h=h.redIAdd(h),h=h.redIAdd(h),h=h.redIAdd(h);var p=a.redMul(u).redISub(h),_=r.redAdd(r).redMul(n);return this.curve.jpoint(l,p,_)},xi.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var e=this.x.redSqr(),t=this.y.redSqr(),r=this.z.redSqr(),n=t.redSqr(),i=e.redAdd(e).redIAdd(e),s=i.redSqr(),o=this.x.redAdd(t).redSqr().redISub(e).redISub(n);o=o.redIAdd(o),o=o.redAdd(o).redIAdd(o),o=o.redISub(s);var a=o.redSqr(),c=n.redIAdd(n);c=c.redIAdd(c),c=c.redIAdd(c),c=c.redIAdd(c);var d=i.redIAdd(o).redSqr().redISub(s).redISub(a).redISub(c),l=t.redMul(d);l=l.redIAdd(l),l=l.redIAdd(l);var u=this.x.redMul(a).redISub(l);u=u.redIAdd(u),u=u.redIAdd(u);var h=this.y.redMul(d.redMul(c.redISub(d)).redISub(o.redMul(a)));h=h.redIAdd(h),h=h.redIAdd(h),h=h.redIAdd(h);var p=this.z.redAdd(o).redSqr().redISub(r).redISub(a);return this.curve.jpoint(u,h,p)},xi.prototype.mul=function(e,t){return e=new zt(e,t),this.curve._wnafMul(this,e)},xi.prototype.eq=function(e){if(e.type==="affine")return this.eq(e.toJ());if(this===e)return!0;var t=this.z.redSqr(),r=e.z.redSqr();if(this.x.redMul(r).redISub(e.x.redMul(t)).cmpn(0)!==0)return!1;var n=t.redMul(this.z),i=r.redMul(e.z);return this.y.redMul(i).redISub(e.y.redMul(n)).cmpn(0)===0},xi.prototype.eqXToP=function(e){var t=this.z.redSqr(),r=e.toRed(this.curve.red).redMul(t);if(this.x.cmp(r)===0)return!0;for(var n=e.clone(),i=this.curve.redN.redMul(t);;){if(n.iadd(this.curve.n),n.cmp(this.curve.p)>=0)return!1;if(r.redIAdd(i),this.x.cmp(r)===0)return!0}},xi.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},xi.prototype.isInfinity=function(){return this.z.cmpn(0)===0};var db=l0(function(e,t){var r=t;r.base=kf,r.short=_he,r.mont=null,r.edwards=null}),lb=l0(function(e,t){var r=t,n=Bo.assert;function i(a){a.type==="short"?this.curve=new db.short(a):a.type==="edwards"?this.curve=new db.edwards(a):this.curve=new db.mont(a),this.g=this.curve.g,this.n=this.curve.n,this.hash=a.hash,n(this.g.validate(),"Invalid curve"),n(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}r.PresetCurve=i;function s(a,c){Object.defineProperty(r,a,{configurable:!0,enumerable:!0,get:function(){var d=new i(c);return Object.defineProperty(r,a,{configurable:!0,enumerable:!0,value:d}),d}})}s("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:Bc.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),s("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:Bc.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),s("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:Bc.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),s("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:Bc.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),s("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:Bc.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),s("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:Bc.sha256,gRed:!1,g:["9"]}),s("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:Bc.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});var o;try{o=null.crash()}catch{o=void 0}s("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:Bc.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",o]})});function iu(e){if(!(this instanceof iu))return new iu(e);this.hash=e.hash,this.predResist=!!e.predResist,this.outLen=this.hash.outSize,this.minEntropy=e.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var t=dc.toArray(e.entropy,e.entropyEnc||"hex"),r=dc.toArray(e.nonce,e.nonceEnc||"hex"),n=dc.toArray(e.pers,e.persEnc||"hex");oP(t.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(t,r,n)}var hM=iu;iu.prototype._init=function(e,t,r){var n=e.concat(t).concat(r);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var i=0;i<this.V.length;i++)this.K[i]=0,this.V[i]=1;this._update(n),this._reseed=1,this.reseedInterval=281474976710656},iu.prototype._hmac=function(){return new Bc.hmac(this.hash,this.K)},iu.prototype._update=function(e){var t=this._hmac().update(this.V).update([0]);e&&(t=t.update(e)),this.K=t.digest(),this.V=this._hmac().update(this.V).digest(),e&&(this.K=this._hmac().update(this.V).update([1]).update(e).digest(),this.V=this._hmac().update(this.V).digest())},iu.prototype.reseed=function(e,t,r,n){typeof t!="string"&&(n=r,r=t,t=null),e=dc.toArray(e,t),r=dc.toArray(r,n),oP(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(e.concat(r||[])),this._reseed=1},iu.prototype.generate=function(e,t,r,n){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");typeof t!="string"&&(n=r,r=t,t=null),r&&(r=dc.toArray(r,n||"hex"),this._update(r));for(var i=[];i.length<e;)this.V=this._hmac().update(this.V).digest(),i=i.concat(this.V);var s=i.slice(0,e);return this._update(r),this._reseed++,dc.encode(s,t)};var TR=Bo.assert;function ts(e,t){this.ec=e,this.priv=null,this.pub=null,t.priv&&this._importPrivate(t.priv,t.privEnc),t.pub&&this._importPublic(t.pub,t.pubEnc)}var RR=ts;ts.fromPublic=function(e,t,r){return t instanceof ts?t:new ts(e,{pub:t,pubEnc:r})},ts.fromPrivate=function(e,t,r){return t instanceof ts?t:new ts(e,{priv:t,privEnc:r})},ts.prototype.validate=function(){var e=this.getPublic();return e.isInfinity()?{result:!1,reason:"Invalid public key"}:e.validate()?e.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},ts.prototype.getPublic=function(e,t){return typeof e=="string"&&(t=e,e=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),t?this.pub.encode(t,e):this.pub},ts.prototype.getPrivate=function(e){return e==="hex"?this.priv.toString(16,2):this.priv},ts.prototype._importPrivate=function(e,t){this.priv=new zt(e,t||16),this.priv=this.priv.umod(this.ec.curve.n)},ts.prototype._importPublic=function(e,t){if(e.x||e.y){this.ec.curve.type==="mont"?TR(e.x,"Need x coordinate"):(this.ec.curve.type==="short"||this.ec.curve.type==="edwards")&&TR(e.x&&e.y,"Need both x and y coordinate"),this.pub=this.ec.curve.point(e.x,e.y);return}this.pub=this.ec.curve.decodePoint(e,t)},ts.prototype.derive=function(e){return e.validate()||TR(e.validate(),"public point not validated"),e.mul(this.priv).getX()},ts.prototype.sign=function(e,t,r){return this.ec.sign(e,this,t,r)},ts.prototype.verify=function(e,t){return this.ec.verify(e,t,this)},ts.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"};var Ehe=Bo.assert;function _w(e,t){if(e instanceof _w)return e;this._importDER(e,t)||(Ehe(e.r&&e.s,"Signature without r or s"),this.r=new zt(e.r,16),this.s=new zt(e.s,16),e.recoveryParam===void 0?this.recoveryParam=null:this.recoveryParam=e.recoveryParam)}var $v=_w;function vhe(){this.place=0}function AR(e,t){var r=e[t.place++];if(!(r&128))return r;var n=r&15;if(n===0||n>4)return!1;for(var i=0,s=0,o=t.place;s<n;s++,o++)i<<=8,i|=e[o],i>>>=0;return i<=127?!1:(t.place=o,i)}function fM(e){for(var t=0,r=e.length-1;!e[t]&&!(e[t+1]&128)&&t<r;)t++;return t===0?e:e.slice(t)}_w.prototype._importDER=function(e,t){e=Bo.toArray(e,t);var r=new vhe;if(e[r.place++]!==48)return!1;var n=AR(e,r);if(n===!1||n+r.place!==e.length||e[r.place++]!==2)return!1;var i=AR(e,r);if(i===!1)return!1;var s=e.slice(r.place,i+r.place);if(r.place+=i,e[r.place++]!==2)return!1;var o=AR(e,r);if(o===!1||e.length!==o+r.place)return!1;var a=e.slice(r.place,o+r.place);if(s[0]===0)if(s[1]&128)s=s.slice(1);else return!1;if(a[0]===0)if(a[1]&128)a=a.slice(1);else return!1;return this.r=new zt(s),this.s=new zt(a),this.recoveryParam=null,!0};function CR(e,t){if(t<128){e.push(t);return}var r=1+(Math.log(t)/Math.LN2>>>3);for(e.push(r|128);--r;)e.push(t>>>(r<<3)&255);e.push(t)}_w.prototype.toDER=function(e){var t=this.r.toArray(),r=this.s.toArray();for(t[0]&128&&(t=[0].concat(t)),r[0]&128&&(r=[0].concat(r)),t=fM(t),r=fM(r);!r[0]&&!(r[1]&128);)r=r.slice(1);var n=[2];CR(n,t.length),n=n.concat(t),n.push(2),CR(n,r.length);var i=n.concat(r),s=[48];return CR(s,i.length),s=s.concat(i),Bo.encode(s,e)};var yhe=function(){throw new Error("unsupported")},lW=Bo.assert;function Ea(e){if(!(this instanceof Ea))return new Ea(e);typeof e=="string"&&(lW(Object.prototype.hasOwnProperty.call(lb,e),"Unknown curve "+e),e=lb[e]),e instanceof lb.PresetCurve&&(e={curve:e}),this.curve=e.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=e.curve.g,this.g.precompute(e.curve.n.bitLength()+1),this.hash=e.hash||e.curve.hash}var bhe=Ea;Ea.prototype.keyPair=function(e){return new RR(this,e)},Ea.prototype.keyFromPrivate=function(e,t){return RR.fromPrivate(this,e,t)},Ea.prototype.keyFromPublic=function(e,t){return RR.fromPublic(this,e,t)},Ea.prototype.genKeyPair=function(e){e||(e={});for(var t=new hM({hash:this.hash,pers:e.pers,persEnc:e.persEnc||"utf8",entropy:e.entropy||yhe(this.hash.hmacStrength),entropyEnc:e.entropy&&e.entropyEnc||"utf8",nonce:this.n.toArray()}),r=this.n.byteLength(),n=this.n.sub(new zt(2));;){var i=new zt(t.generate(r));if(!(i.cmp(n)>0))return i.iaddn(1),this.keyFromPrivate(i)}},Ea.prototype._truncateToN=function(e,t){var r=e.byteLength()*8-this.n.bitLength();return r>0&&(e=e.ushrn(r)),!t&&e.cmp(this.n)>=0?e.sub(this.n):e},Ea.prototype.sign=function(e,t,r,n){typeof r=="object"&&(n=r,r=null),n||(n={}),t=this.keyFromPrivate(t,r),e=this._truncateToN(new zt(e,16));for(var i=this.n.byteLength(),s=t.getPrivate().toArray("be",i),o=e.toArray("be",i),a=new hM({hash:this.hash,entropy:s,nonce:o,pers:n.pers,persEnc:n.persEnc||"utf8"}),c=this.n.sub(new zt(1)),d=0;;d++){var l=n.k?n.k(d):new zt(a.generate(this.n.byteLength()));if(l=this._truncateToN(l,!0),!(l.cmpn(1)<=0||l.cmp(c)>=0)){var u=this.g.mul(l);if(!u.isInfinity()){var h=u.getX(),p=h.umod(this.n);if(p.cmpn(0)!==0){var _=l.invm(this.n).mul(p.mul(t.getPrivate()).iadd(e));if(_=_.umod(this.n),_.cmpn(0)!==0){var g=(u.getY().isOdd()?1:0)|(h.cmp(p)!==0?2:0);return n.canonical&&_.cmp(this.nh)>0&&(_=this.n.sub(_),g^=1),new $v({r:p,s:_,recoveryParam:g})}}}}}},Ea.prototype.verify=function(e,t,r,n){e=this._truncateToN(new zt(e,16)),r=this.keyFromPublic(r,n),t=new $v(t,"hex");var i=t.r,s=t.s;if(i.cmpn(1)<0||i.cmp(this.n)>=0||s.cmpn(1)<0||s.cmp(this.n)>=0)return!1;var o=s.invm(this.n),a=o.mul(e).umod(this.n),c=o.mul(i).umod(this.n),d;return this.curve._maxwellTrick?(d=this.g.jmulAdd(a,r.getPublic(),c),d.isInfinity()?!1:d.eqXToP(i)):(d=this.g.mulAdd(a,r.getPublic(),c),d.isInfinity()?!1:d.getX().umod(this.n).cmp(i)===0)},Ea.prototype.recoverPubKey=function(e,t,r,n){lW((3&r)===r,"The recovery param is more than two bits"),t=new $v(t,n);var i=this.n,s=new zt(e),o=t.r,a=t.s,c=r&1,d=r>>1;if(o.cmp(this.curve.p.umod(this.curve.n))>=0&&d)throw new Error("Unable to find sencond key candinate");d?o=this.curve.pointFromX(o.add(this.curve.n),c):o=this.curve.pointFromX(o,c);var l=t.r.invm(i),u=i.sub(s).mul(l).umod(i),h=a.mul(l).umod(i);return this.g.mulAdd(u,o,h)},Ea.prototype.getKeyRecoveryParam=function(e,t,r,n){if(t=new $v(t,n),t.recoveryParam!==null)return t.recoveryParam;for(var i=0;i<4;i++){var s;try{s=this.recoverPubKey(e,t,i)}catch{continue}if(s.eq(r))return i}throw new Error("Unable to find valid recovery factor")};var She=l0(function(e,t){var r=t;r.version="6.5.4",r.utils=Bo,r.rand=function(){throw new Error("unsupported")},r.curve=db,r.curves=lb,r.ec=bhe,r.eddsa=null}),whe=She.ec;const The="signing-key/5.7.0",GO=new Bi(The);let IR=null;function Xl(){return IR||(IR=new whe("secp256k1")),IR}let Rhe=class{constructor(t){eg(this,"curve","secp256k1"),eg(this,"privateKey",Gs(t)),cle(this.privateKey)!==32&&GO.throwArgumentError("invalid private key","privateKey","[[ REDACTED ]]");const r=Xl().keyFromPrivate(jn(this.privateKey));eg(this,"publicKey","0x"+r.getPublic(!1,"hex")),eg(this,"compressedPublicKey","0x"+r.getPublic(!0,"hex")),eg(this,"_isSigningKey",!0)}_addPoint(t){const r=Xl().keyFromPublic(jn(this.publicKey)),n=Xl().keyFromPublic(jn(t));return"0x"+r.pub.add(n.pub).encodeCompressed("hex")}signDigest(t){const r=Xl().keyFromPrivate(jn(this.privateKey)),n=jn(t);n.length!==32&&GO.throwArgumentError("bad digest length","digest",t);const i=r.sign(n,{canonical:!0});return xz({recoveryParam:i.recoveryParam,r:sd("0x"+i.r.toString(16),32),s:sd("0x"+i.s.toString(16),32)})}computeSharedSecret(t){const r=Xl().keyFromPrivate(jn(this.privateKey)),n=Xl().keyFromPublic(jn(uW(t)));return sd("0x"+r.derive(n.getPublic()).toString(16),32)}static isSigningKey(t){return!!(t&&t._isSigningKey)}};function Ahe(e,t){const r=xz(t),n={r:jn(r.r),s:jn(r.s)};return"0x"+Xl().recoverPubKey(jn(e),n,r.recoveryParam).encode("hex",!1)}function uW(e,t){const r=jn(e);return r.length===32?new Rhe(r).publicKey:r.length===33?"0x"+Xl().keyFromPublic(r).getPublic(!1,"hex"):r.length===65?Gs(r):GO.throwArgumentError("invalid public or private key","key","[REDACTED]")}var pM;(function(e){e[e.legacy=0]="legacy",e[e.eip2930=1]="eip2930",e[e.eip1559=2]="eip1559"})(pM||(pM={}));function Che(e){const t=uW(e);return jle(Zx(nP(Zx(t,1)),12))}function Ihe(e,t){return Che(Ahe(jn(e),t))}const Ohe="https://rpc.walletconnect.com/v1";async function Nhe(e,t,r,n,i,s){switch(r.t){case"eip191":return Dhe(e,t,r.s);case"eip1271":return await Phe(e,t,r.s,n,i,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}function Dhe(e,t,r){return Ihe(zz(t),r).toLowerCase()===e.toLowerCase()}async function Phe(e,t,r,n,i,s){try{const o="0x1626ba7e",a="0000000000000000000000000000000000000000000000000000000000000040",c="0000000000000000000000000000000000000000000000000000000000000041",d=r.substring(2),l=zz(t).substring(2),u=o+l+a+c+d,h=await fetch(`${s||Ohe}/?chainId=${n}&projectId=${i}`,{method:"POST",body:JSON.stringify({id:khe(),jsonrpc:"2.0",method:"eth_call",params:[{to:e,data:u},"latest"]})}),{result:p}=await h.json();return p?p.slice(0,o.length).toLowerCase()===o.toLowerCase():!1}catch(o){return console.error("isValidEip1271Signature: ",o),!1}}function khe(){return Date.now()+Math.floor(Math.random()*1e3)}var Lhe=Object.defineProperty,xhe=Object.defineProperties,Mhe=Object.getOwnPropertyDescriptors,mM=Object.getOwnPropertySymbols,Uhe=Object.prototype.hasOwnProperty,jhe=Object.prototype.propertyIsEnumerable,gM=(e,t,r)=>t in e?Lhe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Fhe=(e,t)=>{for(var r in t||(t={}))Uhe.call(t,r)&&gM(e,r,t[r]);if(mM)for(var r of mM(t))jhe.call(t,r)&&gM(e,r,t[r]);return e},Bhe=(e,t)=>xhe(e,Mhe(t));const Vhe="did:pkh:",cP=e=>e==null?void 0:e.split(":"),hW=e=>{const t=e&&cP(e);if(t)return e.includes(Vhe)?t[3]:t[1]},_M=e=>{const t=e&&cP(e);if(t)return t[2]+":"+t[3]},U1=e=>{const t=e&&cP(e);if(t)return t.pop()};async function EM(e){const{cacao:t,projectId:r}=e,{s:n,p:i}=t,s=fW(i,i.iss),o=U1(i.iss);return await Nhe(o,s,n,hW(i.iss),r)}const fW=(e,t)=>{const r=`${e.domain} wants you to sign in with your Ethereum account:`,n=U1(t);if(!e.aud&&!e.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let i=e.statement||void 0;const s=`URI: ${e.aud||e.uri}`,o=`Version: ${e.version}`,a=`Chain ID: ${hW(t)}`,c=`Nonce: ${e.nonce}`,d=`Issued At: ${e.iat}`,l=e.resources?`Resources:${e.resources.map(h=>`
- ${h}`).join("")}`:void 0,u=ub(e.resources);if(u){const h=W_(u);i=Jhe(i,h)}return[r,n,"",i,"",s,o,a,c,d,l].filter(h=>h!=null).join(`
`)};function $he(e){return Buffer.from(JSON.stringify(e)).toString("base64")}function Hhe(e){return JSON.parse(Buffer.from(e,"base64").toString("utf-8"))}function pf(e){if(!e)throw new Error("No recap provided, value is undefined");if(!e.att)throw new Error("No `att` property found");const t=Object.keys(e.att);if(!(t!=null&&t.length))throw new Error("No resources found in `att` property");t.forEach(r=>{const n=e.att[r];if(Array.isArray(n))throw new Error(`Resource must be an object: ${r}`);if(typeof n!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(n).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(n).forEach(i=>{const s=n[i];if(!Array.isArray(s))throw new Error(`Ability limits ${i} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${i} is empty array, must be an array with objects`);s.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${i}) must be an array of objects, found: ${o}`)})})})}function zhe(e,t,r,n={}){return r==null||r.sort((i,s)=>i.localeCompare(s)),{att:{[e]:Whe(t,r,n)}}}function Whe(e,t,r={}){t=t==null?void 0:t.sort((i,s)=>i.localeCompare(s));const n=t.map(i=>({[`${e}/${i}`]:[r]}));return Object.assign({},...n)}function pW(e){return pf(e),`urn:recap:${$he(e).replace(/=/g,"")}`}function W_(e){const t=Hhe(e.replace("urn:recap:",""));return pf(t),t}function Ghe(e,t,r){const n=zhe(e,t,r);return pW(n)}function qhe(e){return e&&e.includes("urn:recap:")}function Khe(e,t){const r=W_(e),n=W_(t),i=Yhe(r,n);return pW(i)}function Yhe(e,t){pf(e),pf(t);const r=Object.keys(e.att).concat(Object.keys(t.att)).sort((i,s)=>i.localeCompare(s)),n={att:{}};return r.forEach(i=>{var s,o;Object.keys(((s=e.att)==null?void 0:s[i])||{}).concat(Object.keys(((o=t.att)==null?void 0:o[i])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,d;n.att[i]=Bhe(Fhe({},n.att[i]),{[a]:((c=e.att[i])==null?void 0:c[a])||((d=t.att[i])==null?void 0:d[a])})})}),n}function Jhe(e="",t){pf(t);const r="I further authorize the stated URI to perform the following actions on my behalf: ";if(e.includes(r))return e;const n=[];let i=0;Object.keys(t.att).forEach(a=>{const c=Object.keys(t.att[a]).map(u=>({ability:u.split("/")[0],action:u.split("/")[1]}));c.sort((u,h)=>u.action.localeCompare(h.action));const d={};c.forEach(u=>{d[u.ability]||(d[u.ability]=[]),d[u.ability].push(u.action)});const l=Object.keys(d).map(u=>(i++,`(${i}) '${u}': '${d[u].join("', '")}' for '${a}'.`));n.push(l.join(", ").replace(".,","."))});const s=n.join(" "),o=`${r}${s}`;return`${e?e+" ":""}${o}`}function vM(e){var t;const r=W_(e);pf(r);const n=(t=r.att)==null?void 0:t.eip155;return n?Object.keys(n).map(i=>i.split("/")[1]):[]}function yM(e){const t=W_(e);pf(t);const r=[];return Object.values(t.att).forEach(n=>{Object.values(n).forEach(i=>{var s;(s=i==null?void 0:i[0])!=null&&s.chains&&r.push(i[0].chains)})}),[...new Set(r.flat())]}function ub(e){if(!e)return;const t=e==null?void 0:e[e.length-1];return qhe(t)?t:void 0}const mW="base10",Cs="base16",qO="base64pad",dP="utf8",gW=0,Mu=1,Xhe=0,bM=1,KO=12,lP=32;function Qhe(){const e=rP.generateKeyPair();return{privateKey:Is(e.secretKey,Cs),publicKey:Is(e.publicKey,Cs)}}function YO(){const e=n0.randomBytes(lP);return Is(e,Cs)}function Zhe(e,t){const r=rP.sharedKey(ro(e,Cs),ro(t,Cs),!0),n=new Lde(gw.SHA256,r).expand(lP);return Is(n,Cs)}function hb(e){const t=gw.hash(ro(e,Cs));return Is(t,Cs)}function jh(e){const t=gw.hash(ro(e,dP));return Is(t,Cs)}function efe(e){return ro(`${e}`,mW)}function WE(e){return Number(Is(e,mW))}function tfe(e){const t=efe(typeof e.type<"u"?e.type:gW);if(WE(t)===Mu&&typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof e.senderPublicKey<"u"?ro(e.senderPublicKey,Cs):void 0,n=typeof e.iv<"u"?ro(e.iv,Cs):n0.randomBytes(KO),i=new eP.ChaCha20Poly1305(ro(e.symKey,Cs)).seal(n,ro(e.message,dP));return nfe({type:t,sealed:i,iv:n,senderPublicKey:r})}function rfe(e){const t=new eP.ChaCha20Poly1305(ro(e.symKey,Cs)),{sealed:r,iv:n}=j1(e.encoded),i=t.open(n,r);if(i===null)throw new Error("Failed to decrypt");return Is(i,dP)}function nfe(e){if(WE(e.type)===Mu){if(typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Is(jO([e.type,e.senderPublicKey,e.iv,e.sealed]),qO)}return Is(jO([e.type,e.iv,e.sealed]),qO)}function j1(e){const t=ro(e,qO),r=t.slice(Xhe,bM),n=bM;if(WE(r)===Mu){const a=n+lP,c=a+KO,d=t.slice(n,a),l=t.slice(a,c),u=t.slice(c);return{type:r,sealed:u,iv:l,senderPublicKey:d}}const i=n+KO,s=t.slice(n,i),o=t.slice(i);return{type:r,sealed:o,iv:s}}function ife(e,t){const r=j1(e);return _W({type:WE(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?Is(r.senderPublicKey,Cs):void 0,receiverPublicKey:t==null?void 0:t.receiverPublicKey})}function _W(e){const t=(e==null?void 0:e.type)||gW;if(t===Mu){if(typeof(e==null?void 0:e.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(e==null?void 0:e.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:e==null?void 0:e.senderPublicKey,receiverPublicKey:e==null?void 0:e.receiverPublicKey}}function SM(e){return e.type===Mu&&typeof e.senderPublicKey=="string"&&typeof e.receiverPublicKey=="string"}const sfe="irn";function JO(e){return(e==null?void 0:e.relay)||{protocol:sfe}}function fb(e){const t=xde[e];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${e}`);return t}var ofe=Object.defineProperty,afe=Object.defineProperties,cfe=Object.getOwnPropertyDescriptors,wM=Object.getOwnPropertySymbols,dfe=Object.prototype.hasOwnProperty,lfe=Object.prototype.propertyIsEnumerable,TM=(e,t,r)=>t in e?ofe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,RM=(e,t)=>{for(var r in t||(t={}))dfe.call(t,r)&&TM(e,r,t[r]);if(wM)for(var r of wM(t))lfe.call(t,r)&&TM(e,r,t[r]);return e},ufe=(e,t)=>afe(e,cfe(t));function hfe(e,t="-"){const r={},n="relay"+t;return Object.keys(e).forEach(i=>{if(i.startsWith(n)){const s=i.replace(n,""),o=e[i];r[s]=o}}),r}function AM(e){e=e.includes("wc://")?e.replace("wc://",""):e,e=e.includes("wc:")?e.replace("wc:",""):e;const t=e.indexOf(":"),r=e.indexOf("?")!==-1?e.indexOf("?"):void 0,n=e.substring(0,t),i=e.substring(t+1,r).split("@"),s=typeof r<"u"?e.substring(r):"",o=V_.parse(s),a=typeof o.methods=="string"?o.methods.split(","):void 0;return{protocol:n,topic:ffe(i[0]),version:parseInt(i[1],10),symKey:o.symKey,relay:hfe(o),methods:a,expiryTimestamp:o.expiryTimestamp?parseInt(o.expiryTimestamp,10):void 0}}function ffe(e){return e.startsWith("//")?e.substring(2):e}function pfe(e,t="-"){const r="relay",n={};return Object.keys(e).forEach(i=>{const s=r+t+i;e[i]&&(n[s]=e[i])}),n}function mfe(e){return`${e.protocol}:${e.topic}@${e.version}?`+V_.stringify(RM(ufe(RM({symKey:e.symKey},pfe(e.relay)),{expiryTimestamp:e.expiryTimestamp}),e.methods?{methods:e.methods.join(",")}:{}))}function u0(e){const t=[];return e.forEach(r=>{const[n,i]=r.split(":");t.push(`${n}:${i}`)}),t}function gfe(e){const t=[];return Object.values(e).forEach(r=>{t.push(...u0(r.accounts))}),t}function _fe(e,t){const r=[];return Object.values(e).forEach(n=>{u0(n.accounts).includes(t)&&r.push(...n.methods)}),r}function Efe(e,t){const r=[];return Object.values(e).forEach(n=>{u0(n.accounts).includes(t)&&r.push(...n.events)}),r}function vfe(e){const t={};return e==null||e.forEach(r=>{const[n,i]=r.split(":");t[n]||(t[n]={accounts:[],chains:[],events:[]}),t[n].accounts.push(r),t[n].chains.push(`${n}:${i}`)}),t}function CM(e,t){t=t.map(n=>n.replace("did:pkh:",""));const r=vfe(t);for(const[n,i]of Object.entries(r))i.methods?i.methods=Xde(i.methods,e):i.methods=e,i.events=["chainChanged","accountsChanged"];return r}const yfe={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},bfe={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function Be(e,t){const{message:r,code:n}=bfe[e];return{message:t?`${r} ${t}`:r,code:n}}function tn(e,t){const{message:r,code:n}=yfe[e];return{message:t?`${r} ${t}`:r,code:n}}function GE(e,t){return!!Array.isArray(e)}function F1(e){return Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length}function Zs(e){return typeof e>"u"}function qn(e,t){return t&&Zs(e)?!0:typeof e=="string"&&!!e.trim().length}function uP(e,t){return typeof e=="number"&&!isNaN(e)}function Sfe(e,t){const{requiredNamespaces:r}=t,n=Object.keys(e.namespaces),i=Object.keys(r);let s=!0;return Uh(i,n)?(n.forEach(o=>{const{accounts:a,methods:c,events:d}=e.namespaces[o],l=u0(a),u=r[o];(!Uh(Cz(o,u),l)||!Uh(u.methods,c)||!Uh(u.events,d))&&(s=!1)}),s):!1}function B1(e){return qn(e,!1)&&e.includes(":")?e.split(":").length===2:!1}function wfe(e){if(qn(e,!1)&&e.includes(":")){const t=e.split(":");if(t.length===3){const r=t[0]+":"+t[1];return!!t[2]&&B1(r)}}return!1}function Tfe(e){if(qn(e,!1))try{return typeof new URL(e)<"u"}catch{return!1}return!1}function Rfe(e){var t;return(t=e==null?void 0:e.proposer)==null?void 0:t.publicKey}function Afe(e){return e==null?void 0:e.topic}function Cfe(e,t){let r=null;return qn(e==null?void 0:e.publicKey,!1)||(r=Be("MISSING_OR_INVALID",`${t} controller public key should be a string`)),r}function IM(e){let t=!0;return GE(e)?e.length&&(t=e.every(r=>qn(r,!1))):t=!1,t}function Ife(e,t,r){let n=null;return GE(t)&&t.length?t.forEach(i=>{n||B1(i)||(n=tn("UNSUPPORTED_CHAINS",`${r}, chain ${i} should be a string and conform to "namespace:chainId" format`))}):B1(e)||(n=tn("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),n}function Ofe(e,t,r){let n=null;return Object.entries(e).forEach(([i,s])=>{if(n)return;const o=Ife(i,Cz(i,s),`${t} ${r}`);o&&(n=o)}),n}function Nfe(e,t){let r=null;return GE(e)?e.forEach(n=>{r||wfe(n)||(r=tn("UNSUPPORTED_ACCOUNTS",`${t}, account ${n} should be a string and conform to "namespace:chainId:address" format`))}):r=tn("UNSUPPORTED_ACCOUNTS",`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function Dfe(e,t){let r=null;return Object.values(e).forEach(n=>{if(r)return;const i=Nfe(n==null?void 0:n.accounts,`${t} namespace`);i&&(r=i)}),r}function Pfe(e,t){let r=null;return IM(e==null?void 0:e.methods)?IM(e==null?void 0:e.events)||(r=tn("UNSUPPORTED_EVENTS",`${t}, events should be an array of strings or empty array for no events`)):r=tn("UNSUPPORTED_METHODS",`${t}, methods should be an array of strings or empty array for no methods`),r}function EW(e,t){let r=null;return Object.values(e).forEach(n=>{if(r)return;const i=Pfe(n,`${t}, namespace`);i&&(r=i)}),r}function kfe(e,t,r){let n=null;if(e&&F1(e)){const i=EW(e,t);i&&(n=i);const s=Ofe(e,t,r);s&&(n=s)}else n=Be("MISSING_OR_INVALID",`${t}, ${r} should be an object with data`);return n}function OR(e,t){let r=null;if(e&&F1(e)){const n=EW(e,t);n&&(r=n);const i=Dfe(e,t);i&&(r=i)}else r=Be("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return r}function vW(e){return qn(e.protocol,!0)}function Lfe(e,t){let r=!1;return e?e&&GE(e)&&e.length&&e.forEach(n=>{r=vW(n)}):r=!0,r}function xfe(e){return typeof e=="number"}function Hs(e){return typeof e<"u"&&typeof e!==null}function Mfe(e){return!(!e||typeof e!="object"||!e.code||!uP(e.code)||!e.message||!qn(e.message,!1))}function Ufe(e){return!(Zs(e)||!qn(e.method,!1))}function jfe(e){return!(Zs(e)||Zs(e.result)&&Zs(e.error)||!uP(e.id)||!qn(e.jsonrpc,!1))}function Ffe(e){return!(Zs(e)||!qn(e.name,!1))}function OM(e,t){return!(!B1(t)||!gfe(e).includes(t))}function Bfe(e,t,r){return qn(r,!1)?_fe(e,t).includes(r):!1}function Vfe(e,t,r){return qn(r,!1)?Efe(e,t).includes(r):!1}function NM(e,t,r){let n=null;const i=$fe(e),s=Hfe(t),o=Object.keys(i),a=Object.keys(s),c=DM(Object.keys(e)),d=DM(Object.keys(t)),l=c.filter(u=>!d.includes(u));return l.length&&(n=Be("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${l.toString()}
      Received: ${Object.keys(t).toString()}`)),Uh(o,a)||(n=Be("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(t).forEach(u=>{if(!u.includes(":")||n)return;const h=u0(t[u].accounts);h.includes(u)||(n=Be("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${u}
        Required: ${u}
        Approved: ${h.toString()}`))}),o.forEach(u=>{n||(Uh(i[u].methods,s[u].methods)?Uh(i[u].events,s[u].events)||(n=Be("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${u}`)):n=Be("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${u}`))}),n}function $fe(e){const t={};return Object.keys(e).forEach(r=>{var n;r.includes(":")?t[r]=e[r]:(n=e[r].chains)==null||n.forEach(i=>{t[i]={methods:e[r].methods,events:e[r].events}})}),t}function DM(e){return[...new Set(e.map(t=>t.includes(":")?t.split(":")[0]:t))]}function Hfe(e){const t={};return Object.keys(e).forEach(r=>{if(r.includes(":"))t[r]=e[r];else{const n=u0(e[r].accounts);n==null||n.forEach(i=>{t[i]={accounts:e[r].accounts.filter(s=>s.includes(`${i}:`)),methods:e[r].methods,events:e[r].events}})}}),t}function zfe(e,t){return uP(e)&&e<=t.max&&e>=t.min}function PM(){const e=HE();return new Promise(t=>{switch(e){case Do.browser:t(Wfe());break;case Do.reactNative:t(Gfe());break;case Do.node:t(qfe());break;default:t(!0)}})}function Wfe(){return o0()&&(navigator==null?void 0:navigator.onLine)}async function Gfe(){if(s0()&&typeof global<"u"&&global!=null&&global.NetInfo){const e=await(global==null?void 0:global.NetInfo.fetch());return e==null?void 0:e.isConnected}return!0}function qfe(){return!0}function Kfe(e){switch(HE()){case Do.browser:Yfe(e);break;case Do.reactNative:Jfe(e);break}}function Yfe(e){!s0()&&o0()&&(window.addEventListener("online",()=>e(!0)),window.addEventListener("offline",()=>e(!1)))}function Jfe(e){s0()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(t=>e(t==null?void 0:t.isConnected)))}const NR={};let ng=class{static get(t){return NR[t]}static set(t,r){NR[t]=r}static delete(t){delete NR[t]}};const Xfe="PARSE_ERROR",Qfe="INVALID_REQUEST",Zfe="METHOD_NOT_FOUND",epe="INVALID_PARAMS",yW="INTERNAL_ERROR",hP="SERVER_ERROR",tpe=[-32700,-32600,-32601,-32602,-32603],r_={[Xfe]:{code:-32700,message:"Parse error"},[Qfe]:{code:-32600,message:"Invalid Request"},[Zfe]:{code:-32601,message:"Method not found"},[epe]:{code:-32602,message:"Invalid params"},[yW]:{code:-32603,message:"Internal error"},[hP]:{code:-32e3,message:"Server error"}},bW=hP;function rpe(e){return tpe.includes(e)}function kM(e){return Object.keys(r_).includes(e)?r_[e]:r_[bW]}function npe(e){const t=Object.values(r_).find(r=>r.code===e);return t||r_[bW]}function ipe(e,t,r){return e.message.includes("getaddrinfo ENOTFOUND")||e.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${t}`):e}var SW={},Hd={},LM;function spe(){if(LM)return Hd;LM=1,Object.defineProperty(Hd,"__esModule",{value:!0}),Hd.isBrowserCryptoAvailable=Hd.getSubtleCrypto=Hd.getBrowerCrypto=void 0;function e(){return(sc==null?void 0:sc.crypto)||(sc==null?void 0:sc.msCrypto)||{}}Hd.getBrowerCrypto=e;function t(){const n=e();return n.subtle||n.webkitSubtle}Hd.getSubtleCrypto=t;function r(){return!!e()&&!!t()}return Hd.isBrowserCryptoAvailable=r,Hd}var zd={},xM;function ope(){if(xM)return zd;xM=1,Object.defineProperty(zd,"__esModule",{value:!0}),zd.isBrowser=zd.isNode=zd.isReactNative=void 0;function e(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}zd.isReactNative=e;function t(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}zd.isNode=t;function r(){return!e()&&!t()}return zd.isBrowser=r,zd}(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=Cl;t.__exportStar(spe(),e),t.__exportStar(ope(),e)})(SW);function Ql(e=3){const t=Date.now()*Math.pow(10,e),r=Math.floor(Math.random()*Math.pow(10,e));return t+r}function Fh(e=6){return BigInt(Ql(e))}function om(e,t,r){return{id:r||Ql(),jsonrpc:"2.0",method:e,params:t}}function fP(e,t){return{id:e,jsonrpc:"2.0",result:t}}function pP(e,t,r){return{id:e,jsonrpc:"2.0",error:ape(t)}}function ape(e,t){return typeof e>"u"?kM(yW):(typeof e=="string"&&(e=Object.assign(Object.assign({},kM(hP)),{message:e})),rpe(e.code)&&(e=npe(e.code)),e)}let cpe=class{},dpe=class extends cpe{constructor(){super()}},lpe=class extends dpe{constructor(t){super()}};const upe="^wss?:";function hpe(e){const t=e.match(new RegExp(/^\w+:/,"gi"));if(!(!t||!t.length))return t[0]}function fpe(e,t){const r=hpe(e);return typeof r>"u"?!1:new RegExp(t).test(r)}function MM(e){return fpe(e,upe)}function ppe(e){return new RegExp("wss?://localhost(:d{2,5})?").test(e)}function wW(e){return typeof e=="object"&&"id"in e&&"jsonrpc"in e&&e.jsonrpc==="2.0"}function mP(e){return wW(e)&&"method"in e}function Ew(e){return wW(e)&&($c(e)||ya(e))}function $c(e){return"result"in e}function ya(e){return"error"in e}class mpe extends lpe{constructor(t){super(t),this.events=new Sc.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(om(t.method,t.params||[],t.id||Fh().toString()),r)}async requestStrict(t,r){return new Promise(async(n,i)=>{if(!this.connection.connected)try{await this.open()}catch(s){i(s)}this.events.on(`${t.id}`,s=>{ya(s)?i(s.error):n(s.result)});try{await this.connection.send(t,r)}catch(s){i(s)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),Ew(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const gpe=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),_pe=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",UM=e=>e.split("?")[0],jM=10,Epe=gpe();let vpe=class{constructor(t){if(this.url=t,this.events=new Sc.EventEmitter,this.registering=!1,!MM(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(ff(t))}catch(r){this.onError(t.id,r)}}register(t=this.url){if(!MM(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,i)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),i(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return i(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,n)=>{const i=new URLSearchParams(t).get("origin"),s=SW.isReactNative()?{headers:{origin:i}}:{rejectUnauthorized:!ppe(t)},o=new Epe(t,[],s);_pe()?o.onerror=a=>{const c=a;n(this.emitError(c.error))}:o.on("error",a=>{n(this.emitError(a))}),o.onopen=()=>{this.onOpen(o),r(o)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?cw(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const n=this.parseError(r),i=n.message||n.toString(),s=pP(t,i);this.events.emit("payload",s)}parseError(t,r=this.url){return ipe(t,UM(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>jM&&this.events.setMaxListeners(jM)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${UM(this.url)}`));return this.events.emit("register_error",r),r}};var V1={exports:{}};V1.exports;(function(e,t){var r=200,n="__lodash_hash_undefined__",i=1,s=2,o=9007199254740991,a="[object Arguments]",c="[object Array]",d="[object AsyncFunction]",l="[object Boolean]",u="[object Date]",h="[object Error]",p="[object Function]",_="[object GeneratorFunction]",g="[object Map]",E="[object Number]",b="[object Null]",v="[object Object]",I="[object Promise]",N="[object Proxy]",L="[object RegExp]",U="[object Set]",w="[object String]",V="[object Symbol]",z="[object Undefined]",K="[object WeakMap]",H="[object ArrayBuffer]",A="[object DataView]",m="[object Float32Array]",S="[object Float64Array]",T="[object Int8Array]",x="[object Int16Array]",D="[object Int32Array]",k="[object Uint8Array]",P="[object Uint8ClampedArray]",y="[object Uint16Array]",f="[object Uint32Array]",R=/[\\^$.*+?()[\]{}|]/g,B=/^\[object .+?Constructor\]$/,q=/^(?:0|[1-9]\d*)$/,F={};F[m]=F[S]=F[T]=F[x]=F[D]=F[k]=F[P]=F[y]=F[f]=!0,F[a]=F[c]=F[H]=F[l]=F[A]=F[u]=F[h]=F[p]=F[g]=F[E]=F[v]=F[L]=F[U]=F[w]=F[K]=!1;var te=typeof sc=="object"&&sc&&sc.Object===Object&&sc,G=typeof self=="object"&&self&&self.Object===Object&&self,Y=te||G||Function("return this")(),X=t&&!t.nodeType&&t,M=X&&!0&&e&&!e.nodeType&&e,J=M&&M.exports===X,de=J&&te.process,he=function(){try{return de&&de.binding&&de.binding("util")}catch{}}(),Se=he&&he.isTypedArray;function Te(Z,ae){for(var Ie=-1,Ze=Z==null?0:Z.length,cn=0,Qt=[];++Ie<Ze;){var Dn=Z[Ie];ae(Dn,Ie,Z)&&(Qt[cn++]=Dn)}return Qt}function Re(Z,ae){for(var Ie=-1,Ze=ae.length,cn=Z.length;++Ie<Ze;)Z[cn+Ie]=ae[Ie];return Z}function Ne(Z,ae){for(var Ie=-1,Ze=Z==null?0:Z.length;++Ie<Ze;)if(ae(Z[Ie],Ie,Z))return!0;return!1}function Q(Z,ae){for(var Ie=-1,Ze=Array(Z);++Ie<Z;)Ze[Ie]=ae(Ie);return Ze}function re(Z){return function(ae){return Z(ae)}}function ne(Z,ae){return Z.has(ae)}function oe(Z,ae){return Z==null?void 0:Z[ae]}function ce(Z){var ae=-1,Ie=Array(Z.size);return Z.forEach(function(Ze,cn){Ie[++ae]=[cn,Ze]}),Ie}function ue(Z,ae){return function(Ie){return Z(ae(Ie))}}function fe(Z){var ae=-1,Ie=Array(Z.size);return Z.forEach(function(Ze){Ie[++ae]=Ze}),Ie}var ye=Array.prototype,Le=Function.prototype,ke=Object.prototype,Pe=Y["__core-js_shared__"],Qe=Le.toString,ze=ke.hasOwnProperty,Ue=function(){var Z=/[^.]+$/.exec(Pe&&Pe.keys&&Pe.keys.IE_PROTO||"");return Z?"Symbol(src)_1."+Z:""}(),st=ke.toString,ct=RegExp("^"+Qe.call(ze).replace(R,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ve=J?Y.Buffer:void 0,ot=Y.Symbol,nr=Y.Uint8Array,ut=ke.propertyIsEnumerable,lr=ye.splice,Wt=ot?ot.toStringTag:void 0,pt=Object.getOwnPropertySymbols,br=Ve?Ve.isBuffer:void 0,wr=ue(Object.keys,Object),Ke=Vf(Y,"DataView"),wt=Vf(Y,"Map"),Ct=Vf(Y,"Promise"),Ye=Vf(Y,"Set"),It=Vf(Y,"WeakMap"),Tt=Vf(Object,"create"),tt=sh(Ke),kt=sh(wt),Lt=sh(Ct),rt=sh(Ye),xt=sh(It),Ot=ot?ot.prototype:void 0,Je=Ot?Ot.valueOf:void 0;function gt(Z){var ae=-1,Ie=Z==null?0:Z.length;for(this.clear();++ae<Ie;){var Ze=Z[ae];this.set(Ze[0],Ze[1])}}function Mt(){this.__data__=Tt?Tt(null):{},this.size=0}function nt(Z){var ae=this.has(Z)&&delete this.__data__[Z];return this.size-=ae?1:0,ae}function Mr(Z){var ae=this.__data__;if(Tt){var Ie=ae[Z];return Ie===n?void 0:Ie}return ze.call(ae,Z)?ae[Z]:void 0}function Ur(Z){var ae=this.__data__;return Tt?ae[Z]!==void 0:ze.call(ae,Z)}function Nt(Z,ae){var Ie=this.__data__;return this.size+=this.has(Z)?0:1,Ie[Z]=Tt&&ae===void 0?n:ae,this}gt.prototype.clear=Mt,gt.prototype.delete=nt,gt.prototype.get=Mr,gt.prototype.has=Ur,gt.prototype.set=Nt;function sr(Z){var ae=-1,Ie=Z==null?0:Z.length;for(this.clear();++ae<Ie;){var Ze=Z[ae];this.set(Ze[0],Ze[1])}}function Ls(){this.__data__=[],this.size=0}function xs(Z){var ae=this.__data__,Ie=dv(ae,Z);if(Ie<0)return!1;var Ze=ae.length-1;return Ie==Ze?ae.pop():lr.call(ae,Ie,1),--this.size,!0}function Ms(Z){var ae=this.__data__,Ie=dv(ae,Z);return Ie<0?void 0:ae[Ie][1]}function Us(Z){return dv(this.__data__,Z)>-1}function js(Z,ae){var Ie=this.__data__,Ze=dv(Ie,Z);return Ze<0?(++this.size,Ie.push([Z,ae])):Ie[Ze][1]=ae,this}sr.prototype.clear=Ls,sr.prototype.delete=xs,sr.prototype.get=Ms,sr.prototype.has=Us,sr.prototype.set=js;function Qn(Z){var ae=-1,Ie=Z==null?0:Z.length;for(this.clear();++ae<Ie;){var Ze=Z[ae];this.set(Ze[0],Ze[1])}}function Nd(){this.size=0,this.__data__={hash:new gt,map:new(wt||sr),string:new gt}}function Dd(Z){var ae=lv(this,Z).delete(Z);return this.size-=ae?1:0,ae}function Pd(Z){return lv(this,Z).get(Z)}function kd(Z){return lv(this,Z).has(Z)}function Ld(Z,ae){var Ie=lv(this,Z),Ze=Ie.size;return Ie.set(Z,ae),this.size+=Ie.size==Ze?0:1,this}Qn.prototype.clear=Nd,Qn.prototype.delete=Dd,Qn.prototype.get=Pd,Qn.prototype.has=kd,Qn.prototype.set=Ld;function Xo(Z){var ae=-1,Ie=Z==null?0:Z.length;for(this.__data__=new Qn;++ae<Ie;)this.add(Z[ae])}function xd(Z){return this.__data__.set(Z,n),this}function Md(Z){return this.__data__.has(Z)}Xo.prototype.add=Xo.prototype.push=xd,Xo.prototype.has=Md;function qi(Z){var ae=this.__data__=new sr(Z);this.size=ae.size}function Ud(){this.__data__=new sr,this.size=0}function jd(Z){var ae=this.__data__,Ie=ae.delete(Z);return this.size=ae.size,Ie}function Fd(Z){return this.__data__.get(Z)}function M0(Z){return this.__data__.has(Z)}function dQ(Z,ae){var Ie=this.__data__;if(Ie instanceof sr){var Ze=Ie.__data__;if(!wt||Ze.length<r-1)return Ze.push([Z,ae]),this.size=++Ie.size,this;Ie=this.__data__=new Qn(Ze)}return Ie.set(Z,ae),this.size=Ie.size,this}qi.prototype.clear=Ud,qi.prototype.delete=jd,qi.prototype.get=Fd,qi.prototype.has=M0,qi.prototype.set=dQ;function lQ(Z,ae){var Ie=uv(Z),Ze=!Ie&&RQ(Z),cn=!Ie&&!Ze&&yT(Z),Qt=!Ie&&!Ze&&!cn&&ak(Z),Dn=Ie||Ze||cn||Qt,gi=Dn?Q(Z.length,String):[],Li=gi.length;for(var vn in Z)ze.call(Z,vn)&&!(Dn&&(vn=="length"||cn&&(vn=="offset"||vn=="parent")||Qt&&(vn=="buffer"||vn=="byteLength"||vn=="byteOffset")||yQ(vn,Li)))&&gi.push(vn);return gi}function dv(Z,ae){for(var Ie=Z.length;Ie--;)if(nk(Z[Ie][0],ae))return Ie;return-1}function uQ(Z,ae,Ie){var Ze=ae(Z);return uv(Z)?Ze:Re(Ze,Ie(Z))}function U0(Z){return Z==null?Z===void 0?z:b:Wt&&Wt in Object(Z)?EQ(Z):TQ(Z)}function Z3(Z){return j0(Z)&&U0(Z)==a}function ek(Z,ae,Ie,Ze,cn){return Z===ae?!0:Z==null||ae==null||!j0(Z)&&!j0(ae)?Z!==Z&&ae!==ae:hQ(Z,ae,Ie,Ze,ek,cn)}function hQ(Z,ae,Ie,Ze,cn,Qt){var Dn=uv(Z),gi=uv(ae),Li=Dn?c:Nl(Z),vn=gi?c:Nl(ae);Li=Li==a?v:Li,vn=vn==a?v:vn;var vo=Li==v,Ba=vn==v,Ki=Li==vn;if(Ki&&yT(Z)){if(!yT(ae))return!1;Dn=!0,vo=!1}if(Ki&&!vo)return Qt||(Qt=new qi),Dn||ak(Z)?tk(Z,ae,Ie,Ze,cn,Qt):gQ(Z,ae,Li,Ie,Ze,cn,Qt);if(!(Ie&i)){var Qo=vo&&ze.call(Z,"__wrapped__"),Zo=Ba&&ze.call(ae,"__wrapped__");if(Qo||Zo){var Dl=Qo?Z.value():Z,Bd=Zo?ae.value():ae;return Qt||(Qt=new qi),cn(Dl,Bd,Ie,Ze,Qt)}}return Ki?(Qt||(Qt=new qi),_Q(Z,ae,Ie,Ze,cn,Qt)):!1}function fQ(Z){if(!ok(Z)||SQ(Z))return!1;var ae=ik(Z)?ct:B;return ae.test(sh(Z))}function pQ(Z){return j0(Z)&&sk(Z.length)&&!!F[U0(Z)]}function mQ(Z){if(!wQ(Z))return wr(Z);var ae=[];for(var Ie in Object(Z))ze.call(Z,Ie)&&Ie!="constructor"&&ae.push(Ie);return ae}function tk(Z,ae,Ie,Ze,cn,Qt){var Dn=Ie&i,gi=Z.length,Li=ae.length;if(gi!=Li&&!(Dn&&Li>gi))return!1;var vn=Qt.get(Z);if(vn&&Qt.get(ae))return vn==ae;var vo=-1,Ba=!0,Ki=Ie&s?new Xo:void 0;for(Qt.set(Z,ae),Qt.set(ae,Z);++vo<gi;){var Qo=Z[vo],Zo=ae[vo];if(Ze)var Dl=Dn?Ze(Zo,Qo,vo,ae,Z,Qt):Ze(Qo,Zo,vo,Z,ae,Qt);if(Dl!==void 0){if(Dl)continue;Ba=!1;break}if(Ki){if(!Ne(ae,function(Bd,oh){if(!ne(Ki,oh)&&(Qo===Bd||cn(Qo,Bd,Ie,Ze,Qt)))return Ki.push(oh)})){Ba=!1;break}}else if(!(Qo===Zo||cn(Qo,Zo,Ie,Ze,Qt))){Ba=!1;break}}return Qt.delete(Z),Qt.delete(ae),Ba}function gQ(Z,ae,Ie,Ze,cn,Qt,Dn){switch(Ie){case A:if(Z.byteLength!=ae.byteLength||Z.byteOffset!=ae.byteOffset)return!1;Z=Z.buffer,ae=ae.buffer;case H:return!(Z.byteLength!=ae.byteLength||!Qt(new nr(Z),new nr(ae)));case l:case u:case E:return nk(+Z,+ae);case h:return Z.name==ae.name&&Z.message==ae.message;case L:case w:return Z==ae+"";case g:var gi=ce;case U:var Li=Ze&i;if(gi||(gi=fe),Z.size!=ae.size&&!Li)return!1;var vn=Dn.get(Z);if(vn)return vn==ae;Ze|=s,Dn.set(Z,ae);var vo=tk(gi(Z),gi(ae),Ze,cn,Qt,Dn);return Dn.delete(Z),vo;case V:if(Je)return Je.call(Z)==Je.call(ae)}return!1}function _Q(Z,ae,Ie,Ze,cn,Qt){var Dn=Ie&i,gi=rk(Z),Li=gi.length,vn=rk(ae),vo=vn.length;if(Li!=vo&&!Dn)return!1;for(var Ba=Li;Ba--;){var Ki=gi[Ba];if(!(Dn?Ki in ae:ze.call(ae,Ki)))return!1}var Qo=Qt.get(Z);if(Qo&&Qt.get(ae))return Qo==ae;var Zo=!0;Qt.set(Z,ae),Qt.set(ae,Z);for(var Dl=Dn;++Ba<Li;){Ki=gi[Ba];var Bd=Z[Ki],oh=ae[Ki];if(Ze)var ck=Dn?Ze(oh,Bd,Ki,ae,Z,Qt):Ze(Bd,oh,Ki,Z,ae,Qt);if(!(ck===void 0?Bd===oh||cn(Bd,oh,Ie,Ze,Qt):ck)){Zo=!1;break}Dl||(Dl=Ki=="constructor")}if(Zo&&!Dl){var hv=Z.constructor,fv=ae.constructor;hv!=fv&&"constructor"in Z&&"constructor"in ae&&!(typeof hv=="function"&&hv instanceof hv&&typeof fv=="function"&&fv instanceof fv)&&(Zo=!1)}return Qt.delete(Z),Qt.delete(ae),Zo}function rk(Z){return uQ(Z,IQ,vQ)}function lv(Z,ae){var Ie=Z.__data__;return bQ(ae)?Ie[typeof ae=="string"?"string":"hash"]:Ie.map}function Vf(Z,ae){var Ie=oe(Z,ae);return fQ(Ie)?Ie:void 0}function EQ(Z){var ae=ze.call(Z,Wt),Ie=Z[Wt];try{Z[Wt]=void 0;var Ze=!0}catch{}var cn=st.call(Z);return Ze&&(ae?Z[Wt]=Ie:delete Z[Wt]),cn}var vQ=pt?function(Z){return Z==null?[]:(Z=Object(Z),Te(pt(Z),function(ae){return ut.call(Z,ae)}))}:OQ,Nl=U0;(Ke&&Nl(new Ke(new ArrayBuffer(1)))!=A||wt&&Nl(new wt)!=g||Ct&&Nl(Ct.resolve())!=I||Ye&&Nl(new Ye)!=U||It&&Nl(new It)!=K)&&(Nl=function(Z){var ae=U0(Z),Ie=ae==v?Z.constructor:void 0,Ze=Ie?sh(Ie):"";if(Ze)switch(Ze){case tt:return A;case kt:return g;case Lt:return I;case rt:return U;case xt:return K}return ae});function yQ(Z,ae){return ae=ae??o,!!ae&&(typeof Z=="number"||q.test(Z))&&Z>-1&&Z%1==0&&Z<ae}function bQ(Z){var ae=typeof Z;return ae=="string"||ae=="number"||ae=="symbol"||ae=="boolean"?Z!=="__proto__":Z===null}function SQ(Z){return!!Ue&&Ue in Z}function wQ(Z){var ae=Z&&Z.constructor,Ie=typeof ae=="function"&&ae.prototype||ke;return Z===Ie}function TQ(Z){return st.call(Z)}function sh(Z){if(Z!=null){try{return Qe.call(Z)}catch{}try{return Z+""}catch{}}return""}function nk(Z,ae){return Z===ae||Z!==Z&&ae!==ae}var RQ=Z3(function(){return arguments}())?Z3:function(Z){return j0(Z)&&ze.call(Z,"callee")&&!ut.call(Z,"callee")},uv=Array.isArray;function AQ(Z){return Z!=null&&sk(Z.length)&&!ik(Z)}var yT=br||NQ;function CQ(Z,ae){return ek(Z,ae)}function ik(Z){if(!ok(Z))return!1;var ae=U0(Z);return ae==p||ae==_||ae==d||ae==N}function sk(Z){return typeof Z=="number"&&Z>-1&&Z%1==0&&Z<=o}function ok(Z){var ae=typeof Z;return Z!=null&&(ae=="object"||ae=="function")}function j0(Z){return Z!=null&&typeof Z=="object"}var ak=Se?re(Se):pQ;function IQ(Z){return AQ(Z)?lQ(Z):mQ(Z)}function OQ(){return[]}function NQ(){return!1}e.exports=CQ})(V1,V1.exports);var ype=V1.exports;const bpe=Rf(ype);function Spe(e,t){return t=t||{},new Promise(function(r,n){var i=new XMLHttpRequest,s=[],o=[],a={},c=function(){return{ok:(i.status/100|0)==2,statusText:i.statusText,status:i.status,url:i.responseURL,text:function(){return Promise.resolve(i.responseText)},json:function(){return Promise.resolve(i.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([i.response]))},clone:c,headers:{keys:function(){return s},entries:function(){return o},get:function(l){return a[l.toLowerCase()]},has:function(l){return l.toLowerCase()in a}}}};for(var d in i.open(t.method||"get",e,!0),i.onload=function(){i.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(l,u,h){s.push(u=u.toLowerCase()),o.push([u,h]),a[u]=a[u]?a[u]+","+h:h}),r(c())},i.onerror=n,i.withCredentials=t.credentials=="include",t.headers)i.setRequestHeader(d,t.headers[d]);i.send(t.body||null)})}const wpe=Object.freeze(Object.defineProperty({__proto__:null,default:Spe},Symbol.toStringTag,{value:"Module"})),FM=LS(wpe);var Tpe=self.fetch||(self.fetch=FM.default||FM);const Rpe=Rf(Tpe);var Ape={};function Cpe(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),d=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function u(_){if(_ instanceof Uint8Array||(ArrayBuffer.isView(_)?_=new Uint8Array(_.buffer,_.byteOffset,_.byteLength):Array.isArray(_)&&(_=Uint8Array.from(_))),!(_ instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(_.length===0)return"";for(var g=0,E=0,b=0,v=_.length;b!==v&&_[b]===0;)b++,g++;for(var I=(v-b)*l+1>>>0,N=new Uint8Array(I);b!==v;){for(var L=_[b],U=0,w=I-1;(L!==0||U<E)&&w!==-1;w--,U++)L+=256*N[w]>>>0,N[w]=L%a>>>0,L=L/a>>>0;if(L!==0)throw new Error("Non-zero carry");E=U,b++}for(var V=I-E;V!==I&&N[V]===0;)V++;for(var z=c.repeat(g);V<I;++V)z+=e.charAt(N[V]);return z}function h(_){if(typeof _!="string")throw new TypeError("Expected String");if(_.length===0)return new Uint8Array;var g=0;if(_[g]!==" "){for(var E=0,b=0;_[g]===c;)E++,g++;for(var v=(_.length-g)*d+1>>>0,I=new Uint8Array(v);_[g];){var N=r[_.charCodeAt(g)];if(N===255)return;for(var L=0,U=v-1;(N!==0||L<b)&&U!==-1;U--,L++)N+=a*I[U]>>>0,I[U]=N%256>>>0,N=N/256>>>0;if(N!==0)throw new Error("Non-zero carry");b=L,g++}if(_[g]!==" "){for(var w=v-b;w!==v&&I[w]===0;)w++;for(var V=new Uint8Array(E+(v-w)),z=E;w!==v;)V[z++]=I[w++];return V}}}function p(_){var g=h(_);if(g)return g;throw new Error(`Non-${t} character`)}return{encode:u,decodeUnsafe:h,decode:p}}var Ipe=Cpe,Ope=Ipe;const TW=e=>{if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},Npe=e=>new TextEncoder().encode(e),Dpe=e=>new TextDecoder().decode(e);let Ppe=class{constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},kpe=class{constructor(t,r,n){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return RW(this,t)}},Lpe=class{constructor(t){this.decoders=t}or(t){return RW(this,t)}decode(t){const r=t[0],n=this.decoders[r];if(n)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const RW=(e,t)=>new Lpe({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});let xpe=class{constructor(t,r,n,i){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new Ppe(t,r,n),this.decoder=new kpe(t,r,i)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};const vw=({name:e,prefix:t,encode:r,decode:n})=>new xpe(e,t,r,n),qE=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=Ope(r,t);return vw({prefix:e,name:t,encode:n,decode:s=>TW(i(s))})},Mpe=(e,t,r,n)=>{const i={};for(let l=0;l<t.length;++l)i[t[l]]=l;let s=e.length;for(;e[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,d=0;for(let l=0;l<s;++l){const u=i[e[l]];if(u===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|u,a+=r,a>=8&&(a-=8,o[d++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Upe=(e,t,r)=>{const n=t[t.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},Wi=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>vw({prefix:t,name:e,encode(i){return Upe(i,n,r)},decode(i){return Mpe(i,n,r,e)}}),jpe=vw({prefix:"\0",name:"identity",encode:e=>Dpe(e),decode:e=>Npe(e)});var Fpe=Object.freeze({__proto__:null,identity:jpe});const Bpe=Wi({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Vpe=Object.freeze({__proto__:null,base2:Bpe});const $pe=Wi({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Hpe=Object.freeze({__proto__:null,base8:$pe});const zpe=qE({prefix:"9",name:"base10",alphabet:"0123456789"});var Wpe=Object.freeze({__proto__:null,base10:zpe});const Gpe=Wi({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),qpe=Wi({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Kpe=Object.freeze({__proto__:null,base16:Gpe,base16upper:qpe});const Ype=Wi({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Jpe=Wi({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Xpe=Wi({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Qpe=Wi({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Zpe=Wi({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),eme=Wi({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),tme=Wi({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),rme=Wi({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),nme=Wi({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var ime=Object.freeze({__proto__:null,base32:Ype,base32upper:Jpe,base32pad:Xpe,base32padupper:Qpe,base32hex:Zpe,base32hexupper:eme,base32hexpad:tme,base32hexpadupper:rme,base32z:nme});const sme=qE({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ome=qE({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var ame=Object.freeze({__proto__:null,base36:sme,base36upper:ome});const cme=qE({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),dme=qE({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var lme=Object.freeze({__proto__:null,base58btc:cme,base58flickr:dme});const ume=Wi({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),hme=Wi({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),fme=Wi({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),pme=Wi({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var mme=Object.freeze({__proto__:null,base64:ume,base64pad:hme,base64url:fme,base64urlpad:pme});const AW=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),gme=AW.reduce((e,t,r)=>(e[r]=t,e),[]),_me=AW.reduce((e,t,r)=>(e[t.codePointAt(0)]=r,e),[]);function Eme(e){return e.reduce((t,r)=>(t+=gme[r],t),"")}function vme(e){const t=[];for(const r of e){const n=_me[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}const yme=vw({prefix:"🚀",name:"base256emoji",encode:Eme,decode:vme});var bme=Object.freeze({__proto__:null,base256emoji:yme}),Sme=CW,BM=128,wme=127,Tme=~wme,Rme=Math.pow(2,31);function CW(e,t,r){t=t||[],r=r||0;for(var n=r;e>=Rme;)t[r++]=e&255|BM,e/=128;for(;e&Tme;)t[r++]=e&255|BM,e>>>=7;return t[r]=e|0,CW.bytes=r-n+1,t}var Ame=XO,Cme=128,VM=127;function XO(e,n){var r=0,n=n||0,i=0,s=n,o,a=e.length;do{if(s>=a)throw XO.bytes=0,new RangeError("Could not decode varint");o=e[s++],r+=i<28?(o&VM)<<i:(o&VM)*Math.pow(2,i),i+=7}while(o>=Cme);return XO.bytes=s-n,r}var Ime=Math.pow(2,7),Ome=Math.pow(2,14),Nme=Math.pow(2,21),Dme=Math.pow(2,28),Pme=Math.pow(2,35),kme=Math.pow(2,42),Lme=Math.pow(2,49),xme=Math.pow(2,56),Mme=Math.pow(2,63),Ume=function(e){return e<Ime?1:e<Ome?2:e<Nme?3:e<Dme?4:e<Pme?5:e<kme?6:e<Lme?7:e<xme?8:e<Mme?9:10},jme={encode:Sme,decode:Ame,encodingLength:Ume},IW=jme;const $M=(e,t,r=0)=>(IW.encode(e,t,r),t),HM=e=>IW.encodingLength(e),QO=(e,t)=>{const r=t.byteLength,n=HM(e),i=n+HM(r),s=new Uint8Array(i+r);return $M(e,s,0),$M(r,s,n),s.set(t,i),new Fme(e,r,t,s)};let Fme=class{constructor(t,r,n,i){this.code=t,this.size=r,this.digest=n,this.bytes=i}};const OW=({name:e,code:t,encode:r})=>new Bme(e,t,r);let Bme=class{constructor(t,r,n){this.name=t,this.code=r,this.encode=n}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?QO(this.code,r):r.then(n=>QO(this.code,n))}else throw Error("Unknown type, must be binary type")}};const NW=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Vme=OW({name:"sha2-256",code:18,encode:NW("SHA-256")}),$me=OW({name:"sha2-512",code:19,encode:NW("SHA-512")});var Hme=Object.freeze({__proto__:null,sha256:Vme,sha512:$me});const DW=0,zme="identity",PW=TW,Wme=e=>QO(DW,PW(e)),Gme={code:DW,name:zme,encode:PW,digest:Wme};var qme=Object.freeze({__proto__:null,identity:Gme});new TextEncoder,new TextDecoder;const zM={...Fpe,...Vpe,...Hpe,...Wpe,...Kpe,...ime,...ame,...lme,...mme,...bme};({...Hme,...qme});function kW(e){return globalThis.Buffer!=null?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function Kme(e=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?kW(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function LW(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const WM=LW("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),DR=LW("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);const t=Kme(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),Yme={utf8:WM,"utf-8":WM,hex:zM.base16,latin1:DR,ascii:DR,binary:DR,...zM};function Jme(e,t="utf8"){const r=Yme[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?kW(globalThis.Buffer.from(e,"utf-8")):r.decoder.decode(`${r.prefix}${e}`)}const xW="wc",Xme=2,gP="core",Uu=`${xW}@2:${gP}:`,Qme={name:gP,logger:"error"},Zme={database:":memory:"},e0e="crypto",GM="client_ed25519_seed",t0e=Ge.ONE_DAY,r0e="keychain",n0e="0.3",i0e="messages",s0e="0.3",o0e=Ge.SIX_HOURS,a0e="publisher",MW="irn",c0e="error",UW="wss://relay.walletconnect.com",qM="wss://relay.walletconnect.org",d0e="relayer",Oo={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},l0e="_subscription",ra={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},u0e=Ge.ONE_SECOND,h0e="2.12.2",f0e=1e4,p0e="0.3",m0e="WALLETCONNECT_CLIENT_ID",Hc={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},g0e="subscription",_0e="0.3",E0e=Ge.FIVE_SECONDS*1e3,v0e="pairing",y0e="0.3",ig={wc_pairingDelete:{req:{ttl:Ge.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:Ge.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:Ge.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:Ge.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:Ge.ONE_DAY,prompt:!1,tag:0},res:{ttl:Ge.ONE_DAY,prompt:!1,tag:0}}},Up={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Ha={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},b0e="history",S0e="0.3",w0e="expirer",pa={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},T0e="0.3",PR="verify-api",jp="https://verify.walletconnect.com",ZO="https://verify.walletconnect.org",R0e=[jp,ZO],A0e="echo",C0e="https://echo.walletconnect.com";let I0e=class{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=r0e,this.version=n0e,this.initialized=!1,this.storagePrefix=Uu,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,i)=>{this.isInitialized(),this.keychain.set(n,i),await this.persist()},this.get=n=>{this.isInitialized();const i=this.keychain.get(n);if(typeof i>"u"){const{message:s}=Be("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(s)}return i},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=t,this.logger=_o(r,this.name)}get context(){return go(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,Iz(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Oz(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=Be("NOT_INITIALIZED",this.name);throw new Error(t)}}},O0e=class{constructor(t,r,n){this.core=t,this.logger=r,this.name=e0e,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=i=>(this.isInitialized(),this.keychain.has(i)),this.getClientId=async()=>{this.isInitialized();const i=await this.getClientSeed(),s=xx(i);return Ez(s.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const i=Qhe();return this.setPrivateKey(i.publicKey,i.privateKey)},this.signJWT=async i=>{this.isInitialized();const s=await this.getClientSeed(),o=xx(s),a=YO();return await zce(a,i,t0e,o)},this.generateSharedKey=(i,s,o)=>{this.isInitialized();const a=this.getPrivateKey(i),c=Zhe(a,s);return this.setSymKey(c,o)},this.setSymKey=async(i,s)=>{this.isInitialized();const o=s||hb(i);return await this.keychain.set(o,i),o},this.deleteKeyPair=async i=>{this.isInitialized(),await this.keychain.del(i)},this.deleteSymKey=async i=>{this.isInitialized(),await this.keychain.del(i)},this.encode=async(i,s,o)=>{this.isInitialized();const a=_W(o),c=ff(s);if(SM(a)){const h=a.senderPublicKey,p=a.receiverPublicKey;i=await this.generateSharedKey(h,p)}const d=this.getSymKey(i),{type:l,senderPublicKey:u}=a;return tfe({type:l,symKey:d,message:c,senderPublicKey:u})},this.decode=async(i,s,o)=>{this.isInitialized();const a=ife(s,o);if(SM(a)){const c=a.receiverPublicKey,d=a.senderPublicKey;i=await this.generateSharedKey(c,d)}try{const c=this.getSymKey(i),d=rfe({symKey:c,encoded:s});return cw(d)}catch(c){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}},this.getPayloadType=i=>{const s=j1(i);return WE(s.type)},this.getPayloadSenderPublicKey=i=>{const s=j1(i);return s.senderPublicKey?Is(s.senderPublicKey,Cs):void 0},this.core=t,this.logger=_o(r,this.name),this.keychain=n||new I0e(this.core,this.logger)}get context(){return go(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(GM)}catch{t=YO(),await this.keychain.set(GM,t)}return Jme(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=Be("NOT_INITIALIZED",this.name);throw new Error(t)}}},N0e=class extends Yoe{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=i0e,this.version=s0e,this.initialized=!1,this.storagePrefix=Uu,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,i)=>{this.isInitialized();const s=jh(i);let o=this.messages.get(n);return typeof o>"u"&&(o={}),typeof o[s]<"u"||(o[s]=i,this.messages.set(n,o),await this.persist()),s},this.get=n=>{this.isInitialized();let i=this.messages.get(n);return typeof i>"u"&&(i={}),i},this.has=(n,i)=>{this.isInitialized();const s=this.get(n),o=jh(i);return typeof s[o]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=_o(t,this.name),this.core=r}get context(){return go(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,Iz(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Oz(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=Be("NOT_INITIALIZED",this.name);throw new Error(t)}}},D0e=class extends Joe{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new Sc.EventEmitter,this.name=a0e,this.queue=new Map,this.publishTimeout=Ge.toMiliseconds(Ge.ONE_MINUTE),this.failedPublishTimeout=Ge.toMiliseconds(Ge.ONE_SECOND),this.needsTransportRestart=!1,this.publish=async(n,i,s)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:i,opts:s}});const a=(s==null?void 0:s.ttl)||o0e,c=JO(s),d=(s==null?void 0:s.prompt)||!1,l=(s==null?void 0:s.tag)||0,u=(s==null?void 0:s.id)||Fh().toString(),h={topic:n,message:i,opts:{ttl:a,relay:c,prompt:d,tag:l,id:u}},p=`Failed to publish payload, please try again. id:${u} tag:${l}`,_=Date.now();let g,E=1;try{for(;g===void 0;){if(Date.now()-_>this.publishTimeout)throw new Error(p);this.logger.trace({id:u,attempts:E},`publisher.publish - attempt ${E}`),g=await await H_(this.rpcPublish(n,i,a,c,d,l,u).catch(b=>this.logger.warn(b)),this.publishTimeout,p),E++,g||await new Promise(b=>setTimeout(b,this.failedPublishTimeout))}this.relayer.events.emit(Oo.publish,h),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{id:u,topic:n,message:i,opts:s}})}catch(b){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(b),(o=s==null?void 0:s.internal)!=null&&o.throwOnFailedPublish)throw b;this.queue.set(u,h)}},this.on=(n,i)=>{this.events.on(n,i)},this.once=(n,i)=>{this.events.once(n,i)},this.off=(n,i)=>{this.events.off(n,i)},this.removeListener=(n,i)=>{this.events.removeListener(n,i)},this.relayer=t,this.logger=_o(r,this.name),this.registerEventListeners()}get context(){return go(this.logger)}rpcPublish(t,r,n,i,s,o,a){var c,d,l,u;const h={method:fb(i.protocol).publish,params:{topic:t,message:r,ttl:n,prompt:s,tag:o},id:a};return Zs((c=h.params)==null?void 0:c.prompt)&&((d=h.params)==null||delete d.prompt),Zs((l=h.params)==null?void 0:l.tag)&&((u=h.params)==null||delete u.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:h}),this.relayer.request(h)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:n,opts:i}=t;await this.publish(r,n,i)})}registerEventListeners(){this.relayer.core.heartbeat.on(r0.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Oo.connection_stalled);return}this.checkQueue()}),this.relayer.on(Oo.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}},P0e=class{constructor(){this.map=new Map,this.set=(t,r)=>{const n=this.get(t);this.exists(t,r)||this.map.set(t,[...n,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const n=this.get(t);if(!this.exists(t,r))return;const i=n.filter(s=>s!==r);if(!i.length){this.map.delete(t);return}this.map.set(t,i)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}};var k0e=Object.defineProperty,L0e=Object.defineProperties,x0e=Object.getOwnPropertyDescriptors,KM=Object.getOwnPropertySymbols,M0e=Object.prototype.hasOwnProperty,U0e=Object.prototype.propertyIsEnumerable,YM=(e,t,r)=>t in e?k0e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sg=(e,t)=>{for(var r in t||(t={}))M0e.call(t,r)&&YM(e,r,t[r]);if(KM)for(var r of KM(t))U0e.call(t,r)&&YM(e,r,t[r]);return e},kR=(e,t)=>L0e(e,x0e(t));let j0e=class extends Zoe{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new P0e,this.events=new Sc.EventEmitter,this.name=g0e,this.version=_0e,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Uu,this.subscribeTimeout=Ge.toMiliseconds(Ge.ONE_MINUTE),this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,i)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}});try{const s=JO(i),o={topic:n,relay:s};this.pending.set(n,o);const a=await this.rpcSubscribe(n,s);return typeof a=="string"&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}})),a}catch(s){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(s),s}},this.unsubscribe=async(n,i)=>{await this.restartToComplete(),this.isInitialized(),typeof(i==null?void 0:i.id)<"u"?await this.unsubscribeById(n,i.id,i):await this.unsubscribeByTopic(n,i)},this.isSubscribed=async n=>{if(this.topics.includes(n))return!0;const i=`${this.pendingSubscriptionWatchLabel}_${n}`;return await new Promise((s,o)=>{const a=new Ge.Watch;a.start(i);const c=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(c),a.stop(i),s(!0)),a.elapsed(i)>=E0e&&(clearInterval(c),a.stop(i),o(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1)},this.on=(n,i)=>{this.events.on(n,i)},this.once=(n,i)=>{this.events.once(n,i)},this.off=(n,i)=>{this.events.off(n,i)},this.removeListener=(n,i)=>{this.events.removeListener(n,i)},this.start=async()=>{await this.onConnect()},this.stop=async()=>{await this.onDisconnect()},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=_o(r,this.name),this.clientId=""}get context(){return go(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let n=!1;try{n=this.getSubscription(t).topic===r}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const n=this.topicMap.get(t);await Promise.all(n.map(async i=>await this.unsubscribeById(t,i,r)))}async unsubscribeById(t,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}});try{const i=JO(n);await this.rpcUnsubscribe(t,r,i);const s=tn("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(t,r){const n={method:fb(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await H_(this.relayer.request(n).catch(i=>this.logger.warn(i)),this.subscribeTimeout)?jh(t+this.clientId):null}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Oo.connection_stalled)}return null}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,n={method:fb(r.protocol).batchSubscribe,params:{topics:t.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await H_(this.relayer.request(n).catch(i=>this.logger.warn(i)),this.subscribeTimeout)}catch{this.relayer.events.emit(Oo.connection_stalled)}}rpcUnsubscribe(t,r,n){const i={method:fb(n.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(t,r){this.setSubscription(t,kR(sg({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,sg({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,n),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r)}addSubscription(t,r){this.subscriptions.set(t,sg({},r)),this.topicMap.set(r.topic,t),this.events.emit(Hc.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:n}=Be("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(n)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const n=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(n.topic,t),this.events.emit(Hc.deleted,kR(sg({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Hc.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(Hc.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=Be("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);GE(r)&&this.onBatchSubscribe(r.map((n,i)=>kR(sg({},t[i]),{id:n})))}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||!this.relayer.connected)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(r0.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.events.on(Hc.created,async t=>{const r=Hc.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(Hc.deleted,async t=>{const r=Hc.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=Be("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}};var F0e=Object.defineProperty,JM=Object.getOwnPropertySymbols,B0e=Object.prototype.hasOwnProperty,V0e=Object.prototype.propertyIsEnumerable,XM=(e,t,r)=>t in e?F0e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,$0e=(e,t)=>{for(var r in t||(t={}))B0e.call(t,r)&&XM(e,r,t[r]);if(JM)for(var r of JM(t))V0e.call(t,r)&&XM(e,r,t[r]);return e};let H0e=class extends Xoe{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new Sc.EventEmitter,this.name=d0e,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled","interrupted"],this.hasExperiencedNetworkDisruption=!1,this.requestsInFlight=new Map,this.heartBeatTimeout=Ge.toMiliseconds(Ge.THIRTY_SECONDS+Ge.ONE_SECOND),this.request=async r=>{var n,i;this.logger.debug("Publishing Request Payload");const s=r.id||Fh().toString();await this.toEstablishConnection();try{const o=this.provider.request(r);this.requestsInFlight.set(s,{promise:o,request:r}),this.logger.trace({id:s,method:r.method,topic:(n=r.params)==null?void 0:n.topic},"relayer.request - attempt to publish...");const a=await new Promise(async(c,d)=>{const l=()=>{d(new Error(`relayer.request - publish interrupted, id: ${s}`))};this.provider.on(ra.disconnect,l);const u=await o;this.provider.off(ra.disconnect,l),c(u)});return this.logger.trace({id:s,method:r.method,topic:(i=r.params)==null?void 0:i.topic},"relayer.request - published"),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${s}`),o}finally{this.requestsInFlight.delete(s)}},this.resetPingTimeout=()=>{if($_())try{clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,n,i;(i=(n=(r=this.provider)==null?void 0:r.connection)==null?void 0:n.socket)==null||i.terminate()},this.heartBeatTimeout)}catch(r){this.logger.warn(r)}},this.onPayloadHandler=r=>{this.onProviderPayload(r),this.resetPingTimeout()},this.onConnectHandler=()=>{this.startPingTimeout(),this.events.emit(Oo.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Oo.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ra.payload,this.onPayloadHandler),this.provider.on(ra.connect,this.onConnectHandler),this.provider.on(ra.disconnect,this.onDisconnectHandler),this.provider.on(ra.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?_o(t.logger,this.name):lw(KD({level:t.logger||c0e})),this.messages=new N0e(this.logger,t.core),this.subscriber=new j0e(this,this.logger),this.publisher=new D0e(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||UW,this.projectId=t.projectId,this.bundleId=$de(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${qM}...`),await this.restartTransport(qM)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&this.subscriber.pending.size===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},f0e)}get context(){return go(this.logger)}get connected(){var t,r,n;return((n=(r=(t=this.provider)==null?void 0:t.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===1}get connecting(){var t,r,n;return((n=(r=(t=this.provider)==null?void 0:t.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===0}async publish(t,r,n){this.isInitialized(),await this.publisher.publish(t,r,n),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var n;this.isInitialized();let i=((n=this.subscriber.topicMap.get(t))==null?void 0:n[0])||"",s;const o=a=>{a.topic===t&&(this.subscriber.off(Hc.created,o),s())};return await Promise.all([new Promise(a=>{s=a,this.subscriber.on(Hc.created,o)}),new Promise(async a=>{i=await this.subscriber.subscribe(t,r)||i,a()})]),i}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportDisconnect(){if(!this.hasExperiencedNetworkDisruption&&this.connected&&this.requestsInFlight.size>0)try{await Promise.all(Array.from(this.requestsInFlight.values()).map(t=>t.promise))}catch(t){this.logger.warn(t)}this.hasExperiencedNetworkDisruption||this.connected?await H_(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(t){await this.confirmOnlineStateOrThrow(),t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportDisconnect(),await this.createProvider()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;try{await new Promise(async(r,n)=>{const i=()=>{this.provider.off(ra.disconnect,i),n(new Error("Connection interrupted while trying to subscribe"))};this.provider.on(ra.disconnect,i),await H_(this.provider.connect(),Ge.toMiliseconds(Ge.ONE_MINUTE),`Socket stalled when trying to connect to ${this.relayUrl}`).catch(s=>{n(s)}),await this.subscriber.start(),this.hasExperiencedNetworkDisruption=!1,r()})}catch(r){this.logger.error(r);const n=r;if(!this.isConnectionStalled(n.message))throw r}finally{this.connectionAttemptInProgress=!1}}async restartTransport(t){this.connectionAttemptInProgress||(this.relayUrl=t||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await PM())throw new Error("No internet connection detected. Please restart your network and try again.")}startPingTimeout(){var t,r,n,i,s;if($_())try{(r=(t=this.provider)==null?void 0:t.connection)!=null&&r.socket&&((s=(i=(n=this.provider)==null?void 0:n.connection)==null?void 0:i.socket)==null||s.once("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o)}}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new mpe(new vpe(Kde({sdkVersion:h0e,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:n}=t;await this.messages.set(r,n)}async shouldIgnoreMessageEvent(t){const{topic:r,message:n}=t;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const i=this.messages.has(r,n);return i&&this.logger.debug(`Ignoring duplicate message: ${n}`),i}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),mP(t)){if(!t.method.endsWith(l0e))return;const r=t.params,{topic:n,message:i,publishedAt:s}=r.data,o={topic:n,message:i,publishedAt:s};this.logger.debug("Emitting Relayer Payload"),this.logger.trace($0e({type:"event",event:r.id},o)),this.events.emit(r.id,o),await this.acknowledgePayload(t),await this.onMessageEvent(o)}else Ew(t)&&this.events.emit(Oo.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(Oo.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=fP(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(ra.payload,this.onPayloadHandler),this.provider.off(ra.connect,this.onConnectHandler),this.provider.off(ra.disconnect,this.onDisconnectHandler),this.provider.off(ra.error,this.onProviderErrorHandler)}async registerEventListeners(){let t=await PM();Kfe(async r=>{t!==r&&(t=r,r?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))})}async onProviderDisconnect(){await this.subscriber.stop(),this.events.emit(Oo.disconnect),this.connectionAttemptInProgress=!1,!this.transportExplicitlyClosed&&setTimeout(async()=>{await this.transportOpen().catch(t=>this.logger.error(t))},Ge.toMiliseconds(u0e))}isInitialized(){if(!this.initialized){const{message:t}=Be("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){await this.confirmOnlineStateOrThrow(),!this.connected&&(this.connectionAttemptInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)}),await this.transportOpen())}};var z0e=Object.defineProperty,QM=Object.getOwnPropertySymbols,W0e=Object.prototype.hasOwnProperty,G0e=Object.prototype.propertyIsEnumerable,ZM=(e,t,r)=>t in e?z0e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,e6=(e,t)=>{for(var r in t||(t={}))W0e.call(t,r)&&ZM(e,r,t[r]);if(QM)for(var r of QM(t))G0e.call(t,r)&&ZM(e,r,t[r]);return e};let Lf=class extends Qoe{constructor(t,r,n,i=Uu,s=void 0){super(t,r,n,i),this.core=t,this.logger=r,this.name=n,this.map=new Map,this.version=p0e,this.cached=[],this.initialized=!1,this.storagePrefix=Uu,this.recentlyDeleted=[],this.recentlyDeletedLimit=200,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Zs(o)?this.map.set(this.getKey(o),o):Rfe(o)?this.map.set(o.id,o):Afe(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)},this.set=async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())},this.get=o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o)),this.getAll=o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>bpe(a[c],o[c]))):this.values),this.update=async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=e6(e6({},this.getData(o)),a);this.map.set(o,c),await this.persist()},this.delete=async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())},this.logger=_o(r,this.name),this.storagePrefix=i,this.getKey=s}get context(){return go(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(t){this.recentlyDeleted.push(t),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){if(this.recentlyDeleted.includes(t)){const{message:i}=Be("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${t}`);throw this.logger.error(i),new Error(i)}const{message:n}=Be("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=Be("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=Be("NOT_INITIALIZED",this.name);throw new Error(t)}}},q0e=class{constructor(t,r){this.core=t,this.logger=r,this.name=v0e,this.version=y0e,this.events=new aw,this.initialized=!1,this.storagePrefix=Uu,this.ignoredPayloadTypes=[Mu],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async n=>{this.isInitialized();const i=YO(),s=await this.core.crypto.setSymKey(i),o=ss(Ge.FIVE_MINUTES),a={protocol:MW},c={topic:s,expiry:o,relay:a,active:!1},d=mfe({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:a,expiryTimestamp:o,methods:n==null?void 0:n.methods});return await this.pairings.set(s,c),await this.core.relayer.subscribe(s),this.core.expirer.set(s,o),{topic:s,uri:d}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:i,symKey:s,relay:o,expiryTimestamp:a,methods:c}=AM(n.uri);let d;if(this.pairings.keys.includes(i)&&(d=this.pairings.get(i),d.active))throw new Error(`Pairing already exists: ${i}. Please try again with a new connection URI.`);const l=a||ss(Ge.FIVE_MINUTES),u={topic:i,relay:o,expiry:l,active:!1,methods:c};return await this.pairings.set(i,u),this.core.expirer.set(i,l),n.activatePairing&&await this.activate({topic:i}),this.events.emit(Up.create,u),this.core.crypto.keychain.has(i)||await this.core.crypto.setSymKey(s,i),await this.core.relayer.subscribe(i,{relay:o}),u},this.activate=async({topic:n})=>{this.isInitialized();const i=ss(Ge.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:i}),this.core.expirer.set(n,i)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:i}=n;if(this.pairings.keys.includes(i)){const s=await this.sendRequest(i,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Sh();this.events.once(ur("pairing_ping",s),({error:d})=>{d?c(d):a()}),await o()}},this.updateExpiry=async({topic:n,expiry:i})=>{this.isInitialized(),await this.pairings.update(n,{expiry:i})},this.updateMetadata=async({topic:n,metadata:i})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:i})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:i}=n;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",tn("USER_DISCONNECTED")),await this.deletePairing(i))},this.sendRequest=async(n,i,s)=>{const o=om(i,s),a=await this.core.crypto.encode(n,o),c=ig[i].req;return this.core.history.set(n,o),this.core.relayer.publish(n,a,c),o.id},this.sendResult=async(n,i,s)=>{const o=fP(n,s),a=await this.core.crypto.encode(i,o),c=await this.core.history.get(i,n),d=ig[c.request.method].res;await this.core.relayer.publish(i,a,d),await this.core.history.resolve(o)},this.sendError=async(n,i,s)=>{const o=pP(n,s),a=await this.core.crypto.encode(i,o),c=await this.core.history.get(i,n),d=ig[c.request.method]?ig[c.request.method].res:ig.unregistered_method.res;await this.core.relayer.publish(i,a,d),await this.core.history.resolve(o)},this.deletePairing=async(n,i)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,tn("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),i?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(i=>Jl(i.expiry));await Promise.all(n.map(i=>this.deletePairing(i.topic)))},this.onRelayEventRequest=n=>{const{topic:i,payload:s}=n;switch(s.method){case"wc_pairingPing":return this.onPairingPingRequest(i,s);case"wc_pairingDelete":return this.onPairingDeleteRequest(i,s);default:return this.onUnknownRpcMethodRequest(i,s)}},this.onRelayEventResponse=async n=>{const{topic:i,payload:s}=n,o=(await this.core.history.get(i,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(i,s);default:return this.onUnknownRpcMethodResponse(o)}},this.onPairingPingRequest=async(n,i)=>{const{id:s}=i;try{this.isValidPing({topic:n}),await this.sendResult(s,n,!0),this.events.emit(Up.ping,{id:s,topic:n})}catch(o){await this.sendError(s,n,o),this.logger.error(o)}},this.onPairingPingResponse=(n,i)=>{const{id:s}=i;setTimeout(()=>{$c(i)?this.events.emit(ur("pairing_ping",s),{}):ya(i)&&this.events.emit(ur("pairing_ping",s),{error:i.error})},500)},this.onPairingDeleteRequest=async(n,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Up.delete,{id:s,topic:n})}catch(o){await this.sendError(s,n,o),this.logger.error(o)}},this.onUnknownRpcMethodRequest=async(n,i)=>{const{id:s,method:o}=i;try{if(this.registeredMethods.includes(o))return;const a=tn("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,n,a),this.logger.error(a)}catch(a){await this.sendError(s,n,a),this.logger.error(a)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(tn("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{var i;if(!Hs(n)){const{message:o}=Be("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(o)}if(!Tfe(n.uri)){const{message:o}=Be("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(o)}const s=AM(n.uri);if(!((i=s==null?void 0:s.relay)!=null&&i.protocol)){const{message:o}=Be("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(o)}if(!(s!=null&&s.symKey)){const{message:o}=Be("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(o)}if(s!=null&&s.expiryTimestamp&&Ge.toMiliseconds(s==null?void 0:s.expiryTimestamp)<Date.now()){const{message:o}=Be("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(o)}},this.isValidPing=async n=>{if(!Hs(n)){const{message:s}=Be("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(s)}const{topic:i}=n;await this.isValidPairingTopic(i)},this.isValidDisconnect=async n=>{if(!Hs(n)){const{message:s}=Be("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(s)}const{topic:i}=n;await this.isValidPairingTopic(i)},this.isValidPairingTopic=async n=>{if(!qn(n,!1)){const{message:i}=Be("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(i)}if(!this.pairings.keys.includes(n)){const{message:i}=Be("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(i)}if(Jl(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:i}=Be("EXPIRED",`pairing topic: ${n}`);throw new Error(i)}},this.core=t,this.logger=_o(r,this.name),this.pairings=new Lf(this.core,this.logger,this.name,this.storagePrefix)}get context(){return go(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=Be("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(Oo.message,async t=>{const{topic:r,message:n}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const i=await this.core.crypto.decode(r,n);try{mP(i)?(this.core.history.set(r,i),this.onRelayEventRequest({topic:r,payload:i})):Ew(i)&&(await this.core.history.resolve(i),await this.onRelayEventResponse({topic:r,payload:i}),this.core.history.delete(r,i.id))}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(pa.expired,async t=>{const{topic:r}=Dz(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Up.expire,{topic:r}))})}},K0e=class extends Koe{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new Sc.EventEmitter,this.name=b0e,this.version=S0e,this.cached=[],this.initialized=!1,this.storagePrefix=Uu,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,i,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:i,chainId:s}),this.records.has(i.id))return;const o={id:i.id,topic:n,request:{method:i.method,params:i.params||null},chainId:s,expiry:ss(Ge.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(Ha.created,o)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const i=await this.getRecord(n.id);typeof i.response>"u"&&(i.response=ya(n)?{error:n.error}:{result:n.result},this.records.set(i.id,i),this.persist(),this.events.emit(Ha.updated,i))},this.get=async(n,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:i}),await this.getRecord(i)),this.delete=(n,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(s=>{if(s.topic===n){if(typeof i<"u"&&s.id!==i)return;this.records.delete(s.id),this.events.emit(Ha.deleted,s)}}),this.persist()},this.exists=async(n,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===n:!1),this.on=(n,i)=>{this.events.on(n,i)},this.once=(n,i)=>{this.events.once(n,i)},this.off=(n,i)=>{this.events.off(n,i)},this.removeListener=(n,i)=>{this.events.removeListener(n,i)},this.logger=_o(r,this.name)}get context(){return go(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:om(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(n)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:n}=Be("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Ha.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=Be("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(Ha.created,t=>{const r=Ha.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t})}),this.events.on(Ha.updated,t=>{const r=Ha.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t})}),this.events.on(Ha.deleted,t=>{const r=Ha.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t})}),this.core.heartbeat.on(r0.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let t=!1;this.records.forEach(r=>{Ge.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(Ha.deleted,r,!1),t=!0)}),t&&this.persist()}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=Be("NOT_INITIALIZED",this.name);throw new Error(t)}}},Y0e=class extends eae{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new Sc.EventEmitter,this.name=w0e,this.version=T0e,this.cached=[],this.initialized=!1,this.storagePrefix=Uu,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const i=this.formatTarget(n);return typeof this.getExpiration(i)<"u"}catch{return!1}},this.set=(n,i)=>{this.isInitialized();const s=this.formatTarget(n),o={target:s,expiry:i};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(pa.created,{target:s,expiration:o})},this.get=n=>{this.isInitialized();const i=this.formatTarget(n);return this.getExpiration(i)},this.del=n=>{if(this.isInitialized(),this.has(n)){const i=this.formatTarget(n),s=this.getExpiration(i);this.expirations.delete(i),this.events.emit(pa.deleted,{target:i,expiration:s})}},this.on=(n,i)=>{this.events.on(n,i)},this.once=(n,i)=>{this.events.once(n,i)},this.off=(n,i)=>{this.events.off(n,i)},this.removeListener=(n,i)=>{this.events.removeListener(n,i)},this.logger=_o(r,this.name)}get context(){return go(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return Yde(t);if(typeof t=="number")return Jde(t);const{message:r}=Be("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(pa.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=Be("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:n}=Be("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.warn(n),new Error(n)}return r}checkExpiry(t,r){const{expiry:n}=r;Ge.toMiliseconds(n)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(pa.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(r0.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(pa.created,t=>{const r=pa.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(pa.expired,t=>{const r=pa.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(pa.deleted,t=>{const r=pa.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=Be("NOT_INITIALIZED",this.name);throw new Error(t)}}},J0e=class extends tae{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=PR,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async n=>{if(this.verifyDisabled||s0()||!o0())return;const i=this.getVerifyUrl(n==null?void 0:n.verifyUrl);this.verifyUrl!==i&&this.removeIframe(),this.verifyUrl=i;try{await this.createIframe()}catch(s){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(s)}if(!this.initialized){this.removeIframe(),this.verifyUrl=ZO;try{await this.createIframe()}catch(s){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(s),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const i=this.getVerifyUrl(n==null?void 0:n.verifyUrl);let s;try{s=await this.fetchAttestation(n.attestationId,i)}catch(o){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${i}`),this.logger.info(o),s=await this.fetchAttestation(n.attestationId,ZO)}return s},this.fetchAttestation=async(n,i)=>{this.logger.info(`resolving attestation: ${n} from url: ${i}`);const s=this.startAbortTimer(Ge.ONE_SECOND*2),o=await fetch(`${i}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(s),o.status===200?await o.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var i;try{if(!this.iframe)return;(i=this.iframe.contentWindow)==null||i.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const i=s=>{s.data==="verify_ready"&&(this.onInit(),window.removeEventListener("message",i),n())};await Promise.race([new Promise(s=>{const o=document.getElementById(PR);if(o)return this.iframe=o,this.onInit(),s();window.addEventListener("message",i);const a=document.createElement("iframe");a.id=PR,a.src=`${this.verifyUrl}/${this.projectId}`,a.style.display="none",document.body.append(a),this.iframe=a,n=s}),new Promise((s,o)=>setTimeout(()=>{window.removeEventListener("message",i),o("verify iframe load timeout")},Ge.toMiliseconds(Ge.FIVE_SECONDS)))])},this.onInit=()=>{this.initialized=!0,this.processQueue()},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=n=>{let i=n||jp;return R0e.includes(i)||(this.logger.info(`verify url: ${i}, not included in trusted list, assigning default: ${jp}`),i=jp),i},this.logger=_o(r,this.name),this.verifyUrl=jp,this.abortController=new AbortController,this.isDevEnv=$_()&&Ape.IS_VITEST}get context(){return go(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),Ge.toMiliseconds(t))}},X0e=class extends rae{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.context=A0e,this.registerDeviceToken=async n=>{const{clientId:i,token:s,notificationType:o,enableEncrypted:a=!1}=n,c=`${C0e}/${this.projectId}/clients`;await Rpe(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:o,token:s,always_raw:a})})},this.logger=_o(r,this.context)}};var Q0e=Object.defineProperty,t6=Object.getOwnPropertySymbols,Z0e=Object.prototype.hasOwnProperty,ege=Object.prototype.propertyIsEnumerable,r6=(e,t,r)=>t in e?Q0e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,n6=(e,t)=>{for(var r in t||(t={}))Z0e.call(t,r)&&r6(e,r,t[r]);if(t6)for(var r of t6(t))ege.call(t,r)&&r6(e,r,t[r]);return e};let tge=class jW extends qoe{constructor(t){var r;super(t),this.protocol=xW,this.version=Xme,this.name=gP,this.events=new Sc.EventEmitter,this.initialized=!1,this.on=(o,a)=>this.events.on(o,a),this.once=(o,a)=>this.events.once(o,a),this.off=(o,a)=>this.events.off(o,a),this.removeListener=(o,a)=>this.events.removeListener(o,a),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||UW,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const n=KD({level:typeof(t==null?void 0:t.logger)=="string"&&t.logger?t.logger:Qme.logger}),{logger:i,chunkLoggerController:s}=Goe({opts:n,maxSizeInBytes:t==null?void 0:t.maxLogBlobSizeInBytes,loggerOverride:t==null?void 0:t.logger});this.logChunkController=s,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var o,a;(o=this.logChunkController)!=null&&o.downloadLogsBlobInBrowser&&((a=this.logChunkController)==null||a.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=_o(i,this.name),this.heartbeat=new r0.HeartBeat,this.crypto=new O0e(this,this.logger,t==null?void 0:t.keychain),this.history=new K0e(this,this.logger),this.expirer=new Y0e(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new Fse(n6(n6({},Zme),t==null?void 0:t.storageOptions)),this.relayer=new H0e({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new q0e(this,this.logger),this.verify=new J0e(this.projectId||"",this.logger),this.echoClient=new X0e(this.projectId||"",this.logger)}static async init(t){const r=new jW(t);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(m0e,n),r}get context(){return go(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var t;return(t=this.logChunkController)==null?void 0:t.logsToBlob({clientId:await this.crypto.getClientId()})}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}};const rge=tge,FW="wc",BW=2,VW="client",_P=`${FW}@${BW}:${VW}:`,LR={name:VW,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},i6="WALLETCONNECT_DEEPLINK_CHOICE",nge="proposal",ige="Proposal expired",sge="session",Kf=Ge.SEVEN_DAYS,oge="engine",na={wc_sessionPropose:{req:{ttl:Ge.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:Ge.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:Ge.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:Ge.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:Ge.ONE_DAY,prompt:!1,tag:1104},res:{ttl:Ge.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:Ge.ONE_DAY,prompt:!1,tag:1106},res:{ttl:Ge.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:Ge.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:Ge.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:Ge.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:Ge.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:Ge.ONE_DAY,prompt:!1,tag:1112},res:{ttl:Ge.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:Ge.ONE_DAY,prompt:!1,tag:1114},res:{ttl:Ge.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:Ge.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:Ge.ONE_HOUR,prompt:!1,tag:1117}}},xR={min:Ge.FIVE_MINUTES,max:Ge.SEVEN_DAYS},Wd={idle:"IDLE",active:"ACTIVE"},age="request",cge=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"],dge="wc",lge="auth",uge="authKeys",hge="pairingTopics",fge="requests",yw=`${dge}@${1.5}:${lge}:`,pb=`${yw}:PUB_KEY`;var pge=Object.defineProperty,mge=Object.defineProperties,gge=Object.getOwnPropertyDescriptors,s6=Object.getOwnPropertySymbols,_ge=Object.prototype.hasOwnProperty,Ege=Object.prototype.propertyIsEnumerable,o6=(e,t,r)=>t in e?pge(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,vi=(e,t)=>{for(var r in t||(t={}))_ge.call(t,r)&&o6(e,r,t[r]);if(s6)for(var r of s6(t))Ege.call(t,r)&&o6(e,r,t[r]);return e},Yf=(e,t)=>mge(e,gge(t));let vge=class extends iae{constructor(t){super(t),this.name=oge,this.events=new aw,this.initialized=!1,this.requestQueue={state:Wd.idle,queue:[]},this.sessionRequestQueue={state:Wd.idle,queue:[]},this.requestQueueDelay=Ge.ONE_SECOND,this.expectedPairingMethodMap=new Map,this.recentlyDeletedMap=new Map,this.recentlyDeletedLimit=200,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(na)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},Ge.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const n=Yf(vi({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:o,sessionProperties:a,relays:c}=n;let d=i,l,u=!1;try{d&&(u=this.client.core.pairing.pairings.get(d).active)}catch(N){throw this.client.logger.error(`connect() -> pairing.get(${d}) failed`),N}if(!d||!u){const{topic:N,uri:L}=await this.client.core.pairing.create();d=N,l=L}if(!d){const{message:N}=Be("NO_MATCHING_KEY",`connect() pairing topic: ${d}`);throw new Error(N)}const h=await this.client.core.crypto.generateKeyPair(),p=na.wc_sessionPropose.req.ttl||Ge.FIVE_MINUTES,_=ss(p),g=vi({requiredNamespaces:s,optionalNamespaces:o,relays:c??[{protocol:MW}],proposer:{publicKey:h,metadata:this.client.metadata},expiryTimestamp:_},a&&{sessionProperties:a}),{reject:E,resolve:b,done:v}=Sh(p,ige);this.events.once(ur("session_connect"),async({error:N,session:L})=>{if(N)E(N);else if(L){L.self.publicKey=h;const U=Yf(vi({},L),{requiredNamespaces:g.requiredNamespaces,optionalNamespaces:g.optionalNamespaces});await this.client.session.set(L.topic,U),await this.setExpiry(L.topic,L.expiry),d&&await this.client.core.pairing.updateMetadata({topic:d,metadata:L.peer.metadata}),b(U)}});const I=await this.sendRequest({topic:d,method:"wc_sessionPropose",params:g,throwOnFailedPublish:!0});return await this.setProposal(I,vi({id:I},g)),{uri:l,approval:v}},this.pair=async r=>{await this.isInitialized();try{return await this.client.core.pairing.pair(r)}catch(n){throw this.client.logger.error("pair() failed"),n}},this.approve=async r=>{await this.isInitialized();try{await this.isValidApprove(r)}catch(v){throw this.client.logger.error("approve() -> isValidApprove() failed"),v}const{id:n,relayProtocol:i,namespaces:s,sessionProperties:o,sessionConfig:a}=r;let c;try{c=this.client.proposal.get(n)}catch(v){throw this.client.logger.error(`approve() -> proposal.get(${n}) failed`),v}let{pairingTopic:d,proposer:l,requiredNamespaces:u,optionalNamespaces:h}=c;d=d||"";const p=await this.client.core.crypto.generateKeyPair(),_=l.publicKey,g=await this.client.core.crypto.generateSharedKey(p,_),E=vi(vi({relay:{protocol:i??"irn"},namespaces:s,pairingTopic:d,controller:{publicKey:p,metadata:this.client.metadata},expiry:ss(Kf)},o&&{sessionProperties:o}),a&&{sessionConfig:a});await this.client.core.relayer.subscribe(g);const b=Yf(vi({},E),{topic:g,requiredNamespaces:u,optionalNamespaces:h,pairingTopic:d,acknowledged:!1,self:E.controller,peer:{publicKey:l.publicKey,metadata:l.metadata},controller:p});await this.client.session.set(g,b);try{await this.sendResult({id:n,topic:d,result:{relay:{protocol:i??"irn"},responderPublicKey:p},throwOnFailedPublish:!0}),await this.sendRequest({topic:g,method:"wc_sessionSettle",params:E,throwOnFailedPublish:!0})}catch(v){throw this.client.logger.error(v),this.client.session.delete(g,tn("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(g),v}return await this.client.core.pairing.updateMetadata({topic:d,metadata:l.metadata}),await this.client.proposal.delete(n,tn("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:d}),await this.setExpiry(g,ss(Kf)),{topic:g,acknowledged:()=>new Promise(v=>setTimeout(()=>v(this.client.session.get(g)),500))}},this.reject=async r=>{await this.isInitialized();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:n,reason:i}=r;let s;try{s=this.client.proposal.get(n).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${n}) failed`),o}s&&(await this.sendError({id:n,topic:s,error:i}),await this.client.proposal.delete(n,tn("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized();try{await this.isValidUpdate(r)}catch(u){throw this.client.logger.error("update() -> isValidUpdate() failed"),u}const{topic:n,namespaces:i}=r,{done:s,resolve:o,reject:a}=Sh(),c=Ql(),d=Fh().toString(),l=this.client.session.get(n).namespaces;return this.events.once(ur("session_update",c),({error:u})=>{u?a(u):o()}),await this.client.session.update(n,{namespaces:i}),this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:i},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:d}).catch(u=>{this.client.logger.error(u),this.client.session.update(n,{namespaces:l}),a(u)}),{acknowledged:s}},this.extend=async r=>{await this.isInitialized();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:n}=r,i=Ql(),{done:s,resolve:o,reject:a}=Sh();return this.events.once(ur("session_extend",i),({error:c})=>{c?a(c):o()}),await this.setExpiry(n,ss(Kf)),this.sendRequest({topic:n,method:"wc_sessionExtend",params:{},clientRpcId:i,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:s}},this.request=async r=>{await this.isInitialized();try{await this.isValidRequest(r)}catch(p){throw this.client.logger.error("request() -> isValidRequest() failed"),p}const{chainId:n,request:i,topic:s,expiry:o=na.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(s),c=Ql(),d=Fh().toString(),{done:l,resolve:u,reject:h}=Sh(o,"Request expired. Please try again.");return this.events.once(ur("session_request",c),({error:p,result:_})=>{p?h(p):u(_)}),await Promise.all([new Promise(async p=>{await this.sendRequest({clientRpcId:c,relayRpcId:d,topic:s,method:"wc_sessionRequest",params:{request:Yf(vi({},i),{expiryTimestamp:ss(o)}),chainId:n},expiry:o,throwOnFailedPublish:!0}).catch(_=>h(_)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:n,id:c}),p()}),new Promise(async p=>{var _;if(!((_=a.sessionConfig)!=null&&_.disableDeepLink)){const g=await Zde(this.client.core.storage,i6);Qde({id:c,topic:s,wcDeepLink:g})}p()}),l()]).then(p=>p[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:n,response:i}=r,{id:s}=i;$c(i)?await this.sendResult({id:s,topic:n,result:i.result,throwOnFailedPublish:!0}):ya(i)&&await this.sendError({id:s,topic:n,error:i.error}),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized();try{await this.isValidPing(r)}catch(i){throw this.client.logger.error("ping() -> isValidPing() failed"),i}const{topic:n}=r;if(this.client.session.keys.includes(n)){const i=Ql(),s=Fh().toString(),{done:o,resolve:a,reject:c}=Sh();this.events.once(ur("session_ping",i),({error:d})=>{d?c(d):a()}),await Promise.all([this.sendRequest({topic:n,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:i,relayRpcId:s}),o()])}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:n,event:i,chainId:s}=r,o=Fh().toString();await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:i,chainId:s},throwOnFailedPublish:!0,relayRpcId:o})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:n}=r;if(this.client.session.keys.includes(n))await this.sendRequest({topic:n,method:"wc_sessionDelete",params:tn("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:n,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(n))await this.client.core.pairing.disconnect({topic:n});else{const{message:i}=Be("MISMATCHED_TOPIC",`Session or pairing topic not found: ${n}`);throw new Error(i)}},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(n=>Sfe(n,r))),this.getPendingSessionRequests=()=>this.client.pendingRequest.getAll(),this.authenticate=async r=>{this.isInitialized(),this.isValidAuthenticate(r);const{chains:n,statement:i="",uri:s,domain:o,nonce:a,type:c,exp:d,nbf:l,methods:u=[]}=r,h=[...r.resources||[]],{topic:p,uri:_}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"]});this.client.logger.info({message:"Generated new pairing",pairing:{topic:p,uri:_}});const g=await this.client.core.crypto.generateKeyPair(),E=hb(g);if(await Promise.all([this.client.auth.authKeys.set(pb,{responseTopic:E,publicKey:g}),this.client.auth.pairingTopics.set(E,{topic:E,pairingTopic:p})]),await this.client.core.relayer.subscribe(E),this.client.logger.info(`sending request to new pairing topic: ${p}`),u.length>0){const{namespace:A}=fR(n[0]);let m=Ghe(A,"request",u);ub(h)&&(m=Khe(m,h.pop())),h.push(m)}const b=ss(na.wc_sessionPropose.req.ttl),v={authPayload:{type:c??"caip122",chains:n,statement:i,aud:s,domain:o,version:"1",nonce:a,iat:new Date().toISOString(),exp:d,nbf:l,resources:h},requester:{publicKey:g,metadata:this.client.metadata},expiryTimestamp:b},I={eip155:{chains:n,methods:[...new Set(["personal_sign",...u])],events:["chainChanged","accountsChanged"]}},N={requiredNamespaces:{},optionalNamespaces:I,relays:[{protocol:"irn"}],proposer:{publicKey:g,metadata:this.client.metadata},expiryTimestamp:b},{done:L,resolve:U,reject:w}=Sh(na.wc_sessionAuthenticate.req.ttl,"Request expired"),V=async({error:A,session:m})=>{if(this.events.off(ur("session_request",K),z),A)w(A);else if(m){m.self.publicKey=g,await this.client.session.set(m.topic,m),await this.setExpiry(m.topic,m.expiry),p&&await this.client.core.pairing.updateMetadata({topic:p,metadata:m.peer.metadata});const S=this.client.session.get(m.topic);U({session:S})}},z=async A=>{if(A.error){const P=tn("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return A.error.code===P.code?void 0:(this.events.off(ur("session_connect"),V),w(A.error.message))}this.events.off(ur("session_connect"),V);const{cacaos:m,responder:S}=A.result,T=[],x=[];for(const P of m){await EM({cacao:P,projectId:this.client.core.projectId})||(this.client.logger.error(P,"Signature verification failed"),w(tn("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:y}=P,f=ub(y.resources),R=[_M(y.iss)],B=U1(y.iss);if(f){const q=vM(f),F=yM(f);T.push(...q),R.push(...F)}for(const q of R)x.push(`${q}:${B}`)}const D=await this.client.core.crypto.generateSharedKey(g,S.publicKey);let k;T.length>0&&(k={topic:D,acknowledged:!0,self:{publicKey:g,metadata:this.client.metadata},peer:S,controller:S.publicKey,expiry:ss(Kf),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:p,namespaces:CM([...new Set(T)],[...new Set(x)])},await this.client.core.relayer.subscribe(D),await this.client.session.set(D,k),k=this.client.session.get(D)),U({auths:m,session:k})},K=Ql(),H=Ql();this.events.once(ur("session_connect"),V),this.events.once(ur("session_request",K),z);try{await Promise.all([this.sendRequest({topic:p,method:"wc_sessionAuthenticate",params:v,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:K}),this.sendRequest({topic:p,method:"wc_sessionPropose",params:N,expiry:na.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:H})])}catch(A){throw this.events.off(ur("session_connect"),V),this.events.off(ur("session_request",K),z),A}return await this.setProposal(H,vi({id:H},N)),await this.client.auth.requests.set(K,{authPayload:v.authPayload,requester:v.requester,expiryTimestamp:b,id:K,pairingTopic:p,verifyContext:{}}),{uri:_,response:L}},this.approveSessionAuthenticate=async r=>{this.isInitialized();const{id:n,auths:i}=r,s=this.getPendingAuthRequest(n);if(!s)throw new Error(`Could not find pending auth request with id ${n}`);const o=s.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=hb(o),d={type:Mu,receiverPublicKey:o,senderPublicKey:a},l=[],u=[];for(const _ of i){if(!await EM({cacao:_,projectId:this.client.core.projectId})){const I=tn("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:n,topic:c,error:I,encodeOpts:d}),new Error(I.message)}const{p:g}=_,E=ub(g.resources),b=[_M(g.iss)],v=U1(g.iss);if(E){const I=vM(E),N=yM(E);l.push(...I),b.push(...N)}for(const I of b)u.push(`${I}:${v}`)}const h=await this.client.core.crypto.generateSharedKey(a,o);let p;return(l==null?void 0:l.length)>0&&(p={topic:h,acknowledged:!0,self:{publicKey:a,metadata:this.client.metadata},peer:{publicKey:o,metadata:s.requester.metadata},controller:o,expiry:ss(Kf),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:"",namespaces:CM([...new Set(l)],[...new Set(u)])},await this.client.core.relayer.subscribe(h),await this.client.session.set(h,p)),await this.sendResult({topic:c,id:n,result:{cacaos:i,responder:{publicKey:a,metadata:this.client.metadata}},encodeOpts:d,throwOnFailedPublish:!0}),await this.client.auth.requests.delete(n,{message:"fullfilled",code:0}),await this.client.core.pairing.activate({topic:s.pairingTopic}),{session:p}},this.rejectSessionAuthenticate=async r=>{await this.isInitialized();const{id:n,reason:i}=r,s=this.getPendingAuthRequest(n);if(!s)throw new Error(`Could not find pending auth request with id ${n}`);const o=s.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=hb(o),d={type:Mu,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:n,topic:c,error:i,encodeOpts:d}),await this.client.auth.requests.delete(n,{message:"rejected",code:0}),await this.client.proposal.delete(n,tn("USER_DISCONNECTED"))},this.formatAuthMessage=r=>{this.isInitialized();const{request:n,iss:i}=r;return fW(n,i)},this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const n=this.client.core.pairing.pairings.get(r.pairingTopic),i=this.client.core.pairing.pairings.getAll().filter(s=>{var o,a;return((o=s.peerMetadata)==null?void 0:o.url)&&((a=s.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&s.topic&&s.topic!==n.topic});if(i.length===0)return;this.client.logger.info(`Cleaning up ${i.length} duplicate pairing(s)`),await Promise.all(i.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async r=>{const{topic:n,expirerHasDeleted:i=!1,emitEvent:s=!0,id:o=0}=r,{self:a}=this.client.session.get(n);await this.client.core.relayer.unsubscribe(n),await this.client.session.delete(n,tn("USER_DISCONNECTED")),this.addToRecentlyDeleted(n,"session"),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(n)&&await this.client.core.crypto.deleteSymKey(n),i||this.client.core.expirer.del(n),this.client.core.storage.removeItem(i6).catch(c=>this.client.logger.warn(c)),this.getPendingSessionRequests().forEach(c=>{c.topic===n&&this.deletePendingSessionRequest(c.id,tn("USER_DISCONNECTED"))}),s&&this.client.events.emit("session_delete",{id:o,topic:n})},this.deleteProposal=async(r,n)=>{await Promise.all([this.client.proposal.delete(r,tn("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")},this.deletePendingSessionRequest=async(r,n,i=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),i?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==r),i&&(this.sessionRequestQueue.state=Wd.idle,this.client.events.emit("session_request_expire",{id:r}))},this.setExpiry=async(r,n)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:n}),this.client.core.expirer.set(r,n)},this.setProposal=async(r,n)=>{await this.client.proposal.set(r,n),this.client.core.expirer.set(r,ss(na.wc_sessionPropose.req.ttl))},this.setPendingSessionRequest=async r=>{const{id:n,topic:i,params:s,verifyContext:o}=r,a=s.request.expiryTimestamp||ss(na.wc_sessionRequest.req.ttl);await this.client.pendingRequest.set(n,{id:n,topic:i,params:s,verifyContext:o}),a&&this.client.core.expirer.set(n,a)},this.sendRequest=async r=>{const{topic:n,method:i,params:s,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:d}=r,l=om(i,s,c);if(o0()&&cge.includes(i)){const p=jh(JSON.stringify(l));this.client.core.verify.register({attestationId:p})}let u;try{u=await this.client.core.crypto.encode(n,l)}catch(p){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${n} failed`),p}const h=na[i].req;return o&&(h.ttl=o),a&&(h.id=a),this.client.core.history.set(n,l),d?(h.internal=Yf(vi({},h.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,u,h)):this.client.core.relayer.publish(n,u,h).catch(p=>this.client.logger.error(p)),l.id},this.sendResult=async r=>{const{id:n,topic:i,result:s,throwOnFailedPublish:o,encodeOpts:a}=r,c=fP(n,s);let d;try{d=await this.client.core.crypto.encode(i,c,a)}catch(h){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${i} failed`),h}let l;try{l=await this.client.core.history.get(i,n)}catch(h){throw this.client.logger.error(`sendResult() -> history.get(${i}, ${n}) failed`),h}const u=na[l.request.method].res;o?(u.internal=Yf(vi({},u.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,d,u)):this.client.core.relayer.publish(i,d,u).catch(h=>this.client.logger.error(h)),await this.client.core.history.resolve(c)},this.sendError=async r=>{const{id:n,topic:i,error:s,encodeOpts:o}=r,a=pP(n,s);let c;try{c=await this.client.core.crypto.encode(i,a,o)}catch(u){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${i} failed`),u}let d;try{d=await this.client.core.history.get(i,n)}catch(u){throw this.client.logger.error(`sendError() -> history.get(${i}, ${n}) failed`),u}const l=na[d.request.method].res;this.client.core.relayer.publish(i,c,l),await this.client.core.history.resolve(a)},this.cleanup=async()=>{const r=[],n=[];this.client.session.getAll().forEach(i=>{let s=!1;Jl(i.expiry)&&(s=!0),this.client.core.crypto.keychain.has(i.topic)||(s=!0),s&&r.push(i.topic)}),this.client.proposal.getAll().forEach(i=>{Jl(i.expiryTimestamp)&&n.push(i.id)}),await Promise.all([...r.map(i=>this.deleteSession({topic:i})),...n.map(i=>this.deleteProposal(i))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===Wd.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Wd.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=Wd.idle},this.processRequest=r=>{const{topic:n,payload:i}=r,s=i.method;if(!this.shouldIgnorePairingRequest({topic:n,requestMethod:s}))switch(s){case"wc_sessionPropose":return this.onSessionProposeRequest(n,i);case"wc_sessionSettle":return this.onSessionSettleRequest(n,i);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,i);case"wc_sessionExtend":return this.onSessionExtendRequest(n,i);case"wc_sessionPing":return this.onSessionPingRequest(n,i);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,i);case"wc_sessionRequest":return this.onSessionRequest(n,i);case"wc_sessionEvent":return this.onSessionEventRequest(n,i);case"wc_sessionAuthenticate":return this.onSessionAuthenticateRequest(n,i);default:return this.client.logger.info(`Unsupported request method ${s}`)}},this.onRelayEventResponse=async r=>{const{topic:n,payload:i}=r,s=(await this.client.core.history.get(n,i.id)).request.method;switch(s){case"wc_sessionPropose":return this.onSessionProposeResponse(n,i);case"wc_sessionSettle":return this.onSessionSettleResponse(n,i);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,i);case"wc_sessionExtend":return this.onSessionExtendResponse(n,i);case"wc_sessionPing":return this.onSessionPingResponse(n,i);case"wc_sessionRequest":return this.onSessionRequestResponse(n,i);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(n,i);default:return this.client.logger.info(`Unsupported response method ${s}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:n}=r,{message:i}=Be("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(i)},this.shouldIgnorePairingRequest=r=>{const{topic:n,requestMethod:i}=r,s=this.expectedPairingMethodMap.get(n);return!s||s.includes(i)?!1:!!(s.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)},this.onSessionProposeRequest=async(r,n)=>{const{params:i,id:s}=n;try{this.isValidConnect(vi({},n.params));const o=i.expiryTimestamp||ss(na.wc_sessionPropose.req.ttl),a=vi({id:s,pairingTopic:r,expiryTimestamp:o},i);await this.setProposal(s,a);const c=jh(JSON.stringify(n)),d=await this.getVerifyContext(c,a.proposer.metadata);this.client.events.emit("session_proposal",{id:s,params:a,verifyContext:d})}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}},this.onSessionProposeResponse=async(r,n)=>{const{id:i}=n;if($c(n)){const{result:s}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:s});const o=this.client.proposal.get(i);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:o});const a=o.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:a});const c=s.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:c});const d=await this.client.core.crypto.generateSharedKey(a,c);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:d});const l=await this.client.core.relayer.subscribe(d);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:l}),await this.client.core.pairing.activate({topic:r})}else if(ya(n)){await this.client.proposal.delete(i,tn("USER_DISCONNECTED"));const s=ur("session_connect");if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners, 954`);this.events.emit(ur("session_connect"),{error:n.error})}},this.onSessionSettleRequest=async(r,n)=>{const{id:i,params:s}=n;try{this.isValidSessionSettleRequest(s);const{relay:o,controller:a,expiry:c,namespaces:d,sessionProperties:l,pairingTopic:u,sessionConfig:h}=n.params,p=vi(vi({topic:r,relay:o,expiry:c,namespaces:d,acknowledged:!0,pairingTopic:u,requiredNamespaces:{},optionalNamespaces:{},controller:a.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},l&&{sessionProperties:l}),h&&{sessionConfig:h});await this.sendResult({id:n.id,topic:r,result:!0,throwOnFailedPublish:!0});const _=ur("session_connect");if(this.events.listenerCount(_)===0)throw new Error(`emitting ${_} without any listeners 997`);this.events.emit(ur("session_connect"),{session:p}),this.cleanupDuplicatePairings(p)}catch(o){await this.sendError({id:i,topic:r,error:o}),this.client.logger.error(o)}},this.onSessionSettleResponse=async(r,n)=>{const{id:i}=n;$c(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(ur("session_approve",i),{})):ya(n)&&(await this.client.session.delete(r,tn("USER_DISCONNECTED")),this.events.emit(ur("session_approve",i),{error:n.error}))},this.onSessionUpdateRequest=async(r,n)=>{const{params:i,id:s}=n;try{const o=`${r}_session_update`,a=ng.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.info(`Discarding out of sync request - ${s}`),this.sendError({id:s,topic:r,error:tn("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(vi({topic:r},i));try{ng.set(o,s),await this.client.session.update(r,{namespaces:i.namespaces}),await this.sendResult({id:s,topic:r,result:!0,throwOnFailedPublish:!0})}catch(c){throw ng.delete(o),c}this.client.events.emit("session_update",{id:s,topic:r,params:i})}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}},this.isRequestOutOfSync=(r,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,n)=>{const{id:i}=n,s=ur("session_update",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);$c(n)?this.events.emit(ur("session_update",i),{}):ya(n)&&this.events.emit(ur("session_update",i),{error:n.error})},this.onSessionExtendRequest=async(r,n)=>{const{id:i}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,ss(Kf)),await this.sendResult({id:i,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:i,topic:r})}catch(s){await this.sendError({id:i,topic:r,error:s}),this.client.logger.error(s)}},this.onSessionExtendResponse=(r,n)=>{const{id:i}=n,s=ur("session_extend",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);$c(n)?this.events.emit(ur("session_extend",i),{}):ya(n)&&this.events.emit(ur("session_extend",i),{error:n.error})},this.onSessionPingRequest=async(r,n)=>{const{id:i}=n;try{this.isValidPing({topic:r}),await this.sendResult({id:i,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:i,topic:r})}catch(s){await this.sendError({id:i,topic:r,error:s}),this.client.logger.error(s)}},this.onSessionPingResponse=(r,n)=>{const{id:i}=n,s=ur("session_ping",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);setTimeout(()=>{$c(n)?this.events.emit(ur("session_ping",i),{}):ya(n)&&this.events.emit(ur("session_ping",i),{error:n.error})},500)},this.onSessionDeleteRequest=async(r,n)=>{const{id:i}=n;try{this.isValidDisconnect({topic:r,reason:n.params}),await Promise.all([new Promise(s=>{this.client.core.relayer.once(Oo.publish,async()=>{s(await this.deleteSession({topic:r,id:i}))})}),this.sendResult({id:i,topic:r,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:tn("USER_DISCONNECTED")})])}catch(s){this.client.logger.error(s)}},this.onSessionRequest=async(r,n)=>{const{id:i,params:s}=n;try{await this.isValidRequest(vi({topic:r},s));const o=jh(JSON.stringify(om("wc_sessionRequest",s,i))),a=this.client.session.get(r),c=await this.getVerifyContext(o,a.peer.metadata),d={id:i,topic:r,params:s,verifyContext:c};await this.setPendingSessionRequest(d),this.addSessionRequestToSessionRequestQueue(d),this.processSessionRequestQueue()}catch(o){await this.sendError({id:i,topic:r,error:o}),this.client.logger.error(o)}},this.onSessionRequestResponse=(r,n)=>{const{id:i}=n,s=ur("session_request",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);$c(n)?this.events.emit(ur("session_request",i),{result:n.result}):ya(n)&&this.events.emit(ur("session_request",i),{error:n.error})},this.onSessionEventRequest=async(r,n)=>{const{id:i,params:s}=n;try{const o=`${r}_session_event_${s.event.name}`,a=ng.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.info(`Discarding out of sync request - ${i}`);return}this.isValidEmit(vi({topic:r},s)),this.client.events.emit("session_event",{id:i,topic:r,params:s}),ng.set(o,i)}catch(o){await this.sendError({id:i,topic:r,error:o}),this.client.logger.error(o)}},this.onSessionAuthenticateResponse=(r,n)=>{const{id:i}=n;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:n}),$c(n)?this.events.emit(ur("session_request",i),{result:n.result}):ya(n)&&this.events.emit(ur("session_request",i),{error:n.error})},this.onSessionAuthenticateRequest=async(r,n)=>{const{requester:i,authPayload:s,expiryTimestamp:o}=n.params,a=jh(JSON.stringify(n)),c=await this.getVerifyContext(a,this.client.metadata),d={requester:i,pairingTopic:r,id:n.id,authPayload:s,verifyContext:c,expiryTimestamp:o};await this.client.auth.requests.set(n.id,d),this.client.events.emit("session_authenticate",{topic:r,params:n.params,id:n.id})},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Wd.idle,this.processSessionRequestQueue()},Ge.toMiliseconds(this.requestQueueDelay))},this.cleanupPendingSentRequestsForTopic=({topic:r,error:n})=>{const i=this.client.core.history.pending;i.length>0&&i.filter(s=>s.topic===r&&s.request.method==="wc_sessionRequest").forEach(s=>{const o=s.request.id,a=ur("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(ur("session_request",s.request.id),{error:n})})},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===Wd.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=Wd.active,this.client.events.emit("session_request",r)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const n=this.client.proposal.getAll().find(i=>i.pairingTopic===r.topic);n&&this.onSessionProposeRequest(r.topic,om("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties},n.id))},this.isValidConnect=async r=>{if(!Hs(r)){const{message:c}=Be("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(c)}const{pairingTopic:n,requiredNamespaces:i,optionalNamespaces:s,sessionProperties:o,relays:a}=r;if(Zs(n)||await this.isValidPairingTopic(n),!Lfe(a)){const{message:c}=Be("MISSING_OR_INVALID",`connect() relays: ${a}`);throw new Error(c)}!Zs(i)&&F1(i)!==0&&this.validateNamespaces(i,"requiredNamespaces"),!Zs(s)&&F1(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),Zs(o)||this.validateSessionProps(o,"sessionProperties")},this.validateNamespaces=(r,n)=>{const i=kfe(r,"connect()",n);if(i)throw new Error(i.message)},this.isValidApprove=async r=>{if(!Hs(r))throw new Error(Be("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:n,namespaces:i,relayProtocol:s,sessionProperties:o}=r;this.checkRecentlyDeleted(n),await this.isValidProposalId(n);const a=this.client.proposal.get(n),c=OR(i,"approve()");if(c)throw new Error(c.message);const d=NM(a.requiredNamespaces,i,"approve()");if(d)throw new Error(d.message);if(!qn(s,!0)){const{message:l}=Be("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(l)}Zs(o)||this.validateSessionProps(o,"sessionProperties")},this.isValidReject=async r=>{if(!Hs(r)){const{message:s}=Be("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(s)}const{id:n,reason:i}=r;if(this.checkRecentlyDeleted(n),await this.isValidProposalId(n),!Mfe(i)){const{message:s}=Be("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(i)}`);throw new Error(s)}},this.isValidSessionSettleRequest=r=>{if(!Hs(r)){const{message:d}=Be("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(d)}const{relay:n,controller:i,namespaces:s,expiry:o}=r;if(!vW(n)){const{message:d}=Be("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(d)}const a=Cfe(i,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=OR(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(Jl(o)){const{message:d}=Be("EXPIRED","onSessionSettleRequest()");throw new Error(d)}},this.isValidUpdate=async r=>{if(!Hs(r)){const{message:c}=Be("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}const{topic:n,namespaces:i}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const s=this.client.session.get(n),o=OR(i,"update()");if(o)throw new Error(o.message);const a=NM(s.requiredNamespaces,i,"update()");if(a)throw new Error(a.message)},this.isValidExtend=async r=>{if(!Hs(r)){const{message:i}=Be("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(i)}const{topic:n}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n)},this.isValidRequest=async r=>{if(!Hs(r)){const{message:c}=Be("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}const{topic:n,request:i,chainId:s,expiry:o}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const{namespaces:a}=this.client.session.get(n);if(!OM(a,s)){const{message:c}=Be("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(c)}if(!Ufe(i)){const{message:c}=Be("MISSING_OR_INVALID",`request() ${JSON.stringify(i)}`);throw new Error(c)}if(!Bfe(a,s,i.method)){const{message:c}=Be("MISSING_OR_INVALID",`request() method: ${i.method}`);throw new Error(c)}if(o&&!zfe(o,xR)){const{message:c}=Be("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${xR.min} and ${xR.max}`);throw new Error(c)}},this.isValidRespond=async r=>{var n;if(!Hs(r)){const{message:o}=Be("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(o)}const{topic:i,response:s}=r;try{await this.isValidSessionTopic(i)}catch(o){throw(n=r==null?void 0:r.response)!=null&&n.id&&this.cleanupAfterResponse(r),o}if(!jfe(s)){const{message:o}=Be("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(o)}},this.isValidPing=async r=>{if(!Hs(r)){const{message:i}=Be("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(i)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async r=>{if(!Hs(r)){const{message:a}=Be("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}const{topic:n,event:i,chainId:s}=r;await this.isValidSessionTopic(n);const{namespaces:o}=this.client.session.get(n);if(!OM(o,s)){const{message:a}=Be("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(a)}if(!Ffe(i)){const{message:a}=Be("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}if(!Vfe(o,s,i.name)){const{message:a}=Be("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}},this.isValidDisconnect=async r=>{if(!Hs(r)){const{message:i}=Be("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(i)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.isValidAuthenticate=r=>{const{chains:n,uri:i,domain:s,nonce:o}=r;if(!Array.isArray(n)||n.length===0)throw new Error("chains is required and must be a non-empty array");if(!qn(i,!1))throw new Error("uri is required parameter");if(!qn(s,!1))throw new Error("domain is required parameter");if(!qn(o,!1))throw new Error("nonce is required parameter");if([...new Set(n.map(c=>fR(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=fR(n[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")},this.getVerifyContext=async(r,n)=>{const i={verified:{verifyUrl:n.verifyUrl||jp,validation:"UNKNOWN",origin:n.url||""}};try{const s=await this.client.core.verify.resolve({attestationId:r,verifyUrl:n.verifyUrl});s&&(i.verified.origin=s.origin,i.verified.isScam=s.isScam,i.verified.validation=s.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(s){this.client.logger.info(s)}return this.client.logger.info(`Verify context: ${JSON.stringify(i)}`),i},this.validateSessionProps=(r,n)=>{Object.values(r).forEach(i=>{if(!qn(i,!1)){const{message:s}=Be("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(i)}`);throw new Error(s)}})},this.getPendingAuthRequest=r=>{const n=this.client.auth.requests.get(r);return typeof n=="object"?n:void 0},this.addToRecentlyDeleted=(r,n)=>{if(this.recentlyDeletedMap.set(r,n),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let i=0;const s=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(i++>=s)break;this.recentlyDeletedMap.delete(o)}}},this.checkRecentlyDeleted=r=>{const n=this.recentlyDeletedMap.get(r);if(n){const{message:i}=Be("MISSING_OR_INVALID",`Record was recently deleted - ${n}: ${r}`);throw new Error(i)}}}async isInitialized(){if(!this.initialized){const{message:t}=Be("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Oo.message,async t=>{const{topic:r,message:n}=t,{publicKey:i}=this.client.auth.authKeys.keys.includes(pb)?this.client.auth.authKeys.get(pb):{responseTopic:void 0,publicKey:void 0},s=await this.client.core.crypto.decode(r,n,{receiverPublicKey:i});try{mP(s)?(this.client.core.history.set(r,s),this.onRelayEventRequest({topic:r,payload:s})):Ew(s)?(await this.client.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.client.core.history.delete(r,s.id)):this.onRelayEventUnknownPayload({topic:r,payload:s})}catch(o){this.client.logger.error(o)}})}registerExpirerEvents(){this.client.core.expirer.on(pa.expired,async t=>{const{topic:r,id:n}=Dz(t.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,Be("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Up.create,t=>this.onPairingCreated(t)),this.client.core.pairing.events.on(Up.delete,t=>{this.addToRecentlyDeleted(t.topic,"pairing")})}isValidPairingTopic(t){if(!qn(t,!1)){const{message:r}=Be("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=Be("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(Jl(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=Be("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!qn(t,!1)){const{message:r}=Be("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(this.checkRecentlyDeleted(t),!this.client.session.keys.includes(t)){const{message:r}=Be("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(Jl(this.client.session.get(t).expiry)){await this.deleteSession({topic:t});const{message:r}=Be("EXPIRED",`session topic: ${t}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(t)){const{message:r}=Be("MISSING_OR_INVALID",`session topic does not exist in keychain: ${t}`);throw await this.deleteSession({topic:t}),new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.checkRecentlyDeleted(t),this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(qn(t,!1)){const{message:r}=Be("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=Be("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!xfe(t)){const{message:r}=Be("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=Be("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(Jl(this.client.proposal.get(t).expiryTimestamp)){await this.deleteProposal(t);const{message:r}=Be("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}},yge=class extends Lf{constructor(t,r){super(t,r,nge,_P),this.core=t,this.logger=r}},bge=class extends Lf{constructor(t,r){super(t,r,sge,_P),this.core=t,this.logger=r}},Sge=class extends Lf{constructor(t,r){super(t,r,age,_P,n=>n.id),this.core=t,this.logger=r}},wge=class extends Lf{constructor(t,r){super(t,r,uge,yw,()=>pb),this.core=t,this.logger=r}},Tge=class extends Lf{constructor(t,r){super(t,r,hge,yw),this.core=t,this.logger=r}},Rge=class extends Lf{constructor(t,r){super(t,r,fge,yw,n=>n.id),this.core=t,this.logger=r}},Age=class{constructor(t,r){this.core=t,this.logger=r,this.authKeys=new wge(this.core,this.logger),this.pairingTopics=new Tge(this.core,this.logger),this.requests=new Rge(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}},Cge=class $W extends nae{constructor(t){super(t),this.protocol=FW,this.version=BW,this.name=LR.name,this.events=new Sc.EventEmitter,this.on=(n,i)=>this.events.on(n,i),this.once=(n,i)=>this.events.once(n,i),this.off=(n,i)=>this.events.off(n,i),this.removeListener=(n,i)=>this.events.removeListener(n,i),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(i){throw this.logger.error(i.message),i}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(i){throw this.logger.error(i.message),i}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(i){throw this.logger.error(i.message),i}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(i){throw this.logger.error(i.message),i}},this.update=async n=>{try{return await this.engine.update(n)}catch(i){throw this.logger.error(i.message),i}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(i){throw this.logger.error(i.message),i}},this.request=async n=>{try{return await this.engine.request(n)}catch(i){throw this.logger.error(i.message),i}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(i){throw this.logger.error(i.message),i}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(i){throw this.logger.error(i.message),i}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(i){throw this.logger.error(i.message),i}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(i){throw this.logger.error(i.message),i}},this.find=n=>{try{return this.engine.find(n)}catch(i){throw this.logger.error(i.message),i}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.authenticate=async n=>{try{return await this.engine.authenticate(n)}catch(i){throw this.logger.error(i.message),i}},this.formatAuthMessage=n=>{try{return this.engine.formatAuthMessage(n)}catch(i){throw this.logger.error(i.message),i}},this.approveSessionAuthenticate=async n=>{try{return await this.engine.approveSessionAuthenticate(n)}catch(i){throw this.logger.error(i.message),i}},this.rejectSessionAuthenticate=async n=>{try{return await this.engine.rejectSessionAuthenticate(n)}catch(i){throw this.logger.error(i.message),i}},this.name=(t==null?void 0:t.name)||LR.name,this.metadata=(t==null?void 0:t.metadata)||zde();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:lw(KD({level:(t==null?void 0:t.logger)||LR.logger}));this.core=(t==null?void 0:t.core)||new rge(t),this.logger=_o(r,this.name),this.session=new bge(this.core,this.logger),this.proposal=new yge(this.core,this.logger),this.pendingRequest=new Sge(this.core,this.logger),this.engine=new vge(this),this.auth=new Age(this.core,this.logger)}static async init(t){const r=new $W(t);return await r.initialize(),r}get context(){return go(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),await this.auth.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};var Ige=Object.defineProperty,Oge=Object.defineProperties,Nge=Object.getOwnPropertyDescriptors,a6=Object.getOwnPropertySymbols,Dge=Object.prototype.hasOwnProperty,Pge=Object.prototype.propertyIsEnumerable,c6=(e,t,r)=>t in e?Ige(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,kge=(e,t)=>{for(var r in t||(t={}))Dge.call(t,r)&&c6(e,r,t[r]);if(a6)for(var r of a6(t))Pge.call(t,r)&&c6(e,r,t[r]);return e},Lge=(e,t)=>Oge(e,Nge(t)),EP=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},fn=(e,t,r)=>(EP(e,t,"read from private field"),t.get(e)),hh=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},$1=(e,t,r,n)=>(EP(e,t,"write to private field"),t.set(e,r),r),rs=(e,t,r)=>(EP(e,t,"access private method"),r),Ch,_p,Og,li,e2,HW,ns,ps,t2,d6;let xge=class{constructor(t){hh(this,e2),hh(this,ns),hh(this,t2),hh(this,Ch,void 0),hh(this,_p,void 0),hh(this,Og,void 0),hh(this,li,void 0),$1(this,Ch,t),$1(this,_p,rs(this,e2,HW).call(this)),rs(this,ns,ps).call(this)}async connect(t,r=!0){const{requiredNamespaces:n,optionalNamespaces:i}=t;return new Promise(async(s,o)=>{var a,c;if(await rs(this,ns,ps).call(this),r){const d=fn(this,_p).subscribeModal(h=>{h.open||(d(),o(new Error("Modal closed")))}),{uri:l,approval:u}=await fn(this,li).connect(t);if(l){const h=new Set;n&&Object.values(n).forEach(({chains:p})=>{p&&p.forEach(_=>h.add(_))}),i&&Object.values(i).forEach(({chains:p})=>{p&&p.forEach(_=>h.add(_))}),await fn(this,_p).openModal({uri:l,chains:Array.from(h)})}try{const h=await u();s(h)}catch(h){o(h)}finally{d(),fn(this,_p).closeModal()}}else{const{uri:d,approval:l}=await fn(this,li).connect(t);if(d){const u=new Set;n&&Object.values(n).forEach(({chains:h})=>{h&&h.forEach(p=>u.add(p))}),i&&Object.values(i).forEach(({chains:h})=>{h&&h.forEach(p=>u.add(p))});try{if((a=window==null?void 0:window.aleo)!=null&&a.connectPuzzle){(c=window==null?void 0:window.aleo)==null||c.connectPuzzle({wc:{uri:d}});const h=await l();s(h)}else throw new Error("window.aleo.connectPuzzle is undefined! Set showModal to true.")}catch(h){console.error(h),o(h)}}}})}async disconnect(t){await rs(this,ns,ps).call(this),await fn(this,li).disconnect(t)}async request(t){return await rs(this,ns,ps).call(this),await fn(this,li).request(t)}async getSessions(){return await rs(this,ns,ps).call(this),fn(this,li).session.getAll()}async getSession(){return await rs(this,ns,ps).call(this),fn(this,li).session.getAll().at(-1)}async onSessionEvent(t){await rs(this,ns,ps).call(this),fn(this,li).on("session_event",t)}async offSessionEvent(t){await rs(this,ns,ps).call(this),fn(this,li).off("session_event",t)}async onSessionUpdate(t){await rs(this,ns,ps).call(this),fn(this,li).on("session_update",t)}async offSessionUpdate(t){await rs(this,ns,ps).call(this),fn(this,li).off("session_update",t)}async onSessionDelete(t){await rs(this,ns,ps).call(this),fn(this,li).on("session_delete",t)}async offSessionDelete(t){await rs(this,ns,ps).call(this),fn(this,li).off("session_delete",t)}async onSessionExpire(t){await rs(this,ns,ps).call(this),fn(this,li).on("session_expire",t)}async offSessionExpire(t){await rs(this,ns,ps).call(this),fn(this,li).off("session_expire",t)}};Ch=new WeakMap,_p=new WeakMap,Og=new WeakMap,li=new WeakMap,e2=new WeakSet,HW=function(){const{modalOptions:e,projectId:t}=fn(this,Ch);return new tse(Lge(kge({},e),{projectId:t}))},ns=new WeakSet,ps=async function(){return fn(this,li)?!0:(!fn(this,Og)&&typeof window<"u"&&$1(this,Og,rs(this,t2,d6).call(this)),fn(this,Og))},t2=new WeakSet,d6=async function(){$1(this,li,await Cge.init({metadata:fn(this,Ch).metadata,projectId:fn(this,Ch).projectId,relayUrl:fn(this,Ch).relayUrl}));const e=await fn(this,li).core.crypto.getClientId();try{localStorage.setItem("WCM_WALLETCONNECT_CLIENT_ID",e)}catch{console.info("Unable to set client id")}};var Nr;(function(e){e.assertEqual=i=>i;function t(i){}e.assertIs=t;function r(i){throw new Error}e.assertNever=r,e.arrayToEnum=i=>{const s={};for(const o of i)s[o]=o;return s},e.getValidEnumValues=i=>{const s=e.objectKeys(i).filter(a=>typeof i[i[a]]!="number"),o={};for(const a of s)o[a]=i[a];return e.objectValues(o)},e.objectValues=i=>e.objectKeys(i).map(function(s){return i[s]}),e.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const s=[];for(const o in i)Object.prototype.hasOwnProperty.call(i,o)&&s.push(o);return s},e.find=(i,s)=>{for(const o of i)if(s(o))return o},e.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,s=" | "){return i.map(o=>typeof o=="string"?`'${o}'`:o).join(s)}e.joinValues=n,e.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(Nr||(Nr={}));var r2;(function(e){e.mergeShapes=(t,r)=>({...t,...r})})(r2||(r2={}));const qe=Nr.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),su=e=>{switch(typeof e){case"undefined":return qe.undefined;case"string":return qe.string;case"number":return isNaN(e)?qe.nan:qe.number;case"boolean":return qe.boolean;case"function":return qe.function;case"bigint":return qe.bigint;case"symbol":return qe.symbol;case"object":return Array.isArray(e)?qe.array:e===null?qe.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?qe.promise:typeof Map<"u"&&e instanceof Map?qe.map:typeof Set<"u"&&e instanceof Set?qe.set:typeof Date<"u"&&e instanceof Date?qe.date:qe.object;default:return qe.unknown}},Me=Nr.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Mge=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class pc extends Error{constructor(t){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=t}get errors(){return this.issues}format(t){const r=t||function(s){return s.message},n={_errors:[]},i=s=>{for(const o of s.issues)if(o.code==="invalid_union")o.unionErrors.map(i);else if(o.code==="invalid_return_type")i(o.returnTypeError);else if(o.code==="invalid_arguments")i(o.argumentsError);else if(o.path.length===0)n._errors.push(r(o));else{let a=n,c=0;for(;c<o.path.length;){const d=o.path[c];c===o.path.length-1?(a[d]=a[d]||{_errors:[]},a[d]._errors.push(r(o))):a[d]=a[d]||{_errors:[]},a=a[d],c++}}};return i(this),n}toString(){return this.message}get message(){return JSON.stringify(this.issues,Nr.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=r=>r.message){const r={},n=[];for(const i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(t(i))):n.push(t(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}}pc.create=e=>new pc(e);const G_=(e,t)=>{let r;switch(e.code){case Me.invalid_type:e.received===qe.undefined?r="Required":r=`Expected ${e.expected}, received ${e.received}`;break;case Me.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,Nr.jsonStringifyReplacer)}`;break;case Me.unrecognized_keys:r=`Unrecognized key(s) in object: ${Nr.joinValues(e.keys,", ")}`;break;case Me.invalid_union:r="Invalid input";break;case Me.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Nr.joinValues(e.options)}`;break;case Me.invalid_enum_value:r=`Invalid enum value. Expected ${Nr.joinValues(e.options)}, received '${e.received}'`;break;case Me.invalid_arguments:r="Invalid function arguments";break;case Me.invalid_return_type:r="Invalid function return type";break;case Me.invalid_date:r="Invalid date";break;case Me.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:Nr.assertNever(e.validation):e.validation!=="regex"?r=`Invalid ${e.validation}`:r="Invalid";break;case Me.too_small:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:r="Invalid input";break;case Me.too_big:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?r=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:r="Invalid input";break;case Me.custom:r="Invalid input";break;case Me.invalid_intersection_types:r="Intersection results could not be merged";break;case Me.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case Me.not_finite:r="Number must be finite";break;default:r=t.defaultError,Nr.assertNever(e)}return{message:r}};let zW=G_;function Uge(e){zW=e}function H1(){return zW}const z1=e=>{const{data:t,path:r,errorMaps:n,issueData:i}=e,s=[...r,...i.path||[]],o={...i,path:s};let a="";const c=n.filter(d=>!!d).slice().reverse();for(const d of c)a=d(o,{data:t,defaultError:a}).message;return{...i,path:s,message:i.message||a}},jge=[];function Xe(e,t){const r=z1({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,H1(),G_].filter(n=>!!n)});e.common.issues.push(r)}class us{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,r){const n=[];for(const i of r){if(i.status==="aborted")return $t;i.status==="dirty"&&t.dirty(),n.push(i.value)}return{status:t.value,value:n}}static async mergeObjectAsync(t,r){const n=[];for(const i of r)n.push({key:await i.key,value:await i.value});return us.mergeObjectSync(t,n)}static mergeObjectSync(t,r){const n={};for(const i of r){const{key:s,value:o}=i;if(s.status==="aborted"||o.status==="aborted")return $t;s.status==="dirty"&&t.dirty(),o.status==="dirty"&&t.dirty(),(typeof o.value<"u"||i.alwaysSet)&&(n[s.value]=o.value)}return{status:t.value,value:n}}}const $t=Object.freeze({status:"aborted"}),WW=e=>({status:"dirty",value:e}),Ns=e=>({status:"valid",value:e}),n2=e=>e.status==="aborted",i2=e=>e.status==="dirty",W1=e=>e.status==="valid",G1=e=>typeof Promise<"u"&&e instanceof Promise;var vt;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(vt||(vt={}));class pd{constructor(t,r,n,i){this._cachedPath=[],this.parent=t,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const l6=(e,t)=>{if(W1(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new pc(e.common.issues);return this._error=r,this._error}}};function rr(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:n,description:i}=e;if(t&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:i}:{errorMap:(o,a)=>o.code!=="invalid_type"?{message:a.defaultError}:typeof a.data>"u"?{message:n??a.defaultError}:{message:r??a.defaultError},description:i}}class cr{constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(t){return su(t.data)}_getOrReturnCtx(t,r){return r||{common:t.parent.common,data:t.data,parsedType:su(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new us,ctx:{common:t.parent.common,data:t.data,parsedType:su(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const r=this._parse(t);if(G1(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(t){const r=this._parse(t);return Promise.resolve(r)}parse(t,r){const n=this.safeParse(t,r);if(n.success)return n.data;throw n.error}safeParse(t,r){var n;const i={common:{issues:[],async:(n=r==null?void 0:r.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:su(t)},s=this._parseSync({data:t,path:i.path,parent:i});return l6(i,s)}async parseAsync(t,r){const n=await this.safeParseAsync(t,r);if(n.success)return n.data;throw n.error}async safeParseAsync(t,r){const n={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:su(t)},i=this._parse({data:t,path:n.path,parent:n}),s=await(G1(i)?i:Promise.resolve(i));return l6(n,s)}refine(t,r){const n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,s)=>{const o=t(i),a=()=>s.addIssue({code:Me.custom,...n(i)});return typeof Promise<"u"&&o instanceof Promise?o.then(c=>c?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(t,r){return this._refinement((n,i)=>t(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(t){return new Ec({schema:this,typeName:Pt.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}optional(){return gl.create(this,this._def)}nullable(){return _f.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return mc.create(this,this._def)}promise(){return Nm.create(this,this._def)}or(t){return J_.create([this,t],this._def)}and(t){return X_.create(this,t,this._def)}transform(t){return new Ec({...rr(this._def),schema:this,typeName:Pt.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const r=typeof t=="function"?t:()=>t;return new rE({...rr(this._def),innerType:this,defaultValue:r,typeName:Pt.ZodDefault})}brand(){return new qW({typeName:Pt.ZodBranded,type:this,...rr(this._def)})}catch(t){const r=typeof t=="function"?t:()=>t;return new J1({...rr(this._def),innerType:this,catchValue:r,typeName:Pt.ZodCatch})}describe(t){const r=this.constructor;return new r({...this._def,description:t})}pipe(t){return KE.create(this,t)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Fge=/^c[^\s-]{8,}$/i,Bge=/^[a-z][a-z0-9]*$/,Vge=/[0-9A-HJKMNP-TV-Z]{26}/,$ge=/^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i,Hge=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\])|(\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\.[A-Za-z]{2,})+))$/,zge=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u"),Wge=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,Gge=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,qge=e=>e.precision?e.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}Z$`):e.precision===0?e.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):e.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function Kge(e,t){return!!((t==="v4"||!t)&&Wge.test(e)||(t==="v6"||!t)&&Gge.test(e))}class lc extends cr{constructor(){super(...arguments),this._regex=(t,r,n)=>this.refinement(i=>t.test(i),{validation:r,code:Me.invalid_string,...vt.errToObj(n)}),this.nonempty=t=>this.min(1,vt.errToObj(t)),this.trim=()=>new lc({...this._def,checks:[...this._def.checks,{kind:"trim"}]}),this.toLowerCase=()=>new lc({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]}),this.toUpperCase=()=>new lc({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==qe.string){const s=this._getOrReturnCtx(t);return Xe(s,{code:Me.invalid_type,expected:qe.string,received:s.parsedType}),$t}const n=new us;let i;for(const s of this._def.checks)if(s.kind==="min")t.data.length<s.value&&(i=this._getOrReturnCtx(t,i),Xe(i,{code:Me.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")t.data.length>s.value&&(i=this._getOrReturnCtx(t,i),Xe(i,{code:Me.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){const o=t.data.length>s.value,a=t.data.length<s.value;(o||a)&&(i=this._getOrReturnCtx(t,i),o?Xe(i,{code:Me.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):a&&Xe(i,{code:Me.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")Hge.test(t.data)||(i=this._getOrReturnCtx(t,i),Xe(i,{validation:"email",code:Me.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")zge.test(t.data)||(i=this._getOrReturnCtx(t,i),Xe(i,{validation:"emoji",code:Me.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")$ge.test(t.data)||(i=this._getOrReturnCtx(t,i),Xe(i,{validation:"uuid",code:Me.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")Fge.test(t.data)||(i=this._getOrReturnCtx(t,i),Xe(i,{validation:"cuid",code:Me.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")Bge.test(t.data)||(i=this._getOrReturnCtx(t,i),Xe(i,{validation:"cuid2",code:Me.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")Vge.test(t.data)||(i=this._getOrReturnCtx(t,i),Xe(i,{validation:"ulid",code:Me.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(t.data)}catch{i=this._getOrReturnCtx(t,i),Xe(i,{validation:"url",code:Me.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(t.data)||(i=this._getOrReturnCtx(t,i),Xe(i,{validation:"regex",code:Me.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?t.data=t.data.trim():s.kind==="includes"?t.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(t,i),Xe(i,{code:Me.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?t.data=t.data.toLowerCase():s.kind==="toUpperCase"?t.data=t.data.toUpperCase():s.kind==="startsWith"?t.data.startsWith(s.value)||(i=this._getOrReturnCtx(t,i),Xe(i,{code:Me.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?t.data.endsWith(s.value)||(i=this._getOrReturnCtx(t,i),Xe(i,{code:Me.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?qge(s).test(t.data)||(i=this._getOrReturnCtx(t,i),Xe(i,{code:Me.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="ip"?Kge(t.data,s.version)||(i=this._getOrReturnCtx(t,i),Xe(i,{validation:"ip",code:Me.invalid_string,message:s.message}),n.dirty()):Nr.assertNever(s);return{status:n.value,value:t.data}}_addCheck(t){return new lc({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...vt.errToObj(t)})}url(t){return this._addCheck({kind:"url",...vt.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...vt.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...vt.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...vt.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...vt.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...vt.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...vt.errToObj(t)})}datetime(t){var r;return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(r=t==null?void 0:t.offset)!==null&&r!==void 0?r:!1,...vt.errToObj(t==null?void 0:t.message)})}regex(t,r){return this._addCheck({kind:"regex",regex:t,...vt.errToObj(r)})}includes(t,r){return this._addCheck({kind:"includes",value:t,position:r==null?void 0:r.position,...vt.errToObj(r==null?void 0:r.message)})}startsWith(t,r){return this._addCheck({kind:"startsWith",value:t,...vt.errToObj(r)})}endsWith(t,r){return this._addCheck({kind:"endsWith",value:t,...vt.errToObj(r)})}min(t,r){return this._addCheck({kind:"min",value:t,...vt.errToObj(r)})}max(t,r){return this._addCheck({kind:"max",value:t,...vt.errToObj(r)})}length(t,r){return this._addCheck({kind:"length",value:t,...vt.errToObj(r)})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get minLength(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxLength(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}lc.create=e=>{var t;return new lc({checks:[],typeName:Pt.ZodString,coerce:(t=e==null?void 0:e.coerce)!==null&&t!==void 0?t:!1,...rr(e)})};function Yge(e,t){const r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,i=r>n?r:n,s=parseInt(e.toFixed(i).replace(".","")),o=parseInt(t.toFixed(i).replace(".",""));return s%o/Math.pow(10,i)}class ju extends cr{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==qe.number){const s=this._getOrReturnCtx(t);return Xe(s,{code:Me.invalid_type,expected:qe.number,received:s.parsedType}),$t}let n;const i=new us;for(const s of this._def.checks)s.kind==="int"?Nr.isInteger(t.data)||(n=this._getOrReturnCtx(t,n),Xe(n,{code:Me.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(n=this._getOrReturnCtx(t,n),Xe(n,{code:Me.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(n=this._getOrReturnCtx(t,n),Xe(n,{code:Me.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?Yge(t.data,s.value)!==0&&(n=this._getOrReturnCtx(t,n),Xe(n,{code:Me.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(t.data)||(n=this._getOrReturnCtx(t,n),Xe(n,{code:Me.not_finite,message:s.message}),i.dirty()):Nr.assertNever(s);return{status:i.value,value:t.data}}gte(t,r){return this.setLimit("min",t,!0,vt.toString(r))}gt(t,r){return this.setLimit("min",t,!1,vt.toString(r))}lte(t,r){return this.setLimit("max",t,!0,vt.toString(r))}lt(t,r){return this.setLimit("max",t,!1,vt.toString(r))}setLimit(t,r,n,i){return new ju({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:vt.toString(i)}]})}_addCheck(t){return new ju({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:vt.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:vt.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:vt.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:vt.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:vt.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:vt.toString(r)})}finite(t){return this._addCheck({kind:"finite",message:vt.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:vt.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:vt.toString(t)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&Nr.isInteger(t.value))}get isFinite(){let t=null,r=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(t===null||n.value<t)&&(t=n.value)}return Number.isFinite(r)&&Number.isFinite(t)}}ju.create=e=>new ju({checks:[],typeName:Pt.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...rr(e)});class Fu extends cr{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce&&(t.data=BigInt(t.data)),this._getType(t)!==qe.bigint){const s=this._getOrReturnCtx(t);return Xe(s,{code:Me.invalid_type,expected:qe.bigint,received:s.parsedType}),$t}let n;const i=new us;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(n=this._getOrReturnCtx(t,n),Xe(n,{code:Me.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(n=this._getOrReturnCtx(t,n),Xe(n,{code:Me.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?t.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(t,n),Xe(n,{code:Me.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):Nr.assertNever(s);return{status:i.value,value:t.data}}gte(t,r){return this.setLimit("min",t,!0,vt.toString(r))}gt(t,r){return this.setLimit("min",t,!1,vt.toString(r))}lte(t,r){return this.setLimit("max",t,!0,vt.toString(r))}lt(t,r){return this.setLimit("max",t,!1,vt.toString(r))}setLimit(t,r,n,i){return new Fu({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:vt.toString(i)}]})}_addCheck(t){return new Fu({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:vt.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:vt.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:vt.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:vt.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:vt.toString(r)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}Fu.create=e=>{var t;return new Fu({checks:[],typeName:Pt.ZodBigInt,coerce:(t=e==null?void 0:e.coerce)!==null&&t!==void 0?t:!1,...rr(e)})};class q_ extends cr{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==qe.boolean){const n=this._getOrReturnCtx(t);return Xe(n,{code:Me.invalid_type,expected:qe.boolean,received:n.parsedType}),$t}return Ns(t.data)}}q_.create=e=>new q_({typeName:Pt.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...rr(e)});class mf extends cr{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==qe.date){const s=this._getOrReturnCtx(t);return Xe(s,{code:Me.invalid_type,expected:qe.date,received:s.parsedType}),$t}if(isNaN(t.data.getTime())){const s=this._getOrReturnCtx(t);return Xe(s,{code:Me.invalid_date}),$t}const n=new us;let i;for(const s of this._def.checks)s.kind==="min"?t.data.getTime()<s.value&&(i=this._getOrReturnCtx(t,i),Xe(i,{code:Me.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?t.data.getTime()>s.value&&(i=this._getOrReturnCtx(t,i),Xe(i,{code:Me.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):Nr.assertNever(s);return{status:n.value,value:new Date(t.data.getTime())}}_addCheck(t){return new mf({...this._def,checks:[...this._def.checks,t]})}min(t,r){return this._addCheck({kind:"min",value:t.getTime(),message:vt.toString(r)})}max(t,r){return this._addCheck({kind:"max",value:t.getTime(),message:vt.toString(r)})}get minDate(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t!=null?new Date(t):null}}mf.create=e=>new mf({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:Pt.ZodDate,...rr(e)});class q1 extends cr{_parse(t){if(this._getType(t)!==qe.symbol){const n=this._getOrReturnCtx(t);return Xe(n,{code:Me.invalid_type,expected:qe.symbol,received:n.parsedType}),$t}return Ns(t.data)}}q1.create=e=>new q1({typeName:Pt.ZodSymbol,...rr(e)});class K_ extends cr{_parse(t){if(this._getType(t)!==qe.undefined){const n=this._getOrReturnCtx(t);return Xe(n,{code:Me.invalid_type,expected:qe.undefined,received:n.parsedType}),$t}return Ns(t.data)}}K_.create=e=>new K_({typeName:Pt.ZodUndefined,...rr(e)});class Y_ extends cr{_parse(t){if(this._getType(t)!==qe.null){const n=this._getOrReturnCtx(t);return Xe(n,{code:Me.invalid_type,expected:qe.null,received:n.parsedType}),$t}return Ns(t.data)}}Y_.create=e=>new Y_({typeName:Pt.ZodNull,...rr(e)});class Om extends cr{constructor(){super(...arguments),this._any=!0}_parse(t){return Ns(t.data)}}Om.create=e=>new Om({typeName:Pt.ZodAny,...rr(e)});class Zh extends cr{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Ns(t.data)}}Zh.create=e=>new Zh({typeName:Pt.ZodUnknown,...rr(e)});class Sl extends cr{_parse(t){const r=this._getOrReturnCtx(t);return Xe(r,{code:Me.invalid_type,expected:qe.never,received:r.parsedType}),$t}}Sl.create=e=>new Sl({typeName:Pt.ZodNever,...rr(e)});class K1 extends cr{_parse(t){if(this._getType(t)!==qe.undefined){const n=this._getOrReturnCtx(t);return Xe(n,{code:Me.invalid_type,expected:qe.void,received:n.parsedType}),$t}return Ns(t.data)}}K1.create=e=>new K1({typeName:Pt.ZodVoid,...rr(e)});class mc extends cr{_parse(t){const{ctx:r,status:n}=this._processInputParams(t),i=this._def;if(r.parsedType!==qe.array)return Xe(r,{code:Me.invalid_type,expected:qe.array,received:r.parsedType}),$t;if(i.exactLength!==null){const o=r.data.length>i.exactLength.value,a=r.data.length<i.exactLength.value;(o||a)&&(Xe(r,{code:o?Me.too_big:Me.too_small,minimum:a?i.exactLength.value:void 0,maximum:o?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),n.dirty())}if(i.minLength!==null&&r.data.length<i.minLength.value&&(Xe(r,{code:Me.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),n.dirty()),i.maxLength!==null&&r.data.length>i.maxLength.value&&(Xe(r,{code:Me.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((o,a)=>i.type._parseAsync(new pd(r,o,r.path,a)))).then(o=>us.mergeArray(n,o));const s=[...r.data].map((o,a)=>i.type._parseSync(new pd(r,o,r.path,a)));return us.mergeArray(n,s)}get element(){return this._def.type}min(t,r){return new mc({...this._def,minLength:{value:t,message:vt.toString(r)}})}max(t,r){return new mc({...this._def,maxLength:{value:t,message:vt.toString(r)}})}length(t,r){return new mc({...this._def,exactLength:{value:t,message:vt.toString(r)}})}nonempty(t){return this.min(1,t)}}mc.create=(e,t)=>new mc({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Pt.ZodArray,...rr(t)});function Ep(e){if(e instanceof Sn){const t={};for(const r in e.shape){const n=e.shape[r];t[r]=gl.create(Ep(n))}return new Sn({...e._def,shape:()=>t})}else return e instanceof mc?new mc({...e._def,type:Ep(e.element)}):e instanceof gl?gl.create(Ep(e.unwrap())):e instanceof _f?_f.create(Ep(e.unwrap())):e instanceof md?md.create(e.items.map(t=>Ep(t))):e}class Sn extends cr{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),r=Nr.objectKeys(t);return this._cached={shape:t,keys:r}}_parse(t){if(this._getType(t)!==qe.object){const d=this._getOrReturnCtx(t);return Xe(d,{code:Me.invalid_type,expected:qe.object,received:d.parsedType}),$t}const{status:n,ctx:i}=this._processInputParams(t),{shape:s,keys:o}=this._getCached(),a=[];if(!(this._def.catchall instanceof Sl&&this._def.unknownKeys==="strip"))for(const d in i.data)o.includes(d)||a.push(d);const c=[];for(const d of o){const l=s[d],u=i.data[d];c.push({key:{status:"valid",value:d},value:l._parse(new pd(i,u,i.path,d)),alwaysSet:d in i.data})}if(this._def.catchall instanceof Sl){const d=this._def.unknownKeys;if(d==="passthrough")for(const l of a)c.push({key:{status:"valid",value:l},value:{status:"valid",value:i.data[l]}});else if(d==="strict")a.length>0&&(Xe(i,{code:Me.unrecognized_keys,keys:a}),n.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const d=this._def.catchall;for(const l of a){const u=i.data[l];c.push({key:{status:"valid",value:l},value:d._parse(new pd(i,u,i.path,l)),alwaysSet:l in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const d=[];for(const l of c){const u=await l.key;d.push({key:u,value:await l.value,alwaysSet:l.alwaysSet})}return d}).then(d=>us.mergeObjectSync(n,d)):us.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(t){return vt.errToObj,new Sn({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(r,n)=>{var i,s,o,a;const c=(o=(s=(i=this._def).errorMap)===null||s===void 0?void 0:s.call(i,r,n).message)!==null&&o!==void 0?o:n.defaultError;return r.code==="unrecognized_keys"?{message:(a=vt.errToObj(t).message)!==null&&a!==void 0?a:c}:{message:c}}}:{}})}strip(){return new Sn({...this._def,unknownKeys:"strip"})}passthrough(){return new Sn({...this._def,unknownKeys:"passthrough"})}extend(t){return new Sn({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new Sn({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:Pt.ZodObject})}setKey(t,r){return this.augment({[t]:r})}catchall(t){return new Sn({...this._def,catchall:t})}pick(t){const r={};return Nr.objectKeys(t).forEach(n=>{t[n]&&this.shape[n]&&(r[n]=this.shape[n])}),new Sn({...this._def,shape:()=>r})}omit(t){const r={};return Nr.objectKeys(this.shape).forEach(n=>{t[n]||(r[n]=this.shape[n])}),new Sn({...this._def,shape:()=>r})}deepPartial(){return Ep(this)}partial(t){const r={};return Nr.objectKeys(this.shape).forEach(n=>{const i=this.shape[n];t&&!t[n]?r[n]=i:r[n]=i.optional()}),new Sn({...this._def,shape:()=>r})}required(t){const r={};return Nr.objectKeys(this.shape).forEach(n=>{if(t&&!t[n])r[n]=this.shape[n];else{let s=this.shape[n];for(;s instanceof gl;)s=s._def.innerType;r[n]=s}}),new Sn({...this._def,shape:()=>r})}keyof(){return GW(Nr.objectKeys(this.shape))}}Sn.create=(e,t)=>new Sn({shape:()=>e,unknownKeys:"strip",catchall:Sl.create(),typeName:Pt.ZodObject,...rr(t)});Sn.strictCreate=(e,t)=>new Sn({shape:()=>e,unknownKeys:"strict",catchall:Sl.create(),typeName:Pt.ZodObject,...rr(t)});Sn.lazycreate=(e,t)=>new Sn({shape:e,unknownKeys:"strip",catchall:Sl.create(),typeName:Pt.ZodObject,...rr(t)});class J_ extends cr{_parse(t){const{ctx:r}=this._processInputParams(t),n=this._def.options;function i(s){for(const a of s)if(a.result.status==="valid")return a.result;for(const a of s)if(a.result.status==="dirty")return r.common.issues.push(...a.ctx.common.issues),a.result;const o=s.map(a=>new pc(a.ctx.common.issues));return Xe(r,{code:Me.invalid_union,unionErrors:o}),$t}if(r.common.async)return Promise.all(n.map(async s=>{const o={...r,common:{...r.common,issues:[]},parent:null};return{result:await s._parseAsync({data:r.data,path:r.path,parent:o}),ctx:o}})).then(i);{let s;const o=[];for(const c of n){const d={...r,common:{...r.common,issues:[]},parent:null},l=c._parseSync({data:r.data,path:r.path,parent:d});if(l.status==="valid")return l;l.status==="dirty"&&!s&&(s={result:l,ctx:d}),d.common.issues.length&&o.push(d.common.issues)}if(s)return r.common.issues.push(...s.ctx.common.issues),s.result;const a=o.map(c=>new pc(c));return Xe(r,{code:Me.invalid_union,unionErrors:a}),$t}}get options(){return this._def.options}}J_.create=(e,t)=>new J_({options:e,typeName:Pt.ZodUnion,...rr(t)});const mb=e=>e instanceof Z_?mb(e.schema):e instanceof Ec?mb(e.innerType()):e instanceof eE?[e.value]:e instanceof Bu?e.options:e instanceof tE?Object.keys(e.enum):e instanceof rE?mb(e._def.innerType):e instanceof K_?[void 0]:e instanceof Y_?[null]:null;class bw extends cr{_parse(t){const{ctx:r}=this._processInputParams(t);if(r.parsedType!==qe.object)return Xe(r,{code:Me.invalid_type,expected:qe.object,received:r.parsedType}),$t;const n=this.discriminator,i=r.data[n],s=this.optionsMap.get(i);return s?r.common.async?s._parseAsync({data:r.data,path:r.path,parent:r}):s._parseSync({data:r.data,path:r.path,parent:r}):(Xe(r,{code:Me.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),$t)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,r,n){const i=new Map;for(const s of r){const o=mb(s.shape[t]);if(!o)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(const a of o){if(i.has(a))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(a)}`);i.set(a,s)}}return new bw({typeName:Pt.ZodDiscriminatedUnion,discriminator:t,options:r,optionsMap:i,...rr(n)})}}function s2(e,t){const r=su(e),n=su(t);if(e===t)return{valid:!0,data:e};if(r===qe.object&&n===qe.object){const i=Nr.objectKeys(t),s=Nr.objectKeys(e).filter(a=>i.indexOf(a)!==-1),o={...e,...t};for(const a of s){const c=s2(e[a],t[a]);if(!c.valid)return{valid:!1};o[a]=c.data}return{valid:!0,data:o}}else if(r===qe.array&&n===qe.array){if(e.length!==t.length)return{valid:!1};const i=[];for(let s=0;s<e.length;s++){const o=e[s],a=t[s],c=s2(o,a);if(!c.valid)return{valid:!1};i.push(c.data)}return{valid:!0,data:i}}else return r===qe.date&&n===qe.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class X_ extends cr{_parse(t){const{status:r,ctx:n}=this._processInputParams(t),i=(s,o)=>{if(n2(s)||n2(o))return $t;const a=s2(s.value,o.value);return a.valid?((i2(s)||i2(o))&&r.dirty(),{status:r.value,value:a.data}):(Xe(n,{code:Me.invalid_intersection_types}),$t)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([s,o])=>i(s,o)):i(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}X_.create=(e,t,r)=>new X_({left:e,right:t,typeName:Pt.ZodIntersection,...rr(r)});class md extends cr{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==qe.array)return Xe(n,{code:Me.invalid_type,expected:qe.array,received:n.parsedType}),$t;if(n.data.length<this._def.items.length)return Xe(n,{code:Me.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),$t;!this._def.rest&&n.data.length>this._def.items.length&&(Xe(n,{code:Me.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const s=[...n.data].map((o,a)=>{const c=this._def.items[a]||this._def.rest;return c?c._parse(new pd(n,o,n.path,a)):null}).filter(o=>!!o);return n.common.async?Promise.all(s).then(o=>us.mergeArray(r,o)):us.mergeArray(r,s)}get items(){return this._def.items}rest(t){return new md({...this._def,rest:t})}}md.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new md({items:e,typeName:Pt.ZodTuple,rest:null,...rr(t)})};class Q_ extends cr{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==qe.object)return Xe(n,{code:Me.invalid_type,expected:qe.object,received:n.parsedType}),$t;const i=[],s=this._def.keyType,o=this._def.valueType;for(const a in n.data)i.push({key:s._parse(new pd(n,a,n.path,a)),value:o._parse(new pd(n,n.data[a],n.path,a))});return n.common.async?us.mergeObjectAsync(r,i):us.mergeObjectSync(r,i)}get element(){return this._def.valueType}static create(t,r,n){return r instanceof cr?new Q_({keyType:t,valueType:r,typeName:Pt.ZodRecord,...rr(n)}):new Q_({keyType:lc.create(),valueType:t,typeName:Pt.ZodRecord,...rr(r)})}}class Y1 extends cr{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==qe.map)return Xe(n,{code:Me.invalid_type,expected:qe.map,received:n.parsedType}),$t;const i=this._def.keyType,s=this._def.valueType,o=[...n.data.entries()].map(([a,c],d)=>({key:i._parse(new pd(n,a,n.path,[d,"key"])),value:s._parse(new pd(n,c,n.path,[d,"value"]))}));if(n.common.async){const a=new Map;return Promise.resolve().then(async()=>{for(const c of o){const d=await c.key,l=await c.value;if(d.status==="aborted"||l.status==="aborted")return $t;(d.status==="dirty"||l.status==="dirty")&&r.dirty(),a.set(d.value,l.value)}return{status:r.value,value:a}})}else{const a=new Map;for(const c of o){const d=c.key,l=c.value;if(d.status==="aborted"||l.status==="aborted")return $t;(d.status==="dirty"||l.status==="dirty")&&r.dirty(),a.set(d.value,l.value)}return{status:r.value,value:a}}}}Y1.create=(e,t,r)=>new Y1({valueType:t,keyType:e,typeName:Pt.ZodMap,...rr(r)});class gf extends cr{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==qe.set)return Xe(n,{code:Me.invalid_type,expected:qe.set,received:n.parsedType}),$t;const i=this._def;i.minSize!==null&&n.data.size<i.minSize.value&&(Xe(n,{code:Me.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),r.dirty()),i.maxSize!==null&&n.data.size>i.maxSize.value&&(Xe(n,{code:Me.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),r.dirty());const s=this._def.valueType;function o(c){const d=new Set;for(const l of c){if(l.status==="aborted")return $t;l.status==="dirty"&&r.dirty(),d.add(l.value)}return{status:r.value,value:d}}const a=[...n.data.values()].map((c,d)=>s._parse(new pd(n,c,n.path,d)));return n.common.async?Promise.all(a).then(c=>o(c)):o(a)}min(t,r){return new gf({...this._def,minSize:{value:t,message:vt.toString(r)}})}max(t,r){return new gf({...this._def,maxSize:{value:t,message:vt.toString(r)}})}size(t,r){return this.min(t,r).max(t,r)}nonempty(t){return this.min(1,t)}}gf.create=(e,t)=>new gf({valueType:e,minSize:null,maxSize:null,typeName:Pt.ZodSet,...rr(t)});class am extends cr{constructor(){super(...arguments),this.validate=this.implement}_parse(t){const{ctx:r}=this._processInputParams(t);if(r.parsedType!==qe.function)return Xe(r,{code:Me.invalid_type,expected:qe.function,received:r.parsedType}),$t;function n(a,c){return z1({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,H1(),G_].filter(d=>!!d),issueData:{code:Me.invalid_arguments,argumentsError:c}})}function i(a,c){return z1({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,H1(),G_].filter(d=>!!d),issueData:{code:Me.invalid_return_type,returnTypeError:c}})}const s={errorMap:r.common.contextualErrorMap},o=r.data;return this._def.returns instanceof Nm?Ns(async(...a)=>{const c=new pc([]),d=await this._def.args.parseAsync(a,s).catch(h=>{throw c.addIssue(n(a,h)),c}),l=await o(...d);return await this._def.returns._def.type.parseAsync(l,s).catch(h=>{throw c.addIssue(i(l,h)),c})}):Ns((...a)=>{const c=this._def.args.safeParse(a,s);if(!c.success)throw new pc([n(a,c.error)]);const d=o(...c.data),l=this._def.returns.safeParse(d,s);if(!l.success)throw new pc([i(d,l.error)]);return l.data})}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new am({...this._def,args:md.create(t).rest(Zh.create())})}returns(t){return new am({...this._def,returns:t})}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(t,r,n){return new am({args:t||md.create([]).rest(Zh.create()),returns:r||Zh.create(),typeName:Pt.ZodFunction,...rr(n)})}}class Z_ extends cr{get schema(){return this._def.getter()}_parse(t){const{ctx:r}=this._processInputParams(t);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}Z_.create=(e,t)=>new Z_({getter:e,typeName:Pt.ZodLazy,...rr(t)});class eE extends cr{_parse(t){if(t.data!==this._def.value){const r=this._getOrReturnCtx(t);return Xe(r,{received:r.data,code:Me.invalid_literal,expected:this._def.value}),$t}return{status:"valid",value:t.data}}get value(){return this._def.value}}eE.create=(e,t)=>new eE({value:e,typeName:Pt.ZodLiteral,...rr(t)});function GW(e,t){return new Bu({values:e,typeName:Pt.ZodEnum,...rr(t)})}class Bu extends cr{_parse(t){if(typeof t.data!="string"){const r=this._getOrReturnCtx(t),n=this._def.values;return Xe(r,{expected:Nr.joinValues(n),received:r.parsedType,code:Me.invalid_type}),$t}if(this._def.values.indexOf(t.data)===-1){const r=this._getOrReturnCtx(t),n=this._def.values;return Xe(r,{received:r.data,code:Me.invalid_enum_value,options:n}),$t}return Ns(t.data)}get options(){return this._def.values}get enum(){const t={};for(const r of this._def.values)t[r]=r;return t}get Values(){const t={};for(const r of this._def.values)t[r]=r;return t}get Enum(){const t={};for(const r of this._def.values)t[r]=r;return t}extract(t){return Bu.create(t)}exclude(t){return Bu.create(this.options.filter(r=>!t.includes(r)))}}Bu.create=GW;class tE extends cr{_parse(t){const r=Nr.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(t);if(n.parsedType!==qe.string&&n.parsedType!==qe.number){const i=Nr.objectValues(r);return Xe(n,{expected:Nr.joinValues(i),received:n.parsedType,code:Me.invalid_type}),$t}if(r.indexOf(t.data)===-1){const i=Nr.objectValues(r);return Xe(n,{received:n.data,code:Me.invalid_enum_value,options:i}),$t}return Ns(t.data)}get enum(){return this._def.values}}tE.create=(e,t)=>new tE({values:e,typeName:Pt.ZodNativeEnum,...rr(t)});class Nm extends cr{unwrap(){return this._def.type}_parse(t){const{ctx:r}=this._processInputParams(t);if(r.parsedType!==qe.promise&&r.common.async===!1)return Xe(r,{code:Me.invalid_type,expected:qe.promise,received:r.parsedType}),$t;const n=r.parsedType===qe.promise?r.data:Promise.resolve(r.data);return Ns(n.then(i=>this._def.type.parseAsync(i,{path:r.path,errorMap:r.common.contextualErrorMap})))}}Nm.create=(e,t)=>new Nm({type:e,typeName:Pt.ZodPromise,...rr(t)});class Ec extends cr{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Pt.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:r,ctx:n}=this._processInputParams(t),i=this._def.effect||null;if(i.type==="preprocess"){const o=i.transform(n.data);return n.common.async?Promise.resolve(o).then(a=>this._def.schema._parseAsync({data:a,path:n.path,parent:n})):this._def.schema._parseSync({data:o,path:n.path,parent:n})}const s={addIssue:o=>{Xe(n,o),o.fatal?r.abort():r.dirty()},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),i.type==="refinement"){const o=a=>{const c=i.refinement(a,s);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(n.common.async===!1){const a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?$t:(a.status==="dirty"&&r.dirty(),o(a.value),{status:r.value,value:a.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>a.status==="aborted"?$t:(a.status==="dirty"&&r.dirty(),o(a.value).then(()=>({status:r.value,value:a.value}))))}if(i.type==="transform")if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!W1(o))return o;const a=i.transform(o.value,s);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>W1(o)?Promise.resolve(i.transform(o.value,s)).then(a=>({status:r.value,value:a})):o);Nr.assertNever(i)}}Ec.create=(e,t,r)=>new Ec({schema:e,typeName:Pt.ZodEffects,effect:t,...rr(r)});Ec.createWithPreprocess=(e,t,r)=>new Ec({schema:t,effect:{type:"preprocess",transform:e},typeName:Pt.ZodEffects,...rr(r)});class gl extends cr{_parse(t){return this._getType(t)===qe.undefined?Ns(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}gl.create=(e,t)=>new gl({innerType:e,typeName:Pt.ZodOptional,...rr(t)});class _f extends cr{_parse(t){return this._getType(t)===qe.null?Ns(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}_f.create=(e,t)=>new _f({innerType:e,typeName:Pt.ZodNullable,...rr(t)});class rE extends cr{_parse(t){const{ctx:r}=this._processInputParams(t);let n=r.data;return r.parsedType===qe.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}rE.create=(e,t)=>new rE({innerType:e,typeName:Pt.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...rr(t)});class J1 extends cr{_parse(t){const{ctx:r}=this._processInputParams(t),n={...r,common:{...r.common,issues:[]}},i=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return G1(i)?i.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new pc(n.common.issues)}})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new pc(n.common.issues)}})}}removeCatch(){return this._def.innerType}}J1.create=(e,t)=>new J1({innerType:e,typeName:Pt.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...rr(t)});class X1 extends cr{_parse(t){if(this._getType(t)!==qe.nan){const n=this._getOrReturnCtx(t);return Xe(n,{code:Me.invalid_type,expected:qe.nan,received:n.parsedType}),$t}return{status:"valid",value:t.data}}}X1.create=e=>new X1({typeName:Pt.ZodNaN,...rr(e)});const Jge=Symbol("zod_brand");class qW extends cr{_parse(t){const{ctx:r}=this._processInputParams(t),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}}class KE extends cr{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?$t:s.status==="dirty"?(r.dirty(),WW(s.value)):this._def.out._parseAsync({data:s.value,path:n.path,parent:n})})();{const i=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?$t:i.status==="dirty"?(r.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:n.path,parent:n})}}static create(t,r){return new KE({in:t,out:r,typeName:Pt.ZodPipeline})}}const KW=(e,t={},r)=>e?Om.create().superRefine((n,i)=>{var s,o;if(!e(n)){const a=typeof t=="function"?t(n):t,c=(o=(s=a.fatal)!==null&&s!==void 0?s:r)!==null&&o!==void 0?o:!0,d=typeof a=="string"?{message:a}:a;i.addIssue({code:"custom",...d,fatal:c})}}):Om.create(),Xge={object:Sn.lazycreate};var Pt;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline"})(Pt||(Pt={}));const Qge=(e,t={message:`Input not instance of ${e.name}`})=>KW(r=>r instanceof e,t),YW=lc.create,JW=ju.create,Zge=X1.create,e_e=Fu.create,XW=q_.create,t_e=mf.create,r_e=q1.create,n_e=K_.create,i_e=Y_.create,s_e=Om.create,o_e=Zh.create,a_e=Sl.create,c_e=K1.create,d_e=mc.create,l_e=Sn.create,u_e=Sn.strictCreate,h_e=J_.create,f_e=bw.create,p_e=X_.create,m_e=md.create,g_e=Q_.create,__e=Y1.create,E_e=gf.create,v_e=am.create,y_e=Z_.create,b_e=eE.create,S_e=Bu.create,w_e=tE.create,T_e=Nm.create,u6=Ec.create,R_e=gl.create,A_e=_f.create,C_e=Ec.createWithPreprocess,I_e=KE.create,O_e=()=>YW().optional(),N_e=()=>JW().optional(),D_e=()=>XW().optional(),P_e={string:e=>lc.create({...e,coerce:!0}),number:e=>ju.create({...e,coerce:!0}),boolean:e=>q_.create({...e,coerce:!0}),bigint:e=>Fu.create({...e,coerce:!0}),date:e=>mf.create({...e,coerce:!0})},k_e=$t;var Wo=Object.freeze({__proto__:null,defaultErrorMap:G_,setErrorMap:Uge,getErrorMap:H1,makeIssue:z1,EMPTY_PATH:jge,addIssueToContext:Xe,ParseStatus:us,INVALID:$t,DIRTY:WW,OK:Ns,isAborted:n2,isDirty:i2,isValid:W1,isAsync:G1,get util(){return Nr},get objectUtil(){return r2},ZodParsedType:qe,getParsedType:su,ZodType:cr,ZodString:lc,ZodNumber:ju,ZodBigInt:Fu,ZodBoolean:q_,ZodDate:mf,ZodSymbol:q1,ZodUndefined:K_,ZodNull:Y_,ZodAny:Om,ZodUnknown:Zh,ZodNever:Sl,ZodVoid:K1,ZodArray:mc,ZodObject:Sn,ZodUnion:J_,ZodDiscriminatedUnion:bw,ZodIntersection:X_,ZodTuple:md,ZodRecord:Q_,ZodMap:Y1,ZodSet:gf,ZodFunction:am,ZodLazy:Z_,ZodLiteral:eE,ZodEnum:Bu,ZodNativeEnum:tE,ZodPromise:Nm,ZodEffects:Ec,ZodTransformer:Ec,ZodOptional:gl,ZodNullable:_f,ZodDefault:rE,ZodCatch:J1,ZodNaN:X1,BRAND:Jge,ZodBranded:qW,ZodPipeline:KE,custom:KW,Schema:cr,ZodSchema:cr,late:Xge,get ZodFirstPartyTypeKind(){return Pt},coerce:P_e,any:s_e,array:d_e,bigint:e_e,boolean:XW,date:t_e,discriminatedUnion:f_e,effect:u6,enum:S_e,function:v_e,instanceof:Qge,intersection:p_e,lazy:y_e,literal:b_e,map:__e,nan:Zge,nativeEnum:w_e,never:a_e,null:i_e,nullable:A_e,number:JW,object:l_e,oboolean:D_e,onumber:N_e,optional:R_e,ostring:O_e,pipeline:I_e,preprocess:C_e,promise:T_e,record:g_e,set:E_e,strictObject:u_e,string:YW,symbol:r_e,transformer:u6,tuple:m_e,undefined:n_e,union:h_e,unknown:o_e,void:c_e,NEVER:k_e,ZodIssueCode:Me,quotelessJson:Mge,ZodError:pc});const L_e=/^aleo1[a-z0-9]{58}$/i,x_e=/^AViewKey1[a-z0-9]{44}$/i,M_e=/^APrivateKey1[a-z0-9]{47}$/i,U_e=/^au1[a-z0-9]{58}$/i,j_e=/^at1[a-z0-9]{58}$/i,F_e=/^\d+field$/,B_e=/^\d+u32$/,V_e=/^\d+u64$/;Wo.string().regex(L_e);Wo.string().regex(x_e);Wo.string().regex(M_e);Wo.string().regex(U_e);Wo.string().regex(j_e);Wo.string().regex(F_e);Wo.string().regex(B_e);Wo.string().regex(V_e);var h6;(function(e){e.Record="record",e.OutputRecord="outputRecord",e.Public="public",e.Private="private",e.Constant="constant",e.Future="future",e.ExternalRecord="external_record"})(h6||(h6={}));var o2;(function(e){e.Unspent="Unspent",e.Pending="Pending",e.Spent="Spent"})(o2||(o2={}));var a2;(function(e){e.Deploy="Deploy",e.Execute="Execute",e.Send="Send",e.Receive="Receive",e.Join="Join",e.Split="Split",e.Shield="Shield",e.Unshield="Unshield",e.Referral="Referral",e.Points="Points",e.Spin="Spin",e.Raffle="Raffle",e.Mint="Mint"})(a2||(a2={}));var c2;(function(e){e.Creating="Creating",e.Pending="Pending",e.Settled="Settled",e.Failed="Failed"})(c2||(c2={}));var d2;(function(e){e.Private="Private",e.Public="Public"})(d2||(d2={}));var l2;(function(e){e.AleoTestnet="AleoTestnet",e.AleoMainnet="AleoMainnet"})(l2||(l2={}));Wo.nativeEnum(a2);Wo.nativeEnum(c2);Wo.nativeEnum(l2);Wo.nativeEnum(d2);Wo.nativeEnum(o2);const f6=["decrypt","disconnect","getSelectedAccount","getBalance","getRecords","requestCreateEvent","getEvent","getEvents","createSharedState","importSharedState","requestSignature"],QW=["aleo:1"],ZW=["aleo:0"],vP=[...QW,...ZW],p6=["chainChanged","accountSelected","selectedAccountSynced","sharedAccountSynced"],yP="f0aaeffe71b636da453fce042d79d723";function $_e(){return typeof navigator>"u"?!1:/Android/i.test(navigator.userAgent)}const H_e={projectId:yP,chains:vP,enableExplorer:!0,explorerRecommendedWalletIds:["7ee7b95f4ae8b3e08aab5158be7fe8e71f79bcd3717594254b34fa1f3cd4611a"],mobileWallets:[{id:"puzzle",name:"Puzzle Wallet",links:{native:"puzzleapp://",universal:""}},{id:"avail",name:"Avail Wallet",links:{native:"avail://",universal:"https://avail.global"}}],walletImages:{puzzle:"https://i.imgur.com/p9tHaFC.png",avail:"https://i.imgur.com/GxNn8BO.png"}},z_e={projectId:yP,chains:vP,enableExplorer:!1,explorerRecommendedWalletIds:["7ee7b95f4ae8b3e08aab5158be7fe8e71f79bcd3717594254b34fa1f3cd4611a"],mobileWallets:[{id:"puzzle",name:"Puzzle Wallet",links:{native:"puzzleapp://",universal:""}},{id:"avail",name:"Avail Wallet",links:{native:"avail://",universal:"https://avail.global"}}],desktopWallets:[{id:"puzzle",name:"Puzzle Wallet",links:{native:"",universal:"https://walletconnect.puzzle.online/"}},{id:"avail",name:"Avail Wallet",links:{native:"avail://",universal:"https://avail.global"}}],walletImages:{puzzle:"https://i.imgur.com/p9tHaFC.png",avail:"https://i.imgur.com/GxNn8BO.png"}},W_e=$_e()?H_e:z_e,G_e="@puzzlehq/sdk-core",q_e="Puzzle SDK",K_e="0.5.5",Y_e="Your portal to privacy",J_e="./dist/src/index.js",X_e="./dist/src/index.d.ts",Q_e={".":{import:"./dist/src/index.js",types:"./dist/src/index.d.ts"}},Z_e="module",eEe={"fetch-fix":"find dist -type f \\( -name '*.js' -o -name '*.cjs' \\) -exec sed -i '' 's/self.fetch[[:space:]]*||/fetch ||/g' {} \\;","ws-fix":`find ./dist -type f -name 'index*' -exec sed -i '' -e 's/require(\\"ws\\")/(() => {try { return require(\\"ws\\") } catch (e) { } })()/g' {} +;`,build:"rm -rf ./dist && tsc && pnpm fetch-fix && pnpm ws-fix","type-check":"tsc --noEmit"},tEe={type:"git",url:"git+https://github.com/puzzlehq/puzzle-sdk.git"},rEe={"@puzzlehq/types":"1.0.27","@puzzlehq/walletconnect-modal-sign-html":"0.0.6","@walletconnect/types":"^2.14.0","@walletconnect/utils":"^2.14.0",debug:"^4.3.4",events:"^3.3.0",ws:"^8.16.0",zod:"3.21.1"},nEe={buffer:"^6.0.3"},iEe=["puzzle","cryptocurrency wallet","privacy","aleo","web3","crypto","typescript"],sEe="Puzzle",oEe="ISC",aEe={url:"https://github.com/puzzlehq/puzzle-sdk/issues"},cEe="https://github.com/puzzlehq/puzzle-sdk#readme",m6={name:G_e,displayName:q_e,version:K_e,description:Y_e,main:J_e,types:X_e,private:!1,exports:Q_e,type:Z_e,scripts:eEe,repository:tEe,dependencies:rEe,peerDependencies:nEe,keywords:iEe,author:sEe,license:oEe,bugs:aEe,homepage:cEe};var Sw={},_r={},xf=eG;function eG(e,t){if(!e)throw new Error(t||"Assertion failed")}eG.equal=function(t,r,n){if(t!=r)throw new Error(n||"Assertion failed: "+t+" != "+r)};var u2={exports:{}};typeof Object.create=="function"?u2.exports=function(t,r){r&&(t.super_=r,t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:u2.exports=function(t,r){if(r){t.super_=r;var n=function(){};n.prototype=r.prototype,t.prototype=new n,t.prototype.constructor=t}};var ww=u2.exports,dEe=xf,lEe=ww;_r.inherits=lEe;function uEe(e,t){return(e.charCodeAt(t)&64512)!==55296||t<0||t+1>=e.length?!1:(e.charCodeAt(t+1)&64512)===56320}function hEe(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var r=[];if(typeof e=="string")if(t){if(t==="hex")for(e=e.replace(/[^a-z0-9]+/ig,""),e.length%2!==0&&(e="0"+e),i=0;i<e.length;i+=2)r.push(parseInt(e[i]+e[i+1],16))}else for(var n=0,i=0;i<e.length;i++){var s=e.charCodeAt(i);s<128?r[n++]=s:s<2048?(r[n++]=s>>6|192,r[n++]=s&63|128):uEe(e,i)?(s=65536+((s&1023)<<10)+(e.charCodeAt(++i)&1023),r[n++]=s>>18|240,r[n++]=s>>12&63|128,r[n++]=s>>6&63|128,r[n++]=s&63|128):(r[n++]=s>>12|224,r[n++]=s>>6&63|128,r[n++]=s&63|128)}else for(i=0;i<e.length;i++)r[i]=e[i]|0;return r}_r.toArray=hEe;function fEe(e){for(var t="",r=0;r<e.length;r++)t+=rG(e[r].toString(16));return t}_r.toHex=fEe;function tG(e){var t=e>>>24|e>>>8&65280|e<<8&16711680|(e&255)<<24;return t>>>0}_r.htonl=tG;function pEe(e,t){for(var r="",n=0;n<e.length;n++){var i=e[n];t==="little"&&(i=tG(i)),r+=nG(i.toString(16))}return r}_r.toHex32=pEe;function rG(e){return e.length===1?"0"+e:e}_r.zero2=rG;function nG(e){return e.length===7?"0"+e:e.length===6?"00"+e:e.length===5?"000"+e:e.length===4?"0000"+e:e.length===3?"00000"+e:e.length===2?"000000"+e:e.length===1?"0000000"+e:e}_r.zero8=nG;function mEe(e,t,r,n){var i=r-t;dEe(i%4===0);for(var s=new Array(i/4),o=0,a=t;o<s.length;o++,a+=4){var c;n==="big"?c=e[a]<<24|e[a+1]<<16|e[a+2]<<8|e[a+3]:c=e[a+3]<<24|e[a+2]<<16|e[a+1]<<8|e[a],s[o]=c>>>0}return s}_r.join32=mEe;function gEe(e,t){for(var r=new Array(e.length*4),n=0,i=0;n<e.length;n++,i+=4){var s=e[n];t==="big"?(r[i]=s>>>24,r[i+1]=s>>>16&255,r[i+2]=s>>>8&255,r[i+3]=s&255):(r[i+3]=s>>>24,r[i+2]=s>>>16&255,r[i+1]=s>>>8&255,r[i]=s&255)}return r}_r.split32=gEe;function _Ee(e,t){return e>>>t|e<<32-t}_r.rotr32=_Ee;function EEe(e,t){return e<<t|e>>>32-t}_r.rotl32=EEe;function vEe(e,t){return e+t>>>0}_r.sum32=vEe;function yEe(e,t,r){return e+t+r>>>0}_r.sum32_3=yEe;function bEe(e,t,r,n){return e+t+r+n>>>0}_r.sum32_4=bEe;function SEe(e,t,r,n,i){return e+t+r+n+i>>>0}_r.sum32_5=SEe;function wEe(e,t,r,n){var i=e[t],s=e[t+1],o=n+s>>>0,a=(o<n?1:0)+r+i;e[t]=a>>>0,e[t+1]=o}_r.sum64=wEe;function TEe(e,t,r,n){var i=t+n>>>0,s=(i<t?1:0)+e+r;return s>>>0}_r.sum64_hi=TEe;function REe(e,t,r,n){var i=t+n;return i>>>0}_r.sum64_lo=REe;function AEe(e,t,r,n,i,s,o,a){var c=0,d=t;d=d+n>>>0,c+=d<t?1:0,d=d+s>>>0,c+=d<s?1:0,d=d+a>>>0,c+=d<a?1:0;var l=e+r+i+o+c;return l>>>0}_r.sum64_4_hi=AEe;function CEe(e,t,r,n,i,s,o,a){var c=t+n+s+a;return c>>>0}_r.sum64_4_lo=CEe;function IEe(e,t,r,n,i,s,o,a,c,d){var l=0,u=t;u=u+n>>>0,l+=u<t?1:0,u=u+s>>>0,l+=u<s?1:0,u=u+a>>>0,l+=u<a?1:0,u=u+d>>>0,l+=u<d?1:0;var h=e+r+i+o+c+l;return h>>>0}_r.sum64_5_hi=IEe;function OEe(e,t,r,n,i,s,o,a,c,d){var l=t+n+s+a+d;return l>>>0}_r.sum64_5_lo=OEe;function NEe(e,t,r){var n=t<<32-r|e>>>r;return n>>>0}_r.rotr64_hi=NEe;function DEe(e,t,r){var n=e<<32-r|t>>>r;return n>>>0}_r.rotr64_lo=DEe;function PEe(e,t,r){return e>>>r}_r.shr64_hi=PEe;function kEe(e,t,r){var n=e<<32-r|t>>>r;return n>>>0}_r.shr64_lo=kEe;var h0={},g6=_r,LEe=xf;function Tw(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}h0.BlockHash=Tw;Tw.prototype.update=function(t,r){if(t=g6.toArray(t,r),this.pending?this.pending=this.pending.concat(t):this.pending=t,this.pendingTotal+=t.length,this.pending.length>=this._delta8){t=this.pending;var n=t.length%this._delta8;this.pending=t.slice(t.length-n,t.length),this.pending.length===0&&(this.pending=null),t=g6.join32(t,0,t.length-n,this.endian);for(var i=0;i<t.length;i+=this._delta32)this._update(t,i,i+this._delta32)}return this};Tw.prototype.digest=function(t){return this.update(this._pad()),LEe(this.pending===null),this._digest(t)};Tw.prototype._pad=function(){var t=this.pendingTotal,r=this._delta8,n=r-(t+this.padLength)%r,i=new Array(n+this.padLength);i[0]=128;for(var s=1;s<n;s++)i[s]=0;if(t<<=3,this.endian==="big"){for(var o=8;o<this.padLength;o++)i[s++]=0;i[s++]=0,i[s++]=0,i[s++]=0,i[s++]=0,i[s++]=t>>>24&255,i[s++]=t>>>16&255,i[s++]=t>>>8&255,i[s++]=t&255}else for(i[s++]=t&255,i[s++]=t>>>8&255,i[s++]=t>>>16&255,i[s++]=t>>>24&255,i[s++]=0,i[s++]=0,i[s++]=0,i[s++]=0,o=8;o<this.padLength;o++)i[s++]=0;return i};var f0={},Td={},xEe=_r,dd=xEe.rotr32;function MEe(e,t,r,n){if(e===0)return iG(t,r,n);if(e===1||e===3)return oG(t,r,n);if(e===2)return sG(t,r,n)}Td.ft_1=MEe;function iG(e,t,r){return e&t^~e&r}Td.ch32=iG;function sG(e,t,r){return e&t^e&r^t&r}Td.maj32=sG;function oG(e,t,r){return e^t^r}Td.p32=oG;function UEe(e){return dd(e,2)^dd(e,13)^dd(e,22)}Td.s0_256=UEe;function jEe(e){return dd(e,6)^dd(e,11)^dd(e,25)}Td.s1_256=jEe;function FEe(e){return dd(e,7)^dd(e,18)^e>>>3}Td.g0_256=FEe;function BEe(e){return dd(e,17)^dd(e,19)^e>>>10}Td.g1_256=BEe;var Dm=_r,VEe=h0,$Ee=Td,MR=Dm.rotl32,og=Dm.sum32,HEe=Dm.sum32_5,zEe=$Ee.ft_1,aG=VEe.BlockHash,WEe=[1518500249,1859775393,2400959708,3395469782];function gd(){if(!(this instanceof gd))return new gd;aG.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}Dm.inherits(gd,aG);var GEe=gd;gd.blockSize=512;gd.outSize=160;gd.hmacStrength=80;gd.padLength=64;gd.prototype._update=function(t,r){for(var n=this.W,i=0;i<16;i++)n[i]=t[r+i];for(;i<n.length;i++)n[i]=MR(n[i-3]^n[i-8]^n[i-14]^n[i-16],1);var s=this.h[0],o=this.h[1],a=this.h[2],c=this.h[3],d=this.h[4];for(i=0;i<n.length;i++){var l=~~(i/20),u=HEe(MR(s,5),zEe(l,o,a,c),d,n[i],WEe[l]);d=c,c=a,a=MR(o,30),o=s,s=u}this.h[0]=og(this.h[0],s),this.h[1]=og(this.h[1],o),this.h[2]=og(this.h[2],a),this.h[3]=og(this.h[3],c),this.h[4]=og(this.h[4],d)};gd.prototype._digest=function(t){return t==="hex"?Dm.toHex32(this.h,"big"):Dm.split32(this.h,"big")};var Pm=_r,qEe=h0,p0=Td,KEe=xf,za=Pm.sum32,YEe=Pm.sum32_4,JEe=Pm.sum32_5,XEe=p0.ch32,QEe=p0.maj32,ZEe=p0.s0_256,eve=p0.s1_256,tve=p0.g0_256,rve=p0.g1_256,cG=qEe.BlockHash,nve=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function _d(){if(!(this instanceof _d))return new _d;cG.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=nve,this.W=new Array(64)}Pm.inherits(_d,cG);var dG=_d;_d.blockSize=512;_d.outSize=256;_d.hmacStrength=192;_d.padLength=64;_d.prototype._update=function(t,r){for(var n=this.W,i=0;i<16;i++)n[i]=t[r+i];for(;i<n.length;i++)n[i]=YEe(rve(n[i-2]),n[i-7],tve(n[i-15]),n[i-16]);var s=this.h[0],o=this.h[1],a=this.h[2],c=this.h[3],d=this.h[4],l=this.h[5],u=this.h[6],h=this.h[7];for(KEe(this.k.length===n.length),i=0;i<n.length;i++){var p=JEe(h,eve(d),XEe(d,l,u),this.k[i],n[i]),_=za(ZEe(s),QEe(s,o,a));h=u,u=l,l=d,d=za(c,p),c=a,a=o,o=s,s=za(p,_)}this.h[0]=za(this.h[0],s),this.h[1]=za(this.h[1],o),this.h[2]=za(this.h[2],a),this.h[3]=za(this.h[3],c),this.h[4]=za(this.h[4],d),this.h[5]=za(this.h[5],l),this.h[6]=za(this.h[6],u),this.h[7]=za(this.h[7],h)};_d.prototype._digest=function(t){return t==="hex"?Pm.toHex32(this.h,"big"):Pm.split32(this.h,"big")};var h2=_r,lG=dG;function wl(){if(!(this instanceof wl))return new wl;lG.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}h2.inherits(wl,lG);var ive=wl;wl.blockSize=512;wl.outSize=224;wl.hmacStrength=192;wl.padLength=64;wl.prototype._digest=function(t){return t==="hex"?h2.toHex32(this.h.slice(0,7),"big"):h2.split32(this.h.slice(0,7),"big")};var fo=_r,sve=h0,ove=xf,ld=fo.rotr64_hi,ud=fo.rotr64_lo,uG=fo.shr64_hi,hG=fo.shr64_lo,xl=fo.sum64,UR=fo.sum64_hi,jR=fo.sum64_lo,ave=fo.sum64_4_hi,cve=fo.sum64_4_lo,dve=fo.sum64_5_hi,lve=fo.sum64_5_lo,fG=sve.BlockHash,uve=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function vc(){if(!(this instanceof vc))return new vc;fG.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=uve,this.W=new Array(160)}fo.inherits(vc,fG);var pG=vc;vc.blockSize=1024;vc.outSize=512;vc.hmacStrength=192;vc.padLength=128;vc.prototype._prepareBlock=function(t,r){for(var n=this.W,i=0;i<32;i++)n[i]=t[r+i];for(;i<n.length;i+=2){var s=Sve(n[i-4],n[i-3]),o=wve(n[i-4],n[i-3]),a=n[i-14],c=n[i-13],d=yve(n[i-30],n[i-29]),l=bve(n[i-30],n[i-29]),u=n[i-32],h=n[i-31];n[i]=ave(s,o,a,c,d,l,u,h),n[i+1]=cve(s,o,a,c,d,l,u,h)}};vc.prototype._update=function(t,r){this._prepareBlock(t,r);var n=this.W,i=this.h[0],s=this.h[1],o=this.h[2],a=this.h[3],c=this.h[4],d=this.h[5],l=this.h[6],u=this.h[7],h=this.h[8],p=this.h[9],_=this.h[10],g=this.h[11],E=this.h[12],b=this.h[13],v=this.h[14],I=this.h[15];ove(this.k.length===n.length);for(var N=0;N<n.length;N+=2){var L=v,U=I,w=Eve(h,p),V=vve(h,p),z=hve(h,p,_,g,E),K=fve(h,p,_,g,E,b),H=this.k[N],A=this.k[N+1],m=n[N],S=n[N+1],T=dve(L,U,w,V,z,K,H,A,m,S),x=lve(L,U,w,V,z,K,H,A,m,S);L=gve(i,s),U=_ve(i,s),w=pve(i,s,o,a,c),V=mve(i,s,o,a,c,d);var D=UR(L,U,w,V),k=jR(L,U,w,V);v=E,I=b,E=_,b=g,_=h,g=p,h=UR(l,u,T,x),p=jR(u,u,T,x),l=c,u=d,c=o,d=a,o=i,a=s,i=UR(T,x,D,k),s=jR(T,x,D,k)}xl(this.h,0,i,s),xl(this.h,2,o,a),xl(this.h,4,c,d),xl(this.h,6,l,u),xl(this.h,8,h,p),xl(this.h,10,_,g),xl(this.h,12,E,b),xl(this.h,14,v,I)};vc.prototype._digest=function(t){return t==="hex"?fo.toHex32(this.h,"big"):fo.split32(this.h,"big")};function hve(e,t,r,n,i){var s=e&r^~e&i;return s<0&&(s+=4294967296),s}function fve(e,t,r,n,i,s){var o=t&n^~t&s;return o<0&&(o+=4294967296),o}function pve(e,t,r,n,i){var s=e&r^e&i^r&i;return s<0&&(s+=4294967296),s}function mve(e,t,r,n,i,s){var o=t&n^t&s^n&s;return o<0&&(o+=4294967296),o}function gve(e,t){var r=ld(e,t,28),n=ld(t,e,2),i=ld(t,e,7),s=r^n^i;return s<0&&(s+=4294967296),s}function _ve(e,t){var r=ud(e,t,28),n=ud(t,e,2),i=ud(t,e,7),s=r^n^i;return s<0&&(s+=4294967296),s}function Eve(e,t){var r=ld(e,t,14),n=ld(e,t,18),i=ld(t,e,9),s=r^n^i;return s<0&&(s+=4294967296),s}function vve(e,t){var r=ud(e,t,14),n=ud(e,t,18),i=ud(t,e,9),s=r^n^i;return s<0&&(s+=4294967296),s}function yve(e,t){var r=ld(e,t,1),n=ld(e,t,8),i=uG(e,t,7),s=r^n^i;return s<0&&(s+=4294967296),s}function bve(e,t){var r=ud(e,t,1),n=ud(e,t,8),i=hG(e,t,7),s=r^n^i;return s<0&&(s+=4294967296),s}function Sve(e,t){var r=ld(e,t,19),n=ld(t,e,29),i=uG(e,t,6),s=r^n^i;return s<0&&(s+=4294967296),s}function wve(e,t){var r=ud(e,t,19),n=ud(t,e,29),i=hG(e,t,6),s=r^n^i;return s<0&&(s+=4294967296),s}var f2=_r,mG=pG;function Tl(){if(!(this instanceof Tl))return new Tl;mG.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}f2.inherits(Tl,mG);var Tve=Tl;Tl.blockSize=1024;Tl.outSize=384;Tl.hmacStrength=192;Tl.padLength=128;Tl.prototype._digest=function(t){return t==="hex"?f2.toHex32(this.h.slice(0,12),"big"):f2.split32(this.h.slice(0,12),"big")};f0.sha1=GEe;f0.sha224=ive;f0.sha256=dG;f0.sha384=Tve;f0.sha512=pG;var gG={},Ef=_r,Rve=h0,Hv=Ef.rotl32,_6=Ef.sum32,ag=Ef.sum32_3,E6=Ef.sum32_4,_G=Rve.BlockHash;function Ed(){if(!(this instanceof Ed))return new Ed;_G.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}Ef.inherits(Ed,_G);gG.ripemd160=Ed;Ed.blockSize=512;Ed.outSize=160;Ed.hmacStrength=192;Ed.padLength=64;Ed.prototype._update=function(t,r){for(var n=this.h[0],i=this.h[1],s=this.h[2],o=this.h[3],a=this.h[4],c=n,d=i,l=s,u=o,h=a,p=0;p<80;p++){var _=_6(Hv(E6(n,v6(p,i,s,o),t[Ive[p]+r],Ave(p)),Nve[p]),a);n=a,a=o,o=Hv(s,10),s=i,i=_,_=_6(Hv(E6(c,v6(79-p,d,l,u),t[Ove[p]+r],Cve(p)),Dve[p]),h),c=h,h=u,u=Hv(l,10),l=d,d=_}_=ag(this.h[1],s,u),this.h[1]=ag(this.h[2],o,h),this.h[2]=ag(this.h[3],a,c),this.h[3]=ag(this.h[4],n,d),this.h[4]=ag(this.h[0],i,l),this.h[0]=_};Ed.prototype._digest=function(t){return t==="hex"?Ef.toHex32(this.h,"little"):Ef.split32(this.h,"little")};function v6(e,t,r,n){return e<=15?t^r^n:e<=31?t&r|~t&n:e<=47?(t|~r)^n:e<=63?t&n|r&~n:t^(r|~n)}function Ave(e){return e<=15?0:e<=31?1518500249:e<=47?1859775393:e<=63?2400959708:2840853838}function Cve(e){return e<=15?1352829926:e<=31?1548603684:e<=47?1836072691:e<=63?2053994217:0}var Ive=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],Ove=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],Nve=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],Dve=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],Pve=_r,kve=xf;function km(e,t,r){if(!(this instanceof km))return new km(e,t,r);this.Hash=e,this.blockSize=e.blockSize/8,this.outSize=e.outSize/8,this.inner=null,this.outer=null,this._init(Pve.toArray(t,r))}var Lve=km;km.prototype._init=function(t){t.length>this.blockSize&&(t=new this.Hash().update(t).digest()),kve(t.length<=this.blockSize);for(var r=t.length;r<this.blockSize;r++)t.push(0);for(r=0;r<t.length;r++)t[r]^=54;for(this.inner=new this.Hash().update(t),r=0;r<t.length;r++)t[r]^=106;this.outer=new this.Hash().update(t)};km.prototype.update=function(t,r){return this.inner.update(t,r),this};km.prototype.digest=function(t){return this.outer.update(this.inner.digest()),this.outer.digest(t)};(function(e){var t=e;t.utils=_r,t.common=h0,t.sha=f0,t.ripemd=gG,t.hmac=Lve,t.sha1=t.sha.sha1,t.sha256=t.sha.sha256,t.sha224=t.sha.sha224,t.sha384=t.sha.sha384,t.sha512=t.sha.sha512,t.ripemd160=t.ripemd.ripemd160})(Sw);var xve={};const Mve="elliptic",Uve="6.5.7",jve="EC cryptography",Fve="lib/elliptic.js",Bve=["lib"],Vve={lint:"eslint lib test","lint:fix":"npm run lint -- --fix",unit:"istanbul test _mocha --reporter=spec test/index.js",test:"npm run lint && npm run unit",version:"grunt dist && git add dist/"},$ve={type:"git",url:"git@github.com:indutny/elliptic"},Hve=["EC","Elliptic","curve","Cryptography"],zve="Fedor Indutny <fedor@indutny.com>",Wve="MIT",Gve={url:"https://github.com/indutny/elliptic/issues"},qve="https://github.com/indutny/elliptic",Kve={brfs:"^2.0.2",coveralls:"^3.1.0",eslint:"^7.6.0",grunt:"^1.2.1","grunt-browserify":"^5.3.0","grunt-cli":"^1.3.2","grunt-contrib-connect":"^3.0.0","grunt-contrib-copy":"^1.0.0","grunt-contrib-uglify":"^5.0.0","grunt-mocha-istanbul":"^5.0.2","grunt-saucelabs":"^9.0.1",istanbul:"^0.4.5",mocha:"^8.0.1"},Yve={"bn.js":"^4.11.9",brorand:"^1.1.0","hash.js":"^1.0.0","hmac-drbg":"^1.0.1",inherits:"^2.0.4","minimalistic-assert":"^1.0.1","minimalistic-crypto-utils":"^1.0.1"},Jve={name:Mve,version:Uve,description:jve,main:Fve,files:Bve,scripts:Vve,repository:$ve,keywords:Hve,author:zve,license:Wve,bugs:Gve,homepage:qve,devDependencies:Kve,dependencies:Yve};var Go={},bP={exports:{}};bP.exports;(function(e){(function(t,r){function n(H,A){if(!H)throw new Error(A||"Assertion failed")}function i(H,A){H.super_=A;var m=function(){};m.prototype=A.prototype,H.prototype=new m,H.prototype.constructor=H}function s(H,A,m){if(s.isBN(H))return H;this.negative=0,this.words=null,this.length=0,this.red=null,H!==null&&((A==="le"||A==="be")&&(m=A,A=10),this._init(H||0,A||10,m||"be"))}typeof t=="object"?t.exports=s:r.BN=s,s.BN=s,s.wordSize=26;var o;try{typeof window<"u"&&typeof window.Buffer<"u"?o=window.Buffer:o=JD.Buffer}catch{}s.isBN=function(A){return A instanceof s?!0:A!==null&&typeof A=="object"&&A.constructor.wordSize===s.wordSize&&Array.isArray(A.words)},s.max=function(A,m){return A.cmp(m)>0?A:m},s.min=function(A,m){return A.cmp(m)<0?A:m},s.prototype._init=function(A,m,S){if(typeof A=="number")return this._initNumber(A,m,S);if(typeof A=="object")return this._initArray(A,m,S);m==="hex"&&(m=16),n(m===(m|0)&&m>=2&&m<=36),A=A.toString().replace(/\s+/g,"");var T=0;A[0]==="-"&&(T++,this.negative=1),T<A.length&&(m===16?this._parseHex(A,T,S):(this._parseBase(A,m,T),S==="le"&&this._initArray(this.toArray(),m,S)))},s.prototype._initNumber=function(A,m,S){A<0&&(this.negative=1,A=-A),A<67108864?(this.words=[A&67108863],this.length=1):A<4503599627370496?(this.words=[A&67108863,A/67108864&67108863],this.length=2):(n(A<9007199254740992),this.words=[A&67108863,A/67108864&67108863,1],this.length=3),S==="le"&&this._initArray(this.toArray(),m,S)},s.prototype._initArray=function(A,m,S){if(n(typeof A.length=="number"),A.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(A.length/3),this.words=new Array(this.length);for(var T=0;T<this.length;T++)this.words[T]=0;var x,D,k=0;if(S==="be")for(T=A.length-1,x=0;T>=0;T-=3)D=A[T]|A[T-1]<<8|A[T-2]<<16,this.words[x]|=D<<k&67108863,this.words[x+1]=D>>>26-k&67108863,k+=24,k>=26&&(k-=26,x++);else if(S==="le")for(T=0,x=0;T<A.length;T+=3)D=A[T]|A[T+1]<<8|A[T+2]<<16,this.words[x]|=D<<k&67108863,this.words[x+1]=D>>>26-k&67108863,k+=24,k>=26&&(k-=26,x++);return this.strip()};function a(H,A){var m=H.charCodeAt(A);return m>=65&&m<=70?m-55:m>=97&&m<=102?m-87:m-48&15}function c(H,A,m){var S=a(H,m);return m-1>=A&&(S|=a(H,m-1)<<4),S}s.prototype._parseHex=function(A,m,S){this.length=Math.ceil((A.length-m)/6),this.words=new Array(this.length);for(var T=0;T<this.length;T++)this.words[T]=0;var x=0,D=0,k;if(S==="be")for(T=A.length-1;T>=m;T-=2)k=c(A,m,T)<<x,this.words[D]|=k&67108863,x>=18?(x-=18,D+=1,this.words[D]|=k>>>26):x+=8;else{var P=A.length-m;for(T=P%2===0?m+1:m;T<A.length;T+=2)k=c(A,m,T)<<x,this.words[D]|=k&67108863,x>=18?(x-=18,D+=1,this.words[D]|=k>>>26):x+=8}this.strip()};function d(H,A,m,S){for(var T=0,x=Math.min(H.length,m),D=A;D<x;D++){var k=H.charCodeAt(D)-48;T*=S,k>=49?T+=k-49+10:k>=17?T+=k-17+10:T+=k}return T}s.prototype._parseBase=function(A,m,S){this.words=[0],this.length=1;for(var T=0,x=1;x<=67108863;x*=m)T++;T--,x=x/m|0;for(var D=A.length-S,k=D%T,P=Math.min(D,D-k)+S,y=0,f=S;f<P;f+=T)y=d(A,f,f+T,m),this.imuln(x),this.words[0]+y<67108864?this.words[0]+=y:this._iaddn(y);if(k!==0){var R=1;for(y=d(A,f,A.length,m),f=0;f<k;f++)R*=m;this.imuln(R),this.words[0]+y<67108864?this.words[0]+=y:this._iaddn(y)}this.strip()},s.prototype.copy=function(A){A.words=new Array(this.length);for(var m=0;m<this.length;m++)A.words[m]=this.words[m];A.length=this.length,A.negative=this.negative,A.red=this.red},s.prototype.clone=function(){var A=new s(null);return this.copy(A),A},s.prototype._expand=function(A){for(;this.length<A;)this.words[this.length++]=0;return this},s.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},s.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},s.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var l=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],u=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],h=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];s.prototype.toString=function(A,m){A=A||10,m=m|0||1;var S;if(A===16||A==="hex"){S="";for(var T=0,x=0,D=0;D<this.length;D++){var k=this.words[D],P=((k<<T|x)&16777215).toString(16);x=k>>>24-T&16777215,x!==0||D!==this.length-1?S=l[6-P.length]+P+S:S=P+S,T+=2,T>=26&&(T-=26,D--)}for(x!==0&&(S=x.toString(16)+S);S.length%m!==0;)S="0"+S;return this.negative!==0&&(S="-"+S),S}if(A===(A|0)&&A>=2&&A<=36){var y=u[A],f=h[A];S="";var R=this.clone();for(R.negative=0;!R.isZero();){var B=R.modn(f).toString(A);R=R.idivn(f),R.isZero()?S=B+S:S=l[y-B.length]+B+S}for(this.isZero()&&(S="0"+S);S.length%m!==0;)S="0"+S;return this.negative!==0&&(S="-"+S),S}n(!1,"Base should be between 2 and 36")},s.prototype.toNumber=function(){var A=this.words[0];return this.length===2?A+=this.words[1]*67108864:this.length===3&&this.words[2]===1?A+=4503599627370496+this.words[1]*67108864:this.length>2&&n(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-A:A},s.prototype.toJSON=function(){return this.toString(16)},s.prototype.toBuffer=function(A,m){return n(typeof o<"u"),this.toArrayLike(o,A,m)},s.prototype.toArray=function(A,m){return this.toArrayLike(Array,A,m)},s.prototype.toArrayLike=function(A,m,S){var T=this.byteLength(),x=S||Math.max(1,T);n(T<=x,"byte array longer than desired length"),n(x>0,"Requested array length <= 0"),this.strip();var D=m==="le",k=new A(x),P,y,f=this.clone();if(D){for(y=0;!f.isZero();y++)P=f.andln(255),f.iushrn(8),k[y]=P;for(;y<x;y++)k[y]=0}else{for(y=0;y<x-T;y++)k[y]=0;for(y=0;!f.isZero();y++)P=f.andln(255),f.iushrn(8),k[x-y-1]=P}return k},Math.clz32?s.prototype._countBits=function(A){return 32-Math.clz32(A)}:s.prototype._countBits=function(A){var m=A,S=0;return m>=4096&&(S+=13,m>>>=13),m>=64&&(S+=7,m>>>=7),m>=8&&(S+=4,m>>>=4),m>=2&&(S+=2,m>>>=2),S+m},s.prototype._zeroBits=function(A){if(A===0)return 26;var m=A,S=0;return m&8191||(S+=13,m>>>=13),m&127||(S+=7,m>>>=7),m&15||(S+=4,m>>>=4),m&3||(S+=2,m>>>=2),m&1||S++,S},s.prototype.bitLength=function(){var A=this.words[this.length-1],m=this._countBits(A);return(this.length-1)*26+m};function p(H){for(var A=new Array(H.bitLength()),m=0;m<A.length;m++){var S=m/26|0,T=m%26;A[m]=(H.words[S]&1<<T)>>>T}return A}s.prototype.zeroBits=function(){if(this.isZero())return 0;for(var A=0,m=0;m<this.length;m++){var S=this._zeroBits(this.words[m]);if(A+=S,S!==26)break}return A},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.toTwos=function(A){return this.negative!==0?this.abs().inotn(A).iaddn(1):this.clone()},s.prototype.fromTwos=function(A){return this.testn(A-1)?this.notn(A).iaddn(1).ineg():this.clone()},s.prototype.isNeg=function(){return this.negative!==0},s.prototype.neg=function(){return this.clone().ineg()},s.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},s.prototype.iuor=function(A){for(;this.length<A.length;)this.words[this.length++]=0;for(var m=0;m<A.length;m++)this.words[m]=this.words[m]|A.words[m];return this.strip()},s.prototype.ior=function(A){return n((this.negative|A.negative)===0),this.iuor(A)},s.prototype.or=function(A){return this.length>A.length?this.clone().ior(A):A.clone().ior(this)},s.prototype.uor=function(A){return this.length>A.length?this.clone().iuor(A):A.clone().iuor(this)},s.prototype.iuand=function(A){var m;this.length>A.length?m=A:m=this;for(var S=0;S<m.length;S++)this.words[S]=this.words[S]&A.words[S];return this.length=m.length,this.strip()},s.prototype.iand=function(A){return n((this.negative|A.negative)===0),this.iuand(A)},s.prototype.and=function(A){return this.length>A.length?this.clone().iand(A):A.clone().iand(this)},s.prototype.uand=function(A){return this.length>A.length?this.clone().iuand(A):A.clone().iuand(this)},s.prototype.iuxor=function(A){var m,S;this.length>A.length?(m=this,S=A):(m=A,S=this);for(var T=0;T<S.length;T++)this.words[T]=m.words[T]^S.words[T];if(this!==m)for(;T<m.length;T++)this.words[T]=m.words[T];return this.length=m.length,this.strip()},s.prototype.ixor=function(A){return n((this.negative|A.negative)===0),this.iuxor(A)},s.prototype.xor=function(A){return this.length>A.length?this.clone().ixor(A):A.clone().ixor(this)},s.prototype.uxor=function(A){return this.length>A.length?this.clone().iuxor(A):A.clone().iuxor(this)},s.prototype.inotn=function(A){n(typeof A=="number"&&A>=0);var m=Math.ceil(A/26)|0,S=A%26;this._expand(m),S>0&&m--;for(var T=0;T<m;T++)this.words[T]=~this.words[T]&67108863;return S>0&&(this.words[T]=~this.words[T]&67108863>>26-S),this.strip()},s.prototype.notn=function(A){return this.clone().inotn(A)},s.prototype.setn=function(A,m){n(typeof A=="number"&&A>=0);var S=A/26|0,T=A%26;return this._expand(S+1),m?this.words[S]=this.words[S]|1<<T:this.words[S]=this.words[S]&~(1<<T),this.strip()},s.prototype.iadd=function(A){var m;if(this.negative!==0&&A.negative===0)return this.negative=0,m=this.isub(A),this.negative^=1,this._normSign();if(this.negative===0&&A.negative!==0)return A.negative=0,m=this.isub(A),A.negative=1,m._normSign();var S,T;this.length>A.length?(S=this,T=A):(S=A,T=this);for(var x=0,D=0;D<T.length;D++)m=(S.words[D]|0)+(T.words[D]|0)+x,this.words[D]=m&67108863,x=m>>>26;for(;x!==0&&D<S.length;D++)m=(S.words[D]|0)+x,this.words[D]=m&67108863,x=m>>>26;if(this.length=S.length,x!==0)this.words[this.length]=x,this.length++;else if(S!==this)for(;D<S.length;D++)this.words[D]=S.words[D];return this},s.prototype.add=function(A){var m;return A.negative!==0&&this.negative===0?(A.negative=0,m=this.sub(A),A.negative^=1,m):A.negative===0&&this.negative!==0?(this.negative=0,m=A.sub(this),this.negative=1,m):this.length>A.length?this.clone().iadd(A):A.clone().iadd(this)},s.prototype.isub=function(A){if(A.negative!==0){A.negative=0;var m=this.iadd(A);return A.negative=1,m._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(A),this.negative=1,this._normSign();var S=this.cmp(A);if(S===0)return this.negative=0,this.length=1,this.words[0]=0,this;var T,x;S>0?(T=this,x=A):(T=A,x=this);for(var D=0,k=0;k<x.length;k++)m=(T.words[k]|0)-(x.words[k]|0)+D,D=m>>26,this.words[k]=m&67108863;for(;D!==0&&k<T.length;k++)m=(T.words[k]|0)+D,D=m>>26,this.words[k]=m&67108863;if(D===0&&k<T.length&&T!==this)for(;k<T.length;k++)this.words[k]=T.words[k];return this.length=Math.max(this.length,k),T!==this&&(this.negative=1),this.strip()},s.prototype.sub=function(A){return this.clone().isub(A)};function _(H,A,m){m.negative=A.negative^H.negative;var S=H.length+A.length|0;m.length=S,S=S-1|0;var T=H.words[0]|0,x=A.words[0]|0,D=T*x,k=D&67108863,P=D/67108864|0;m.words[0]=k;for(var y=1;y<S;y++){for(var f=P>>>26,R=P&67108863,B=Math.min(y,A.length-1),q=Math.max(0,y-H.length+1);q<=B;q++){var F=y-q|0;T=H.words[F]|0,x=A.words[q]|0,D=T*x+R,f+=D/67108864|0,R=D&67108863}m.words[y]=R|0,P=f|0}return P!==0?m.words[y]=P|0:m.length--,m.strip()}var g=function(A,m,S){var T=A.words,x=m.words,D=S.words,k=0,P,y,f,R=T[0]|0,B=R&8191,q=R>>>13,F=T[1]|0,te=F&8191,G=F>>>13,Y=T[2]|0,X=Y&8191,M=Y>>>13,J=T[3]|0,de=J&8191,he=J>>>13,Se=T[4]|0,Te=Se&8191,Re=Se>>>13,Ne=T[5]|0,Q=Ne&8191,re=Ne>>>13,ne=T[6]|0,oe=ne&8191,ce=ne>>>13,ue=T[7]|0,fe=ue&8191,ye=ue>>>13,Le=T[8]|0,ke=Le&8191,Pe=Le>>>13,Qe=T[9]|0,ze=Qe&8191,Ue=Qe>>>13,st=x[0]|0,ct=st&8191,Ve=st>>>13,ot=x[1]|0,nr=ot&8191,ut=ot>>>13,lr=x[2]|0,Wt=lr&8191,pt=lr>>>13,br=x[3]|0,wr=br&8191,Ke=br>>>13,wt=x[4]|0,Ct=wt&8191,Ye=wt>>>13,It=x[5]|0,Tt=It&8191,tt=It>>>13,kt=x[6]|0,Lt=kt&8191,rt=kt>>>13,xt=x[7]|0,Ot=xt&8191,Je=xt>>>13,gt=x[8]|0,Mt=gt&8191,nt=gt>>>13,Mr=x[9]|0,Ur=Mr&8191,Nt=Mr>>>13;S.negative=A.negative^m.negative,S.length=19,P=Math.imul(B,ct),y=Math.imul(B,Ve),y=y+Math.imul(q,ct)|0,f=Math.imul(q,Ve);var sr=(k+P|0)+((y&8191)<<13)|0;k=(f+(y>>>13)|0)+(sr>>>26)|0,sr&=67108863,P=Math.imul(te,ct),y=Math.imul(te,Ve),y=y+Math.imul(G,ct)|0,f=Math.imul(G,Ve),P=P+Math.imul(B,nr)|0,y=y+Math.imul(B,ut)|0,y=y+Math.imul(q,nr)|0,f=f+Math.imul(q,ut)|0;var Ls=(k+P|0)+((y&8191)<<13)|0;k=(f+(y>>>13)|0)+(Ls>>>26)|0,Ls&=67108863,P=Math.imul(X,ct),y=Math.imul(X,Ve),y=y+Math.imul(M,ct)|0,f=Math.imul(M,Ve),P=P+Math.imul(te,nr)|0,y=y+Math.imul(te,ut)|0,y=y+Math.imul(G,nr)|0,f=f+Math.imul(G,ut)|0,P=P+Math.imul(B,Wt)|0,y=y+Math.imul(B,pt)|0,y=y+Math.imul(q,Wt)|0,f=f+Math.imul(q,pt)|0;var xs=(k+P|0)+((y&8191)<<13)|0;k=(f+(y>>>13)|0)+(xs>>>26)|0,xs&=67108863,P=Math.imul(de,ct),y=Math.imul(de,Ve),y=y+Math.imul(he,ct)|0,f=Math.imul(he,Ve),P=P+Math.imul(X,nr)|0,y=y+Math.imul(X,ut)|0,y=y+Math.imul(M,nr)|0,f=f+Math.imul(M,ut)|0,P=P+Math.imul(te,Wt)|0,y=y+Math.imul(te,pt)|0,y=y+Math.imul(G,Wt)|0,f=f+Math.imul(G,pt)|0,P=P+Math.imul(B,wr)|0,y=y+Math.imul(B,Ke)|0,y=y+Math.imul(q,wr)|0,f=f+Math.imul(q,Ke)|0;var Ms=(k+P|0)+((y&8191)<<13)|0;k=(f+(y>>>13)|0)+(Ms>>>26)|0,Ms&=67108863,P=Math.imul(Te,ct),y=Math.imul(Te,Ve),y=y+Math.imul(Re,ct)|0,f=Math.imul(Re,Ve),P=P+Math.imul(de,nr)|0,y=y+Math.imul(de,ut)|0,y=y+Math.imul(he,nr)|0,f=f+Math.imul(he,ut)|0,P=P+Math.imul(X,Wt)|0,y=y+Math.imul(X,pt)|0,y=y+Math.imul(M,Wt)|0,f=f+Math.imul(M,pt)|0,P=P+Math.imul(te,wr)|0,y=y+Math.imul(te,Ke)|0,y=y+Math.imul(G,wr)|0,f=f+Math.imul(G,Ke)|0,P=P+Math.imul(B,Ct)|0,y=y+Math.imul(B,Ye)|0,y=y+Math.imul(q,Ct)|0,f=f+Math.imul(q,Ye)|0;var Us=(k+P|0)+((y&8191)<<13)|0;k=(f+(y>>>13)|0)+(Us>>>26)|0,Us&=67108863,P=Math.imul(Q,ct),y=Math.imul(Q,Ve),y=y+Math.imul(re,ct)|0,f=Math.imul(re,Ve),P=P+Math.imul(Te,nr)|0,y=y+Math.imul(Te,ut)|0,y=y+Math.imul(Re,nr)|0,f=f+Math.imul(Re,ut)|0,P=P+Math.imul(de,Wt)|0,y=y+Math.imul(de,pt)|0,y=y+Math.imul(he,Wt)|0,f=f+Math.imul(he,pt)|0,P=P+Math.imul(X,wr)|0,y=y+Math.imul(X,Ke)|0,y=y+Math.imul(M,wr)|0,f=f+Math.imul(M,Ke)|0,P=P+Math.imul(te,Ct)|0,y=y+Math.imul(te,Ye)|0,y=y+Math.imul(G,Ct)|0,f=f+Math.imul(G,Ye)|0,P=P+Math.imul(B,Tt)|0,y=y+Math.imul(B,tt)|0,y=y+Math.imul(q,Tt)|0,f=f+Math.imul(q,tt)|0;var js=(k+P|0)+((y&8191)<<13)|0;k=(f+(y>>>13)|0)+(js>>>26)|0,js&=67108863,P=Math.imul(oe,ct),y=Math.imul(oe,Ve),y=y+Math.imul(ce,ct)|0,f=Math.imul(ce,Ve),P=P+Math.imul(Q,nr)|0,y=y+Math.imul(Q,ut)|0,y=y+Math.imul(re,nr)|0,f=f+Math.imul(re,ut)|0,P=P+Math.imul(Te,Wt)|0,y=y+Math.imul(Te,pt)|0,y=y+Math.imul(Re,Wt)|0,f=f+Math.imul(Re,pt)|0,P=P+Math.imul(de,wr)|0,y=y+Math.imul(de,Ke)|0,y=y+Math.imul(he,wr)|0,f=f+Math.imul(he,Ke)|0,P=P+Math.imul(X,Ct)|0,y=y+Math.imul(X,Ye)|0,y=y+Math.imul(M,Ct)|0,f=f+Math.imul(M,Ye)|0,P=P+Math.imul(te,Tt)|0,y=y+Math.imul(te,tt)|0,y=y+Math.imul(G,Tt)|0,f=f+Math.imul(G,tt)|0,P=P+Math.imul(B,Lt)|0,y=y+Math.imul(B,rt)|0,y=y+Math.imul(q,Lt)|0,f=f+Math.imul(q,rt)|0;var Qn=(k+P|0)+((y&8191)<<13)|0;k=(f+(y>>>13)|0)+(Qn>>>26)|0,Qn&=67108863,P=Math.imul(fe,ct),y=Math.imul(fe,Ve),y=y+Math.imul(ye,ct)|0,f=Math.imul(ye,Ve),P=P+Math.imul(oe,nr)|0,y=y+Math.imul(oe,ut)|0,y=y+Math.imul(ce,nr)|0,f=f+Math.imul(ce,ut)|0,P=P+Math.imul(Q,Wt)|0,y=y+Math.imul(Q,pt)|0,y=y+Math.imul(re,Wt)|0,f=f+Math.imul(re,pt)|0,P=P+Math.imul(Te,wr)|0,y=y+Math.imul(Te,Ke)|0,y=y+Math.imul(Re,wr)|0,f=f+Math.imul(Re,Ke)|0,P=P+Math.imul(de,Ct)|0,y=y+Math.imul(de,Ye)|0,y=y+Math.imul(he,Ct)|0,f=f+Math.imul(he,Ye)|0,P=P+Math.imul(X,Tt)|0,y=y+Math.imul(X,tt)|0,y=y+Math.imul(M,Tt)|0,f=f+Math.imul(M,tt)|0,P=P+Math.imul(te,Lt)|0,y=y+Math.imul(te,rt)|0,y=y+Math.imul(G,Lt)|0,f=f+Math.imul(G,rt)|0,P=P+Math.imul(B,Ot)|0,y=y+Math.imul(B,Je)|0,y=y+Math.imul(q,Ot)|0,f=f+Math.imul(q,Je)|0;var Nd=(k+P|0)+((y&8191)<<13)|0;k=(f+(y>>>13)|0)+(Nd>>>26)|0,Nd&=67108863,P=Math.imul(ke,ct),y=Math.imul(ke,Ve),y=y+Math.imul(Pe,ct)|0,f=Math.imul(Pe,Ve),P=P+Math.imul(fe,nr)|0,y=y+Math.imul(fe,ut)|0,y=y+Math.imul(ye,nr)|0,f=f+Math.imul(ye,ut)|0,P=P+Math.imul(oe,Wt)|0,y=y+Math.imul(oe,pt)|0,y=y+Math.imul(ce,Wt)|0,f=f+Math.imul(ce,pt)|0,P=P+Math.imul(Q,wr)|0,y=y+Math.imul(Q,Ke)|0,y=y+Math.imul(re,wr)|0,f=f+Math.imul(re,Ke)|0,P=P+Math.imul(Te,Ct)|0,y=y+Math.imul(Te,Ye)|0,y=y+Math.imul(Re,Ct)|0,f=f+Math.imul(Re,Ye)|0,P=P+Math.imul(de,Tt)|0,y=y+Math.imul(de,tt)|0,y=y+Math.imul(he,Tt)|0,f=f+Math.imul(he,tt)|0,P=P+Math.imul(X,Lt)|0,y=y+Math.imul(X,rt)|0,y=y+Math.imul(M,Lt)|0,f=f+Math.imul(M,rt)|0,P=P+Math.imul(te,Ot)|0,y=y+Math.imul(te,Je)|0,y=y+Math.imul(G,Ot)|0,f=f+Math.imul(G,Je)|0,P=P+Math.imul(B,Mt)|0,y=y+Math.imul(B,nt)|0,y=y+Math.imul(q,Mt)|0,f=f+Math.imul(q,nt)|0;var Dd=(k+P|0)+((y&8191)<<13)|0;k=(f+(y>>>13)|0)+(Dd>>>26)|0,Dd&=67108863,P=Math.imul(ze,ct),y=Math.imul(ze,Ve),y=y+Math.imul(Ue,ct)|0,f=Math.imul(Ue,Ve),P=P+Math.imul(ke,nr)|0,y=y+Math.imul(ke,ut)|0,y=y+Math.imul(Pe,nr)|0,f=f+Math.imul(Pe,ut)|0,P=P+Math.imul(fe,Wt)|0,y=y+Math.imul(fe,pt)|0,y=y+Math.imul(ye,Wt)|0,f=f+Math.imul(ye,pt)|0,P=P+Math.imul(oe,wr)|0,y=y+Math.imul(oe,Ke)|0,y=y+Math.imul(ce,wr)|0,f=f+Math.imul(ce,Ke)|0,P=P+Math.imul(Q,Ct)|0,y=y+Math.imul(Q,Ye)|0,y=y+Math.imul(re,Ct)|0,f=f+Math.imul(re,Ye)|0,P=P+Math.imul(Te,Tt)|0,y=y+Math.imul(Te,tt)|0,y=y+Math.imul(Re,Tt)|0,f=f+Math.imul(Re,tt)|0,P=P+Math.imul(de,Lt)|0,y=y+Math.imul(de,rt)|0,y=y+Math.imul(he,Lt)|0,f=f+Math.imul(he,rt)|0,P=P+Math.imul(X,Ot)|0,y=y+Math.imul(X,Je)|0,y=y+Math.imul(M,Ot)|0,f=f+Math.imul(M,Je)|0,P=P+Math.imul(te,Mt)|0,y=y+Math.imul(te,nt)|0,y=y+Math.imul(G,Mt)|0,f=f+Math.imul(G,nt)|0,P=P+Math.imul(B,Ur)|0,y=y+Math.imul(B,Nt)|0,y=y+Math.imul(q,Ur)|0,f=f+Math.imul(q,Nt)|0;var Pd=(k+P|0)+((y&8191)<<13)|0;k=(f+(y>>>13)|0)+(Pd>>>26)|0,Pd&=67108863,P=Math.imul(ze,nr),y=Math.imul(ze,ut),y=y+Math.imul(Ue,nr)|0,f=Math.imul(Ue,ut),P=P+Math.imul(ke,Wt)|0,y=y+Math.imul(ke,pt)|0,y=y+Math.imul(Pe,Wt)|0,f=f+Math.imul(Pe,pt)|0,P=P+Math.imul(fe,wr)|0,y=y+Math.imul(fe,Ke)|0,y=y+Math.imul(ye,wr)|0,f=f+Math.imul(ye,Ke)|0,P=P+Math.imul(oe,Ct)|0,y=y+Math.imul(oe,Ye)|0,y=y+Math.imul(ce,Ct)|0,f=f+Math.imul(ce,Ye)|0,P=P+Math.imul(Q,Tt)|0,y=y+Math.imul(Q,tt)|0,y=y+Math.imul(re,Tt)|0,f=f+Math.imul(re,tt)|0,P=P+Math.imul(Te,Lt)|0,y=y+Math.imul(Te,rt)|0,y=y+Math.imul(Re,Lt)|0,f=f+Math.imul(Re,rt)|0,P=P+Math.imul(de,Ot)|0,y=y+Math.imul(de,Je)|0,y=y+Math.imul(he,Ot)|0,f=f+Math.imul(he,Je)|0,P=P+Math.imul(X,Mt)|0,y=y+Math.imul(X,nt)|0,y=y+Math.imul(M,Mt)|0,f=f+Math.imul(M,nt)|0,P=P+Math.imul(te,Ur)|0,y=y+Math.imul(te,Nt)|0,y=y+Math.imul(G,Ur)|0,f=f+Math.imul(G,Nt)|0;var kd=(k+P|0)+((y&8191)<<13)|0;k=(f+(y>>>13)|0)+(kd>>>26)|0,kd&=67108863,P=Math.imul(ze,Wt),y=Math.imul(ze,pt),y=y+Math.imul(Ue,Wt)|0,f=Math.imul(Ue,pt),P=P+Math.imul(ke,wr)|0,y=y+Math.imul(ke,Ke)|0,y=y+Math.imul(Pe,wr)|0,f=f+Math.imul(Pe,Ke)|0,P=P+Math.imul(fe,Ct)|0,y=y+Math.imul(fe,Ye)|0,y=y+Math.imul(ye,Ct)|0,f=f+Math.imul(ye,Ye)|0,P=P+Math.imul(oe,Tt)|0,y=y+Math.imul(oe,tt)|0,y=y+Math.imul(ce,Tt)|0,f=f+Math.imul(ce,tt)|0,P=P+Math.imul(Q,Lt)|0,y=y+Math.imul(Q,rt)|0,y=y+Math.imul(re,Lt)|0,f=f+Math.imul(re,rt)|0,P=P+Math.imul(Te,Ot)|0,y=y+Math.imul(Te,Je)|0,y=y+Math.imul(Re,Ot)|0,f=f+Math.imul(Re,Je)|0,P=P+Math.imul(de,Mt)|0,y=y+Math.imul(de,nt)|0,y=y+Math.imul(he,Mt)|0,f=f+Math.imul(he,nt)|0,P=P+Math.imul(X,Ur)|0,y=y+Math.imul(X,Nt)|0,y=y+Math.imul(M,Ur)|0,f=f+Math.imul(M,Nt)|0;var Ld=(k+P|0)+((y&8191)<<13)|0;k=(f+(y>>>13)|0)+(Ld>>>26)|0,Ld&=67108863,P=Math.imul(ze,wr),y=Math.imul(ze,Ke),y=y+Math.imul(Ue,wr)|0,f=Math.imul(Ue,Ke),P=P+Math.imul(ke,Ct)|0,y=y+Math.imul(ke,Ye)|0,y=y+Math.imul(Pe,Ct)|0,f=f+Math.imul(Pe,Ye)|0,P=P+Math.imul(fe,Tt)|0,y=y+Math.imul(fe,tt)|0,y=y+Math.imul(ye,Tt)|0,f=f+Math.imul(ye,tt)|0,P=P+Math.imul(oe,Lt)|0,y=y+Math.imul(oe,rt)|0,y=y+Math.imul(ce,Lt)|0,f=f+Math.imul(ce,rt)|0,P=P+Math.imul(Q,Ot)|0,y=y+Math.imul(Q,Je)|0,y=y+Math.imul(re,Ot)|0,f=f+Math.imul(re,Je)|0,P=P+Math.imul(Te,Mt)|0,y=y+Math.imul(Te,nt)|0,y=y+Math.imul(Re,Mt)|0,f=f+Math.imul(Re,nt)|0,P=P+Math.imul(de,Ur)|0,y=y+Math.imul(de,Nt)|0,y=y+Math.imul(he,Ur)|0,f=f+Math.imul(he,Nt)|0;var Xo=(k+P|0)+((y&8191)<<13)|0;k=(f+(y>>>13)|0)+(Xo>>>26)|0,Xo&=67108863,P=Math.imul(ze,Ct),y=Math.imul(ze,Ye),y=y+Math.imul(Ue,Ct)|0,f=Math.imul(Ue,Ye),P=P+Math.imul(ke,Tt)|0,y=y+Math.imul(ke,tt)|0,y=y+Math.imul(Pe,Tt)|0,f=f+Math.imul(Pe,tt)|0,P=P+Math.imul(fe,Lt)|0,y=y+Math.imul(fe,rt)|0,y=y+Math.imul(ye,Lt)|0,f=f+Math.imul(ye,rt)|0,P=P+Math.imul(oe,Ot)|0,y=y+Math.imul(oe,Je)|0,y=y+Math.imul(ce,Ot)|0,f=f+Math.imul(ce,Je)|0,P=P+Math.imul(Q,Mt)|0,y=y+Math.imul(Q,nt)|0,y=y+Math.imul(re,Mt)|0,f=f+Math.imul(re,nt)|0,P=P+Math.imul(Te,Ur)|0,y=y+Math.imul(Te,Nt)|0,y=y+Math.imul(Re,Ur)|0,f=f+Math.imul(Re,Nt)|0;var xd=(k+P|0)+((y&8191)<<13)|0;k=(f+(y>>>13)|0)+(xd>>>26)|0,xd&=67108863,P=Math.imul(ze,Tt),y=Math.imul(ze,tt),y=y+Math.imul(Ue,Tt)|0,f=Math.imul(Ue,tt),P=P+Math.imul(ke,Lt)|0,y=y+Math.imul(ke,rt)|0,y=y+Math.imul(Pe,Lt)|0,f=f+Math.imul(Pe,rt)|0,P=P+Math.imul(fe,Ot)|0,y=y+Math.imul(fe,Je)|0,y=y+Math.imul(ye,Ot)|0,f=f+Math.imul(ye,Je)|0,P=P+Math.imul(oe,Mt)|0,y=y+Math.imul(oe,nt)|0,y=y+Math.imul(ce,Mt)|0,f=f+Math.imul(ce,nt)|0,P=P+Math.imul(Q,Ur)|0,y=y+Math.imul(Q,Nt)|0,y=y+Math.imul(re,Ur)|0,f=f+Math.imul(re,Nt)|0;var Md=(k+P|0)+((y&8191)<<13)|0;k=(f+(y>>>13)|0)+(Md>>>26)|0,Md&=67108863,P=Math.imul(ze,Lt),y=Math.imul(ze,rt),y=y+Math.imul(Ue,Lt)|0,f=Math.imul(Ue,rt),P=P+Math.imul(ke,Ot)|0,y=y+Math.imul(ke,Je)|0,y=y+Math.imul(Pe,Ot)|0,f=f+Math.imul(Pe,Je)|0,P=P+Math.imul(fe,Mt)|0,y=y+Math.imul(fe,nt)|0,y=y+Math.imul(ye,Mt)|0,f=f+Math.imul(ye,nt)|0,P=P+Math.imul(oe,Ur)|0,y=y+Math.imul(oe,Nt)|0,y=y+Math.imul(ce,Ur)|0,f=f+Math.imul(ce,Nt)|0;var qi=(k+P|0)+((y&8191)<<13)|0;k=(f+(y>>>13)|0)+(qi>>>26)|0,qi&=67108863,P=Math.imul(ze,Ot),y=Math.imul(ze,Je),y=y+Math.imul(Ue,Ot)|0,f=Math.imul(Ue,Je),P=P+Math.imul(ke,Mt)|0,y=y+Math.imul(ke,nt)|0,y=y+Math.imul(Pe,Mt)|0,f=f+Math.imul(Pe,nt)|0,P=P+Math.imul(fe,Ur)|0,y=y+Math.imul(fe,Nt)|0,y=y+Math.imul(ye,Ur)|0,f=f+Math.imul(ye,Nt)|0;var Ud=(k+P|0)+((y&8191)<<13)|0;k=(f+(y>>>13)|0)+(Ud>>>26)|0,Ud&=67108863,P=Math.imul(ze,Mt),y=Math.imul(ze,nt),y=y+Math.imul(Ue,Mt)|0,f=Math.imul(Ue,nt),P=P+Math.imul(ke,Ur)|0,y=y+Math.imul(ke,Nt)|0,y=y+Math.imul(Pe,Ur)|0,f=f+Math.imul(Pe,Nt)|0;var jd=(k+P|0)+((y&8191)<<13)|0;k=(f+(y>>>13)|0)+(jd>>>26)|0,jd&=67108863,P=Math.imul(ze,Ur),y=Math.imul(ze,Nt),y=y+Math.imul(Ue,Ur)|0,f=Math.imul(Ue,Nt);var Fd=(k+P|0)+((y&8191)<<13)|0;return k=(f+(y>>>13)|0)+(Fd>>>26)|0,Fd&=67108863,D[0]=sr,D[1]=Ls,D[2]=xs,D[3]=Ms,D[4]=Us,D[5]=js,D[6]=Qn,D[7]=Nd,D[8]=Dd,D[9]=Pd,D[10]=kd,D[11]=Ld,D[12]=Xo,D[13]=xd,D[14]=Md,D[15]=qi,D[16]=Ud,D[17]=jd,D[18]=Fd,k!==0&&(D[19]=k,S.length++),S};Math.imul||(g=_);function E(H,A,m){m.negative=A.negative^H.negative,m.length=H.length+A.length;for(var S=0,T=0,x=0;x<m.length-1;x++){var D=T;T=0;for(var k=S&67108863,P=Math.min(x,A.length-1),y=Math.max(0,x-H.length+1);y<=P;y++){var f=x-y,R=H.words[f]|0,B=A.words[y]|0,q=R*B,F=q&67108863;D=D+(q/67108864|0)|0,F=F+k|0,k=F&67108863,D=D+(F>>>26)|0,T+=D>>>26,D&=67108863}m.words[x]=k,S=D,D=T}return S!==0?m.words[x]=S:m.length--,m.strip()}function b(H,A,m){var S=new v;return S.mulp(H,A,m)}s.prototype.mulTo=function(A,m){var S,T=this.length+A.length;return this.length===10&&A.length===10?S=g(this,A,m):T<63?S=_(this,A,m):T<1024?S=E(this,A,m):S=b(this,A,m),S};function v(H,A){this.x=H,this.y=A}v.prototype.makeRBT=function(A){for(var m=new Array(A),S=s.prototype._countBits(A)-1,T=0;T<A;T++)m[T]=this.revBin(T,S,A);return m},v.prototype.revBin=function(A,m,S){if(A===0||A===S-1)return A;for(var T=0,x=0;x<m;x++)T|=(A&1)<<m-x-1,A>>=1;return T},v.prototype.permute=function(A,m,S,T,x,D){for(var k=0;k<D;k++)T[k]=m[A[k]],x[k]=S[A[k]]},v.prototype.transform=function(A,m,S,T,x,D){this.permute(D,A,m,S,T,x);for(var k=1;k<x;k<<=1)for(var P=k<<1,y=Math.cos(2*Math.PI/P),f=Math.sin(2*Math.PI/P),R=0;R<x;R+=P)for(var B=y,q=f,F=0;F<k;F++){var te=S[R+F],G=T[R+F],Y=S[R+F+k],X=T[R+F+k],M=B*Y-q*X;X=B*X+q*Y,Y=M,S[R+F]=te+Y,T[R+F]=G+X,S[R+F+k]=te-Y,T[R+F+k]=G-X,F!==P&&(M=y*B-f*q,q=y*q+f*B,B=M)}},v.prototype.guessLen13b=function(A,m){var S=Math.max(m,A)|1,T=S&1,x=0;for(S=S/2|0;S;S=S>>>1)x++;return 1<<x+1+T},v.prototype.conjugate=function(A,m,S){if(!(S<=1))for(var T=0;T<S/2;T++){var x=A[T];A[T]=A[S-T-1],A[S-T-1]=x,x=m[T],m[T]=-m[S-T-1],m[S-T-1]=-x}},v.prototype.normalize13b=function(A,m){for(var S=0,T=0;T<m/2;T++){var x=Math.round(A[2*T+1]/m)*8192+Math.round(A[2*T]/m)+S;A[T]=x&67108863,x<67108864?S=0:S=x/67108864|0}return A},v.prototype.convert13b=function(A,m,S,T){for(var x=0,D=0;D<m;D++)x=x+(A[D]|0),S[2*D]=x&8191,x=x>>>13,S[2*D+1]=x&8191,x=x>>>13;for(D=2*m;D<T;++D)S[D]=0;n(x===0),n((x&-8192)===0)},v.prototype.stub=function(A){for(var m=new Array(A),S=0;S<A;S++)m[S]=0;return m},v.prototype.mulp=function(A,m,S){var T=2*this.guessLen13b(A.length,m.length),x=this.makeRBT(T),D=this.stub(T),k=new Array(T),P=new Array(T),y=new Array(T),f=new Array(T),R=new Array(T),B=new Array(T),q=S.words;q.length=T,this.convert13b(A.words,A.length,k,T),this.convert13b(m.words,m.length,f,T),this.transform(k,D,P,y,T,x),this.transform(f,D,R,B,T,x);for(var F=0;F<T;F++){var te=P[F]*R[F]-y[F]*B[F];y[F]=P[F]*B[F]+y[F]*R[F],P[F]=te}return this.conjugate(P,y,T),this.transform(P,y,q,D,T,x),this.conjugate(q,D,T),this.normalize13b(q,T),S.negative=A.negative^m.negative,S.length=A.length+m.length,S.strip()},s.prototype.mul=function(A){var m=new s(null);return m.words=new Array(this.length+A.length),this.mulTo(A,m)},s.prototype.mulf=function(A){var m=new s(null);return m.words=new Array(this.length+A.length),b(this,A,m)},s.prototype.imul=function(A){return this.clone().mulTo(A,this)},s.prototype.imuln=function(A){n(typeof A=="number"),n(A<67108864);for(var m=0,S=0;S<this.length;S++){var T=(this.words[S]|0)*A,x=(T&67108863)+(m&67108863);m>>=26,m+=T/67108864|0,m+=x>>>26,this.words[S]=x&67108863}return m!==0&&(this.words[S]=m,this.length++),this},s.prototype.muln=function(A){return this.clone().imuln(A)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.imul(this.clone())},s.prototype.pow=function(A){var m=p(A);if(m.length===0)return new s(1);for(var S=this,T=0;T<m.length&&m[T]===0;T++,S=S.sqr());if(++T<m.length)for(var x=S.sqr();T<m.length;T++,x=x.sqr())m[T]!==0&&(S=S.mul(x));return S},s.prototype.iushln=function(A){n(typeof A=="number"&&A>=0);var m=A%26,S=(A-m)/26,T=67108863>>>26-m<<26-m,x;if(m!==0){var D=0;for(x=0;x<this.length;x++){var k=this.words[x]&T,P=(this.words[x]|0)-k<<m;this.words[x]=P|D,D=k>>>26-m}D&&(this.words[x]=D,this.length++)}if(S!==0){for(x=this.length-1;x>=0;x--)this.words[x+S]=this.words[x];for(x=0;x<S;x++)this.words[x]=0;this.length+=S}return this.strip()},s.prototype.ishln=function(A){return n(this.negative===0),this.iushln(A)},s.prototype.iushrn=function(A,m,S){n(typeof A=="number"&&A>=0);var T;m?T=(m-m%26)/26:T=0;var x=A%26,D=Math.min((A-x)/26,this.length),k=67108863^67108863>>>x<<x,P=S;if(T-=D,T=Math.max(0,T),P){for(var y=0;y<D;y++)P.words[y]=this.words[y];P.length=D}if(D!==0)if(this.length>D)for(this.length-=D,y=0;y<this.length;y++)this.words[y]=this.words[y+D];else this.words[0]=0,this.length=1;var f=0;for(y=this.length-1;y>=0&&(f!==0||y>=T);y--){var R=this.words[y]|0;this.words[y]=f<<26-x|R>>>x,f=R&k}return P&&f!==0&&(P.words[P.length++]=f),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},s.prototype.ishrn=function(A,m,S){return n(this.negative===0),this.iushrn(A,m,S)},s.prototype.shln=function(A){return this.clone().ishln(A)},s.prototype.ushln=function(A){return this.clone().iushln(A)},s.prototype.shrn=function(A){return this.clone().ishrn(A)},s.prototype.ushrn=function(A){return this.clone().iushrn(A)},s.prototype.testn=function(A){n(typeof A=="number"&&A>=0);var m=A%26,S=(A-m)/26,T=1<<m;if(this.length<=S)return!1;var x=this.words[S];return!!(x&T)},s.prototype.imaskn=function(A){n(typeof A=="number"&&A>=0);var m=A%26,S=(A-m)/26;if(n(this.negative===0,"imaskn works only with positive numbers"),this.length<=S)return this;if(m!==0&&S++,this.length=Math.min(S,this.length),m!==0){var T=67108863^67108863>>>m<<m;this.words[this.length-1]&=T}return this.strip()},s.prototype.maskn=function(A){return this.clone().imaskn(A)},s.prototype.iaddn=function(A){return n(typeof A=="number"),n(A<67108864),A<0?this.isubn(-A):this.negative!==0?this.length===1&&(this.words[0]|0)<A?(this.words[0]=A-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(A),this.negative=1,this):this._iaddn(A)},s.prototype._iaddn=function(A){this.words[0]+=A;for(var m=0;m<this.length&&this.words[m]>=67108864;m++)this.words[m]-=67108864,m===this.length-1?this.words[m+1]=1:this.words[m+1]++;return this.length=Math.max(this.length,m+1),this},s.prototype.isubn=function(A){if(n(typeof A=="number"),n(A<67108864),A<0)return this.iaddn(-A);if(this.negative!==0)return this.negative=0,this.iaddn(A),this.negative=1,this;if(this.words[0]-=A,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var m=0;m<this.length&&this.words[m]<0;m++)this.words[m]+=67108864,this.words[m+1]-=1;return this.strip()},s.prototype.addn=function(A){return this.clone().iaddn(A)},s.prototype.subn=function(A){return this.clone().isubn(A)},s.prototype.iabs=function(){return this.negative=0,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(A,m,S){var T=A.length+S,x;this._expand(T);var D,k=0;for(x=0;x<A.length;x++){D=(this.words[x+S]|0)+k;var P=(A.words[x]|0)*m;D-=P&67108863,k=(D>>26)-(P/67108864|0),this.words[x+S]=D&67108863}for(;x<this.length-S;x++)D=(this.words[x+S]|0)+k,k=D>>26,this.words[x+S]=D&67108863;if(k===0)return this.strip();for(n(k===-1),k=0,x=0;x<this.length;x++)D=-(this.words[x]|0)+k,k=D>>26,this.words[x]=D&67108863;return this.negative=1,this.strip()},s.prototype._wordDiv=function(A,m){var S=this.length-A.length,T=this.clone(),x=A,D=x.words[x.length-1]|0,k=this._countBits(D);S=26-k,S!==0&&(x=x.ushln(S),T.iushln(S),D=x.words[x.length-1]|0);var P=T.length-x.length,y;if(m!=="mod"){y=new s(null),y.length=P+1,y.words=new Array(y.length);for(var f=0;f<y.length;f++)y.words[f]=0}var R=T.clone()._ishlnsubmul(x,1,P);R.negative===0&&(T=R,y&&(y.words[P]=1));for(var B=P-1;B>=0;B--){var q=(T.words[x.length+B]|0)*67108864+(T.words[x.length+B-1]|0);for(q=Math.min(q/D|0,67108863),T._ishlnsubmul(x,q,B);T.negative!==0;)q--,T.negative=0,T._ishlnsubmul(x,1,B),T.isZero()||(T.negative^=1);y&&(y.words[B]=q)}return y&&y.strip(),T.strip(),m!=="div"&&S!==0&&T.iushrn(S),{div:y||null,mod:T}},s.prototype.divmod=function(A,m,S){if(n(!A.isZero()),this.isZero())return{div:new s(0),mod:new s(0)};var T,x,D;return this.negative!==0&&A.negative===0?(D=this.neg().divmod(A,m),m!=="mod"&&(T=D.div.neg()),m!=="div"&&(x=D.mod.neg(),S&&x.negative!==0&&x.iadd(A)),{div:T,mod:x}):this.negative===0&&A.negative!==0?(D=this.divmod(A.neg(),m),m!=="mod"&&(T=D.div.neg()),{div:T,mod:D.mod}):this.negative&A.negative?(D=this.neg().divmod(A.neg(),m),m!=="div"&&(x=D.mod.neg(),S&&x.negative!==0&&x.isub(A)),{div:D.div,mod:x}):A.length>this.length||this.cmp(A)<0?{div:new s(0),mod:this}:A.length===1?m==="div"?{div:this.divn(A.words[0]),mod:null}:m==="mod"?{div:null,mod:new s(this.modn(A.words[0]))}:{div:this.divn(A.words[0]),mod:new s(this.modn(A.words[0]))}:this._wordDiv(A,m)},s.prototype.div=function(A){return this.divmod(A,"div",!1).div},s.prototype.mod=function(A){return this.divmod(A,"mod",!1).mod},s.prototype.umod=function(A){return this.divmod(A,"mod",!0).mod},s.prototype.divRound=function(A){var m=this.divmod(A);if(m.mod.isZero())return m.div;var S=m.div.negative!==0?m.mod.isub(A):m.mod,T=A.ushrn(1),x=A.andln(1),D=S.cmp(T);return D<0||x===1&&D===0?m.div:m.div.negative!==0?m.div.isubn(1):m.div.iaddn(1)},s.prototype.modn=function(A){n(A<=67108863);for(var m=(1<<26)%A,S=0,T=this.length-1;T>=0;T--)S=(m*S+(this.words[T]|0))%A;return S},s.prototype.idivn=function(A){n(A<=67108863);for(var m=0,S=this.length-1;S>=0;S--){var T=(this.words[S]|0)+m*67108864;this.words[S]=T/A|0,m=T%A}return this.strip()},s.prototype.divn=function(A){return this.clone().idivn(A)},s.prototype.egcd=function(A){n(A.negative===0),n(!A.isZero());var m=this,S=A.clone();m.negative!==0?m=m.umod(A):m=m.clone();for(var T=new s(1),x=new s(0),D=new s(0),k=new s(1),P=0;m.isEven()&&S.isEven();)m.iushrn(1),S.iushrn(1),++P;for(var y=S.clone(),f=m.clone();!m.isZero();){for(var R=0,B=1;!(m.words[0]&B)&&R<26;++R,B<<=1);if(R>0)for(m.iushrn(R);R-- >0;)(T.isOdd()||x.isOdd())&&(T.iadd(y),x.isub(f)),T.iushrn(1),x.iushrn(1);for(var q=0,F=1;!(S.words[0]&F)&&q<26;++q,F<<=1);if(q>0)for(S.iushrn(q);q-- >0;)(D.isOdd()||k.isOdd())&&(D.iadd(y),k.isub(f)),D.iushrn(1),k.iushrn(1);m.cmp(S)>=0?(m.isub(S),T.isub(D),x.isub(k)):(S.isub(m),D.isub(T),k.isub(x))}return{a:D,b:k,gcd:S.iushln(P)}},s.prototype._invmp=function(A){n(A.negative===0),n(!A.isZero());var m=this,S=A.clone();m.negative!==0?m=m.umod(A):m=m.clone();for(var T=new s(1),x=new s(0),D=S.clone();m.cmpn(1)>0&&S.cmpn(1)>0;){for(var k=0,P=1;!(m.words[0]&P)&&k<26;++k,P<<=1);if(k>0)for(m.iushrn(k);k-- >0;)T.isOdd()&&T.iadd(D),T.iushrn(1);for(var y=0,f=1;!(S.words[0]&f)&&y<26;++y,f<<=1);if(y>0)for(S.iushrn(y);y-- >0;)x.isOdd()&&x.iadd(D),x.iushrn(1);m.cmp(S)>=0?(m.isub(S),T.isub(x)):(S.isub(m),x.isub(T))}var R;return m.cmpn(1)===0?R=T:R=x,R.cmpn(0)<0&&R.iadd(A),R},s.prototype.gcd=function(A){if(this.isZero())return A.abs();if(A.isZero())return this.abs();var m=this.clone(),S=A.clone();m.negative=0,S.negative=0;for(var T=0;m.isEven()&&S.isEven();T++)m.iushrn(1),S.iushrn(1);do{for(;m.isEven();)m.iushrn(1);for(;S.isEven();)S.iushrn(1);var x=m.cmp(S);if(x<0){var D=m;m=S,S=D}else if(x===0||S.cmpn(1)===0)break;m.isub(S)}while(!0);return S.iushln(T)},s.prototype.invm=function(A){return this.egcd(A).a.umod(A)},s.prototype.isEven=function(){return(this.words[0]&1)===0},s.prototype.isOdd=function(){return(this.words[0]&1)===1},s.prototype.andln=function(A){return this.words[0]&A},s.prototype.bincn=function(A){n(typeof A=="number");var m=A%26,S=(A-m)/26,T=1<<m;if(this.length<=S)return this._expand(S+1),this.words[S]|=T,this;for(var x=T,D=S;x!==0&&D<this.length;D++){var k=this.words[D]|0;k+=x,x=k>>>26,k&=67108863,this.words[D]=k}return x!==0&&(this.words[D]=x,this.length++),this},s.prototype.isZero=function(){return this.length===1&&this.words[0]===0},s.prototype.cmpn=function(A){var m=A<0;if(this.negative!==0&&!m)return-1;if(this.negative===0&&m)return 1;this.strip();var S;if(this.length>1)S=1;else{m&&(A=-A),n(A<=67108863,"Number is too big");var T=this.words[0]|0;S=T===A?0:T<A?-1:1}return this.negative!==0?-S|0:S},s.prototype.cmp=function(A){if(this.negative!==0&&A.negative===0)return-1;if(this.negative===0&&A.negative!==0)return 1;var m=this.ucmp(A);return this.negative!==0?-m|0:m},s.prototype.ucmp=function(A){if(this.length>A.length)return 1;if(this.length<A.length)return-1;for(var m=0,S=this.length-1;S>=0;S--){var T=this.words[S]|0,x=A.words[S]|0;if(T!==x){T<x?m=-1:T>x&&(m=1);break}}return m},s.prototype.gtn=function(A){return this.cmpn(A)===1},s.prototype.gt=function(A){return this.cmp(A)===1},s.prototype.gten=function(A){return this.cmpn(A)>=0},s.prototype.gte=function(A){return this.cmp(A)>=0},s.prototype.ltn=function(A){return this.cmpn(A)===-1},s.prototype.lt=function(A){return this.cmp(A)===-1},s.prototype.lten=function(A){return this.cmpn(A)<=0},s.prototype.lte=function(A){return this.cmp(A)<=0},s.prototype.eqn=function(A){return this.cmpn(A)===0},s.prototype.eq=function(A){return this.cmp(A)===0},s.red=function(A){return new z(A)},s.prototype.toRed=function(A){return n(!this.red,"Already a number in reduction context"),n(this.negative===0,"red works only with positives"),A.convertTo(this)._forceRed(A)},s.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(A){return this.red=A,this},s.prototype.forceRed=function(A){return n(!this.red,"Already a number in reduction context"),this._forceRed(A)},s.prototype.redAdd=function(A){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,A)},s.prototype.redIAdd=function(A){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,A)},s.prototype.redSub=function(A){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,A)},s.prototype.redISub=function(A){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,A)},s.prototype.redShl=function(A){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,A)},s.prototype.redMul=function(A){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,A),this.red.mul(this,A)},s.prototype.redIMul=function(A){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,A),this.red.imul(this,A)},s.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(A){return n(this.red&&!A.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,A)};var I={k256:null,p224:null,p192:null,p25519:null};function N(H,A){this.name=H,this.p=new s(A,16),this.n=this.p.bitLength(),this.k=new s(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}N.prototype._tmp=function(){var A=new s(null);return A.words=new Array(Math.ceil(this.n/13)),A},N.prototype.ireduce=function(A){var m=A,S;do this.split(m,this.tmp),m=this.imulK(m),m=m.iadd(this.tmp),S=m.bitLength();while(S>this.n);var T=S<this.n?-1:m.ucmp(this.p);return T===0?(m.words[0]=0,m.length=1):T>0?m.isub(this.p):m.strip!==void 0?m.strip():m._strip(),m},N.prototype.split=function(A,m){A.iushrn(this.n,0,m)},N.prototype.imulK=function(A){return A.imul(this.k)};function L(){N.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}i(L,N),L.prototype.split=function(A,m){for(var S=4194303,T=Math.min(A.length,9),x=0;x<T;x++)m.words[x]=A.words[x];if(m.length=T,A.length<=9){A.words[0]=0,A.length=1;return}var D=A.words[9];for(m.words[m.length++]=D&S,x=10;x<A.length;x++){var k=A.words[x]|0;A.words[x-10]=(k&S)<<4|D>>>22,D=k}D>>>=22,A.words[x-10]=D,D===0&&A.length>10?A.length-=10:A.length-=9},L.prototype.imulK=function(A){A.words[A.length]=0,A.words[A.length+1]=0,A.length+=2;for(var m=0,S=0;S<A.length;S++){var T=A.words[S]|0;m+=T*977,A.words[S]=m&67108863,m=T*64+(m/67108864|0)}return A.words[A.length-1]===0&&(A.length--,A.words[A.length-1]===0&&A.length--),A};function U(){N.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}i(U,N);function w(){N.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}i(w,N);function V(){N.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}i(V,N),V.prototype.imulK=function(A){for(var m=0,S=0;S<A.length;S++){var T=(A.words[S]|0)*19+m,x=T&67108863;T>>>=26,A.words[S]=x,m=T}return m!==0&&(A.words[A.length++]=m),A},s._prime=function(A){if(I[A])return I[A];var m;if(A==="k256")m=new L;else if(A==="p224")m=new U;else if(A==="p192")m=new w;else if(A==="p25519")m=new V;else throw new Error("Unknown prime "+A);return I[A]=m,m};function z(H){if(typeof H=="string"){var A=s._prime(H);this.m=A.p,this.prime=A}else n(H.gtn(1),"modulus must be greater than 1"),this.m=H,this.prime=null}z.prototype._verify1=function(A){n(A.negative===0,"red works only with positives"),n(A.red,"red works only with red numbers")},z.prototype._verify2=function(A,m){n((A.negative|m.negative)===0,"red works only with positives"),n(A.red&&A.red===m.red,"red works only with red numbers")},z.prototype.imod=function(A){return this.prime?this.prime.ireduce(A)._forceRed(this):A.umod(this.m)._forceRed(this)},z.prototype.neg=function(A){return A.isZero()?A.clone():this.m.sub(A)._forceRed(this)},z.prototype.add=function(A,m){this._verify2(A,m);var S=A.add(m);return S.cmp(this.m)>=0&&S.isub(this.m),S._forceRed(this)},z.prototype.iadd=function(A,m){this._verify2(A,m);var S=A.iadd(m);return S.cmp(this.m)>=0&&S.isub(this.m),S},z.prototype.sub=function(A,m){this._verify2(A,m);var S=A.sub(m);return S.cmpn(0)<0&&S.iadd(this.m),S._forceRed(this)},z.prototype.isub=function(A,m){this._verify2(A,m);var S=A.isub(m);return S.cmpn(0)<0&&S.iadd(this.m),S},z.prototype.shl=function(A,m){return this._verify1(A),this.imod(A.ushln(m))},z.prototype.imul=function(A,m){return this._verify2(A,m),this.imod(A.imul(m))},z.prototype.mul=function(A,m){return this._verify2(A,m),this.imod(A.mul(m))},z.prototype.isqr=function(A){return this.imul(A,A.clone())},z.prototype.sqr=function(A){return this.mul(A,A)},z.prototype.sqrt=function(A){if(A.isZero())return A.clone();var m=this.m.andln(3);if(n(m%2===1),m===3){var S=this.m.add(new s(1)).iushrn(2);return this.pow(A,S)}for(var T=this.m.subn(1),x=0;!T.isZero()&&T.andln(1)===0;)x++,T.iushrn(1);n(!T.isZero());var D=new s(1).toRed(this),k=D.redNeg(),P=this.m.subn(1).iushrn(1),y=this.m.bitLength();for(y=new s(2*y*y).toRed(this);this.pow(y,P).cmp(k)!==0;)y.redIAdd(k);for(var f=this.pow(y,T),R=this.pow(A,T.addn(1).iushrn(1)),B=this.pow(A,T),q=x;B.cmp(D)!==0;){for(var F=B,te=0;F.cmp(D)!==0;te++)F=F.redSqr();n(te<q);var G=this.pow(f,new s(1).iushln(q-te-1));R=R.redMul(G),f=G.redSqr(),B=B.redMul(f),q=te}return R},z.prototype.invm=function(A){var m=A._invmp(this.m);return m.negative!==0?(m.negative=0,this.imod(m).redNeg()):this.imod(m)},z.prototype.pow=function(A,m){if(m.isZero())return new s(1).toRed(this);if(m.cmpn(1)===0)return A.clone();var S=4,T=new Array(1<<S);T[0]=new s(1).toRed(this),T[1]=A;for(var x=2;x<T.length;x++)T[x]=this.mul(T[x-1],A);var D=T[0],k=0,P=0,y=m.bitLength()%26;for(y===0&&(y=26),x=m.length-1;x>=0;x--){for(var f=m.words[x],R=y-1;R>=0;R--){var B=f>>R&1;if(D!==T[0]&&(D=this.sqr(D)),B===0&&k===0){P=0;continue}k<<=1,k|=B,P++,!(P!==S&&(x!==0||R!==0))&&(D=this.mul(D,T[k]),P=0,k=0)}y=26}return D},z.prototype.convertTo=function(A){var m=A.umod(this.m);return m===A?m.clone():m},z.prototype.convertFrom=function(A){var m=A.clone();return m.red=null,m},s.mont=function(A){return new K(A)};function K(H){z.call(this,H),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new s(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}i(K,z),K.prototype.convertTo=function(A){return this.imod(A.ushln(this.shift))},K.prototype.convertFrom=function(A){var m=this.imod(A.mul(this.rinv));return m.red=null,m},K.prototype.imul=function(A,m){if(A.isZero()||m.isZero())return A.words[0]=0,A.length=1,A;var S=A.imul(m),T=S.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),x=S.isub(T).iushrn(this.shift),D=x;return x.cmp(this.m)>=0?D=x.isub(this.m):x.cmpn(0)<0&&(D=x.iadd(this.m)),D._forceRed(this)},K.prototype.mul=function(A,m){if(A.isZero()||m.isZero())return new s(0)._forceRed(this);var S=A.mul(m),T=S.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),x=S.isub(T).iushrn(this.shift),D=x;return x.cmp(this.m)>=0?D=x.isub(this.m):x.cmpn(0)<0&&(D=x.iadd(this.m)),D._forceRed(this)},K.prototype.invm=function(A){var m=this.imod(A._invmp(this.m).mul(this.r2));return m._forceRed(this)}})(e,sc)})(bP);var Il=bP.exports,SP={};(function(e){var t=e;function r(s,o){if(Array.isArray(s))return s.slice();if(!s)return[];var a=[];if(typeof s!="string"){for(var c=0;c<s.length;c++)a[c]=s[c]|0;return a}if(o==="hex"){s=s.replace(/[^a-z0-9]+/ig,""),s.length%2!==0&&(s="0"+s);for(var c=0;c<s.length;c+=2)a.push(parseInt(s[c]+s[c+1],16))}else for(var c=0;c<s.length;c++){var d=s.charCodeAt(c),l=d>>8,u=d&255;l?a.push(l,u):a.push(u)}return a}t.toArray=r;function n(s){return s.length===1?"0"+s:s}t.zero2=n;function i(s){for(var o="",a=0;a<s.length;a++)o+=n(s[a].toString(16));return o}t.toHex=i,t.encode=function(o,a){return a==="hex"?i(o):o}})(SP);(function(e){var t=e,r=Il,n=xf,i=SP;t.assert=n,t.toArray=i.toArray,t.zero2=i.zero2,t.toHex=i.toHex,t.encode=i.encode;function s(l,u,h){var p=new Array(Math.max(l.bitLength(),h)+1),_;for(_=0;_<p.length;_+=1)p[_]=0;var g=1<<u+1,E=l.clone();for(_=0;_<p.length;_++){var b,v=E.andln(g-1);E.isOdd()?(v>(g>>1)-1?b=(g>>1)-v:b=v,E.isubn(b)):b=0,p[_]=b,E.iushrn(1)}return p}t.getNAF=s;function o(l,u){var h=[[],[]];l=l.clone(),u=u.clone();for(var p=0,_=0,g;l.cmpn(-p)>0||u.cmpn(-_)>0;){var E=l.andln(3)+p&3,b=u.andln(3)+_&3;E===3&&(E=-1),b===3&&(b=-1);var v;E&1?(g=l.andln(7)+p&7,(g===3||g===5)&&b===2?v=-E:v=E):v=0,h[0].push(v);var I;b&1?(g=u.andln(7)+_&7,(g===3||g===5)&&E===2?I=-b:I=b):I=0,h[1].push(I),2*p===v+1&&(p=1-p),2*_===I+1&&(_=1-_),l.iushrn(1),u.iushrn(1)}return h}t.getJSF=o;function a(l,u,h){var p="_"+u;l.prototype[u]=function(){return this[p]!==void 0?this[p]:this[p]=h.call(this)}}t.cachedProperty=a;function c(l){return typeof l=="string"?t.toArray(l,"hex"):l}t.parseBytes=c;function d(l){return new r(l,"hex","le")}t.intFromLE=d})(Go);var wP={exports:{}},FR;wP.exports=function(t){return FR||(FR=new hu(null)),FR.generate(t)};function hu(e){this.rand=e}wP.exports.Rand=hu;hu.prototype.generate=function(t){return this._rand(t)};hu.prototype._rand=function(t){if(this.rand.getBytes)return this.rand.getBytes(t);for(var r=new Uint8Array(t),n=0;n<r.length;n++)r[n]=this.rand.getByte();return r};if(typeof self=="object")self.crypto&&self.crypto.getRandomValues?hu.prototype._rand=function(t){var r=new Uint8Array(t);return self.crypto.getRandomValues(r),r}:self.msCrypto&&self.msCrypto.getRandomValues?hu.prototype._rand=function(t){var r=new Uint8Array(t);return self.msCrypto.getRandomValues(r),r}:typeof window=="object"&&(hu.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var y6=JD;if(typeof y6.randomBytes!="function")throw new Error("Not supported");hu.prototype._rand=function(t){return y6.randomBytes(t)}}catch{}var EG=wP.exports,TP={},fh=Il,YE=Go,Q1=YE.getNAF,Xve=YE.getJSF,Z1=YE.assert;function Xu(e,t){this.type=e,this.p=new fh(t.p,16),this.red=t.prime?fh.red(t.prime):fh.mont(this.p),this.zero=new fh(0).toRed(this.red),this.one=new fh(1).toRed(this.red),this.two=new fh(2).toRed(this.red),this.n=t.n&&new fh(t.n,16),this.g=t.g&&this.pointFromJSON(t.g,t.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var r=this.n&&this.p.div(this.n);!r||r.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}var Rw=Xu;Xu.prototype.point=function(){throw new Error("Not implemented")};Xu.prototype.validate=function(){throw new Error("Not implemented")};Xu.prototype._fixedNafMul=function(t,r){Z1(t.precomputed);var n=t._getDoubles(),i=Q1(r,1,this._bitLength),s=(1<<n.step+1)-(n.step%2===0?2:1);s/=3;var o=[],a,c;for(a=0;a<i.length;a+=n.step){c=0;for(var d=a+n.step-1;d>=a;d--)c=(c<<1)+i[d];o.push(c)}for(var l=this.jpoint(null,null,null),u=this.jpoint(null,null,null),h=s;h>0;h--){for(a=0;a<o.length;a++)c=o[a],c===h?u=u.mixedAdd(n.points[a]):c===-h&&(u=u.mixedAdd(n.points[a].neg()));l=l.add(u)}return l.toP()};Xu.prototype._wnafMul=function(t,r){var n=4,i=t._getNAFPoints(n);n=i.wnd;for(var s=i.points,o=Q1(r,n,this._bitLength),a=this.jpoint(null,null,null),c=o.length-1;c>=0;c--){for(var d=0;c>=0&&o[c]===0;c--)d++;if(c>=0&&d++,a=a.dblp(d),c<0)break;var l=o[c];Z1(l!==0),t.type==="affine"?l>0?a=a.mixedAdd(s[l-1>>1]):a=a.mixedAdd(s[-l-1>>1].neg()):l>0?a=a.add(s[l-1>>1]):a=a.add(s[-l-1>>1].neg())}return t.type==="affine"?a.toP():a};Xu.prototype._wnafMulAdd=function(t,r,n,i,s){var o=this._wnafT1,a=this._wnafT2,c=this._wnafT3,d=0,l,u,h;for(l=0;l<i;l++){h=r[l];var p=h._getNAFPoints(t);o[l]=p.wnd,a[l]=p.points}for(l=i-1;l>=1;l-=2){var _=l-1,g=l;if(o[_]!==1||o[g]!==1){c[_]=Q1(n[_],o[_],this._bitLength),c[g]=Q1(n[g],o[g],this._bitLength),d=Math.max(c[_].length,d),d=Math.max(c[g].length,d);continue}var E=[r[_],null,null,r[g]];r[_].y.cmp(r[g].y)===0?(E[1]=r[_].add(r[g]),E[2]=r[_].toJ().mixedAdd(r[g].neg())):r[_].y.cmp(r[g].y.redNeg())===0?(E[1]=r[_].toJ().mixedAdd(r[g]),E[2]=r[_].add(r[g].neg())):(E[1]=r[_].toJ().mixedAdd(r[g]),E[2]=r[_].toJ().mixedAdd(r[g].neg()));var b=[-3,-1,-5,-7,0,7,5,1,3],v=Xve(n[_],n[g]);for(d=Math.max(v[0].length,d),c[_]=new Array(d),c[g]=new Array(d),u=0;u<d;u++){var I=v[0][u]|0,N=v[1][u]|0;c[_][u]=b[(I+1)*3+(N+1)],c[g][u]=0,a[_]=E}}var L=this.jpoint(null,null,null),U=this._wnafT4;for(l=d;l>=0;l--){for(var w=0;l>=0;){var V=!0;for(u=0;u<i;u++)U[u]=c[u][l]|0,U[u]!==0&&(V=!1);if(!V)break;w++,l--}if(l>=0&&w++,L=L.dblp(w),l<0)break;for(u=0;u<i;u++){var z=U[u];z!==0&&(z>0?h=a[u][z-1>>1]:z<0&&(h=a[u][-z-1>>1].neg()),h.type==="affine"?L=L.mixedAdd(h):L=L.add(h))}}for(l=0;l<i;l++)a[l]=null;return s?L:L.toP()};function xa(e,t){this.curve=e,this.type=t,this.precomputed=null}Xu.BasePoint=xa;xa.prototype.eq=function(){throw new Error("Not implemented")};xa.prototype.validate=function(){return this.curve.validate(this)};Xu.prototype.decodePoint=function(t,r){t=YE.toArray(t,r);var n=this.p.byteLength();if((t[0]===4||t[0]===6||t[0]===7)&&t.length-1===2*n){t[0]===6?Z1(t[t.length-1]%2===0):t[0]===7&&Z1(t[t.length-1]%2===1);var i=this.point(t.slice(1,1+n),t.slice(1+n,1+2*n));return i}else if((t[0]===2||t[0]===3)&&t.length-1===n)return this.pointFromX(t.slice(1,1+n),t[0]===3);throw new Error("Unknown point format")};xa.prototype.encodeCompressed=function(t){return this.encode(t,!0)};xa.prototype._encode=function(t){var r=this.curve.p.byteLength(),n=this.getX().toArray("be",r);return t?[this.getY().isEven()?2:3].concat(n):[4].concat(n,this.getY().toArray("be",r))};xa.prototype.encode=function(t,r){return YE.encode(this._encode(r),t)};xa.prototype.precompute=function(t){if(this.precomputed)return this;var r={doubles:null,naf:null,beta:null};return r.naf=this._getNAFPoints(8),r.doubles=this._getDoubles(4,t),r.beta=this._getBeta(),this.precomputed=r,this};xa.prototype._hasDoubles=function(t){if(!this.precomputed)return!1;var r=this.precomputed.doubles;return r?r.points.length>=Math.ceil((t.bitLength()+1)/r.step):!1};xa.prototype._getDoubles=function(t,r){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var n=[this],i=this,s=0;s<r;s+=t){for(var o=0;o<t;o++)i=i.dbl();n.push(i)}return{step:t,points:n}};xa.prototype._getNAFPoints=function(t){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var r=[this],n=(1<<t)-1,i=n===1?null:this.dbl(),s=1;s<n;s++)r[s]=r[s-1].add(i);return{wnd:t,points:r}};xa.prototype._getBeta=function(){return null};xa.prototype.dblp=function(t){for(var r=this,n=0;n<t;n++)r=r.dbl();return r};var Qve=Go,Fn=Il,RP=ww,m0=Rw,Zve=Qve.assert;function Ma(e){m0.call(this,"short",e),this.a=new Fn(e.a,16).toRed(this.red),this.b=new Fn(e.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=this.a.fromRed().cmpn(0)===0,this.threeA=this.a.fromRed().sub(this.p).cmpn(-3)===0,this.endo=this._getEndomorphism(e),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}RP(Ma,m0);var eye=Ma;Ma.prototype._getEndomorphism=function(t){if(!(!this.zeroA||!this.g||!this.n||this.p.modn(3)!==1)){var r,n;if(t.beta)r=new Fn(t.beta,16).toRed(this.red);else{var i=this._getEndoRoots(this.p);r=i[0].cmp(i[1])<0?i[0]:i[1],r=r.toRed(this.red)}if(t.lambda)n=new Fn(t.lambda,16);else{var s=this._getEndoRoots(this.n);this.g.mul(s[0]).x.cmp(this.g.x.redMul(r))===0?n=s[0]:(n=s[1],Zve(this.g.mul(n).x.cmp(this.g.x.redMul(r))===0))}var o;return t.basis?o=t.basis.map(function(a){return{a:new Fn(a.a,16),b:new Fn(a.b,16)}}):o=this._getEndoBasis(n),{beta:r,lambda:n,basis:o}}};Ma.prototype._getEndoRoots=function(t){var r=t===this.p?this.red:Fn.mont(t),n=new Fn(2).toRed(r).redInvm(),i=n.redNeg(),s=new Fn(3).toRed(r).redNeg().redSqrt().redMul(n),o=i.redAdd(s).fromRed(),a=i.redSub(s).fromRed();return[o,a]};Ma.prototype._getEndoBasis=function(t){for(var r=this.n.ushrn(Math.floor(this.n.bitLength()/2)),n=t,i=this.n.clone(),s=new Fn(1),o=new Fn(0),a=new Fn(0),c=new Fn(1),d,l,u,h,p,_,g,E=0,b,v;n.cmpn(0)!==0;){var I=i.div(n);b=i.sub(I.mul(n)),v=a.sub(I.mul(s));var N=c.sub(I.mul(o));if(!u&&b.cmp(r)<0)d=g.neg(),l=s,u=b.neg(),h=v;else if(u&&++E===2)break;g=b,i=n,n=b,a=s,s=v,c=o,o=N}p=b.neg(),_=v;var L=u.sqr().add(h.sqr()),U=p.sqr().add(_.sqr());return U.cmp(L)>=0&&(p=d,_=l),u.negative&&(u=u.neg(),h=h.neg()),p.negative&&(p=p.neg(),_=_.neg()),[{a:u,b:h},{a:p,b:_}]};Ma.prototype._endoSplit=function(t){var r=this.endo.basis,n=r[0],i=r[1],s=i.b.mul(t).divRound(this.n),o=n.b.neg().mul(t).divRound(this.n),a=s.mul(n.a),c=o.mul(i.a),d=s.mul(n.b),l=o.mul(i.b),u=t.sub(a).sub(c),h=d.add(l).neg();return{k1:u,k2:h}};Ma.prototype.pointFromX=function(t,r){t=new Fn(t,16),t.red||(t=t.toRed(this.red));var n=t.redSqr().redMul(t).redIAdd(t.redMul(this.a)).redIAdd(this.b),i=n.redSqrt();if(i.redSqr().redSub(n).cmp(this.zero)!==0)throw new Error("invalid point");var s=i.fromRed().isOdd();return(r&&!s||!r&&s)&&(i=i.redNeg()),this.point(t,i)};Ma.prototype.validate=function(t){if(t.inf)return!0;var r=t.x,n=t.y,i=this.a.redMul(r),s=r.redSqr().redMul(r).redIAdd(i).redIAdd(this.b);return n.redSqr().redISub(s).cmpn(0)===0};Ma.prototype._endoWnafMulAdd=function(t,r,n){for(var i=this._endoWnafT1,s=this._endoWnafT2,o=0;o<t.length;o++){var a=this._endoSplit(r[o]),c=t[o],d=c._getBeta();a.k1.negative&&(a.k1.ineg(),c=c.neg(!0)),a.k2.negative&&(a.k2.ineg(),d=d.neg(!0)),i[o*2]=c,i[o*2+1]=d,s[o*2]=a.k1,s[o*2+1]=a.k2}for(var l=this._wnafMulAdd(1,i,s,o*2,n),u=0;u<o*2;u++)i[u]=null,s[u]=null;return l};function Pi(e,t,r,n){m0.BasePoint.call(this,e,"affine"),t===null&&r===null?(this.x=null,this.y=null,this.inf=!0):(this.x=new Fn(t,16),this.y=new Fn(r,16),n&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}RP(Pi,m0.BasePoint);Ma.prototype.point=function(t,r,n){return new Pi(this,t,r,n)};Ma.prototype.pointFromJSON=function(t,r){return Pi.fromJSON(this,t,r)};Pi.prototype._getBeta=function(){if(this.curve.endo){var t=this.precomputed;if(t&&t.beta)return t.beta;var r=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(t){var n=this.curve,i=function(s){return n.point(s.x.redMul(n.endo.beta),s.y)};t.beta=r,r.precomputed={beta:null,naf:t.naf&&{wnd:t.naf.wnd,points:t.naf.points.map(i)},doubles:t.doubles&&{step:t.doubles.step,points:t.doubles.points.map(i)}}}return r}};Pi.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]};Pi.fromJSON=function(t,r,n){typeof r=="string"&&(r=JSON.parse(r));var i=t.point(r[0],r[1],n);if(!r[2])return i;function s(a){return t.point(a[0],a[1],n)}var o=r[2];return i.precomputed={beta:null,doubles:o.doubles&&{step:o.doubles.step,points:[i].concat(o.doubles.points.map(s))},naf:o.naf&&{wnd:o.naf.wnd,points:[i].concat(o.naf.points.map(s))}},i};Pi.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"};Pi.prototype.isInfinity=function(){return this.inf};Pi.prototype.add=function(t){if(this.inf)return t;if(t.inf)return this;if(this.eq(t))return this.dbl();if(this.neg().eq(t))return this.curve.point(null,null);if(this.x.cmp(t.x)===0)return this.curve.point(null,null);var r=this.y.redSub(t.y);r.cmpn(0)!==0&&(r=r.redMul(this.x.redSub(t.x).redInvm()));var n=r.redSqr().redISub(this.x).redISub(t.x),i=r.redMul(this.x.redSub(n)).redISub(this.y);return this.curve.point(n,i)};Pi.prototype.dbl=function(){if(this.inf)return this;var t=this.y.redAdd(this.y);if(t.cmpn(0)===0)return this.curve.point(null,null);var r=this.curve.a,n=this.x.redSqr(),i=t.redInvm(),s=n.redAdd(n).redIAdd(n).redIAdd(r).redMul(i),o=s.redSqr().redISub(this.x.redAdd(this.x)),a=s.redMul(this.x.redSub(o)).redISub(this.y);return this.curve.point(o,a)};Pi.prototype.getX=function(){return this.x.fromRed()};Pi.prototype.getY=function(){return this.y.fromRed()};Pi.prototype.mul=function(t){return t=new Fn(t,16),this.isInfinity()?this:this._hasDoubles(t)?this.curve._fixedNafMul(this,t):this.curve.endo?this.curve._endoWnafMulAdd([this],[t]):this.curve._wnafMul(this,t)};Pi.prototype.mulAdd=function(t,r,n){var i=[this,r],s=[t,n];return this.curve.endo?this.curve._endoWnafMulAdd(i,s):this.curve._wnafMulAdd(1,i,s,2)};Pi.prototype.jmulAdd=function(t,r,n){var i=[this,r],s=[t,n];return this.curve.endo?this.curve._endoWnafMulAdd(i,s,!0):this.curve._wnafMulAdd(1,i,s,2,!0)};Pi.prototype.eq=function(t){return this===t||this.inf===t.inf&&(this.inf||this.x.cmp(t.x)===0&&this.y.cmp(t.y)===0)};Pi.prototype.neg=function(t){if(this.inf)return this;var r=this.curve.point(this.x,this.y.redNeg());if(t&&this.precomputed){var n=this.precomputed,i=function(s){return s.neg()};r.precomputed={naf:n.naf&&{wnd:n.naf.wnd,points:n.naf.points.map(i)},doubles:n.doubles&&{step:n.doubles.step,points:n.doubles.points.map(i)}}}return r};Pi.prototype.toJ=function(){if(this.inf)return this.curve.jpoint(null,null,null);var t=this.curve.jpoint(this.x,this.y,this.curve.one);return t};function Gi(e,t,r,n){m0.BasePoint.call(this,e,"jacobian"),t===null&&r===null&&n===null?(this.x=this.curve.one,this.y=this.curve.one,this.z=new Fn(0)):(this.x=new Fn(t,16),this.y=new Fn(r,16),this.z=new Fn(n,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}RP(Gi,m0.BasePoint);Ma.prototype.jpoint=function(t,r,n){return new Gi(this,t,r,n)};Gi.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var t=this.z.redInvm(),r=t.redSqr(),n=this.x.redMul(r),i=this.y.redMul(r).redMul(t);return this.curve.point(n,i)};Gi.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)};Gi.prototype.add=function(t){if(this.isInfinity())return t;if(t.isInfinity())return this;var r=t.z.redSqr(),n=this.z.redSqr(),i=this.x.redMul(r),s=t.x.redMul(n),o=this.y.redMul(r.redMul(t.z)),a=t.y.redMul(n.redMul(this.z)),c=i.redSub(s),d=o.redSub(a);if(c.cmpn(0)===0)return d.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var l=c.redSqr(),u=l.redMul(c),h=i.redMul(l),p=d.redSqr().redIAdd(u).redISub(h).redISub(h),_=d.redMul(h.redISub(p)).redISub(o.redMul(u)),g=this.z.redMul(t.z).redMul(c);return this.curve.jpoint(p,_,g)};Gi.prototype.mixedAdd=function(t){if(this.isInfinity())return t.toJ();if(t.isInfinity())return this;var r=this.z.redSqr(),n=this.x,i=t.x.redMul(r),s=this.y,o=t.y.redMul(r).redMul(this.z),a=n.redSub(i),c=s.redSub(o);if(a.cmpn(0)===0)return c.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var d=a.redSqr(),l=d.redMul(a),u=n.redMul(d),h=c.redSqr().redIAdd(l).redISub(u).redISub(u),p=c.redMul(u.redISub(h)).redISub(s.redMul(l)),_=this.z.redMul(a);return this.curve.jpoint(h,p,_)};Gi.prototype.dblp=function(t){if(t===0)return this;if(this.isInfinity())return this;if(!t)return this.dbl();var r;if(this.curve.zeroA||this.curve.threeA){var n=this;for(r=0;r<t;r++)n=n.dbl();return n}var i=this.curve.a,s=this.curve.tinv,o=this.x,a=this.y,c=this.z,d=c.redSqr().redSqr(),l=a.redAdd(a);for(r=0;r<t;r++){var u=o.redSqr(),h=l.redSqr(),p=h.redSqr(),_=u.redAdd(u).redIAdd(u).redIAdd(i.redMul(d)),g=o.redMul(h),E=_.redSqr().redISub(g.redAdd(g)),b=g.redISub(E),v=_.redMul(b);v=v.redIAdd(v).redISub(p);var I=l.redMul(c);r+1<t&&(d=d.redMul(p)),o=E,c=I,l=v}return this.curve.jpoint(o,l.redMul(s),c)};Gi.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()};Gi.prototype._zeroDbl=function(){var t,r,n;if(this.zOne){var i=this.x.redSqr(),s=this.y.redSqr(),o=s.redSqr(),a=this.x.redAdd(s).redSqr().redISub(i).redISub(o);a=a.redIAdd(a);var c=i.redAdd(i).redIAdd(i),d=c.redSqr().redISub(a).redISub(a),l=o.redIAdd(o);l=l.redIAdd(l),l=l.redIAdd(l),t=d,r=c.redMul(a.redISub(d)).redISub(l),n=this.y.redAdd(this.y)}else{var u=this.x.redSqr(),h=this.y.redSqr(),p=h.redSqr(),_=this.x.redAdd(h).redSqr().redISub(u).redISub(p);_=_.redIAdd(_);var g=u.redAdd(u).redIAdd(u),E=g.redSqr(),b=p.redIAdd(p);b=b.redIAdd(b),b=b.redIAdd(b),t=E.redISub(_).redISub(_),r=g.redMul(_.redISub(t)).redISub(b),n=this.y.redMul(this.z),n=n.redIAdd(n)}return this.curve.jpoint(t,r,n)};Gi.prototype._threeDbl=function(){var t,r,n;if(this.zOne){var i=this.x.redSqr(),s=this.y.redSqr(),o=s.redSqr(),a=this.x.redAdd(s).redSqr().redISub(i).redISub(o);a=a.redIAdd(a);var c=i.redAdd(i).redIAdd(i).redIAdd(this.curve.a),d=c.redSqr().redISub(a).redISub(a);t=d;var l=o.redIAdd(o);l=l.redIAdd(l),l=l.redIAdd(l),r=c.redMul(a.redISub(d)).redISub(l),n=this.y.redAdd(this.y)}else{var u=this.z.redSqr(),h=this.y.redSqr(),p=this.x.redMul(h),_=this.x.redSub(u).redMul(this.x.redAdd(u));_=_.redAdd(_).redIAdd(_);var g=p.redIAdd(p);g=g.redIAdd(g);var E=g.redAdd(g);t=_.redSqr().redISub(E),n=this.y.redAdd(this.z).redSqr().redISub(h).redISub(u);var b=h.redSqr();b=b.redIAdd(b),b=b.redIAdd(b),b=b.redIAdd(b),r=_.redMul(g.redISub(t)).redISub(b)}return this.curve.jpoint(t,r,n)};Gi.prototype._dbl=function(){var t=this.curve.a,r=this.x,n=this.y,i=this.z,s=i.redSqr().redSqr(),o=r.redSqr(),a=n.redSqr(),c=o.redAdd(o).redIAdd(o).redIAdd(t.redMul(s)),d=r.redAdd(r);d=d.redIAdd(d);var l=d.redMul(a),u=c.redSqr().redISub(l.redAdd(l)),h=l.redISub(u),p=a.redSqr();p=p.redIAdd(p),p=p.redIAdd(p),p=p.redIAdd(p);var _=c.redMul(h).redISub(p),g=n.redAdd(n).redMul(i);return this.curve.jpoint(u,_,g)};Gi.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var t=this.x.redSqr(),r=this.y.redSqr(),n=this.z.redSqr(),i=r.redSqr(),s=t.redAdd(t).redIAdd(t),o=s.redSqr(),a=this.x.redAdd(r).redSqr().redISub(t).redISub(i);a=a.redIAdd(a),a=a.redAdd(a).redIAdd(a),a=a.redISub(o);var c=a.redSqr(),d=i.redIAdd(i);d=d.redIAdd(d),d=d.redIAdd(d),d=d.redIAdd(d);var l=s.redIAdd(a).redSqr().redISub(o).redISub(c).redISub(d),u=r.redMul(l);u=u.redIAdd(u),u=u.redIAdd(u);var h=this.x.redMul(c).redISub(u);h=h.redIAdd(h),h=h.redIAdd(h);var p=this.y.redMul(l.redMul(d.redISub(l)).redISub(a.redMul(c)));p=p.redIAdd(p),p=p.redIAdd(p),p=p.redIAdd(p);var _=this.z.redAdd(a).redSqr().redISub(n).redISub(c);return this.curve.jpoint(h,p,_)};Gi.prototype.mul=function(t,r){return t=new Fn(t,r),this.curve._wnafMul(this,t)};Gi.prototype.eq=function(t){if(t.type==="affine")return this.eq(t.toJ());if(this===t)return!0;var r=this.z.redSqr(),n=t.z.redSqr();if(this.x.redMul(n).redISub(t.x.redMul(r)).cmpn(0)!==0)return!1;var i=r.redMul(this.z),s=n.redMul(t.z);return this.y.redMul(s).redISub(t.y.redMul(i)).cmpn(0)===0};Gi.prototype.eqXToP=function(t){var r=this.z.redSqr(),n=t.toRed(this.curve.red).redMul(r);if(this.x.cmp(n)===0)return!0;for(var i=t.clone(),s=this.curve.redN.redMul(r);;){if(i.iadd(this.curve.n),i.cmp(this.curve.p)>=0)return!1;if(n.redIAdd(s),this.x.cmp(n)===0)return!0}};Gi.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"};Gi.prototype.isInfinity=function(){return this.z.cmpn(0)===0};var Fp=Il,vG=ww,Aw=Rw,tye=Go;function g0(e){Aw.call(this,"mont",e),this.a=new Fp(e.a,16).toRed(this.red),this.b=new Fp(e.b,16).toRed(this.red),this.i4=new Fp(4).toRed(this.red).redInvm(),this.two=new Fp(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}vG(g0,Aw);var rye=g0;g0.prototype.validate=function(t){var r=t.normalize().x,n=r.redSqr(),i=n.redMul(r).redAdd(n.redMul(this.a)).redAdd(r),s=i.redSqrt();return s.redSqr().cmp(i)===0};function Di(e,t,r){Aw.BasePoint.call(this,e,"projective"),t===null&&r===null?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new Fp(t,16),this.z=new Fp(r,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}vG(Di,Aw.BasePoint);g0.prototype.decodePoint=function(t,r){return this.point(tye.toArray(t,r),1)};g0.prototype.point=function(t,r){return new Di(this,t,r)};g0.prototype.pointFromJSON=function(t){return Di.fromJSON(this,t)};Di.prototype.precompute=function(){};Di.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())};Di.fromJSON=function(t,r){return new Di(t,r[0],r[1]||t.one)};Di.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"};Di.prototype.isInfinity=function(){return this.z.cmpn(0)===0};Di.prototype.dbl=function(){var t=this.x.redAdd(this.z),r=t.redSqr(),n=this.x.redSub(this.z),i=n.redSqr(),s=r.redSub(i),o=r.redMul(i),a=s.redMul(i.redAdd(this.curve.a24.redMul(s)));return this.curve.point(o,a)};Di.prototype.add=function(){throw new Error("Not supported on Montgomery curve")};Di.prototype.diffAdd=function(t,r){var n=this.x.redAdd(this.z),i=this.x.redSub(this.z),s=t.x.redAdd(t.z),o=t.x.redSub(t.z),a=o.redMul(n),c=s.redMul(i),d=r.z.redMul(a.redAdd(c).redSqr()),l=r.x.redMul(a.redISub(c).redSqr());return this.curve.point(d,l)};Di.prototype.mul=function(t){for(var r=t.clone(),n=this,i=this.curve.point(null,null),s=this,o=[];r.cmpn(0)!==0;r.iushrn(1))o.push(r.andln(1));for(var a=o.length-1;a>=0;a--)o[a]===0?(n=n.diffAdd(i,s),i=i.dbl()):(i=n.diffAdd(i,s),n=n.dbl());return i};Di.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")};Di.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")};Di.prototype.eq=function(t){return this.getX().cmp(t.getX())===0};Di.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this};Di.prototype.getX=function(){return this.normalize(),this.x.fromRed()};var nye=Go,fl=Il,yG=ww,Cw=Rw,iye=nye.assert;function Rd(e){this.twisted=(e.a|0)!==1,this.mOneA=this.twisted&&(e.a|0)===-1,this.extended=this.mOneA,Cw.call(this,"edwards",e),this.a=new fl(e.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new fl(e.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new fl(e.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),iye(!this.twisted||this.c.fromRed().cmpn(1)===0),this.oneC=(e.c|0)===1}yG(Rd,Cw);var sye=Rd;Rd.prototype._mulA=function(t){return this.mOneA?t.redNeg():this.a.redMul(t)};Rd.prototype._mulC=function(t){return this.oneC?t:this.c.redMul(t)};Rd.prototype.jpoint=function(t,r,n,i){return this.point(t,r,n,i)};Rd.prototype.pointFromX=function(t,r){t=new fl(t,16),t.red||(t=t.toRed(this.red));var n=t.redSqr(),i=this.c2.redSub(this.a.redMul(n)),s=this.one.redSub(this.c2.redMul(this.d).redMul(n)),o=i.redMul(s.redInvm()),a=o.redSqrt();if(a.redSqr().redSub(o).cmp(this.zero)!==0)throw new Error("invalid point");var c=a.fromRed().isOdd();return(r&&!c||!r&&c)&&(a=a.redNeg()),this.point(t,a)};Rd.prototype.pointFromY=function(t,r){t=new fl(t,16),t.red||(t=t.toRed(this.red));var n=t.redSqr(),i=n.redSub(this.c2),s=n.redMul(this.d).redMul(this.c2).redSub(this.a),o=i.redMul(s.redInvm());if(o.cmp(this.zero)===0){if(r)throw new Error("invalid point");return this.point(this.zero,t)}var a=o.redSqrt();if(a.redSqr().redSub(o).cmp(this.zero)!==0)throw new Error("invalid point");return a.fromRed().isOdd()!==r&&(a=a.redNeg()),this.point(a,t)};Rd.prototype.validate=function(t){if(t.isInfinity())return!0;t.normalize();var r=t.x.redSqr(),n=t.y.redSqr(),i=r.redMul(this.a).redAdd(n),s=this.c2.redMul(this.one.redAdd(this.d.redMul(r).redMul(n)));return i.cmp(s)===0};function on(e,t,r,n,i){Cw.BasePoint.call(this,e,"projective"),t===null&&r===null&&n===null?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new fl(t,16),this.y=new fl(r,16),this.z=n?new fl(n,16):this.curve.one,this.t=i&&new fl(i,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}yG(on,Cw.BasePoint);Rd.prototype.pointFromJSON=function(t){return on.fromJSON(this,t)};Rd.prototype.point=function(t,r,n,i){return new on(this,t,r,n,i)};on.fromJSON=function(t,r){return new on(t,r[0],r[1],r[2])};on.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"};on.prototype.isInfinity=function(){return this.x.cmpn(0)===0&&(this.y.cmp(this.z)===0||this.zOne&&this.y.cmp(this.curve.c)===0)};on.prototype._extDbl=function(){var t=this.x.redSqr(),r=this.y.redSqr(),n=this.z.redSqr();n=n.redIAdd(n);var i=this.curve._mulA(t),s=this.x.redAdd(this.y).redSqr().redISub(t).redISub(r),o=i.redAdd(r),a=o.redSub(n),c=i.redSub(r),d=s.redMul(a),l=o.redMul(c),u=s.redMul(c),h=a.redMul(o);return this.curve.point(d,l,h,u)};on.prototype._projDbl=function(){var t=this.x.redAdd(this.y).redSqr(),r=this.x.redSqr(),n=this.y.redSqr(),i,s,o,a,c,d;if(this.curve.twisted){a=this.curve._mulA(r);var l=a.redAdd(n);this.zOne?(i=t.redSub(r).redSub(n).redMul(l.redSub(this.curve.two)),s=l.redMul(a.redSub(n)),o=l.redSqr().redSub(l).redSub(l)):(c=this.z.redSqr(),d=l.redSub(c).redISub(c),i=t.redSub(r).redISub(n).redMul(d),s=l.redMul(a.redSub(n)),o=l.redMul(d))}else a=r.redAdd(n),c=this.curve._mulC(this.z).redSqr(),d=a.redSub(c).redSub(c),i=this.curve._mulC(t.redISub(a)).redMul(d),s=this.curve._mulC(a).redMul(r.redISub(n)),o=a.redMul(d);return this.curve.point(i,s,o)};on.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()};on.prototype._extAdd=function(t){var r=this.y.redSub(this.x).redMul(t.y.redSub(t.x)),n=this.y.redAdd(this.x).redMul(t.y.redAdd(t.x)),i=this.t.redMul(this.curve.dd).redMul(t.t),s=this.z.redMul(t.z.redAdd(t.z)),o=n.redSub(r),a=s.redSub(i),c=s.redAdd(i),d=n.redAdd(r),l=o.redMul(a),u=c.redMul(d),h=o.redMul(d),p=a.redMul(c);return this.curve.point(l,u,p,h)};on.prototype._projAdd=function(t){var r=this.z.redMul(t.z),n=r.redSqr(),i=this.x.redMul(t.x),s=this.y.redMul(t.y),o=this.curve.d.redMul(i).redMul(s),a=n.redSub(o),c=n.redAdd(o),d=this.x.redAdd(this.y).redMul(t.x.redAdd(t.y)).redISub(i).redISub(s),l=r.redMul(a).redMul(d),u,h;return this.curve.twisted?(u=r.redMul(c).redMul(s.redSub(this.curve._mulA(i))),h=a.redMul(c)):(u=r.redMul(c).redMul(s.redSub(i)),h=this.curve._mulC(a).redMul(c)),this.curve.point(l,u,h)};on.prototype.add=function(t){return this.isInfinity()?t:t.isInfinity()?this:this.curve.extended?this._extAdd(t):this._projAdd(t)};on.prototype.mul=function(t){return this._hasDoubles(t)?this.curve._fixedNafMul(this,t):this.curve._wnafMul(this,t)};on.prototype.mulAdd=function(t,r,n){return this.curve._wnafMulAdd(1,[this,r],[t,n],2,!1)};on.prototype.jmulAdd=function(t,r,n){return this.curve._wnafMulAdd(1,[this,r],[t,n],2,!0)};on.prototype.normalize=function(){if(this.zOne)return this;var t=this.z.redInvm();return this.x=this.x.redMul(t),this.y=this.y.redMul(t),this.t&&(this.t=this.t.redMul(t)),this.z=this.curve.one,this.zOne=!0,this};on.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())};on.prototype.getX=function(){return this.normalize(),this.x.fromRed()};on.prototype.getY=function(){return this.normalize(),this.y.fromRed()};on.prototype.eq=function(t){return this===t||this.getX().cmp(t.getX())===0&&this.getY().cmp(t.getY())===0};on.prototype.eqXToP=function(t){var r=t.toRed(this.curve.red).redMul(this.z);if(this.x.cmp(r)===0)return!0;for(var n=t.clone(),i=this.curve.redN.redMul(this.z);;){if(n.iadd(this.curve.n),n.cmp(this.curve.p)>=0)return!1;if(r.redIAdd(i),this.x.cmp(r)===0)return!0}};on.prototype.toP=on.prototype.normalize;on.prototype.mixedAdd=on.prototype.add;(function(e){var t=e;t.base=Rw,t.short=eye,t.mont=rye,t.edwards=sye})(TP);var Iw={},BR,b6;function oye(){return b6||(b6=1,BR={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}),BR}(function(e){var t=e,r=Sw,n=TP,i=Go,s=i.assert;function o(d){d.type==="short"?this.curve=new n.short(d):d.type==="edwards"?this.curve=new n.edwards(d):this.curve=new n.mont(d),this.g=this.curve.g,this.n=this.curve.n,this.hash=d.hash,s(this.g.validate(),"Invalid curve"),s(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}t.PresetCurve=o;function a(d,l){Object.defineProperty(t,d,{configurable:!0,enumerable:!0,get:function(){var u=new o(l);return Object.defineProperty(t,d,{configurable:!0,enumerable:!0,value:u}),u}})}a("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:r.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),a("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:r.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),a("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:r.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),a("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:r.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),a("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:r.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),a("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:r.sha256,gRed:!1,g:["9"]}),a("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:r.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});var c;try{c=oye()}catch{c=void 0}a("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:r.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",c]})})(Iw);var aye=Sw,ef=SP,bG=xf;function Vu(e){if(!(this instanceof Vu))return new Vu(e);this.hash=e.hash,this.predResist=!!e.predResist,this.outLen=this.hash.outSize,this.minEntropy=e.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var t=ef.toArray(e.entropy,e.entropyEnc||"hex"),r=ef.toArray(e.nonce,e.nonceEnc||"hex"),n=ef.toArray(e.pers,e.persEnc||"hex");bG(t.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(t,r,n)}var cye=Vu;Vu.prototype._init=function(t,r,n){var i=t.concat(r).concat(n);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var s=0;s<this.V.length;s++)this.K[s]=0,this.V[s]=1;this._update(i),this._reseed=1,this.reseedInterval=281474976710656};Vu.prototype._hmac=function(){return new aye.hmac(this.hash,this.K)};Vu.prototype._update=function(t){var r=this._hmac().update(this.V).update([0]);t&&(r=r.update(t)),this.K=r.digest(),this.V=this._hmac().update(this.V).digest(),t&&(this.K=this._hmac().update(this.V).update([1]).update(t).digest(),this.V=this._hmac().update(this.V).digest())};Vu.prototype.reseed=function(t,r,n,i){typeof r!="string"&&(i=n,n=r,r=null),t=ef.toArray(t,r),n=ef.toArray(n,i),bG(t.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(t.concat(n||[])),this._reseed=1};Vu.prototype.generate=function(t,r,n,i){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");typeof r!="string"&&(i=n,n=r,r=null),n&&(n=ef.toArray(n,i||"hex"),this._update(n));for(var s=[];s.length<t;)this.V=this._hmac().update(this.V).digest(),s=s.concat(this.V);var o=s.slice(0,t);return this._update(n),this._reseed++,ef.encode(o,r)};var dye=Il,lye=Go,p2=lye.assert;function ds(e,t){this.ec=e,this.priv=null,this.pub=null,t.priv&&this._importPrivate(t.priv,t.privEnc),t.pub&&this._importPublic(t.pub,t.pubEnc)}var uye=ds;ds.fromPublic=function(t,r,n){return r instanceof ds?r:new ds(t,{pub:r,pubEnc:n})};ds.fromPrivate=function(t,r,n){return r instanceof ds?r:new ds(t,{priv:r,privEnc:n})};ds.prototype.validate=function(){var t=this.getPublic();return t.isInfinity()?{result:!1,reason:"Invalid public key"}:t.validate()?t.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}};ds.prototype.getPublic=function(t,r){return typeof t=="string"&&(r=t,t=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),r?this.pub.encode(r,t):this.pub};ds.prototype.getPrivate=function(t){return t==="hex"?this.priv.toString(16,2):this.priv};ds.prototype._importPrivate=function(t,r){this.priv=new dye(t,r||16),this.priv=this.priv.umod(this.ec.curve.n)};ds.prototype._importPublic=function(t,r){if(t.x||t.y){this.ec.curve.type==="mont"?p2(t.x,"Need x coordinate"):(this.ec.curve.type==="short"||this.ec.curve.type==="edwards")&&p2(t.x&&t.y,"Need both x and y coordinate"),this.pub=this.ec.curve.point(t.x,t.y);return}this.pub=this.ec.curve.decodePoint(t,r)};ds.prototype.derive=function(t){return t.validate()||p2(t.validate(),"public point not validated"),t.mul(this.priv).getX()};ds.prototype.sign=function(t,r,n){return this.ec.sign(t,this,r,n)};ds.prototype.verify=function(t,r){return this.ec.verify(t,r,this)};ds.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"};var eS=Il,AP=Go,hye=AP.assert;function Ow(e,t){if(e instanceof Ow)return e;this._importDER(e,t)||(hye(e.r&&e.s,"Signature without r or s"),this.r=new eS(e.r,16),this.s=new eS(e.s,16),e.recoveryParam===void 0?this.recoveryParam=null:this.recoveryParam=e.recoveryParam)}var fye=Ow;function pye(){this.place=0}function VR(e,t){var r=e[t.place++];if(!(r&128))return r;var n=r&15;if(n===0||n>4||e[t.place]===0)return!1;for(var i=0,s=0,o=t.place;s<n;s++,o++)i<<=8,i|=e[o],i>>>=0;return i<=127?!1:(t.place=o,i)}function S6(e){for(var t=0,r=e.length-1;!e[t]&&!(e[t+1]&128)&&t<r;)t++;return t===0?e:e.slice(t)}Ow.prototype._importDER=function(t,r){t=AP.toArray(t,r);var n=new pye;if(t[n.place++]!==48)return!1;var i=VR(t,n);if(i===!1||i+n.place!==t.length||t[n.place++]!==2)return!1;var s=VR(t,n);if(s===!1||t[n.place]&128)return!1;var o=t.slice(n.place,s+n.place);if(n.place+=s,t[n.place++]!==2)return!1;var a=VR(t,n);if(a===!1||t.length!==a+n.place||t[n.place]&128)return!1;var c=t.slice(n.place,a+n.place);if(o[0]===0)if(o[1]&128)o=o.slice(1);else return!1;if(c[0]===0)if(c[1]&128)c=c.slice(1);else return!1;return this.r=new eS(o),this.s=new eS(c),this.recoveryParam=null,!0};function $R(e,t){if(t<128){e.push(t);return}var r=1+(Math.log(t)/Math.LN2>>>3);for(e.push(r|128);--r;)e.push(t>>>(r<<3)&255);e.push(t)}Ow.prototype.toDER=function(t){var r=this.r.toArray(),n=this.s.toArray();for(r[0]&128&&(r=[0].concat(r)),n[0]&128&&(n=[0].concat(n)),r=S6(r),n=S6(n);!n[0]&&!(n[1]&128);)n=n.slice(1);var i=[2];$R(i,r.length),i=i.concat(r),i.push(2),$R(i,n.length);var s=i.concat(n),o=[48];return $R(o,s.length),o=o.concat(s),AP.encode(o,t)};var tf=Il,SG=cye,mye=Go,HR=Iw,gye=EG,wG=mye.assert,CP=uye,Nw=fye;function La(e){if(!(this instanceof La))return new La(e);typeof e=="string"&&(wG(Object.prototype.hasOwnProperty.call(HR,e),"Unknown curve "+e),e=HR[e]),e instanceof HR.PresetCurve&&(e={curve:e}),this.curve=e.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=e.curve.g,this.g.precompute(e.curve.n.bitLength()+1),this.hash=e.hash||e.curve.hash}var _ye=La;La.prototype.keyPair=function(t){return new CP(this,t)};La.prototype.keyFromPrivate=function(t,r){return CP.fromPrivate(this,t,r)};La.prototype.keyFromPublic=function(t,r){return CP.fromPublic(this,t,r)};La.prototype.genKeyPair=function(t){t||(t={});for(var r=new SG({hash:this.hash,pers:t.pers,persEnc:t.persEnc||"utf8",entropy:t.entropy||gye(this.hash.hmacStrength),entropyEnc:t.entropy&&t.entropyEnc||"utf8",nonce:this.n.toArray()}),n=this.n.byteLength(),i=this.n.sub(new tf(2));;){var s=new tf(r.generate(n));if(!(s.cmp(i)>0))return s.iaddn(1),this.keyFromPrivate(s)}};La.prototype._truncateToN=function(t,r){var n=t.byteLength()*8-this.n.bitLength();return n>0&&(t=t.ushrn(n)),!r&&t.cmp(this.n)>=0?t.sub(this.n):t};La.prototype.sign=function(t,r,n,i){typeof n=="object"&&(i=n,n=null),i||(i={}),r=this.keyFromPrivate(r,n),t=this._truncateToN(new tf(t,16));for(var s=this.n.byteLength(),o=r.getPrivate().toArray("be",s),a=t.toArray("be",s),c=new SG({hash:this.hash,entropy:o,nonce:a,pers:i.pers,persEnc:i.persEnc||"utf8"}),d=this.n.sub(new tf(1)),l=0;;l++){var u=i.k?i.k(l):new tf(c.generate(this.n.byteLength()));if(u=this._truncateToN(u,!0),!(u.cmpn(1)<=0||u.cmp(d)>=0)){var h=this.g.mul(u);if(!h.isInfinity()){var p=h.getX(),_=p.umod(this.n);if(_.cmpn(0)!==0){var g=u.invm(this.n).mul(_.mul(r.getPrivate()).iadd(t));if(g=g.umod(this.n),g.cmpn(0)!==0){var E=(h.getY().isOdd()?1:0)|(p.cmp(_)!==0?2:0);return i.canonical&&g.cmp(this.nh)>0&&(g=this.n.sub(g),E^=1),new Nw({r:_,s:g,recoveryParam:E})}}}}}};La.prototype.verify=function(t,r,n,i){t=this._truncateToN(new tf(t,16)),n=this.keyFromPublic(n,i),r=new Nw(r,"hex");var s=r.r,o=r.s;if(s.cmpn(1)<0||s.cmp(this.n)>=0||o.cmpn(1)<0||o.cmp(this.n)>=0)return!1;var a=o.invm(this.n),c=a.mul(t).umod(this.n),d=a.mul(s).umod(this.n),l;return this.curve._maxwellTrick?(l=this.g.jmulAdd(c,n.getPublic(),d),l.isInfinity()?!1:l.eqXToP(s)):(l=this.g.mulAdd(c,n.getPublic(),d),l.isInfinity()?!1:l.getX().umod(this.n).cmp(s)===0)};La.prototype.recoverPubKey=function(e,t,r,n){wG((3&r)===r,"The recovery param is more than two bits"),t=new Nw(t,n);var i=this.n,s=new tf(e),o=t.r,a=t.s,c=r&1,d=r>>1;if(o.cmp(this.curve.p.umod(this.curve.n))>=0&&d)throw new Error("Unable to find sencond key candinate");d?o=this.curve.pointFromX(o.add(this.curve.n),c):o=this.curve.pointFromX(o,c);var l=t.r.invm(i),u=i.sub(s).mul(l).umod(i),h=a.mul(l).umod(i);return this.g.mulAdd(u,o,h)};La.prototype.getKeyRecoveryParam=function(e,t,r,n){if(t=new Nw(t,n),t.recoveryParam!==null)return t.recoveryParam;for(var i=0;i<4;i++){var s;try{s=this.recoverPubKey(e,t,i)}catch{continue}if(s.eq(r))return i}throw new Error("Unable to find valid recovery factor")};var JE=Go,TG=JE.assert,w6=JE.parseBytes,_0=JE.cachedProperty;function Ni(e,t){this.eddsa=e,this._secret=w6(t.secret),e.isPoint(t.pub)?this._pub=t.pub:this._pubBytes=w6(t.pub)}Ni.fromPublic=function(t,r){return r instanceof Ni?r:new Ni(t,{pub:r})};Ni.fromSecret=function(t,r){return r instanceof Ni?r:new Ni(t,{secret:r})};Ni.prototype.secret=function(){return this._secret};_0(Ni,"pubBytes",function(){return this.eddsa.encodePoint(this.pub())});_0(Ni,"pub",function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())});_0(Ni,"privBytes",function(){var t=this.eddsa,r=this.hash(),n=t.encodingLength-1,i=r.slice(0,t.encodingLength);return i[0]&=248,i[n]&=127,i[n]|=64,i});_0(Ni,"priv",function(){return this.eddsa.decodeInt(this.privBytes())});_0(Ni,"hash",function(){return this.eddsa.hash().update(this.secret()).digest()});_0(Ni,"messagePrefix",function(){return this.hash().slice(this.eddsa.encodingLength)});Ni.prototype.sign=function(t){return TG(this._secret,"KeyPair can only verify"),this.eddsa.sign(t,this)};Ni.prototype.verify=function(t,r){return this.eddsa.verify(t,r,this)};Ni.prototype.getSecret=function(t){return TG(this._secret,"KeyPair is public only"),JE.encode(this.secret(),t)};Ni.prototype.getPublic=function(t){return JE.encode(this.pubBytes(),t)};var Eye=Ni,vye=Il,Dw=Go,T6=Dw.assert,Pw=Dw.cachedProperty,yye=Dw.parseBytes;function Mf(e,t){this.eddsa=e,typeof t!="object"&&(t=yye(t)),Array.isArray(t)&&(T6(t.length===e.encodingLength*2,"Signature has invalid size"),t={R:t.slice(0,e.encodingLength),S:t.slice(e.encodingLength)}),T6(t.R&&t.S,"Signature without R or S"),e.isPoint(t.R)&&(this._R=t.R),t.S instanceof vye&&(this._S=t.S),this._Rencoded=Array.isArray(t.R)?t.R:t.Rencoded,this._Sencoded=Array.isArray(t.S)?t.S:t.Sencoded}Pw(Mf,"S",function(){return this.eddsa.decodeInt(this.Sencoded())});Pw(Mf,"R",function(){return this.eddsa.decodePoint(this.Rencoded())});Pw(Mf,"Rencoded",function(){return this.eddsa.encodePoint(this.R())});Pw(Mf,"Sencoded",function(){return this.eddsa.encodeInt(this.S())});Mf.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())};Mf.prototype.toHex=function(){return Dw.encode(this.toBytes(),"hex").toUpperCase()};var bye=Mf,Sye=Sw,wye=Iw,Lm=Go,Tye=Lm.assert,RG=Lm.parseBytes,AG=Eye,R6=bye;function po(e){if(Tye(e==="ed25519","only tested with ed25519 so far"),!(this instanceof po))return new po(e);e=wye[e].curve,this.curve=e,this.g=e.g,this.g.precompute(e.n.bitLength()+1),this.pointClass=e.point().constructor,this.encodingLength=Math.ceil(e.n.bitLength()/8),this.hash=Sye.sha512}var Rye=po;po.prototype.sign=function(t,r){t=RG(t);var n=this.keyFromSecret(r),i=this.hashInt(n.messagePrefix(),t),s=this.g.mul(i),o=this.encodePoint(s),a=this.hashInt(o,n.pubBytes(),t).mul(n.priv()),c=i.add(a).umod(this.curve.n);return this.makeSignature({R:s,S:c,Rencoded:o})};po.prototype.verify=function(t,r,n){if(t=RG(t),r=this.makeSignature(r),r.S().gte(r.eddsa.curve.n)||r.S().isNeg())return!1;var i=this.keyFromPublic(n),s=this.hashInt(r.Rencoded(),i.pubBytes(),t),o=this.g.mul(r.S()),a=r.R().add(i.pub().mul(s));return a.eq(o)};po.prototype.hashInt=function(){for(var t=this.hash(),r=0;r<arguments.length;r++)t.update(arguments[r]);return Lm.intFromLE(t.digest()).umod(this.curve.n)};po.prototype.keyFromPublic=function(t){return AG.fromPublic(this,t)};po.prototype.keyFromSecret=function(t){return AG.fromSecret(this,t)};po.prototype.makeSignature=function(t){return t instanceof R6?t:new R6(this,t)};po.prototype.encodePoint=function(t){var r=t.getY().toArray("le",this.encodingLength);return r[this.encodingLength-1]|=t.getX().isOdd()?128:0,r};po.prototype.decodePoint=function(t){t=Lm.parseBytes(t);var r=t.length-1,n=t.slice(0,r).concat(t[r]&-129),i=(t[r]&128)!==0,s=Lm.intFromLE(n);return this.curve.pointFromY(s,i)};po.prototype.encodeInt=function(t){return t.toArray("le",this.encodingLength)};po.prototype.decodeInt=function(t){return Lm.intFromLE(t)};po.prototype.isPoint=function(t){return t instanceof this.pointClass};(function(e){var t=e;t.version=Jve.version,t.utils=Go,t.rand=EG,t.curve=TP,t.curves=Iw,t.ec=_ye,t.eddsa=Rye})(xve);const Aye={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function Cye(e,t){const{message:r,code:n}=Aye[e];return{message:r,code:n}}const gb=new aw;let Kc;async function CG(e){let t=!1;const r=m6.version,n=localStorage.getItem("puzzle_sdk_version");if(r!==n&&(console.log(`${m6.name}: Updated from `+n+" to "+r+"!"),localStorage.setItem("puzzle_sdk_version",r),t=!0),Kc=new xge({projectId:e.projectId??yP,metadata:{name:e.dAppName,description:e.dAppDescription,url:window?window.location.hostname:e.dAppUrl??"NO URL",icons:[e.dAppIconURL]},modalOptions:{...W_e}}),t){localStorage.removeItem("puzzle-hasInjectedConnection");try{Iye(Kc,e.onDisconnect)}catch(s){console.error(s)}}Kc.onSessionDelete(()=>{localStorage.removeItem("puzzle-hasInjectedConnection"),e.onDisconnect&&e.onDisconnect()}),Kc.onSessionExpire(()=>{localStorage.removeItem("puzzle-hasInjectedConnection"),e.onDisconnect&&e.onDisconnect()});const i=window.localStorage.getItem("WALLETCONNECT_DEEPLINK_CHOICE");return i&&JSON.parse(i).name!=="Android"&&window.localStorage.removeItem("WALLETCONNECT_DEEPLINK_CHOICE"),typeof window<"u"&&(window.puzzleSdkConnection=Kc),Kc}async function Iye(e,t){const r=await(e==null?void 0:e.getSession());r&&(console.log("Disconnecting session",r),t&&t(),e.disconnect({topic:r.topic,reason:Cye("USER_DISCONNECTED")}))}async function vd(){return new Promise(e=>{if(Kc)e(Kc);else if(typeof window<"u"&&(window!=null&&window.puzzleSdkConnection))e(window.puzzleSdkConnection);else{const r=setInterval(()=>{Kc&&(clearInterval(r),e(Kc))},200)}const t=window.localStorage.getItem("WALLETCONNECT_DEEPLINK_CHOICE");t&&JSON.parse(t).name!=="Android"&&window.localStorage.removeItem("WALLETCONNECT_DEEPLINK_CHOICE")})}const Oye=async e=>{var r;if(typeof window>"u")return!1;const t=!!((r=window==null?void 0:window.aleo)!=null&&r.puzzleWalletClient);if(!t)return console.log("!!window?.aleo?.puzzleWalletClient",t),localStorage.setItem("puzzle-hasInjectedConnection","false"),!1;try{return await window.aleo.puzzleWalletClient.isConnected.query({sessionTopic:e})?(localStorage.setItem("puzzle-hasInjectedConnection","true"),!0):(localStorage.setItem("puzzle-hasInjectedConnection","false"),!1)}catch(n){return console.warn(n),localStorage.setItem("puzzle-hasInjectedConnection","false"),!1}},Nye=()=>{var r;return typeof window>"u"||!!!((r=window==null?void 0:window.aleo)!=null&&r.puzzleWalletClient)?!1:localStorage.getItem("puzzle-hasInjectedConnection")==="true"},Dye=async(e=!0)=>{const t=await vd();if(!t)throw new Error("call configureConnection() first!");const r=await t.getSession();if(r)return console.log("Already connected!",r),r;try{const n=await t.connect({requiredNamespaces:{aleo:{methods:f6,chains:QW,events:p6}},optionalNamespaces:{aleo:{chains:ZW,methods:f6,events:p6}}},e);gb.emit("session_change"),n&&await Oye(n.topic);const i=window.localStorage.getItem("WALLETCONNECT_DEEPLINK_CHOICE");return i&&JSON.parse(i).name!=="Android"&&window.localStorage.removeItem("WALLETCONNECT_DEEPLINK_CHOICE"),n}catch(n){console.error("connect error",n)}},Pye=async(e,t)=>{const r=await vd(),n=await(r==null?void 0:r.getSession());if(!n||!r)return{error:"no session or connection"};const i=e==null?void 0:e.inputs.map(s=>typeof s=="string"?s:s.plaintext);try{return await r.request({topic:n.topic,chainId:t??"aleo:1",request:{jsonrpc:"2.0",method:"requestCreateEvent",params:{...e,inputs:i}}})}catch(s){return console.error("createEvent error",s),{error:s.message}}},kye=async({address:e,filter:t,page:r=0,network:n})=>{const i=await vd(),s=await(i==null?void 0:i.getSession());if(!s||!i)return{error:"no session or connection"};if(n&&!vP.includes(n))return{error:"network not in wc_aleo_chains"};const o={topic:s.topic,chainId:n??"aleo:1",request:{jsonrpc:"2.0",method:"getRecords",params:{address:e,filter:t,page:r}}};if(Nye())try{return await window.aleo.puzzleWalletClient.getRecords.query(o)}catch(c){return console.error("getRecords error",c),{error:c.message}}const a=async(c=0)=>await i.request(o);try{return await a()}catch(c){return console.error("getRecords error",c),{error:c.message}}};var m2={exports:{}},zR,A6;function Lye(){if(A6)return zR;A6=1;var e=1e3,t=e*60,r=t*60,n=r*24,i=n*7,s=n*365.25;zR=function(l,u){u=u||{};var h=typeof l;if(h==="string"&&l.length>0)return o(l);if(h==="number"&&isFinite(l))return u.long?c(l):a(l);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(l))};function o(l){if(l=String(l),!(l.length>100)){var u=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(l);if(u){var h=parseFloat(u[1]),p=(u[2]||"ms").toLowerCase();switch(p){case"years":case"year":case"yrs":case"yr":case"y":return h*s;case"weeks":case"week":case"w":return h*i;case"days":case"day":case"d":return h*n;case"hours":case"hour":case"hrs":case"hr":case"h":return h*r;case"minutes":case"minute":case"mins":case"min":case"m":return h*t;case"seconds":case"second":case"secs":case"sec":case"s":return h*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function a(l){var u=Math.abs(l);return u>=n?Math.round(l/n)+"d":u>=r?Math.round(l/r)+"h":u>=t?Math.round(l/t)+"m":u>=e?Math.round(l/e)+"s":l+"ms"}function c(l){var u=Math.abs(l);return u>=n?d(l,u,n,"day"):u>=r?d(l,u,r,"hour"):u>=t?d(l,u,t,"minute"):u>=e?d(l,u,e,"second"):l+" ms"}function d(l,u,h,p){var _=u>=h*1.5;return Math.round(l/h)+" "+p+(_?"s":"")}return zR}function xye(e){r.debug=r,r.default=r,r.coerce=c,r.disable=s,r.enable=i,r.enabled=o,r.humanize=Lye(),r.destroy=d,Object.keys(e).forEach(l=>{r[l]=e[l]}),r.names=[],r.skips=[],r.formatters={};function t(l){let u=0;for(let h=0;h<l.length;h++)u=(u<<5)-u+l.charCodeAt(h),u|=0;return r.colors[Math.abs(u)%r.colors.length]}r.selectColor=t;function r(l){let u,h=null,p,_;function g(...E){if(!g.enabled)return;const b=g,v=Number(new Date),I=v-(u||v);b.diff=I,b.prev=u,b.curr=v,u=v,E[0]=r.coerce(E[0]),typeof E[0]!="string"&&E.unshift("%O");let N=0;E[0]=E[0].replace(/%([a-zA-Z%])/g,(U,w)=>{if(U==="%%")return"%";N++;const V=r.formatters[w];if(typeof V=="function"){const z=E[N];U=V.call(b,z),E.splice(N,1),N--}return U}),r.formatArgs.call(b,E),(b.log||r.log).apply(b,E)}return g.namespace=l,g.useColors=r.useColors(),g.color=r.selectColor(l),g.extend=n,g.destroy=r.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(p!==r.namespaces&&(p=r.namespaces,_=r.enabled(l)),_),set:E=>{h=E}}),typeof r.init=="function"&&r.init(g),g}function n(l,u){const h=r(this.namespace+(typeof u>"u"?":":u)+l);return h.log=this.log,h}function i(l){r.save(l),r.namespaces=l,r.names=[],r.skips=[];let u;const h=(typeof l=="string"?l:"").split(/[\s,]+/),p=h.length;for(u=0;u<p;u++)h[u]&&(l=h[u].replace(/\*/g,".*?"),l[0]==="-"?r.skips.push(new RegExp("^"+l.slice(1)+"$")):r.names.push(new RegExp("^"+l+"$")))}function s(){const l=[...r.names.map(a),...r.skips.map(a).map(u=>"-"+u)].join(",");return r.enable(""),l}function o(l){if(l[l.length-1]==="*")return!0;let u,h;for(u=0,h=r.skips.length;u<h;u++)if(r.skips[u].test(l))return!1;for(u=0,h=r.names.length;u<h;u++)if(r.names[u].test(l))return!0;return!1}function a(l){return l.toString().substring(2,l.toString().length-2).replace(/\.\*\?$/,"*")}function c(l){return l instanceof Error?l.stack||l.message:l}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}var Mye=xye;(function(e,t){var r={};t.formatArgs=i,t.save=s,t.load=o,t.useColors=n,t.storage=a(),t.destroy=(()=>{let d=!1;return()=>{d||(d=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(d){if(d[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+d[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const l="color: "+this.color;d.splice(1,0,l,"color: inherit");let u=0,h=0;d[0].replace(/%[a-zA-Z%]/g,p=>{p!=="%%"&&(u++,p==="%c"&&(h=u))}),d.splice(h,0,l)}t.log=console.debug||console.log||(()=>{});function s(d){try{d?t.storage.setItem("debug",d):t.storage.removeItem("debug")}catch{}}function o(){let d;try{d=t.storage.getItem("debug")}catch{}return!d&&typeof process<"u"&&"env"in process&&(d=r.DEBUG),d}function a(){try{return localStorage}catch{}}e.exports=Mye(t);const{formatters:c}=e.exports;c.j=function(d){try{return JSON.stringify(d)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}})(m2,m2.exports);var Uye=m2.exports;const jye=Rf(Uye),Fye=jye("wallet:sdk");Fye.enabled=!0;function Bye(e){me.useEffect(()=>(vd().then(t=>{t.onSessionDelete(e)}),()=>{vd().then(t=>{t.offSessionDelete(e)})}),[e])}function Vye(e){me.useEffect(()=>(vd().then(t=>{t.onSessionUpdate(e)}),()=>{vd().then(t=>{t.offSessionUpdate(e)})}),[e])}var $ye={VITE_APIKEY:"AIzaSyDGGzVqu4wd9f7kCA3_sYjCn4unuGRu9ck",VITE_AUTHDOMAIN:"bonds-live-app.firebaseapp.com",VITE_PROJECTID:"bonds-live-app",VITE_STORAGEBUCKET:"bonds-live-app.appspot.com",VITE_MESSAGINGSENDERID:"532381019367",VITE_APPID:"1:532381019367:web:9055d189d78452e0bf4642",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const C6=e=>{let t;const r=new Set,n=(l,u)=>{const h=typeof l=="function"?l(t):l;if(!Object.is(h,t)){const p=t;t=u??(typeof h!="object"||h===null)?h:Object.assign({},t,h),r.forEach(_=>_(t,p))}},i=()=>t,c={setState:n,getState:i,getInitialState:()=>d,subscribe:l=>(r.add(l),()=>r.delete(l)),destroy:()=>{($ye?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},d=t=e(n,i,c);return c},Hye=e=>e?C6(e):C6;var IG={exports:{}},OG={},NG={exports:{}},DG={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xm=me;function zye(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Wye=typeof Object.is=="function"?Object.is:zye,Gye=xm.useState,qye=xm.useEffect,Kye=xm.useLayoutEffect,Yye=xm.useDebugValue;function Jye(e,t){var r=t(),n=Gye({inst:{value:r,getSnapshot:t}}),i=n[0].inst,s=n[1];return Kye(function(){i.value=r,i.getSnapshot=t,WR(i)&&s({inst:i})},[e,r,t]),qye(function(){return WR(i)&&s({inst:i}),e(function(){WR(i)&&s({inst:i})})},[e]),Yye(r),r}function WR(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Wye(e,r)}catch{return!0}}function Xye(e,t){return t()}var Qye=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Xye:Jye;DG.useSyncExternalStore=xm.useSyncExternalStore!==void 0?xm.useSyncExternalStore:Qye;NG.exports=DG;var Zye=NG.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kw=me,ebe=Zye;function tbe(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var rbe=typeof Object.is=="function"?Object.is:tbe,nbe=ebe.useSyncExternalStore,ibe=kw.useRef,sbe=kw.useEffect,obe=kw.useMemo,abe=kw.useDebugValue;OG.useSyncExternalStoreWithSelector=function(e,t,r,n,i){var s=ibe(null);if(s.current===null){var o={hasValue:!1,value:null};s.current=o}else o=s.current;s=obe(function(){function c(p){if(!d){if(d=!0,l=p,p=n(p),i!==void 0&&o.hasValue){var _=o.value;if(i(_,p))return u=_}return u=p}if(_=u,rbe(l,p))return _;var g=n(p);return i!==void 0&&i(_,g)?_:(l=p,u=g)}var d=!1,l,u,h=r===void 0?null:r;return[function(){return c(t())},h===null?void 0:function(){return c(h())}]},[t,r,n,i]);var a=nbe(e,s[0],s[1]);return sbe(function(){o.hasValue=!0,o.value=a},[a]),abe(a),a};IG.exports=OG;var cbe=IG.exports;const dbe=Rf(cbe);var PG={VITE_APIKEY:"AIzaSyDGGzVqu4wd9f7kCA3_sYjCn4unuGRu9ck",VITE_AUTHDOMAIN:"bonds-live-app.firebaseapp.com",VITE_PROJECTID:"bonds-live-app",VITE_STORAGEBUCKET:"bonds-live-app.appspot.com",VITE_MESSAGINGSENDERID:"532381019367",VITE_APPID:"1:532381019367:web:9055d189d78452e0bf4642",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{useDebugValue:lbe}=Es,{useSyncExternalStoreWithSelector:ube}=dbe;let I6=!1;const hbe=e=>e;function fbe(e,t=hbe,r){(PG?"production":void 0)!=="production"&&r&&!I6&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),I6=!0);const n=ube(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return lbe(n),n}const pbe=e=>{(PG?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t=typeof e=="function"?Hye(e):e,r=(n,i)=>fbe(t,n,i);return Object.assign(r,t),r},mbe=e=>pbe;var gbe={VITE_APIKEY:"AIzaSyDGGzVqu4wd9f7kCA3_sYjCn4unuGRu9ck",VITE_AUTHDOMAIN:"bonds-live-app.firebaseapp.com",VITE_PROJECTID:"bonds-live-app",VITE_STORAGEBUCKET:"bonds-live-app.appspot.com",VITE_MESSAGINGSENDERID:"532381019367",VITE_APPID:"1:532381019367:web:9055d189d78452e0bf4642",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};function _be(e,t){let r;try{r=e()}catch{return}return{getItem:i=>{var s;const o=c=>c===null?null:JSON.parse(c,void 0),a=(s=r.getItem(i))!=null?s:null;return a instanceof Promise?a.then(o):o(a)},setItem:(i,s)=>r.setItem(i,JSON.stringify(s,void 0)),removeItem:i=>r.removeItem(i)}}const nE=e=>t=>{try{const r=e(t);return r instanceof Promise?r:{then(n){return nE(n)(r)},catch(n){return this}}}catch(r){return{then(n){return this},catch(n){return nE(n)(r)}}}},Ebe=(e,t)=>(r,n,i)=>{let s={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:E=>E,version:0,merge:(E,b)=>({...b,...E}),...t},o=!1;const a=new Set,c=new Set;let d;try{d=s.getStorage()}catch{}if(!d)return e((...E)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),r(...E)},n,i);const l=nE(s.serialize),u=()=>{const E=s.partialize({...n()});let b;const v=l({state:E,version:s.version}).then(I=>d.setItem(s.name,I)).catch(I=>{b=I});if(b)throw b;return v},h=i.setState;i.setState=(E,b)=>{h(E,b),u()};const p=e((...E)=>{r(...E),u()},n,i);let _;const g=()=>{var E;if(!d)return;o=!1,a.forEach(v=>v(n()));const b=((E=s.onRehydrateStorage)==null?void 0:E.call(s,n()))||void 0;return nE(d.getItem.bind(d))(s.name).then(v=>{if(v)return s.deserialize(v)}).then(v=>{if(v)if(typeof v.version=="number"&&v.version!==s.version){if(s.migrate)return s.migrate(v.state,v.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return v.state}).then(v=>{var I;return _=s.merge(v,(I=n())!=null?I:p),r(_,!0),u()}).then(()=>{b==null||b(_,void 0),o=!0,c.forEach(v=>v(_))}).catch(v=>{b==null||b(void 0,v)})};return i.persist={setOptions:E=>{s={...s,...E},E.getStorage&&(d=E.getStorage())},clearStorage:()=>{d==null||d.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>g(),hasHydrated:()=>o,onHydrate:E=>(a.add(E),()=>{a.delete(E)}),onFinishHydration:E=>(c.add(E),()=>{c.delete(E)})},g(),_||p},vbe=(e,t)=>(r,n,i)=>{let s={storage:_be(()=>localStorage),partialize:g=>g,version:0,merge:(g,E)=>({...E,...g}),...t},o=!1;const a=new Set,c=new Set;let d=s.storage;if(!d)return e((...g)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),r(...g)},n,i);const l=()=>{const g=s.partialize({...n()});return d.setItem(s.name,{state:g,version:s.version})},u=i.setState;i.setState=(g,E)=>{u(g,E),l()};const h=e((...g)=>{r(...g),l()},n,i);i.getInitialState=()=>h;let p;const _=()=>{var g,E;if(!d)return;o=!1,a.forEach(v=>{var I;return v((I=n())!=null?I:h)});const b=((E=s.onRehydrateStorage)==null?void 0:E.call(s,(g=n())!=null?g:h))||void 0;return nE(d.getItem.bind(d))(s.name).then(v=>{if(v)if(typeof v.version=="number"&&v.version!==s.version){if(s.migrate)return[!0,s.migrate(v.state,v.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,v.state];return[!1,void 0]}).then(v=>{var I;const[N,L]=v;if(p=s.merge(L,(I=n())!=null?I:h),r(p,!0),N)return l()}).then(()=>{b==null||b(p,void 0),p=n(),o=!0,c.forEach(v=>v(p))}).catch(v=>{b==null||b(void 0,v)})};return i.persist={setOptions:g=>{s={...s,...g},g.storage&&(d=g.storage)},clearStorage:()=>{d==null||d.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>_(),hasHydrated:()=>o,onHydrate:g=>(a.add(g),()=>{a.delete(g)}),onFinishHydration:g=>(c.add(g),()=>{c.delete(g)})},s.skipHydration||_(),p||h},ybe=(e,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?((gbe?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),Ebe(e,t)):vbe(e,t),bbe=ybe,Sbe=mbe()(bbe((e,t)=>({account:void 0,chainId:"aleo:1",setAccount:r=>{e({account:r})},setChainId:r=>{e({chainId:r})},onDisconnect:()=>{e({account:void 0,chainId:void 0}),FG.clear(),localStorage.removeItem("puzzle-hasInjectedConnection"),console.log("onDisconnect called!")}}),{name:"puzzle-wallet-store"}));class Lw{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){const r={listener:t};return this.listeners.add(r),this.onSubscribe(),()=>{this.listeners.delete(r),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}}const IP=typeof window>"u"||"Deno"in window;function ec(){}function wbe(e,t){return typeof e=="function"?e(t):e}function Tbe(e){return typeof e=="number"&&e>=0&&e!==1/0}function Rbe(e,t){return Math.max(e+(t||0)-Date.now(),0)}function zv(e,t,r){return xw(e)?typeof t=="function"?{...r,queryKey:e,queryFn:t}:{...t,queryKey:e}:e}function Zl(e,t,r){return xw(e)?[{...t,queryKey:e},r]:[e||{},t]}function O6(e,t){const{type:r="all",exact:n,fetchStatus:i,predicate:s,queryKey:o,stale:a}=e;if(xw(o)){if(n){if(t.queryHash!==OP(o,t.options))return!1}else if(!tS(t.queryKey,o))return!1}if(r!=="all"){const c=t.isActive();if(r==="active"&&!c||r==="inactive"&&c)return!1}return!(typeof a=="boolean"&&t.isStale()!==a||typeof i<"u"&&i!==t.state.fetchStatus||s&&!s(t))}function N6(e,t){const{exact:r,fetching:n,predicate:i,mutationKey:s}=e;if(xw(s)){if(!t.options.mutationKey)return!1;if(r){if(Bh(t.options.mutationKey)!==Bh(s))return!1}else if(!tS(t.options.mutationKey,s))return!1}return!(typeof n=="boolean"&&t.state.status==="loading"!==n||i&&!i(t))}function OP(e,t){return((t==null?void 0:t.queryKeyHashFn)||Bh)(e)}function Bh(e){return JSON.stringify(e,(t,r)=>g2(r)?Object.keys(r).sort().reduce((n,i)=>(n[i]=r[i],n),{}):r)}function tS(e,t){return kG(e,t)}function kG(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?!Object.keys(t).some(r=>!kG(e[r],t[r])):!1}function LG(e,t){if(e===t)return e;const r=D6(e)&&D6(t);if(r||g2(e)&&g2(t)){const n=r?e.length:Object.keys(e).length,i=r?t:Object.keys(t),s=i.length,o=r?[]:{};let a=0;for(let c=0;c<s;c++){const d=r?c:i[c];o[d]=LG(e[d],t[d]),o[d]===e[d]&&a++}return n===s&&a===n?e:o}return t}function D6(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function g2(e){if(!P6(e))return!1;const t=e.constructor;if(typeof t>"u")return!0;const r=t.prototype;return!(!P6(r)||!r.hasOwnProperty("isPrototypeOf"))}function P6(e){return Object.prototype.toString.call(e)==="[object Object]"}function xw(e){return Array.isArray(e)}function xG(e){return new Promise(t=>{setTimeout(t,e)})}function k6(e){xG(0).then(e)}function Abe(){if(typeof AbortController=="function")return new AbortController}function Cbe(e,t,r){return r.isDataEqual!=null&&r.isDataEqual(e,t)?e:typeof r.structuralSharing=="function"?r.structuralSharing(e,t):r.structuralSharing!==!1?LG(e,t):t}class Ibe extends Lw{constructor(){super(),this.setup=t=>{if(!IP&&window.addEventListener){const r=()=>t();return window.addEventListener("visibilitychange",r,!1),window.addEventListener("focus",r,!1),()=>{window.removeEventListener("visibilitychange",r),window.removeEventListener("focus",r)}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){if(!this.hasListeners()){var t;(t=this.cleanup)==null||t.call(this),this.cleanup=void 0}}setEventListener(t){var r;this.setup=t,(r=this.cleanup)==null||r.call(this),this.cleanup=t(n=>{typeof n=="boolean"?this.setFocused(n):this.onFocus()})}setFocused(t){this.focused!==t&&(this.focused=t,this.onFocus())}onFocus(){this.listeners.forEach(({listener:t})=>{t()})}isFocused(){return typeof this.focused=="boolean"?this.focused:typeof document>"u"?!0:[void 0,"visible","prerender"].includes(document.visibilityState)}}const _2=new Ibe,L6=["online","offline"];class Obe extends Lw{constructor(){super(),this.setup=t=>{if(!IP&&window.addEventListener){const r=()=>t();return L6.forEach(n=>{window.addEventListener(n,r,!1)}),()=>{L6.forEach(n=>{window.removeEventListener(n,r)})}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){if(!this.hasListeners()){var t;(t=this.cleanup)==null||t.call(this),this.cleanup=void 0}}setEventListener(t){var r;this.setup=t,(r=this.cleanup)==null||r.call(this),this.cleanup=t(n=>{typeof n=="boolean"?this.setOnline(n):this.onOnline()})}setOnline(t){this.online!==t&&(this.online=t,this.onOnline())}onOnline(){this.listeners.forEach(({listener:t})=>{t()})}isOnline(){return typeof this.online=="boolean"?this.online:typeof navigator>"u"||typeof navigator.onLine>"u"?!0:navigator.onLine}}const rS=new Obe;function Nbe(e){return Math.min(1e3*2**e,3e4)}function NP(e){return(e??"online")==="online"?rS.isOnline():!0}class MG{constructor(t){this.revert=t==null?void 0:t.revert,this.silent=t==null?void 0:t.silent}}function GR(e){return e instanceof MG}function UG(e){let t=!1,r=0,n=!1,i,s,o;const a=new Promise((E,b)=>{s=E,o=b}),c=E=>{n||(p(new MG(E)),e.abort==null||e.abort())},d=()=>{t=!0},l=()=>{t=!1},u=()=>!_2.isFocused()||e.networkMode!=="always"&&!rS.isOnline(),h=E=>{n||(n=!0,e.onSuccess==null||e.onSuccess(E),i==null||i(),s(E))},p=E=>{n||(n=!0,e.onError==null||e.onError(E),i==null||i(),o(E))},_=()=>new Promise(E=>{i=b=>{const v=n||!u();return v&&E(b),v},e.onPause==null||e.onPause()}).then(()=>{i=void 0,n||e.onContinue==null||e.onContinue()}),g=()=>{if(n)return;let E;try{E=e.fn()}catch(b){E=Promise.reject(b)}Promise.resolve(E).then(h).catch(b=>{var v,I;if(n)return;const N=(v=e.retry)!=null?v:3,L=(I=e.retryDelay)!=null?I:Nbe,U=typeof L=="function"?L(r,b):L,w=N===!0||typeof N=="number"&&r<N||typeof N=="function"&&N(r,b);if(t||!w){p(b);return}r++,e.onFail==null||e.onFail(r,b),xG(U).then(()=>{if(u())return _()}).then(()=>{t?p(b):g()})})};return NP(e.networkMode)?g():_().then(g),{promise:a,cancel:c,continue:()=>(i==null?void 0:i())?a:Promise.resolve(),cancelRetry:d,continueRetry:l}}const DP=console;function Dbe(){let e=[],t=0,r=l=>{l()},n=l=>{l()};const i=l=>{let u;t++;try{u=l()}finally{t--,t||a()}return u},s=l=>{t?e.push(l):k6(()=>{r(l)})},o=l=>(...u)=>{s(()=>{l(...u)})},a=()=>{const l=e;e=[],l.length&&k6(()=>{n(()=>{l.forEach(u=>{r(u)})})})};return{batch:i,batchCalls:o,schedule:s,setNotifyFunction:l=>{r=l},setBatchNotifyFunction:l=>{n=l}}}const ws=Dbe();class jG{destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Tbe(this.cacheTime)&&(this.gcTimeout=setTimeout(()=>{this.optionalRemove()},this.cacheTime))}updateCacheTime(t){this.cacheTime=Math.max(this.cacheTime||0,t??(IP?1/0:5*60*1e3))}clearGcTimeout(){this.gcTimeout&&(clearTimeout(this.gcTimeout),this.gcTimeout=void 0)}}class Pbe extends jG{constructor(t){super(),this.abortSignalConsumed=!1,this.defaultOptions=t.defaultOptions,this.setOptions(t.options),this.observers=[],this.cache=t.cache,this.logger=t.logger||DP,this.queryKey=t.queryKey,this.queryHash=t.queryHash,this.initialState=t.state||kbe(this.options),this.state=this.initialState,this.scheduleGc()}get meta(){return this.options.meta}setOptions(t){this.options={...this.defaultOptions,...t},this.updateCacheTime(this.options.cacheTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.cache.remove(this)}setData(t,r){const n=Cbe(this.state.data,t,this.options);return this.dispatch({data:n,type:"success",dataUpdatedAt:r==null?void 0:r.updatedAt,manual:r==null?void 0:r.manual}),n}setState(t,r){this.dispatch({type:"setState",state:t,setStateOptions:r})}cancel(t){var r;const n=this.promise;return(r=this.retryer)==null||r.cancel(t),n?n.then(ec).catch(ec):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.initialState)}isActive(){return this.observers.some(t=>t.options.enabled!==!1)}isDisabled(){return this.getObserversCount()>0&&!this.isActive()}isStale(){return this.state.isInvalidated||!this.state.dataUpdatedAt||this.observers.some(t=>t.getCurrentResult().isStale)}isStaleByTime(t=0){return this.state.isInvalidated||!this.state.dataUpdatedAt||!Rbe(this.state.dataUpdatedAt,t)}onFocus(){var t;const r=this.observers.find(n=>n.shouldFetchOnWindowFocus());r&&r.refetch({cancelRefetch:!1}),(t=this.retryer)==null||t.continue()}onOnline(){var t;const r=this.observers.find(n=>n.shouldFetchOnReconnect());r&&r.refetch({cancelRefetch:!1}),(t=this.retryer)==null||t.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),this.cache.notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(r=>r!==t),this.observers.length||(this.retryer&&(this.abortSignalConsumed?this.retryer.cancel({revert:!0}):this.retryer.cancelRetry()),this.scheduleGc()),this.cache.notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.dispatch({type:"invalidate"})}fetch(t,r){var n,i;if(this.state.fetchStatus!=="idle"){if(this.state.dataUpdatedAt&&r!=null&&r.cancelRefetch)this.cancel({silent:!0});else if(this.promise){var s;return(s=this.retryer)==null||s.continueRetry(),this.promise}}if(t&&this.setOptions(t),!this.options.queryFn){const p=this.observers.find(_=>_.options.queryFn);p&&this.setOptions(p.options)}const o=Abe(),a={queryKey:this.queryKey,pageParam:void 0,meta:this.meta},c=p=>{Object.defineProperty(p,"signal",{enumerable:!0,get:()=>{if(o)return this.abortSignalConsumed=!0,o.signal}})};c(a);const d=()=>this.options.queryFn?(this.abortSignalConsumed=!1,this.options.queryFn(a)):Promise.reject("Missing queryFn for queryKey '"+this.options.queryHash+"'"),l={fetchOptions:r,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:d};if(c(l),(n=this.options.behavior)==null||n.onFetch(l),this.revertState=this.state,this.state.fetchStatus==="idle"||this.state.fetchMeta!==((i=l.fetchOptions)==null?void 0:i.meta)){var u;this.dispatch({type:"fetch",meta:(u=l.fetchOptions)==null?void 0:u.meta})}const h=p=>{if(GR(p)&&p.silent||this.dispatch({type:"error",error:p}),!GR(p)){var _,g,E,b;(_=(g=this.cache.config).onError)==null||_.call(g,p,this),(E=(b=this.cache.config).onSettled)==null||E.call(b,this.state.data,p,this)}this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1};return this.retryer=UG({fn:l.fetchFn,abort:o==null?void 0:o.abort.bind(o),onSuccess:p=>{var _,g,E,b;if(typeof p>"u"){h(new Error(this.queryHash+" data is undefined"));return}this.setData(p),(_=(g=this.cache.config).onSuccess)==null||_.call(g,p,this),(E=(b=this.cache.config).onSettled)==null||E.call(b,p,this.state.error,this),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1},onError:h,onFail:(p,_)=>{this.dispatch({type:"failed",failureCount:p,error:_})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:l.options.retry,retryDelay:l.options.retryDelay,networkMode:l.options.networkMode}),this.promise=this.retryer.promise,this.promise}dispatch(t){const r=n=>{var i,s;switch(t.type){case"failed":return{...n,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:(i=t.meta)!=null?i:null,fetchStatus:NP(this.options.networkMode)?"fetching":"paused",...!n.dataUpdatedAt&&{error:null,status:"loading"}};case"success":return{...n,data:t.data,dataUpdateCount:n.dataUpdateCount+1,dataUpdatedAt:(s=t.dataUpdatedAt)!=null?s:Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const o=t.error;return GR(o)&&o.revert&&this.revertState?{...this.revertState,fetchStatus:"idle"}:{...n,error:o,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...t.state}}};this.state=r(this.state),ws.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate(t)}),this.cache.notify({query:this,type:"updated",action:t})})}}function kbe(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,r=typeof t<"u",n=r?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:r?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"loading",fetchStatus:"idle"}}class Lbe extends Lw{constructor(t){super(),this.config=t||{},this.queries=[],this.queriesMap={}}build(t,r,n){var i;const s=r.queryKey,o=(i=r.queryHash)!=null?i:OP(s,r);let a=this.get(o);return a||(a=new Pbe({cache:this,logger:t.getLogger(),queryKey:s,queryHash:o,options:t.defaultQueryOptions(r),state:n,defaultOptions:t.getQueryDefaults(s)}),this.add(a)),a}add(t){this.queriesMap[t.queryHash]||(this.queriesMap[t.queryHash]=t,this.queries.push(t),this.notify({type:"added",query:t}))}remove(t){const r=this.queriesMap[t.queryHash];r&&(t.destroy(),this.queries=this.queries.filter(n=>n!==t),r===t&&delete this.queriesMap[t.queryHash],this.notify({type:"removed",query:t}))}clear(){ws.batch(()=>{this.queries.forEach(t=>{this.remove(t)})})}get(t){return this.queriesMap[t]}getAll(){return this.queries}find(t,r){const[n]=Zl(t,r);return typeof n.exact>"u"&&(n.exact=!0),this.queries.find(i=>O6(n,i))}findAll(t,r){const[n]=Zl(t,r);return Object.keys(n).length>0?this.queries.filter(i=>O6(n,i)):this.queries}notify(t){ws.batch(()=>{this.listeners.forEach(({listener:r})=>{r(t)})})}onFocus(){ws.batch(()=>{this.queries.forEach(t=>{t.onFocus()})})}onOnline(){ws.batch(()=>{this.queries.forEach(t=>{t.onOnline()})})}}class xbe extends jG{constructor(t){super(),this.defaultOptions=t.defaultOptions,this.mutationId=t.mutationId,this.mutationCache=t.mutationCache,this.logger=t.logger||DP,this.observers=[],this.state=t.state||Mbe(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options={...this.defaultOptions,...t},this.updateCacheTime(this.options.cacheTime)}get meta(){return this.options.meta}setState(t){this.dispatch({type:"setState",state:t})}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),this.mutationCache.notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){this.observers=this.observers.filter(r=>r!==t),this.scheduleGc(),this.mutationCache.notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){this.observers.length||(this.state.status==="loading"?this.scheduleGc():this.mutationCache.remove(this))}continue(){var t,r;return(t=(r=this.retryer)==null?void 0:r.continue())!=null?t:this.execute()}async execute(){const t=()=>{var w;return this.retryer=UG({fn:()=>this.options.mutationFn?this.options.mutationFn(this.state.variables):Promise.reject("No mutationFn found"),onFail:(V,z)=>{this.dispatch({type:"failed",failureCount:V,error:z})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:(w=this.options.retry)!=null?w:0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode}),this.retryer.promise},r=this.state.status==="loading";try{var n,i,s,o,a,c,d,l;if(!r){var u,h,p,_;this.dispatch({type:"loading",variables:this.options.variables}),await((u=(h=this.mutationCache.config).onMutate)==null?void 0:u.call(h,this.state.variables,this));const V=await((p=(_=this.options).onMutate)==null?void 0:p.call(_,this.state.variables));V!==this.state.context&&this.dispatch({type:"loading",context:V,variables:this.state.variables})}const w=await t();return await((n=(i=this.mutationCache.config).onSuccess)==null?void 0:n.call(i,w,this.state.variables,this.state.context,this)),await((s=(o=this.options).onSuccess)==null?void 0:s.call(o,w,this.state.variables,this.state.context)),await((a=(c=this.mutationCache.config).onSettled)==null?void 0:a.call(c,w,null,this.state.variables,this.state.context,this)),await((d=(l=this.options).onSettled)==null?void 0:d.call(l,w,null,this.state.variables,this.state.context)),this.dispatch({type:"success",data:w}),w}catch(w){try{var g,E,b,v,I,N,L,U;throw await((g=(E=this.mutationCache.config).onError)==null?void 0:g.call(E,w,this.state.variables,this.state.context,this)),await((b=(v=this.options).onError)==null?void 0:b.call(v,w,this.state.variables,this.state.context)),await((I=(N=this.mutationCache.config).onSettled)==null?void 0:I.call(N,void 0,w,this.state.variables,this.state.context,this)),await((L=(U=this.options).onSettled)==null?void 0:L.call(U,void 0,w,this.state.variables,this.state.context)),w}finally{this.dispatch({type:"error",error:w})}}}dispatch(t){const r=n=>{switch(t.type){case"failed":return{...n,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"loading":return{...n,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:!NP(this.options.networkMode),status:"loading",variables:t.variables};case"success":return{...n,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:t.error,failureCount:n.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"};case"setState":return{...n,...t.state}}};this.state=r(this.state),ws.batch(()=>{this.observers.forEach(n=>{n.onMutationUpdate(t)}),this.mutationCache.notify({mutation:this,type:"updated",action:t})})}}function Mbe(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0}}class Ube extends Lw{constructor(t){super(),this.config=t||{},this.mutations=[],this.mutationId=0}build(t,r,n){const i=new xbe({mutationCache:this,logger:t.getLogger(),mutationId:++this.mutationId,options:t.defaultMutationOptions(r),state:n,defaultOptions:r.mutationKey?t.getMutationDefaults(r.mutationKey):void 0});return this.add(i),i}add(t){this.mutations.push(t),this.notify({type:"added",mutation:t})}remove(t){this.mutations=this.mutations.filter(r=>r!==t),this.notify({type:"removed",mutation:t})}clear(){ws.batch(()=>{this.mutations.forEach(t=>{this.remove(t)})})}getAll(){return this.mutations}find(t){return typeof t.exact>"u"&&(t.exact=!0),this.mutations.find(r=>N6(t,r))}findAll(t){return this.mutations.filter(r=>N6(t,r))}notify(t){ws.batch(()=>{this.listeners.forEach(({listener:r})=>{r(t)})})}resumePausedMutations(){var t;return this.resuming=((t=this.resuming)!=null?t:Promise.resolve()).then(()=>{const r=this.mutations.filter(n=>n.state.isPaused);return ws.batch(()=>r.reduce((n,i)=>n.then(()=>i.continue().catch(ec)),Promise.resolve()))}).then(()=>{this.resuming=void 0}),this.resuming}}function jbe(){return{onFetch:e=>{e.fetchFn=()=>{var t,r,n,i,s,o;const a=(t=e.fetchOptions)==null||(r=t.meta)==null?void 0:r.refetchPage,c=(n=e.fetchOptions)==null||(i=n.meta)==null?void 0:i.fetchMore,d=c==null?void 0:c.pageParam,l=(c==null?void 0:c.direction)==="forward",u=(c==null?void 0:c.direction)==="backward",h=((s=e.state.data)==null?void 0:s.pages)||[],p=((o=e.state.data)==null?void 0:o.pageParams)||[];let _=p,g=!1;const E=U=>{Object.defineProperty(U,"signal",{enumerable:!0,get:()=>{var w;if((w=e.signal)!=null&&w.aborted)g=!0;else{var V;(V=e.signal)==null||V.addEventListener("abort",()=>{g=!0})}return e.signal}})},b=e.options.queryFn||(()=>Promise.reject("Missing queryFn for queryKey '"+e.options.queryHash+"'")),v=(U,w,V,z)=>(_=z?[w,..._]:[..._,w],z?[V,...U]:[...U,V]),I=(U,w,V,z)=>{if(g)return Promise.reject("Cancelled");if(typeof V>"u"&&!w&&U.length)return Promise.resolve(U);const K={queryKey:e.queryKey,pageParam:V,meta:e.options.meta};E(K);const H=b(K);return Promise.resolve(H).then(m=>v(U,V,m,z))};let N;if(!h.length)N=I([]);else if(l){const U=typeof d<"u",w=U?d:x6(e.options,h);N=I(h,U,w)}else if(u){const U=typeof d<"u",w=U?d:Fbe(e.options,h);N=I(h,U,w,!0)}else{_=[];const U=typeof e.options.getNextPageParam>"u";N=(a&&h[0]?a(h[0],0,h):!0)?I([],U,p[0]):Promise.resolve(v([],p[0],h[0]));for(let V=1;V<h.length;V++)N=N.then(z=>{if(a&&h[V]?a(h[V],V,h):!0){const H=U?p[V]:x6(e.options,z);return I(z,U,H)}return Promise.resolve(v(z,p[V],h[V]))})}return N.then(U=>({pages:U,pageParams:_}))}}}}function x6(e,t){return e.getNextPageParam==null?void 0:e.getNextPageParam(t[t.length-1],t)}function Fbe(e,t){return e.getPreviousPageParam==null?void 0:e.getPreviousPageParam(t[0],t)}class Bbe{constructor(t={}){this.queryCache=t.queryCache||new Lbe,this.mutationCache=t.mutationCache||new Ube,this.logger=t.logger||DP,this.defaultOptions=t.defaultOptions||{},this.queryDefaults=[],this.mutationDefaults=[],this.mountCount=0}mount(){this.mountCount++,this.mountCount===1&&(this.unsubscribeFocus=_2.subscribe(()=>{_2.isFocused()&&(this.resumePausedMutations(),this.queryCache.onFocus())}),this.unsubscribeOnline=rS.subscribe(()=>{rS.isOnline()&&(this.resumePausedMutations(),this.queryCache.onOnline())}))}unmount(){var t,r;this.mountCount--,this.mountCount===0&&((t=this.unsubscribeFocus)==null||t.call(this),this.unsubscribeFocus=void 0,(r=this.unsubscribeOnline)==null||r.call(this),this.unsubscribeOnline=void 0)}isFetching(t,r){const[n]=Zl(t,r);return n.fetchStatus="fetching",this.queryCache.findAll(n).length}isMutating(t){return this.mutationCache.findAll({...t,fetching:!0}).length}getQueryData(t,r){var n;return(n=this.queryCache.find(t,r))==null?void 0:n.state.data}ensureQueryData(t,r,n){const i=zv(t,r,n),s=this.getQueryData(i.queryKey);return s?Promise.resolve(s):this.fetchQuery(i)}getQueriesData(t){return this.getQueryCache().findAll(t).map(({queryKey:r,state:n})=>{const i=n.data;return[r,i]})}setQueryData(t,r,n){const i=this.queryCache.find(t),s=i==null?void 0:i.state.data,o=wbe(r,s);if(typeof o>"u")return;const a=zv(t),c=this.defaultQueryOptions(a);return this.queryCache.build(this,c).setData(o,{...n,manual:!0})}setQueriesData(t,r,n){return ws.batch(()=>this.getQueryCache().findAll(t).map(({queryKey:i})=>[i,this.setQueryData(i,r,n)]))}getQueryState(t,r){var n;return(n=this.queryCache.find(t,r))==null?void 0:n.state}removeQueries(t,r){const[n]=Zl(t,r),i=this.queryCache;ws.batch(()=>{i.findAll(n).forEach(s=>{i.remove(s)})})}resetQueries(t,r,n){const[i,s]=Zl(t,r,n),o=this.queryCache,a={type:"active",...i};return ws.batch(()=>(o.findAll(i).forEach(c=>{c.reset()}),this.refetchQueries(a,s)))}cancelQueries(t,r,n){const[i,s={}]=Zl(t,r,n);typeof s.revert>"u"&&(s.revert=!0);const o=ws.batch(()=>this.queryCache.findAll(i).map(a=>a.cancel(s)));return Promise.all(o).then(ec).catch(ec)}invalidateQueries(t,r,n){const[i,s]=Zl(t,r,n);return ws.batch(()=>{var o,a;if(this.queryCache.findAll(i).forEach(d=>{d.invalidate()}),i.refetchType==="none")return Promise.resolve();const c={...i,type:(o=(a=i.refetchType)!=null?a:i.type)!=null?o:"active"};return this.refetchQueries(c,s)})}refetchQueries(t,r,n){const[i,s]=Zl(t,r,n),o=ws.batch(()=>this.queryCache.findAll(i).filter(c=>!c.isDisabled()).map(c=>{var d;return c.fetch(void 0,{...s,cancelRefetch:(d=s==null?void 0:s.cancelRefetch)!=null?d:!0,meta:{refetchPage:i.refetchPage}})}));let a=Promise.all(o).then(ec);return s!=null&&s.throwOnError||(a=a.catch(ec)),a}fetchQuery(t,r,n){const i=zv(t,r,n),s=this.defaultQueryOptions(i);typeof s.retry>"u"&&(s.retry=!1);const o=this.queryCache.build(this,s);return o.isStaleByTime(s.staleTime)?o.fetch(s):Promise.resolve(o.state.data)}prefetchQuery(t,r,n){return this.fetchQuery(t,r,n).then(ec).catch(ec)}fetchInfiniteQuery(t,r,n){const i=zv(t,r,n);return i.behavior=jbe(),this.fetchQuery(i)}prefetchInfiniteQuery(t,r,n){return this.fetchInfiniteQuery(t,r,n).then(ec).catch(ec)}resumePausedMutations(){return this.mutationCache.resumePausedMutations()}getQueryCache(){return this.queryCache}getMutationCache(){return this.mutationCache}getLogger(){return this.logger}getDefaultOptions(){return this.defaultOptions}setDefaultOptions(t){this.defaultOptions=t}setQueryDefaults(t,r){const n=this.queryDefaults.find(i=>Bh(t)===Bh(i.queryKey));n?n.defaultOptions=r:this.queryDefaults.push({queryKey:t,defaultOptions:r})}getQueryDefaults(t){if(!t)return;const r=this.queryDefaults.find(n=>tS(t,n.queryKey));return r==null?void 0:r.defaultOptions}setMutationDefaults(t,r){const n=this.mutationDefaults.find(i=>Bh(t)===Bh(i.mutationKey));n?n.defaultOptions=r:this.mutationDefaults.push({mutationKey:t,defaultOptions:r})}getMutationDefaults(t){if(!t)return;const r=this.mutationDefaults.find(n=>tS(t,n.mutationKey));return r==null?void 0:r.defaultOptions}defaultQueryOptions(t){if(t!=null&&t._defaulted)return t;const r={...this.defaultOptions.queries,...this.getQueryDefaults(t==null?void 0:t.queryKey),...t,_defaulted:!0};return!r.queryHash&&r.queryKey&&(r.queryHash=OP(r.queryKey,r)),typeof r.refetchOnReconnect>"u"&&(r.refetchOnReconnect=r.networkMode!=="always"),typeof r.useErrorBoundary>"u"&&(r.useErrorBoundary=!!r.suspense),r}defaultMutationOptions(t){return t!=null&&t._defaulted?t:{...this.defaultOptions.mutations,...this.getMutationDefaults(t==null?void 0:t.mutationKey),...t,_defaulted:!0}}clear(){this.queryCache.clear(),this.mutationCache.clear()}}const M6=me.createContext(void 0),Vbe=me.createContext(!1);function $be(e,t){return e||(t&&typeof window<"u"?(window.ReactQueryClientContext||(window.ReactQueryClientContext=M6),window.ReactQueryClientContext):M6)}const Hbe=({client:e,children:t,context:r,contextSharing:n=!1})=>{me.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]);const i=$be(r,n);return me.createElement(Vbe.Provider,{value:!r&&n},me.createElement(i.Provider,{value:e},t))},zbe=function(){return null};function Wbe(e){me.useEffect(()=>(vd().then(t=>{t.onSessionExpire(e)}),()=>{vd().then(t=>{t.offSessionExpire(e)})}),[e])}function Gbe(){const[e,t]=me.useState(void 0);return Bye(r=>{r.topic===(e==null?void 0:e.topic)&&t(void 0)}),Vye(r=>{if(e&&r.topic===(e==null?void 0:e.topic)){const{namespaces:n}=r.params,i={...e,namespaces:n};t(i)}}),Wbe(r=>{e&&r.topic===(e==null?void 0:e.topic)&&t(void 0)}),me.useEffect(()=>{async function r(){const i=await(await vd()).getSession();t(i)}return r(),gb.on("session_change",r),()=>{gb.off&&gb.off("session_change",r)}},[]),e}const FG=new Bbe,qbe=me.createContext(void 0),Kbe=({dAppName:e,dAppDescription:t,dAppUrl:r,dAppIconURL:n,children:i,debugQuery:s=!1})=>{const[o,a]=me.useState(void 0),c=Gbe();return me.useEffect(()=>{a(c)},[c]),me.useEffect(()=>{CG({dAppName:e,dAppDescription:t,dAppUrl:r,dAppIconURL:n,onDisconnect:Sbe.getState().onDisconnect}),aw.defaultMaxListeners=100},[]),O.jsx(qbe.Provider,{value:o,children:O.jsxs(Hbe,{client:FG,children:[s&&O.jsx(zbe,{initialIsOpen:!1}),i]})})};function Ybe(){me.useState({});const[e,t]=me.useState(!1),[r,n]=me.useState(),[i,s]=me.useState(),[o,a]=me.useState(),[c,d]=me.useState(0),l={programId:"credits.aleo",type:"all"},u=async()=>{t(!0),n(void 0);try{const h=await kye({filter:l,address:"aleo1hrkenfzu8du4aj5u7v8cshgq0lkfl4ttu52gpgct9zcww4vgvvxsx3xcy8"});console.log("Response:",h),h&&h.records?(a(h.records),d(h.pageCount)):(a([]),n("No records found for the specified address and filter."));const p={Deploy:"Deploy",Execute:"Execute",Send:"Send",Join:"Join",Split:"Split",Shield:"Shield",Unshield:"Unshield"};Object.freeze(p);const _={address:"aleo1hdn7ts6e8lpt768gaqz57e4hq8rvmuesfpms7hfes5l886gezs9s3p4wqd",type:p.Send,programId:"credits.aleo",functionId:"transfer_private",fee:.053613,inputs:[h.records?h.records[0]:null,"aleo1hdn7ts6e8lpt768gaqz57e4hq8rvmuesfpms7hfes5l886gezs9s3p4wqd","1u64"]};if(!h.records||h.records.length===0){n("No available records to create an event.");return}const g=await Pye(_);g.error?n(g.error):s(g.eventId)}catch(h){n(h.message)}finally{t(!1)}};return O.jsx(O.Fragment,{children:O.jsxs("div",{style:{color:"white",width:"80%",marginTop:0,float:"left"},children:[O.jsxs("div",{style:{display:"flex",marginTop:20},children:[O.jsx(tr,{to:"/options",style:{textDecoration:"none"},children:O.jsx("p",{style:{width:"17%",whiteSpace:"nowrap"},children:" Back"})}),O.jsx("p",{style:{width:"80%"},children:O.jsx("b",{children:"Buy Asset"})})]}),O.jsx("img",{src:jH,style:{height:117,width:117,borderRadius:12}}),O.jsx("p",{children:O.jsx("b",{children:"Pa Salieu: Betty"})}),O.jsx("audio",{loop:!0,src:Nie,controls:!0,style:{height:20,width:200}}),O.jsx("div",{style:{marginTop:20,marginLeft:15,marginRight:15,whiteSpace:"wrap",overflowY:"auto",height:245},children:O.jsxs("div",{children:[O.jsx("button",{onClick:u,disabled:e,children:"create event"}),i&&O.jsxs("p",{children:["event pending: ",i]}),r&&!e?O.jsxs("p",{children:["error creating event: ",r]}):null,O.jsx("br",{}),Array.isArray(o)&&O.jsxs("div",{children:[O.jsxs("p",{children:["there are ",c," pages of records"]}),o.map((h,p)=>O.jsx("p",{children:h.plaintext},p))]}),r&&O.jsxs("p",{children:["error fetching records: ",r]})]})})]})})}function Jbe(){return O.jsx(O.Fragment,{children:O.jsxs("center",{children:[O.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",width:"50%",minWidth:300,height:"100%",backgroundColor:"rgb(119, 63, 248)",borderRadius:40},children:[O.jsx(Ybe,{}),O.jsx(mo,{})]}),O.jsx(mi,{})]})})}function BG(e){return O.jsx(O.Fragment,{children:O.jsx(tr,{to:"/formabonditem",style:{textDecoration:"none"},children:O.jsxs("div",{className:"formAbond-element",style:{lineHeight:.9,borderRadius:12,color:"black",cursor:"pointer"},children:[O.jsx("img",{src:e.bgImg,className:"formABondImage"}),O.jsxs("div",{className:"formABondImageContent",children:[O.jsxs("div",{style:{display:"flex",justifyContent:"end"},children:[O.jsx("p",{style:{fontSize:14,paddingRight:4,color:"white"},children:O.jsx("b",{children:e.username})}),O.jsx(tr,{to:"/profile",style:{textDecoration:"none"},children:O.jsx("img",{src:e.profileImg,style:{borderRadius:19,width:38,height:38,marginTop:16,marginRight:12}})})]}),O.jsxs("p",{style:{fontSize:14,color:"white"},children:[e.artistName,": ",O.jsx("br",{}),O.jsx("b",{children:e.songTitle})]})]})]})})})}const VG="/assets/ojiims-BMUtWZX7.jpg";function Xbe(){const e=UH.map(t=>O.jsx(BG,{bgImg:t.bgImg,profileImg:t.profileImg,artistName:t.artistName,songTitle:t.songTitle,username:t.username}));return O.jsx(O.Fragment,{children:O.jsxs("div",{style:{color:"white",width:"80%",marginTop:0,float:"left"},children:[O.jsxs("div",{style:{display:"flex",marginTop:20},children:[O.jsx(tr,{to:"/home",style:{textDecoration:"none"},children:O.jsx("p",{style:{width:"17%",whiteSpace:"nowrap"},children:" Back"})}),O.jsx("div",{style:{width:"80%",marginTop:2},children:O.jsx("p",{children:O.jsx("b",{children:"Form a Bond"})})})]}),O.jsx("div",{style:{overflowY:"auto",lineHeight:.1,paddingTop:36,paddingBottom:30},children:O.jsx("input",{type:"text",placeholder:"search with name of song or name of artist or bonds username",style:{width:200,height:20,fontSize:12,padding:6,border:"1px solid yellow"}})}),O.jsx("div",{style:{overflowY:"auto",display:"flow",height:400},children:O.jsx("div",{className:"formABond-Item-Container",children:e})})]})})}function Qbe(){return O.jsx(O.Fragment,{children:O.jsx("div",{children:O.jsxs("center",{children:[O.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",width:"50%",minWidth:300,height:"100%",backgroundColor:"rgb(119, 63, 248)",borderRadius:40},children:[O.jsx(Xbe,{}),O.jsx(mo,{})]}),O.jsx(mi,{})]})})})}const Zbe="/assets/taller-PL4ShGch.png",$G="/assets/bluesea-D1yhAFgR.png",e1e="/assets/ojiims-UTSl2g6o.mp4";function t1e(e,t){return t.forEach(function(r){r&&typeof r!="string"&&!Array.isArray(r)&&Object.keys(r).forEach(function(n){if(n!=="default"&&!(n in e)){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}})}),Object.freeze(e)}var cm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Pr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var en=function(e){try{return!!e()}catch{return!0}},Mw=!en(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),HG=Mw,zG=Function.prototype,E2=zG.call,r1e=HG&&zG.bind.bind(E2,E2),Jr=HG?r1e:function(e){return function(){return E2.apply(e,arguments)}},ki=Jr({}.isPrototypeOf),Wv=function(e){return e&&e.Math==Math&&e},an=Wv(typeof globalThis=="object"&&globalThis)||Wv(typeof window=="object"&&window)||Wv(typeof self=="object"&&self)||Wv(typeof cm=="object"&&cm)||function(){return this}()||cm||Function("return this")(),n1e=Mw,WG=Function.prototype,U6=WG.apply,j6=WG.call,Uw=typeof Reflect=="object"&&Reflect.apply||(n1e?j6.bind(U6):function(){return j6.apply(U6,arguments)}),GG=Jr,i1e=GG({}.toString),s1e=GG("".slice),Ad=function(e){return s1e(i1e(e),8,-1)},o1e=Ad,a1e=Jr,iE=function(e){if(o1e(e)==="Function")return a1e(e)},qR=typeof document=="object"&&document.all,jw={all:qR,IS_HTMLDDA:qR===void 0&&qR!==void 0},c1e=jw.all,Nn=jw.IS_HTMLDDA?function(e){return typeof e=="function"||e===c1e}:function(e){return typeof e=="function"},XE={},qo=!en(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),d1e=Mw,Gv=Function.prototype.call,$n=d1e?Gv.bind(Gv):function(){return Gv.apply(Gv,arguments)},Fw={},qG={}.propertyIsEnumerable,KG=Object.getOwnPropertyDescriptor,l1e=KG&&!qG.call({1:2},1);Fw.f=l1e?function(e){var t=KG(this,e);return!!t&&t.enumerable}:qG;var Ml,_b,Qu=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},u1e=en,h1e=Ad,KR=Object,f1e=Jr("".split),Bw=u1e(function(){return!KR("z").propertyIsEnumerable(0)})?function(e){return h1e(e)=="String"?f1e(e,""):KR(e)}:KR,E0=function(e){return e==null},p1e=E0,m1e=TypeError,v0=function(e){if(p1e(e))throw m1e("Can't call method on "+e);return e},g1e=Bw,_1e=v0,Zu=function(e){return g1e(_1e(e))},F6=Nn,E1e=jw.all,Eo=jw.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:F6(e)||e===E1e}:function(e){return typeof e=="object"?e!==null:F6(e)},Ko={},YR=Ko,JR=an,v1e=Nn,B6=function(e){return v1e(e)?e:void 0},ks=function(e,t){return arguments.length<2?B6(YR[e])||B6(JR[e]):YR[e]&&YR[e][t]||JR[e]&&JR[e][t]},eh=typeof navigator<"u"&&String(navigator.userAgent)||"",YG=an,XR=eh,V6=YG.process,$6=YG.Deno,H6=V6&&V6.versions||$6&&$6.version,z6=H6&&H6.v8;z6&&(_b=(Ml=z6.split("."))[0]>0&&Ml[0]<4?1:+(Ml[0]+Ml[1])),!_b&&XR&&(!(Ml=XR.match(/Edge\/(\d+)/))||Ml[1]>=74)&&(Ml=XR.match(/Chrome\/(\d+)/))&&(_b=+Ml[1]);var vf=_b,W6=vf,y1e=en,b1e=an.String,y0=!!Object.getOwnPropertySymbols&&!y1e(function(){var e=Symbol();return!b1e(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&W6&&W6<41}),JG=y0&&!Symbol.sham&&typeof Symbol.iterator=="symbol",S1e=ks,w1e=Nn,T1e=ki,R1e=Object,QE=JG?function(e){return typeof e=="symbol"}:function(e){var t=S1e("Symbol");return w1e(t)&&T1e(t.prototype,R1e(e))},A1e=String,b0=function(e){try{return A1e(e)}catch{return"Object"}},C1e=Nn,I1e=b0,O1e=TypeError,Yo=function(e){if(C1e(e))return e;throw O1e(I1e(e)+" is not a function")},N1e=Yo,D1e=E0,Vw=function(e,t){var r=e[t];return D1e(r)?void 0:N1e(r)},G6=$n,q6=Nn,K6=Eo,P1e=TypeError,XG={exports:{}},Y6=an,k1e=Object.defineProperty,L1e=function(e,t){try{k1e(Y6,e,{value:t,configurable:!0,writable:!0})}catch{Y6[e]=t}return t},J6="__core-js_shared__",PP=an[J6]||L1e(J6,{}),X6=PP;(XG.exports=function(e,t){return X6[e]||(X6[e]=t!==void 0?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var S0=XG.exports,x1e=v0,M1e=Object,Cd=function(e){return M1e(x1e(e))},U1e=Cd,j1e=Jr({}.hasOwnProperty),Xn=Object.hasOwn||function(e,t){return j1e(U1e(e),t)},F1e=Jr,B1e=0,V1e=Math.random(),$1e=F1e(1 .toString),kP=function(e){return"Symbol("+(e===void 0?"":e)+")_"+$1e(++B1e+V1e,36)},H1e=S0,Q6=Xn,z1e=kP,W1e=y0,G1e=JG,Bp=an.Symbol,QR=H1e("wks"),q1e=G1e?Bp.for||Bp:Bp&&Bp.withoutSetter||z1e,qr=function(e){return Q6(QR,e)||(QR[e]=W1e&&Q6(Bp,e)?Bp[e]:q1e("Symbol."+e)),QR[e]},K1e=$n,Z6=Eo,e5=QE,Y1e=Vw,J1e=function(e,t){var r,n;if(q6(r=e.toString)&&!K6(n=G6(r,e))||q6(r=e.valueOf)&&!K6(n=G6(r,e)))return n;throw P1e("Can't convert object to primitive value")},X1e=TypeError,Q1e=qr("toPrimitive"),Z1e=function(e,t){if(!Z6(e)||e5(e))return e;var r,n=Y1e(e,Q1e);if(n){if(r=K1e(n,e,t),!Z6(r)||e5(r))return r;throw X1e("Can't convert object to primitive value")}return J1e(e)},eSe=QE,$w=function(e){var t=Z1e(e,"string");return eSe(t)?t:t+""},t5=Eo,v2=an.document,tSe=t5(v2)&&t5(v2.createElement),LP=function(e){return tSe?v2.createElement(e):{}},rSe=LP,QG=!qo&&!en(function(){return Object.defineProperty(rSe("div"),"a",{get:function(){return 7}}).a!=7}),nSe=qo,iSe=$n,sSe=Fw,oSe=Qu,aSe=Zu,cSe=$w,dSe=Xn,lSe=QG,r5=Object.getOwnPropertyDescriptor;XE.f=nSe?r5:function(e,t){if(e=aSe(e),t=cSe(t),lSe)try{return r5(e,t)}catch{}if(dSe(e,t))return oSe(!iSe(sSe.f,e,t),e[t])};var uSe=en,hSe=Nn,fSe=/#|\.prototype\./,ZE=function(e,t){var r=mSe[pSe(e)];return r==_Se||r!=gSe&&(hSe(t)?uSe(t):!!t)},pSe=ZE.normalize=function(e){return String(e).replace(fSe,".").toLowerCase()},mSe=ZE.data={},gSe=ZE.NATIVE="N",_Se=ZE.POLYFILL="P",ZG=ZE,ESe=Yo,vSe=Mw,ySe=iE(iE.bind),th=function(e,t){return ESe(e),t===void 0?e:vSe?ySe(e,t):function(){return e.apply(t,arguments)}},Ua={},eq=qo&&en(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),bSe=Eo,SSe=String,wSe=TypeError,hs=function(e){if(bSe(e))return e;throw wSe(SSe(e)+" is not an object")},TSe=qo,RSe=QG,ASe=eq,qv=hs,n5=$w,CSe=TypeError,ZR=Object.defineProperty,ISe=Object.getOwnPropertyDescriptor,eA="enumerable",tA="configurable",rA="writable";Ua.f=TSe?ASe?function(e,t,r){if(qv(e),t=n5(t),qv(r),typeof e=="function"&&t==="prototype"&&"value"in r&&rA in r&&!r[rA]){var n=ISe(e,t);n&&n[rA]&&(e[t]=r.value,r={configurable:tA in r?r[tA]:n[tA],enumerable:eA in r?r[eA]:n[eA],writable:!1})}return ZR(e,t,r)}:ZR:function(e,t,r){if(qv(e),t=n5(t),qv(r),RSe)try{return ZR(e,t,r)}catch{}if("get"in r||"set"in r)throw CSe("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var OSe=Ua,NSe=Qu,rh=qo?function(e,t,r){return OSe.f(e,t,NSe(1,r))}:function(e,t,r){return e[t]=r,e},Kv=an,DSe=Uw,PSe=iE,kSe=Nn,LSe=XE.f,xSe=ZG,Jf=Ko,MSe=th,Xf=rh,i5=Xn,USe=function(e){var t=function(r,n,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,n)}return new e(r,n,i)}return DSe(e,this,arguments)};return t.prototype=e.prototype,t},Jt=function(e,t){var r,n,i,s,o,a,c,d,l,u=e.target,h=e.global,p=e.stat,_=e.proto,g=h?Kv:p?Kv[u]:(Kv[u]||{}).prototype,E=h?Jf:Jf[u]||Xf(Jf,u,{})[u],b=E.prototype;for(s in t)n=!(r=xSe(h?s:u+(p?".":"#")+s,e.forced))&&g&&i5(g,s),a=E[s],n&&(c=e.dontCallGetSet?(l=LSe(g,s))&&l.value:g[s]),o=n&&c?c:t[s],n&&typeof a==typeof o||(d=e.bind&&n?MSe(o,Kv):e.wrap&&n?USe(o):_&&kSe(o)?PSe(o):o,(e.sham||o&&o.sham||a&&a.sham)&&Xf(d,"sham",!0),Xf(E,s,d),_&&(i5(Jf,i=u+"Prototype")||Xf(Jf,i,{}),Xf(Jf[i],s,o),e.real&&b&&(r||!b[s])&&Xf(b,s,o)))},jSe=Math.ceil,FSe=Math.floor,BSe=Math.trunc||function(e){var t=+e;return(t>0?FSe:jSe)(t)},VSe=BSe,xP=function(e){var t=+e;return t!=t||t===0?0:VSe(t)},$Se=xP,HSe=Math.max,zSe=Math.min,MP=function(e,t){var r=$Se(e);return r<0?HSe(r+t,0):zSe(r,t)},WSe=xP,GSe=Math.min,tq=function(e){return e>0?GSe(WSe(e),9007199254740991):0},qSe=tq,Ol=function(e){return qSe(e.length)},KSe=Zu,YSe=MP,JSe=Ol,s5=function(e){return function(t,r,n){var i,s=KSe(t),o=JSe(s),a=YSe(n,o);if(e&&r!=r){for(;o>a;)if((i=s[a++])!=i)return!0}else for(;o>a;a++)if((e||a in s)&&s[a]===r)return e||a||0;return!e&&-1}},UP={includes:s5(!0),indexOf:s5(!1)},XSe=UP.includes;Jt({target:"Array",proto:!0,forced:en(function(){return!Array(1).includes()})},{includes:function(e){return XSe(this,e,arguments.length>1?arguments[1]:void 0)}});var QSe=Ko,ja=function(e){return QSe[e+"Prototype"]},ZSe=ja("Array").includes,ewe=Eo,twe=Ad,rwe=qr("match"),rq=function(e){var t;return ewe(e)&&((t=e[rwe])!==void 0?!!t:twe(e)=="RegExp")},nwe=rq,iwe=TypeError,nq={};nq[qr("toStringTag")]="z";var jP=String(nq)==="[object z]",swe=jP,owe=Nn,Eb=Ad,awe=qr("toStringTag"),cwe=Object,dwe=Eb(function(){return arguments}())=="Arguments",Id=swe?Eb:function(e){var t,r,n;return e===void 0?"Undefined":e===null?"Null":typeof(r=function(i,s){try{return i[s]}catch{}}(t=cwe(e),awe))=="string"?r:dwe?Eb(t):(n=Eb(t))=="Object"&&owe(t.callee)?"Arguments":n},lwe=Id,uwe=String,Jo=function(e){if(lwe(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return uwe(e)},hwe=qr("match"),fwe=Jt,pwe=function(e){if(nwe(e))throw iwe("The method doesn't accept regular expressions");return e},mwe=v0,o5=Jo,gwe=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[hwe]=!1,"/./"[e](t)}catch{}}return!1},_we=Jr("".indexOf);fwe({target:"String",proto:!0,forced:!gwe("includes")},{includes:function(e){return!!~_we(o5(mwe(this)),o5(pwe(e)),arguments.length>1?arguments[1]:void 0)}});var Ewe=ja("String").includes,a5=ki,vwe=ZSe,ywe=Ewe,nA=Array.prototype,iA=String.prototype,bwe=function(e){var t=e.includes;return e===nA||a5(nA,e)&&t===nA.includes?vwe:typeof e=="string"||e===iA||a5(iA,e)&&t===iA.includes?ywe:t},Ee=Pr(bwe),Swe=Yo,wwe=Cd,Twe=Bw,Rwe=Ol,Awe=TypeError,c5=function(e){return function(t,r,n,i){Swe(r);var s=wwe(t),o=Twe(s),a=Rwe(s),c=e?a-1:0,d=e?-1:1;if(n<2)for(;;){if(c in o){i=o[c],c+=d;break}if(c+=d,e?c<0:a<=c)throw Awe("Reduce of empty array with no initial value")}for(;e?c>=0:a>c;c+=d)c in o&&(i=r(i,o[c],c,s));return i}},Cwe={left:c5(!1),right:c5(!0)},Iwe=en,Hw=function(e,t){var r=[][e];return!!r&&Iwe(function(){r.call(null,t||function(){return 1},1)})},w0=typeof process<"u"&&Ad(process)=="process",Owe=Cwe.left;Jt({target:"Array",proto:!0,forced:!w0&&vf>79&&vf<83||!Hw("reduce")},{reduce:function(e){var t=arguments.length;return Owe(this,e,t,t>1?arguments[1]:void 0)}});var Nwe=ja("Array").reduce,Dwe=ki,Pwe=Nwe,sA=Array.prototype,kwe=function(e){var t=e.reduce;return e===sA||Dwe(sA,e)&&t===sA.reduce?Pwe:t},iq=kwe,yc=Pr(iq);let sq=!0,oq=!0;function Yv(e,t,r){const n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function Uf(e,t,r){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(o,a){if(o!==t)return i.apply(this,arguments);const c=d=>{const l=r(d);l&&(a.handleEvent?a.handleEvent(l):a(l))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(a,c),i.apply(this,[o,c])};const s=n.removeEventListener;n.removeEventListener=function(o,a){if(o!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(a))return s.apply(this,arguments);const c=this._eventMap[t].get(a);return this._eventMap[t].delete(a),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,c])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(o){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),o&&this.addEventListener(t,this["_on"+t]=o)},enumerable:!0,configurable:!0})}function Lwe(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(sq=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function xwe(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(oq=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function aq(){if(typeof window=="object"){if(sq)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function FP(e,t){oq&&console.warn(e+" is deprecated, please use "+t+" instead.")}function d5(e){return Object.prototype.toString.call(e)==="[object Object]"}function cq(e){var t;return d5(e)?yc(t=Object.keys(e)).call(t,function(r,n){const i=d5(e[n]),s=i?cq(e[n]):e[n],o=i&&!Object.keys(s).length;return s===void 0||o?r:Object.assign(r,{[n]:s})},{}):e}function y2(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach(n=>{n.endsWith("Id")?y2(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach(i=>{y2(e,e.get(i),r)})}))}function l5(e,t,r){const n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;const s=[];return e.forEach(o=>{o.type==="track"&&o.trackIdentifier===t.id&&s.push(o)}),s.forEach(o=>{e.forEach(a=>{a.type===n&&a.trackId===o.id&&y2(e,a,i)})}),i}var Mwe=kP,u5=S0("keys"),zw=function(e){return u5[e]||(u5[e]=Mwe(e))},Uwe=!en(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),jwe=Xn,Fwe=Nn,Bwe=Cd,Vwe=Uwe,h5=zw("IE_PROTO"),b2=Object,$we=b2.prototype,BP=Vwe?b2.getPrototypeOf:function(e){var t=Bwe(e);if(jwe(t,h5))return t[h5];var r=t.constructor;return Fwe(r)&&t instanceof r?r.prototype:t instanceof b2?$we:null},Hwe=Jr,zwe=Yo,Wwe=Nn,Gwe=String,qwe=TypeError,Kwe=function(e,t,r){try{return Hwe(zwe(Object.getOwnPropertyDescriptor(e,t)[r]))}catch{}},Ywe=hs,Jwe=function(e){if(typeof e=="object"||Wwe(e))return e;throw qwe("Can't set "+Gwe(e)+" as a prototype")},Xwe=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Kwe(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch{}return function(n,i){return Ywe(n),Jwe(i),t?e(n,i):n.__proto__=i,n}}():void 0),Ww={},Gw={},oA=Xn,Qwe=Zu,Zwe=UP.indexOf,eTe=Gw,f5=Jr([].push),dq=function(e,t){var r,n=Qwe(e),i=0,s=[];for(r in n)!oA(eTe,r)&&oA(n,r)&&f5(s,r);for(;t.length>i;)oA(n,r=t[i++])&&(~Zwe(s,r)||f5(s,r));return s},VP=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],tTe=dq,rTe=VP.concat("length","prototype");Ww.f=Object.getOwnPropertyNames||function(e){return tTe(e,rTe)};var ev={};ev.f=Object.getOwnPropertySymbols;var nTe=ks,iTe=Ww,sTe=ev,oTe=hs,aTe=Jr([].concat),cTe=nTe("Reflect","ownKeys")||function(e){var t=iTe.f(oTe(e)),r=sTe.f;return r?aTe(t,r(e)):t},p5=Xn,dTe=cTe,lTe=XE,uTe=Ua,$P={},hTe=dq,fTe=VP,qw=Object.keys||function(e){return hTe(e,fTe)},pTe=qo,mTe=eq,gTe=Ua,_Te=hs,ETe=Zu,vTe=qw;$P.f=pTe&&!mTe?Object.defineProperties:function(e,t){_Te(e);for(var r,n=ETe(t),i=vTe(t),s=i.length,o=0;s>o;)gTe.f(e,r=i[o++],n[r]);return e};var Jv,lq=ks("document","documentElement"),yTe=hs,bTe=$P,m5=VP,STe=Gw,wTe=lq,TTe=LP,S2="prototype",w2="script",uq=zw("IE_PROTO"),aA=function(){},hq=function(e){return"<"+w2+">"+e+"</"+w2+">"},g5=function(e){e.write(hq("")),e.close();var t=e.parentWindow.Object;return e=null,t},vb=function(){try{Jv=new ActiveXObject("htmlfile")}catch{}var e,t,r;vb=typeof document<"u"?document.domain&&Jv?g5(Jv):(t=TTe("iframe"),r="java"+w2+":",t.style.display="none",wTe.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(hq("document.F=Object")),e.close(),e.F):g5(Jv);for(var n=m5.length;n--;)delete vb[S2][m5[n]];return vb()};STe[uq]=!0;var tv=Object.create||function(e,t){var r;return e!==null?(aA[S2]=yTe(e),r=new aA,aA[S2]=null,r[uq]=e):r=vb(),t===void 0?r:bTe.f(r,t)},RTe=Eo,ATe=rh,fq=Error,CTe=Jr("".replace),ITe=String(fq("zxcasd").stack),pq=/\n\s*at [^:]*:[^\n]*/,OTe=pq.test(ITe),NTe=Qu,DTe=!en(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",NTe(1,7)),e.stack!==7)}),PTe=rh,kTe=function(e,t){if(OTe&&typeof e=="string"&&!fq.prepareStackTrace)for(;t--;)e=CTe(e,pq,"");return e},LTe=DTe,_5=Error.captureStackTrace,jf={},xTe=jf,MTe=qr("iterator"),UTe=Array.prototype,mq=function(e){return e!==void 0&&(xTe.Array===e||UTe[MTe]===e)},jTe=Id,E5=Vw,FTe=E0,BTe=jf,VTe=qr("iterator"),Kw=function(e){if(!FTe(e))return E5(e,VTe)||E5(e,"@@iterator")||BTe[jTe(e)]},$Te=$n,HTe=Yo,zTe=hs,WTe=b0,GTe=Kw,qTe=TypeError,HP=function(e,t){var r=arguments.length<2?GTe(e):t;if(HTe(r))return zTe($Te(r,e));throw qTe(WTe(e)+" is not iterable")},KTe=$n,v5=hs,YTe=Vw,gq=function(e,t,r){var n,i;v5(e);try{if(!(n=YTe(e,"return"))){if(t==="throw")throw r;return r}n=KTe(n,e)}catch(s){i=!0,n=s}if(t==="throw")throw r;if(i)throw n;return v5(n),r},JTe=th,XTe=$n,QTe=hs,ZTe=b0,eRe=mq,tRe=Ol,y5=ki,rRe=HP,nRe=Kw,b5=gq,iRe=TypeError,yb=function(e,t){this.stopped=e,this.result=t},S5=yb.prototype,rv=function(e,t,r){var n,i,s,o,a,c,d,l=r&&r.that,u=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),_=!(!r||!r.INTERRUPTED),g=JTe(t,l),E=function(v){return n&&b5(n,"normal",v),new yb(!0,v)},b=function(v){return u?(QTe(v),_?g(v[0],v[1],E):g(v[0],v[1])):_?g(v,E):g(v)};if(h)n=e.iterator;else if(p)n=e;else{if(!(i=nRe(e)))throw iRe(ZTe(e)+" is not iterable");if(eRe(i)){for(s=0,o=tRe(e);o>s;s++)if((a=b(e[s]))&&y5(S5,a))return a;return new yb(!1)}n=rRe(e,i)}for(c=h?e.next:n.next;!(d=XTe(c,n)).done;){try{a=b(d.value)}catch(v){b5(n,"throw",v)}if(typeof a=="object"&&a&&y5(S5,a))return a}return new yb(!1)},sRe=Jo,oRe=Jt,aRe=ki,cRe=BP,nS=Xwe,dRe=function(e,t,r){for(var n=dTe(t),i=uTe.f,s=lTe.f,o=0;o<n.length;o++){var a=n[o];p5(e,a)||r&&p5(r,a)||i(e,a,s(t,a))}},_q=tv,cA=rh,dA=Qu,lRe=function(e,t){RTe(t)&&"cause"in t&&ATe(e,"cause",t.cause)},uRe=function(e,t,r,n){LTe&&(_5?_5(e,t):PTe(e,"stack",kTe(r,n)))},hRe=rv,fRe=function(e,t){return e===void 0?arguments.length<2?"":t:sRe(e)},pRe=qr("toStringTag"),iS=Error,mRe=[].push,Mm=function(e,t){var r,n=aRe(lA,this);nS?r=nS(iS(),n?cRe(this):lA):(r=n?this:_q(lA),cA(r,pRe,"Error")),t!==void 0&&cA(r,"message",fRe(t)),uRe(r,Mm,r.stack,1),arguments.length>2&&lRe(r,arguments[2]);var i=[];return hRe(e,mRe,{that:i}),cA(r,"errors",i),r};nS?nS(Mm,iS):dRe(Mm,iS,{name:!0});var lA=Mm.prototype=_q(iS.prototype,{constructor:dA(1,Mm),message:dA(1,""),name:dA(1,"AggregateError")});oRe({global:!0,constructor:!0,arity:2},{AggregateError:Mm});var sS,n_,oS,gRe=Nn,w5=an.WeakMap,_Re=gRe(w5)&&/native code/.test(String(w5)),Eq=an,ERe=Eo,vRe=rh,uA=Xn,hA=PP,yRe=zw,bRe=Gw,T5="Object already initialized",T2=Eq.TypeError,SRe=Eq.WeakMap;if(_Re||hA.state){var Nc=hA.state||(hA.state=new SRe);Nc.get=Nc.get,Nc.has=Nc.has,Nc.set=Nc.set,sS=function(e,t){if(Nc.has(e))throw T2(T5);return t.facade=e,Nc.set(e,t),t},n_=function(e){return Nc.get(e)||{}},oS=function(e){return Nc.has(e)}}else{var Qf=yRe("state");bRe[Qf]=!0,sS=function(e,t){if(uA(e,Qf))throw T2(T5);return t.facade=e,vRe(e,Qf,t),t},n_=function(e){return uA(e,Qf)?e[Qf]:{}},oS=function(e){return uA(e,Qf)}}var rf,R5,A5,Ff={set:sS,get:n_,has:oS,enforce:function(e){return oS(e)?n_(e):sS(e,{})},getterFor:function(e){return function(t){var r;if(!ERe(t)||(r=n_(t)).type!==e)throw T2("Incompatible receiver, "+e+" required");return r}}},R2=qo,wRe=Xn,vq=Function.prototype,TRe=R2&&Object.getOwnPropertyDescriptor,fA=wRe(vq,"name"),yq={EXISTS:fA,PROPER:fA&&(function(){}).name==="something",CONFIGURABLE:fA&&(!R2||R2&&TRe(vq,"name").configurable)},RRe=rh,nh=function(e,t,r,n){return n&&n.enumerable?e[t]=r:RRe(e,t,r),e},ARe=en,CRe=Nn,IRe=Eo,ORe=tv,C5=BP,NRe=nh,A2=qr("iterator"),bq=!1;[].keys&&("next"in(A5=[].keys())?(R5=C5(C5(A5)))!==Object.prototype&&(rf=R5):bq=!0);var DRe=!IRe(rf)||ARe(function(){var e={};return rf[A2].call(e)!==e});CRe((rf=DRe?{}:ORe(rf))[A2])||NRe(rf,A2,function(){return this});var Sq={IteratorPrototype:rf,BUGGY_SAFARI_ITERATORS:bq},PRe=Id,kRe=jP?{}.toString:function(){return"[object "+PRe(this)+"]"},LRe=jP,xRe=Ua.f,MRe=rh,URe=Xn,jRe=kRe,I5=qr("toStringTag"),ih=function(e,t,r,n){if(e){var i=r?e:e.prototype;URe(i,I5)||xRe(i,I5,{configurable:!0,value:t}),n&&!LRe&&MRe(i,"toString",jRe)}},FRe=Sq.IteratorPrototype,BRe=tv,VRe=Qu,$Re=ih,HRe=jf,zRe=function(){return this},zP=function(e,t,r,n){var i=t+" Iterator";return e.prototype=BRe(FRe,{next:VRe(+!n,r)}),$Re(e,i,!1,!0),HRe[i]=zRe,e},WRe=Jt,GRe=$n,qRe=yq,KRe=zP,YRe=BP,JRe=ih,O5=nh,N5=jf,XRe=Sq,QRe=qRe.PROPER,Xv=XRe.BUGGY_SAFARI_ITERATORS,pA=qr("iterator"),D5="keys",Qv="values",P5="entries",ZRe=function(){return this},wq=function(e,t,r,n,i,s,o){KRe(r,t,n);var a,c,d,l=function(b){if(b===i&&g)return g;if(!Xv&&b in p)return p[b];switch(b){case D5:case Qv:case P5:return function(){return new r(this,b)}}return function(){return new r(this)}},u=t+" Iterator",h=!1,p=e.prototype,_=p[pA]||p["@@iterator"]||i&&p[i],g=!Xv&&_||l(i),E=t=="Array"&&p.entries||_;if(E&&(a=YRe(E.call(new e)))!==Object.prototype&&a.next&&(JRe(a,u,!0,!0),N5[u]=ZRe),QRe&&i==Qv&&_&&_.name!==Qv&&(h=!0,g=function(){return GRe(_,this)}),i)if(c={values:l(Qv),keys:s?g:l(D5),entries:l(P5)},o)for(d in c)(Xv||h||!(d in p))&&O5(p,d,c[d]);else WRe({target:t,proto:!0,forced:Xv||h},c);return o&&p[pA]!==g&&O5(p,pA,g,{name:i}),N5[t]=g,c},WP=function(e,t){return{value:e,done:t}},eAe=Zu,k5=jf,Tq=Ff;Ua.f;var tAe=wq,L5=WP,Rq="Array Iterator",rAe=Tq.set,nAe=Tq.getterFor(Rq);tAe(Array,"Array",function(e,t){rAe(this,{type:Rq,target:eAe(e),index:0,kind:t})},function(){var e=nAe(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,L5(void 0,!0)):L5(r=="keys"?n:r=="values"?t[n]:[n,t[n]],!1)},"values"),k5.Arguments=k5.Array;var iAe=Ua,Yw=function(e,t,r){return iAe.f(e,t,r)},sAe=ks,oAe=Yw,aAe=qo,x5=qr("species"),cAe=ki,dAe=TypeError,GP=function(e,t){if(cAe(t,e))return e;throw dAe("Incorrect invocation")},lAe=Nn,C2=PP,uAe=Jr(Function.toString);lAe(C2.inspectSource)||(C2.inspectSource=function(e){return uAe(e)});var Aq=C2.inspectSource,hAe=Jr,fAe=en,Cq=Nn,pAe=Id,mAe=Aq,Iq=function(){},gAe=[],Oq=ks("Reflect","construct"),qP=/^\s*(?:class|function)\b/,_Ae=hAe(qP.exec),EAe=!qP.exec(Iq),cg=function(e){if(!Cq(e))return!1;try{return Oq(Iq,gAe,e),!0}catch{return!1}},Nq=function(e){if(!Cq(e))return!1;switch(pAe(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return EAe||!!_Ae(qP,mAe(e))}catch{return!0}};Nq.sham=!0;var sE,Zf,M5,mA,Jw=!Oq||fAe(function(){var e;return cg(cg.call)||!cg(Object)||!cg(function(){e=!0})||e})?Nq:cg,vAe=Jw,yAe=b0,bAe=TypeError,U5=hs,SAe=function(e){if(vAe(e))return e;throw bAe(yAe(e)+" is not a constructor")},wAe=E0,TAe=qr("species"),KP=function(e,t){var r,n=U5(e).constructor;return n===void 0||wAe(r=U5(n)[TAe])?t:SAe(r)},Xw=Jr([].slice),RAe=TypeError,T0=function(e,t){if(e<t)throw RAe("Not enough arguments");return e},Dq=/(?:ipad|iphone|ipod).*applewebkit/i.test(eh),Po=an,AAe=Uw,CAe=th,j5=Nn,IAe=Xn,Pq=en,F5=lq,OAe=Xw,B5=LP,NAe=T0,DAe=Dq,PAe=w0,I2=Po.setImmediate,O2=Po.clearImmediate,kAe=Po.process,gA=Po.Dispatch,LAe=Po.Function,V5=Po.MessageChannel,xAe=Po.String,_A=0,i_={},$5="onreadystatechange";Pq(function(){sE=Po.location});var YP=function(e){if(IAe(i_,e)){var t=i_[e];delete i_[e],t()}},EA=function(e){return function(){YP(e)}},H5=function(e){YP(e.data)},z5=function(e){Po.postMessage(xAe(e),sE.protocol+"//"+sE.host)};I2&&O2||(I2=function(e){NAe(arguments.length,1);var t=j5(e)?e:LAe(e),r=OAe(arguments,1);return i_[++_A]=function(){AAe(t,void 0,r)},Zf(_A),_A},O2=function(e){delete i_[e]},PAe?Zf=function(e){kAe.nextTick(EA(e))}:gA&&gA.now?Zf=function(e){gA.now(EA(e))}:V5&&!DAe?(mA=(M5=new V5).port2,M5.port1.onmessage=H5,Zf=CAe(mA.postMessage,mA)):Po.addEventListener&&j5(Po.postMessage)&&!Po.importScripts&&sE&&sE.protocol!=="file:"&&!Pq(z5)?(Zf=z5,Po.addEventListener("message",H5,!1)):Zf=$5 in B5("script")?function(e){F5.appendChild(B5("script"))[$5]=function(){F5.removeChild(this),YP(e)}}:function(e){setTimeout(EA(e),0)});var Qw={set:I2,clear:O2},kq=function(){this.head=null,this.tail=null};kq.prototype={add:function(e){var t={item:e,next:null},r=this.tail;r?r.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var ep,vA,yA,bA,W5,Lq=kq,MAe=/ipad|iphone|ipod/i.test(eh)&&typeof Pebble<"u",UAe=/web0s(?!.*chrome)/i.test(eh),yf=an,G5=th,jAe=XE.f,SA=Qw.set,FAe=Lq,BAe=Dq,VAe=MAe,$Ae=UAe,wA=w0,q5=yf.MutationObserver||yf.WebKitMutationObserver,K5=yf.document,Y5=yf.process,Zv=yf.Promise,J5=jAe(yf,"queueMicrotask"),N2=J5&&J5.value;if(!N2){var ey=new FAe,ty=function(){var e,t;for(wA&&(e=Y5.domain)&&e.exit();t=ey.get();)try{t()}catch(r){throw ey.head&&ep(),r}e&&e.enter()};BAe||wA||$Ae||!q5||!K5?!VAe&&Zv&&Zv.resolve?((bA=Zv.resolve(void 0)).constructor=Zv,W5=G5(bA.then,bA),ep=function(){W5(ty)}):wA?ep=function(){Y5.nextTick(ty)}:(SA=G5(SA,yf),ep=function(){SA(ty)}):(vA=!0,yA=K5.createTextNode(""),new q5(ty).observe(yA,{characterData:!0}),ep=function(){yA.data=vA=!vA}),N2=function(e){ey.head||ep(),ey.add(e)}}var xq=N2,R0=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},bf=an.Promise,Mq=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",HAe=!Mq&&!w0&&typeof window=="object"&&typeof document=="object",zAe=an,s_=bf,WAe=Nn,GAe=ZG,qAe=Aq,KAe=qr,YAe=HAe,JAe=Mq,TA=vf,X5=s_&&s_.prototype,XAe=KAe("species"),Uq=!1,jq=WAe(zAe.PromiseRejectionEvent),QAe=GAe("Promise",function(){var e=qAe(s_),t=e!==String(s_);if(!t&&TA===66||!X5.catch||!X5.finally)return!0;if(!TA||TA<51||!/native code/.test(e)){var r=new s_(function(i){i(1)}),n=function(i){i(function(){},function(){})};if((r.constructor={})[XAe]=n,!(Uq=r.then(function(){})instanceof n))return!0}return!t&&(YAe||JAe)&&!jq}),nv={CONSTRUCTOR:QAe,REJECTION_EVENT:jq,SUBCLASSING:Uq},Od={},Q5=Yo,ZAe=TypeError,eCe=function(e){var t,r;this.promise=new e(function(n,i){if(t!==void 0||r!==void 0)throw ZAe("Bad Promise constructor");t=n,r=i}),this.resolve=Q5(t),this.reject=Q5(r)};Od.f=function(e){return new eCe(e)};var RA,Z5,tCe=Jt,aS=w0,$u=an,iv=$n,rCe=nh,nCe=ih,iCe=function(e){var t=sAe(e);aAe&&t&&!t[x5]&&oAe(t,x5,{configurable:!0,get:function(){return this}})},sCe=Yo,D2=Nn,oCe=Eo,aCe=GP,cCe=KP,Fq=Qw.set,JP=xq,dCe=function(e,t){try{arguments.length==1?console.error(e):console.error(e,t)}catch{}},lCe=R0,uCe=Lq,Bq=Ff,P2=bf,Vq=nv,$q=Od,bb="Promise",e4=Vq.CONSTRUCTOR,hCe=Vq.REJECTION_EVENT,AA=Bq.getterFor(bb),fCe=Bq.set,pCe=P2&&P2.prototype,dg=P2,CA=pCe,Hq=$u.TypeError,k2=$u.document,XP=$u.process,L2=$q.f,mCe=L2,gCe=!!(k2&&k2.createEvent&&$u.dispatchEvent),zq="unhandledrejection",Wq=function(e){var t;return!(!oCe(e)||!D2(t=e.then))&&t},Gq=function(e,t){var r,n,i,s=t.value,o=t.state==1,a=o?e.ok:e.fail,c=e.resolve,d=e.reject,l=e.domain;try{a?(o||(t.rejection===2&&ECe(t),t.rejection=1),a===!0?r=s:(l&&l.enter(),r=a(s),l&&(l.exit(),i=!0)),r===e.promise?d(Hq("Promise-chain cycle")):(n=Wq(r))?iv(n,r,c,d):c(r)):d(s)}catch(u){l&&!i&&l.exit(),d(u)}},qq=function(e,t){e.notified||(e.notified=!0,JP(function(){for(var r,n=e.reactions;r=n.get();)Gq(r,e);e.notified=!1,t&&!e.rejection&&_Ce(e)}))},Kq=function(e,t,r){var n,i;gCe?((n=k2.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),$u.dispatchEvent(n)):n={promise:t,reason:r},!hCe&&(i=$u["on"+e])?i(n):e===zq&&dCe("Unhandled promise rejection",r)},_Ce=function(e){iv(Fq,$u,function(){var t,r=e.facade,n=e.value;if(t4(e)&&(t=lCe(function(){aS?XP.emit("unhandledRejection",n,r):Kq(zq,r,n)}),e.rejection=aS||t4(e)?2:1,t.error))throw t.value})},t4=function(e){return e.rejection!==1&&!e.parent},ECe=function(e){iv(Fq,$u,function(){var t=e.facade;aS?XP.emit("rejectionHandled",t):Kq("rejectionhandled",t,e.value)})},Vp=function(e,t,r){return function(n){e(t,n,r)}},dm=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,qq(e,!0))},x2=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw Hq("Promise can't be resolved itself");var n=Wq(t);n?JP(function(){var i={done:!1};try{iv(n,t,Vp(x2,i,e),Vp(dm,i,e))}catch(s){dm(i,s,e)}}):(e.value=t,e.state=1,qq(e,!1))}catch(i){dm({done:!1},i,e)}}};e4&&(CA=(dg=function(e){aCe(this,CA),sCe(e),iv(RA,this);var t=AA(this);try{e(Vp(x2,t),Vp(dm,t))}catch(r){dm(t,r)}}).prototype,(RA=function(e){fCe(this,{type:bb,done:!1,notified:!1,parent:!1,reactions:new uCe,rejection:!1,state:0,value:void 0})}).prototype=rCe(CA,"then",function(e,t){var r=AA(this),n=L2(cCe(this,dg));return r.parent=!0,n.ok=!D2(e)||e,n.fail=D2(t)&&t,n.domain=aS?XP.domain:void 0,r.state==0?r.reactions.add(n):JP(function(){Gq(n,r)}),n.promise}),Z5=function(){var e=new RA,t=AA(e);this.promise=e,this.resolve=Vp(x2,t),this.reject=Vp(dm,t)},$q.f=L2=function(e){return e===dg||e===void 0?new Z5(e):mCe(e)}),tCe({global:!0,constructor:!0,wrap:!0,forced:e4},{Promise:dg}),nCe(dg,bb,!1,!0),iCe(bb);var Yq=qr("iterator"),Jq=!1;try{var vCe=0,r4={next:function(){return{done:!!vCe++}},return:function(){Jq=!0}};r4[Yq]=function(){return this},Array.from(r4,function(){throw 2})}catch{}var yCe=bf,bCe=function(e,t){if(!Jq)return!1;var r=!1;try{var n={};n[Yq]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch{}return r},Zw=nv.CONSTRUCTOR||!bCe(function(e){yCe.all(e).then(void 0,function(){})}),SCe=$n,wCe=Yo,TCe=Od,RCe=R0,ACe=rv;Jt({target:"Promise",stat:!0,forced:Zw},{all:function(e){var t=this,r=TCe.f(t),n=r.resolve,i=r.reject,s=RCe(function(){var o=wCe(t.resolve),a=[],c=0,d=1;ACe(e,function(l){var u=c++,h=!1;d++,SCe(o,t,l).then(function(p){h||(h=!0,a[u]=p,--d||n(a))},i)}),--d||n(a)});return s.error&&i(s.value),r.promise}});var CCe=Jt,ICe=nv.CONSTRUCTOR;bf&&bf.prototype,CCe({target:"Promise",proto:!0,forced:ICe,real:!0},{catch:function(e){return this.then(void 0,e)}});var OCe=$n,NCe=Yo,DCe=Od,PCe=R0,kCe=rv;Jt({target:"Promise",stat:!0,forced:Zw},{race:function(e){var t=this,r=DCe.f(t),n=r.reject,i=PCe(function(){var s=NCe(t.resolve);kCe(e,function(o){OCe(s,t,o).then(r.resolve,n)})});return i.error&&n(i.value),r.promise}});var LCe=$n,xCe=Od;Jt({target:"Promise",stat:!0,forced:nv.CONSTRUCTOR},{reject:function(e){var t=xCe.f(this);return LCe(t.reject,void 0,e),t.promise}});var MCe=hs,UCe=Eo,jCe=Od,Xq=function(e,t){if(MCe(e),UCe(t)&&t.constructor===e)return t;var r=jCe.f(e);return(0,r.resolve)(t),r.promise},FCe=Jt,BCe=bf,VCe=nv.CONSTRUCTOR,$Ce=Xq,HCe=ks("Promise"),zCe=!VCe;FCe({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return $Ce(zCe&&this===HCe?BCe:this,e)}});var WCe=$n,GCe=Yo,qCe=Od,KCe=R0,YCe=rv;Jt({target:"Promise",stat:!0,forced:Zw},{allSettled:function(e){var t=this,r=qCe.f(t),n=r.resolve,i=r.reject,s=KCe(function(){var o=GCe(t.resolve),a=[],c=0,d=1;YCe(e,function(l){var u=c++,h=!1;d++,WCe(o,t,l).then(function(p){h||(h=!0,a[u]={status:"fulfilled",value:p},--d||n(a))},function(p){h||(h=!0,a[u]={status:"rejected",reason:p},--d||n(a))})}),--d||n(a)});return s.error&&i(s.value),r.promise}});var JCe=$n,XCe=Yo,QCe=ks,ZCe=Od,eIe=R0,tIe=rv,n4="No one promise resolved";Jt({target:"Promise",stat:!0,forced:Zw},{any:function(e){var t=this,r=QCe("AggregateError"),n=ZCe.f(t),i=n.resolve,s=n.reject,o=eIe(function(){var a=XCe(t.resolve),c=[],d=0,l=1,u=!1;tIe(e,function(h){var p=d++,_=!1;l++,JCe(a,t,h).then(function(g){_||u||(u=!0,i(g))},function(g){_||u||(_=!0,c[p]=g,--l||s(new r(c,n4)))})}),--l||s(new r(c,n4))});return o.error&&s(o.value),n.promise}});var rIe=Jt,M2=bf,nIe=en,iIe=ks,sIe=Nn,oIe=KP,i4=Xq,aIe=M2&&M2.prototype;rIe({target:"Promise",proto:!0,real:!0,forced:!!M2&&nIe(function(){aIe.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=oIe(this,iIe("Promise")),r=sIe(e);return this.then(r?function(n){return i4(t,e()).then(function(){return n})}:e,r?function(n){return i4(t,e()).then(function(){throw n})}:e)}});var QP=Jr,cIe=xP,dIe=Jo,lIe=v0,uIe=QP("".charAt),s4=QP("".charCodeAt),hIe=QP("".slice),o4=function(e){return function(t,r){var n,i,s=dIe(lIe(t)),o=cIe(r),a=s.length;return o<0||o>=a?e?"":void 0:(n=s4(s,o))<55296||n>56319||o+1===a||(i=s4(s,o+1))<56320||i>57343?e?uIe(s,o):n:e?hIe(s,o,o+2):i-56320+(n-55296<<10)+65536}},ZP={codeAt:o4(!1),charAt:o4(!0)},fIe=ZP.charAt,pIe=Jo,Qq=Ff,mIe=wq,a4=WP,Zq="String Iterator",gIe=Qq.set,_Ie=Qq.getterFor(Zq);mIe(String,"String",function(e){gIe(this,{type:Zq,string:pIe(e),index:0})},function(){var e,t=_Ie(this),r=t.string,n=t.index;return n>=r.length?a4(void 0,!0):(e=fIe(r,n),t.index+=e.length,a4(e,!1))});var EIe=Ko.Promise,vIe={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},yIe=an,bIe=Id,SIe=rh,c4=jf,d4=qr("toStringTag");for(var IA in vIe){var l4=yIe[IA],OA=l4&&l4.prototype;OA&&bIe(OA)!==d4&&SIe(OA,d4,IA),c4[IA]=c4.Array}var eK=EIe,_e=Pr(eK);const u4=aq;function tK(e,t){const r=e&&e.navigator;if(!r.mediaDevices)return;const n=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;const a={};return Object.keys(o).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;const d=typeof o[c]=="object"?o[c]:{ideal:o[c]};d.exact!==void 0&&typeof d.exact=="number"&&(d.min=d.max=d.exact);const l=function(u,h){return u?u+h.charAt(0).toUpperCase()+h.slice(1):h==="deviceId"?"sourceId":h};if(d.ideal!==void 0){a.optional=a.optional||[];let u={};typeof d.ideal=="number"?(u[l("min",c)]=d.ideal,a.optional.push(u),u={},u[l("max",c)]=d.ideal,a.optional.push(u)):(u[l("",c)]=d.ideal,a.optional.push(u))}d.exact!==void 0&&typeof d.exact!="number"?(a.mandatory=a.mandatory||{},a.mandatory[l("",c)]=d.exact):["min","max"].forEach(u=>{d[u]!==void 0&&(a.mandatory=a.mandatory||{},a.mandatory[l(u,c)]=d[u])})}),o.advanced&&(a.optional=(a.optional||[]).concat(o.advanced)),a},i=function(o,a){if(t.version>=61)return a(o);if((o=JSON.parse(JSON.stringify(o)))&&typeof o.audio=="object"){const c=function(d,l,u){l in d&&!(u in d)&&(d[u]=d[l],delete d[l])};c((o=JSON.parse(JSON.stringify(o))).audio,"autoGainControl","googAutoGainControl"),c(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=n(o.audio)}if(o&&typeof o.video=="object"){let c=o.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});const d=t.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||d)){let l;if(delete o.video.facingMode,c.exact==="environment"||c.ideal==="environment"?l=["back","rear"]:c.exact!=="user"&&c.ideal!=="user"||(l=["front"]),l)return r.mediaDevices.enumerateDevices().then(u=>{let h=(u=u.filter(p=>p.kind==="videoinput")).find(p=>l.some(_=>{var g;return Ee(g=p.label.toLowerCase()).call(g,_)}));return!h&&u.length&&Ee(l).call(l,"back")&&(h=u[u.length-1]),h&&(o.video.deviceId=c.exact?{exact:h.deviceId}:{ideal:h.deviceId}),o.video=n(o.video),u4("chrome: "+JSON.stringify(o)),a(o)})}o.video=n(o.video)}return u4("chrome: "+JSON.stringify(o)),a(o)},s=function(o){return t.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=(function(o,a,c){i(o,d=>{r.webkitGetUserMedia(d,a,l=>{c&&c(s(l))})})}).bind(r),r.mediaDevices.getUserMedia){const o=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(a){return i(a,c=>o(c).then(d=>{if(c.audio&&!d.getAudioTracks().length||c.video&&!d.getVideoTracks().length)throw d.getTracks().forEach(l=>{l.stop()}),new DOMException("","NotFoundError");return d},d=>_e.reject(s(d))))}}}function rK(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function nK(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(o=>o.track&&o.track.id===n.track.id):{track:n.track};const s=new Event("track");s.track=n.track,s.receiver=i,s.transceiver={receiver:i},s.streams=[r.stream],this.dispatchEvent(s)}),r.stream.getTracks().forEach(n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(o=>o.track&&o.track.id===n.id):{track:n};const s=new Event("track");s.track=n,s.receiver=i,s.transceiver={receiver:i},s.streams=[r.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Uf(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function iK(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,a){let c=i.apply(this,arguments);return c||(c=t(this,o),this._senders.push(c)),c};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){s.apply(this,arguments);const a=this._senders.indexOf(o);a!==-1&&this._senders.splice(a,1)}}const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(s=>{this._senders.push(t(this,s))})};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(s=>{const o=this._senders.find(a=>a.track===s);o&&this._senders.splice(this._senders.indexOf(o),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(n=>n._pc=this),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function sK(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,n,i]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);const s=function(a){const c={};return a.result().forEach(d=>{const l={id:d.id,timestamp:d.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[d.type]||d.type};d.names().forEach(u=>{l[u]=d.stat(u)}),c[l.id]=l}),c},o=function(a){return new Map(Object.keys(a).map(c=>[c,a[c]]))};if(arguments.length>=2){const a=function(c){n(o(s(c)))};return t.apply(this,[a,r])}return new _e((a,c)=>{t.apply(this,[function(d){a(o(s(d)))},c])}).then(n,i)}}function oK(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=r.apply(this,[]);return i.forEach(s=>s._pc=this),i});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>l5(s,i.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=r.apply(this,[]);return n.forEach(i=>i._pc=this),n}),Uf(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){const n=this;return this._pc.getStats().then(i=>l5(i,n.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const r=arguments[0];let n,i,s;return this.getSenders().forEach(o=>{o.track===r&&(n?s=!0:n=o)}),this.getReceivers().forEach(o=>(o.track===r&&(i?s=!0:i=o),o.track===r)),s||n&&i?_e.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():i?i.getStats():_e.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function aK(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,o){if(!o)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const a=t.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(a)===-1&&this._shimmedLocalStreams[o.id].push(a):this._shimmedLocalStreams[o.id]=[o,a],a};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(c=>{if(this.getSenders().find(l=>l.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const o=this.getSenders();r.apply(this,arguments);const a=this.getSenders().filter(c=>o.indexOf(c)===-1);this._shimmedLocalStreams[s.id]=[s].concat(a)};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],n.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(o=>{const a=this._shimmedLocalStreams[o].indexOf(s);a!==-1&&this._shimmedLocalStreams[o].splice(a,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),i.apply(this,arguments)}}function cK(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return aK(e);const r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const c=r.apply(this);return this._reverseStreams=this._reverseStreams||{},c.map(d=>this._reverseStreams[d.id])};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.getTracks().forEach(d=>{if(this.getSenders().find(u=>u.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[c.id]){const d=new e.MediaStream(c.getTracks());this._streams[c.id]=d,this._reverseStreams[d.id]=c,c=d}n.apply(this,[c])};const i=e.RTCPeerConnection.prototype.removeStream;function s(c,d){let l=d.sdp;return Object.keys(c._reverseStreams||[]).forEach(u=>{const h=c._reverseStreams[u],p=c._streams[h.id];l=l.replace(new RegExp(p.id,"g"),h.id)}),new RTCSessionDescription({type:d.type,sdp:l})}e.RTCPeerConnection.prototype.removeStream=function(c){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[c.id]||c]),delete this._reverseStreams[this._streams[c.id]?this._streams[c.id].id:c.id],delete this._streams[c.id]},e.RTCPeerConnection.prototype.addTrack=function(c,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const l=[].slice.call(arguments,1);if(l.length!==1||!l[0].getTracks().find(p=>p===c))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(p=>p.track===c))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const h=this._streams[d.id];if(h)h.addTrack(c),_e.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const p=new e.MediaStream([c]);this._streams[d.id]=p,this._reverseStreams[p.id]=d,this.addStream(p)}return this.getSenders().find(p=>p.track===c)},["createOffer","createAnswer"].forEach(function(c){const d=e.RTCPeerConnection.prototype[c],l={[c](){const u=arguments;return arguments.length&&typeof arguments[0]=="function"?d.apply(this,[h=>{const p=s(this,h);u[0].apply(null,[p])},h=>{u[1]&&u[1].apply(null,h)},arguments[2]]):d.apply(this,arguments).then(h=>s(this,h))}};e.RTCPeerConnection.prototype[c]=l[c]});const o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(c,d){let l=d.sdp;return Object.keys(c._reverseStreams||[]).forEach(u=>{const h=c._reverseStreams[u],p=c._streams[h.id];l=l.replace(new RegExp(h.id,"g"),p.id)}),new RTCSessionDescription({type:d.type,sdp:l})}(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};const a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const c=a.get.apply(this);return c.type===""?c:s(this,c)}}),e.RTCPeerConnection.prototype.removeTrack=function(c){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!c._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(c._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let d;this._streams=this._streams||{},Object.keys(this._streams).forEach(l=>{this._streams[l].getTracks().find(u=>c.track===u)&&(d=this._streams[l])}),d&&(d.getTracks().length===1?this.removeStream(this._reverseStreams[d.id]):d.removeTrack(c.track),this.dispatchEvent(new Event("negotiationneeded")))}}function U2(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const n=e.RTCPeerConnection.prototype[r],i={[r](){return arguments[0]=new(r==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=i[r]})}function dK(e,t){Uf(e,"negotiationneeded",r=>{const n=r.target;if(!(t.version<72||n.getConfiguration&&n.getConfiguration().sdpSemantics==="plan-b")||n.signalingState==="stable")return r})}var h4=Object.freeze({__proto__:null,fixNegotiationNeeded:dK,shimAddTrackRemoveTrack:cK,shimAddTrackRemoveTrackWithNative:aK,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(n=>{const i=r.video&&r.video.width,s=r.video&&r.video.height,o=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxFrameRate:o||3}},i&&(r.video.mandatory.maxWidth=i),s&&(r.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:iK,shimGetStats:sK,shimGetUserMedia:tK,shimMediaStream:rK,shimOnTrack:nK,shimPeerConnection:U2,shimSenderReceiverGetStats:oK});function lK(e,t){const r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(i,s,o){FP("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(i).then(s,o)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const i=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},s=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},n&&n.prototype.getSettings){const o=n.prototype.getSettings;n.prototype.getSettings=function(){const a=o.apply(this,arguments);return i(a,"mozAutoGainControl","autoGainControl"),i(a,"mozNoiseSuppression","noiseSuppression"),a}}if(n&&n.prototype.applyConstraints){const o=n.prototype.applyConstraints;n.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a,"autoGainControl","mozAutoGainControl"),i(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function uK(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function j2(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=e.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=o[i]});const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,s,o]=arguments;return n.apply(this,[i||null]).then(a=>{if(t.version<53&&!s)try{a.forEach(c=>{c.type=r[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;a.forEach((d,l)=>{a.set(l,Object.assign({},d,{type:r[d.type]||d.type}))})}return a}).then(s,o)}}function hK(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const n=r.apply(this,arguments);return n._pc=this,n}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):_e.resolve(new Map)}}function fK(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach(n=>n._pc=this),r}),Uf(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function pK(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){FP("removeStream","removeTrack"),this.getSenders().forEach(r=>{var n;r.track&&Ee(n=t.getTracks()).call(n,r.track)&&this.removeTrack(r)})})}function mK(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function gK(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const n=r.length>0;n&&r.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=t.apply(this,arguments);if(n){const{sender:s}=i,o=s.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=r,s.sendEncodings=r,this.setParametersPromises.push(s.setParameters(o).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return i})}function _K(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function EK(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?_e.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function vK(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?_e.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var f4=Object.freeze({__proto__:null,shimAddTransceiver:gK,shimCreateAnswer:vK,shimCreateOffer:EK,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,_e.reject(n)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})},shimGetParameters:_K,shimGetUserMedia:lK,shimOnTrack:uK,shimPeerConnection:j2,shimRTCDataChannel:mK,shimReceiverGetStats:fK,shimRemoveStream:pK,shimSenderGetStats:hK});function yK(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){var n;this._localStreams||(this._localStreams=[]),Ee(n=this._localStreams).call(n,r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>t.call(this,i,r)),r.getVideoTracks().forEach(i=>t.call(this,i,r))},e.RTCPeerConnection.prototype.addTrack=function(r){for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];return i&&i.forEach(o=>{var a;this._localStreams?Ee(a=this._localStreams).call(a,o)||this._localStreams.push(o):this._localStreams=[o]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);const n=t.getTracks();this.getSenders().forEach(i=>{Ee(n).call(n,i.track)&&this.removeTrack(i)})})}}function bK(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(i=>{var s;if(this._remoteStreams||(this._remoteStreams=[]),Ee(s=this._remoteStreams).call(s,i))return;this._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,this.dispatchEvent(o)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(i=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(i)>=0)return;r._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,r.dispatchEvent(s)})}),t.apply(r,arguments)}}}function SK(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,s=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(c,d){const l=arguments.length>=2?arguments[2]:arguments[0],u=r.apply(this,[l]);return d?(u.then(c,d),_e.resolve()):u},t.createAnswer=function(c,d){const l=arguments.length>=2?arguments[2]:arguments[0],u=n.apply(this,[l]);return d?(u.then(c,d),_e.resolve()):u};let a=function(c,d,l){const u=i.apply(this,[c]);return l?(u.then(d,l),_e.resolve()):u};t.setLocalDescription=a,a=function(c,d,l){const u=s.apply(this,[c]);return l?(u.then(d,l),_e.resolve()):u},t.setRemoteDescription=a,a=function(c,d,l){const u=o.apply(this,[c]);return l?(u.then(d,l),_e.resolve()):u},t.addIceCandidate=a}function wK(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const r=t.mediaDevices,n=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=i=>n(TK(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(r,n,i){t.mediaDevices.getUserMedia(r).then(n,i)}).bind(t))}function TK(e){return e&&e.video!==void 0?Object.assign({},e,{video:cq(e.video)}):e}function RK(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,n){if(r&&r.iceServers){const i=[];for(let s=0;s<r.iceServers.length;s++){let o=r.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(FP("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,i.push(o)):i.push(r.iceServers[s])}r.iceServers=i}return new t(r,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function AK(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function CK(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){r.offerToReceiveAudio!==void 0&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const n=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):r.offerToReceiveAudio!==!0||n||this.addTransceiver("audio",{direction:"recvonly"}),r.offerToReceiveVideo!==void 0&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const i=this.getTransceivers().find(s=>s.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveVideo!==!0||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function IK(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var p4=Object.freeze({__proto__:null,shimAudioContext:IK,shimCallbacksAPI:SK,shimConstraints:TK,shimCreateOfferLegacy:CK,shimGetUserMedia:wK,shimLocalStreamsAPI:yK,shimRTCIceServerUrls:RK,shimRemoteStreamsAPI:bK,shimTrackEventTransceiver:AK}),OK=`	
\v\f\r                　\u2028\u2029\uFEFF`,wIe=v0,TIe=Jo,F2=OK,m4=Jr("".replace),RIe=RegExp("^["+F2+"]+"),AIe=RegExp("(^|[^"+F2+"])["+F2+"]+$"),NA=function(e){return function(t){var r=TIe(wIe(t));return 1&e&&(r=m4(r,RIe,"")),2&e&&(r=m4(r,AIe,"$1")),r}},CIe={start:NA(1),end:NA(2),trim:NA(3)},IIe=yq.PROPER,OIe=en,g4=OK,NIe=CIe.trim;Jt({target:"String",proto:!0,forced:function(e){return OIe(function(){return!!g4[e]()||"​᠎"[e]()!=="​᠎"||IIe&&g4[e].name!==e})}("trim")},{trim:function(){return NIe(this)}});var DIe=ja("String").trim,PIe=ki,kIe=DIe,DA=String.prototype,LIe=function(e){var t=e.trim;return typeof e=="string"||e===DA||PIe(DA,e)&&t===DA.trim?kIe:t},fi=Pr(LIe),NK={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(r){return r.trim().split(`
`).map(n=>n.trim())},t.splitSections=function(r){return r.split(`
m=`).map((n,i)=>(i>0?"m="+n:n).trim()+`\r
`)},t.getDescription=function(r){const n=t.splitSections(r);return n&&n[0]},t.getMediaSections=function(r){const n=t.splitSections(r);return n.shift(),n},t.matchPrefix=function(r,n){return t.splitLines(r).filter(i=>i.indexOf(n)===0)},t.parseCandidate=function(r){let n;n=r.indexOf("a=candidate:")===0?r.substring(12).split(" "):r.substring(10).split(" ");const i={foundation:n[0],component:{1:"rtp",2:"rtcp"}[n[1]]||n[1],protocol:n[2].toLowerCase(),priority:parseInt(n[3],10),ip:n[4],address:n[4],port:parseInt(n[5],10),type:n[7]};for(let s=8;s<n.length;s+=2)switch(n[s]){case"raddr":i.relatedAddress=n[s+1];break;case"rport":i.relatedPort=parseInt(n[s+1],10);break;case"tcptype":i.tcpType=n[s+1];break;case"ufrag":i.ufrag=n[s+1],i.usernameFragment=n[s+1];break;default:i[n[s]]===void 0&&(i[n[s]]=n[s+1])}return i},t.writeCandidate=function(r){const n=[];n.push(r.foundation);const i=r.component;i==="rtp"?n.push(1):i==="rtcp"?n.push(2):n.push(i),n.push(r.protocol.toUpperCase()),n.push(r.priority),n.push(r.address||r.ip),n.push(r.port);const s=r.type;return n.push("typ"),n.push(s),s!=="host"&&r.relatedAddress&&r.relatedPort&&(n.push("raddr"),n.push(r.relatedAddress),n.push("rport"),n.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(n.push("tcptype"),n.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(n.push("ufrag"),n.push(r.usernameFragment||r.ufrag)),"candidate:"+n.join(" ")},t.parseIceOptions=function(r){return r.substring(14).split(" ")},t.parseRtpMap=function(r){let n=r.substring(9).split(" ");const i={payloadType:parseInt(n.shift(),10)};return n=n[0].split("/"),i.name=n[0],i.clockRate=parseInt(n[1],10),i.channels=n.length===3?parseInt(n[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(r){let n=r.payloadType;r.preferredPayloadType!==void 0&&(n=r.preferredPayloadType);const i=r.channels||r.numChannels||1;return"a=rtpmap:"+n+" "+r.name+"/"+r.clockRate+(i!==1?"/"+i:"")+`\r
`},t.parseExtmap=function(r){const n=r.substring(9).split(" ");return{id:parseInt(n[0],10),direction:n[0].indexOf("/")>0?n[0].split("/")[1]:"sendrecv",uri:n[1],attributes:n.slice(2).join(" ")}},t.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+`\r
`},t.parseFmtp=function(r){const n={};let i;const s=r.substring(r.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)i=s[o].trim().split("="),n[i[0].trim()]=i[1];return n},t.writeFmtp=function(r){let n="",i=r.payloadType;if(r.preferredPayloadType!==void 0&&(i=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){const s=[];Object.keys(r.parameters).forEach(o=>{r.parameters[o]!==void 0?s.push(o+"="+r.parameters[o]):s.push(o)}),n+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return n},t.parseRtcpFb=function(r){const n=r.substring(r.indexOf(" ")+1).split(" ");return{type:n.shift(),parameter:n.join(" ")}},t.writeRtcpFb=function(r){let n="",i=r.payloadType;return r.preferredPayloadType!==void 0&&(i=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(s=>{n+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),n},t.parseSsrcMedia=function(r){const n=r.indexOf(" "),i={ssrc:parseInt(r.substring(7,n),10)},s=r.indexOf(":",n);return s>-1?(i.attribute=r.substring(n+1,s),i.value=r.substring(s+1)):i.attribute=r.substring(n+1),i},t.parseSsrcGroup=function(r){const n=r.substring(13).split(" ");return{semantics:n.shift(),ssrcs:n.map(i=>parseInt(i,10))}},t.getMid=function(r){const n=t.matchPrefix(r,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(r){const n=r.substring(14).split(" ");return{algorithm:n[0].toLowerCase(),value:n[1].toUpperCase()}},t.getDtlsParameters=function(r,n){return{role:"auto",fingerprints:t.matchPrefix(r+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(r,n){let i="a=setup:"+n+`\r
`;return r.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},t.parseCryptoLine=function(r){const n=r.substring(9).split(" ");return{tag:parseInt(n[0],10),cryptoSuite:n[1],keyParams:n[2],sessionParams:n.slice(3)}},t.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+(typeof r.keyParams=="object"?t.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(r){if(r.indexOf("inline:")!==0)return null;const n=r.substring(7).split("|");return{keyMethod:"inline",keySalt:n[0],lifeTime:n[1],mkiValue:n[2]?n[2].split(":")[0]:void 0,mkiLength:n[2]?n[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},t.getCryptoParameters=function(r,n){return t.matchPrefix(r+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(r,n){const i=t.matchPrefix(r+n,"a=ice-ufrag:")[0],s=t.matchPrefix(r+n,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},t.writeIceParameters=function(r){let n="a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`;return r.iceLite&&(n+=`a=ice-lite\r
`),n},t.parseRtpParameters=function(r){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(r)[0].split(" ");n.profile=i[2];for(let o=3;o<i.length;o++){const a=i[o],c=t.matchPrefix(r,"a=rtpmap:"+a+" ")[0];if(c){const d=t.parseRtpMap(c),l=t.matchPrefix(r,"a=fmtp:"+a+" ");switch(d.parameters=l.length?t.parseFmtp(l[0]):{},d.rtcpFeedback=t.matchPrefix(r,"a=rtcp-fb:"+a+" ").map(t.parseRtcpFb),n.codecs.push(d),d.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(d.name.toUpperCase())}}}t.matchPrefix(r,"a=extmap:").forEach(o=>{n.headerExtensions.push(t.parseExtmap(o))});const s=t.matchPrefix(r,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach(o=>{s.forEach(a=>{o.rtcpFeedback.find(c=>c.type===a.type&&c.parameter===a.parameter)||o.rtcpFeedback.push(a)})}),n},t.writeRtpDescription=function(r,n){let i="";i+="m="+r+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,n.codecs.forEach(o=>{i+=t.writeRtpMap(o),i+=t.writeFmtp(o),i+=t.writeRtcpFb(o)});let s=0;return n.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),n.headerExtensions&&n.headerExtensions.forEach(o=>{i+=t.writeExtmap(o)}),i},t.parseRtpEncodingParameters=function(r){const n=[],i=t.parseRtpParameters(r),s=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,a=t.matchPrefix(r,"a=ssrc:").map(h=>t.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),c=a.length>0&&a[0].ssrc;let d;const l=t.matchPrefix(r,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(p=>parseInt(p,10)));l.length>0&&l[0].length>1&&l[0][0]===c&&(d=l[0][1]),i.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let p={ssrc:c,codecPayloadType:parseInt(h.parameters.apt,10)};c&&d&&(p.rtx={ssrc:d}),n.push(p),s&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},n.push(p))}}),n.length===0&&c&&n.push({ssrc:c});let u=t.matchPrefix(r,"b=");return u.length&&(u=u[0].indexOf("b=TIAS:")===0?parseInt(u[0].substring(7),10):u[0].indexOf("b=AS:")===0?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,n.forEach(h=>{h.maxBitrate=u})),n},t.parseRtcpParameters=function(r){const n={},i=t.matchPrefix(r,"a=ssrc:").map(a=>t.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);const s=t.matchPrefix(r,"a=rtcp-rsize");n.reducedSize=s.length>0,n.compound=s.length===0;const o=t.matchPrefix(r,"a=rtcp-mux");return n.mux=o.length>0,n},t.writeRtcpParameters=function(r){let n="";return r.reducedSize&&(n+=`a=rtcp-rsize\r
`),r.mux&&(n+=`a=rtcp-mux\r
`),r.ssrc!==void 0&&r.cname&&(n+="a=ssrc:"+r.ssrc+" cname:"+r.cname+`\r
`),n},t.parseMsid=function(r){let n;const i=t.matchPrefix(r,"a=msid:");if(i.length===1)return n=i[0].substring(7).split(" "),{stream:n[0],track:n[1]};const s=t.matchPrefix(r,"a=ssrc:").map(o=>t.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");return s.length>0?(n=s[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(r){const n=t.parseMLine(r),i=t.matchPrefix(r,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const o=t.matchPrefix(r,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:n.fmt,maxMessageSize:s};const a=t.matchPrefix(r,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:s}}},t.writeSctpDescription=function(r,n){let i=[];return i=r.protocol!=="DTLS/SCTP"?["m="+r.kind+" 9 "+r.protocol+" "+n.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+n.port+`\r
`]:["m="+r.kind+" 9 "+r.protocol+" "+n.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+n.port+" "+n.protocol+` 65535\r
`],n.maxMessageSize!==void 0&&i.push("a=max-message-size:"+n.maxMessageSize+`\r
`),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(r,n,i){let s;const o=n!==void 0?n:2;return s=r||t.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(r,n){const i=t.splitLines(r);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(r){return t.splitLines(r)[0].split(" ")[0].substring(2)},t.isRejected=function(r){return r.split(" ",2)[1]==="0"},t.parseMLine=function(r){const n=t.splitLines(r)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(r){const n=t.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;const n=t.splitLines(r);for(let i=0;i<n.length;i++)if(n[i].length<2||n[i].charAt(1)!=="=")return!1;return!0},e.exports=t})(NK);var DK=NK.exports,lm=Pr(DK),xIe=t1e({__proto__:null,default:lm},[DK]);function Sb(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&((r=JSON.parse(JSON.stringify(r))).candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){const n=new t(r),i=lm.parseCandidate(r.candidate),s=Object.assign(n,i);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,Uf(e,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new e.RTCIceCandidate(r.candidate),writable:"false"}),r))}function B2(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Uf(e,"icecandidate",t=>{if(t.candidate){const r=lm.parseCandidate(t.candidate.candidate);r.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return t})}function wb(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const r=function(a){if(!a||!a.sdp)return!1;const c=lm.splitSections(a.sdp);return c.shift(),c.some(d=>{const l=lm.parseMLine(d);return l&&l.kind==="application"&&l.protocol.indexOf("SCTP")!==-1})},n=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const d=parseInt(c[1],10);return d!=d?-1:d},i=function(a){let c=65536;return t.browser==="firefox"&&(c=t.version<57?a===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),c},s=function(a,c){let d=65536;t.browser==="firefox"&&t.version===57&&(d=65535);const l=lm.matchPrefix(a.sdp,"a=max-message-size:");return l.length>0?d=parseInt(l[0].substr(19),10):t.browser==="firefox"&&c!==-1&&(d=2147483637),d},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:a}=this.getConfiguration();a==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const a=n(arguments[0]),c=i(a),d=s(arguments[0],a);let l;l=c===0&&d===0?Number.POSITIVE_INFINITY:c===0||d===0?Math.max(c,d):Math.min(c,d);const u={};Object.defineProperty(u,"maxMessageSize",{get:()=>l}),this._sctp=u}return o.apply(this,arguments)}}function Tb(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(n,i){const s=n.send;n.send=function(){const o=arguments[0],a=o.length||o.size||o.byteLength;if(n.readyState==="open"&&i.sctp&&a>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(n,arguments)}}const r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const n=r.apply(this,arguments);return t(n,this),n},Uf(e,"datachannel",n=>(t(n.channel,n.target),n))}function V2(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{const n=t[r];t[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",i);s.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function $2(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=n.sdp.split(`
`).filter(s=>fi(s).call(s)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&n instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:n.type,sdp:i}):n.sdp=i}return r.apply(this,arguments)}}function Rb(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.addIceCandidate;r&&r.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?_e.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),_e.resolve())})}function Ab(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.setLocalDescription;r&&r.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let n=arguments[0]||{};if(typeof n!="object"||n.type&&n.sdp)return r.apply(this,arguments);if(n={type:n.type,sdp:n.sdp},!n.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":n.type="offer";break;default:n.type="answer"}return n.sdp||n.type!=="offer"&&n.type!=="answer"?r.apply(this,[n]):(n.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(i=>r.apply(this,[i]))})}var MIe=Object.freeze({__proto__:null,removeExtmapAllowMixed:$2,shimAddIceCandidateNullOrEmpty:Rb,shimConnectionState:V2,shimMaxMessageSize:wb,shimParameterlessSetLocalDescription:Ab,shimRTCIceCandidate:Sb,shimRTCIceCandidateRelayProtocol:B2,shimSendThrowTypeError:Tb});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const r=aq,n=function(s){const o={browser:null,version:null};if(s===void 0||!s.navigator)return o.browser="Not a browser.",o;const{navigator:a}=s;if(a.mozGetUserMedia)o.browser="firefox",o.version=Yv(a.userAgent,/Firefox\/(\d+)\./,1);else if(a.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)o.browser="chrome",o.version=Yv(a.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!s.RTCPeerConnection||!a.userAgent.match(/AppleWebKit\/(\d+)\./))return o.browser="Not a supported browser.",o;o.browser="safari",o.version=Yv(a.userAgent,/AppleWebKit\/(\d+)\./,1),o.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype}return o}(e),i={browserDetails:n,commonShim:MIe,extractVersion:Yv,disableLog:Lwe,disableWarnings:xwe,sdp:xIe};switch(n.browser){case"chrome":if(!h4||!U2||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),i;if(n.version===null)return r("Chrome shim can not determine version, not shimming."),i;r("adapter.js shimming chrome."),i.browserShim=h4,Rb(e,n),Ab(e),tK(e,n),rK(e),U2(e,n),nK(e),cK(e,n),iK(e),sK(e),oK(e),dK(e,n),Sb(e),B2(e),V2(e),wb(e,n),Tb(e),$2(e,n);break;case"firefox":if(!f4||!j2||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),i;r("adapter.js shimming firefox."),i.browserShim=f4,Rb(e,n),Ab(e),lK(e,n),j2(e,n),uK(e),pK(e),hK(e),fK(e),mK(e),gK(e),_K(e),EK(e),vK(e),Sb(e),V2(e),wb(e,n),Tb(e);break;case"safari":if(!p4||!t.shimSafari)return r("Safari shim is not included in this adapter release."),i;r("adapter.js shimming safari."),i.browserShim=p4,Rb(e,n),Ab(e),RK(e),CK(e),SK(e),yK(e),bK(e),AK(e),wK(e),IK(e),Sb(e),B2(e),wb(e,n),Tb(e),$2(e,n);break;default:r("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var UIe=ja("Array").keys,jIe=Id,FIe=Xn,BIe=ki,VIe=UIe,PA=Array.prototype,$Ie={DOMTokenList:!0,NodeList:!0},HIe=function(e){var t=e.keys;return e===PA||BIe(PA,e)&&t===PA.keys||FIe($Ie,jIe(e))?VIe:t},Ks=Pr(HIe),_4=b0,zIe=TypeError,WIe=$w,GIe=Ua,qIe=Qu,eT=function(e,t,r){var n=WIe(t);n in e?GIe.f(e,n,qIe(0,r)):e[n]=r},E4=MP,KIe=Ol,YIe=eT,JIe=Array,XIe=Math.max,e3=function(e,t,r){for(var n=KIe(e),i=E4(t,n),s=E4(r===void 0?n:r,n),o=JIe(XIe(s-i,0)),a=0;i<s;i++,a++)YIe(o,a,e[i]);return o.length=a,o},v4=e3,QIe=Math.floor,H2=function(e,t){var r=e.length,n=QIe(r/2);return r<8?ZIe(e,t):eOe(e,H2(v4(e,0,n),t),H2(v4(e,n),t),t)},ZIe=function(e,t){for(var r,n,i=e.length,s=1;s<i;){for(n=s,r=e[s];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==s++&&(e[n]=r)}return e},eOe=function(e,t,r,n){for(var i=t.length,s=r.length,o=0,a=0;o<i||a<s;)e[o+a]=o<i&&a<s?n(t[o],r[a])<=0?t[o++]:r[a++]:o<i?t[o++]:r[a++];return e},PK=H2,y4=eh.match(/firefox\/(\d+)/i),tOe=!!y4&&+y4[1],rOe=/MSIE|Trident/.test(eh),b4=eh.match(/AppleWebKit\/(\d+)\./),nOe=!!b4&&+b4[1],iOe=Jt,kK=Jr,sOe=Yo,oOe=Cd,S4=Ol,aOe=function(e,t){if(!delete e[t])throw zIe("Cannot delete property "+_4(t)+" of "+_4(e))},w4=Jo,t3=en,cOe=PK,dOe=Hw,T4=tOe,lOe=rOe,R4=vf,A4=nOe,fu=[],C4=kK(fu.sort),uOe=kK(fu.push),hOe=t3(function(){fu.sort(void 0)}),fOe=t3(function(){fu.sort(null)}),pOe=dOe("sort"),I4=!t3(function(){if(R4)return R4<70;if(!(T4&&T4>3)){if(lOe)return!0;if(A4)return A4<603;var e,t,r,n,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(n=0;n<47;n++)fu.push({k:t+n,v:r})}for(fu.sort(function(s,o){return o.v-s.v}),n=0;n<fu.length;n++)t=fu[n].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return i!=="DGBEFHACIJK"}});iOe({target:"Array",proto:!0,forced:hOe||!fOe||!pOe||!I4},{sort:function(e){e!==void 0&&sOe(e);var t=oOe(this);if(I4)return e===void 0?C4(t):C4(t,e);var r,n,i=[],s=S4(t);for(n=0;n<s;n++)n in t&&uOe(i,t[n]);for(cOe(i,function(o){return function(a,c){return c===void 0?-1:a===void 0?1:o!==void 0?+o(a,c)||0:w4(a)>w4(c)?1:-1}}(e)),r=S4(i),n=0;n<r;)t[n]=i[n++];for(;n<s;)aOe(t,n++);return t}});var kA,LA,mOe=ja("Array").sort,gOe=ki,_Oe=mOe,xA=Array.prototype,EOe=function(e){var t=e.sort;return e===xA||gOe(xA,e)&&t===xA.sort?_Oe:t},sv=Pr(EOe),z2={exports:{}};kA=z2,LA=z2.exports,function(e,t){var r="function",n="undefined",i="object",s="string",o="major",a="model",c="name",d="type",l="vendor",u="version",h="architecture",p="console",_="mobile",g="tablet",E="smarttv",b="wearable",v="embedded",I="Amazon",N="Apple",L="ASUS",U="BlackBerry",w="Browser",V="Chrome",z="Firefox",K="Google",H="Huawei",A="LG",m="Microsoft",S="Motorola",T="Opera",x="Samsung",D="Sharp",k="Sony",P="Xiaomi",y="Zebra",f="Facebook",R="Chromium OS",B="Mac OS",q=function(Te){for(var Re={},Ne=0;Ne<Te.length;Ne++)Re[Te[Ne].toUpperCase()]=Te[Ne];return Re},F=function(Te,Re){return typeof Te===s&&te(Re).indexOf(te(Te))!==-1},te=function(Te){return Te.toLowerCase()},G=function(Te,Re){if(typeof Te===s)return Te=Te.replace(/^\s\s*/,""),typeof Re===n?Te:Te.substring(0,350)},Y=function(Te,Re){for(var Ne,Q,re,ne,oe,ce,ue=0;ue<Re.length&&!oe;){var fe=Re[ue],ye=Re[ue+1];for(Ne=Q=0;Ne<fe.length&&!oe&&fe[Ne];)if(oe=fe[Ne++].exec(Te))for(re=0;re<ye.length;re++)ce=oe[++Q],typeof(ne=ye[re])===i&&ne.length>0?ne.length===2?typeof ne[1]==r?this[ne[0]]=ne[1].call(this,ce):this[ne[0]]=ne[1]:ne.length===3?typeof ne[1]!==r||ne[1].exec&&ne[1].test?this[ne[0]]=ce?ce.replace(ne[1],ne[2]):t:this[ne[0]]=ce?ne[1].call(this,ce,ne[2]):t:ne.length===4&&(this[ne[0]]=ce?ne[3].call(this,ce.replace(ne[1],ne[2])):t):this[ne]=ce||t;ue+=2}},X=function(Te,Re){for(var Ne in Re)if(typeof Re[Ne]===i&&Re[Ne].length>0){for(var Q=0;Q<Re[Ne].length;Q++)if(F(Re[Ne][Q],Te))return Ne==="?"?t:Ne}else if(F(Re[Ne],Te))return Ne==="?"?t:Ne;return Te},M={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},J={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[u,[c,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[u,[c,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[c,u],[/opios[\/ ]+([\w\.]+)/i],[u,[c,T+" Mini"]],[/\bopr\/([\w\.]+)/i],[u,[c,T]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[c,u],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[u,[c,"UC"+w]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[u,[c,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[u,[c,"WeChat"]],[/konqueror\/([\w\.]+)/i],[u,[c,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[u,[c,"IE"]],[/yabrowser\/([\w\.]+)/i],[u,[c,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[c,/(.+)/,"$1 Secure "+w],u],[/\bfocus\/([\w\.]+)/i],[u,[c,z+" Focus"]],[/\bopt\/([\w\.]+)/i],[u,[c,T+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[u,[c,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[u,[c,"Dolphin"]],[/coast\/([\w\.]+)/i],[u,[c,T+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[u,[c,"MIUI "+w]],[/fxios\/([-\w\.]+)/i],[u,[c,z]],[/\bqihu|(qi?ho?o?|360)browser/i],[[c,"360 "+w]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[c,/(.+)/,"$1 "+w],u],[/(comodo_dragon)\/([\w\.]+)/i],[[c,/_/g," "],u],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[c,u],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[c],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[c,f],u],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[c,u],[/\bgsa\/([\w\.]+) .*safari\//i],[u,[c,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[u,[c,V+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[c,V+" WebView"],u],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[u,[c,"Android "+w]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[c,u],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[u,[c,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[u,c],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[c,[u,X,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[c,u],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[c,"Netscape"],u],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[u,[c,z+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[c,u],[/(cobalt)\/([\w\.]+)/i],[c,[u,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[h,"amd64"]],[/(ia32(?=;))/i],[[h,te]],[/((?:i[346]|x)86)[;\)]/i],[[h,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[h,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[h,"armhf"]],[/windows (ce|mobile); ppc;/i],[[h,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[h,/ower/,"",te]],[/(sun4\w)[;\)]/i],[[h,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[h,te]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[a,[l,x],[d,g]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[a,[l,x],[d,_]],[/\((ip(?:hone|od)[\w ]*);/i],[a,[l,N],[d,_]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[a,[l,N],[d,g]],[/(macintosh);/i],[a,[l,N]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[a,[l,D],[d,_]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[a,[l,H],[d,g]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[a,[l,H],[d,_]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[a,/_/g," "],[l,P],[d,_]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[a,/_/g," "],[l,P],[d,g]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[a,[l,"OPPO"],[d,_]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[a,[l,"Vivo"],[d,_]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[a,[l,"Realme"],[d,_]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[a,[l,S],[d,_]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[a,[l,S],[d,g]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[a,[l,A],[d,g]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[a,[l,A],[d,_]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[a,[l,"Lenovo"],[d,g]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[a,/_/g," "],[l,"Nokia"],[d,_]],[/(pixel c)\b/i],[a,[l,K],[d,g]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[a,[l,K],[d,_]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[a,[l,k],[d,_]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[a,"Xperia Tablet"],[l,k],[d,g]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[a,[l,"OnePlus"],[d,_]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[a,[l,I],[d,g]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[a,/(.+)/g,"Fire Phone $1"],[l,I],[d,_]],[/(playbook);[-\w\),; ]+(rim)/i],[a,l,[d,g]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[a,[l,U],[d,_]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[a,[l,L],[d,g]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[a,[l,L],[d,_]],[/(nexus 9)/i],[a,[l,"HTC"],[d,g]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[l,[a,/_/g," "],[d,_]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[a,[l,"Acer"],[d,g]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[a,[l,"Meizu"],[d,_]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[l,a,[d,_]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[l,a,[d,g]],[/(surface duo)/i],[a,[l,m],[d,g]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[a,[l,"Fairphone"],[d,_]],[/(u304aa)/i],[a,[l,"AT&T"],[d,_]],[/\bsie-(\w*)/i],[a,[l,"Siemens"],[d,_]],[/\b(rct\w+) b/i],[a,[l,"RCA"],[d,g]],[/\b(venue[\d ]{2,7}) b/i],[a,[l,"Dell"],[d,g]],[/\b(q(?:mv|ta)\w+) b/i],[a,[l,"Verizon"],[d,g]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[a,[l,"Barnes & Noble"],[d,g]],[/\b(tm\d{3}\w+) b/i],[a,[l,"NuVision"],[d,g]],[/\b(k88) b/i],[a,[l,"ZTE"],[d,g]],[/\b(nx\d{3}j) b/i],[a,[l,"ZTE"],[d,_]],[/\b(gen\d{3}) b.+49h/i],[a,[l,"Swiss"],[d,_]],[/\b(zur\d{3}) b/i],[a,[l,"Swiss"],[d,g]],[/\b((zeki)?tb.*\b) b/i],[a,[l,"Zeki"],[d,g]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[l,"Dragon Touch"],a,[d,g]],[/\b(ns-?\w{0,9}) b/i],[a,[l,"Insignia"],[d,g]],[/\b((nxa|next)-?\w{0,9}) b/i],[a,[l,"NextBook"],[d,g]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[l,"Voice"],a,[d,_]],[/\b(lvtel\-)?(v1[12]) b/i],[[l,"LvTel"],a,[d,_]],[/\b(ph-1) /i],[a,[l,"Essential"],[d,_]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[a,[l,"Envizen"],[d,g]],[/\b(trio[-\w\. ]+) b/i],[a,[l,"MachSpeed"],[d,g]],[/\btu_(1491) b/i],[a,[l,"Rotor"],[d,g]],[/(shield[\w ]+) b/i],[a,[l,"Nvidia"],[d,g]],[/(sprint) (\w+)/i],[l,a,[d,_]],[/(kin\.[onetw]{3})/i],[[a,/\./g," "],[l,m],[d,_]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[a,[l,y],[d,g]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[a,[l,y],[d,_]],[/smart-tv.+(samsung)/i],[l,[d,E]],[/hbbtv.+maple;(\d+)/i],[[a,/^/,"SmartTV"],[l,x],[d,E]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[l,A],[d,E]],[/(apple) ?tv/i],[l,[a,N+" TV"],[d,E]],[/crkey/i],[[a,V+"cast"],[l,K],[d,E]],[/droid.+aft(\w)( bui|\))/i],[a,[l,I],[d,E]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[a,[l,D],[d,E]],[/(bravia[\w ]+)( bui|\))/i],[a,[l,k],[d,E]],[/(mitv-\w{5}) bui/i],[a,[l,P],[d,E]],[/Hbbtv.*(technisat) (.*);/i],[l,a,[d,E]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[l,G],[a,G],[d,E]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[d,E]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[l,a,[d,p]],[/droid.+; (shield) bui/i],[a,[l,"Nvidia"],[d,p]],[/(playstation [345portablevi]+)/i],[a,[l,k],[d,p]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[a,[l,m],[d,p]],[/((pebble))app/i],[l,a,[d,b]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[a,[l,N],[d,b]],[/droid.+; (glass) \d/i],[a,[l,K],[d,b]],[/droid.+; (wt63?0{2,3})\)/i],[a,[l,y],[d,b]],[/(quest( 2| pro)?)/i],[a,[l,f],[d,b]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[l,[d,v]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[a,[d,_]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[a,[d,g]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[d,g]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[d,_]],[/(android[-\w\. ]{0,9});.+buil/i],[a,[l,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[u,[c,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[u,[c,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[c,u],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[u,c]],os:[[/microsoft (windows) (vista|xp)/i],[c,u],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[c,[u,X,M]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[c,"Windows"],[u,X,M]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[u,/_/g,"."],[c,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[c,B],[u,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[u,c],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[c,u],[/\(bb(10);/i],[u,[c,U]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[u,[c,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[u,[c,z+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[u,[c,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[u,[c,"watchOS"]],[/crkey\/([\d\.]+)/i],[u,[c,V+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[c,R],u],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[c,u],[/(sunos) ?([\w\.\d]*)/i],[[c,"Solaris"],u],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[c,u]]},de=function(Te,Re){if(typeof Te===i&&(Re=Te,Te=t),!(this instanceof de))return new de(Te,Re).getResult();var Ne=typeof e!==n&&e.navigator?e.navigator:t,Q=Te||(Ne&&Ne.userAgent?Ne.userAgent:""),re=Ne&&Ne.userAgentData?Ne.userAgentData:t,ne=Re?function(oe,ce){var ue={};for(var fe in oe)ce[fe]&&ce[fe].length%2==0?ue[fe]=ce[fe].concat(oe[fe]):ue[fe]=oe[fe];return ue}(J,Re):J;return this.getBrowser=function(){var oe={};return oe[c]=t,oe[u]=t,Y.call(oe,Q,ne.browser),oe[o]=function(ce){return typeof ce===s?ce.replace(/[^\d\.]/g,"").split(".")[0]:t}(oe[u]),Ne&&Ne.brave&&typeof Ne.brave.isBrave==r&&(oe[c]="Brave"),oe},this.getCPU=function(){var oe={};return oe[h]=t,Y.call(oe,Q,ne.cpu),oe},this.getDevice=function(){var oe={};return oe[l]=t,oe[a]=t,oe[d]=t,Y.call(oe,Q,ne.device),!oe[d]&&re&&re.mobile&&(oe[d]=_),oe[a]=="Macintosh"&&Ne&&typeof Ne.standalone!==n&&Ne.maxTouchPoints&&Ne.maxTouchPoints>2&&(oe[a]="iPad",oe[d]=g),oe},this.getEngine=function(){var oe={};return oe[c]=t,oe[u]=t,Y.call(oe,Q,ne.engine),oe},this.getOS=function(){var oe={};return oe[c]=t,oe[u]=t,Y.call(oe,Q,ne.os),!oe[c]&&re&&re.platform!="Unknown"&&(oe[c]=re.platform.replace(/chrome os/i,R).replace(/macos/i,B)),oe},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Q},this.setUA=function(oe){return Q=typeof oe===s&&oe.length>350?G(oe,350):oe,this},this.setUA(Q),this};de.VERSION="0.7.34",de.BROWSER=q([c,u,o]),de.CPU=q([h]),de.DEVICE=q([a,l,d,p,_,E,g,b,v]),de.ENGINE=de.OS=q([c,u]),kA.exports&&(LA=kA.exports=de),LA.UAParser=de;var he=typeof e!==n&&(e.jQuery||e.Zepto);if(he&&!he.ua){var Se=new de;he.ua=Se.getResult(),he.ua.get=function(){return Se.getUA()},he.ua.set=function(Te){Se.setUA(Te);var Re=Se.getResult();for(var Ne in Re)he.ua[Ne]=Re[Ne]}}}(typeof window=="object"?window:cm);var vOe=Pr(z2.exports),yOe=Id,bOe=Xn,SOe=E0,wOe=jf,TOe=qr("iterator"),ROe=Object,AOe=function(e){if(SOe(e))return!1;var t=ROe(e);return t[TOe]!==void 0||"@@iterator"in t||bOe(wOe,yOe(t))},COe=Pr(AOe),MA=an;Jt({global:!0,forced:MA.globalThis!==MA},{globalThis:MA});var O4=Pr(an),N4=Qw.clear;Jt({global:!0,bind:!0,enumerable:!0,forced:an.clearImmediate!==N4},{clearImmediate:N4});var IOe=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",LK=an,OOe=Uw,NOe=Nn,DOe=IOe,POe=eh,kOe=Xw,LOe=T0,xOe=LK.Function,MOe=/MSIE .\./.test(POe)||DOe&&function(){var e=LK.Bun.version.split(".");return e.length<3||e[0]==0&&(e[1]<3||e[1]==3&&e[2]==0)}(),UOe=Jt,xK=an,D4=Qw.set,jOe=function(e,t){var r=1;return MOe?function(n,i){var s=LOe(arguments.length,1)>r,o=NOe(n)?n:xOe(n),a=s?kOe(arguments,r):[],c=s?function(){OOe(o,this,a)}:o;return e(c)}:e},P4=xK.setImmediate?jOe(D4):D4;UOe({global:!0,bind:!0,enumerable:!0,forced:xK.setImmediate!==P4},{setImmediate:P4});var k4=Pr(Ko.setImmediate),FOe=Jt,BOe=xq,VOe=Yo,$Oe=T0,HOe=w0,zOe=an.process;FOe({global:!0,enumerable:!0,dontCallGetSet:!0},{queueMicrotask:function(e){$Oe(arguments.length,1),VOe(e);var t=HOe&&zOe.domain;BOe(t?t.bind(e):e)}});var L4=Pr(Ko.queueMicrotask);function MK(e,t){return function(){return e.apply(t,arguments)}}const{toString:WOe}=Object.prototype,{getPrototypeOf:r3}=Object,cS=(UA=Object.create(null),e=>{const t=WOe.call(e);return UA[t]||(UA[t]=t.slice(8,-1).toLowerCase())});var UA;const wc=e=>(e=e.toLowerCase(),t=>cS(t)===e),tT=e=>t=>typeof t===e,{isArray:vp}=Array,Ng=tT("undefined"),x4=wc("ArrayBuffer"),GOe=tT("string"),So=tT("function"),M4=tT("number"),ry=e=>e!==null&&typeof e=="object",ny=e=>{if(cS(e)!=="object")return!1;const t=r3(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.toStringTag in e||COe(e))},qOe=wc("Date"),KOe=wc("File"),YOe=wc("Blob"),JOe=wc("FileList"),XOe=wc("URLSearchParams"),[QOe,ZOe,e2e,t2e]=["ReadableStream","Request","Response","Headers"].map(wc);function Dg(e,t){let r,n,{allOwnKeys:i=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),vp(e))for(r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else{const s=i?Object.getOwnPropertyNames(e):Object.keys(e),o=s.length;let a;for(r=0;r<o;r++)a=s[r],t.call(null,e[a],a,e)}}function U4(e,t){t=t.toLowerCase();const r=Object.keys(e);let n,i=r.length;for(;i-- >0;)if(n=r[i],t===n.toLowerCase())return n;return null}const Vh=O4!==void 0?O4:typeof self<"u"?self:typeof window<"u"?window:global,j4=e=>!Ng(e)&&e!==Vh,r2e=(jA=typeof Uint8Array<"u"&&r3(Uint8Array),e=>jA&&e instanceof jA);var jA;const n2e=wc("HTMLFormElement"),F4=(e=>{let{hasOwnProperty:t}=e;return(r,n)=>t.call(r,n)})(Object.prototype),i2e=wc("RegExp"),B4=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};Dg(r,(i,s)=>{let o;(o=t(i,s,e))!==!1&&(n[s]=o||i)}),Object.defineProperties(e,n)},FA="abcdefghijklmnopqrstuvwxyz",V4="0123456789",$4={DIGIT:V4,ALPHA:FA,ALPHA_DIGIT:FA+FA.toUpperCase()+V4},s2e=wc("AsyncFunction"),UK=(H4=typeof k4=="function",z4=So(Vh.postMessage),H4?k4:z4?(BA="axios@".concat(Math.random()),iy=[],Vh.addEventListener("message",e=>{let{source:t,data:r}=e;t===Vh&&r===BA&&iy.length&&iy.shift()()},!1),e=>{iy.push(e),Vh.postMessage(BA,"*")}):e=>setTimeout(e));var H4,z4,BA,iy;const o2e=L4!==void 0?L4.bind(Vh):typeof process<"u"&&process.nextTick||UK;var pe={isArray:vp,isArrayBuffer:x4,isBuffer:function(e){return e!==null&&!Ng(e)&&e.constructor!==null&&!Ng(e.constructor)&&So(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||So(e.append)&&((t=cS(e))==="formdata"||t==="object"&&So(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&x4(e.buffer),t},isString:GOe,isNumber:M4,isBoolean:e=>e===!0||e===!1,isObject:ry,isPlainObject:ny,isReadableStream:QOe,isRequest:ZOe,isResponse:e2e,isHeaders:t2e,isUndefined:Ng,isDate:qOe,isFile:KOe,isBlob:YOe,isRegExp:i2e,isFunction:So,isStream:e=>ry(e)&&So(e.pipe),isURLSearchParams:XOe,isTypedArray:r2e,isFileList:JOe,forEach:Dg,merge:function e(){const{caseless:t}=j4(this)&&this||{},r={},n=(i,s)=>{const o=t&&U4(r,s)||s;ny(r[o])&&ny(i)?r[o]=e(r[o],i):ny(i)?r[o]=e({},i):vp(i)?r[o]=i.slice():r[o]=i};for(let i=0,s=arguments.length;i<s;i++)arguments[i]&&Dg(arguments[i],n);return r},extend:function(e,t,r){let{allOwnKeys:n}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Dg(t,(i,s)=>{r&&So(i)?e[s]=MK(i,r):e[s]=i},{allOwnKeys:n}),e},trim:e=>fi(e)?fi(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,n)=>{let i,s,o;const a={};if(t=t||{},e==null)return t;do{for(i=Object.getOwnPropertyNames(e),s=i.length;s-- >0;)o=i[s],n&&!n(o,e,t)||a[o]||(t[o]=e[o],a[o]=!0);e=r!==!1&&r3(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:cS,kindOfTest:wc,endsWith:(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return n!==-1&&n===r},toArray:e=>{if(!e)return null;if(vp(e))return e;let t=e.length;if(!M4(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{const r=(e&&e[Symbol.iterator]).call(e);let n;for(;(n=r.next())&&!n.done;){const i=n.value;t.call(e,i[0],i[1])}},matchAll:(e,t)=>{let r;const n=[];for(;(r=e.exec(t))!==null;)n.push(r);return n},isHTMLForm:n2e,hasOwnProperty:F4,hasOwnProp:F4,reduceDescriptors:B4,freezeMethods:e=>{B4(e,(t,r)=>{if(So(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=e[r];So(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))})},toObjectSet:(e,t)=>{const r={},n=i=>{i.forEach(s=>{r[s]=!0})};return vp(e)?n(e):n(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,n){return r.toUpperCase()+n}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:U4,global:Vh,isContextDefined:j4,ALPHABET:$4,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:$4.ALPHA_DIGIT,r="";const{length:n}=t;for(;e--;)r+=t[Math.random()*n|0];return r},isSpecCompliantForm:function(e){return!!(e&&So(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),r=(n,i)=>{if(ry(n)){if(t.indexOf(n)>=0)return;if(!("toJSON"in n)){t[i]=n;const s=vp(n)?[]:{};return Dg(n,(o,a)=>{const c=r(o,i+1);!Ng(c)&&(s[a]=c)}),t[i]=void 0,s}}return n};return r(e,0)},isAsyncFn:s2e,isThenable:e=>e&&(ry(e)||So(e))&&So(e.then)&&So(e.catch),setImmediate:UK,asap:o2e};function Yt(e,t,r,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}pe.inherits(Yt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:pe.toJSONObject(this.config),code:this.code,status:this.status}}});const W4=Yt.prototype,G4={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{G4[e]={value:e}}),Object.defineProperties(Yt,G4),Object.defineProperty(W4,"isAxiosError",{value:!0}),Yt.from=(e,t,r,n,i,s)=>{const o=Object.create(W4);return pe.toFlatObject(e,o,function(a){return a!==Error.prototype},a=>a!=="isAxiosError"),Yt.call(o,e.message,t,r,n,i),o.cause=e,o.name=e.name,s&&Object.assign(o,s),o};function VA(e){return pe.isPlainObject(e)||pe.isArray(e)}function jK(e){return pe.endsWith(e,"[]")?e.slice(0,-2):e}function q4(e,t,r){return e?e.concat(t).map(function(n,i){return n=jK(n),!r&&i?"["+n+"]":n}).join(r?".":""):t}const a2e=pe.toFlatObject(pe,{},null,function(e){return/^is[A-Z]/.test(e)});function dS(e,t,r){if(!pe.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const n=(r=pe.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(h,p){return!pe.isUndefined(p[h])})).metaTokens,i=r.visitor||d,s=r.dots,o=r.indexes,a=(r.Blob||typeof Blob<"u"&&Blob)&&pe.isSpecCompliantForm(t);if(!pe.isFunction(i))throw new TypeError("visitor must be a function");function c(h){if(h===null)return"";if(pe.isDate(h))return h.toISOString();if(!a&&pe.isBlob(h))throw new Yt("Blob is not supported. Use a Buffer instead.");return pe.isArrayBuffer(h)||pe.isTypedArray(h)?a&&typeof Blob=="function"?new Blob([h]):Buffer.from(h):h}function d(h,p,_){let g=h;if(h&&!_&&typeof h=="object"){if(pe.endsWith(p,"{}"))p=n?p:p.slice(0,-2),h=JSON.stringify(h);else if(pe.isArray(h)&&function(E){return pe.isArray(E)&&!E.some(VA)}(h)||(pe.isFileList(h)||pe.endsWith(p,"[]"))&&(g=pe.toArray(h)))return p=jK(p),g.forEach(function(E,b){!pe.isUndefined(E)&&E!==null&&t.append(o===!0?q4([p],b,s):o===null?p:p+"[]",c(E))}),!1}return!!VA(h)||(t.append(q4(_,p,s),c(h)),!1)}const l=[],u=Object.assign(a2e,{defaultVisitor:d,convertValue:c,isVisitable:VA});if(!pe.isObject(e))throw new TypeError("data must be an object");return function h(p,_){if(!pe.isUndefined(p)){if(l.indexOf(p)!==-1)throw Error("Circular reference detected in "+_.join("."));l.push(p),pe.forEach(p,function(g,E){(!(pe.isUndefined(g)||g===null)&&i.call(t,g,pe.isString(E)?fi(E).call(E):E,_,u))===!0&&h(g,_?_.concat(E):[E])}),l.pop()}}(e),t}function K4(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(r){return t[r]})}function n3(e,t){this._pairs=[],e&&dS(e,this,t)}const Y4=n3.prototype;function c2e(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function FK(e,t,r){if(!t)return e;const n=r&&r.encode||c2e,i=r&&r.serialize;let s;if(s=i?i(t,r):pe.isURLSearchParams(t)?t.toString():new n3(t,r).toString(n),s){const o=e.indexOf("#");o!==-1&&(e=e.slice(0,o)),e+=(e.indexOf("?")===-1?"?":"&")+s}return e}Y4.append=function(e,t){this._pairs.push([e,t])},Y4.toString=function(e){const t=e?function(r){return e.call(this,r,K4)}:K4;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};var J4=class{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){pe.forEach(this.handlers,function(t){t!==null&&e(t)})}},BK={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},VK={exports:{}},d2e=Jt,l2e=qo,X4=Ua.f;d2e({target:"Object",stat:!0,forced:Object.defineProperty!==X4,sham:!l2e},{defineProperty:X4});var $K=Ko.Object,u2e=VK.exports=function(e,t,r){return $K.defineProperty(e,t,r)};$K.defineProperty.sham&&(u2e.sham=!0);var HK=Pr(VK.exports),h2e=Ad,ov=Array.isArray||function(e){return h2e(e)=="Array"},f2e=TypeError,Q4=ov,p2e=Jw,m2e=Eo,g2e=qr("species"),Z4=Array,_2e=function(e){var t;return Q4(e)&&(t=e.constructor,(p2e(t)&&(t===Z4||Q4(t.prototype))||m2e(t)&&(t=t[g2e])===null)&&(t=void 0)),t===void 0?Z4:t},zK=function(e,t){return new(_2e(e))(t===0?0:t)},E2e=en,v2e=vf,y2e=qr("species"),WK=function(e){return v2e>=51||!E2e(function(){var t=[];return(t.constructor={})[y2e]=function(){return{foo:1}},t[e](Boolean).foo!==1})},b2e=Jt,S2e=en,w2e=ov,T2e=Eo,R2e=Cd,A2e=Ol,e8=function(e){if(e>9007199254740991)throw f2e("Maximum allowed index exceeded");return e},t8=eT,C2e=zK,I2e=WK,O2e=vf,GK=qr("isConcatSpreadable"),N2e=O2e>=51||!S2e(function(){var e=[];return e[GK]=!1,e.concat()[0]!==e}),D2e=function(e){if(!T2e(e))return!1;var t=e[GK];return t!==void 0?!!t:w2e(e)};b2e({target:"Array",proto:!0,arity:1,forced:!N2e||!I2e("concat")},{concat:function(e){var t,r,n,i,s,o=R2e(this),a=C2e(o,0),c=0;for(t=-1,n=arguments.length;t<n;t++)if(D2e(s=t===-1?o:arguments[t]))for(i=A2e(s),e8(c+i),r=0;r<i;r++,c++)r in s&&t8(a,c,s[r]);else e8(c+1),t8(a,c++,s);return a.length=c,a}});var qK={},P2e=Ad,k2e=Zu,r8=Ww.f,L2e=e3,n8=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];qK.f=function(e){return n8&&P2e(e)=="Window"?function(t){try{return r8(t)}catch{return L2e(n8)}}(e):r8(k2e(e))};var A0={},x2e=qr;A0.f=x2e;var i8=Ko,M2e=Xn,U2e=A0,j2e=Ua.f,xn=function(e){var t=i8.Symbol||(i8.Symbol={});M2e(t,e)||j2e(t,e,{value:U2e.f(e)})},F2e=$n,B2e=ks,V2e=qr,$2e=nh,KK=function(){var e=B2e("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,n=V2e("toPrimitive");t&&!t[n]&&$2e(t,n,function(i){return F2e(r,this)},{arity:1})},H2e=th,z2e=Bw,W2e=Cd,G2e=Ol,q2e=zK,s8=Jr([].push),Ul=function(e){var t=e==1,r=e==2,n=e==3,i=e==4,s=e==6,o=e==7,a=e==5||s;return function(c,d,l,u){for(var h,p,_=W2e(c),g=z2e(_),E=H2e(d,l),b=G2e(g),v=0,I=u||q2e,N=t?I(c,b):r||o?I(c,0):void 0;b>v;v++)if((a||v in g)&&(p=E(h=g[v],v,_),e))if(t)N[v]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return v;case 2:s8(N,h)}else switch(e){case 4:return!1;case 7:s8(N,h)}return s?-1:n||i?i:N}},YK={forEach:Ul(0),map:Ul(1),filter:Ul(2),some:Ul(3),every:Ul(4),find:Ul(5),findIndex:Ul(6),filterReject:Ul(7)},sy=Jt,i3=an,s3=$n,K2e=Jr,um=qo,tp=y0,Y2e=en,Ai=Xn,J2e=ki,W2=hs,rT=Zu,o3=$w,X2e=Jo,G2=Qu,oE=tv,JK=qw,Q2e=Ww,XK=qK,Z2e=ev,QK=XE,ZK=Ua,eNe=$P,eY=Fw,o8=nh,tNe=Yw,a3=S0,tY=Gw,a8=kP,rNe=qr,nNe=A0,iNe=xn,sNe=KK,oNe=ih,rY=Ff,nT=YK.forEach,Js=zw("hidden"),lS="Symbol",aE="prototype",aNe=rY.set,c8=rY.getterFor(lS),uc=Object[aE],$p=i3.Symbol,Cb=$p&&$p[aE],cNe=i3.TypeError,$A=i3.QObject,nY=QK.f,Ih=ZK.f,iY=XK.f,dNe=eY.f,sY=K2e([].push),Rl=a3("symbols"),av=a3("op-symbols"),lNe=a3("wks"),HA=!$A||!$A[aE]||!$A[aE].findChild,q2=um&&Y2e(function(){return oE(Ih({},"a",{get:function(){return Ih(this,"a",{value:7}).a}})).a!=7})?function(e,t,r){var n=nY(uc,t);n&&delete uc[t],Ih(e,t,r),n&&e!==uc&&Ih(uc,t,n)}:Ih,zA=function(e,t){var r=Rl[e]=oE(Cb);return aNe(r,{type:lS,tag:e,description:t}),um||(r.description=t),r},uS=function(e,t,r){e===uc&&uS(av,t,r),W2(e);var n=o3(t);return W2(r),Ai(Rl,n)?(r.enumerable?(Ai(e,Js)&&e[Js][n]&&(e[Js][n]=!1),r=oE(r,{enumerable:G2(0,!1)})):(Ai(e,Js)||Ih(e,Js,G2(1,{})),e[Js][n]=!0),q2(e,n,r)):Ih(e,n,r)},WA=function(e,t){W2(e);var r=rT(t),n=JK(r).concat(aY(r));return nT(n,function(i){um&&!s3(oY,r,i)||uS(e,i,r[i])}),e},oY=function(e){var t=o3(e),r=s3(dNe,this,t);return!(this===uc&&Ai(Rl,t)&&!Ai(av,t))&&(!(r||!Ai(this,t)||!Ai(Rl,t)||Ai(this,Js)&&this[Js][t])||r)},d8=function(e,t){var r=rT(e),n=o3(t);if(r!==uc||!Ai(Rl,n)||Ai(av,n)){var i=nY(r,n);return!i||!Ai(Rl,n)||Ai(r,Js)&&r[Js][n]||(i.enumerable=!0),i}},l8=function(e){var t=iY(rT(e)),r=[];return nT(t,function(n){Ai(Rl,n)||Ai(tY,n)||sY(r,n)}),r},aY=function(e){var t=e===uc,r=iY(t?av:rT(e)),n=[];return nT(r,function(i){!Ai(Rl,i)||t&&!Ai(uc,i)||sY(n,Rl[i])}),n};tp||(o8(Cb=($p=function(){if(J2e(Cb,this))throw cNe("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?X2e(arguments[0]):void 0,t=a8(e),r=function(n){this===uc&&s3(r,av,n),Ai(this,Js)&&Ai(this[Js],t)&&(this[Js][t]=!1),q2(this,t,G2(1,n))};return um&&HA&&q2(uc,t,{configurable:!0,set:r}),zA(t,e)})[aE],"toString",function(){return c8(this).tag}),o8($p,"withoutSetter",function(e){return zA(a8(e),e)}),eY.f=oY,ZK.f=uS,eNe.f=WA,QK.f=d8,Q2e.f=XK.f=l8,Z2e.f=aY,nNe.f=function(e){return zA(rNe(e),e)},um&&tNe(Cb,"description",{configurable:!0,get:function(){return c8(this).description}})),sy({global:!0,constructor:!0,wrap:!0,forced:!tp,sham:!tp},{Symbol:$p}),nT(JK(lNe),function(e){iNe(e)}),sy({target:lS,stat:!0,forced:!tp},{useSetter:function(){HA=!0},useSimple:function(){HA=!1}}),sy({target:"Object",stat:!0,forced:!tp,sham:!um},{create:function(e,t){return t===void 0?oE(e):WA(oE(e),t)},defineProperty:uS,defineProperties:WA,getOwnPropertyDescriptor:d8}),sy({target:"Object",stat:!0,forced:!tp},{getOwnPropertyNames:l8}),sNe(),oNe($p,lS),tY[Js]=!0;var cY=y0&&!!Symbol.for&&!!Symbol.keyFor,uNe=Jt,hNe=ks,fNe=Xn,pNe=Jo,dY=S0,mNe=cY,GA=dY("string-to-symbol-registry"),gNe=dY("symbol-to-string-registry");uNe({target:"Symbol",stat:!0,forced:!mNe},{for:function(e){var t=pNe(e);if(fNe(GA,t))return GA[t];var r=hNe("Symbol")(t);return GA[t]=r,gNe[r]=t,r}});var _Ne=Jt,ENe=Xn,vNe=QE,yNe=b0,bNe=cY,u8=S0("symbol-to-string-registry");_Ne({target:"Symbol",stat:!0,forced:!bNe},{keyFor:function(e){if(!vNe(e))throw TypeError(yNe(e)+" is not a symbol");if(ENe(u8,e))return u8[e]}});var h8=ov,SNe=Nn,f8=Ad,wNe=Jo,p8=Jr([].push),TNe=Jt,lY=ks,uY=Uw,RNe=$n,cv=Jr,hY=en,m8=Nn,g8=QE,fY=Xw,ANe=function(e){if(SNe(e))return e;if(h8(e)){for(var t=e.length,r=[],n=0;n<t;n++){var i=e[n];typeof i=="string"?p8(r,i):typeof i!="number"&&f8(i)!="Number"&&f8(i)!="String"||p8(r,wNe(i))}var s=r.length,o=!0;return function(a,c){if(o)return o=!1,c;if(h8(this))return c;for(var d=0;d<s;d++)if(r[d]===a)return c}}},CNe=y0,INe=String,Cu=lY("JSON","stringify"),oy=cv(/./.exec),_8=cv("".charAt),ONe=cv("".charCodeAt),NNe=cv("".replace),DNe=cv(1 .toString),PNe=/[\uD800-\uDFFF]/g,E8=/^[\uD800-\uDBFF]$/,v8=/^[\uDC00-\uDFFF]$/,y8=!CNe||hY(function(){var e=lY("Symbol")();return Cu([e])!="[null]"||Cu({a:e})!="{}"||Cu(Object(e))!="{}"}),b8=hY(function(){return Cu("\uDF06\uD834")!=='"\\udf06\\ud834"'||Cu("\uDEAD")!=='"\\udead"'}),kNe=function(e,t){var r=fY(arguments),n=ANe(t);if(m8(n)||e!==void 0&&!g8(e))return r[1]=function(i,s){if(m8(n)&&(s=RNe(n,this,INe(i),s)),!g8(s))return s},uY(Cu,null,r)},LNe=function(e,t,r){var n=_8(r,t-1),i=_8(r,t+1);return oy(E8,e)&&!oy(v8,i)||oy(v8,e)&&!oy(E8,n)?"\\u"+DNe(ONe(e,0),16):e};Cu&&TNe({target:"JSON",stat:!0,arity:3,forced:y8||b8},{stringify:function(e,t,r){var n=fY(arguments),i=uY(y8?kNe:Cu,null,n);return b8&&typeof i=="string"?NNe(i,PNe,LNe):i}});var S8=ev,xNe=Cd;Jt({target:"Object",stat:!0,forced:!y0||en(function(){S8.f(1)})},{getOwnPropertySymbols:function(e){var t=S8.f;return t?t(xNe(e)):[]}}),xn("asyncIterator"),xn("hasInstance"),xn("isConcatSpreadable"),xn("iterator"),xn("match"),xn("matchAll"),xn("replace"),xn("search"),xn("species"),xn("split");var MNe=KK;xn("toPrimitive"),MNe();var UNe=ks,jNe=ih;xn("toStringTag"),jNe(UNe("Symbol"),"Symbol"),xn("unscopables"),ih(an.JSON,"JSON",!0);var FNe=Ko.Symbol,BNe=qr,VNe=Ua.f,w8=BNe("metadata"),T8=Function.prototype;T8[w8]===void 0&&VNe(T8,w8,{value:null}),xn("dispose"),xn("metadata");var $Ne=FNe;xn("asyncDispose");var HNe=Jr,c3=ks("Symbol"),zNe=c3.keyFor,WNe=HNe(c3.prototype.valueOf),pY=c3.isRegisteredSymbol||function(e){try{return zNe(WNe(e))!==void 0}catch{return!1}};Jt({target:"Symbol",stat:!0},{isRegisteredSymbol:pY});for(var GNe=S0,R8=ks,qNe=Jr,KNe=QE,YNe=qr,ay=R8("Symbol"),A8=ay.isWellKnownSymbol,mY=R8("Object","getOwnPropertyNames"),JNe=qNe(ay.prototype.valueOf),C8=GNe("wks"),qA=0,I8=mY(ay),XNe=I8.length;qA<XNe;qA++)try{var O8=I8[qA];KNe(ay[O8])&&YNe(O8)}catch{}var N8=function(e){if(A8&&A8(e))return!0;try{for(var t=JNe(e),r=0,n=mY(C8),i=n.length;r<i;r++)if(C8[n[r]]==t)return!0}catch{}return!1};Jt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:N8}),xn("matcher"),xn("observable"),Jt({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:pY}),Jt({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:N8}),xn("metadataKey"),xn("patternMatch"),xn("replaceAll");var Hp=Pr($Ne),gY=Pr(A0.f("iterator"));function o_(e){return o_=typeof Hp=="function"&&typeof gY=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Hp=="function"&&t.constructor===Hp&&t!==Hp.prototype?"symbol":typeof t},o_(e)}var QNe=Pr(A0.f("toPrimitive"));function ZNe(e){var t=function(r,n){if(o_(r)!=="object"||r===null)return r;var i=r[QNe];if(i!==void 0){var s=i.call(r,n);if(o_(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}(e,"string");return o_(t)==="symbol"?t:String(t)}function j(e,t,r){return(t=ZNe(t))in e?HK(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var eDe=en,tDe=qr("iterator"),d3=!eDe(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,r=new URLSearchParams("a=1&a=2"),n="";return e.pathname="c%20d",t.forEach(function(i,s){t.delete("b"),n+=s+i}),r.delete("a",2),!e.toJSON||!r.has("a",1)||r.has("a",2)||!t.size&&!0||!t.sort||e.href!=="http://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[tDe]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://тест").host!=="xn--e1aybc"||new URL("http://a#б").hash!=="#%D0%B1"||n!=="a1c3"||new URL("http://x",void 0).host!=="x"}),rDe=nh,KA=Jt,Um=an,cy=$n,yd=Jr,zp=qo,D8=d3,P8=nh,nDe=Yw,iDe=function(e,t,r){for(var n in t)r&&r.unsafe&&e[n]?e[n]=t[n]:rDe(e,n,t[n],r);return e},sDe=ih,oDe=zP,l3=Ff,_Y=GP,YA=Nn,aDe=Xn,cDe=th,dDe=Id,lDe=hs,EY=Eo,_s=Jo,uDe=tv,k8=Qu,K2=HP,hDe=Kw,rp=T0,fDe=PK,pDe=qr("iterator"),cE="URLSearchParams",vY=cE+"Iterator",yY=l3.set,ma=l3.getterFor(cE),mDe=l3.getterFor(vY),gDe=Object.getOwnPropertyDescriptor,u3=function(e){if(!zp)return Um[e];var t=gDe(Um,e);return t&&t.value},L8=u3("fetch"),hS=u3("Request"),a_=u3("Headers"),JA=hS&&hS.prototype,x8=a_&&a_.prototype,_De=Um.RegExp,EDe=Um.TypeError,bY=Um.decodeURIComponent,vDe=Um.encodeURIComponent,yDe=yd("".charAt),M8=yd([].join),$h=yd([].push),Y2=yd("".replace),bDe=yd([].shift),U8=yd([].splice),j8=yd("".split),SDe=yd("".slice),wDe=/\+/g,F8=Array(4),TDe=function(e){return F8[e-1]||(F8[e-1]=_De("((?:%[\\da-f]{2}){"+e+"})","gi"))},RDe=function(e){try{return bY(e)}catch{return e}},B8=function(e){var t=Y2(e,wDe," "),r=4;try{return bY(t)}catch{for(;r;)t=Y2(t,TDe(r--),RDe);return t}},ADe=/[!'()~]|%20/g,CDe={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},IDe=function(e){return CDe[e]},V8=function(e){return Y2(vDe(e),ADe,IDe)},XA=oDe(function(e,t){yY(this,{type:vY,iterator:K2(ma(e).entries),kind:t})},"Iterator",function(){var e=mDe(this),t=e.kind,r=e.iterator.next(),n=r.value;return r.done||(r.value=t==="keys"?n.key:t==="values"?n.value:[n.key,n.value]),r},!0),SY=function(e){this.entries=[],this.url=null,e!==void 0&&(EY(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?yDe(e,0)==="?"?SDe(e,1):e:_s(e)))};SY.prototype={type:cE,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,n,i,s,o,a,c=hDe(e);if(c)for(r=(t=K2(e,c)).next;!(n=cy(r,t)).done;){if(s=(i=K2(lDe(n.value))).next,(o=cy(s,i)).done||(a=cy(s,i)).done||!cy(s,i).done)throw EDe("Expected sequence with length 2");$h(this.entries,{key:_s(o.value),value:_s(a.value)})}else for(var d in e)aDe(e,d)&&$h(this.entries,{key:d,value:_s(e[d])})},parseQuery:function(e){if(e)for(var t,r,n=j8(e,"&"),i=0;i<n.length;)(t=n[i++]).length&&(r=j8(t,"="),$h(this.entries,{key:B8(bDe(r)),value:B8(M8(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],n=0;n<t.length;)e=t[n++],$h(r,V8(e.key)+"="+V8(e.value));return M8(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var fS=function(){_Y(this,yp);var e=yY(this,new SY(arguments.length>0?arguments[0]:void 0));zp||(this.size=e.entries.length)},yp=fS.prototype;if(iDe(yp,{append:function(e,t){var r=ma(this);rp(arguments.length,2),$h(r.entries,{key:_s(e),value:_s(t)}),zp||this.length++,r.updateURL()},delete:function(e){for(var t=ma(this),r=rp(arguments.length,1),n=t.entries,i=_s(e),s=r<2?void 0:arguments[1],o=s===void 0?s:_s(s),a=0;a<n.length;){var c=n[a];if(c.key!==i||o!==void 0&&c.value!==o)a++;else if(U8(n,a,1),o!==void 0)break}zp||(this.size=n.length),t.updateURL()},get:function(e){var t=ma(this).entries;rp(arguments.length,1);for(var r=_s(e),n=0;n<t.length;n++)if(t[n].key===r)return t[n].value;return null},getAll:function(e){var t=ma(this).entries;rp(arguments.length,1);for(var r=_s(e),n=[],i=0;i<t.length;i++)t[i].key===r&&$h(n,t[i].value);return n},has:function(e){for(var t=ma(this).entries,r=rp(arguments.length,1),n=_s(e),i=r<2?void 0:arguments[1],s=i===void 0?i:_s(i),o=0;o<t.length;){var a=t[o++];if(a.key===n&&(s===void 0||a.value===s))return!0}return!1},set:function(e,t){var r=ma(this);rp(arguments.length,1);for(var n,i=r.entries,s=!1,o=_s(e),a=_s(t),c=0;c<i.length;c++)(n=i[c]).key===o&&(s?U8(i,c--,1):(s=!0,n.value=a));s||$h(i,{key:o,value:a}),zp||(this.size=i.length),r.updateURL()},sort:function(){var e=ma(this);fDe(e.entries,function(t,r){return t.key>r.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,r=ma(this).entries,n=cDe(e,arguments.length>1?arguments[1]:void 0),i=0;i<r.length;)n((t=r[i++]).value,t.key,this)},keys:function(){return new XA(this,"keys")},values:function(){return new XA(this,"values")},entries:function(){return new XA(this,"entries")}},{enumerable:!0}),P8(yp,pDe,yp.entries,{name:"entries"}),P8(yp,"toString",function(){return ma(this).serialize()},{enumerable:!0}),zp&&nDe(yp,"size",{get:function(){return ma(this).entries.length},configurable:!0,enumerable:!0}),sDe(fS,cE),KA({global:!0,constructor:!0,forced:!D8},{URLSearchParams:fS}),!D8&&YA(a_)){var ODe=yd(x8.has),NDe=yd(x8.set),$8=function(e){if(EY(e)){var t,r=e.body;if(dDe(r)===cE)return t=e.headers?new a_(e.headers):new a_,ODe(t,"content-type")||NDe(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),uDe(e,{body:k8(0,_s(r)),headers:k8(0,t)})}return e};if(YA(L8)&&KA({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return L8(e,arguments.length>1?$8(arguments[1]):{})}}),YA(hS)){var QA=function(e){return _Y(this,JA),new hS(e,arguments.length>1?$8(arguments[1]):{})};JA.constructor=QA,QA.prototype=JA,KA({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:QA})}}var DDe={URLSearchParams:fS,getState:ma},H8=Pr(Ko.URLSearchParams),PDe={isBrowser:!0,classes:{URLSearchParams:H8!==void 0?H8:n3,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const h3=typeof window<"u"&&typeof document<"u",J2=typeof navigator=="object"&&navigator||void 0,kDe=h3&&(!J2||["ReactNative","NativeScript","NS"].indexOf(J2.product)<0),LDe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",xDe=h3&&window.location.href||"http://localhost";function z8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function W8(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?z8(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var no=W8(W8({},Object.freeze({__proto__:null,hasBrowserEnv:h3,hasStandardBrowserEnv:kDe,hasStandardBrowserWebWorkerEnv:LDe,navigator:J2,origin:xDe})),PDe),MDe=hs,UDe=$n,jDe=Xn,FDe=ki,BDe=function(){var e=MDe(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},G8=RegExp.prototype,wY=function(e){var t=e.flags;return t!==void 0||"flags"in G8||jDe(e,"flags")||!FDe(G8,e)?t:UDe(BDe,e)},VDe=ZP.charAt,q8=$n,$De=hs,HDe=Nn,zDe=Ad,WDe=/./.exec,GDe=TypeError,qDe=Jt,K8=$n,TY=iE,KDe=zP,dy=WP,Y8=v0,RY=tq,dE=Jo,YDe=hs,JDe=E0,XDe=Ad,QDe=rq,AY=wY,ZDe=Vw,ePe=en,tPe=KP,rPe=function(e,t,r){return t+(r?VDe(e,t).length:1)},nPe=function(e,t){var r=e.exec;if(HDe(r)){var n=q8(r,e,t);return n!==null&&$De(n),n}if(zDe(e)==="RegExp")return q8(WDe,e,t);throw GDe("RegExp#exec called on incompatible receiver")},CY=Ff,iPe=qr("matchAll"),IY="RegExp String",OY=IY+" Iterator",sPe=CY.set,oPe=CY.getterFor(OY),aPe=TypeError,X2=TY("".indexOf),pS=TY("".matchAll),ZA=!!pS&&!ePe(function(){pS("a",/./)}),cPe=KDe(function(e,t,r,n){sPe(this,{type:OY,regexp:e,string:t,global:r,unicode:n,done:!1})},IY,function(){var e=oPe(this);if(e.done)return dy(void 0,!0);var t=e.regexp,r=e.string,n=nPe(t,r);return n===null?(e.done=!0,dy(void 0,!0)):e.global?(dE(n[0])===""&&(t.lastIndex=rPe(r,RY(t.lastIndex),e.unicode)),dy(n,!1)):(e.done=!0,dy(n,!1))}),J8=function(e){var t,r,n,i=YDe(this),s=dE(e),o=tPe(i,RegExp),a=dE(AY(i));return t=new o(o===RegExp?i.source:i,a),r=!!~X2(a,"g"),n=!!~X2(a,"u"),t.lastIndex=RY(i.lastIndex),new cPe(t,s,r,n)};qDe({target:"String",proto:!0,forced:ZA},{matchAll:function(e){var t,r,n,i,s=Y8(this);if(JDe(e)){if(ZA)return pS(s,e)}else{if(QDe(e)&&(t=dE(Y8(AY(e))),!~X2(t,"g")))throw aPe("`.matchAll` does not allow non-global regexes");if(ZA)return pS(s,e);if((n=ZDe(e,iPe))===void 0&&XDe(e)=="RegExp"&&(n=J8),n)return K8(n,e,s)}return r=dE(s),i=new RegExp(e,"g"),K8(J8,i,r)}});var dPe=ja("String").matchAll,lPe=ki,uPe=dPe,eC=String.prototype,hPe=function(e){var t=e.matchAll;return typeof e=="string"||e===eC||lPe(eC,e)&&t===eC.matchAll?uPe:t},fPe=Pr(hPe);function NY(e){function t(r,n,i,s){let o=r[s++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),c=s>=r.length;return o=!o&&pe.isArray(i)?i.length:o,c?(pe.hasOwnProp(i,o)?i[o]=[i[o],n]:i[o]=n,!a):(i[o]&&pe.isObject(i[o])||(i[o]=[]),t(r,n,i[o],s)&&pe.isArray(i[o])&&(i[o]=function(d){const l={},u=Object.keys(d);let h;const p=u.length;let _;for(h=0;h<p;h++)_=u[h],l[_]=d[_];return l}(i[o])),!a)}if(pe.isFormData(e)&&pe.isFunction(e.entries)){const r={};return pe.forEachEntry(e,(n,i)=>{t(function(s){return fPe(pe).call(pe,/\w+|\[(\w*)]/g,s).map(o=>o[0]==="[]"?"":o[1]||o[0])}(n),i,r,0)}),r}return null}const f3={transitional:BK,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",n=r.indexOf("application/json")>-1,i=pe.isObject(e);if(i&&pe.isHTMLForm(e)&&(e=new FormData(e)),pe.isFormData(e))return n?JSON.stringify(NY(e)):e;if(pe.isArrayBuffer(e)||pe.isBuffer(e)||pe.isStream(e)||pe.isFile(e)||pe.isBlob(e)||pe.isReadableStream(e))return e;if(pe.isArrayBufferView(e))return e.buffer;if(pe.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(o,a){return dS(o,new no.classes.URLSearchParams,Object.assign({visitor:function(c,d,l,u){return no.isNode&&pe.isBuffer(c)?(this.append(d,c.toString("base64")),!1):u.defaultVisitor.apply(this,arguments)}},a))}(e,this.formSerializer).toString();if((s=pe.isFileList(e))||r.indexOf("multipart/form-data")>-1){const o=this.env&&this.env.FormData;return dS(s?{"files[]":e}:e,o&&new o,this.formSerializer)}}return i||n?(t.setContentType("application/json",!1),function(o,a,c){if(pe.isString(o))try{return(a||JSON.parse)(o),fi(pe).call(pe,o)}catch(d){if(d.name!=="SyntaxError")throw d}return(0,JSON.stringify)(o)}(e)):e}],transformResponse:[function(e){const t=this.transitional||f3.transitional,r=t&&t.forcedJSONParsing,n=this.responseType==="json";if(pe.isResponse(e)||pe.isReadableStream(e))return e;if(e&&pe.isString(e)&&(r&&!this.responseType||n)){const i=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(s){if(i)throw s.name==="SyntaxError"?Yt.from(s,Yt.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:no.classes.FormData,Blob:no.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};pe.forEach(["delete","get","head","post","put","patch"],e=>{f3.headers[e]={}});var p3=f3;const pPe=pe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),X8=Symbol("internals");function lg(e){var t;return e&&fi(t=String(e)).call(t).toLowerCase()}function Ib(e){return e===!1||e==null?e:pe.isArray(e)?e.map(Ib):String(e)}function tC(e,t,r,n,i){return pe.isFunction(n)?n.call(this,t,r):(i&&(t=r),pe.isString(t)?pe.isString(n)?t.indexOf(n)!==-1:pe.isRegExp(n)?n.test(t):void 0:void 0)}class Ob{constructor(t){t&&this.set(t)}set(t,r,n){const i=this;function s(c,d,l){const u=lg(d);if(!u)throw new Error("header name must be a non-empty string");const h=pe.findKey(i,u);(!h||i[h]===void 0||l===!0||l===void 0&&i[h]!==!1)&&(i[h||d]=Ib(c))}const o=(c,d)=>pe.forEach(c,(l,u)=>s(l,u,d));if(pe.isPlainObject(t)||t instanceof this.constructor)o(t,r);else if(pe.isString(t)&&(t=fi(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(fi(a=t).call(a)))o((c=>{const d={};let l,u,h;return c&&c.split(`
`).forEach(function(p){var _,g;h=p.indexOf(":"),l=fi(_=p.substring(0,h)).call(_).toLowerCase(),u=fi(g=p.substring(h+1)).call(g),!l||d[l]&&pPe[l]||(l==="set-cookie"?d[l]?d[l].push(u):d[l]=[u]:d[l]=d[l]?d[l]+", "+u:u)}),d})(t),r);else if(pe.isHeaders(t))for(const[c,d]of t.entries())s(d,c,n);else t!=null&&s(r,t,n);var a;return this}get(t,r){if(t=lg(t)){const n=pe.findKey(this,t);if(n){const i=this[n];if(!r)return i;if(r===!0)return function(s){const o=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let c;for(;c=a.exec(s);)o[c[1]]=c[2];return o}(i);if(pe.isFunction(r))return r.call(this,i,n);if(pe.isRegExp(r))return r.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=lg(t)){const n=pe.findKey(this,t);return!(!n||this[n]===void 0||r&&!tC(0,this[n],n,r))}return!1}delete(t,r){const n=this;let i=!1;function s(o){if(o=lg(o)){const a=pe.findKey(n,o);!a||r&&!tC(0,n[a],a,r)||(delete n[a],i=!0)}}return pe.isArray(t)?t.forEach(s):s(t),i}clear(t){const r=Object.keys(this);let n=r.length,i=!1;for(;n--;){const s=r[n];t&&!tC(0,this[s],s,t,!0)||(delete this[s],i=!0)}return i}normalize(t){const r=this,n={};return pe.forEach(this,(i,s)=>{var o;const a=pe.findKey(n,s);if(a)return r[a]=Ib(i),void delete r[s];const c=t?function(d){return fi(d).call(d).toLowerCase().replace(/([a-z\d])(\w*)/g,(l,u,h)=>u.toUpperCase()+h)}(s):fi(o=String(s)).call(o);c!==s&&delete r[s],r[c]=Ib(i),n[c]=!0}),this}concat(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return this.constructor.concat(this,...r)}toJSON(t){const r=Object.create(null);return pe.forEach(this,(n,i)=>{n!=null&&n!==!1&&(r[i]=t&&pe.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[r,n]=t;return r+": "+n}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const r=new this(t);for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];return i.forEach(o=>r.set(o)),r}static accessor(t){const r=(this[X8]=this[X8]={accessors:{}}).accessors,n=this.prototype;function i(s){const o=lg(s);r[o]||(function(a,c){const d=pe.toCamelCase(" "+c);["get","set","has"].forEach(l=>{Object.defineProperty(a,l+d,{value:function(u,h,p){return this[l].call(this,c,u,h,p)},configurable:!0})})}(n,s),r[o]=!0)}return pe.isArray(t)?t.forEach(i):i(t),this}}Ob.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),pe.reduceDescriptors(Ob.prototype,(e,t)=>{let{value:r}=e,n=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(i){this[n]=i}}}),pe.freezeMethods(Ob);var gc=Ob;function rC(e,t){const r=this||p3,n=t||r,i=gc.from(n.headers);let s=n.data;return pe.forEach(e,function(o){s=o.call(r,s,i.normalize(),t?t.status:void 0)}),i.normalize(),s}function DY(e){return!(!e||!e.__CANCEL__)}function C0(e,t,r){Yt.call(this,e??"canceled",Yt.ERR_CANCELED,t,r),this.name="CanceledError"}function PY(e,t,r){const n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(new Yt("Request failed with status code "+r.status,[Yt.ERR_BAD_REQUEST,Yt.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}pe.inherits(C0,Yt,{__CANCEL__:!0});const mS=function(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=0;const i=function(s,o){s=s||10;const a=new Array(s),c=new Array(s);let d,l=0,u=0;return o=o!==void 0?o:1e3,function(h){const p=Date.now(),_=c[u];d||(d=p),a[l]=h,c[l]=p;let g=u,E=0;for(;g!==l;)E+=a[g++],g%=s;if(l=(l+1)%s,l===u&&(u=(u+1)%s),p-d<o)return;const b=_&&p-_;return b?Math.round(1e3*E/b):void 0}}(50,250);return function(s,o){let a,c,d=0,l=1e3/o;const u=function(h){d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),a=null,c&&(clearTimeout(c),c=null),s.apply(null,h)};return[function(){const h=Date.now(),p=h-d;for(var _=arguments.length,g=new Array(_),E=0;E<_;E++)g[E]=arguments[E];p>=l?u(g,h):(a=g,c||(c=setTimeout(()=>{c=null,u(a)},l-p)))},()=>a&&u(a)]}(s=>{const o=s.loaded,a=s.lengthComputable?s.total:void 0,c=o-n,d=i(c);n=o,e({loaded:o,total:a,progress:a?o/a:void 0,bytes:c,rate:d||void 0,estimated:d&&a&&o<=a?(a-o)/d:void 0,event:s,lengthComputable:a!=null,[t?"download":"upload"]:!0})},r)},Q8=(e,t)=>{const r=e!=null;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},Z8=e=>function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return pe.asap(()=>e(...r))};var mPe=no.hasStandardBrowserEnv?function(){const e=no.navigator&&/(msie|trident)/i.test(no.navigator.userAgent),t=document.createElement("a");let r;function n(i){let s=i;return e&&(t.setAttribute("href",s),s=t.href),t.setAttribute("href",s),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return r=n(window.location.href),function(i){const s=pe.isString(i)?n(i):i;return s.protocol===r.protocol&&s.host===r.host}}():function(){return!0},gPe=no.hasStandardBrowserEnv?{write(e,t,r,n,i,s){const o=[e+"="+encodeURIComponent(t)];pe.isNumber(r)&&o.push("expires="+new Date(r).toGMTString()),pe.isString(n)&&o.push("path="+n),pe.isString(i)&&o.push("domain="+i),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function kY(e,t){return e&&!function(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}(t)?function(r,n){return n?r.replace(/\/?\/$/,"")+"/"+n.replace(/^\/+/,""):r}(e,t):t}function eU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}const tU=e=>e instanceof gc?function(t){for(var r=1;r<arguments.length;r++){var n=arguments[r]!=null?arguments[r]:{};r%2?eU(Object(n),!0).forEach(function(i){j(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):eU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}({},e):e;function Sf(e,t){t=t||{};const r={};function n(d,l,u){return pe.isPlainObject(d)&&pe.isPlainObject(l)?pe.merge.call({caseless:u},d,l):pe.isPlainObject(l)?pe.merge({},l):pe.isArray(l)?l.slice():l}function i(d,l,u){return pe.isUndefined(l)?pe.isUndefined(d)?void 0:n(void 0,d,u):n(d,l,u)}function s(d,l){if(!pe.isUndefined(l))return n(void 0,l)}function o(d,l){return pe.isUndefined(l)?pe.isUndefined(d)?void 0:n(void 0,d):n(void 0,l)}function a(d,l,u){return u in t?n(d,l):u in e?n(void 0,d):void 0}const c={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(d,l)=>i(tU(d),tU(l),!0)};return pe.forEach(Object.keys(Object.assign({},e,t)),function(d){const l=c[d]||i,u=l(e[d],t[d],d);pe.isUndefined(u)&&l!==a||(r[d]=u)}),r}var LY=e=>{const t=Sf({},e);let r,{data:n,withXSRFToken:i,xsrfHeaderName:s,xsrfCookieName:o,headers:a,auth:c}=t;if(t.headers=a=gc.from(a),t.url=FK(kY(t.baseURL,t.url),e.params,e.paramsSerializer),c&&a.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),pe.isFormData(n)){if(no.hasStandardBrowserEnv||no.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if((r=a.getContentType())!==!1){const[d,...l]=r?r.split(";").map(u=>fi(u).call(u)).filter(Boolean):[];a.setContentType([d||"multipart/form-data",...l].join("; "))}}if(no.hasStandardBrowserEnv&&(i&&pe.isFunction(i)&&(i=i(t)),i||i!==!1&&mPe(t.url))){const d=s&&o&&gPe.read(o);d&&a.set(s,d)}return t},_Pe=typeof XMLHttpRequest<"u"&&function(e){return new _e(function(t,r){const n=LY(e);let i=n.data;const s=gc.from(n.headers).normalize();let o,a,c,d,l,{responseType:u,onUploadProgress:h,onDownloadProgress:p}=n;function _(){d&&d(),l&&l(),n.cancelToken&&n.cancelToken.unsubscribe(o),n.signal&&n.signal.removeEventListener("abort",o)}let g=new XMLHttpRequest;function E(){if(!g)return;const v=gc.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders());PY(function(I){t(I),_()},function(I){r(I),_()},{data:u&&u!=="text"&&u!=="json"?g.response:g.responseText,status:g.status,statusText:g.statusText,headers:v,config:e,request:g}),g=null}g.open(n.method.toUpperCase(),n.url,!0),g.timeout=n.timeout,"onloadend"in g?g.onloadend=E:g.onreadystatechange=function(){g&&g.readyState===4&&(g.status!==0||g.responseURL&&g.responseURL.indexOf("file:")===0)&&setTimeout(E)},g.onabort=function(){g&&(r(new Yt("Request aborted",Yt.ECONNABORTED,e,g)),g=null)},g.onerror=function(){r(new Yt("Network Error",Yt.ERR_NETWORK,e,g)),g=null},g.ontimeout=function(){let v=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const I=n.transitional||BK;n.timeoutErrorMessage&&(v=n.timeoutErrorMessage),r(new Yt(v,I.clarifyTimeoutError?Yt.ETIMEDOUT:Yt.ECONNABORTED,e,g)),g=null},i===void 0&&s.setContentType(null),"setRequestHeader"in g&&pe.forEach(s.toJSON(),function(v,I){g.setRequestHeader(I,v)}),pe.isUndefined(n.withCredentials)||(g.withCredentials=!!n.withCredentials),u&&u!=="json"&&(g.responseType=n.responseType),p&&([c,l]=mS(p,!0),g.addEventListener("progress",c)),h&&g.upload&&([a,d]=mS(h),g.upload.addEventListener("progress",a),g.upload.addEventListener("loadend",d)),(n.cancelToken||n.signal)&&(o=v=>{g&&(r(!v||v.type?new C0(null,e,g):v),g.abort(),g=null)},n.cancelToken&&n.cancelToken.subscribe(o),n.signal&&(n.signal.aborted?o():n.signal.addEventListener("abort",o)));const b=function(v){const I=/^([-+\w]{1,25})(:?\/\/|:)/.exec(v);return I&&I[1]||""}(n.url);b&&no.protocols.indexOf(b)===-1?r(new Yt("Unsupported protocol "+b+":",Yt.ERR_BAD_REQUEST,e)):g.send(i||null)})},EPe=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let n,i=new AbortController;const s=function(d){if(!n){n=!0,a();const l=d instanceof Error?d:this.reason;i.abort(l instanceof Yt?l:new C0(l instanceof Error?l.message:l))}};let o=t&&setTimeout(()=>{o=null,s(new Yt("timeout ".concat(t," of ms exceeded"),Yt.ETIMEDOUT))},t);const a=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach(d=>{d.unsubscribe?d.unsubscribe(s):d.removeEventListener("abort",s)}),e=null)};e.forEach(d=>d.addEventListener("abort",s));const{signal:c}=i;return c.unsubscribe=()=>pe.asap(a),c}},vPe=eK,yPe=Od;Jt({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=yPe.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var bPe=Od,SPe=R0;Jt({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=bPe.f(this),r=SPe(e);return(r.error?t.reject:t.resolve)(r.value),t.promise}});var Q2=Pr(vPe),xY=A0.f("asyncIterator"),wPe=Pr(xY);function m3(e,t){this.v=e,this.k=t}function Pg(e){var t,r;function n(s,o){try{var a=e[s](o),c=a.value,d=c instanceof m3;Q2.resolve(d?c.v:c).then(function(l){if(d){var u=s==="return"?"return":"next";if(!c.k||l.done)return n(u,l);l=e[u](l).value}i(a.done?"return":"normal",l)},function(l){n("throw",l)})}catch(l){i("throw",l)}}function i(s,o){switch(s){case"return":t.resolve({value:o,done:!0});break;case"throw":t.reject(o);break;default:t.resolve({value:o,done:!1})}(t=t.next)?n(t.key,t.arg):r=null}this._invoke=function(s,o){return new Q2(function(a,c){var d={key:s,arg:o,resolve:a,reject:c,next:null};r?r=r.next=d:(t=r=d,n(s,o))})},typeof e.return!="function"&&(this.return=void 0)}function ko(e){return function(){return new Pg(e.apply(this,arguments))}}function St(e){return new m3(e,0)}function gS(e){var t={},r=!1;function n(i,s){return r=!0,{done:!1,value:new m3(s=new Q2(function(o){o(e[i](s))}),1)}}return t[Hp!==void 0&&gY||"@@iterator"]=function(){return this},t.next=function(i){return r?(r=!1,i):n("next",i)},typeof e.throw=="function"&&(t.throw=function(i){if(r)throw r=!1,i;return n("throw",i)}),typeof e.return=="function"&&(t.return=function(i){return r?(r=!1,i):n("return",i)}),t}Pg.prototype[typeof Hp=="function"&&wPe||"@@asyncIterator"]=function(){return this},Pg.prototype.next=function(e){return this._invoke("next",e)},Pg.prototype.throw=function(e){return this._invoke("throw",e)},Pg.prototype.return=function(e){return this._invoke("return",e)};var g3=Pr(xY);function Z2(e){var t,r,n,i=2;for(typeof Symbol<"u"&&(r=g3,n=Symbol.iterator);i--;){if(r&&(t=e[r])!=null)return t.call(e);if(n&&(t=e[n])!=null)return new Nb(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function Nb(e){function t(r){if(Object(r)!==r)return _e.reject(new TypeError(r+" is not an object."));var n=r.done;return _e.resolve(r.value).then(function(i){return{value:i,done:n}})}return Nb=function(r){this.s=r,this.n=r.next},Nb.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var n=this.s.return;return n===void 0?_e.resolve({value:r,done:!0}):t(n.apply(this.s,arguments))},throw:function(r){var n=this.s.return;return n===void 0?_e.reject(r):t(n.apply(this.s,arguments))}},new Nb(e)}const TPe=function*(e,t){let r=e.byteLength;if(!t||r<t)return void(yield e);let n,i=0;for(;i<r;)n=i+t,yield e.slice(i,n),i=n},RPe=function(){var e=ko(function*(t,r){var n,i=!1,s=!1;try{for(var o,a=Z2(APe(t));i=!(o=yield St(a.next())).done;i=!1){const c=o.value;yield*gS(Z2(TPe(c,r)))}}catch(c){s=!0,n=c}finally{try{i&&a.return!=null&&(yield St(a.return()))}finally{if(s)throw n}}});return function(t,r){return e.apply(this,arguments)}}(),APe=function(){var e=ko(function*(t){if(t[g3])return void(yield*gS(Z2(t)));const r=t.getReader();try{for(;;){const{done:n,value:i}=yield St(r.read());if(n)break;yield i}}finally{yield St(r.cancel())}});return function(t){return e.apply(this,arguments)}}(),rU=(e,t,r,n)=>{const i=RPe(e,t);let s,o=0,a=c=>{s||(s=!0,n&&n(c))};return new ReadableStream({async pull(c){try{const{done:d,value:l}=await i.next();if(d)return a(),void c.close();let u=l.byteLength;if(r){let h=o+=u;r(h)}c.enqueue(new Uint8Array(l))}catch(d){throw a(d),d}},cancel:c=>(a(c),i.return())},{highWaterMark:2})};function nU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function iU(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?nU(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nU(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}const iT=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",MY=iT&&typeof ReadableStream=="function",CPe=iT&&(typeof TextEncoder=="function"?(sU=new TextEncoder,e=>sU.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var sU;const UY=function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return!!e(...r)}catch{return!1}},IPe=MY&&UY(()=>{let e=!1;const t=new Request(no.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),eN=MY&&UY(()=>pe.isReadableStream(new Response("").body)),_S={stream:eN&&(e=>e.body)};var oU;iT&&(oU=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!_S[e]&&(_S[e]=pe.isFunction(oU[e])?t=>t[e]():(t,r)=>{throw new Yt("Response type '".concat(e,"' is not supported"),Yt.ERR_NOT_SUPPORT,r)})}));const OPe=async(e,t)=>{const r=pe.toFiniteNumber(e.getContentLength());return r??(async n=>n==null?0:pe.isBlob(n)?n.size:pe.isSpecCompliantForm(n)?(await new Request(no.origin,{method:"POST",body:n}).arrayBuffer()).byteLength:pe.isArrayBufferView(n)||pe.isArrayBuffer(n)?n.byteLength:(pe.isURLSearchParams(n)&&(n+=""),pe.isString(n)?(await CPe(n)).byteLength:void 0))(t)};var NPe=iT&&(async e=>{let{url:t,method:r,data:n,signal:i,cancelToken:s,timeout:o,onDownloadProgress:a,onUploadProgress:c,responseType:d,headers:l,withCredentials:u="same-origin",fetchOptions:h}=LY(e);d=d?(d+"").toLowerCase():"text";let p,_=EPe([i,s&&s.toAbortSignal()],o);const g=_&&_.unsubscribe&&(()=>{_.unsubscribe()});let E;try{if(c&&IPe&&r!=="get"&&r!=="head"&&(E=await OPe(l,n))!==0){let L,U=new Request(t,{method:"POST",body:n,duplex:"half"});if(pe.isFormData(n)&&(L=U.headers.get("content-type"))&&l.setContentType(L),U.body){const[w,V]=Q8(E,mS(Z8(c)));n=rU(U.body,65536,w,V)}}pe.isString(u)||(u=u?"include":"omit");const b="credentials"in Request.prototype;p=new Request(t,iU(iU({},h),{},{signal:_,method:r.toUpperCase(),headers:l.normalize().toJSON(),body:n,duplex:"half",credentials:b?u:void 0}));let v=await fetch(p);const I=eN&&(d==="stream"||d==="response");if(eN&&(a||I&&g)){const L={};["status","statusText","headers"].forEach(z=>{L[z]=v[z]});const U=pe.toFiniteNumber(v.headers.get("content-length")),[w,V]=a&&Q8(U,mS(Z8(a),!0))||[];v=new Response(rU(v.body,65536,w,()=>{V&&V(),g&&g()}),L)}d=d||"text";let N=await _S[pe.findKey(_S,d)||"text"](v,e);return!I&&g&&g(),await new _e((L,U)=>{PY(L,U,{data:N,headers:gc.from(v.headers),status:v.status,statusText:v.statusText,config:e,request:p})})}catch(b){throw g&&g(),b&&b.name==="TypeError"&&/fetch/i.test(b.message)?Object.assign(new Yt("Network Error",Yt.ERR_NETWORK,e,p),{cause:b.cause||b}):Yt.from(b,b&&b.code,e,p)}});const tN={http:null,xhr:_Pe,fetch:NPe};pe.forEach(tN,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const aU=e=>"- ".concat(e),DPe=e=>pe.isFunction(e)||e===null||e===!1;var jY={getAdapter:e=>{e=pe.isArray(e)?e:[e];const{length:t}=e;let r,n;const i={};for(let s=0;s<t;s++){let o;if(r=e[s],n=r,!DPe(r)&&(n=tN[(o=String(r)).toLowerCase()],n===void 0))throw new Yt("Unknown adapter '".concat(o,"'"));if(n)break;i[o||"#"+s]=n}if(!n){const s=Object.entries(i).map(o=>{let[a,c]=o;return"adapter ".concat(a," ")+(c===!1?"is not supported by the environment":"is not available in the build")});throw new Yt("There is no suitable adapter to dispatch the request "+(t?s.length>1?`since :
`+s.map(aU).join(`
`):" "+aU(s[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n},adapters:tN};function nC(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new C0(null,e)}function cU(e){return nC(e),e.headers=gc.from(e.headers),e.data=rC.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),jY.getAdapter(e.adapter||p3.adapter)(e).then(function(t){return nC(e),t.data=rC.call(e,e.transformResponse,t),t.headers=gc.from(t.headers),t},function(t){return DY(t)||(nC(e),t&&t.response&&(t.response.data=rC.call(e,e.transformResponse,t.response),t.response.headers=gc.from(t.response.headers))),_e.reject(t)})}const FY="1.7.7",_3={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{_3[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});const dU={};_3.transitional=function(e,t,r){function n(i,s){return"[Axios v"+FY+"] Transitional option '"+i+"'"+s+(r?". "+r:"")}return(i,s,o)=>{if(e===!1)throw new Yt(n(s," has been removed"+(t?" in "+t:"")),Yt.ERR_DEPRECATED);return t&&!dU[s]&&(dU[s]=!0,console.warn(n(s," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(i,s,o)}};var rN={assertOptions:function(e,t,r){if(typeof e!="object")throw new Yt("options must be an object",Yt.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let i=n.length;for(;i-- >0;){const s=n[i],o=t[s];if(o){const a=e[s],c=a===void 0||o(a,s,e);if(c!==!0)throw new Yt("option "+s+" must be "+c,Yt.ERR_BAD_OPTION_VALUE)}else if(r!==!0)throw new Yt("Unknown option "+s,Yt.ERR_BAD_OPTION)}},validators:_3};const jl=rN.validators;let Db=class{constructor(e){this.defaults=e,this.interceptors={request:new J4,response:new J4}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let n;Error.captureStackTrace?Error.captureStackTrace(n={}):n=new Error;const i=n.stack?n.stack.replace(/^.+\n/,""):"";try{r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=Sf(this.defaults,t);const{transitional:r,paramsSerializer:n,headers:i}=t;r!==void 0&&rN.assertOptions(r,{silentJSONParsing:jl.transitional(jl.boolean),forcedJSONParsing:jl.transitional(jl.boolean),clarifyTimeoutError:jl.transitional(jl.boolean)},!1),n!=null&&(pe.isFunction(n)?t.paramsSerializer={serialize:n}:rN.assertOptions(n,{encode:jl.function,serialize:jl.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=i&&pe.merge(i.common,i[t.method]);i&&pe.forEach(["delete","get","head","post","put","patch","common"],p=>{delete i[p]}),t.headers=gc.concat(s,i);const o=[];let a=!0;this.interceptors.request.forEach(function(p){typeof p.runWhen=="function"&&p.runWhen(t)===!1||(a=a&&p.synchronous,o.unshift(p.fulfilled,p.rejected))});const c=[];let d;this.interceptors.response.forEach(function(p){c.push(p.fulfilled,p.rejected)});let l,u=0;if(!a){const p=[cU.bind(this),void 0];for(p.unshift.apply(p,o),p.push.apply(p,c),l=p.length,d=_e.resolve(t);u<l;)d=d.then(p[u++],p[u++]);return d}l=o.length;let h=t;for(u=0;u<l;){const p=o[u++],_=o[u++];try{h=p(h)}catch(g){_.call(this,g);break}}try{d=cU.call(this,h)}catch(p){return _e.reject(p)}for(u=0,l=c.length;u<l;)d=d.then(c[u++],c[u++]);return d}getUri(e){return FK(kY((e=Sf(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};pe.forEach(["delete","get","head","options"],function(e){Db.prototype[e]=function(t,r){return this.request(Sf(r||{},{method:e,url:t,data:(r||{}).data}))}}),pe.forEach(["post","put","patch"],function(e){function t(r){return function(n,i,s){return this.request(Sf(s||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:n,data:i}))}}Db.prototype[e]=t(),Db.prototype[e+"Form"]=t(!0)});var Pb=Db;class E3{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new _e(function(i){r=i});const n=this;this.promise.then(i=>{if(!n._listeners)return;let s=n._listeners.length;for(;s-- >0;)n._listeners[s](i);n._listeners=null}),this.promise.then=i=>{let s;const o=new _e(a=>{n.subscribe(a),s=a}).then(i);return o.cancel=function(){n.unsubscribe(s)},o},t(function(i,s,o){n.reason||(n.reason=new C0(i,s,o),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=n=>{t.abort(n)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new E3(function(r){t=r}),cancel:t}}}var PPe=E3;const nN={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(nN).forEach(e=>{let[t,r]=e;nN[r]=t});var kPe=nN;const Zn=function e(t){const r=new Pb(t),n=MK(Pb.prototype.request,r);return pe.extend(n,Pb.prototype,r,{allOwnKeys:!0}),pe.extend(n,r,null,{allOwnKeys:!0}),n.create=function(i){return e(Sf(t,i))},n}(p3);Zn.Axios=Pb,Zn.CanceledError=C0,Zn.CancelToken=PPe,Zn.isCancel=DY,Zn.VERSION=FY,Zn.toFormData=dS,Zn.AxiosError=Yt,Zn.Cancel=Zn.CanceledError,Zn.all=function(e){return _e.all(e)},Zn.spread=function(e){return function(t){return e.apply(null,t)}},Zn.isAxiosError=function(e){return pe.isObject(e)&&e.isAxiosError===!0},Zn.mergeConfig=Sf,Zn.AxiosHeaders=gc,Zn.formToJSON=e=>NY(pe.isHTMLForm(e)?new FormData(e):e),Zn.getAdapter=jY.getAdapter,Zn.HttpStatusCode=kPe,Zn.default=Zn;var Hi=Zn;const LPe=()=>{};function lE(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:LPe};return e.promise=new _e((t,r)=>{e.resolve=n=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(n),e.value=n)},e.reject=n=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,r(n))}}),e}const ly=new Map,uy=new Map,Dc=new Map;let pn=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Ft=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const BY=new vOe;let nc=BY.getResult(),iC=null;function Rt(e){if(!iC){nc=BY.getResult();const t=function(a){if(a.engine.name==="Blink"&&a.browser.name!=="WeChat")return Ft.CHROME;switch(a.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ft.CHROME;case"Safari":case"Mobile Safari":return Ft.SAFARI;case"Edge":return Ft.EDGE;case"Firefox":return Ft.FIREFOX;case"QQ":case"QQBrowser":return Ft.QQ;case"Opera":return Ft.OPERA;case"WeChat":return Ft.WECHAT;default:return a.browser.name||""}}(nc),r=lU(nc),n=function(a){return a.os.name==="Windows"?a.os.version?a.os.name+" "+a.os.version:a.os.name:a.os.name||""}(nc),i=nc.os.version,s=lU(nc,!1),o=nc.device.type;if(!(t&&r&&n&&i))return{name:t,version:r,os:n,osVersion:i,browserVersion:s,deviceType:o};iC={name:t,version:r,os:n,osVersion:i,browserVersion:s,deviceType:o}}return iC}function lU(e){let t,r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",r?t.split(".")[0]:t}function sT(){return Rt().os}function uU(){const e=Rt();return"".concat(e.os," ").concat(e.osVersion)}function ES(){const e=Rt();return!!(nc.engine.name==="WebKit"&&e.os===pn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Ft.SAFARI||Ci()&&e.name!==Ft.SAFARI)}function Iu(){return Rt().name===Ft.CHROME}function Bn(){return Rt().name===Ft.SAFARI}function VY(){return Rt().name===Ft.EDGE}function Dr(){return Rt().name===Ft.FIREFOX}function Ci(){return Rt().os===pn.IOS}function iN(e){const t=Rt();return!(t.name!==Ft.CHROME||!t.osVersion)&&Number(t.version)>=e}function $Y(e){const t=Rt();return!(t.name!==Ft.CHROME||!t.osVersion)&&Number(t.version)<e}function hU(e){const t=Rt();return!(t.name!==Ft.EDGE||!t.osVersion)&&Number(t.version)>=e}function HY(e){const t=Rt();return!(t.name!==Ft.SAFARI||!t.osVersion)&&Number(t.version)>=e}function zY(e,t,r){const n=Rt();if(n.os!==pn.IOS||!n.osVersion)return!1;const i=n.osVersion.split(".");return t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e}function WY(e,t,r){const n=Rt();if(n.name!==Ft.SAFARI||!n.osVersion||!n.browserVersion)return!1;const i=n.browserVersion.split(".");return t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e}function fU(e){const t=Rt();return!(t.name!==Ft.OPERA||!t.osVersion)&&Number(t.version)>=e}function pU(){const e=Rt();if(e.os!==pn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function jm(){const e=Rt();if(e.os!==pn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function sN(){const e=Rt();if(e.os!==pn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function mU(){const e=Rt();if(e.os!==pn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Da(){return Bn()&&navigator.maxTouchPoints>0}function GY(){return Rt().name===Ft.WECHAT}function qY(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function v3(){const e=sT();return function(){const{deviceType:t}=Rt();return t==="mobile"||t==="tablet"}()||e===pn.ANDROID||e===pn.IOS||e===pn.HARMONY_OS}function Hu(){const e=Rt();return e.name!==Ft.EDGE&&e.name!==Ft.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function oT(){return sT()===pn.ANDROID}function uE(){const e=Rt();return oT()&&(e.name===Ft.CHROME||e.name===Ft.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function pr(e,t,r){return(t=function(n){var i=function(s,o){if(typeof s!="object"||!s)return s;var a=s[Symbol.toPrimitive];if(a!==void 0){var c=a.call(s,"string");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(n);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Ae(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?gU(Object(r),!0).forEach(function(n){pr(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gU(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}let $=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),ie=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(t),pr(this,"code",void 0),pr(this,"message",void 0),pr(this,"data",void 0),pr(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=r}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function dl(e,t){if(typeof e!="boolean")throw new ie($.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function rn(e,t,r){if(!Ee(r).call(r,e))throw new ie($.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(r)))}function qt(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<r||e>n||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(i){return typeof i=="number"&&i%1==0}(e))throw new ie($.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(r,", ").concat(n,"]. integer only"))}function sC(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new ie($.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&qt(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&qt(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&qt(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&qt(e.ideal,"".concat(t,".ideal"),1,1/0)}else qt(e,t,1,1/0)}function wn(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new ie($.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!KY(e,r,n,i))throw new ie($.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(r,",").concat(n,"].").concat(i?" ASCII characters only.":""))}function nl(e,t){if(!Array.isArray(e))throw new ie($.INVALID_PARAMS,"".concat(t," should be an array"))}function Tr(e){return e==null}function KY(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,n=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=r&&e.length>=t&&(!n||function(i){if(typeof i!="string")return!1;for(let s=0;s<i.length;s+=1){const o=i.charCodeAt(s);if(o<0||o>255)return!1}return!0}(e))}var kg=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(kg||{}),oN=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(oN||{});const YY=new class{constructor(){pr(this,"_clientSize",null),pr(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),pr(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),pr(this,"getStyle",e=>window.getComputedStyle(e,null)),pr(this,"checkCssVisibleProperty",e=>{var t;let r=!0;const n=this.getStyle(e),{display:i,visibility:s,opacity:o,filter:a}=n;return(i==="none"||Ee(t=["hidden","collapse"]).call(t,s)||Number(o)<.1)&&(r=!1),!!r&&(a&&a.split(" ").filter(c=>{var d;const l=c.split("(")[0];return Ee(d=["brightness","blur","opacity"]).call(d,l)}).map(c=>{const[d,l]=c.split(/\(|\)/);return[d,Number(l.match(/^[0-9\.]+/))]}).forEach(c=>{const[d,l]=c;switch(d){case"brightness":(l<.1||l>3)&&(r=!1);break;case"blur":l>3&&(r=!1);break;case"opacity":l<.1&&(r=!1)}}),r)}),pr(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let r=!0,n=!0;const i=o=>t(o);let s=e;for(;s&&n;)i(s)||(r=!1,n=!1),s=s.parentElement,s||(n=!1);return r}),pr(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),pr(this,"getSizeAboutClient",e=>{const{width:t,height:r,left:n,right:i,top:s,bottom:o}=e.getBoundingClientRect(),a=this.getClientWidth(),c=this.getClientHeight();return{width:t,height:r,left:n,right:i,top:s,bottom:o,clientWidth:a,clientHeight:c,clientMin:Math.min(a,c)}}),pr(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(e,t,r)}),pr(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),pr(this,"checkCoverForAPoint",(e,t,r)=>{const n=this.elementFromPoint(e,t);return n!==null&&n!==r}),pr(this,"getPointPositionList",()=>{const{width:e,height:t,left:r,top:n}=this._clientSize,i=e/6,s=t/6,o=[],a=10**6;for(let c=0;c<5;c++)for(let d=0;d<5;d++){const l=(r*a+(c===0?.1:c===4?(i*c*a-1e5)/a:i*c)*a)/a,u=(n*a+(d===0?.1:d===4?(s*d*a-1e5)/a:s*d)*a)/a;o.push({x:l,y:u})}return[...o]}),pr(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),pr(this,"checkSizeIsVisible",(e,t,r)=>(e>50||r/e<=10)&&(t>50||r/t<=10)),pr(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:r,bottom:n,clientHeight:i,clientWidth:s,clientMin:o}=this._clientSize;let a,c,d,l;if(e<0)a=0;else{if(!(e<s))return!1;a=e}if(t<0)return!1;if(c=t<s?t:s,r<0)d=0;else{if(!(r<i))return!1;d=r}if(n<0)return!1;l=n<i?n:i;const u=c-a,h=l-d;return this.checkSizeIsVisible(u,h,o)}),pr(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),pr(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(kg.COVERED);{const t=this.checkActualSize(),r=this.checkSizeOfPartInClient();return t&&!r?this.returnHiddenResult(kg.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(kg.SIZE)}}return this.returnHiddenResult(kg.STYLE)}return this.returnHiddenResult(oN.UNMOUNTED)}return this.returnHiddenResult(oN.INVALID_HTML_ELEMENT)}),pr(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function y3(e){return new TextEncoder().encode(e)}const _U=function(e,t){const r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r},aN=async e=>function(t,r){let n="";return new Uint8Array(t).forEach(i=>{n+=i.toString(r).padStart(2,"0")}),n}(await crypto.subtle.digest("SHA-256",y3(e)),16);class Cr{constructor(){pr(this,"_events",{}),pr(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(r=>r.listener):[]}on(t,r){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,r)===-1&&n.push({listener:r,once:!1})}once(t,r){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,r)===-1&&n.push({listener:r,once:!0})}off(t,r){if(!this._events[t])return;const n=this._events[t],i=this._indexOfListener(n,r);i!==-1&&n.splice(i,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const r=this._events[t].map(o=>o);for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];for(let o=0;o<r.length;o+=1){const a=r[o];a.once&&this.off(t,a.listener),a.listener.apply(this,i||[])}}safeEmit(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];[...this._events[t]||[]].forEach(s=>{s.once&&this.off(t,s.listener);try{s.listener.apply(this,n)}catch(o){console.error("safeEmit event:".concat(t," error ").concat(o==null?void 0:o.toString()))}})}_indexOfListener(t,r){let n=t.length;for(;n--;)if(t[n].listener===r)return n;return-1}}let ug=null;function JY(){if(ug)return ug;if(window.electron)return ug=window.electron;if(!window.require)return null;try{return ug=window.require("electron"),ug}catch{return null}}let Zr=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e}({}),Or=function(e){return e.TRACER="tracer",e}({});function EU(e){return qt(e.timeout,"config.timeout",0,1e5),qt(e.timeoutFactor,"config.timeoutFactor",0,100,!1),qt(e.maxRetryCount,"config.maxRetryConfig",0,1/0),qt(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let xPe=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Vt=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function aT(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function XY(e){return wn(e.turnServerURL,"turnServerURL"),wn(e.username,"username"),wn(e.password,"password"),e.udpport&&qt(e.udpport,"udpport",1,99999,!0),e.forceturn&&dl(e.forceturn,"forceturn"),e.security&&dl(e.security,"security"),e.tcpport&&qt(e.tcpport,"tcpport",1,99999,!0),!0}function vU(e){return e.level!==void 0&&rn(e.level,"level",[1,2,3]),e.delay!==void 0&&qt(e.delay,"delay",0,3e3,!0),!0}let mt=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),Un=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),bs=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Wp=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Vn(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return e.getListeners(t).length===0?_e.reject(new ie($.UNEXPECTED_ERROR,"can not emit promise")):new _e((s,o)=>{e.emit(t,...n,s,o)})}function er(e,t){if(e.getListeners(t).length===0)return _e.resolve();for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return Vn(e,t,...n)}function Lo(e,t){if(e.getListeners(t).length===0)return null;for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return hE(e,t,...n)}function hE(e,t){let r=null,n=null;for(var i=arguments.length,s=new Array(i>2?i-2:0),o=2;o<i;o++)s[o-2]=arguments[o];if(e.emit(t,...s,a=>{r=a},a=>{n=a}),n!==null)throw n;if(r===null)throw new ie($.UNEXPECTED_ERROR,"handler is not sync");return r}const Wr=new class extends Cr{set networkState(e){this.emit(Wp.NETWORK_STATE_CHANGE,e,this._networkState),e===bs.ONLINE?this.emit(Wp.ONLINE):e===bs.OFFLINE&&(this.onlineWaiter=new _e(t=>{this.once(Wp.ONLINE,()=>{this.onlineWaiter=void 0,t(bs.ONLINE)})}),this.emit(Wp.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===bs.ONLINE}constructor(){super(),pr(this,"_moduleName","network-indicator"),pr(this,"_networkState",bs.ONLINE),pr(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=bs.ONLINE}),window.addEventListener("offline",()=>{this.networkState=bs.OFFLINE})}};function vS(e,t){const r=e.indexOf(t);r!==-1&&e.splice(r,1)}function Gp(e){const t=[];return e.forEach(r=>{t.indexOf(r)===-1&&t.push(r)}),t}function cT(e){_e!==void 0?_e.resolve().then(e):setTimeout(e,0)}function Hr(e){return JSON.parse(JSON.stringify(e))}function Hh(e){try{return Hr(e)}catch{return e}}const yU={};function zu(e,t){yU[t]||(yU[t]=!0,e())}function zh(e){const t=window.atob(e),r=new Uint8Array(new ArrayBuffer(t.length));for(let n=0;n<t.length;n+=1)r[n]=t.charCodeAt(n);return r}function Ou(e){let t="";for(let r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return window.btoa(t)}function QY(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,r=new TextEncoder().encode(e);if(r.length>t)r=r.slice(0,t);else if(r.length<t){const n=new Uint8Array(t);n.set(r),r=n}return r}function bU(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=yc(t).call(t,(o,a)=>o+a.length,0),i=new Uint8Array(new ArrayBuffer(n));let s=0;return t.forEach(o=>{i.set(o,s),s+=o.length}),i}function ed(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function ZY(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(r=>{t+=typeof r=="string"?ed(r):r.size}),t+138}function MPe(e){const t=new ie($.TIMEOUT,"timeout");return new _e((r,n)=>{window.setTimeout(()=>n(t),e)})}function In(e){return new _e(t=>{window.setTimeout(t,e)})}function ar(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const r=Math.random().toString(16).substr(2,e).toLowerCase();return r.length===e?"".concat(t).concat(r):"".concat(t).concat(r)+ar(e-r.length,"")}function qp(){return ar(32,"").toUpperCase()}const dT=()=>{},SU=new class{constructor(){pr(this,"fnMap",new Map)}throttleByKey(e,t,r,n){for(var i=arguments.length,s=new Array(i>4?i-4:0),o=4;o<i;o++)s[o-4]=arguments[o];if(this.fnMap.has(t)){const a=this.fnMap.get(t);if(a.threshold!==r){a.fn(...a.args),clearTimeout(a.timer);const c=window.setTimeout(()=>{const d=this.fnMap.get(t);d&&d.fn(...d.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:c,args:s,skipFn:n})}else a.skipFn&&a.skipFn(...a.args),this.fnMap.set(t,Ae(Ae({},a),{},{fn:e,args:s,skipFn:n}))}else{const a=window.setTimeout(()=>{const c=this.fnMap.get(t);c&&c.fn(...c.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:a,args:s,skipFn:n})}}},wU=SU.throttleByKey.bind(SU);function TU(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function cN(e,t){if(!TU(e)||!TU(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const r=[...e];for(let n=0;n<t.length;n++)r[n]=cN(e[n],t[n]);return r}{const r=Ae({},e);for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(Object.prototype.hasOwnProperty.call(e,n)?r[n]=cN(e[n],t[n]):r[n]=t[n]);return r}}function RU(e,t){let r=[0];if(r=new Array(t).fill(0),e===0)return r;let n=0;for(;e>0&&(r[n]=255&e,e>>=8,n++,n!==t););return r}function oC(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function eJ(e){const t="0123456789abcdef";function r(I){let N,L="";for(N=0;N<=3;N++)L+=t.charAt(I>>8*N+4&15)+t.charAt(I>>8*N&15);return L}function n(I,N){const L=(65535&I)+(65535&N);return(I>>16)+(N>>16)+(L>>16)<<16|65535&L}function i(I,N,L,U,w,V){return n(function(z,K){return z<<K|z>>>32-K}(n(n(N,I),n(U,V)),w),L)}function s(I,N,L,U,w,V,z){return i(N&L|~N&U,I,N,w,V,z)}function o(I,N,L,U,w,V,z){return i(N&U|L&~U,I,N,w,V,z)}function a(I,N,L,U,w,V,z){return i(N^L^U,I,N,w,V,z)}function c(I,N,L,U,w,V,z){return i(L^(N|~U),I,N,w,V,z)}const d=function(I){let N;const L=1+(I.length+8>>6),U=new Array(16*L);for(N=0;N<16*L;N++)U[N]=0;for(N=0;N<I.length;N++)U[N>>2]|=I.charCodeAt(N)<<N%4*8;return U[N>>2]|=128<<N%4*8,U[16*L-2]=8*I.length,U}(e);let l,u,h,p,_,g=1732584193,E=-271733879,b=-1732584194,v=271733878;for(l=0;l<d.length;l+=16)u=g,h=E,p=b,_=v,g=s(g,E,b,v,d[l+0],7,-680876936),v=s(v,g,E,b,d[l+1],12,-389564586),b=s(b,v,g,E,d[l+2],17,606105819),E=s(E,b,v,g,d[l+3],22,-1044525330),g=s(g,E,b,v,d[l+4],7,-176418897),v=s(v,g,E,b,d[l+5],12,1200080426),b=s(b,v,g,E,d[l+6],17,-1473231341),E=s(E,b,v,g,d[l+7],22,-45705983),g=s(g,E,b,v,d[l+8],7,1770035416),v=s(v,g,E,b,d[l+9],12,-1958414417),b=s(b,v,g,E,d[l+10],17,-42063),E=s(E,b,v,g,d[l+11],22,-1990404162),g=s(g,E,b,v,d[l+12],7,1804603682),v=s(v,g,E,b,d[l+13],12,-40341101),b=s(b,v,g,E,d[l+14],17,-1502002290),E=s(E,b,v,g,d[l+15],22,1236535329),g=o(g,E,b,v,d[l+1],5,-165796510),v=o(v,g,E,b,d[l+6],9,-1069501632),b=o(b,v,g,E,d[l+11],14,643717713),E=o(E,b,v,g,d[l+0],20,-373897302),g=o(g,E,b,v,d[l+5],5,-701558691),v=o(v,g,E,b,d[l+10],9,38016083),b=o(b,v,g,E,d[l+15],14,-660478335),E=o(E,b,v,g,d[l+4],20,-405537848),g=o(g,E,b,v,d[l+9],5,568446438),v=o(v,g,E,b,d[l+14],9,-1019803690),b=o(b,v,g,E,d[l+3],14,-187363961),E=o(E,b,v,g,d[l+8],20,1163531501),g=o(g,E,b,v,d[l+13],5,-1444681467),v=o(v,g,E,b,d[l+2],9,-51403784),b=o(b,v,g,E,d[l+7],14,1735328473),E=o(E,b,v,g,d[l+12],20,-1926607734),g=a(g,E,b,v,d[l+5],4,-378558),v=a(v,g,E,b,d[l+8],11,-2022574463),b=a(b,v,g,E,d[l+11],16,1839030562),E=a(E,b,v,g,d[l+14],23,-35309556),g=a(g,E,b,v,d[l+1],4,-1530992060),v=a(v,g,E,b,d[l+4],11,1272893353),b=a(b,v,g,E,d[l+7],16,-155497632),E=a(E,b,v,g,d[l+10],23,-1094730640),g=a(g,E,b,v,d[l+13],4,681279174),v=a(v,g,E,b,d[l+0],11,-358537222),b=a(b,v,g,E,d[l+3],16,-722521979),E=a(E,b,v,g,d[l+6],23,76029189),g=a(g,E,b,v,d[l+9],4,-640364487),v=a(v,g,E,b,d[l+12],11,-421815835),b=a(b,v,g,E,d[l+15],16,530742520),E=a(E,b,v,g,d[l+2],23,-995338651),g=c(g,E,b,v,d[l+0],6,-198630844),v=c(v,g,E,b,d[l+7],10,1126891415),b=c(b,v,g,E,d[l+14],15,-1416354905),E=c(E,b,v,g,d[l+5],21,-57434055),g=c(g,E,b,v,d[l+12],6,1700485571),v=c(v,g,E,b,d[l+3],10,-1894986606),b=c(b,v,g,E,d[l+10],15,-1051523),E=c(E,b,v,g,d[l+1],21,-2054922799),g=c(g,E,b,v,d[l+8],6,1873313359),v=c(v,g,E,b,d[l+15],10,-30611744),b=c(b,v,g,E,d[l+6],15,-1560198380),E=c(E,b,v,g,d[l+13],21,1309151649),g=c(g,E,b,v,d[l+4],6,-145523070),v=c(v,g,E,b,d[l+11],10,-1120210379),b=c(b,v,g,E,d[l+2],15,718787259),E=c(E,b,v,g,d[l+9],21,-343485551),g=n(g,u),E=n(E,h),b=n(b,p),v=n(v,_);return r(g)+r(E)+r(b)+r(v)}let UPe=1,hy=console,Jn=class{static setLogger(e){hy=e}constructor(e){pr(this,"lockingPromise",_e.resolve()),pr(this,"locks",0),pr(this,"name",""),pr(this,"lockId",void 0),this.lockId=UPe++,e&&(this.name=e),hy.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,hy.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:""));const r=new _e(i=>{t=()=>{this.locks-=1,hy.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:"")),i()}}),n=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>r),n}};function Fm(e,t){return function(r,n,i){const s=i.value;if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const o=this[t];if(!o)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const a=await o.lock("From ".concat(e,".").concat(n));try{for(var c=arguments.length,d=new Array(c),l=0;l<c;l++)d[l]=arguments[l];return await s.apply(this,d)}finally{a()}},i}}const Kr={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function b3(e,t){const r=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,r)}function Tc(e,t,r,n){const i=Object.assign({},Kr,n);let s=i.timeout;const o=async()=>{await function(d){return new _e(l=>{window.setTimeout(l,d)})}(s),s*=i.timeoutFactor,s=Math.min(i.maxRetryTimeout,s)};let a=!1;const c=new _e(async(d,l)=>{t=t||(()=>!1),r=r||(()=>!0);for(let u=0;u<i.maxRetryCount;u+=1){if(a)return l(new ie($.OPERATION_ABORTED));try{const h=await e();if(!t(h,u)||u+1===i.maxRetryCount)return d(h);await o()}catch(h){if(!r(h,u)||u+1===i.maxRetryCount)return l(h);await o()}}});return c.cancel=()=>a=!0,c}class tJ{constructor(t){pr(this,"input",[]),pr(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:yc(t=this.input).call(t,(r,n)=>r+n)/this.input.length}}let fy,py=0,aC=0;function dN(e,t,r,n){return new _e((i,s)=>{t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),py+=ed(t.data)):r&&(t.data.size?py+=t.data.size:t.data instanceof FormData?py+=ZY(t.data):py+=ed(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Hi.request(t).then(o=>{typeof o.data=="string"?aC+=ed(o.data):o.data instanceof ArrayBuffer||o.data instanceof Uint8Array?aC+=o.data.byteLength:aC+=ed(JSON.stringify(o.data)),i(o.data)}).catch(o=>{Hi.isCancel(o)?s(new ie($.OPERATION_ABORTED,"cancel token canceled")):o.code==="ECONNABORTED"?s(new ie($.NETWORK_TIMEOUT,o.message)):o.response?s(new ie($.NETWORK_RESPONSE_ERROR,o.response.status)):s(new ie($.NETWORK_ERROR,o.message))})})}async function jPe(e,t){const r=new Blob([t.data],{type:"buffer"});return await dN(e,Ae(Ae({},t),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}const AU=()=>window.isSecureContext!==void 0,xo=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const r=t[1],n=t[2];return"".concat(r,".").concat(n)}return"4.0.0.999"}("4.22.1"),S3=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let wh=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const Ln=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),r=["t","s","t"];r.splice(1,0,"e");const n=r.join(""),i=[];for(let a=0;a<6;a++)i.push("1");const s=i.join(""),o={};return o[e]=n,o[t]=s,Object.assign(o,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Ln;const w3={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},T3="v4.22.1-0-g1c8e27e9(9/19/2024, 2:23:30 PM)",Fr=Ae(Ae({PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:w3,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0,DISABLE_SCREEN_SHARE_REMB:!1},{ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_DATASTREAM_2:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,ENABLE_PREALLOC_PC:!1,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_PRE_SUB:!1,ENABLE_AUT_FEEDBACK:!1}),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0});function Gt(e,t,r){var n,i,s;Ee(n=Object.keys(Fr)).call(n,e)&&(!r&&Ee(i=Object.keys(pu)).call(i,e)||(Fr[e]=t,e==="ENABLE_VIDEO_SEI"&&t===!0&&(Fr.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(s=!!t,Fr.USE_NEW_NETWORK_CONFIG=s,s&&(Fr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Fr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Fr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Fr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Fr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Fr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Fr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(Fr.ENABLE_INSTANT_VIDEO=!0,Fr.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(Fr.ENABLE_AUT_CC=!0)))}function W(e){return Fr[e]}S3||(Fr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Fr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Fr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Fr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Fr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Fr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Fr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Fr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Fr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Fr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Fr.AREAS=["NORTH_AMERICA","OVERSEA"]);const pu={};var ht=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(ht||{});class FPe{constructor(t,r,n,i){pr(this,"state",void 0),this.state={codec:t,audioCodec:r,mode:n,clientId:i,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:wh.Default}}dispatch(t){this.state=function(r,n){switch(n.type){case ht.SET_SESSION_ID:return Ae(Ae({},r),{},{sessionId:n.sessionId});case ht.SET_P2P_ID:return Ae(Ae({},r),{},{p2pId:n.p2pId});case ht.SET_UID:return Ae(Ae({},r),{},{uid:n.uid});case ht.SET_INT_UID:return Ae(Ae({},r),{},{intUid:n.intUid});case ht.SET_PUB_ID:return Ae(Ae({},r),{},{pubId:n.pubId});case ht.KEY_METRIC_CLIENT_CREATED:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{clientCreated:n.metric})});case ht.KEY_METRIC_JOIN_START:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{joinStart:n.metric})});case ht.AVOID_JOIN_START:return Ae(Ae({},r),{},{avoidJoinStart:n.avoidJoinStart});case ht.KEY_METRIC_JOIN_END:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{joinEnd:n.metric})});case ht.KEY_METRIC_REQUEST_AP_START:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{requestAPStart:n.metric})});case ht.KEY_METRIC_REQUEST_AP_END:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{requestAPEnd:n.metric})});case ht.KEY_METRIC_JOIN_GATEWAY_START:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{joinGatewayStart:n.metric})});case ht.KEY_METRIC_JOIN_GATEWAY_END:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{joinGatewayEnd:n.metric})});case ht.KEY_METRIC_PEER_CONNECTION_START:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{peerConnectionStart:n.metric})});case ht.KEY_METRIC_PEER_CONNECTION_END:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{peerConnectionEnd:n.metric})});case ht.KEY_METRIC_DESCRIPTION_START:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{descriptionStart:n.metric})});case ht.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{signalChannelOpen:n.metric})});case ht.KEY_METRIC_ICE_CONNECTION_END:return Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{iceConnectionEnd:n.metric})});case ht.KEY_METRIC_PUBLISH:{const i=r.keyMetrics.publish,s=i.findIndex(o=>o.trackId===n.metric.trackId);return s!==-1?(i[s]=Ae(Ae({},i[s]),n.metric),Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{publish:[...i]})})):Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{publish:[...r.keyMetrics.publish,n.metric]})})}case ht.KEY_METRIC_SUBSCRIBE:{const i=r.keyMetrics.subscribe,s=i.findIndex(o=>o.userId===n.metric.userId&&o.type===n.metric.type);return s!==-1?(i[s]=Ae(Ae({},i[s]),n.metric),Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{subscribe:[...i]})})):Ae(Ae({},r),{},{keyMetrics:Ae(Ae({},r.keyMetrics),{},{subscribe:[...r.keyMetrics.subscribe,n.metric]})})}case ht.SET_CLOUD_PROXY_SERVER_MODE:return r.cloudProxyServerMode=n.mode,r;case ht.RECORD_JOIN_CHANNEL_SERVICE:return typeof n.index!="number"?r.joinChannelServiceRecords=[...r.joinChannelServiceRecords,n.record]:(r.joinChannelServiceRecords[n.index]=Ae(Ae({},r.joinChannelServiceRecords[n.index]),n.record),r.joinChannelServiceRecords=[...r.joinChannelServiceRecords]),r;case ht.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return r.joinChannelServiceRecords=[],r;case ht.RESET_KEY_METRICS:return r.keyMetrics={publish:[],subscribe:[]},r;case ht.SET_USE_P2P:return Ae(Ae({},r),{},{useP2P:n.val});case ht.SET_TRANSPORT_TYPE:return Ae(Ae({},r),{},{p2pTransport:n.val});default:return r}}(this.state,t)}set sessionId(t){this.dispatch({type:ht.SET_SESSION_ID,sessionId:t})}get sessionId(){return this.state.sessionId}set codec(t){this.state.codec=t}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(t){this.dispatch({type:ht.SET_P2P_ID,p2pId:t})}get p2pId(){return this.state.p2pId}set dcId(t){this.dispatch({type:ht.SET_DC_ID,dcId:t})}get dcId(){return this.state.dcId}set uid(t){this.dispatch({type:ht.SET_UID,uid:t})}get uid(){return this.state.uid}set intUid(t){this.dispatch({type:ht.SET_INT_UID,intUid:t})}get intUid(){return this.state.intUid}set pubId(t){this.dispatch({type:ht.SET_PUB_ID,pubId:t})}get pubId(){return this.state.pubId}set cloudProxyServerMode(t){this.dispatch({type:ht.SET_CLOUD_PROXY_SERVER_MODE,mode:t})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(t){this.dispatch({type:ht.SET_USE_P2P,val:t})}get useP2P(){return this.state.useP2P}set p2pTransport(t){this.dispatch({type:ht.SET_TRANSPORT_TYPE,val:t})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:ht.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ht.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:ht.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ht.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ht.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ht.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ht.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ht.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ht.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:ht.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ht.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ht.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(t,r,n,i){this.dispatch({type:ht.KEY_METRIC_PUBLISH,metric:Ae(Ae({trackId:t,type:r},n&&{publishStart:n}),i&&{publishEnd:i})})}subscribe(t,r,n,i,s,o,a){this.dispatch({type:ht.KEY_METRIC_SUBSCRIBE,metric:Ae(Ae(Ae(Ae(Ae({userId:t,type:r},n&&{subscribeStart:n}),i&&{subscribeEnd:i}),s&&{firstFrame:s}),o&&{streamAdded:o}),a&&{firstDecoded:a})})}massSubscribe(t,r,n,i){t.forEach(s=>{this.dispatch({type:ht.KEY_METRIC_SUBSCRIBE,metric:Ae(Ae(Ae({userId:s.userId,type:s.type},r&&{subscribeStart:r}),n&&{subscribeEnd:n}),i&&{firstFrame:i})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(t,r){t.service==="gateway"&&Array.isArray(t.urls)&&(t.urls=t.urls.map(n=>n.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof r!="number"?(this.dispatch({type:ht.RECORD_JOIN_CHANNEL_SERVICE,record:Ae(Ae({},t),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(r<0||r>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ht.RECORD_JOIN_CHANNEL_SERVICE,record:t,index:r}),r)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ht.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ht.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(t){this.dispatch({type:ht.AVOID_JOIN_START,avoidJoinStart:t})}}let lT=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const CU=128,BPe=96,IU=1e3,np=10;let VPe=0;function Lr(e,t,r){return(t=function(n){var i=function(s,o){if(typeof s!="object"||!s)return s;var a=s[Symbol.toPrimitive];if(a!==void 0){var c=a.call(s,"string");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(n);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function OU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function at(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?OU(Object(r),!0).forEach(function(n){Lr(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):OU(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}const rJ=new class extends Cr{constructor(){super(...arguments),Lr(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class $Pe{constructor(t){Lr(this,"logger",void 0),Lr(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];this.logger.debug(...this.prefixLists,...r)}info(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];this.logger.info(...this.prefixLists,...r)}warning(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];this.logger.warning(...this.prefixLists,...r)}error(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];this.logger.error(...this.prefixLists,...r)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function cC(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function NU(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const To={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},my=Date.now(),hg=e=>{for(const t in To)if(Object.prototype.hasOwnProperty.call(To,t)&&To[t]===e)return t;return"DEFAULT"},C=new class{constructor(){Lr(this,"proxyServerURL",void 0),Lr(this,"logLevel",To.DEBUG),Lr(this,"uploadState","collecting"),Lr(this,"uploadLogWaitingList",[]),Lr(this,"uploadLogUploadingList",[]),Lr(this,"uploadErrorCount",0),Lr(this,"currentLogID",0),Lr(this,"url",void 0),Lr(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=[To.DEBUG].concat(t);this.log.apply(this,n)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=[To.INFO].concat(t);this.log.apply(this,n)}warning(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=[To.WARNING].concat(t);this.log.apply(this,n)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=[To.ERROR].concat(t);this.log.apply(this,n)}upload(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=[To.DEBUG].concat(t);this.uploadLog.apply(this,n)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Gt("UPLOAD_LOG",!0)}disableLogUpload(){Gt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new $Pe(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-my<100)return void setTimeout(()=>{this.log(...t)},Date.now()-my);const n=Math.max(0,Math.min(4,t[0]));if(t[0]=cC()+" Agora-SDK [".concat(hg(n),"]:"),this.appendLogToWaitingList(n,...t),n<this.logLevel)return;const i=cC()+" %cAgora-SDK [".concat(hg(n),"]:");let s=[];if(!W("USE_NEW_LOG"))switch(n){case To.DEBUG:s=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,s);break;case To.INFO:s=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,s);break;case To.WARNING:s=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,s);break;case To.ERROR:s=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,s)}}uploadLog(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-my<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-my);const n=Math.max(0,Math.min(4,t[0]));t[0]=cC()+" Agora-SDK [".concat(hg(n),"]:"),this.appendLogToWaitingList(n,...t)}appendLogToWaitingList(e){if(!W("UPLOAD_LOG"))return;for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];Array.isArray(r[0])?r[0][0]=NU()+" Agora-SDK [".concat(hg(e),"]:"):r[0]=NU()+" Agora-SDK [".concat(hg(e),"]:");let i="";r.forEach(s=>{typeof s=="object"&&(s=JSON.stringify(s)),i+="".concat(s," ")}),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:xo,process_id:W("PROCESS_ID"),payload:JSON.stringify(e)};return Tc(async()=>{const r=await Hi.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(W("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(W("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(r.data!=="OK"){const n=new Error("unexpected upload log response");throw n.response=r,n}},()=>(this.uploadLogUploadingList=[],!1),r=>{const n={status:-1,message:r.message,errorRange:e.map(i=>i.log_item_id)};return r.response?(n.status=r.response.status,n.data=r.response.data,n.headers=r.response.headers):r.request&&(n.status=r.request.status),rJ.reportLogUploadError(n),!0},{timeout:W("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:W("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,W("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),W("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),W("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),W("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var DU;function HPe(e){return wn(e.reportId,"params.reportId",0,100,!1),wn(e.category,"params.category",0,100,!1),wn(e.event,"params.event",0,100,!1),wn(e.label,"params.label",0,100,!1),qt(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(DU={}).FREE="free",DU.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const zPe={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let bn=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e}({}),Rr=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let WPe=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function je(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,r,n){const i=n.value;if(typeof i=="function"){const s=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);n.value=function(){for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];let d=a;if(e.argsMap)try{d=e.argsMap(this,...a)}catch(u){C.warning(u),d=[]}try{JSON.stringify(d)}catch{C.warning("arguments for method ".concat(s,".").concat(String(r)," not serializable for apiInvoke.")),d=[]}const l=(e.report||Ce).reportApiInvoke(this._sessionId||null,{name:"".concat(s,".").concat(String(r)),options:d,tag:Or.TRACER,reportResult:e.reportResult},e.throttleTime);try{const u=i.apply(this,a);return u instanceof _e?u.then(h=>(l.onSuccess(e.reportResult&&h),h)).catch(h=>{throw l.onError(h),h}):(l.onSuccess(e.reportResult&&u),u)}catch(u){throw l.onError(u),u}}}return n}}const Ce=new class{constructor(){Lr(this,"baseInfoMap",new Map),Lr(this,"proxyServer",void 0),Lr(this,"eventUploadTimer",void 0),Lr(this,"setSessionIdTimer",void 0),Lr(this,"url",void 0),Lr(this,"sids",new Set),Lr(this,"backupUrl",void 0),Lr(this,"_appId",void 0),Lr(this,"keyEventUploadPendingItems",[]),Lr(this,"normalEventUploadPendingItems",[]),Lr(this,"apiInvokeUploadPendingItems",[]),Lr(this,"apiInvokeCount",0),Lr(this,"ltsList",[]),Lr(this,"lastSendNormalEventTime",Date.now()),Lr(this,"customReportCounterTimer",void 0),Lr(this,"customReportCount",0),Lr(this,"extApiInvoke",async e=>{for(const t of e){const r=at(at({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Or.TRACER});this.sendApiInvoke(r)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),W("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),W("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}adjustSessionStartTime(e){if(!this.baseInfoMap.has(e)&&!this.baseInfoMap.get(e))return void C.error("adjust session ".concat(e," start time, sid is not exist or info is undefined"));const t=this.baseInfoMap.get(e),r=Date.now(),n=t.startTime;t.startTime=r,C.debug("rewrite session ".concat(e," startTime: ").concat(r," , ").concat(r-n,"ms")),this.baseInfoMap.set(e,t)}setAppId(e){this._appId=e}reportApiInvoke(e,t,r){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const n=Date.now();this.apiInvokeCount+=1;const i=this.apiInvokeCount,s=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:n,options:t.options,states:t.states||null}),o=!!W("SHOW_REPORT_INVOKER_LOG");o&&C.info("".concat(t.name," start"),t.options);let a=!1;In(t.timeout).then(()=>{a||(this.sendApiInvoke(at(at({},s()),{},{error:$.API_INVOKE_TIMEOUT,success:!1})),C.debug("".concat(t.name," timeout")))});const c=new ie($.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:d=>{const l=()=>{if(a)throw c;return a=!0,this.sendApiInvoke(at(at({},s()),{},{success:!0},t.reportResult&&{result:d})),o&&C.info("".concat(t.name," onSuccess")),d};return r?wU(l,t.name+"Success",r,()=>a=!0):l()},onError:d=>{const l=()=>{if(a)throw d;a=!0,this.sendApiInvoke(at(at({},s()),{},{success:!1,error:d})),o&&C.info("".concat(t.name," onFailure"),d.toString())};return r?wU(l,t.name+"Error",r,()=>a=!0):l()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const r=Date.now(),n=this.createBaseInfo(e,r);n.cname=t.cname;const i=Object.assign({},{willUploadConsoleLog:W("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:S3?"global":"oversea",areas:W("AREAS")&&W("AREAS").join(",")},t.extend),{stringUid:s,channelProfile:o,channelMode:a,isABTestSuccess:c,lsid:d,clientRole:l}=t,u=Date.now(),h=at(at({},n),{},{eventType:bn.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:T3,lts:u,elapse:u-r,extend:JSON.stringify(i),mode:t.mode,process:W("PROCESS_ID"),appType:W("APP_TYPE"),success:!0,version:xo,stringUid:s,channelProfile:o,channelMode:a,isABTestSuccess:c,lsid:d,clientType:Ee(p=window.navigator.userAgent).call(p,"AgoraWebView")?42:20,clientRole:l,serviceId:W("PROCESS_ID"),extensionID:W("PLUGIN_INFO").join(",")||""});var p;this.send({type:Rr.SESSION,data:h},!0)}joinChooseServer(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const n=r.info,i=Date.now(),s=at(at({},n),{},{eventType:bn.JOIN_CHOOSE_SERVER,lts:i,eventElapse:t.elapse||i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-r.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0});this.send({type:Rr.JOIN_CHOOSE_SERVER,data:s},!0)}reqUserAccount(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const n=r.info,i=Date.now(),s=at(at({},n),{},{eventType:bn.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||i-r.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Rr.REQ_USER_ACCOUNT,data:s},!0)}joinGateway(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const n=r.info;t.vid&&(n.vid=t.vid),n.uid=t.uid,n.cid=t.cid;const i=Date.now(),{firstSuccess:s,avoidJoinStartTime:o}=t,a=i-(s&&o?o:r.startTime),c=at(at({},n),{},{eventType:bn.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:a,eventElapse:i-t.lts,firstSuccess:s,signalChannel:t.signalChannel,preload:t.preload?1:0});t.succ&&(r.lastJoinSuccessTime=i),this.send({type:Rr.JOIN_GATEWAY,data:c},!0)}joinChannelTimeout(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const n=Date.now(),i=at(at({},r.info),{},{lts:n,timeout:t,elapse:n-r.startTime});this.send({type:Rr.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const n=r.info,i=Date.now(),s=at(at({},n),{},{eventType:bn.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-r.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Rr.PUBLISH,data:s},!0)}subscribe(e,t,r){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=at(at({},i),{},{eventType:bn.SUBSCRIBE,lts:s,eventElapse:t.eventElapse,elapse:s-n.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},r&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?o.peerSuid=t.peerid:o.peer=t.peerid,this.send({type:Rr.SUBSCRIBE,data:o},!0)}wsCompressorInit(e){var t;const r=[...Ks(t=this.baseInfoMap).call(t)],n=r.length?r[0]:"UnableToGetSid",i=this.baseInfoMap.get(n);if(!i)return;const s=i.info,o=Date.now(),a=at(at({},s),{},{eventType:bn.WS_COMPRESSOR_INIT,lts:o,eventElapse:e.eventElapse,elapse:o-i.startTime,status:e.status?1:2});this.send({type:Rr.WS_COMPRESSOR_INIT,data:a},!0)}firstRemoteVideoDecode(e,t,r,n){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,o=Date.now(),a=at(at(at({},s),n),{},{elapse:o-i.startTime,eventType:t,lts:o,firstDecodeFrame:Math.max((n.firstFrame||o)-i.startTime,0),apEnd:Math.max(n.apEnd-i.startTime,0),apStart:Math.max(n.apStart-i.startTime,0),joinGwEnd:Math.max(n.joinGwEnd-i.startTime,0),joinGwStart:Math.max(n.joinGwStart-i.startTime,0),pcEnd:Math.max(n.pcEnd-i.startTime,0),pcStart:Math.max(n.pcStart-i.startTime,0),subscriberEnd:Math.max(n.subscriberEnd-i.startTime,0),subscriberStart:Math.max(n.subscriberStart-i.startTime,0),videoAddNotify:Math.max(n.videoAddNotify-i.startTime,0)});this.send({type:r,data:a},!0)}firstRemoteFrame(e,t,r,n){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,o=Date.now(),a=at(at(at({},s),n),{},{elapse:o-i.startTime,eventType:t,lts:o});this.send({type:r,data:a},!0)}pcStats(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const n=r.info,i=Date.now(),s=at(at(at({},n),t),{},{vid:n.vid===void 0?0:Number(n.vid),elapse:i-r.startTime,eventType:bn.PC_STATS,lts:i,preallocation:t.preallocation?1:0});this.send({type:Rr.PC_STATS,data:s},!0)}updateRemoteRTPCapabilities(e,t){if(e){const r=this.baseInfoMap.get(e);if(!r)return;const n=r.info,i=Date.now(),s=at(at(at({},n),t),{},{vid:n.vid===void 0?0:Number(n.vid),eventType:bn.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:Rr.UPDATE_REMOTE_RTPCAPABILITIES,data:s},!0)}}onGatewayStream(e,t,r,n){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,o=Date.now(),a=at(at(at({},s),n),{},{eventType:t,lts:o});this.send({type:r,data:a},!0)}streamSwitch(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const n=r.info,i=Date.now(),s=at(at({},n),{},{eventType:bn.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-r.startTime,success:t.succ});this.send({type:Rr.STREAM_SWITCH,data:s},!0)}requestProxyAppCenter(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const n=r.info,i=Date.now(),s=at(at({},n),{},{eventType:bn.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-r.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Rr.REQUEST_PROXY_APPCENTER,data:s},!0)}requestProxyWorkerManager(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const n=r.info,i=Date.now(),s=at(at({},n),{},{eventType:bn.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-r.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Rr.REQUEST_PROXY_WORKER_MANAGER,data:s},!0)}setProxyServer(e){this.proxyServer=e,e?C.debug("reportProxyServerurl: ".concat(e)):C.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const n=r.info,i=Date.now(),s=at(at({},n),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-r.startTime,joinChannelSuccessElapse:i-(r.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Rr.PEER_PUBLISH_STATUS,data:s},!0)}workerEvent(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const n=r.info,i=Date.now();(function(s,o,a){const c=s[o];if(!c||typeof c!="string")return[s];s[o]="";const d=ed(JSON.stringify(s));let l=0;const u=[];let h=0;for(let p=0;p<c.length;p++)h+=c.charCodeAt(p)<=127?1:3,h<=a-d||(u[u.length]=Ae(Ae({},s),{},{[o]:c.substring(l,p)}),l=p,h=c.charCodeAt(p)<=127?1:3);return l!==c.length-1&&(u[u.length]=Ae(Ae({},s),{},{[o]:c.substring(l)})),u})(at(at(at({},n),t),{},{elapse:i-r.startTime,lts:i,productType:"WebRTC"}),"payload",1300).forEach(s=>this.send({type:Rr.WORKER_EVENT,data:s},!0))}apworkerEvent(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const n=r.info,i=Date.now(),s=at(at(at({},n),t),{},{elapse:i-r.startTime,lts:i});this.send({type:Rr.AP_WORKER_EVENT,data:s},!0)}joinWebProxyAP(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const n=r.info,i=Date.now(),s=at(at(at({},n),t),{},{elapse:i-r.startTime,lts:i,extend:t.extend||void 0});this.send({type:Rr.JOIN_WEB_PROXY_AP,data:s},!0)}WebSocketQuit(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const n=r.info,i=Date.now(),s=at(at(at({},n),t),{},{elapse:i-r.startTime,lts:i});this.send({type:Rr.WEBSOCKET_QUIT,data:s},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>W("CUSTOM_REPORT_LIMIT"))throw new ie($.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const r=Date.now(),n=t.map(i=>({type:Rr.USER_ANALYTICS,data:at(at({sid:e},i),{},{lts:r})}));try{W("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(n):await this.postDataToStatsCollector(n)}catch(i){throw C.error("send custom report message failed",i.toString()),new ie($.CUSTOM_REPORT_SEND_FAILED,i.message)}}sendApiInvoke(e){const t=W("NOT_REPORT_EVENT");if(e.tag&&Ee(t)&&Ee(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const r=this.baseInfoMap.get(e.sid);if(!r)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:n,uid:i,cid:s}=r.info;let o;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof ie){const{code:c,message:d}=e.error;o=c||d||e.error.toString()}else o=e.error.toString();const a={invokeId:e.invokeId,sid:e.sid,cname:n,cid:s,uid:i,lts:e.lts,success:e.success,elapse:e.lts-r.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?o:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Rr.API_INVOKE,data:a},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(r=>r!==null);t&&e.forEach(r=>{r&&(r.sid=t,this.sendApiInvoke(Object.assign({},r)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>W("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const r=[],n=[];for(;e.length;){const s=e.shift();r.length<20?r.push(s):n.push(s)}e.push(...n);for(const s of[...r]){var i;this.ltsList.indexOf(s.data.lts)!==-1?(s.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(s.data.lts)):(this.ltsList.push(s.data.lts),sv(i=this.ltsList).call(i,(o,a)=>o-a))}return t||(this.lastSendNormalEventTime=Date.now()),W("ENABLE_EVENT_REPORT")&&r.length&&(W("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(r):this.postDataToStatsCollector(r)).catch((s=>o=>{W("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(s):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(s),this.normalEventUploadPendingItems.length>W("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-W("NORMAL_EVENT_QUEUE_CAPACITY")),C.warning("report: drop normal events"))))})(r)),e}async postDataToStatsCollector2(e){Wr.networkState===bs.OFFLINE&&await _e.race([Wr.onlineWaiter,In(2*Kr.maxRetryTimeout)]);const t=i=>{let s=new Uint8Array;return i.forEach(o=>{const a=y3(JSON.stringify(o.data)),c=new ArrayBuffer(5),d=(u=>{let h=0;return Object.entries(Rr).forEach(p=>{let[_,g]=p;g===u.type&&(h=WPe[_])}),h})(o),l=new DataView(c);l.setUint16(0,a.byteLength,!0),l.setUint8(2,255&d),l.setUint8(3,d>>>8&255),l.setUint8(4,d>>>16&255),s=_U(s,new Uint8Array(c)),s=_U(s,a)}),s},r="event";let n=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(r):"https://".concat(W("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(r);for(let i=0;i<2;i+=1){i===1&&(n=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(r):"https://".concat(W("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(r));try{await dN(n,{timeout:1e4,data:t(e),headers:at(at({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(s){if(i===1)throw s;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(s=>JSON.stringify(s)),vid:(s=>{const o=s&&s.data.sid&&this.baseInfoMap.get(s.data.sid);return o&&o.info.vid&&+o.info.vid||0})(e[0])};Wr.networkState===bs.OFFLINE&&await _e.race([Wr.onlineWaiter,In(2*Kr.maxRetryTimeout)]);const n=t?"/events/proto-raws":"/events/messages";let i=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("EVENT_REPORT_DOMAIN"),"&p=").concat(W("STATS_COLLECTOR_PORT"),"&d=").concat(n):"https://".concat(W("EVENT_REPORT_DOMAIN"),":").concat(W("STATS_COLLECTOR_PORT")).concat(n));for(let s=0;s<2;s+=1){s===1&&(i=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(W("STATS_COLLECTOR_PORT"),"&d=").concat(n):"https://".concat(W("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(W("STATS_COLLECTOR_PORT")).concat(n)));try{t?await jPe(i,{timeout:1e4,data:r}):await dN(i,{timeout:1e4,data:r})}catch(o){if(s===1)throw o;continue}return}}createBaseInfo(e,t){const r=Object.assign({},zPe);return r.sid=e,this.baseInfoMap.set(e,{info:r,startTime:t}),r}reportResourceTiming(e,t){const r=performance.getEntriesByName(e),n=r[r.length-1];n&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:n,tag:Or.TRACER}).onSuccess()}};rJ.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Wr.networkState,Ce.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Or.TRACER}).onSuccess("logUploadError")});class ee extends ie{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Lr(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,C)}throw(){super.throw(C)}}const GPe=["CHINA","GLOBAL"],nJ=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Oh=[];function ph(e,t){return!!t&&Oh.some(r=>r.uid===e&&r.channelName===t)}var qPe=YK.forEach,PU=Hw("forEach")?[].forEach:function(e){return qPe(this,e,arguments.length>1?arguments[1]:void 0)};Jt({target:"Array",proto:!0,forced:[].forEach!=PU},{forEach:PU});var KPe=ja("Array").forEach,YPe=Id,JPe=Xn,XPe=ki,QPe=KPe,dC=Array.prototype,ZPe={DOMTokenList:!0,NodeList:!0},e3e=function(e){var t=e.forEach;return e===dC||XPe(dC,e)&&t===dC.forEach||JPe(ZPe,YPe(e))?QPe:t},t3e=Pr(e3e),r3e=Cd,kU=qw;Jt({target:"Object",stat:!0,forced:en(function(){kU(1)})},{keys:function(e){return kU(r3e(e))}});var iJ=Pr(Ko.Object.keys),n3e=Pr(iq),i3e=Jt,s3e=ov,o3e=Jr([].reverse),LU=[1,2];i3e({target:"Array",proto:!0,forced:String(LU)===String(LU.reverse())},{reverse:function(){return s3e(this)&&(this.length=this.length),o3e(this)}});var a3e=ja("Array").reverse,c3e=ki,d3e=a3e,lC=Array.prototype,l3e=function(e){var t=e.reverse;return e===lC||c3e(lC,e)&&t===lC.reverse?d3e:t},sJ=l3e,u3e=Pr(sJ),h3e=Jt,xU=ov,f3e=Jw,p3e=Eo,MU=MP,m3e=Ol,g3e=Zu,_3e=eT,E3e=qr,v3e=Xw,y3e=WK("slice"),b3e=E3e("species"),uC=Array,S3e=Math.max;h3e({target:"Array",proto:!0,forced:!y3e},{slice:function(e,t){var r,n,i,s=g3e(this),o=m3e(s),a=MU(e,o),c=MU(t===void 0?o:t,o);if(xU(s)&&(r=s.constructor,(f3e(r)&&(r===uC||xU(r.prototype))||p3e(r)&&(r=r[b3e])===null)&&(r=void 0),r===uC||r===void 0))return v3e(s,a,c);for(n=new(r===void 0?uC:r)(S3e(c-a,0)),i=0;a<c;a++,i++)a in s&&_3e(n,i,s[a]);return n.length=i,n}});var w3e=ja("Array").slice,T3e=ki,R3e=w3e,hC=Array.prototype,A3e=function(e){var t=e.slice;return e===hC||T3e(hC,e)&&t===hC.slice?R3e:t},C3e=Pr(A3e);function we(e,t,r,n,i){var s,o,a,c={};return t3e(s=iJ(n)).call(s,function(d){c[d]=n[d]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=n3e(o=u3e(a=C3e(r).call(r)).call(a)).call(o,function(d,l){return l(e,t,d)||d},c),i&&c.initializer!==void 0&&(c.value=c.initializer?c.initializer.call(i):void 0,c.initializer=void 0),c.initializer===void 0&&(HK(e,t,c),c=null),c}let lN=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),Bs=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({}),kb=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),fC=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),ia=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),yi=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),xe=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),or=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),He=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),$e=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),fE=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),ft=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),Ri=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),We=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function uT(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw C.error("Invalid Channel Name ".concat(e)),new ee($.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function hT(e){if(!function(t){return typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295}(e)&&!KY(e,1,255))throw new ee($.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof e=="string"&&C.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let pl=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const I3e={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},pC={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function mC(e,t){wn(e.url,"".concat(t,".url"),1,1e3,!1),Tr(e.x)||qt(e.x,"".concat(t,".x"),0,1e4),Tr(e.y)||qt(e.y,"".concat(t,".y"),0,1e4),Tr(e.width)||qt(e.width,"".concat(t,".width"),0,1e4),Tr(e.height)||qt(e.height,"".concat(t,".height"),0,1e4),Tr(e.zOrder)||qt(e.zOrder,"".concat(t,".zOrder"),0,255),Tr(e.alpha)||qt(e.alpha,"".concat(t,".alpha"),0,1,!1)}const O3e={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let ou=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),uN=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Xr=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function UU(e){if(!e.channelName)throw new ee($.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new ee($.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&wn(e.token,"info.token",1,2047),hT(e.uid),uT(e.channelName),!0}let bi=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Jd=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),is=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),bp=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),jt=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),kn=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e}({}),Lb=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),hn=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),Dt=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const jU=[Dt.AFRICA,Dt.ASIA,Dt.CHINA,Dt.EUROPE,Dt.GLOBAL,Dt.INDIA,Dt.JAPAN,Dt.NORTH_AMERICA,Dt.OCEANIA,Dt.OVERSEA,Dt.SOUTH_AMERICA];let zn=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const fT={CHINA:{},ASIA:{CODE:zn.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:zn.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:zn.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:zn.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:zn.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:zn.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:zn.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:zn.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:zn.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:zn.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:zn.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:zn.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:zn.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};S3&&(fT.CHINA={CODE:zn.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let hN=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e}({});class oJ extends Cr{constructor(t,r){super(),j(this,"onICEConnectionStateChange",void 0),j(this,"onConnectionStateChange",void 0),j(this,"onDTLSTransportStateChange",void 0),j(this,"onDTLSTransportError",void 0),j(this,"onICETransportStateChange",void 0),j(this,"onFirstAudioReceived",void 0),j(this,"onFirstVideoReceived",void 0),j(this,"onFirstAudioDecoded",void 0),j(this,"onFirstVideoDecoded",void 0),j(this,"onFirstVideoDecodedTimeout",void 0),j(this,"onSelectedLocalCandidateChanged",void 0),j(this,"onSelectedRemoteCandidateChanged",void 0),j(this,"getLocalVideoStats",void 0)}}class aJ extends oJ{constructor(t,r){super(t,r),j(this,"establishPromise",void 0)}}let Oe=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Ss=function(e){return e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY",e}({}),Gd=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({}),le=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Ut=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Fe=function(e){return e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),ha=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),sa=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),_n=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),cJ=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Jc=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),wo=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Ja=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),ip=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),jr=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),sp=function(e){return e.ABORT="abort",e}({}),mu=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),N3e=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const D3e={[kb.ACCESS_POINT]:{[yi.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[yi.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[yi.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[yi.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[yi.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[yi.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[yi.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[yi.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[yi.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[yi.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[yi.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[yi.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[yi.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[yi.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[yi.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[yi.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[yi.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[yi.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[kb.UNILBS]:{[ia.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[ia.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[ia.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[ia.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[ia.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[ia.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[ia.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[ia.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[ia.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[ia.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[ia.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[ia.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[kb.STRING_UID_ALLOCATOR]:{[fC.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[fC.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[fC.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Bm(e){const t=D3e[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const r=t[e%1e4];if(!r){if(Math.floor(e/1e4)===kb.ACCESS_POINT){const n=e%1e4;if(n.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(n.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return r}const P3e={[xe.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[xe.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[xe.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[xe.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[xe.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[xe.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[xe.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[xe.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[xe.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[xe.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[xe.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[xe.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[xe.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[xe.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[xe.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[xe.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[xe.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[xe.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[xe.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[xe.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[xe.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[xe.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[xe.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[xe.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[xe.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[xe.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[xe.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[xe.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[xe.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[xe.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[xe.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[xe.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[xe.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[xe.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[xe.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[xe.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[xe.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[xe.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[xe.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[xe.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[xe.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[xe.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[xe.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[xe.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[xe.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[xe.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[xe.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[xe.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[xe.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[xe.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[xe.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[xe.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[xe.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[xe.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[xe.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[xe.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[xe.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[xe.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[xe.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[xe.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[xe.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[xe.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[xe.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function pE(e){return P3e[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function FU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function gC(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?FU(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):FU(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function BU(e){return e.every(t=>t.readyState===WebSocket.CLOSED||t.readyState===WebSocket.CLOSING)}function VU(e,t){if(typeof e=="string")return e;const{proxy:r,host:n,port:i}=e;if(t){const s=W("JOIN_GATEWAY_FALLBACK_PORT")||443;return s===443?"wss://".concat(n,"/ws/?p=").concat(Number(i)+150):"wss://".concat(n,":").concat(s,"/ws/?p=").concat(Number(i)+150)}return r?"wss://".concat(r,"/ws/?h=").concat(n,"&p=").concat(i):"wss://".concat(n,":").concat(i)}const k3e=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,L3e=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,x3e=/wss:\/\/(.+):([0-9]+)\/?/,M3e=/wss:\/\/(.[^\/]+)\/?/;let U3e=0;class j3e{constructor(t,r){j(this,"id",0),j(this,"store",void 0),j(this,"recordIndex",void 0),j(this,"websockets",[]),j(this,"try443PortDuration",2e3),j(this,"forceCloseWSDuration",5e3),j(this,"try443PortTimeout",null),j(this,"forceCloseTimeout",null),j(this,"isTry443PortFailed",!1),j(this,"isNormalPortFailed",!1),j(this,"useDoubleDomain",!1),j(this,"useProxy",!1),j(this,"startTime",Date.now()),this.id=++U3e,this.try443PortDuration=W("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=r}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var t;const r=Date.now()-this.startTime;for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];C.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(r,"ms:"),...i)}createWebSocket(t,r,n){this.logger("createWebSocket:",t,{isTry443Port:r,hasTimeoutDetection:n});const i=W("GATEWAY_DOMAINS"),s=Date.now(),o=[],a=i.find(l=>{var u;return Ee(u=t.host).call(u,l)});a||(this.useDoubleDomain=!1);const c=[];if(this.useDoubleDomain)i.forEach(l=>{c.push(VU(gC(gC({},t),{},{host:t.host.replace(a,l)}),r))});else{const l=gC({},t);if(r&&a){const u=i.find(h=>h!==a);u&&(l.host=l.host.replace(a,u))}c.push(VU(l,r))}try{c.forEach(l=>{const u=new WebSocket(l);u.binaryType="arraybuffer",o.push(u),this.logger("ws is connecting:",u.url)})}catch(l){if(this.logger("ws create failed"),o.forEach(u=>u.close()),o.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,r,n);if(!r&&Number(t.port)!==443)return this.createWebSocket(t,!0,n);throw new ee($.WS_ERR,"init websocket failed! Error: ".concat(l.toString()))}const d=lE();return this.store&&this.store.recordJoinChannelService({urls:o.map(l=>l.url),service:"gateway"},this.recordIndex),o.forEach(l=>{l.onopen=()=>{this.logger("onopen: ws ".concat(l.url," open cost ").concat(Date.now()-s,"ms")),this.websockets.forEach(u=>{u!==l&&(u.onopen=null,u.onclose=null,u.onmessage=null,u.close(),this.logger("close backup websocket: ".concat(u.url)))}),this.websockets.length=0,d.resolve(l)},l.onclose=u=>{this.logger("onclose: ws ".concat(l.url," closed cost ").concat(Date.now()-s,"ms state: ").concat(l.readyState)),r?this.isTry443PortFailed=BU(o):this.isNormalPortFailed=BU(o),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(r&&this.isTry443PortFailed||!r&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(u.reason)),d.reject({code:u.code,reason:Lb.A_ROUND_WS_FAILED}))},l.onmessage=u=>this.logger("".concat(l.url," onmessage: ").concat(u.data))}),this.websockets.push(...o),n||(()=>{const l=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",d.isResolved),this.websockets.forEach(u=>u.readyState!==WebSocket.OPEN&&u.close())};if(r||this.useProxy)return this.logger("add 5s timeout at ".concat(r?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(l,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",d.isResolved),d.isResolved)return l();Rt().os===pn.MAC_OS&&Dr()&&l(),this.createWebSocket(t,!0,!0).then(u=>d.resolve(u)).catch(u=>{this.isNormalPortFailed&&d.reject(u),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(l,this.forceCloseWSDuration)},this.try443PortDuration)})(),d.promise}chooseBestWebsocket(t,r,n,i){return this.useDoubleDomain=!!r,typeof t=="string"&&(t=function(s){let o,a,c;return[,o,a,c]=s.match(k3e)||[],o||([,a,c]=s.match(L3e)||[]),a&&c||([,a,c]=s.match(x3e)||[]),a&&c||([,a]=s.match(M3e)||[]),a||C.warning("un-destructible url: ",s),{proxy:o,host:a,port:c||"443"}}(t)),this.recordIndex=i,this.useProxy=!!t.proxy,n&&this.useProxy&&(C.warn("cannot use 443 only when use proxy"),n=!1),this.createWebSocket(t,!!n,!1).finally(()=>this.clearTimeout())}}function $U(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}class dJ extends Cr{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var r;Ee(r=["tryNext","recover"]).call(r,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(We.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(We.CONNECTED):this._state==="closed"?this.emit(We.CLOSED):this._state==="failed"&&this.emit(We.FAILED))}resetReconnectCount(t){C.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,r){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3],s=arguments.length>4&&arguments[4]!==void 0&&arguments[4],o=arguments.length>5?arguments[5]:void 0;super(),j(this,"connectionID",0),j(this,"currentURLIndex",0),j(this,"urls",[]),j(this,"_reconnectMode","tryNext"),j(this,"reconnectReason",void 0),j(this,"_initMutex",new Jn("websocket")),j(this,"name",void 0),j(this,"_state","closed"),j(this,"reconnectInterrupter",void 0),j(this,"websocket",void 0),j(this,"retryConfig",void 0),j(this,"reconnectCount",0),j(this,"forceCloseTimeout",5e3),j(this,"onlineReconnectListener",void 0),j(this,"useCompress",void 0),j(this,"tryDoubleDomain",!1),j(this,"use443PortOnly",!1),j(this,"wsInflateLength",0),j(this,"wsDeflateLength",0),j(this,"closeEstablishingWs",()=>{}),j(this,"store",void 0),j(this,"joinGatewayRecordIndex",void 0),this.store=o,this.name=t,this.retryConfig=function(u){for(var h=1;h<arguments.length;h++){var p=arguments[h]!=null?arguments[h]:{};h%2?$U(Object(p),!0).forEach(function(_){j(u,_,p[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(p)):$U(Object(p)).forEach(function(_){Object.defineProperty(u,_,Object.getOwnPropertyDescriptor(p,_))})}return u}({},r),this.useCompress=n,this.tryDoubleDomain=i,this.use443PortOnly=s;const{timeout:a,timeoutFactor:c}=r,d=Math.max(300,Math.floor(3*a/5)),l=Math.max(1.2,Math.floor(8*c)/10);bs.ONLINE&&(this.retryConfig.timeout=d,this.retryConfig.timeoutFactor=l),Wr.on(Wp.NETWORK_STATE_CHANGE,(u,h)=>{u!==h&&(this.resetReconnectCount("network state change: ".concat(h," -> ").concat(u)),u===bs.ONLINE?(this.retryConfig.timeout=d,this.retryConfig.timeoutFactor=l):(this.retryConfig.timeout=a,this.retryConfig.timeoutFactor=c))})}getConnection(){return this.websocket||void 0}async init(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=await this._initMutex.lock();this.forceCloseTimeout=r,this.urls=t,this.state="connecting";try{const i=lE(),s=this.urls[this.currentURLIndex];W("ENABLE_PREALLOC_PC")&&this.emit(cJ.PRE_CONNECT_PC),this.createWebSocketConnection(s).then(i.resolve).catch(i.reject),this.once(We.CLOSED,()=>{i.reject(new ie($.WS_DISCONNECT))}),this.once(We.CONNECTED,i.resolve),await i.promise}catch{}finally{n()}}close(t,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const n=this.websocket;r?setTimeout(()=>n.close(),500):n.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,r){if(!this.websocket)return void C.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),C.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(r)]},this.joinGatewayRecordIndex);const n=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),n&&n.bind(this.websocket)({code:9999,reason:r})}sendMessage(t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new ie($.WS_ABORT,"websocket is not ready");try{r||(t=JSON.stringify(t)),this.websocket.send(t)}catch(n){throw new ie($.WS_ERR,"send websocket message error"+n.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,r=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:r}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var r;const n=lE();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const i=l=>{var u;(u=this.store)===null||u===void 0||u.signalChannelOpen(),C.debug("[".concat(this.name,"] websocket opened:"),l),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n.resolve()},s=async l=>{var u;if(C.debug("[".concat(this.name,"] websocket close ").concat((u=this.websocket)===null||u===void 0?void 0:u.url,", code: ").concat(l.code,", reason: ").concat(l.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)n.reject(new ie($.WS_DISCONNECT,"websocket close: ".concat(l.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=l.reason,this.state="reconnecting");const h=Lo(this,We.WILL_RECONNECT,this.reconnectMode,l.reason)||this.reconnectMode,p=await this.reconnectWithAction(h);if(this.state==="closed")return void C.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!p)return n.reject(new ie($.WS_DISCONNECT,"websocket reconnect failed: ".concat(l.code))),this.close(!0);n.resolve()}},o=l=>{this.emit(We.ON_MESSAGE,l)},a=l=>{C.warn("[".concat(this.connectionID,"] ws open error ").concat(l))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),W("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=W("GATEWAY_WSS_ADDRESS")),C.debug("[".concat(this.name,"] start connect, url:"),t);const c=(r=this.store)===null||r===void 0?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var d;const l=await this.chooseBestWebsocketConnection(t);this.websocket=l,i&&i(this.websocket.url),this.websocket.onclose=s,this.websocket.onmessage=o,this.websocket.onerror=a,(d=this.store)===null||d===void 0||d.recordJoinChannelService({endTs:Date.now(),status:"success"},c),this.joinGatewayRecordIndex=c}catch(l){const u=this.state==="closed",h=l instanceof ie,p=h&&l.code===$.WS_ABORT,_=h&&l.code===$.WS_ERR,g=h?l.message:l&&(l.reason||l.toString());C.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(g)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:p?"aborted":"error",errors:[l]},c),u||_?(n.reject(u?new ie($.WS_DISCONNECT,"websocket is closed: ".concat(g)):new ie($.WS_ERR,"init websocket failed: ".concat(g))),_&&C.error("[".concat(this.name,"] init websocket failed: ").concat(g))):s&&s(l)}return n.promise}async reconnectWithAction(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;C.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Wr.isOnline||!Wr.onlineWaiter||(this.onlineReconnectListener=Wr.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let n=!0;if(this.reconnectInterrupter=()=>n=!1,r){const o=b3(this.reconnectCount,this.retryConfig);C.debug("[".concat(this.name,"] wait ").concat(o,"ms to reconnect websocket, mode: ").concat(t)),await _e.race([In(o),this.onlineReconnectListener||new _e(()=>{})])}if(this._state==="closed"||!n)return!1;this.reconnectCount+=1;const i=async(o,a)=>{this.emit(We.RECONNECT_CREATE_CONNECTION,a),await this.createWebSocketConnection(o)};try{if(t==="retry")this.emit(We.RECONNECT_WAITTING_FINISH,t),await i(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);C.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(We.RECONNECT_WAITTING_FINISH,t),await i(this.urls[this.currentURLIndex],t)}else t==="recover"&&(C.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(We.RECONNECT_WAITTING_FINISH,t),this.urls=await Vn(this,We.REQUEST_NEW_URLS),this.currentURLIndex=0,await i(this.urls[this.currentURLIndex],t))}catch(o){var s;C.error("[".concat(this.name,"] reconnect failed ").concat(o&&o.toString()));const a=o==null||(s=o.data)===null||s===void 0?void 0:s.desc;return Array.isArray(a)&&Ee(a).call(a,"dynamic key expired")?(this.emit(We.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,r)}return!0}}class R3 extends dJ{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,r){const n=lE(),i=function(o,a){return new j3e(o,a)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{C.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),n.reject(new ie($.WS_ABORT,"choose best websocket aborted"))};const s=W("GATEWAY_DOMAINS");return C.debug("[choose-best-ws] currentDomain: ",t,", domains: ",s,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,r).then(n.resolve).catch(n.reject),n.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class mE extends dJ{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,r){return new _e((n,i)=>{let s=!1;const o=[];this.closeEstablishingWs=()=>{C.debug("[choose-best-ws] close establishing websockets"),o.forEach(_=>{_.onclose=null,_.onopen=null,_.onmessage=null,_.close()}),i(new ie($.WS_ABORT,"choose best websocket aborted"))};const a=W("GATEWAY_DOMAINS");let c;const d=t.indexOf("?h="),l=a.find(_=>d!==-1?Ee(t).call(t,_,d):Ee(t).call(t,_));C.debug("[choose-best-ws] currentDomain: ",l,", domains: ",a);let u=!this.tryDoubleDomain||!l;if(!u&&l){var h;const _=Date.now();try{a.forEach(g=>{const E=d===-1?t.replace(l,g):t.substr(0,d)+t.substr(d).replace(l,g),b=new WebSocket(E);b.binaryType="arraybuffer",o.push(b),C.debug("[choose-best-ws] ws is connecting:",b.url)})}catch{for(C.debug("[choose-best-ws] ws create failed, fallback to single url"),o.forEach(E=>E.close());o.length;)o.pop();u=!0}(h=this.store)===null||h===void 0||h.recordJoinChannelService({urls:o.map(g=>g.url),service:"gateway"},r),o.forEach(g=>{g.onopen=()=>{if(s)return;const E=Date.now()-_;C.debug("[choose-best-ws] ws open cost ".concat(E,"ms")),o.filter(b=>b!==g).forEach(b=>{C.debug("[choose-best-ws]close backup websocket: ".concat(b.url)),b.close()}),s=!0,n(g)},g.onclose=E=>{c=E,!s&&(o.find(b=>!(b.readyState===WebSocket.CLOSED||b.readyState===WebSocket.CLOSING))||(C.debug("[choose-best-ws] all websocket is closed"),s=!0,i(c)))},g.onmessage=E=>{C.debug("[choose-best-ws]".concat(g.url," onmessage: ").concat(E.data))}}),In(this.forceCloseTimeout).then(()=>{o.forEach(g=>{g.readyState!==WebSocket.OPEN&&g.close()})})}if(u){var p;let _;C.debug("[choose-best-ws] use single url: ",t),(p=this.store)===null||p===void 0||p.recordJoinChannelService({urls:[t],service:"gateway"},r);try{_=new WebSocket(t),o.push(_),_.binaryType="arraybuffer"}catch(g){const E=new ie($.WS_ERR,"init websocket failed! Error: ".concat(g.toString()));return C.error("[".concat(this.name,"]").concat(E)),void i(E)}_.onopen=()=>{n(_)},_.onclose=g=>{i(g)},_.onmessage=g=>{C.debug("[choose-best-ws]".concat(_.url," onmessage: ").concat(g.data))},In(this.forceCloseTimeout).then(()=>{_&&_.readyState!==WebSocket.OPEN&&_.close()})}}).then(n=>(this.closeEstablishingWs=void 0,n)).catch(n=>{throw this.closeEstablishingWs=void 0,n})}}class F3e extends Cr{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===or.CONNECTED?this.emit(He.WS_CONNECTED):t===or.RECONNECTING?this.emit(He.WS_RECONNECTING,this._websocketReconnectReason):t===or.CLOSED&&this.emit(He.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,r){super(),j(this,"_disconnectedReason",void 0),j(this,"_websocketReconnectReason",void 0),j(this,"_connectionState",or.CLOSED),j(this,"reconnectToken",void 0),j(this,"websocket",void 0),j(this,"openConnectionTime",void 0),j(this,"clientId",void 0),j(this,"lastMsgTime",Date.now()),j(this,"uploadCache",[]),j(this,"uploadCacheInterval",void 0),j(this,"rttRolling",new tJ(5)),j(this,"pingpongTimer",void 0),j(this,"wsInflateDataTimer",void 0),j(this,"pingpongTimeoutCount",0),j(this,"joinResponse",void 0),j(this,"multiIpOption",void 0),j(this,"initError",void 0),j(this,"spec",void 0),j(this,"store",void 0),j(this,"onWebsocketMessage",n=>{if(n.data instanceof ArrayBuffer)return void this.emit(He.ON_BINARY_DATA,n.data);const i=JSON.parse(n.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){if(this.emit(i._type,i._message),i._type===ft.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===ft.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Vt.UID_BANNED);break;case 15:this.close(Vt.IP_BANNED);break;case 16:this.close(Vt.CHANNEL_BANNED)}if(i._type===ft.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case xe.ERR_LICENSE_MISSING:this.close(Vt.LICENSE_MISSING);break;case xe.ERR_LICENSE_EXPIRED:this.close(Vt.LICENSE_EXPIRED);break;case xe.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Vt.LICENSE_MINUTES_EXCEEDED);break;case xe.ERR_LICENSE_PERIOD_INVALID:this.close(Vt.LICENSE_PERIOD_INVALID);break;case xe.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Vt.LICENSE_MULTIPLE_SDK_SERVICE);break;case xe.ERR_LICENSE_ILLEGAL:this.close(Vt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new R3("gateway-".concat(this.clientId),this.spec.retryConfig,!0,W("JOIN_GATEWAY_USE_DUAL_DOMAIN"),W("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===or.CONNECTED&&this.reconnect("retry",Un.OFFLINE)})}async request(t,r,n,i){const s=ar(6,""),o={_id:s,_type:t,_message:r},a=this.websocket.connectionID,c=()=>new _e((_,g)=>{if(this.connectionState===or.CONNECTED)return _();const E=()=>{this.off(He.WS_CLOSED,b),_()},b=()=>{this.off(He.WS_CONNECTED,E),g(new ee($.WS_ABORT))};this.once(He.WS_CONNECTED,E),this.once(He.WS_CLOSED,b),t!==$e.PUBLISH&&t!==$e.PUBLISH_DATASTREAM&&t!==$e.SUBSCRIBE&&t!==$e.SUBSCRIBE_DATASTREAM&&t!==$e.UNSUBSCRIBE&&t!==$e.UNSUBSCRIBE_DATASTREAM&&t!==$e.UNPUBLISH&&t!==$e.UNPUBLISH_DATASTREAM&&t!==$e.CONTROL&&t!==$e.RESTART_ICE||this.once(He.DISCONNECT_P2P,()=>{g(new ee($.DISCONNECT_P2P))}),t!==$e.PUBLISH&&t!==$e.RESTART_ICE||this.once(He.ABORT_P2P_EXECUTION,()=>{g(new ee($.DISCONNECT_P2P))})});if(this.connectionState!==or.CONNECTING&&this.connectionState!==or.RECONNECTING||t===$e.JOIN||t===$e.REJOIN||await c(),this.websocket.sendMessage(o,!0),i)return;const d=new _e((_,g)=>{let E=!1;const b=(I,N)=>{E=!0,_({isSuccess:I==="success",message:N||{}}),this.off(He.WS_CLOSED,v),this.off(He.WS_RECONNECTING,v),this.emit(He.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(s),b);const v=()=>{g(new ee($.WS_ABORT,"type: ".concat(t))),this.off(He.WS_CLOSED,v),this.off(He.WS_RECONNECTING,v),this.off("res-@".concat(s),b)};this.once(He.WS_CLOSED,v),this.once(He.WS_RECONNECTING,v),In(W("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a||E||(C.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(He.REQUEST_TIMEOUT,t,r))})});let l=null;try{l=await d}catch(_){if(this.connectionState===or.CLOSED||t===$e.LEAVE)throw new ee($.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?_.throw():t===$e.JOIN||t===$e.REJOIN?null:(await c(),await this.request(t,r))}if(l.isSuccess)return l.message;const u=Number(l.message.error_code||l.message.code),h=pE(u),p=new ee($.UNEXPECTED_RESPONSE,"".concat(h.desc,": ").concat(l.message.error_str),{code:u,data:l.message,desc:h.desc});return h.action==="success"?l.message:(C.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(u,", message: ").concat(h.desc,", action: ").concat(h.action)),u===xe.ERR_TOO_MANY_BROADCASTERS?((t===$e.JOIN||t===$e.REJOIN)&&(this.initError=p,this.close()),p.throw()):h.action==="failed"?p.throw():h.action==="quit"?(this.initError=p,this.close(),p.throw()):(u===xe.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,C.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Un.MULTI_IP)):this.reconnect(h.action,Un.SERVER_ERROR),t===$e.JOIN||t===$e.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new _e(n=>{const i=s=>{(!r||r(s))&&(this.off(t,i),n(s))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void C.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(fE.WRTC_STATS,r)}upload(t,r){const n={_type:t,_message:r};try{this.websocket.sendMessage(n)}catch{const s=W("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==or.CONNECTED)return;const o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)},W("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){const n={_type:t,_message:r};this.websocket.sendMessage(n)}init(t,r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new _e((n,i)=>{this.once(He.WS_CONNECTED,()=>n(this.joinResponse)),this.once(He.WS_CLOSED,()=>i(this.initError||new ee($.WS_ABORT))),this.connectionState=or.CONNECTING,this.websocket.init(t).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Vt.LEAVE,this.connectionState=or.CLOSED,C.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(He.ABORT_P2P_EXECUTION);const t=await Vn(this,He.REQUEST_JOIN_INFO),r=await this.request($e.JOIN,t);if(!r)return this.emit(He.REPORT_JOIN_GATEWAY,Lb.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(He.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=or.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new ee($.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=hE(this,He.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const r=await this.request($e.REJOIN,t);return!!r&&(this.connectionState=or.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),r.peers&&r.peers.forEach(n=>{this.emit(ft.ON_USER_ONLINE,{uid:n.uid}),n.audio&&this.emit(ft.ON_ADD_AUDIO_STREAM,{uid:n.uid,uint_id:n.uint_id,audio:!0,ssrcId:n.audio_ssrc}),n.video&&this.emit(ft.ON_ADD_VIDEO_STREAM,{uid:n.uid,uint_id:n.uint_id,video:!0,ssrcId:n.video_ssrc}),n.audio_mute?this.emit(ft.MUTE_AUDIO,{uid:n.uid}):this.emit(ft.UNMUTE_AUDIO,{uid:n.uid}),n.video_mute?this.emit(ft.MUTE_VIDEO,{uid:n.uid}):this.emit(ft.UNMUTE_VIDEO,{uid:n.uid}),n.audio_enable_local?this.emit(ft.ENABLE_LOCAL_AUDIO,{uid:n.uid}):this.emit(ft.DISABLE_LOCAL_AUDIO,{uid:n.uid}),n.video_enable_local?this.emit(ft.ENABLE_LOCAL_VIDEO,{uid:n.uid}):this.emit(ft.DISABLE_LOCAL_VIDEO,{uid:n.uid}),n.audio||n.video||this.emit(ft.ON_REMOVE_STREAM,{uid:n.uid,uint_id:n.uint_id})}),!0)}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}handleNotification(t){C.debug("[".concat(this.clientId,"] receive notification: "),t);const r=pE(t.code);if(t.code===28&&"detail"in t&&(C.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(He.RECOVER_NOTIFICATION,t.detail)),r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Vt.UID_BANNED),void this.close()):void this.reconnect(r.action,Un.SERVER_ERROR);C.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=W("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(C.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>W("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Un.TIMEOUT):this.request($e.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const n=Date.now()-r;this.rttRolling.add(n),W("REPORT_STATS")&&this.send($e.PING_BACK,{pingpongElapse:n})}).catch(n=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:r}=this.websocket.getWsInflateData();t!==0&&r!==0&&this.upload(fE.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(We.RECONNECT_WAITTING_FINISH,t=>{this.emit(He.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(We.RECONNECT_CREATE_CONNECTION,t=>{this.emit(He.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(We.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(We.CLOSED,()=>{this.connectionState=or.CLOSED}),this.websocket.on(We.FAILED,()=>{this._disconnectedReason=Vt.NETWORK_ERROR,this.connectionState=or.CLOSED}),this.websocket.on(We.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===or.CONNECTED?this.connectionState=or.RECONNECTING:this.connectionState=or.CONNECTING}),this.websocket.on(We.WILL_RECONNECT,(t,r,n)=>{const i=hE(this,He.IS_P2P_DISCONNECTED),s=i||t!=="retry";i&&t==="retry"&&(C.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",r=Lb.P2P_DISCONNECTED),s&&(C.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(He.REPORT_JOIN_GATEWAY,r||Lb.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(He.DISCONNECT_P2P)),n(t)}),this.websocket.on(We.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{C.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Un.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(He.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof ee){if(t.code===$.UNEXPECTED_RESPONSE&&t.data.code===xe.ERR_NO_AUTHORIZED)return this.initError=new ee($.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),C.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Un.SERVER_ERROR);C.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Un.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(We.REQUEST_NEW_URLS,(t,r)=>{Vn(this,He.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)}),this.websocket.on(We.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ft.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(cJ.PRE_CONNECT_PC,()=>{this.emit(He.PRE_CONNECT_PC)})}}let zr=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function HU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function gy(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?HU(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):HU(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Kp(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(W("TURN_DOMAIN")):(C.info("Unidentified as ip: ".concat(e,", use as host")),e)}function A3(e,t){e.addresses||(e.addresses=[]);const r=function(a,c){if(W("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return a.map(u=>{let{ip:h,port:p}=u;return{address:"".concat(h,":").concat(p)}});const d=W("GATEWAY_DOMAINS");let l=d[1]&&Ee(c).call(c,d[1])?1:0;return a.map(u=>{let{domain_prefix:h,port:p,ip:_}=u;if(h)return{address:"".concat(h,".").concat(d[l++%d.length],":").concat(p)};const g=/^[\.\:\d]+$/.test(_),E=g?"".concat(_.replace(/[^\d]/g,"-"),".").concat(d[l++%d.length],":").concat(p):"".concat(_,":").concat(p);return g||C.info("Unidentified as ip: ".concat(_,", use as host")),{ip:_,port:p,address:E}})}(e.addresses,t),n=Array.isArray(e.detail)&&e.detail[18];if(n&&typeof n=="string"){const a=n.split(";");for(let c=0;c<a.length;c++){var i;const d=fi(i=a[c]).call(i);r[c]&&d&&(r[c].ip6=d)}}const s=e.detail&&e.detail.candidate;let o;if(s){const[a,c]=s.split(":");a&&c&&(o={port:Number(c),ip:a,address:"".concat(a,":").concat(c)})}return{gatewayAddrs:r,apGatewayAddress:o,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Rs(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function zU(e){const t=e._encoderConfig;if(!t)return{};const r={resolution:t.width&&t.height?"".concat(Rs(t.width),"x").concat(Rs(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(r.maxFrameRate=t.frameRate,r.minFrameRate=t.frameRate):t.frameRate&&(r.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,r.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),r}function WU(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function gE(e,t){let r,n,i;switch(t){case zr.CHOOSE_SERVER:n=4096,i="choose server";break;case zr.CLOUD_PROXY:n=1048576,i="proxy";break;case zr.CLOUD_PROXY_5:n=4194304,i="proxy5";break;case zr.CLOUD_PROXY_FALLBACK:n=4194310,i="proxy fallback";break;default:throw new ee($.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(s=>{s.buffer&&s.buffer.flag===n&&(r={code:s.buffer.code,addresses:(s.buffer.edges_services||[]).map(o=>gy(gy({},o),{},{ticket:s.buffer.cert})),server_ts:e.enter_ts,uid:s.buffer.uid,cid:s.buffer.cid,cname:s.buffer.cname,detail:gy(gy({},s.buffer.detail),e.detail),flag:s.buffer.flag,opid:e.opid,cert:s.buffer.cert})}),!r)throw new ee($.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return r}async function lJ(e,t){return await _e.all(e.addresses.map(async r=>({address:Kp(r.ip),tcpport:r.port,udpport:r.port,username:t&&W("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Ln.username,password:t&&W("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await aN(t.toString()):Ln.password})))}function fN(e,t){const r=t.getMediaStreamTrack(!0).getSettings(),n=t.videoHeight||r.height,i=t.videoWidth||r.width;return n&&i?Math.max(Math.min(n,i)/Math.min(Rs(e.height),Rs(e.width)),1):(C.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function gu(e){let{candidateType:t,relayProtocol:r,type:n,address:i,port:s,protocol:o}=e;return n==="local-candidate"?{candidateType:t,relayProtocol:r,protocol:o}:{candidateType:t,relayProtocol:r,address:i,port:s,protocol:o}}var oa,B3e=Pr(sJ),V3e=ja("Array").values,$3e=Id,H3e=Xn,z3e=ki,W3e=V3e,_C=Array.prototype,G3e={DOMTokenList:!0,NodeList:!0},q3e=function(e){var t=e.values;return e===_C||z3e(_C,e)&&t===_C.values||H3e(G3e,$3e(e))?W3e:t},_l=Pr(q3e),GU=qo,K3e=Jr,Y3e=$n,J3e=en,EC=qw,X3e=ev,Q3e=Fw,Z3e=Cd,eke=Bw,op=Object.assign,qU=Object.defineProperty,tke=K3e([].concat),rke=!op||J3e(function(){if(GU&&op({b:1},op(qU({},"a",{enumerable:!0,get:function(){qU(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach(function(i){t[i]=i}),op({},e)[r]!=7||EC(op({},t)).join("")!=n})?function(e,t){for(var r=Z3e(e),n=arguments.length,i=1,s=X3e.f,o=Q3e.f;n>i;)for(var a,c=eke(arguments[i++]),d=s?tke(EC(c),s(c)):EC(c),l=d.length,u=0;l>u;)a=d[u++],GU&&!Y3e(o,c,a)||(r[a]=c[a]);return r}:op,nke=hs,ike=gq,ske=th,oke=$n,ake=Cd,cke=function(e,t,r,n){try{return n?t(nke(r)[0],r[1]):t(r)}catch(i){ike(e,"throw",i)}},dke=mq,lke=Jw,uke=Ol,KU=eT,hke=HP,fke=Kw,YU=Array,Bf=Jr,vC=2147483647,pke=/[^\0-\u007E]/,uJ=/[.\u3002\uFF0E\uFF61]/g,JU="Overflow: input needs wider integers to process",XU=RangeError,mke=Bf(uJ.exec),Yp=Math.floor,yC=String.fromCharCode,QU=Bf("".charCodeAt),hJ=Bf([].join),Gl=Bf([].push),gke=Bf("".replace),_ke=Bf("".split),Eke=Bf("".toLowerCase),ZU=function(e){return e+22+75*(e<26)},vke=function(e,t,r){var n=0;for(e=r?Yp(e/700):e>>1,e+=Yp(e/t);e>455;)e=Yp(e/35),n+=36;return Yp(n+36*e/(e+38))},yke=function(e){var t=[];e=function(b){for(var v=[],I=0,N=b.length;I<N;){var L=QU(b,I++);if(L>=55296&&L<=56319&&I<N){var U=QU(b,I++);(64512&U)==56320?Gl(v,((1023&L)<<10)+(1023&U)+65536):(Gl(v,L),I--)}else Gl(v,L)}return v}(e);var r,n,i=e.length,s=128,o=0,a=72;for(r=0;r<e.length;r++)(n=e[r])<128&&Gl(t,yC(n));var c=t.length,d=c;for(c&&Gl(t,"-");d<i;){var l=vC;for(r=0;r<e.length;r++)(n=e[r])>=s&&n<l&&(l=n);var u=d+1;if(l-s>Yp((vC-o)/u))throw XU(JU);for(o+=(l-s)*u,s=l,r=0;r<e.length;r++){if((n=e[r])<s&&++o>vC)throw XU(JU);if(n==s){for(var h=o,p=36;;){var _=p<=a?1:p>=a+26?26:p-a;if(h<_)break;var g=h-_,E=36-_;Gl(t,yC(ZU(_+g%E))),h=Yp(g/E),p+=36}Gl(t,yC(ZU(h))),a=vke(o,u,d==c),o=0,d++}}o++,s++}return hJ(t,"")},bke=Jt,C3=qo,Ske=d3,I3=an,e9=th,Fa=Jr,_y=nh,aa=Yw,wke=GP,pN=Xn,O3=rke,ap=function(e){var t=ake(e),r=lke(this),n=arguments.length,i=n>1?arguments[1]:void 0,s=i!==void 0;s&&(i=ske(i,n>2?arguments[2]:void 0));var o,a,c,d,l,u,h=fke(t),p=0;if(!h||this===YU&&dke(h))for(o=uke(t),a=r?new this(o):YU(o);o>p;p++)u=s?i(t[p],p):t[p],KU(a,p,u);else for(l=(d=hke(t,h)).next,a=r?new this:[];!(c=oke(l,d)).done;p++)u=s?cke(d,i,[c.value,p],!0):c.value,KU(a,p,u);return a.length=p,a},Wa=e3,Tke=ZP.codeAt,Rke=function(e){var t,r,n=[],i=_ke(gke(Eke(e),uJ,"."),".");for(t=0;t<i.length;t++)r=i[t],Gl(n,mke(pke,r)?"xn--"+yke(r):r);return hJ(n,".")},Xd=Jo,Ake=ih,Cke=T0,fJ=DDe,pJ=Ff,Ike=pJ.set,yS=pJ.getterFor("URL"),Oke=fJ.URLSearchParams,Nke=fJ.getState,fg=I3.URL,mN=I3.TypeError,Ey=I3.parseInt,Dke=Math.floor,t9=Math.pow,va=Fa("".charAt),Ya=Fa(/./.exec),Lg=Fa([].join),Pke=Fa(1 .toString),kke=Fa([].pop),cp=Fa([].push),bC=Fa("".replace),Lke=Fa([].shift),xke=Fa("".split),xg=Fa("".slice),xb=Fa("".toLowerCase),Mke=Fa([].unshift),SC="Invalid scheme",mh="Invalid host",r9="Invalid port",mJ=/[a-z]/i,Uke=/[\d+-.a-z]/i,wC=/\d/,jke=/^0x/i,Fke=/^[0-7]+$/,Bke=/^\d+$/,n9=/^[\da-f]+$/i,Vke=/[\0\t\n\r #%/:<>?@[\\\]^|]/,$ke=/[\0\t\n\r #/:<>?@[\\\]^|]/,Hke=/^[\u0000-\u0020]+/,zke=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Wke=/[\t\n\r]/g,pg=function(e){var t,r,n,i;if(typeof e=="number"){for(t=[],r=0;r<4;r++)Mke(t,e%256),e=Dke(e/256);return Lg(t,".")}if(typeof e=="object"){for(t="",n=function(s){for(var o=null,a=1,c=null,d=0,l=0;l<8;l++)s[l]!==0?(d>a&&(o=c,a=d),c=null,d=0):(c===null&&(c=l),++d);return d>a&&(o=c,a=d),o}(e),r=0;r<8;r++)i&&e[r]===0||(i&&(i=!1),n===r?(t+=r?":":"::",i=!0):(t+=Pke(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},Mb={},gJ=O3({},Mb,{" ":1,'"':1,"<":1,">":1,"`":1}),_J=O3({},gJ,{"#":1,"?":1,"{":1,"}":1}),TC=O3({},_J,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Fl=function(e,t){var r=Tke(e,0);return r>32&&r<127&&!pN(t,e)?e:encodeURIComponent(e)},vy={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Mg=function(e,t){var r;return e.length==2&&Ya(mJ,va(e,0))&&((r=va(e,1))==":"||!t&&r=="|")},i9=function(e){var t;return e.length>1&&Mg(xg(e,0,2))&&(e.length==2||(t=va(e,2))==="/"||t==="\\"||t==="?"||t==="#")},Gke=function(e){return e==="."||xb(e)==="%2e"},RC={},s9={},AC={},o9={},a9={},CC={},c9={},d9={},yy={},by={},IC={},OC={},NC={},DC={},l9={},PC={},dp={},Pc={},u9={},gh={},qd={},N3=function(e,t,r){var n,i,s,o=Xd(e);if(t){if(i=this.parse(o))throw mN(i);this.searchParams=null}else{if(r!==void 0&&(n=new N3(r,!0)),i=this.parse(o,null,n))throw mN(i);(s=Nke(new Oke)).bindURL(this),this.searchParams=s}};N3.prototype={type:"URL",parse:function(e,t,r){var n,i,s,o,a,c=this,d=t||RC,l=0,u="",h=!1,p=!1,_=!1;for(e=Xd(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=bC(e,Hke,""),e=bC(e,zke,"$1")),e=bC(e,Wke,""),n=ap(e);l<=n.length;){switch(i=n[l],d){case RC:if(!i||!Ya(mJ,i)){if(t)return SC;d=AC;continue}u+=xb(i),d=s9;break;case s9:if(i&&(Ya(Uke,i)||i=="+"||i=="-"||i=="."))u+=xb(i);else{if(i!=":"){if(t)return SC;u="",d=AC,l=0;continue}if(t&&(c.isSpecial()!=pN(vy,u)||u=="file"&&(c.includesCredentials()||c.port!==null)||c.scheme=="file"&&!c.host))return;if(c.scheme=u,t)return void(c.isSpecial()&&vy[c.scheme]==c.port&&(c.port=null));u="",c.scheme=="file"?d=DC:c.isSpecial()&&r&&r.scheme==c.scheme?d=o9:c.isSpecial()?d=d9:n[l+1]=="/"?(d=a9,l++):(c.cannotBeABaseURL=!0,cp(c.path,""),d=u9)}break;case AC:if(!r||r.cannotBeABaseURL&&i!="#")return SC;if(r.cannotBeABaseURL&&i=="#"){c.scheme=r.scheme,c.path=Wa(r.path),c.query=r.query,c.fragment="",c.cannotBeABaseURL=!0,d=qd;break}d=r.scheme=="file"?DC:CC;continue;case o9:if(i!="/"||n[l+1]!="/"){d=CC;continue}d=yy,l++;break;case a9:if(i=="/"){d=by;break}d=Pc;continue;case CC:if(c.scheme=r.scheme,i==oa)c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=Wa(r.path),c.query=r.query;else if(i=="/"||i=="\\"&&c.isSpecial())d=c9;else if(i=="?")c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=Wa(r.path),c.query="",d=gh;else{if(i!="#"){c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=Wa(r.path),c.path.length--,d=Pc;continue}c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=Wa(r.path),c.query=r.query,c.fragment="",d=qd}break;case c9:if(!c.isSpecial()||i!="/"&&i!="\\"){if(i!="/"){c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,d=Pc;continue}d=by}else d=yy;break;case d9:if(d=yy,i!="/"||va(u,l+1)!="/")continue;l++;break;case yy:if(i!="/"&&i!="\\"){d=by;continue}break;case by:if(i=="@"){h&&(u="%40"+u),h=!0,s=ap(u);for(var g=0;g<s.length;g++){var E=s[g];if(E!=":"||_){var b=Fl(E,TC);_?c.password+=b:c.username+=b}else _=!0}u=""}else if(i==oa||i=="/"||i=="?"||i=="#"||i=="\\"&&c.isSpecial()){if(h&&u=="")return"Invalid authority";l-=ap(u).length+1,u="",d=IC}else u+=i;break;case IC:case OC:if(t&&c.scheme=="file"){d=PC;continue}if(i!=":"||p){if(i==oa||i=="/"||i=="?"||i=="#"||i=="\\"&&c.isSpecial()){if(c.isSpecial()&&u=="")return mh;if(t&&u==""&&(c.includesCredentials()||c.port!==null))return;if(o=c.parseHost(u))return o;if(u="",d=dp,t)return;continue}i=="["?p=!0:i=="]"&&(p=!1),u+=i}else{if(u=="")return mh;if(o=c.parseHost(u))return o;if(u="",d=NC,t==OC)return}break;case NC:if(!Ya(wC,i)){if(i==oa||i=="/"||i=="?"||i=="#"||i=="\\"&&c.isSpecial()||t){if(u!=""){var v=Ey(u,10);if(v>65535)return r9;c.port=c.isSpecial()&&v===vy[c.scheme]?null:v,u=""}if(t)return;d=dp;continue}return r9}u+=i;break;case DC:if(c.scheme="file",i=="/"||i=="\\")d=l9;else{if(!r||r.scheme!="file"){d=Pc;continue}if(i==oa)c.host=r.host,c.path=Wa(r.path),c.query=r.query;else if(i=="?")c.host=r.host,c.path=Wa(r.path),c.query="",d=gh;else{if(i!="#"){i9(Lg(Wa(n,l),""))||(c.host=r.host,c.path=Wa(r.path),c.shortenPath()),d=Pc;continue}c.host=r.host,c.path=Wa(r.path),c.query=r.query,c.fragment="",d=qd}}break;case l9:if(i=="/"||i=="\\"){d=PC;break}r&&r.scheme=="file"&&!i9(Lg(Wa(n,l),""))&&(Mg(r.path[0],!0)?cp(c.path,r.path[0]):c.host=r.host),d=Pc;continue;case PC:if(i==oa||i=="/"||i=="\\"||i=="?"||i=="#"){if(!t&&Mg(u))d=Pc;else if(u==""){if(c.host="",t)return;d=dp}else{if(o=c.parseHost(u))return o;if(c.host=="localhost"&&(c.host=""),t)return;u="",d=dp}continue}u+=i;break;case dp:if(c.isSpecial()){if(d=Pc,i!="/"&&i!="\\")continue}else if(t||i!="?")if(t||i!="#"){if(i!=oa&&(d=Pc,i!="/"))continue}else c.fragment="",d=qd;else c.query="",d=gh;break;case Pc:if(i==oa||i=="/"||i=="\\"&&c.isSpecial()||!t&&(i=="?"||i=="#")){if((a=xb(a=u))===".."||a==="%2e."||a===".%2e"||a==="%2e%2e"?(c.shortenPath(),i=="/"||i=="\\"&&c.isSpecial()||cp(c.path,"")):Gke(u)?i=="/"||i=="\\"&&c.isSpecial()||cp(c.path,""):(c.scheme=="file"&&!c.path.length&&Mg(u)&&(c.host&&(c.host=""),u=va(u,0)+":"),cp(c.path,u)),u="",c.scheme=="file"&&(i==oa||i=="?"||i=="#"))for(;c.path.length>1&&c.path[0]==="";)Lke(c.path);i=="?"?(c.query="",d=gh):i=="#"&&(c.fragment="",d=qd)}else u+=Fl(i,_J);break;case u9:i=="?"?(c.query="",d=gh):i=="#"?(c.fragment="",d=qd):i!=oa&&(c.path[0]+=Fl(i,Mb));break;case gh:t||i!="#"?i!=oa&&(i=="'"&&c.isSpecial()?c.query+="%27":c.query+=i=="#"?"%23":Fl(i,Mb)):(c.fragment="",d=qd);break;case qd:i!=oa&&(c.fragment+=Fl(i,gJ))}l++}},parseHost:function(e){var t,r,n;if(va(e,0)=="["){if(va(e,e.length-1)!="]"||(t=function(i){var s,o,a,c,d,l,u,h=[0,0,0,0,0,0,0,0],p=0,_=null,g=0,E=function(){return va(i,g)};if(E()==":"){if(va(i,1)!=":")return;g+=2,_=++p}for(;E();){if(p==8)return;if(E()!=":"){for(s=o=0;o<4&&Ya(n9,E());)s=16*s+Ey(E(),16),g++,o++;if(E()=="."){if(o==0||(g-=o,p>6))return;for(a=0;E();){if(c=null,a>0){if(!(E()=="."&&a<4))return;g++}if(!Ya(wC,E()))return;for(;Ya(wC,E());){if(d=Ey(E(),10),c===null)c=d;else{if(c==0)return;c=10*c+d}if(c>255)return;g++}h[p]=256*h[p]+c,++a!=2&&a!=4||p++}if(a!=4)return;break}if(E()==":"){if(g++,!E())return}else if(E())return;h[p++]=s}else{if(_!==null)return;g++,_=++p}}if(_!==null)for(l=p-_,p=7;p!=0&&l>0;)u=h[p],h[p--]=h[_+l-1],h[_+--l]=u;else if(p!=8)return;return h}(xg(e,1,-1)),!t))return mh;this.host=t}else if(this.isSpecial()){if(e=Rke(e),Ya(Vke,e)||(t=function(i){var s,o,a,c,d,l,u,h=xke(i,".");if(h.length&&h[h.length-1]==""&&h.length--,(s=h.length)>4)return i;for(o=[],a=0;a<s;a++){if((c=h[a])=="")return i;if(d=10,c.length>1&&va(c,0)=="0"&&(d=Ya(jke,c)?16:8,c=xg(c,d==8?1:2)),c==="")l=0;else{if(!Ya(d==10?Bke:d==8?Fke:n9,c))return i;l=Ey(c,d)}cp(o,l)}for(a=0;a<s;a++)if(l=o[a],a==s-1){if(l>=t9(256,5-s))return null}else if(l>255)return null;for(u=kke(o),a=0;a<o.length;a++)u+=o[a]*t9(256,3-a);return u}(e),t===null))return mh;this.host=t}else{if(Ya($ke,e))return mh;for(t="",r=ap(e),n=0;n<r.length;n++)t+=Fl(r[n],Mb);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return pN(vy,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme=="file"&&t==1&&Mg(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,n=e.password,i=e.host,s=e.port,o=e.path,a=e.query,c=e.fragment,d=t+":";return i!==null?(d+="//",e.includesCredentials()&&(d+=r+(n?":"+n:"")+"@"),d+=pg(i),s!==null&&(d+=":"+s)):t=="file"&&(d+="//"),d+=e.cannotBeABaseURL?o[0]:o.length?"/"+Lg(o,"/"):"",a!==null&&(d+="?"+a),c!==null&&(d+="#"+c),d},setHref:function(e){var t=this.parse(e);if(t)throw mN(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e=="blob")try{return new Vm(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+pg(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Xd(e)+":",RC)},getUsername:function(){return this.username},setUsername:function(e){var t=ap(Xd(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=Fl(t[r],TC)}},getPassword:function(){return this.password},setPassword:function(e){var t=ap(Xd(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=Fl(t[r],TC)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?pg(e):pg(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,IC)},getHostname:function(){var e=this.host;return e===null?"":pg(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,OC)},getPort:function(){var e=this.port;return e===null?"":Xd(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Xd(e))==""?this.port=null:this.parse(e,NC))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+Lg(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,dp))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Xd(e))==""?this.query=null:(va(e,0)=="?"&&(e=xg(e,1)),this.query="",this.parse(e,gh)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Xd(e))!=""?(va(e,0)=="#"&&(e=xg(e,1)),this.fragment="",this.parse(e,qd)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Vm=function(e){var t=wke(this,ms),r=Cke(arguments.length,1)>1?arguments[1]:void 0,n=Ike(t,new N3(e,!1,r));C3||(t.href=n.serialize(),t.origin=n.getOrigin(),t.protocol=n.getProtocol(),t.username=n.getUsername(),t.password=n.getPassword(),t.host=n.getHost(),t.hostname=n.getHostname(),t.port=n.getPort(),t.pathname=n.getPathname(),t.search=n.getSearch(),t.searchParams=n.getSearchParams(),t.hash=n.getHash())},ms=Vm.prototype,ca=function(e,t){return{get:function(){return yS(this)[e]()},set:t&&function(r){return yS(this)[t](r)},configurable:!0,enumerable:!0}};if(C3&&(aa(ms,"href",ca("serialize","setHref")),aa(ms,"origin",ca("getOrigin")),aa(ms,"protocol",ca("getProtocol","setProtocol")),aa(ms,"username",ca("getUsername","setUsername")),aa(ms,"password",ca("getPassword","setPassword")),aa(ms,"host",ca("getHost","setHost")),aa(ms,"hostname",ca("getHostname","setHostname")),aa(ms,"port",ca("getPort","setPort")),aa(ms,"pathname",ca("getPathname","setPathname")),aa(ms,"search",ca("getSearch","setSearch")),aa(ms,"searchParams",ca("getSearchParams")),aa(ms,"hash",ca("getHash","setHash"))),_y(ms,"toJSON",function(){return yS(this).serialize()},{enumerable:!0}),_y(ms,"toString",function(){return yS(this).serialize()},{enumerable:!0}),fg){var h9=fg.createObjectURL,f9=fg.revokeObjectURL;h9&&_y(Vm,"createObjectURL",e9(h9,fg)),f9&&_y(Vm,"revokeObjectURL",e9(f9,fg))}Ake(Vm,"URL"),bke({global:!0,constructor:!0,forced:!Ske,sham:!C3},{URL:Vm});var qke=Jt,Kke=en,Yke=T0,p9=Jo,Jke=d3,m9=ks("URL");qke({target:"URL",stat:!0,forced:!(Jke&&Kke(function(){m9.canParse()}))},{canParse:function(e){var t=Yke(arguments.length,1),r=p9(e),n=t<2||arguments[1]===void 0?void 0:p9(arguments[1]);try{return!!new m9(r,n)}catch{return!1}}});var g9=Pr(Ko.URL);const yn={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function At(){return yn}function EJ(){return"setSinkId"in HTMLAudioElement.prototype&&(!W("RESTRICTION_SET_PLAYBACK_DEVICE")||(Iu()||VY())&&!v3())}function _9(){return!yn.supportUnifiedPlan||W("CHROME_FORCE_PLAN_B")&&Hu()}let Rn=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function lp(e,t,r){return{sampleRate:e,stereo:t,bitrate:r}}function yt(e,t,r,n,i){return{width:e,height:t,frameRate:r,bitrateMin:n,bitrateMax:i}}function da(e,t,r,n,i){return{width:{max:e},height:{max:t},frameRate:r,bitrateMin:n,bitrateMax:i}}function kC(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const Xke={"90p":yt(160,90),"90p_1":yt(160,90),"120p":yt(160,120,15,30,65),"120p_1":yt(160,120,15,30,65),"120p_3":yt(120,120,15,30,50),"120p_4":yt(212,120),"180p":yt(320,180,15,30,140),"180p_1":yt(320,180,15,30,140),"180p_3":yt(180,180,15,30,100),"180p_4":yt(240,180,15,30,120),"240p":yt(320,240,15,40,200),"240p_1":yt(320,240,15,40,200),"240p_3":yt(240,240,15,40,140),"240p_4":yt(424,240,15,40,220),"360p":yt(640,360,15,80,400),"360p_1":yt(640,360,15,80,400),"360p_3":yt(360,360,15,80,260),"360p_4":yt(640,360,30,80,600),"360p_6":yt(360,360,30,80,400),"360p_7":yt(480,360,15,80,320),"360p_8":yt(480,360,30,80,490),"360p_9":yt(640,360,15,80,800),"360p_10":yt(640,360,24,80,800),"360p_11":yt(640,360,24,80,1e3),"480p":yt(640,480,15,100,500),"480p_1":yt(640,480,15,100,500),"480p_2":yt(640,480,30,100,1e3),"480p_3":yt(480,480,15,100,400),"480p_4":yt(640,480,30,100,750),"480p_6":yt(480,480,30,100,600),"480p_8":yt(848,480,15,100,610),"480p_9":yt(848,480,30,100,930),"480p_10":yt(640,480,10,100,400),"720p":yt(1280,720,15,120,1130),"720p_auto":yt(1280,720,30,900,3e3),"720p_1":yt(1280,720,15,120,1130),"720p_2":yt(1280,720,30,120,2e3),"720p_3":yt(1280,720,30,120,1710),"720p_5":yt(960,720,15,120,910),"720p_6":yt(960,720,30,120,1380),"1080p":yt(1920,1080,15,120,2080),"1080p_1":yt(1920,1080,15,120,2080),"1080p_2":yt(1920,1080,30,120,3e3),"1080p_3":yt(1920,1080,30,120,3150),"1080p_5":yt(1920,1080,60,120,4780),"1440p":yt(2560,1440,30,120,4850),"1440p_1":yt(2560,1440,30,120,4850),"1440p_2":yt(2560,1440,60,120,7350),"4k":yt(3840,2160,30,120,8910),"4k_1":yt(3840,2160,30,120,8910),"4k_3":yt(3840,2160,60,120,13500)},Qke={"480p":da(640,480,5),"480p_1":da(640,480,5),"480p_2":da(640,480,30),"480p_3":da(640,480,15),"720p":da(1280,720,5),"720p_auto":yt(1280,720,30,900,3e3),"720p_1":da(1280,720,5),"720p_2":da(1280,720,30),"720p_3":da(1280,720,15),"1080p":da(1920,1080,5),"1080p_1":da(1920,1080,5),"1080p_2":da(1920,1080,30),"1080p_3":da(1920,1080,15)},Zke={"1SL1TL":kC(1,1),"3SL3TL":kC(3,3),"2SL3TL":kC(2,3)};function td(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},Xke[e]):e}function LC(e){return typeof e=="string"?Object.assign({},Qke[e]):e}function Sy(e){return typeof e=="string"?Object.assign({},Zke[e]):e}const eLe={speech_low_quality:lp(16e3,!1),speech_standard:lp(32e3,!1,18),music_standard:lp(48e3,!1),standard_stereo:lp(48e3,!0,56),high_quality:lp(48e3,!1,128),high_quality_stereo:lp(48e3,!0,192)};function bS(e){return typeof e=="string"?Object.assign({},eLe[e]):e}const Sp=[];function E9(e){return rn(e,"mediaSource",["screen","window","application"]),!0}let be=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),ir=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),$m=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),tLe=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),rLe=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),nf=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),I0=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),hm=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),O0=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),eo=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const gN={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},_N={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},vJ={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},nLe={uplinkNetworkQuality:0,downlinkNetworkQuality:0},yJ={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Ii=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),uo=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),mg=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),Wh=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),ui=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),kc=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const xC={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let Ub=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function bt(e,t,r,n,i){var s,o,a={};return Object.keys(n).forEach(function(c){a[c]=n[c]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=yc(s=B3e(o=r.slice()).call(o)).call(s,function(c,d){return d(e,t,c)||c},a),i&&a.initializer!==void 0&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),a.initializer===void 0&&(Object.defineProperty(e,t,a),a=null),a}function se(e,t,r){return(t=function(n){var i=function(s,o){if(typeof s!="object"||!s)return s;var a=s[Symbol.toPrimitive];if(a!==void 0){var c=a.call(s,"string");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(n);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function v9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function yr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?v9(Object(r),!0).forEach(function(n){se(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v9(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}class bJ extends Cr{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(nf.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,r){super(),se(this,"trackMediaType",void 0),se(this,"_ID",void 0),se(this,"_rtpTransceiver",void 0),se(this,"_lowRtpTransceiver",void 0),se(this,"_hints",[]),se(this,"_isClosed",!1),se(this,"_originMediaStreamTrack",void 0),se(this,"mediaStreamTrack",void 0),se(this,"_external",{}),this._ID=r||ar(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(n){Ee(Sp).call(Sp,n)||Sp.push(n)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||zu(()=>{var r;Ce.reportApiInvoke(null,{name:Zr.GET_MEDIA_STREAM_TRACK,options:[],tag:Or.TRACER}).onSuccess(((r=this._mediaStreamTrack)===null||r===void 0?void 0:r.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===$m.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const r=Sp.indexOf(t);r!==-1&&Sp.splice(r,1)}(this),this.emit(I0.CLOSED),this.removeAllListeners(nf.SEI_RECEIVED)}_updateRtpTransceiver(t,r){if(r===$m.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(nf.TRANSCEIVER_UPDATED,t,r)}}class Jp extends bJ{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,r){super(t,r),se(this,"_enabled",!0),se(this,"_muted",!1),se(this,"_isExternalTrack",!1),se(this,"_isClosed",!1),se(this,"_enabledMutex",void 0),se(this,"processor",void 0),se(this,"_processorContext",void 0),se(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Jn("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,r;return(t=(r=this._originMediaStreamTrack)===null||r===void 0?void 0:r.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,C.debug("[".concat(this.getTrackId(),"] close")),this.emit(be.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,r){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=n,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await er(this,be.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){C.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(I0.TRACK_ENDED)}stateCheck(t,r){if(C.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(r,"]")),dl(r,t),this._enabled&&this._muted&&t==="enabled"&&r===!1)throw new ie($.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",C);if(!this._enabled&&!this._muted&&t==="muted"&&r===!0)throw new ie($.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",C)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():_e.resolve([])}}const y9=window.AudioContext||window.webkitAudioContext;let zs=null;const Ht=new class extends Cr{constructor(){super(...arguments),se(this,"prevState",void 0),se(this,"curState",void 0),se(this,"currentTime",void 0),se(this,"currentTimeStuckAt",void 0),se(this,"interruptDetectorTrack",void 0),se(this,"onLocalAudioTrackMute",()=>{C.info("ios15-interruption-start"),this.emit(Rn.IOS_15_16_INTERRUPTION_START)}),se(this,"onLocalAudioTrackUnmute",async()=>{C.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?C.info("ios15-interruption-end-canceled"):(zs&&await zs.suspend(),this.emit(Rn.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){C.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){C.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function N0(){if(!zs){if(function(){if(!y9)return void C.error("your browser is not support web audio");C.info("create audio context");const e=yr({},W("WEBAUDIO_INIT_OPTIONS"));C.debug("audio context init option:",JSON.stringify(e)),zs=new y9(e),Ht.curState=zs.state,zs.onstatechange=()=>{Ht.prevState=Ht.curState,Ht.curState=zs?zs.state:void 0;const{prevState:t,curState:r}=Ht,n=r==="running",i=r==="interrupted",s=t==="running",o=t==="suspended",a=t==="interrupted",c=Rt().osVersion;(Ci()||Da())&&s&&i&&(C.info("ios".concat(c,"-interruption-start")),Ht.emit(Rn.IOS_INTERRUPTION_START)),(Ci()||Da())&&(o||a)&&n&&(C.info("ios".concat(c,"-interruption-end")),Ht.emit(Rn.IOS_INTERRUPTION_END)),t!==r&&Ht.emit(Rn.STATE_CHANGE,r,t)},setInterval(()=>{var t;const r=(t=zs)===null||t===void 0?void 0:t.currentTime;Ht.currentTime!==r?(Ht.currentTimeStuckAt&&(C.debug("AudioContext current time resume at ".concat(r)),Ht.currentTimeStuckAt=void 0),Ht.currentTime=r):(r!==Ht.currentTimeStuckAt&&(Ce.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:r},tag:Or.TRACER}).onSuccess(),C.warning("AudioContext current time stuck at ".concat(r))),Ht.currentTimeStuckAt=r)},5e3),async function(t){const r=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let n,i=!1,s=!1,o=!1;function a(g){t.state==="running"?c(!1):Ci()||Da()?t.state==="suspended"&&(c(!0),g&&t.resume().then(d,d)):t.state!=="closed"&&(c(!0),g&&t.resume().then(d,d))}function c(g){if(i!==g){i=g;for(let E=0,b=r;E<b.length;E+=1){const v=b[E];g?window.addEventListener(v,l,{capture:!0,passive:!0}):window.removeEventListener(v,l,{capture:!0,passive:!0})}}}function d(){a(!1)}function l(){a(!0)}function u(g){if(!o)if(n.paused)if(g){let E;h(!1),o=!0;try{E=n.play(),E?E.then(p,p):(n.addEventListener("playing",p),n.addEventListener("abort",p),n.addEventListener("error",p))}catch{p()}}else h(!0);else h(!1)}function h(g){if(s!==g){s=g;for(let E=0,b=r;E<b.length;E++){const v=b[E];g?window.addEventListener(v,_,{capture:!0,passive:!0}):window.removeEventListener(v,_,{capture:!0,passive:!0})}}}function p(){n.removeEventListener("playing",p),n.removeEventListener("abort",p),n.removeEventListener("error",p),o=!1,u(!1)}function _(){u(!0)}if(Ci()){const g=t.createMediaStreamDestination(),E=document.createElement("div");E.innerHTML="<audio x-webkit-airplay='deny'></audio>",n=E.children.item(0),n.controls=!1,n.disableRemotePlayback=!0,n.preload="auto",n.srcObject=g.stream,u(!0)}Ht.on(Rn.STATE_CHANGE,function(){a(!0)}),a(!1)}(zs)}(),!zs)throw new ie($.NOT_SUPPORTED,"can not create audio context");return zs}return zs}function Th(e){if(function(){if(MC!==null)return MC;const n=N0(),i=n.createBufferSource(),s=n.createGain(),o=n.createGain();i.connect(s),i.connect(o),i.disconnect(s);let a=!1;try{i.disconnect(s)}catch{a=!0}return i.disconnect(),MC=a,a}())return;const t=e.connect,r=e.disconnect;e.connect=(n,i,s)=>{var o;return e._inputNodes||(e._inputNodes=[]),Ee(o=e._inputNodes).call(o,n)||(n instanceof AudioNode?(e._inputNodes.push(n),t.call(e,n,i,s)):t.call(e,n,i)),e},e.disconnect=(n,i,s)=>{r.call(e),n?vS(e._inputNodes,n):e._inputNodes=[];for(const o of e._inputNodes)t.call(e,o)}}let MC=null;function D3(e,t){let r=!1;const n=1/t;if(W("DISABLE_WEBAUDIO")){const i=window.setInterval(()=>{r?window.clearInterval(i):e(performance.now()/1e3)},1e3*n)}else{const i=N0();let s=i.createGain();s.gain.value=0,s.connect(i.destination);const o=()=>{if(r)return void(s=null);const a=i.createOscillator();a.onended=o,a.connect(s),a.start(0),a.stop(i.currentTime+n),e(i.currentTime)};o()}return()=>{r=!0}}class SJ{constructor(){se(this,"context",void 0),se(this,"analyserNode",void 0),se(this,"sourceNode",void 0),this.context=N0(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Ci()||Da()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const n=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(n);for(let i=0;i<t.length;++i)t[i]=n[i]/128-1}const r=yc(t).call(t,(n,i)=>n+i*i,0)/t.length;return Math.max(10*Math.log10(r)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,r;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(r=this.sourceNode)===null||r===void 0||r.connect(this.analyserNode)}catch{C.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class wJ extends Cr{get processSourceNode(){return this.sourceNode}set processedNode(t){var r;if(!this.isDestroyed&&this._processedNode!==t){try{var n;(n=this.sourceNode)===null||n===void 0||n.disconnect(this.outputNode)}catch{}(r=this._processedNode)===null||r===void 0||r.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),se(this,"outputNode",void 0),se(this,"outputTrack",void 0),se(this,"isPlayed",!1),se(this,"sourceNode",void 0),se(this,"context",void 0),se(this,"audioBufferNode",void 0),se(this,"destNode",void 0),se(this,"audioOutputLevel",0),se(this,"volumeLevelAnalyser",void 0),se(this,"_processedNode",void 0),se(this,"playNode",void 0),se(this,"isDestroyed",!1),se(this,"onNoAudioInput",void 0),se(this,"isNoAudioInput",!1),se(this,"_noAudioInputCount",0),this.context=N0(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Th(this.outputNode),this.volumeLevelAnalyser=new SJ}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=r=>{this.emit(eo.ON_AUDIO_BUFFER,function(n){for(let i=0;i<n.outputBuffer.numberOfChannels;i+=1){const s=n.outputBuffer.getChannelData(i);for(let o=0;o<s.length;o+=1)s[o]=0}return n.inputBuffer}(r))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!At().webAudioMediaStreamDest)throw new ie($.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&cT(()=>{Ht.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Ci()||Da()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const r=this.volumeLevelAnalyser.getAnalyserNode();let n;r.getFloatTimeDomainData?(n=new Float32Array(r.fftSize),r.getFloatTimeDomainData(n)):(n=new Uint8Array(r.fftSize),r.getByteTimeDomainData(n));let i=!1;for(let s=0;s<n.length;s++)n[s]!==0&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await In(200),await this.checkHasAudioInput(t?t+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,r;(t=this.processedNode)===null||t===void 0||t.disconnect(),(r=this.sourceNode)===null||r===void 0||r.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class TJ extends wJ{get isFreeze(){return!1}constructor(t,r,n){var i;if(super(),se(this,"sourceNode",void 0),se(this,"track",void 0),se(this,"clonedTrack",void 0),se(this,"audioElement",void 0),se(this,"isCurrentTrackCloned",!1),se(this,"isRemoteTrack",!1),se(this,"originVolumeLevelAnalyser",void 0),se(this,"rebuildWebAudio",async()=>{if(C.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void C.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>C.info("resume success")),C.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const a=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?a.stop():this.isCurrentTrackCloned=!0;const c=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(c),Th(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const d=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(d,this.context.currentTime),Th(this.outputNode),this.emit(eo.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=c,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new ie($.UNEXPECTED_ERROR);this.track=t;const s=new MediaStream([this.track]);if(this.isRemoteTrack=!!r,this.sourceNode=this.context.createMediaStreamSource(s),Th(this.sourceNode),n){const a=n.clone();a.enabled=!0,this.clonedTrack=a,C.debug("create an unmuted track ".concat(a.id," from the original track ").concat(n.id," to get the volume"));const c=this.context.createMediaStreamSource(new MediaStream([a]));Th(c),this.originVolumeLevelAnalyser=new SJ,this.originVolumeLevelAnalyser.updateSource(c)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=s;const o=Rt();r&&o.os===pn.IOS&&Number((i=o.osVersion)===null||i===void 0?void 0:i.split(".")[0])<15&&(Ht.on(Rn.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(a=>{a||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const r=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(r),Th(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(eo.UPDATE_SOURCE),this.audioElement.srcObject=r}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Ht.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const r=t.clone();r.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=r),C.debug("create an unmuted track ".concat(r.id," from the original track ").concat(t.id," to get the volume"));const n=this.context.createMediaStreamSource(new MediaStream([r]));Th(n),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(n)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function RJ(e,t,r){const n=(s,o)=>s?typeof s!="number"?s.max||s.exact||s.ideal||s.min||o:s:o,i={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:n(t.height,1080),maxWidth:n(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function iLe(e,t){const r=await AJ(e.mediaSource),{sourceId:n,audio:i}=await function(s){let o=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new _e((a,c)=>{const d=document.createElement("div");d.innerText="share screen",d.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const l=document.createElement("div");l.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const u=document.createElement("div");u.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",u.setAttribute("style","height: 12%;");const h=document.createElement("div");h.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const p=document.createElement("div");p.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const _=document.createElement("button");_.innerHTML="cancel",_.setAttribute("style","width: 85px;"),_.onclick=()=>{document.body.removeChild(b);const v=new Error("NotAllowedError");v.name="NotAllowedError",c(v)};let g=o;const E=document.createElement("div");if(o){const v=document.createElement("input");v.setAttribute("type","checkbox");const I=document.createElement("span");v.setAttribute("style","margin-right: 6px;"),I.innerText="Share audio",v.checked=g,v.onchange=()=>{g=v.checked},E.appendChild(v),E.appendChild(I)}p.appendChild(E),p.appendChild(_),l.appendChild(u),l.appendChild(h),l.appendChild(p);const b=document.createElement("div");b.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),b.appendChild(d),b.appendChild(l),document.body.appendChild(b),s.map(v=>{if(v.id){const I=document.createElement("div");I.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let N=v.thumbnail;try{const{width:L}=N.getSize();L>1920&&(N=N.resize({width:1920}))}catch(L){throw L&&L.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),L}I.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+N.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+v.name.replace(/[\u00A0-\u9999<>\&]/g,function(L){return"&#"+L.charCodeAt(0)+";"})+"</span>",I.onclick=()=>{document.body.removeChild(b),a({sourceId:v.id,audio:g})},h.appendChild(I)}})})}(r,t);return await RJ(n,e,i)}async function AJ(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const r=JY();if(!r)throw console.error("failed to fetch electron, please mount it to window"),new ie($.ELECTRON_IS_NULL);let n=null;try{var i;n=((i=r.desktopCapturer)===null||i===void 0?void 0:i.getSources({types:t}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{n=null}n&&n.then||(n=new _e((s,o)=>{r.desktopCapturer.getSources({types:t},(a,c)=>{a?o(a):s(c)})}));try{return await n}catch(s){throw new ie($.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,s.toString())}}const EN=new Jn("safari");let CJ=!1,IJ=!1;async function Xs(e,t){let r=0,n=null;for(;r<2;)try{n=await sLe(e,t,r>0);break}catch(i){if(i instanceof ie)throw C.error("[".concat(t,"] ").concat(i.toString())),i;const s=jb(i.name||i.code||i,i.message);if(s.code===$.MEDIA_OPTION_INVALID){C.debug("[".concat(t,"] detect media option invalid, retry")),r+=1,await In(500);continue}throw C.error("[".concat(t,"] ").concat(s.toString())),s}if(!n)throw new ie($.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return n}async function sLe(e,t,r){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new ie($.NOT_SUPPORTED,"can not find getUserMedia");r&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const n=At(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return C.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(JY())e.screen.sourceId?up(i,await RJ(e.screen.sourceId,e.screen,e.screenAudio)):up(i,await iLe(e.screen,e.screenAudio));else if(Iu()&&e.screen.extensionId&&e.screen.mandatory){if(!n.getStreamFromExtension)throw new ie($.NOT_SUPPORTED,"This browser does not support screen sharing");C.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const h=await(o=e.screen.extensionId,a=t,new _e((p,_)=>{try{chrome.runtime.sendMessage(o,{getStream:!0},g=>{if(!g||!g.streamId)return C.error("[".concat(a,"] No response from Chrome Plugin. Plugin not installed properly"),g),void _(new ie($.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));p(g.streamId)})}catch(g){C.error("[".concat(a,"] AgoraRTC screensharing plugin is not accessible(").concat(o,")"),g.toString()),_(new ie($.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=h,up(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(n.getDisplayMedia){var s;e.screen.mediaSource&&E9(e.screen.mediaSource);const h={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(s=e.screen.displaySurface)!==null&&s!==void 0?s:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:p,surfaceSwitching:_,systemAudio:g}=e.screen,E={selfBrowserSurface:p,surfaceSwitching:_,systemAudio:g};!p&&delete E.selfBrowserSurface,!_&&delete E.surfaceSwitching,!g&&delete E.systemAudio,C.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:h,audio:!!e.screenAudio,controls:E})),up(i,await navigator.mediaDevices.getDisplayMedia(yr({video:h,audio:!!e.screenAudio},E)))}else{if(!Dr())throw C.error("[".concat(t,"] This browser does not support screenSharing")),new ie($.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&E9(e.screen.mediaSource);const h={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};C.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(h))),up(i,await navigator.mediaDevices.getUserMedia(h))}}var o,a;if(!e.video&&!e.audio)return i;let c={video:e.video,audio:e.audio},d=W("MEDIA_DEVICE_CONSTRAINTS");if(d)try{typeof d=="string"&&(d=JSON.parse(d)),c=cN(c,d)}catch{}C.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(c)),Rt();let l,u=null;(Bn()||Ci()||ES())&&(u=await EN.lock());try{l=await navigator.mediaDevices.getUserMedia(c)}catch(h){throw u&&u(),h}return c.audio&&(CJ=!0),c.video&&(IJ=!0),up(i,l),u&&u(),i}function jb(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new ie($.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new ie($.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new ie($.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new ie($.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new ie($.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new ie($.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return C.error("getUserMedia unexpected error",e),new ie($.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function up(e,t){const r=e.getVideoTracks()[0],n=e.getAudioTracks()[0],i=t.getVideoTracks()[0],s=t.getAudioTracks()[0];s&&(n&&e.removeTrack(n),e.addTrack(s)),i&&(r&&e.removeTrack(r),e.addTrack(i))}const io=new class extends Cr{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Wh.STATE_CHANGE,e),this._state=e)}constructor(){super(),se(this,"_state",mg.IDLE),se(this,"isAccessMicrophonePermission",!1),se(this,"isAccessCameraPermission",!1),se(this,"lastAccessMicrophonePermission",!1),se(this,"lastAccessCameraPermission",!1),se(this,"checkdeviceMatched",!1),se(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(W("ENUMERATE_DEVICES_INTERVAL")||(oT()||sT()===pn.HARMONY_OS)&&Hu())&&this.updateDevicesInfo()},W("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>C.error(e.toString()))}async enumerateDevices(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new ie($.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const n=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(n);let s=!this.isAccessMicrophonePermission&&e,o=!this.isAccessCameraPermission&&t;i.audio&&(s=!1),i.video&&(o=!1);let a=null,c=null,d=null;if(!r&&(s||o)){if(EN.isLocked&&(C.debug("[device manager] wait GUM lock"),(await EN.lock())(),C.debug("[device manager] GUM unlock")),CJ&&(s=!1,this.isAccessMicrophonePermission=!0),IJ&&(o=!1,this.isAccessCameraPermission=!0),C.debug("[device manager] check media device permissions",e,t,s,o),s&&o){try{d=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(l){const u=jb(l.name||l.code||l,l.message);if(u.code===$.PERMISSION_DENIED)throw u;C.warning("getUserMedia failed in getDevices",u)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(s){try{a=await navigator.mediaDevices.getUserMedia({audio:e})}catch(l){const u=jb(l.name||l.code||l,l.message);if(u.code===$.PERMISSION_DENIED)throw u;C.warning("getUserMedia failed in getDevices",u)}this.isAccessMicrophonePermission=!0}else if(o){try{c=await navigator.mediaDevices.getUserMedia({video:t})}catch(l){const u=jb(l.name||l.code||l,l.message);if(u.code===$.PERMISSION_DENIED)throw u;C.warning("getUserMedia failed in getDevices",u)}this.isAccessCameraPermission=!0}C.debug("[device manager] mic permission",e,"cam permission",t)}try{const l=await navigator.mediaDevices.enumerateDevices();return a&&a.getTracks().forEach(u=>u.stop()),c&&c.getTracks().forEach(u=>u.stop()),d&&d.getTracks().forEach(u=>u.stop()),a=null,c=null,d=null,l}catch(l){return a&&a.getTracks().forEach(u=>u.stop()),c&&c.getTracks().forEach(u=>u.stop()),d&&d.getTracks().forEach(u=>u.stop()),a=null,c=null,d=null,new ie($.ENUMERATE_DEVICES_FAILED,l.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(r=>{r.device.label===e&&(t=r.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(r=>r.deviceId===e);if(!t)throw new ie($.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=mg.INITING;try{await this.updateDevicesInfo(),this.state=mg.INITEND}catch(e){throw C.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=mg.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new ie($.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),r=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const i=e.find(o=>o.kind==="audioinput"&&o.deviceId==="default"),s=e.find(o=>o.kind==="audiooutput"&&o.deviceId==="default");i&&s?s.groupId===i.groupId?C.debug("[device-check] default input ".concat(i.label," and output ").concat(s.label," is the same group")):C.warning("[device-check] default input ".concat(i.label," and output ").concat(s.label," is not the same group")):C.debug("[device-check] default input or output not found")}const n=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(i=>{if(!i.deviceId)return;const s=this.deviceInfoMap.get("".concat(i.kind,"_").concat(i.deviceId));if((s?s.state:"INACTIVE")!=="ACTIVE"){const o={initAt:t,updateAt:t,device:i,state:"ACTIVE"};this.deviceInfoMap.set("".concat(i.kind,"_").concat(i.deviceId),o),r.push(o)}s&&(s.updateAt=t)}),this.deviceInfoMap.forEach((i,s)=>{i.state==="ACTIVE"&&i.updateAt!==t&&(i.state="INACTIVE",r.push(i))}),this.state!==mg.INITEND)return n.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(n.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));r.forEach(i=>{switch(i.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Wh.RECORDING_DEVICE_CHANGED,i);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Wh.CAMERA_DEVICE_CHANGED,i);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Wh.PLAYOUT_DEVICE_CHANGED,i)}}),n.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),n.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(i=>i.kind==="audioinput"),r=e.filter(i=>i.kind==="videoinput"),n={audio:!1,video:!1};for(const i of t)if(i.label&&i.deviceId){n.audio=!0;break}for(const i of r)if(i.label&&i.deviceId){n.video=!0;break}return n}};let UC=!1;const qs=new class extends Cr{constructor(){super(...arguments),se(this,"onAutoplayFailed",void 0),se(this,"onAudioAutoplayFailed",void 0)}};function OJ(){if(Rt(),!UC){const e=t=>{t.preventDefault(),UC=!1,uE()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};UC=!0,uE()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),C.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),qs.onAutoplayFailed?qs.onAutoplayFailed():qs.onAudioAutoplayFailed?C.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):C.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),qs.emit("autoplay-failed")}}function NJ(e,t,r,n){if(!e)return;const i=Ce.getBaseInfoBySessionId(e);if(!i)return;const s=i.info,o=Date.now(),a=yr(yr({},s),{},{vid:s.vid===void 0?0:Number(s.vid),lts:o,elapse:o-i.startTime,cbRegistered:qs.onAutoplayFailed||qs.onAudioAutoplayFailed?1:-1,errorMsg:r,mediaType:t,trackId:n,extend:void 0});Ce.send({type:Rr.AUTOPLAY_FAILED,data:a},!0)}const oLe=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Fi=new class{constructor(){se(this,"onAutoplayFailed",void 0),se(this,"elementMap",new Map),se(this,"elementStateMap",new Map),se(this,"elementsNeedToResume",[]),se(this,"sinkIdMap",new Map),se(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,n]=t;const i=this.elementStateMap.get(r),s=n.srcObject.getAudioTracks()[0],o=s&&s.readyState;if(C.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(o," ").concat(e)),o==="live"){if(e)return n.pause(),void n.play();if(Ht.curState==="running")return jm()?(n.pause(),void n.play()):void(i&&i==="paused"&&n.play())}})}),se(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,r]=e;const n=r.srcObject.getAudioTracks()[0];n&&n.readyState==="live"&&(C.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r.pause(),r.play())})}),this.autoResumeAudioElement(),Ht.on(Rn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ht.on(Rn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Ht.on(Rn.STATE_CHANGE,()=>{Ci()&&Ht.prevState==="suspended"&&Ht.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const r=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),r)try{await r.setSinkId(t)}catch(n){throw new ie($.PERMISSION_DENIED,"can not set sink id: "+n.toString())}}play(e,t,r,n){if(this.elementMap.has(t))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,ui.INIT),this.setVolume(t,r);const s=this.sinkIdMap.get(t);if(s)try{i.setSinkId(s).catch(a=>{C.warning("[".concat(t,"] set sink id failed"),a.toString())})}catch(a){C.warning("[".concat(t,"] set sink id failed"),a.toString())}const o=i.play();o&&o.then&&o.catch(a=>{n&&NJ(n,"audio",a.message,t),C.warning("audio element play warning",a.toString()),this.elementMap.has(t)&&a.name==="NotAllowedError"&&(C.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),cT(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),OJ()}))})}updateTrack(e,t){const r=this.elementMap.get(e);r&&(r.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const r=this.elementMap.get(e);r&&(t=Math.max(0,Math.min(100,t)),r.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const r=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(r,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){oLe.forEach(r=>{t.addEventListener(r,n=>{const i=this.elementStateMap.get(e),s=n.type==="pause"?"paused":n.type;if(C.debug("[".concat(e,"] audio-element-status change ").concat(i," => ").concat(s)),n.type==="error"){const o=t==null?void 0:t.error;o&&C.error("[".concat(e,"] media error, code: ").concat(o.code,", message: ").concat(o.message))}this.elementStateMap.set(e,s)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(r=>{C.debug("Auto resume audio element success")}).catch(r=>{C.warning("Auto resume audio element failed!",r)})}),this.elementsNeedToResume=[]};new _e(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{uE()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Br(){return function(e,t,r){const n=r.value;return typeof n=="function"&&(r.value=function(){this._isClosed&&new ie($.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",C);for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];const a=n.apply(this,s);return a instanceof _e?new _e((c,d)=>{a.then(c).catch(d)}):a}),r}}class DJ extends Cr{constructor(t){super(),se(this,"name","VideoProcessorDestination"),se(this,"ID","0"),se(this,"_source",void 0),se(this,"videoContext",void 0),se(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new ie($.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new ie($.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(Ii.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Ii.ON_TRACK,void 0)}}class PJ extends Cr{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,r){super(),se(this,"constraintsMap",new Map),se(this,"statsRegistry",[]),se(this,"usageRegistry",[]),se(this,"trackId",void 0),se(this,"direction",void 0),se(this,"_chained",!1),this.trackId=t,this.direction=r}async getConstraints(){return await Vn(this,uo.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,r){var n;return C.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(r,t),er(this,uo.REQUEST_UPDATE_CONSTRAINTS,Array.from(_l(n=this.constraintsMap).call(n)))}async requestRevertConstraints(t){var r;if(this.constraintsMap.has(t))return C.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),er(this,uo.REQUEST_UPDATE_CONSTRAINTS,Array.from(_l(r=this.constraintsMap).call(r)))}registerStats(t,r,n){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===r)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:r,cb:n})}unregisterStats(t,r){const n=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===r);n!==-1&&this.statsRegistry.splice(n,1)}gatherStats(){const t=[];for(const{processorID:r,processorName:n,type:i,cb:s}of this.statsRegistry)try{const o=s();t.push({processorID:r,processorName:n,type:i,stats:o})}catch(o){C.error(new ie($.UNEXPECTED_ERROR,o.message))}return t}registerUsage(t,r){this.usageRegistry.find(n=>n.processorID===t.ID&&n.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:r})}unregisterUsage(t){const r=this.usageRegistry.findIndex(n=>n.processorID===t.ID&&n.processorName===t.name);r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:r}of this.usageRegistry)try{let n=r();n instanceof _e&&(n=await n),t.push(yr(yr({},n),{},{direction:this.direction}))}catch(n){C.error("gather extension usage error",n)}return t}getDirection(){return this.direction}}class kJ extends Cr{constructor(t){super(),se(this,"name","AudioProcessorDestination"),se(this,"ID","0"),se(this,"inputTrack",void 0),se(this,"inputNode",void 0),se(this,"audioProcessorContext",void 0),se(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new ie($.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new ie($.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Ii.ON_TRACK,void 0),this.emit(Ii.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(Ii.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(Ii.ON_NODE,this.inputNode))}}class LJ extends Cr{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,r,n){super(),se(this,"constraintsMap",new Map),se(this,"statsRegistry",[]),se(this,"audioContext",void 0),se(this,"trackId",void 0),se(this,"direction",void 0),se(this,"usageRegistry",[]),se(this,"_chained",!1),this.audioContext=t,this.trackId=r,this.direction=n}async getConstraints(){return Vn(this,uo.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,r){var n;return C.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(r,t),er(this,uo.REQUEST_UPDATE_CONSTRAINTS,Array.from(_l(n=this.constraintsMap).call(n)))}async requestRevertConstraints(t){var r;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),er(this,uo.REQUEST_UPDATE_CONSTRAINTS,Array.from(_l(r=this.constraintsMap).call(r)))}registerStats(t,r,n){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===r)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:r,cb:n})}unregisterStats(t,r){const n=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===r);n!==-1&&this.statsRegistry.splice(n,1)}gatherStats(){const t=[];for(const{processorID:r,processorName:n,type:i,cb:s}of this.statsRegistry)try{const o=s();t.push({processorID:r,processorName:n,type:i,stats:o})}catch(o){C.error(new ie($.UNEXPECTED_ERROR,o.message))}return t}registerUsage(t,r){this.usageRegistry.find(n=>n.processorID===t.ID&&n.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:r})}unregisterUsage(t){const r=this.usageRegistry.findIndex(n=>n.processorID===t.ID&&n.processorName===t.name);r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:r}of this.usageRegistry)try{let n=r();n instanceof _e&&(n=await n),t.push(yr(yr({},n),{},{direction:this.direction}))}catch(n){C.error("gather extension usage error",n)}return t}getDirection(){return this.direction}}class vN extends Cr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),se(this,"context",void 0),se(this,"processSourceNode",void 0),se(this,"outputTrack",void 0),se(this,"processedNode",void 0),se(this,"clonedTrack",void 0),se(this,"outputNode",void 0),this.outputNode=new aLe}setVolume(){}createOutputTrack(){throw new ie($.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class aLe{disconnect(){}connect(){}}function xJ(e){return new _e((t,r)=>{let n=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const s=Ci()?"canplay":"playing";i.addEventListener(s,()=>{const o=i.videoWidth,a=i.videoHeight;!o&&Dr()||(n=!0,i.srcObject=null,i.remove(),t([o,a]))}),i.srcObject=new MediaStream([e]),i.play().catch(dT),setTimeout(()=>{n||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))},4e3)})}function SS(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const r=td(e.encoderConfig);return r.width!=null&&(t.width=r.width),r.height!=null&&(t.height=r.height),!qY()&&r.frameRate&&(t.frameRate=r.frameRate),VY()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Dr()&&(t.frameRate={ideal:30,max:30}),t}function b9(e){const t={};if(qY()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,Iu()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){const r=bS(e.encoderConfig);t.channelCount=r.stereo?2:1,t.sampleRate=r.sampleRate,t.sampleSize=r.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),oT()&&(t.sampleRate=void 0),t}const cLe=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:r,width:n,height:i}=e.getMediaStreamTrackSettings();let{frameRate:s=r,width:o=n,height:a=i}=t;if(!s||!o||!a)return;o=oC(o),a=oC(a),s=oC(s);const{max:c,min:d}=function(p,_,g){const E=200*Math.pow(g/15,.6)*Math.pow(p*_/640/360,.75);return{min:Math.floor(E),max:Math.floor(4*E)}}(o,a,s),{bitrateMax:l,bitrateMin:u}=t||{};l||C.debug("calculate bitrate: [w: ".concat(o,", h: ").concat(a,", fps: ").concat(s,"] => [brMax: ").concat(l,", brMin: ").concat(u,"]"));const{maxFramerate:h}=W("ENCODER_CONFIG_LIMIT");return h&&typeof h=="number"&&(s=Math.min(s,h)),{frameRate:s,bitrateMax:l||c,bitrateMin:u||d,scaleResolutionDownBy:1,scale:0}},MJ=async(e,t,r)=>await(async(n,i,s)=>{const o=function(d){const l=[];for(let u=0;u<d.length;u+=2)l.push(parseInt(d.slice(u,u+2),16));return Uint8Array.from(l)}(eJ(""+i+s)).slice(0,16),a=o.slice(0,12),c=await window.crypto.subtle.importKey("raw",o,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a},c,n))})(e.buffer,t,r),P3=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new _e((r,n)=>{t.toBlob(async i=>{if(t.remove(),i){const s=await UJ(i);r({buffer:s,width:t.width,height:t.height})}else n(new ie($.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},UJ=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var S9,w9,T9,R9,A9,C9,I9,O9,N9,D9,P9,k9,L9,x9,M9,U9,j9,F9,Sr,B9,V9,$9,H9,z9,W9,Lc,G9,q9,K9,Y9,J9,X9,Q9,Z9,e7,t7,r7,n7,i7,Pn;let Ir=(S9=je({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),w9=je({argsMap:(e,t)=>[e.getTrackId(),t]}),T9=Br(),R9=Fm("LocalAudioTrack","_enabledMutex"),A9=je({argsMap:(e,t)=>[e.getTrackId(),t]}),C9=Br(),I9=Fm("LocalAudioTrack","_enabledMutex"),O9=je({argsMap:(e,t)=>[e.getTrackId(),t]}),N9=Br(),D9=Br(),P9=Br(),k9=je({argsMap:e=>[e.getTrackId()]}),L9=Br(),x9=je({argsMap:e=>[e.getTrackId()]}),M9=Br(),U9=je({argsMap:e=>[e.getTrackId()]}),j9=je({argsMap:(e,t)=>[e.getTrackId(),t.name]}),F9=je({argsMap:e=>[e.getTrackId()]}),bt((Sr=class extends Jp{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Fi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,r,n){super(e,r),se(this,"trackMediaType",O0.AUDIO),se(this,"_encoderConfig",void 0),se(this,"_trackSource",void 0),se(this,"_enabled",!0),se(this,"_volume",100),se(this,"_useAudioElement",!0),se(this,"_bypassWebAudio",!1),se(this,"processor",void 0),se(this,"_processorContext",void 0),se(this,"_processorDestination",void 0),se(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!n,this._trackSource=new vN,W("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),W("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Bn()&&!zs?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){qt(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Fi.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void C.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,er(this,be.NEED_REPLACE_TRACK,this).then(()=>{C.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(r=>{C.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),r)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!EJ())throw new ie($.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Fi.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,r){return this._setEnabled(e,t,r)}async _setEnabled(e,t,r){if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(C.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{r||(this._enabled=!0),await er(this,be.NEED_ENABLE_TRACK,this),C.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(n){throw r||(this._enabled=!1),C.error("[".concat(this.getTrackId(),"] setEnabled to true error"),n.toString()),n}}else{this._originMediaStreamTrack.enabled=!1,r||(this._enabled=!1);try{await er(this,be.NEED_DISABLE_TRACK,this)}catch(n){throw r||(this._enabled=!0),C.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,C.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await er(this,be.NEED_MUTE_TRACK,this):await er(this,be.NEED_UNMUTE_TRACK,this))}getStats(){return zu(()=>{C.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Lo(this,be.GET_STATS)||yr({},gN)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(eo.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(eo.ON_AUDIO_BUFFER),this._source.on(eo.ON_AUDIO_BUFFER,r=>e(r))}play(){C.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(C.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Fi.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){C.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Fi.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];C.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Fi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await er(this,be.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return _e.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new ie($.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new ie($.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(Ii.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await er(this,be.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await er(this,be.NEED_REPLACE_TRACK,this))}),e.on(Ii.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(Ii.ON_TRACK),e.removeAllListeners(Ii.ON_NODE)}bindProcessorContextEvents(e){e.on(uo.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(uo.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof vN&&(this._trackSource=new TJ(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new LJ(this._source.context,this.getTrackId(),"local"),t=new kJ(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(eo.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Fi.stop(this.getTrackId()),this._source.play()),er(this,be.NEED_REPLACE_MIXING_TRACK,this).then(()=>{C.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(r=>{C.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),r)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[S9],Object.getOwnPropertyDescriptor(Sr.prototype,"setVolume"),Sr.prototype),bt(Sr.prototype,"setPlaybackDevice",[w9,T9],Object.getOwnPropertyDescriptor(Sr.prototype,"setPlaybackDevice"),Sr.prototype),bt(Sr.prototype,"setEnabled",[R9,A9,C9],Object.getOwnPropertyDescriptor(Sr.prototype,"setEnabled"),Sr.prototype),bt(Sr.prototype,"setMuted",[I9,O9,N9],Object.getOwnPropertyDescriptor(Sr.prototype,"setMuted"),Sr.prototype),bt(Sr.prototype,"getStats",[D9],Object.getOwnPropertyDescriptor(Sr.prototype,"getStats"),Sr.prototype),bt(Sr.prototype,"setAudioFrameCallback",[P9],Object.getOwnPropertyDescriptor(Sr.prototype,"setAudioFrameCallback"),Sr.prototype),bt(Sr.prototype,"play",[k9,L9],Object.getOwnPropertyDescriptor(Sr.prototype,"play"),Sr.prototype),bt(Sr.prototype,"stop",[x9,M9],Object.getOwnPropertyDescriptor(Sr.prototype,"stop"),Sr.prototype),bt(Sr.prototype,"close",[U9],Object.getOwnPropertyDescriptor(Sr.prototype,"close"),Sr.prototype),bt(Sr.prototype,"pipe",[j9],Object.getOwnPropertyDescriptor(Sr.prototype,"pipe"),Sr.prototype),bt(Sr.prototype,"unpipe",[F9],Object.getOwnPropertyDescriptor(Sr.prototype,"unpipe"),Sr.prototype),Sr),wS=(B9=je({argsMap:(e,t)=>[e.getTrackId(),t]}),V9=Br(),$9=Fm("MicrophoneAudioTrack","_enabledMutex"),H9=je({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),z9=Br(),W9=je({argsMap:e=>[e.getTrackId()]}),bt((Lc=class extends Ir{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,r,n){super(e,t.encoderConfig?bS(t.encoderConfig):{},n,W("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),se(this,"_config",void 0),se(this,"_deviceName","default"),se(this,"_constraints",void 0),se(this,"_originalConstraints",void 0),se(this,"_enabled",!0),this._config=t,this._constraints=r,this._originalConstraints=r,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(jm()||sN())&&Ht.bindInterruptDetectorTrack(this)}async setDevice(e){if(C.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await io.getDeviceById(e),r={};r.audio=yr({},this._constraints),r.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let n=null;try{n=await Xs(r,this.getTrackId())}catch(i){throw C.error("[".concat(this.getTrackId(),"] setDevice failed"),i.toString()),n=await Xs({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n.getAudioTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(n.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw C.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await io.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw C.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}C.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,r){if(t)return C.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(C.info("[".concat(this.getTrackId(),"] start setEnabled"),e),W("AUTO_RESET_AUDIO_ROUTE")&&(Ci()||Da())){const o=navigator.audioSession;o&&(e||(o.type="playback"),o.type="auto")}if(!e){var n;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(n=this._source.clonedTrack)===null||n===void 0||n.stop(),r||(this._enabled=!1);try{await er(this,be.NEED_DISABLE_TRACK,this)}catch(o){throw C.error("[".concat(this.getTrackId(),"] setEnabled false failed"),o.toString()),o}return}const i=yr({},this._constraints),s=io.searchDeviceIdByName(this._deviceName);s&&!i.deviceId&&(i.deviceId=s);try{r||(this._enabled=!0);const o=await Xs({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),await er(this,be.NEED_ENABLE_TRACK,this)}catch(o){throw r||(this._enabled=!1),C.error("[".concat(this.getTrackId(),"] setEnabled true failed"),o.toString()),o}C.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(jm()||sN())&&Ht.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Ci()||Da())&&this._enabled&&!this._isClosed&&Ht.duringInterruption){const e=async()=>{Ht.off(Rn.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(C.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Ht.on(Rn.IOS_INTERRUPTION_END,e)}else C.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(I0.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,r=io.searchDeviceIdByName(this._deviceName);if(r&&!t.deviceId&&(t.deviceId=r),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const n=await Xs({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(n.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(uo.REQUEST_UPDATE_CONSTRAINTS,async(t,r,n)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),r()}catch(i){n(i)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(uo.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[B9,V9],Object.getOwnPropertyDescriptor(Lc.prototype,"setDevice"),Lc.prototype),bt(Lc.prototype,"setEnabled",[$9,H9,z9],Object.getOwnPropertyDescriptor(Lc.prototype,"setEnabled"),Lc.prototype),bt(Lc.prototype,"close",[W9],Object.getOwnPropertyDescriptor(Lc.prototype,"close"),Lc.prototype),Lc),dLe=(G9=je({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),q9=Br(),K9=je({argsMap:e=>[e.getTrackId()]}),Y9=Br(),J9=je({argsMap:e=>[e.getTrackId()]}),X9=Br(),Q9=je({argsMap:e=>[e.getTrackId()]}),Z9=Br(),e7=je({argsMap:e=>[e.getTrackId()]}),t7=Br(),r7=je({argsMap:e=>[e.getTrackId()]}),n7=je({argsMap:e=>[e.getTrackId()]}),i7=Br(),bt((Pn=class extends Ir{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,r,n){super(t.createOutputTrack(),r,n),se(this,"source",void 0),se(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(eo.AUDIO_SOURCE_STATE_CHANGE,i=>{this.safeEmit(I0.SOURCE_STATE_CHANGE,i)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){qt(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[G9,q9],Object.getOwnPropertyDescriptor(Pn.prototype,"startProcessAudioBuffer"),Pn.prototype),bt(Pn.prototype,"pauseProcessAudioBuffer",[K9,Y9],Object.getOwnPropertyDescriptor(Pn.prototype,"pauseProcessAudioBuffer"),Pn.prototype),bt(Pn.prototype,"seekAudioBuffer",[J9,X9],Object.getOwnPropertyDescriptor(Pn.prototype,"seekAudioBuffer"),Pn.prototype),bt(Pn.prototype,"resumeProcessAudioBuffer",[Q9,Z9],Object.getOwnPropertyDescriptor(Pn.prototype,"resumeProcessAudioBuffer"),Pn.prototype),bt(Pn.prototype,"stopProcessAudioBuffer",[e7,t7],Object.getOwnPropertyDescriptor(Pn.prototype,"stopProcessAudioBuffer"),Pn.prototype),bt(Pn.prototype,"close",[r7],Object.getOwnPropertyDescriptor(Pn.prototype,"close"),Pn.prototype),bt(Pn.prototype,"setAudioBufferPlaybackSpeed",[n7,i7],Object.getOwnPropertyDescriptor(Pn.prototype,"setAudioBufferPlaybackSpeed"),Pn.prototype),Pn);class Qr extends Ir{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=N0().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,ar(8,"track-mix-")),se(this,"trackList",void 0),se(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(C.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):C.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){C.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}vS(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(r=>{r._encoderConfig&&((r._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=r._encoderConfig.bitrate),(r._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=r._encoderConfig.sampleRate),(r._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=r._encoderConfig.sampleSize),r._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(r=>{r instanceof Qr?r.emit(nf.TRANSCEIVER_UPDATED,t):r._updateRtpTransceiver(t)}))}}class lLe extends wJ{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(eo.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),se(this,"audioBuffer",void 0),se(this,"sourceNode",void 0),se(this,"startPlayTime",0),se(this,"startPlayOffset",0),se(this,"pausePlayTime",0),se(this,"options",void 0),se(this,"currentLoopCount",0),se(this,"currentPlaybackSpeed",100),se(this,"_currentState","stopped"),this.audioBuffer=t,this.options=r,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):C.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const s7=new Map;class k3{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const t=this.renderStats.curTs-this.renderStats.lastTs,r=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/t;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,r}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(C.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var r;t!==this._videoState&&(this._videoState=t,(r=this.onVideoStateChanged)===null||r===void 0||r.call(this,this.videoState))}constructor(t){se(this,"trackId",void 0),se(this,"config",void 0),se(this,"onFirstVideoFrameDecoded",void 0),se(this,"onVideoStateChanged",void 0),se(this,"freezeTimeCounterList",[]),se(this,"renderFreezeAccTime",0),se(this,"isKeepLastFrame",!1),se(this,"timeUpdatedCount",0),se(this,"freezeTime",0),se(this,"playbackTime",0),se(this,"lastTimeUpdatedTime",0),se(this,"autoplayFailed",!1),se(this,"videoTrack",void 0),se(this,"videoElement",void 0),se(this,"cacheVideoElement",void 0),se(this,"renderStats",void 0),se(this,"_videoState",kc.VideoStateStopped),se(this,"videoElementCheckInterval",void 0),se(this,"videoElementFreezeTimeout",void 0),se(this,"_videoElementStatus",ui.NONE),se(this,"isGettingVideoDimensions",!1),se(this,"startGetVideoDimensions",()=>{const r=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return C.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(r,500)};!this.isGettingVideoDimensions&&r()}),se(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Ht.curState==="running"&&(C.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(uU())),mU()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),se(this,"handleVideoEvents",r=>{switch(r.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=ui.PLAYING;break;case"loadeddata":if(this.videoState=kc.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=ui.CANPLAY;break;case"stalled":this.videoElementStatus=ui.STALLED;break;case"suspend":this.videoElementStatus=ui.SUSPEND;break;case"pause":this.videoElementStatus=ui.PAUSED,Ci()||Da()||Bn()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(C.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=ui.WAITING;break;case"abort":this.videoElementStatus=ui.ABORT;break;case"ended":this.videoElementStatus=ui.ENDED;break;case"emptied":this.videoElementStatus=ui.EMPTIED;break;case"error":{const n=this.videoElement.error,i=n?"".concat(n.message," (").concat(n.code,")"):"";n&&(this.videoElementStatus=ui.ERROR),C.error("[".concat(this.trackId,"] media error: ").concat(i," "));break}case"timeupdate":{const n=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=n);const i=n-this.lastTimeUpdatedTime,s=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=n,Qd.lastVisibleTime<Qd.lastHiddenTime||s<Qd.lastHiddenTime||s<Qd.lastVisibleTime)return;for(i>W("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=i),this.playbackTime+=i;this.playbackTime>=6e3;){this.playbackTime-=6e3;const o=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(o),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),se(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(C.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(uU())),mU()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Ht.on(Rn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ht.on(Rn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const r=this.videoElement.play();r&&r.catch&&r.catch(i=>{t&&NJ(t,"video",i.message,this.trackId),i.name==="NotAllowedError"?(C.warning("detected video element autoplay failed",i),this.autoplayFailed=!0,this.handleAutoPlayFailed()):C.warning("[".concat(this.trackId,"] play warning: "),i)});const n=Rt();if((n.name==="Safari"&&Number(n.version)===15||jm())&&r&&r.then){const i=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};r.then(i).catch(i)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const r=t.getContext("2d");if(!r)return C.error("create canvas context failed!"),new ImageData(2,2);r.drawImage(this.videoElement,0,0,t.width,t.height);const n=r.getImageData(0,0,t.width,t.height);return t.remove(),n}async getCurrentFrameToUint8Array(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const i=n.getContext("2d");return i?(i.drawImage(this.videoElement,0,0,n.width,n.height),new _e((s,o)=>{n.toBlob(async a=>{if(n.remove(),a){const c=await UJ(a);s({buffer:c,width:n.width,height:n.height})}else o(new ie($.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,r<0?.1:r>1?1:r)})):await P3(t)}destroy(){this.renderStats=void 0,Ht.off(Rn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ht.off(Rn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=kc.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=ui.INIT,!this.videoElementCheckInterval&&(o7.forEach(s=>{this.videoElement.addEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(s){return s!==document.body&&document.body.contains(s)})(this.videoElement)||(this.videoElementStatus=ui.DESTROYED)},1e3),W("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,r;let s;const o=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",o),this.videoElementFreezeTimeout=window.setTimeout(a,W("VIDEO_FREEZE_DURATION")))},a=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===kc.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=kc.VideoStateFrozen:document.addEventListener("visibilitychange",o))},c=(d,l)=>{if(this.videoElementStatus===ui.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=l.mediaTime):this.renderStats={lastTs:l.mediaTime,curTs:l.mediaTime,lastRenderNum:0,renderNum:0},s){const p=l.presentationTime-s.presentationTime;this.videoState===kc.VideoStateStarting&&(this.videoState=kc.VideoStateDecoding),this.videoState===kc.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(a,W("VIDEO_FREEZE_DURATION"))),p<W("VIDEO_FREEZE_DURATION")&&this.videoState===kc.VideoStateFrozen&&(this.videoState=kc.VideoStateDecoding),p>W("VIDEO_FREEZE_DURATION")&&Qd.lastVisibleTime>=Qd.lastHiddenTime&&s.timestamp>Qd.lastVisibleTime&&s.timestamp>Qd.lastHiddenTime&&(this.renderFreezeAccTime+=p)}s=yr(yr({},l),{},{timestamp:d})}var u,h;W("ENABLE_VIDEO_FRAME_CALLBACK")&&((u=(h=this.videoElement).requestVideoFrameCallback)===null||u===void 0||u.call(h,c))};(t=(r=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(r,c)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),oT()&&!W("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const n=Rt();n.name==="Safari"&&Number(n.version)===15||jm()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Dr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Dr()&&this.videoElement.load());const i=this.videoElement.play();i!==void 0&&i.catch(s=>{C.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())})}resetVideoElement(){o7.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=ui.NONE}handleAutoPlayFailed(){const t=r=>{r.preventDefault(),this.videoElement.play().then(()=>{C.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(n=>{C.error(n)}),this.autoplayFailed=!1,uE()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};uE()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),OJ()}}const o7=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class jJ extends k3{constructor(t){super(t),se(this,"container",void 0),se(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const r=t.element;r!==this.slot&&(this.destroy(),this.slot=r),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var r;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,n):await P3(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",W("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var a7,c7,d7,l7,u7,h7,f7,p7,m7,g7,_7,E7,v7,y7,b7,S7,w7,T7,R7,A7,C7,I7,O7,N7,_t,D7,P7,k7,L7,x7,M7,U7,j7,Vs;let hr=(a7=je({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),c7=Br(),d7=je({argsMap:e=>[e.getTrackId()]}),l7=Fm("LocalVideoTrack","_enabledMutex"),u7=je({argsMap:(e,t)=>[e.getTrackId(),t]}),h7=Br(),f7=Fm("LocalVideoTrack","_enabledMutex"),p7=je({argsMap:(e,t)=>[e.getTrackId(),t]}),m7=Br(),g7=je({argsMap:(e,t)=>[e.getTrackId(),t]}),_7=Br(),E7=Br(),v7=je({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),y7=Br(),b7=Br(),S7=Br(),w7=Br(),T7=Br(),R7=Br(),A7=Br(),C7=je({argsMap:(e,t)=>[e.getTrackId(),t.name]}),I7=je({argsMap:e=>[e.getTrackId()]}),O7=je({argsMap:e=>[e.getTrackId()]}),N7=je({argsMap:(e,t,r)=>[e.getTrackId(),t.label,r]}),_t=class FJ extends Jp{get videoHeight(){if(Bn()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Bn()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ui.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,r,n,i,s,o){if(super(t,s),se(this,"trackMediaType",O0.VIDEO),se(this,"_player",void 0),se(this,"isUseScaleResolutionDownBy",!1),se(this,"_videoVisibleTimer",null),se(this,"_previousVideoVisibleStatus",void 0),se(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),se(this,"_encoderConfig",void 0),se(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),se(this,"_optimizationMode",void 0),se(this,"_videoHeight",void 0),se(this,"_videoWidth",void 0),se(this,"_forceBitrateLimit",void 0),se(this,"_enabled",!0),se(this,"_processorDestination",void 0),se(this,"_processorContext",void 0),Bn()){const{width:a,height:c}=t.getSettings();this._videoWidth=a,this._videoHeight=c}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=r,this._scalabilityMode=n,this._optimizationMode=i,this._hints=o||[],this._hints.indexOf(ir.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(a,c,d){const l=Rt();return!(l.name!==a||!l.osVersion)&&Number(l.version)===c}(Ft.CHROME,115)&&sT().indexOf("Windows")!==-1){const a=function(c,d){if("VideoFrame"in window&&"TransformStream"in window&&At().supportWebRTCInsertableStream){const l=new MediaStreamTrackProcessor(c),u=new MediaStreamTrackGenerator({kind:"video"});let h,p,_=Date.now();const g=()=>{E&&(clearInterval(E),E=void 0),h&&(h.close(),h=void 0),c.stop(),p=void 0,u.removeEventListener("ended",g)};let E=window.setInterval(()=>{if(p&&h&&Date.now()-_>1e3)try{u.readyState==="live"?p.enqueue(h.clone()):g()}catch{g()}},1e3);const b=new TransformStream({transform:(v,I)=>{u.readyState==="live"?(p=I,_=Date.now(),h===void 0?(h=v,I.enqueue(v.clone())):(I.enqueue(h),h=v)):v.close()}});return u.addEventListener("ended",g),l.readable.pipeThrough(b).pipeTo(u.writable),u}}(t);a&&(C.info("local screen video track begin to inject frame"),this._mediaStreamTrack=a)}r&&this._hints.indexOf(ir.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(r),this._processorContext=new PJ(this.getTrackId(),"local"),this._processorDestination=new DJ(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const i=document.getElementById(t);i?t=i:(C.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}C.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const n=yr(yr(yr({},this._getDefaultPlayerConfig()),r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(n):(t instanceof HTMLVideoElement?this._player=new k3(n):this._player=new jJ(n),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(I0.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},W("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,C.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(C.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await er(this,be.NEED_DISABLE_TRACK,this)}catch(n){throw C.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}return r||(this._enabled=!1),void C.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await er(this,be.NEED_ENABLE_TRACK,this)}catch(n){throw C.error("[".concat(this.getTrackId(),"] setEnabled to true error"),n.toString()),n}C.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,C.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await er(this,be.NEED_MUTE_TRACK,this):await er(this,be.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t,r){if(!this._enabled)throw new ie($.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=td(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const n=SS({encoderConfig:t});(Bn()||Ci()||Da())&&(n.deviceId=void 0),C.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(n));try{await this._originMediaStreamTrack.applyConstraints(n),this.updateMediaStreamTrackResolution()}catch(i){const s=new ie($.UNEXPECTED_ERROR,i.toString());throw C.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}}this._encoderConfig=t,this._hints.indexOf(ir.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await er(this,be.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(C)}}getStats(){return zu(()=>{C.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Lo(this,be.GET_STATS)||yr({},_N)}async setBeautyEffect(t){C.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,r):await P3(t)}async setBitrateLimit(t){if(C.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await er(this,be.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(C)}}}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void C.error($.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const r=this._optimizationMode;try{this._optimizationMode=t,await er(this,be.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(n){throw this._optimizationMode=r,C.error("[".concat(this.getTrackId(),"] set optimization mode failed"),n.toString()),n}C.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return C.error($.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,C.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){xJ(this._originMediaStreamTrack).then(t=>{let[r,n]=t;this._videoHeight=n,this._videoWidth=r}).catch(dT)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new ie($.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");C.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=td(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(ir.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await er(this,be.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(C)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:r,frameRate:n}=this.getMediaStreamTrackSettings();if(!t||!r||!n)return;const{bitrateMax:i,bitrateMin:s}=this._encoderConfig;if(s==null||i==null){const{max:o,min:a}=function(c,d,l,u,h){const p=W("BITRATE_ADAPTER_TYPE");if(p==="DEFAULT_BITRATE")return{min:u,max:h};if(h===void 0){var _;const E=Math.floor(200*Math.pow(l/15,.6)*Math.pow(c*d/640/360,.75));h=p==="STANDARD_BITRATE"?4*E:2*E,u=(_=u)!==null&&_!==void 0?_:E}else{var g;u=(g=u)!==null&&g!==void 0?g:Math.floor(h/10)}return{min:u,max:h}}(t,r,n,s,i);this._encoderConfig.bitrateMin=a,this._encoderConfig.bitrateMax=o,C.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(r,", fps: ").concat(n,"] => [brMax: ").concat(o,", brMin: ").concat(a,"]"))}}getVideoElementVisibleStatus(){try{var t,r;const n=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:s,slot:o}=i;if(this.isPlaying&&s instanceof HTMLVideoElement&&o instanceof HTMLElement){const a=YY.checkOneElementVisible(s),c=Object.assign({},a);if(c.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=c.visible;const d=Ce.reportApiInvoke(null,{tag:Or.TRACER,name:Zr.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});c.visible?d.onSuccess("Video is visible"):d.onSuccess("Invisible because of ".concat(c.reason))}return c}return}catch(n){throw new ie($.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new ie($.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],n=this._encoderConfig;t&&(n=yr(yr({},n),td(t))),n=Hh(n);const i=ar(8,"track-video-cloned-"),s=new FJ(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,n,Hh(this._scalabilityMode),this._optimizationMode,i,Hh(this._hints));return t&&n&&s.setEncoderConfiguration(n),C.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(r)),s}async replaceTrack(t,r){if(!(t instanceof MediaStreamTrack))throw new ie($.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new ie($.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,r,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(zu(()=>{Ce.reportApiInvoke(null,{name:Zr.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Or.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!W("ENABLE_VIDEO_SEI")||!W("ENABLE_ENCODED_TRANSFORM"))return void C.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new ie($.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const r=this.getRTCRtpTransceiver();if(!r)return void C.warning("Video track is not published, SEI can not be send");const n=r.sender.getParameters();if(n.codecs.length===0)return;const i=n.codecs[0].mimeType.toLocaleLowerCase();i==="video/h264"?this.safeEmit("sei-to-send",t):C.warning("SEI is not supported by ".concat(i))}bindProcessorDestinationEvents(){this.processorDestination.on(Ii.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await er(this,be.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await er(this,be.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ii.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(uo.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(uo.REQUEST_CONSTRAINTS)}},bt(_t.prototype,"play",[a7,c7],Object.getOwnPropertyDescriptor(_t.prototype,"play"),_t.prototype),bt(_t.prototype,"stop",[d7],Object.getOwnPropertyDescriptor(_t.prototype,"stop"),_t.prototype),bt(_t.prototype,"setEnabled",[l7,u7,h7],Object.getOwnPropertyDescriptor(_t.prototype,"setEnabled"),_t.prototype),bt(_t.prototype,"setMuted",[f7,p7,m7],Object.getOwnPropertyDescriptor(_t.prototype,"setMuted"),_t.prototype),bt(_t.prototype,"setEncoderConfiguration",[g7,_7],Object.getOwnPropertyDescriptor(_t.prototype,"setEncoderConfiguration"),_t.prototype),bt(_t.prototype,"getStats",[E7],Object.getOwnPropertyDescriptor(_t.prototype,"getStats"),_t.prototype),bt(_t.prototype,"setBeautyEffect",[v7,y7],Object.getOwnPropertyDescriptor(_t.prototype,"setBeautyEffect"),_t.prototype),bt(_t.prototype,"getCurrentFrameData",[b7],Object.getOwnPropertyDescriptor(_t.prototype,"getCurrentFrameData"),_t.prototype),bt(_t.prototype,"getCurrentFrameImage",[S7],Object.getOwnPropertyDescriptor(_t.prototype,"getCurrentFrameImage"),_t.prototype),bt(_t.prototype,"setBitrateLimit",[w7],Object.getOwnPropertyDescriptor(_t.prototype,"setBitrateLimit"),_t.prototype),bt(_t.prototype,"setOptimizationMode",[T7],Object.getOwnPropertyDescriptor(_t.prototype,"setOptimizationMode"),_t.prototype),bt(_t.prototype,"setScalabiltyMode",[R7],Object.getOwnPropertyDescriptor(_t.prototype,"setScalabiltyMode"),_t.prototype),bt(_t.prototype,"updateMediaStreamTrackResolution",[A7],Object.getOwnPropertyDescriptor(_t.prototype,"updateMediaStreamTrackResolution"),_t.prototype),bt(_t.prototype,"pipe",[C7],Object.getOwnPropertyDescriptor(_t.prototype,"pipe"),_t.prototype),bt(_t.prototype,"unpipe",[I7],Object.getOwnPropertyDescriptor(_t.prototype,"unpipe"),_t.prototype),bt(_t.prototype,"close",[O7],Object.getOwnPropertyDescriptor(_t.prototype,"close"),_t.prototype),bt(_t.prototype,"replaceTrack",[N7],Object.getOwnPropertyDescriptor(_t.prototype,"replaceTrack"),_t.prototype),_t),yN=(D7=je({argsMap:(e,t)=>[e.getTrackId(),t]}),P7=Br(),k7=Fm("CameraVideoTrack","_enabledMutex"),L7=je({argsMap:(e,t)=>[e.getTrackId(),t]}),x7=Br(),M7=je({argsMap:(e,t)=>[e.getTrackId(),t]}),U7=Br(),j7=je({argsMap:e=>[e.getTrackId()]}),Vs=class BJ extends hr{get __className__(){return"CameraVideoTrack"}constructor(t,r,n,i,s,o){super(t,td(r.encoderConfig),i,s,o),se(this,"_config",void 0),se(this,"_originalConstraints",void 0),se(this,"_constraints",void 0),se(this,"_enabled",!0),se(this,"_deviceName","default"),se(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(jm()||sN())&&!function(){const a=Rt();if(a.os!==pn.IOS||!a.osVersion)return!1;const c=a.osVersion.split(".");return Number(c[0])===15&&Number(c[1])>=2}()&&GY()&&this._enabled&&!this._isClosed&&(C.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=r,this._originalConstraints=n,this._constraints=n,this._deviceName=t.label,this._encoderConfig=td(this._config.encoderConfig),Ht.on(Rn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Ht.on(Rn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(C.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const r=await io.getDeviceById(t),n={};n.video=yr({},this._constraints),n.video.deviceId={exact:t},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await Xs(n,this.getTrackId())}catch(s){throw C.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),i=await Xs({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw C.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await io.getDeviceById(t);this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw C.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}C.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){C.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const r={video:yr(yr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let n=null;try{n=await Xs(r,this.getTrackId())}catch(i){throw C.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),i.toString()),n=await Xs({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=yr({},r.video),C.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(C.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const n=await Xs({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1)}await er(this,be.NEED_ENABLE_TRACK,this)}catch(n){throw C.error("[".concat(this.getTrackId(),"] setEnabled true error"),n.toString()),n}this.updateMediaStreamTrackResolution(),C.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),r||(this._enabled=!1);try{await er(this,be.NEED_DISABLE_TRACK,this)}catch(n){throw C.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}C.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,r){if(!this._enabled)throw new ie($.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=td(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const n=Hr(this._config);n.encoderConfig=t;const i=SS(n);(Bn()||Ci()||Da())&&(i.deviceId=void 0),C.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(s){const o=new ie($.UNEXPECTED_ERROR,s.toString());throw C.error("[".concat(this.getTrackId(),"] applyConstraints error"),o.toString()),o}this._config=n,this._constraints=i,this._originalConstraints=i,this._encoderConfig=t,this._hints.indexOf(ir.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await er(this,be.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(C)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Ci()||Da())&&this._enabled&&!this._isClosed&&Ht.duringInterruption){const t=async()=>{Ht.off(Rn.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(C.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Ht.on(Rn.IOS_INTERRUPTION_END,t)}else C.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(I0.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,n=io.searchDeviceIdByName(this._deviceName);if(n&&!r.deviceId&&(r.deviceId={exact:n}),this._enabled){const i=await Xs({video:r},this.getTrackId());this._constraints=r,await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Ht.off(Rn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Ht.off(Rn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],n=this._encoderConfig;t&&(n=yr(yr({},n),td(t))),n=Hh(n);const i=ar(8,"track-cam-cloned-"),s=new BJ(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,Hh(yr(yr({},this._config),{},{encoderConfig:n})),Hh(this._constraints),Hh(this._scalabilityMode),this._optimizationMode,i);return t&&n&&s.setEncoderConfiguration(n),C.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(r)),s}bindProcessorContextEvents(){this.processorContext.on(uo.REQUEST_UPDATE_CONSTRAINTS,async(t,r,n)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),r()}catch(i){n(i)}}),this.processorContext.on(uo.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},bt(Vs.prototype,"setDevice",[D7,P7],Object.getOwnPropertyDescriptor(Vs.prototype,"setDevice"),Vs.prototype),bt(Vs.prototype,"setEnabled",[k7,L7,x7],Object.getOwnPropertyDescriptor(Vs.prototype,"setEnabled"),Vs.prototype),bt(Vs.prototype,"setEncoderConfiguration",[M7,U7],Object.getOwnPropertyDescriptor(Vs.prototype,"setEncoderConfiguration"),Vs.prototype),bt(Vs.prototype,"close",[j7],Object.getOwnPropertyDescriptor(Vs.prototype,"close"),Vs.prototype),Vs);function jC(e,t,r,n){r.optimizationMode&&(n&&n.width&&n.height?(r.encoderConfig=yr(yr({},n),{},{bitrateMin:n.bitrateMin,bitrateMax:n.bitrateMax}),r.optimizationMode!=="motion"&&r.optimizationMode!=="detail"||(t.contentHint=r.optimizationMode,t.contentHint===r.optimizationMode?C.debug("[".concat(e,"] set content hint to"),r.optimizationMode):C.debug("[".concat(e,"] set content hint failed")))):C.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var F7,B7,V7,$7,yo,H7,z7,W7,G7,q7,K7,si;class VJ extends bJ{getUserId(){return this._userId}constructor(t,r,n,i){super(t,"track-".concat(t.kind,"-").concat(r,"-").concat(i.clientId,"_").concat(ar(5,""))),se(this,"_userId",void 0),se(this,"_uintId",void 0),se(this,"_isDestroyed",!1),se(this,"store",void 0),se(this,"processor",void 0),se(this,"processorContext",void 0),this._userId=r,this._uintId=n,this.store=i}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,C.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let fm=(F7=je({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),B7=je({argsMap:e=>[e.getTrackId()]}),V7=je({argsMap:(e,t)=>[e.getTrackId(),t.name]}),$7=je({argsMap:e=>[e.getTrackId()]}),bt((yo=class extends VJ{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ui.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,r,n){super(e,t,r,n),se(this,"_videoVisibleTimer",null),se(this,"_previousVideoVisibleStatus",void 0),se(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),se(this,"trackMediaType",O0.VIDEO),se(this,"_videoWidth",void 0),se(this,"_videoHeight",void 0),se(this,"_player",void 0),se(this,"processorDestination",void 0),se(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new PJ(this.getTrackId(),"remote"),this.processorDestination=new DJ(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return zu(()=>{C.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Lo(this,be.GET_STATS)||yr({},yJ)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const n=document.getElementById(e);n?e=n:(C.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}C.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const r=yr(yr({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(r):(e instanceof HTMLVideoElement?this._player=new k3(r):this._player=new jJ(r),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(hm.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=n=>{this.safeEmit(hm.VIDEO_STATE_CHANGED,n)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const n=this.getVideoElementVisibleStatus();this.safeEmit(hm.VIDEO_ELEMENT_VISIBLE_STATUS,n)}catch{}},W("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,C.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){xJ(this._originMediaStreamTrack).then(e=>{let[t,r]=e;this._videoHeight=r,this._videoWidth=t}).catch(dT)}_updatePlayerSource(){C.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const r=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),n={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:i,slot:s}=n;if(this.isPlaying&&i instanceof HTMLVideoElement&&s instanceof HTMLElement){const o=YY.checkOneElementVisible(i),a=Object.assign({},o);if(a.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=a.visible;const c=Ce.reportApiInvoke(null,{tag:Or.TRACER,name:Zr.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});a.visible?c.onSuccess("Video is visible"):c.onSuccess("Invisible because of ".concat(a.reason))}return a}return}catch(r){throw new ie($.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new ie($.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Ii.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ii.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(nf.SEI_RECEIVED,e)}}).prototype,"play",[F7],Object.getOwnPropertyDescriptor(yo.prototype,"play"),yo.prototype),bt(yo.prototype,"stop",[B7],Object.getOwnPropertyDescriptor(yo.prototype,"stop"),yo.prototype),bt(yo.prototype,"pipe",[V7],Object.getOwnPropertyDescriptor(yo.prototype,"pipe"),yo.prototype),bt(yo.prototype,"unpipe",[$7],Object.getOwnPropertyDescriptor(yo.prototype,"unpipe"),yo.prototype),yo),pm=(H7=je({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),z7=je({argsMap:(e,t)=>[e.getTrackId(),t]}),W7=je({argsMap:e=>[e.getTrackId()]}),G7=je({argsMap:e=>[e.getTrackId()]}),q7=je({argsMap:(e,t)=>[e.getTrackId(),t.name]}),K7=je({argsMap:e=>[e.getTrackId()]}),bt((si=class extends VJ{get isPlaying(){return this._useAudioElement?Fi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,r,n){super(e,t,r,n),se(this,"trackMediaType",O0.AUDIO),se(this,"_source",void 0),se(this,"_useAudioElement",!0),se(this,"_volume",100),se(this,"processorContext",void 0),se(this,"processorDestination",void 0),se(this,"_played",!1),se(this,"_bypassWebAudio",!1),W("DISABLE_WEBAUDIO")?(this._source=new vN,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new TJ(e,!0),W("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(eo.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(hm.FIRST_FRAME_DECODED)}),this.processorContext=new LJ(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new kJ(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(eo.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(eo.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(eo.ON_AUDIO_BUFFER),this._source.on(eo.ON_AUDIO_BUFFER,r=>e(r))}setVolume(e){this._volume=e,this._useAudioElement?Fi.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!EJ())throw new ie($.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Fi.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return zu(()=>{C.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Lo(this,be.GET_STATS)||yr({},vJ)}play(){C.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(C.debug("[".concat(this.getTrackId(),"] use audio element to play")),Fi.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){C.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Fi.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];C.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Fi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new ie($.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new ie($.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new ie($.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Ii.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Ii.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ii.ON_TRACK),this.processorDestination.removeAllListeners(Ii.ON_NODE)}}).prototype,"setVolume",[H7],Object.getOwnPropertyDescriptor(si.prototype,"setVolume"),si.prototype),bt(si.prototype,"setPlaybackDevice",[z7],Object.getOwnPropertyDescriptor(si.prototype,"setPlaybackDevice"),si.prototype),bt(si.prototype,"play",[W7],Object.getOwnPropertyDescriptor(si.prototype,"play"),si.prototype),bt(si.prototype,"stop",[G7],Object.getOwnPropertyDescriptor(si.prototype,"stop"),si.prototype),bt(si.prototype,"pipe",[q7],Object.getOwnPropertyDescriptor(si.prototype,"pipe"),si.prototype),bt(si.prototype,"unpipe",[K7],Object.getOwnPropertyDescriptor(si.prototype,"unpipe"),si.prototype),si);const Qd=new class extends Cr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),se(this,"_lastHiddenTime",0),se(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),C.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class $J extends Cr{constructor(t,r){super(),se(this,"trackMediaType",O0.DATA),se(this,"_version",1),se(this,"_type",3),se(this,"_config",void 0),se(this,"_originDataChannel",void 0),se(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),se(this,"_dataStreamPacketHandler",{serialize:n=>n,deserialize:n=>n}),se(this,"_datachannelEventMap",new Map),this._config=t,r&&(this._originDataChannel=r,this._bandDataChannelEvents(r)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return W("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,r;return(t=(r=this._originDataChannel)===null||r===void 0?void 0:r.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,r;return(t=(r=this._originDataChannel)===null||r===void 0?void 0:r.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new _e((t,r)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const n=setTimeout(()=>{var i;r(new ie($.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((i=this._originDataChannel)===null||i===void 0?void 0:i.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(n),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(n),new ie($.DATACHANNEL_CONNECTION_TIMEOUT)}}else r(new ie($.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[Ub.OPEN,Ub.CLOSE,Ub.ERROR].forEach(r=>{const n=()=>{this.emit(r)};this._datachannelEventMap.set(r,n),t.addEventListener(r,n)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(r=>{let[n,i]=r;t.removeEventListener(n,i)}),this._datachannelEventMap.clear()}}class uLe extends $J{constructor(t){super(t),se(this,"_messageListener",void 0),this._messageListener=r=>{if(r.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const n=r.data.slice(0,this._dataStreamPacketHeader.byteLength),i=new DataView(n).getUint8(3);if(i!==this.id)return void(W("SHOW_DATASTREAM2_LOG")&&C.debug("invalid datachannel id: ".concat(i," !== ").concat(this.id)));let s=r.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit(Ub.MESSAGE,s)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class hLe extends $J{send(t){if(this._originDataChannel){let r=t;r=this._dataStreamPacketHandler.serialize(t);const n=new Uint8Array(this._dataStreamPacketHeader.byteLength+r.byteLength);n.set(new Uint8Array(this._dataStreamPacketHeader),0),n.set(new Uint8Array(r),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(n.buffer)}}}function Fb(){const e=new Blob([atob("ZnVuY3Rpb24gZShlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLGE9W10sbz0wO2Zvcig7YS5sZW5ndGg8bjspbyszPG4mJjA9PT1yW29dJiYwPT09cltvKzFdJiYzPT09cltvKzJdJiYoMD09PXJbbyszXXx8MT09PXJbbyszXXx8Mj09PXJbbyszXXx8Mz09PXJbbyszXSk/KGEucHVzaChyW29dLHJbbysxXSxyW28rM10pLG8rPTQpOihhLnB1c2gocltvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYSl9ZnVuY3Rpb24gdChlLHQpe2NvbnN0IG49ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmxlbmd0aDtsZXQgbj1bXSxyPTA7Zm9yKDtyPHQ7KXIrMjx0JiYwPT09ZVtyXSYmMD09PWVbcisxXSYmKDA9PT1lW3IrMl18fDE9PT1lW3IrMl18fDI9PT1lW3IrMl18fDM9PT1lW3IrMl0pPyhuLnB1c2goZVtyXSxlW3IrMV0sMyxlW3IrMl0pLHIrPTMpOihuLnB1c2goZVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KHQpLHI9bi5sZW5ndGgsYT1NYXRoLmZsb29yKHIvMjU1KSxvPXIlMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNithKzErcitlLmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8YTspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1vLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkoZSksNitpK3IpLHMuYnVmZmVyfW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+LTEmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKHNlbGYub25ydGN0cmFuc2Zvcm09bj0+e2NvbnN0IHI9bi50cmFuc2Zvcm1lcjtsZXQgYT1bXTtyLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9ZT0+e2UuZGF0YS5zZWkmJmEucHVzaChlLmRhdGEuc2VpKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IG89ci5yZWFkYWJsZS5nZXRSZWFkZXIoKSxzPXIud3JpdGFibGUuZ2V0V3JpdGVyKCk7InJ4Ij09PXIub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1mdW5jdGlvbih0KXtjb25zdCBuPW5ldyBEYXRhVmlldyh0LmRhdGEpO2xldCByPTA7Zm9yKDtyKzQ8dC5kYXRhLmJ5dGVMZW5ndGg7KXtpZigwPT09bi5nZXRVaW50OChyKzApJiYwPT09bi5nZXRVaW50OChyKzEpJiYwPT09bi5nZXRVaW50OChyKzIpJiYxPT09bi5nZXRVaW50OChyKzMpJiY2PT09bi5nZXRVaW50OChyKzQpKXtsZXQgYT1yKzYsbz0wLHM9MDtmb3IoOzI1NT09PShzPW4uZ2V0VWludDgoYSsrKSk7KW8rPTI1NTtvKz1zO2NvbnN0IGk9ZSh0LmRhdGEsYSxvKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaSl9cisrfXJldHVybiBudWxsfShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1hLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>g9.revokeObjectURL(e),0),new Worker(g9.createObjectURL(e))}const wy=new Map,Ty=new Map;function fLe(e,t,r){let n=new Uint8Array(e,t,r),i=[],s=0;for(;i.length<r;)s+3<r&&n[s]===0&&n[s+1]===0&&n[s+2]===3&&(n[s+3]===0||n[s+3]===1||n[s+3]===2||n[s+3]===3)?(i.push(n[s],n[s+1],n[s+3]),s+=4):(i.push(n[s]),s++);return new Uint8Array(i)}const Ry=new Map;async function pLe(e,t){if(!At().supportWebRTCEncodedTransform)return void C.warning("browser not support video encoded transform");if(Ry.has(e)||!e.track)return;const r={track:e.track};if(Iu()){if(!e.createEncodedStreams)return void C.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(a){return void C.error("create video-encoded-streams error",a&&a.message)}let s=[];t.on("sei-to-send",a=>{s.push(a)});const o=new TransformStream({transform(a,c){r.controller||(r.controller=c),e.track&&e.track.id!==r.track.id&&(C.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",n),r.track=e.track,r.track.addEventListener("ended",n));const d=s.shift();d&&(a.data=function(l,u){const h=function(v){const I=v.length;let N=[],L=0;for(;L<I;)L+2<I&&v[L]===0&&v[L+1]===0&&(v[L+2]===0||v[L+2]===1||v[L+2]===2||v[L+2]===3)?(N.push(v[L],v[L+1],3,v[L+2]),L+=3):(N.push(v[L]),L++);return new Uint8Array(N)}(u),p=h.length,_=Math.floor(p/255),g=p%255,E=new Uint8Array(6+_+1+p+l.byteLength);E[0]=0,E[1]=0,E[2]=0,E[3]=1,E[4]=6,E[5]=101;let b=0;for(;b<_;)E[6+b]=255,b++;return E[6+b]=g,b++,E.set(h,6+b),E.set(new Uint8Array(l),6+b+p),E.buffer}(a.data,d)),c.enqueue(a)}});i.readable.pipeThrough(o).pipeTo(i.writable)}else{if(!Bn())return;{if(typeof RTCRtpScriptTransform>"u")return void C.warning("browser not support RTCRtpScriptTransform");const i=Fb(),s=new MessageChannel;await new _e(a=>i.onmessage=c=>{c.data==="registered"&&a(void 0)});const o=new RTCRtpScriptTransform(i,{name:"tx",port:s.port2},[s.port2]);e.transform=o,await new _e(a=>i.onmessage=c=>{c.data==="started"&&a(void 0)}),t.on("sei-to-send",a=>{s.port1.postMessage({sei:a})}),s.port1.onmessage=a=>{var c;a.data.transformed&&e.track&&((c=e.track)===null||c===void 0?void 0:c.id)!==r.track.id&&(C.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",n),r.track=e.track,r.track.addEventListener("ended",n))},r.worker=i}}function n(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",n)}const i=Ry.get(e);if(i){Ry.delete(e);try{var s,o;(s=i.controller)===null||s===void 0||s.terminate(),(o=i.worker)===null||o===void 0||o.terminate()}catch(a){C.warning(a&&a.message)}}}Ry.set(e,r),e.track.addEventListener("ended",n)}const gg=new Map;(function(){const e=Rt();yn.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),yn.getStreamFromExtension=e.name===Ft.CHROME&&Number(e.version)>34,yn.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let r=!1;try{t.addTransceiver("audio"),r=!0}catch{}return t.close(),r}(),yn.supportMinBitrate=e.name===Ft.CHROME||e.name===Ft.EDGE,yn.supportSetRtpSenderParameters=function(){const t=Rt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Hu()||!(!Bn()&&!ES())||t.name===Ft.FIREFOX&&Number(t.version)>=64)}(),e.name===Ft.SAFARI&&(Number(e.version)>=14?yn.supportDualStream=!0:yn.supportDualStream=!1),yn.webAudioMediaStreamDest=function(){const t=Rt();return!(t.name===Ft.SAFARI&&Number(t.version)<12)}(),yn.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",yn.supportWebGL=typeof WebGLRenderingContext<"u",yn.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Hu()||(yn.webAudioWithAEC=!0),yn.supportShareAudio=function(){const t=Rt();return(t.os===pn.WIN_10||t.os===pn.WIN_81||t.os===pn.WIN_7||t.os===pn.LINUX||t.os===pn.MAC_OS||t.os===pn.CHROMIUM_OS)&&t.name===Ft.CHROME&&Number(t.version)>=74}(),yn.supportDataChannel=!!(iN(76)||function(t){const r=Rt();return!(r.name!==Ft.FIREFOX||!r.osVersion)&&Number(r.version)>=t}(68)||HY(14)),yn.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!Dr()&&!!t&&t.prototype.setConfiguration instanceof Function}(),yn.supportWebRTCEncodedTransform=function(){const t=Rt();return t.name==="Chrome"&&Number(t.version)>=86||t.name==="Safari"&&Number(t.version)>=15}(),yn.supportWebRTCInsertableStream=function(){const t=Rt();return(t.name===Ft.CHROME||t.name===Ft.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),yn.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,yn.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,cT(()=>{yn.supportDualStreamEncoding=function(){const t=Rt();return!!W("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&W("CHROME_DUAL_STREAM_USE_ENCODING"))}(),C.info("browser compatibility",JSON.stringify(yn),JSON.stringify(e))})})();class wf extends Cr{constructor(t,r){super(),j(this,"signal",void 0),j(this,"token",void 0),j(this,"tokenTimeout",void 0),j(this,"tokenInterval",void 0),j(this,"_sequence",0),j(this,"userMap",new Map),j(this,"encoder",new TextEncoder),this.signal=t,this.token=r;const n=()=>{this.signal.connectionState===or.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(n,1e3):this.tokenInterval=window.setTimeout(n,3*W("P2P_TOKEN_INTERVAL"))};n()}async send(t,r,n,i,s){var o,a,c;if(this.userMap.size===0)return;const d=Array.from(_l(o=this.userMap).call(o))[0].token;typeof r!="string"&&(r=JSON.stringify(r)),i=(a=i)!==null&&a!==void 0?a:ar(6,""),s=(c=s)!==null&&c!==void 0?c:this._sequence++;const l={_id:i,_type:t,_seq:s,_message:r,token:"".concat(this.token,"_").concat(d)};W("SHOW_P2P_LOG")&&C.debug("send message",l,"noNeedResponse : ".concat(n)),this.splitMessage(JSON.stringify(l)).forEach(h=>{this.signal.request($e.DATA_STREAM,{payload:Ou(this.encoder.encode(h))})});const u=new _e((h,p)=>{const _=window.setTimeout(()=>{this.off("res-@".concat(i,"_ack"),g),this.off("res-@".concat(i),b),this.off(sp.ABORT,E),C.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(i)),this.userMap.size===0?p(new ie($.INVALID_REMOTE_USER)):p(new ie($.TIMEOUT))},W("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),g=()=>{_&&window.clearTimeout(_),this.off(sp.ABORT,E),n&&h()},E=()=>{_&&window.clearTimeout(_),this.off("res-@".concat(i,"_ack"),g),this.off("res-@".concat(i),b),p(new ie($.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(i)))};this.once(sp.ABORT,E),this.once("res-@".concat(i,"_ack"),g);const b=(I,N)=>{v=!0,_&&window.clearTimeout(_),this.off("res-@".concat(i,"_ack"),g),this.off(sp.ABORT,E),I==="success"?h(N):p(new ie($.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(i)))};let v=!1;n||(this.once("res-@".concat(i),b),In(W("SIGNAL_REQUEST_TIMEOUT")).then(()=>{v||C.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(i,", ").concat(l))}))});try{return await u}catch(h){if(h.code===$.TIMEOUT)return await this.send(t,r,n,i,s);throw h}}onMessage(t){var r;const{_uid:n}=t;let i,s=this.userMap.get(n);if(s)i=s.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==jr.CHECK)return;const{token:d}=t;i=new Map,s={uid:n,isStart:!0,token:d,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(n,s),this.signal.emit(ft.ON_USER_ONLINE,{uid:n}),this.handleUserOnline()}if("id"in t&&"total"in t){var o;const{id:d,total:l}=t,u=(o=i.get(d))!==null&&o!==void 0?o:[];if(u.push(t),i.has(d)||i.set(d,u),u.length!==l)return;{const h=sv(u).call(u,(p,_)=>p.index-_.index).map(p=>p.payload).join("");i.delete(d),(t=JSON.parse(h))._uid=n}}const{_type:a,token:c}=t;if(Ee(r=[jr.ACK,jr.CHECK]).call(r,a))return a===jr.CHECK&&this.handleCheckToken(s,c),void this.receiveMessage(t);c==="".concat(s.token,"_").concat(this.token)?this.handleReceivedMessage(t):C.debug('Receive unexpected message", '.concat(c,", cur_token: ").concat(s.token,"_").concat(this.token),t)}check(){const t={_id:ar(6,""),token:this.token,_type:jr.CHECK};W("SHOW_P2P_LOG")&&C.debug("send message",t),this.signal.request($e.DATA_STREAM,{payload:Ou(this.encoder.encode(JSON.stringify(t)))})}ack(t){const r={_id:t,_type:jr.ACK,token:this.token};W("SHOW_P2P_LOG")&&C.debug("send message",r),this.signal.request($e.DATA_STREAM,{payload:Ou(this.encoder.encode(JSON.stringify(r)))})}response(t,r,n){this.send(jr.RESPONSE,JSON.stringify({success:!n,message:r}),!0,t)}handleReceivedMessage(t){const r=()=>{this.userMap.forEach(d=>{const{receivedMessagesMap:l,nextExpectedSequenceNumber:u}=d;for(;l.has(u);){const h=l.get(u);l.delete(u),this.receiveMessage(h),d.nextExpectedSequenceNumber++}})};if(!t)return void r();const{_uid:n,_seq:i}=t,s=this.userMap.get(n),{receivedMessagesMap:o,isStart:a,nextExpectedSequenceNumber:c}=s;if(i<c)return this.ack(t._id),void C.debug("[external-signal] receive old message, seq: ".concat(i,", ").concat(t._message));o.set(i,t),a&&i===c&&(this.receiveMessage(t),o.delete(c),s.nextExpectedSequenceNumber++,r())}receiveMessage(t){const{_id:r,_type:n,_message:i,_uid:s}=t;if(W("SHOW_P2P_LOG")&&C.debug("receive message",t),r){let o;switch(t._type!==jr.ACK&&(i&&(o=JSON.parse(i)),this.ack(t._id)),t._type){case jr.CANDIDATE:case jr.CONTROL:this.signal.emit(n,o,s);break;case jr.PUBLISH:case jr.UNPUBLISH:case jr.RESTART_ICE:case jr.CALL:o.uid=s,Vn(this.signal,n,o).then(a=>{this.response(t._id,a)}).catch(()=>{this.response(t._id,void 0,!0)});break;case jr.ACK:this.getListeners("res-@".concat(r,"_ack")).length>0&&this.emit("res-@".concat(r,"_ack"));break;case jr.RESPONSE:{const{success:a,message:c}=o;this.emit("res-@".concat(r),a?"success":"failed",c);break}}}}splitMessage(t){if(t.length<wf.MAX_MESSAGE_SIZE)return[t];const r=[],{remoteToken:n}=JSON.parse(t),i=ar(6,"");let s=0,o=800;const a=Math.ceil(t.length/o);for(;t.length>0;){s++;const c={id:i,index:s,total:a,payload:t.slice(0,o),token:"".concat(this.token,"_").concat(n)};JSON.stringify(c).length>wf.MAX_MESSAGE_SIZE?o-=50:(r.push(c),t=t.slice(o))}return r.map(c=>JSON.stringify(c))}handleCheckToken(t,r){return t.token!==r?(C.debug("token changed, from ".concat(t.token," to ").concat(r)),this.reset(t.uid,r),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{C.debug("token timeout, ".concat(r)),this.reset(t.uid)},W("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await Vn(this.signal,jr.CALL,void 0),r=await this.send(jr.CALL,t);this.signal.emit(He.P2P_CONNECTION,r,!0)}async reset(t,r){const n=this.userMap.get(t);n&&(this.emit(sp.ABORT),this.signal.emit(ft.ON_USER_OFFLINE,{uid:n.uid,reason:N3e.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),r||(C.debug("change local token from ".concat(r," to ").concat(r)),this.token=ar(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(sp.ABORT)}}j(wf,"MAX_SIZE",1),j(wf,"MAX_MESSAGE_SIZE",1024);class Y7 extends Cr{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===or.CONNECTED?this.emit(He.WS_CONNECTED):t===or.RECONNECTING?this.emit(He.WS_RECONNECTING,this._websocketReconnectReason):t===or.CLOSED&&this.emit(He.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,r){super(),j(this,"_disconnectedReason",void 0),j(this,"_websocketReconnectReason",void 0),j(this,"_connectionState",or.CLOSED),j(this,"reconnectToken",void 0),j(this,"p2pToken",void 0),j(this,"websocket",void 0),j(this,"openConnectionTime",void 0),j(this,"clientId",void 0),j(this,"lastMsgTime",Date.now()),j(this,"uploadCache",[]),j(this,"uploadCacheInterval",void 0),j(this,"rttRolling",new tJ(5)),j(this,"pingpongTimer",void 0),j(this,"pingpongTimeoutCount",0),j(this,"joinResponse",void 0),j(this,"multiIpOption",void 0),j(this,"initError",void 0),j(this,"spec",void 0),j(this,"store",void 0),j(this,"_external_signal",void 0),j(this,"onWebsocketMessage",n=>{if(n.data instanceof ArrayBuffer)return void this.emit(He.ON_BINARY_DATA,n.data);const i=JSON.parse(n.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){switch(i._type){case ft.ON_DATA_STREAM:return void this.handleDataStream(i._message);case ft.MUTE_AUDIO:case ft.MUTE_VIDEO:case ft.ON_P2P_LOST:case ft.ON_USER_ONLINE:return;case ft.ON_USER_OFFLINE:const{uid:s}=i._message;return C.debug("[".concat(this.clientId,"] user-offline uid: ").concat(s)),void this._external_signal.reset(s)}if(this.emit(i._type,i._message),i._type===ft.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===ft.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Vt.UID_BANNED);break;case 15:this.close(Vt.IP_BANNED);break;case 16:this.close(Vt.CHANNEL_BANNED)}if(i._type===ft.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case xe.ERR_LICENSE_MISSING:this.close(Vt.LICENSE_MISSING);break;case xe.ERR_LICENSE_EXPIRED:this.close(Vt.LICENSE_EXPIRED);break;case xe.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Vt.LICENSE_MINUTES_EXCEEDED);break;case xe.ERR_LICENSE_PERIOD_INVALID:this.close(Vt.LICENSE_PERIOD_INVALID);break;case xe.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Vt.LICENSE_MULTIPLE_SDK_SERVICE);break;case xe.ERR_LICENSE_ILLEGAL:this.close(Vt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new R3("gateway-".concat(this.clientId),this.spec.retryConfig,!0,W("JOIN_GATEWAY_USE_DUAL_DOMAIN"),W("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===or.CONNECTED&&this.reconnect("retry",Un.OFFLINE)}),this.p2pToken=ar(6,""),this._external_signal=new wf(this,this.p2pToken)}async request(t,r,n,i){const s=ar(6,""),o={_id:s,_type:t,_message:r},a=this.websocket.connectionID,c=()=>new _e((_,g)=>{if(this.connectionState===or.CONNECTED)return _();const E=()=>{this.off(He.WS_CLOSED,b),_()},b=()=>{this.off(He.WS_CONNECTED,E),g(new ie($.WS_ABORT))};this.once(He.WS_CONNECTED,E),this.once(He.WS_CLOSED,b)});if(this.connectionState!==or.CONNECTING&&this.connectionState!==or.RECONNECTING||t===$e.JOIN||t===$e.REJOIN||await c(),this.websocket.sendMessage(o,!0),i)return;const d=new _e((_,g)=>{let E=!1;const b=(I,N)=>{E=!0,_({isSuccess:I==="success",message:N||{}}),this.off(He.WS_CLOSED,v),this.off(He.WS_RECONNECTING,v),this.emit(He.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(s),b);const v=()=>{g(new ie($.WS_ABORT,"type: ".concat(t))),this.off(He.WS_CLOSED,v),this.off(He.WS_RECONNECTING,v),this.off("res-@".concat(s),b)};this.once(He.WS_CLOSED,v),this.once(He.WS_RECONNECTING,v),In(W("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a||E||(C.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(He.REQUEST_TIMEOUT,t,r))})});let l=null;try{l=await d}catch(_){if(this.connectionState===or.CLOSED||t===$e.LEAVE)throw new ie($.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?_.throw():t===$e.JOIN||t===$e.REJOIN?null:(await c(),await this.request(t,r))}if(l.isSuccess)return l.message;const u=Number(l.message.error_code||l.message.code),h=pE(u),p=new ie($.UNEXPECTED_RESPONSE,"".concat(h.desc,": ").concat(l.message.error_str),{code:u,data:l.message,desc:h.desc});return h.action==="success"?l.message:(C.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(u,", message: ").concat(h.desc,", action: ").concat(h.action)),u===xe.ERR_TOO_MANY_BROADCASTERS?((t===$e.JOIN||t===$e.REJOIN)&&(this.initError=p,this.close()),p.throw()):h.action==="failed"?p.throw():h.action==="quit"?(this.initError=p,this.close(),p.throw()):(u===xe.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,C.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Un.MULTI_IP)):this.reconnect(h.action,Un.SERVER_ERROR),t===$e.JOIN||t===$e.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new _e(n=>{const i=s=>{(!r||r(s))&&(this.off(t,i),n(s))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void C.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(fE.WRTC_STATS,r)}upload(t,r){const n={_type:t,_message:r};try{this.websocket.sendMessage(n)}catch{const s=W("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==or.CONNECTED)return;const o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)},W("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){const n={_type:t,_message:r};this.websocket.sendMessage(n)}async sendExtensionMessage(t,r,n){return await this._external_signal.send(t,r,n)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new _e((r,n)=>{this.once(He.WS_CONNECTED,()=>r(this.joinResponse)),this.once(He.WS_CLOSED,()=>n(this.initError||new ie($.WS_ABORT))),this.connectionState=or.CONNECTING,this.websocket.init(t).catch(n)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Vt.LEAVE,this.connectionState=or.CLOSED,C.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=ar(6,""),this._external_signal.clear(),this._external_signal=new wf(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(He.ABORT_P2P_EXECUTION);const t=await Vn(this,He.REQUEST_JOIN_INFO),r=await this.request($e.JOIN,t);if(!r)return this.emit(He.REPORT_JOIN_GATEWAY,$.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(He.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=or.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}handleDataStream(t){try{var r;const n=zh(t.payload),i=new TextDecoder().decode(n),s=JSON.parse(i);"total"in s&&"id"in s||Ee(r=Object.values(jr)).call(r,s._type)?(s._uid=t.uid,this._external_signal.onMessage(s)):this.emit(ft.ON_DATA_STREAM,t)}catch{this.emit(ft.ON_DATA_STREAM,t)}}handleNotification(t){C.debug("[".concat(this.clientId,"] receive notification: "),t);const r=pE(t.code);if(r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Vt.UID_BANNED),void this.close()):void this.reconnect(r.action,Un.SERVER_ERROR);C.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=W("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(C.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>W("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Un.TIMEOUT):this.request($e.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const n=Date.now()-r;this.rttRolling.add(n),W("REPORT_STATS")&&this.send($e.PING_BACK,{pingpongElapse:n})}).catch(n=>{})}handleWebsocketEvents(){this.websocket.on(We.RECONNECT_WAITTING_FINISH,t=>{this.emit(He.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(We.RECONNECT_CREATE_CONNECTION,t=>{this.emit(He.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(We.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(We.CLOSED,()=>{this.connectionState=or.CLOSED}),this.websocket.on(We.FAILED,()=>{this._disconnectedReason=Vt.NETWORK_ERROR,this.connectionState=or.CLOSED}),this.websocket.on(We.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===or.CONNECTED?this.connectionState=or.RECONNECTING:this.connectionState=or.CONNECTING}),this.websocket.on(We.WILL_RECONNECT,(t,r,n)=>{t!=="retry"?(C.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):C.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),n(t)}),this.websocket.on(We.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(He.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof ie&&t.code===$.UNEXPECTED_RESPONSE&&t.data.code===xe.ERR_NO_AUTHORIZED)return C.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Un.SERVER_ERROR);C.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Un.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(We.REQUEST_NEW_URLS,(t,r)=>{Vn(this,He.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)}),this.websocket.on(We.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ft.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var HJ={exports:{}};HJ.exports=(()=>{var e={8:(n,i,s)=>{s.r(i),s.d(i,{Parser:()=>z,Printer:()=>S,parse:()=>k,print:()=>P});const o=`
`,a="".concat("\r").concat(o),c=" ";let d;function l(y){return y>="0"&&y<="9"}function u(y){return y>="!"&&y<="~"}function h(y){return u(y)||y>=""&&y<="ÿ"}function p(y){return y==="!"||y>="#"&&y<="'"||y>="*"&&y<="+"||y>="-"&&y<="."||y>="0"&&y<="9"||y>="A"&&y<="Z"||y>="^"&&y<="~"}function _(y){return y>="1"&&y<="9"}function g(y){return y>="A"&&y<="Z"||y>="a"&&y<="z"}function E(y){return y==="d"||y==="h"||y==="m"||y==="s"}function b(y){return y>""&&y<"	"||y>"\v"&&y<"\f"||y>""&&y<"ÿ"}function v(y){return g(y)||l(y)||y==="+"||y==="/"}function I(y){return l(y)||g(y)||y==="+"||y==="/"||y==="-"||y==="_"}function N(y){return g(y)||l(y)||y==="+"||y==="/"}function L(y,f){var R=Object.keys(y);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(y);f&&(B=B.filter(function(q){return Object.getOwnPropertyDescriptor(y,q).enumerable})),R.push.apply(R,B)}return R}function U(y){for(var f=1;f<arguments.length;f++){var R=arguments[f]!=null?arguments[f]:{};f%2?L(Object(R),!0).forEach(function(B){w(y,B,R[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(R)):L(Object(R)).forEach(function(B){Object.defineProperty(y,B,Object.getOwnPropertyDescriptor(R,B))})}return y}function w(y,f,R){return f in y?Object.defineProperty(y,f,{value:R,enumerable:!0,configurable:!0,writable:!0}):y[f]=R,y}(function(y){y.VERSION="v",y.ORIGIN="o",y.SESSION_NAME="s",y.INFORMATION="i",y.URI="u",y.EMAIL="e",y.PHONE="p",y.CONNECTION="c",y.BANDWIDTH="b",y.TIME="t",y.REPEAT="r",y.ZONE_ADJUSTMENTS="z",y.KEY="k",y.ATTRIBUTE="a",y.MEDIA="m"})(d||(d={}));class V{consumeText(f,R){let B=R;for(;B<f.length;){const q=f[B];if(q==="\0"||q==="\r"||q===o)break;B+=1}if(B-R==0)throw new Error("Invalid text, at ".concat(f));return B}consumeUnicastAddress(f,R,B){return this.consumeTill(f,R,c)}consumeOneOrMore(f,R,B){let q=R;for(;B(f[q]);)q++;if(q-R==0)throw new Error("Invalid rule at ".concat(R,"."));return q}consumeSpace(f,R){if(f[R]===c)return R+1;throw new Error("Invalid space at ".concat(R,"."))}consumeIP4Address(f,R){let B=R;for(let q=0;q<4;q++)if(B=this.consumeDecimalUChar(f,B),q!==3){if(f[B]!==".")throw new Error("Invalid IP4 address.");B++}return B}consumeDecimalUChar(f,R){let B=R;for(let F=0;F<3&&l(f[B]);F++,B++);if(B-R==0)throw new Error("Invalid decimal uchar.");const q=parseInt(f.slice(R,B));if(q>=0&&q<=255)return B;throw new Error("Invalid decimal uchar")}consumeIP6Address(f,R){let B=this.consumeHexpart(f,R);return f[B]===":"&&(B+=1,B=this.consumeIP4Address(f,B)),B}consumeHexpart(f,R){let B=R;if(f[B]===":"&&f[B+1]===":"){B+=2;try{B=this.consumeHexseq(f,B)}catch{}return B}if(B=this.consumeHexseq(f,B),f[B]===":"&&f[B+1]===":"){B+=2;try{B=this.consumeHexseq(f,B)}catch{}return B}return B}consumeHexseq(f,R){let B=R;for(;B=this.consumeHex4(f,B),f[B]===":"&&f[B+1]!==":";)B+=1;return B}consumeHex4(f,R){let B=0;for(;B<4;B++)if(!((q=f[R+B])>="0"&&q<="9"||q>="a"&&q<="f"||q>="A"&&q<="F")){if(B===0)throw new Error("Invalid hex 4");break}var q;return R+B}consumeFQDN(f,R){let B=R;for(;l(f[B])||g(f[B])||f[B]==="-"||f[B]===".";)B+=1;if(B-R<4)throw new Error("Invalid FQDN");return B}consumeExtnAddr(f,R){return this.consumeOneOrMore(f,R,h)}consumeMulticastAddress(f,R,B){switch(B){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(f,R);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(f,R);default:try{return this.consumeFQDN(f,R)}catch{return this.consumeExtnAddr(f,R)}}}consumeIP6MulticastAddress(f,R){const B=this.consumeHexpart(f,R);return f[B]==="/"?this.consumeInteger(f,B+1):B}consumeIP4MulticastAddress(f,R){let B=R+3;const q=f.slice(R,B),F=parseInt(q);if(F<224||F>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let te=0;te<3;te++){if(f[B]!==".")throw new Error("Invalid IP4 multicast address.");B+=1,B=this.consumeDecimalUChar(f,B)}return f[B]==="/"&&(B+=1),B=this.consumeTTL(f,B),f[B]==="/"&&(B=this.consumeInteger(f,B)),B}consumeInteger(f,R){if(!_(f[R]))throw new Error("Invalid integer.");for(R+=1;l(f[R]);)R+=1;return R}consumeTTL(f,R){if(f[R]==="0")return R+1;if(!_(f[R]))throw new Error("Invalid TTL.");R+=1;for(let B=0;B<2&&l(f[R]);B++)R+=1;return R}consumeToken(f,R){return this.consumeOneOrMore(f,R,p)}consumeTime(f,R){let B=R;if(f[B]==="0")return B+1;for(_(f[B])&&(B+=1);l(f[B]);)B++;if(B-R<10)throw new Error("Invalid time");return B}consumeAddress(f,R){return this.consumeTill(f,R,c)}consumeTypedTime(f,R){let B=R;return B=this.consumeOneOrMore(f,B,l),E(f[B])?B+1:B}consumeRepeatInterval(f,R){if(!_(f[R]))throw new Error("Invalid repeat interval");for(R+=1;l(f[R]);)R+=1;return E(f[R])&&(R+=1),R}consumePort(f,R){return this.consumeOneOrMore(f,R,l)}consume(f,R,B){for(let q=0;q<B.length;q++){if(R+q>=f.length)throw new Error("consume exceeding value length");if(f[R+q]!==B[q])throw new Error("consume ".concat(B," failed at ").concat(q))}return R+B.length}consumeTill(f,R,B){let q=R;for(;q<f.length&&(typeof B!="string"||f[q]!==B)&&(typeof B!="function"||!B(f[q]));)q++;return q}}class z extends V{constructor(){super(),w(this,"records",[]),w(this,"currentLine",0)}parse(f){const R=this.probeEOL(f);this.records=f.split(R).filter(Re=>!!fi(Re).call(Re)).map(this.parseLine),this.currentLine=0;const B=this.parseVersion(),q=this.parseOrigin(),F=this.parseSessionName(),te=this.parseInformation(),G=this.parseUri(),Y=this.parseEmail(),X=this.parsePhone(),M=this.parseConnection(),J=this.parseBandWidth(),de=this.parseTimeFields(),he=this.parseKey(),Se=this.parseSessionAttribute(),Te=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:B,origin:q,sessionName:F,information:te,uri:G,emails:Y,phones:X,connection:M,bandwidths:J,timeFields:de,key:he,attributes:Se,mediaDescriptions:Te}}getCurrentRecord(){const f=this.records[this.currentLine];if(!f)throw new Error("Record doesn't exit.");return f}probeEOL(f){for(let R=0;R<f.length;R++)if(f[R]===o)return f[R-1]==="\r"?a:o;throw new Error("Invalid newline character.")}parseLine(f,R){if(f.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const B=f[0];if(f[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:B,value:f.slice(2),line:R,cur:0}}parseSessionAttribute(){const f=new H;for(;this.currentLine<this.records.length;){const R=this.getCurrentRecord();if(R.type!==d.ATTRIBUTE)break;const B={attField:this.extractOneOrMore(R,q=>p(q)&&q!==":"),_cur:0};R.value[R.cur]===":"&&(R.cur+=1,B.attValue=this.extractOneOrMore(R,b)),f.parse(B),this.currentLine++}return f.digest()}parseMediaAttributes(f){const R=new A(f);for(;this.currentLine<this.records.length;){const B=this.getCurrentRecord();if(B.type!==d.ATTRIBUTE)break;const q={attField:this.extractOneOrMore(B,F=>p(F)&&F!==":"),_cur:0};B.value[B.cur]===":"&&(B.cur+=1,q.attValue=this.extractOneOrMore(B,b)),R.parse(q),this.currentLine++}return R.digest()}parseKey(){const f=this.getCurrentRecord();if(f.type===d.KEY){if(f.value==="prompt"||f.value==="clear:"||f.value==="base64:"||f.value==="uri:")return f.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const f=this.getCurrentRecord();if(f.type===d.ZONE_ADJUSTMENTS){const R=[];for(;;)try{const B=this.extract(f,this.consumeTime);this.consumeSpaceForRecord(f);let q=!1;f.value[f.cur]==="-"&&(q=!0,f.cur+=1);const F=this.extract(f,this.consumeTypedTime);R.push({time:B,typedTime:F,back:q})}catch{break}if(R.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,R}return[]}parseRepeat(){const f=[];for(;;){const R=this.getCurrentRecord();if(R.type!==d.REPEAT)break;{const B=this.extract(R,this.consumeRepeatInterval),q=this.parseTypedTime(R);f.push({repeatInterval:B,typedTimes:q}),this.currentLine++}}return f}parseTypedTime(f){const R=[];for(;;)try{this.consumeSpaceForRecord(f),R.push(this.extract(f,this.consumeTypedTime))}catch{break}if(R.length===0)throw new Error("Invalid typed time.");return R}parseTime(){const f=this.getCurrentRecord(),R=this.extract(f,this.consumeTime);this.consumeSpaceForRecord(f);const B=this.extract(f,this.consumeTime);return this.currentLine++,{startTime:R,stopTime:B}}parseBandWidth(){const f=[];for(;this.currentLine<this.records.length;){const R=this.getCurrentRecord();if(R.type!==d.BANDWIDTH)break;{const B=this.extractOneOrMore(R,p);if(R.value[R.cur]!==":")throw new Error("Invalid bandwidth field.");R.cur++;const q=this.extractOneOrMore(R,l);f.push({bwtype:B,bandwidth:q}),this.currentLine++}}return f}parseVersion(){const f=this.getCurrentRecord();if(f.type!==d.VERSION)throw new Error("first sdp record must be version");const R=f.value.slice(0,this.consumeOneOrMore(f.value,0,l));if(R.length!==f.value.length)throw new Error('invalid proto version, "v='.concat(f.value,'"'));return this.currentLine++,R}parseOrigin(){const f=this.getCurrentRecord();if(f.type!==d.ORIGIN)throw new Error("second line of sdp must be origin");const R=this.extractOneOrMore(f,h);this.consumeSpaceForRecord(f);const B=this.extractOneOrMore(f,l);this.consumeSpaceForRecord(f);const q=this.extractOneOrMore(f,l);this.consumeSpaceForRecord(f);const F=this.extractOneOrMore(f,p);this.consumeSpaceForRecord(f);const te=this.extractOneOrMore(f,p);this.consumeSpaceForRecord(f);const G=this.extract(f,this.consumeUnicastAddress);return this.currentLine++,{username:R,sessId:B,sessVersion:q,nettype:F,addrtype:te,unicastAddress:G}}parseSessionName(){const f=this.getCurrentRecord();if(f.type===d.SESSION_NAME){const R=this.extract(f,this.consumeText);return this.currentLine++,R}}parseInformation(){const f=this.getCurrentRecord();if(f.type!==d.INFORMATION)return;const R=this.extract(f,this.consumeText);return this.currentLine++,R}parseUri(){const f=this.getCurrentRecord();if(f.type===d.URI)return this.currentLine++,f.value}parseEmail(){const f=[];for(;;){const R=this.getCurrentRecord();if(R.type!==d.EMAIL)break;f.push(R.value),this.currentLine++}return f}parsePhone(){const f=[];for(;;){const R=this.getCurrentRecord();if(R.type!==d.PHONE)break;f.push(R.value),this.currentLine++}return f}parseConnection(){const f=this.getCurrentRecord();if(f.type===d.CONNECTION){const R=this.extractOneOrMore(f,p);this.consumeSpaceForRecord(f);const B=this.extractOneOrMore(f,p);this.consumeSpaceForRecord(f);const q=this.extract(f,this.consumeAddress);return this.currentLine++,{nettype:R,addrtype:B,address:q}}}parseMedia(){const f=this.getCurrentRecord(),R=this.extract(f,this.consumeToken);this.consumeSpaceForRecord(f);let B=this.extract(f,this.consumePort);f.value[f.cur]==="/"&&(f.cur+=1,B+=this.extract(f,this.consumeInteger)),this.consumeSpaceForRecord(f);const q=[];for(q.push(this.extract(f,this.consumeToken));f.value[f.cur]==="/";)f.cur+=1,q.push(this.extract(f,this.consumeToken));if(q.length===0)throw new Error("Invalid proto");const F=this.parseFmt(f);return this.currentLine++,{mediaType:R,port:B,protos:q,fmts:F}}parseTimeFields(){const f=[];for(;this.getCurrentRecord().type===d.TIME;){const R=this.parseTime(),B=this.parseRepeat(),q=this.parseZone();f.push({time:R,repeats:B,zones:q})}return f}parseMediaDescription(){const f=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===d.MEDIA;){const R=this.parseMedia(),B=this.parseInformation(),q=this.parseConnections(),F=this.parseBandWidth(),te=this.parseKey(),G=this.parseMediaAttributes(R);f.push({media:R,information:B,connections:q,bandwidths:F,key:te,attributes:G})}return f}parseConnections(){const f=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===d.CONNECTION;)f.push(this.parseConnection());return f}parseFmt(f){const R=[];for(;;)try{this.consumeSpaceForRecord(f),R.push(this.extract(f,this.consumeToken))}catch{break}if(R.length===0)throw new Error("Invalid fmts");return R}extract(f,R){for(var B=arguments.length,q=new Array(B>2?B-2:0),F=2;F<B;F++)q[F-2]=arguments[F];const te=R.call(this,f.value,f.cur,...q),G=f.value.slice(f.cur,te);return f.cur=te,G}extractOneOrMore(f,R){const B=this.consumeOneOrMore(f.value,f.cur,R),q=f.value.slice(f.cur,B);return f.cur=B,q}consumeSpaceForRecord(f){if(f.value[f.cur]!==c)throw new Error("Invalid space at ".concat(f.cur,"."));f.cur+=1}}class K extends V{constructor(){super(...arguments),w(this,"attributes",void 0),w(this,"digested",!1)}extractOneOrMore(f,R,B){const q=this.consumeOneOrMore(f.attValue,f._cur,R),F=f.attValue.slice(f._cur,q),[te,G]=B||[];if(typeof te=="number"&&F.length<te)throw new Error("error in length, should be more or equal than ".concat(te," characters."));if(typeof G=="number"&&F.length>G)throw new Error("error in length, should be less or equal than ".concat(G," characters."));return f._cur=q,F}consumeAttributeSpace(f){if(f.attValue[f._cur]!==c)throw new Error("Invalid space at ".concat(f._cur,"."));f._cur+=1}extract(f,R){if(!f.attValue)throw new Error("Nothing to extract from attValue.");for(var B=arguments.length,q=new Array(B>2?B-2:0),F=2;F<B;F++)q[F-2]=arguments[F];const te=R.call(this,f.attValue,f._cur,...q),G=f.attValue.slice(f._cur,te);return f._cur=te,G}atEnd(f){if(!f.attValue)throw new Error;return f._cur>=f.attValue.length}peekChar(f){if(!f.attValue)throw new Error;return f.attValue[f._cur]}peek(f,R){if(!f.attValue)throw new Error;for(let B=0;B<R.length;B++)if(R[B]!==f.attValue[f._cur+B])return!1;return!0}parseIceUfrag(f){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(f,v,[4,256])}parseIcePwd(f){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(f,v,[22,256])}parseIceOptions(f){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const R=[];for(;!this.atEnd(f);){R.push(this.extractOneOrMore(f,v));try{this.consumeAttributeSpace(f)}catch(B){if(this.atEnd(f))break;throw B}}this.attributes.iceOptions=R}parseFingerprint(f){const R=this.extract(f,this.consumeToken);this.consumeAttributeSpace(f);const B=this.extract(f,this.consumeTill);this.attributes.fingerprints.push({hashFunction:R,fingerprint:B})}parseExtmap(f){const R=this.extractOneOrMore(f,l);let B;this.peekChar(f)==="/"&&(this.extract(f,this.consume,"/"),B=this.extract(f,this.consumeToken)),this.consumeAttributeSpace(f);const q=this.extract(f,this.consumeTill,c),F=U(U({entry:parseInt(R,10)},B&&{direction:B}),{},{extensionName:q});this.peekChar(f)===c&&(this.consumeAttributeSpace(f),F.extensionAttributes=this.extract(f,this.consumeTill)),this.attributes.extmaps.push(F)}parseSetup(f){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const R=this.extract(f,this.consumeTill);if(R!=="active"&&R!=="passive"&&R!=="actpass"&&R!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=R}}class H extends K{constructor(){super(...arguments),w(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(f){if(this.digested)throw new Error("already digested");try{switch(f.attField){case"group":this.parseGroup(f);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(f);break;case"ice-pwd":this.parseIcePwd(f);break;case"ice-options":this.parseIceOptions(f);break;case"fingerprint":this.parseFingerprint(f);break;case"setup":this.parseSetup(f);break;case"tls-id":this.parseTlsId(f);break;case"identity":this.parseIdentity(f);break;case"extmap":this.parseExtmap(f);break;case"msid-semantic":this.parseMsidSemantic(f);break;default:f.ignored=!0,this.attributes.unrecognized.push(f)}}catch(R){throw console.error("parsing session attribute ".concat(f.attField,' error, "a=').concat(f.attField,":").concat(f.attValue,'"')),R}if(!f.ignored&&f.attValue&&!this.atEnd(f))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(f){const R=this.extract(f,this.consumeToken),B=[];for(;!this.atEnd(f)&&this.peekChar(f)===c;)this.consumeAttributeSpace(f),B.push(this.extract(f,this.consumeToken));this.attributes.groups.push({semantic:R,identificationTag:B})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(f){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(f,I)}parseIdentity(f){const R=this.extractOneOrMore(f,N),B=[];for(;!this.atEnd(f)&&this.peekChar(f)===c;){this.consumeAttributeSpace(f);const q=this.extract(f,this.consumeToken);this.extract(f,this.consume,"=");const F=this.extractOneOrMore(f,te=>te!==c&&b(te));B.push({name:q,value:F})}this.attributes.identities.push({assertionValue:R,extensions:B})}parseMsidSemantic(f){this.peekChar(f)===c&&this.consumeAttributeSpace(f);const R={semantic:this.extract(f,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(f)}catch{break}if(this.peekChar(f)==="*"){this.extract(f,this.consume,"*"),R.applyForAll=!0;break}{const B=this.extract(f,this.consumeTill,c);R.identifierList.push(B)}}this.attributes.msidSemantic=R}}class A extends K{constructor(f){super(),w(this,"attributes",void 0),f.protos.indexOf("RTP")!==-1||f.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(f){if(this.digested)throw new Error("already digested");try{switch(f.attField){case"extmap":this.parseExtmap(f);break;case"setup":this.parseSetup(f);break;case"ice-ufrag":this.parseIceUfrag(f);break;case"ice-pwd":this.parseIcePwd(f);break;case"ice-options":this.parseIceOptions(f);break;case"candidate":this.parseCandidate(f);break;case"remote-candidate":this.parseRemoteCandidate(f);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(f);break;case"rtpmap":this.parseRtpmap(f);break;case"ptime":this.parsePtime(f);break;case"maxptime":this.parseMaxPtime(f);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(f);break;case"ssrc":this.parseSSRC(f);break;case"fmtp":this.parseFmtp(f);break;case"rtcp-fb":this.parseRtcpFb(f);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(f);break;case"mid":this.parseMid(f);break;case"msid":this.parseMsid(f);break;case"imageattr":this.parseImageAttr(f);break;case"rid":this.parseRid(f);break;case"simulcast":this.parseSimulcast(f);break;case"sctp-port":this.parseSctpPort(f);break;case"max-message-size":this.parseMaxMessageSize(f);break;case"ssrc-group":this.parseSSRCGroup(f);break;default:f.ignored=!0,this.attributes.unrecognized.push(f)}}catch(R){throw console.error("parsing media attribute ".concat(f.attField,' error, "a=').concat(f.attField,":").concat(f.attValue,'"')),R}if(!f.ignored&&f.attValue&&!this.atEnd(f))throw new Error("attribute parsing error")}parseCandidate(f){const R=this.extractOneOrMore(f,v,[1,32]);this.consumeAttributeSpace(f);const B=this.extractOneOrMore(f,l,[1,5]);this.consumeAttributeSpace(f);const q=this.extract(f,this.consumeToken);this.consumeAttributeSpace(f);const F=this.extractOneOrMore(f,l,[1,10]);this.consumeAttributeSpace(f);const te=this.extract(f,this.consumeAddress);this.consumeAttributeSpace(f);const G=this.extract(f,this.consumePort);this.consumeAttributeSpace(f),this.extract(f,this.consume,"typ"),this.consumeAttributeSpace(f);const Y={foundation:R,componentId:B,transport:q,priority:F,connectionAddress:te,port:G,type:this.extract(f,this.consumeToken),extension:{}};for(this.peek(f," raddr")&&(this.extract(f,this.consume," raddr"),this.consumeAttributeSpace(f),Y.relAddr=this.extract(f,this.consumeAddress)),this.peek(f," rport")&&(this.extract(f,this.consume," rport"),this.consumeAttributeSpace(f),Y.relPort=this.extract(f,this.consumePort));this.peekChar(f)===c;){this.consumeAttributeSpace(f);const X=this.extract(f,this.consumeToken);this.consumeAttributeSpace(f),Y.extension[X]=this.extractOneOrMore(f,u)}this.attributes.candidates.push(Y)}parseRemoteCandidate(f){const R=[];for(;;){const B=this.extractOneOrMore(f,l,[1,5]);this.consumeAttributeSpace(f);const q=this.extract(f,this.consumeAddress);this.consumeAttributeSpace(f);const F=this.extract(f,this.consumePort);R.push({componentId:B,connectionAddress:q,port:F});try{this.consumeAttributeSpace(f)}catch{break}}this.attributes.remoteCandidatesList.push(R)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(f){const R=this.extract(f,this.consumeToken);this.consumeAttributeSpace(f);const B=this.extract(f,this.consumeTill,"/");this.extract(f,this.consume,"/");const q={encodingName:B,clockRate:this.extractOneOrMore(f,l)};this.atEnd(f)||this.peekChar(f)!=="/"||(this.extract(f,this.consume,"/"),q.encodingParameters=parseInt(this.extract(f,this.consumeTill),10));const F=this.attributes.payloads.find(te=>te.payloadType===parseInt(R,10));F?F.rtpMap=q:this.attributes.payloads.push({payloadType:parseInt(R,10),rtpMap:q,rtcpFeedbacks:[]})}parsePtime(f){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(f,this.consumeTill)}parseMaxPtime(f){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(f,this.consumeTill)}parseDirection(f){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=f.attField}parseSSRC(f){const R=this.extractOneOrMore(f,l);this.consumeAttributeSpace(f);const B=this.extract(f,this.consumeTill,":");let q;this.peekChar(f)===":"&&(this.extract(f,this.consume,":"),q=this.extract(f,this.consumeTill));const F=this.attributes.ssrcs.find(te=>te.ssrcId===parseInt(R,10));F?F.attributes[B]=q:this.attributes.ssrcs.push({ssrcId:parseInt(R,10),attributes:{[B]:q}})}parseFmtp(f){const R=this.extract(f,this.consumeTill,c);this.consumeAttributeSpace(f);const B=this.extract(f,this.consumeTill),q={};B.split(";").forEach(te=>{let[G,Y]=te.split("=");G=fi(G).call(G);const X=typeof Y=="string"?fi(Y).call(Y):null;typeof G=="string"&&G.length>0&&(q[G]=X)});const F=this.attributes.payloads.find(te=>te.payloadType===parseInt(R,10));F?F.fmtp={parameters:q}:this.attributes.payloads.push({payloadType:parseInt(R,10),rtcpFeedbacks:[],fmtp:{parameters:q}})}parseFmtParameters(f){const R={},B=this.extract(f,this.consumeTill,"=");f._cur++;const q=this.extract(f,this.consumeTill,";");for(R[B]=q;f.attValue[f._cur]===";";){const F=this.extract(f,this.consumeTill,"=");f._cur++;const te=this.extract(f,this.consumeTill,";");R[F]=te}return R}parseRtcpFb(f){let R="";R=this.peekChar(f)==="*"?this.extract(f,this.consume,"*"):this.extract(f,this.consumeTill,c),this.consumeAttributeSpace(f);const B=this.extract(f,this.consumeTill,c);let q;if(B==="trr-int")q={type:B,interval:this.extract(f,this.consumeTill)};else{const F={type:B};this.peekChar(f)===c&&(this.consumeAttributeSpace(f),F.parameter=this.extract(f,this.consumeToken),this.peekChar(f)===c&&(F.additional=this.extract(f,this.consumeTill))),q=F}if(R==="*")this.attributes.rtcpFeedbackWildcards.push(q);else{const F=this.attributes.payloads.find(te=>te.payloadType===parseInt(R,10));F?F.rtcpFeedbacks.push(q):this.attributes.payloads.push({payloadType:parseInt(R,10),rtcpFeedbacks:[q]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(f){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const R={port:this.extract(f,this.consumePort)};this.peekChar(f)===c&&(this.consumeAttributeSpace(f),R.netType=this.extractOneOrMore(f,p),this.consumeAttributeSpace(f),R.addressType=this.extractOneOrMore(f,p),this.consumeAttributeSpace(f),R.address=this.extract(f,this.consumeAddress)),this.attributes.rtcp=R}parseMsid(f){const R={id:this.extractOneOrMore(f,p,[1,64])};this.peekChar(f)===c&&(this.consumeAttributeSpace(f),R.appdata=this.extractOneOrMore(f,p,[1,64])),this.attributes.msids.push(R)}parseImageAttr(f){this.attributes.imageattr.push(f.attValue)}parseRid(f){const R=this.extractOneOrMore(f,q=>g(q)||l(q)||q==="_"||q==="-");this.consumeAttributeSpace(f);const B={id:R,direction:this.extract(f,this.consumeToken),params:[]};if(this.peekChar(f)===c){if(this.consumeAttributeSpace(f),this.peek(f,"pt=")){this.extract(f,this.consume,"pt=");const q=[];for(;;){const F=this.extract(f,this.consumeToken);q.push(F);try{this.extract(f,this.consume,",")}catch{break}}B.payloads=q,this.peekChar(f)===c&&this.extract(f,this.consume,c)}for(;;){const q=this.extract(f,this.consumeToken);switch(q){case"depend":{const F={type:q,rids:this.extract(f,this.consume,"=").split(",")};B.params.push(F);break}default:{const F={type:q};this.peekChar(f)==="="&&(this.extract(f,this.consume,"="),F.val=this.extract(f,this.consumeTill,";")),B.params.push(F)}}try{this.extract(f,this.consume,";")}catch{break}}}this.attributes.rids.push(B)}parseSimulcast(f){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=f.attValue,this.extract(f,this.consumeTill)}parseSctpPort(f){this.attributes.sctpPort=this.extractOneOrMore(f,l,[1,5])}parseMaxMessageSize(f){this.attributes.maxMessageSize=this.extractOneOrMore(f,l,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(f){this.attributes.mid=this.extract(f,this.consumeToken)}parseSSRCGroup(f){const R=this.extract(f,this.consumeToken),B=[];for(;;)try{this.consumeAttributeSpace(f);const q=this.extract(f,this.consumeInteger);B.push(parseInt(q,10))}catch{break}this.attributes.ssrcGroups.push({semantic:R,ssrcIds:B})}}function m(y,f,R){return f in y?Object.defineProperty(y,f,{value:R,enumerable:!0,configurable:!0,writable:!0}):y[f]=R,y}class S{constructor(){m(this,"eol",a)}print(f,R){let B="";return R&&(this.eol=R),B+=this.printVersion(f.version),B+=this.printOrigin(f.origin),B+=this.printSessionName(f.sessionName),B+=this.printInformation(f.information),B+=this.printUri(f.uri),B+=this.printEmail(f.emails),B+=this.printPhone(f.phones),B+=this.printConnection(f.connection),B+=this.printBandwidth(f.bandwidths),B+=this.printTimeFields(f.timeFields),B+=this.printKey(f.key),B+=this.printSessionAttributes(f.attributes),B+=this.printMediaDescription(f.mediaDescriptions),B}printVersion(f){return"v=".concat(f).concat(this.eol)}printOrigin(f){return"o=".concat(f.username," ").concat(f.sessId," ").concat(f.sessVersion," ").concat(f.nettype," ").concat(f.addrtype," ").concat(f.unicastAddress).concat(this.eol)}printSessionName(f){return f?"s=".concat(f).concat(this.eol):""}printInformation(f){return f?"i=".concat(f).concat(this.eol):""}printUri(f){return f?"u=".concat(f).concat(this.eol):""}printEmail(f){let R="";for(const B of f)R+="e=".concat(B).concat(this.eol);return R}printPhone(f){let R="";for(const B of f)R+="e=".concat(B).concat(this.eol);return R}printConnection(f){return f?"c=".concat(f.nettype," ").concat(f.addrtype," ").concat(f.address).concat(this.eol):""}printBandwidth(f){let R="";for(const B of f)R+="b=".concat(B.bwtype,":").concat(B.bandwidth).concat(this.eol);return R}printTimeFields(f){let R="";for(const B of f){R+="t=".concat(B.time.startTime," ").concat(B.time.startTime).concat(this.eol);for(const q of B.repeats)R+="r=".concat(q.repeatInterval," ").concat(q.typedTimes.join(" ")).concat(this.eol);B.zoneAdjustments&&(R+="z=",R+="z=".concat(B.zoneAdjustments.map(q=>"".concat(q.time," ").concat(q.back?"-":""," ").concat(q.typedTime)).join(" ")).concat(this.eol),R+=this.eol)}return R}printKey(f){return f?"k=".concat(f).concat(this.eol):""}printAttributes(f){let R="";for(const B of f)R+="a=".concat(B.attField).concat(B.attValue?":".concat(B.attValue):"").concat(this.eol);return R}printMediaDescription(f){let R="";for(const B of f)R+=this.printMedia(B.media),R+=this.printInformation(B.information),R+=this.printConnections(B.connections),R+=this.printBandwidth(B.bandwidths),R+=this.printKey(B.key),R+=this.printMediaAttributes(B);return R}printConnections(f){let R="";for(const B of f)R+=this.printConnection(B);return R}printMedia(f){return"m=".concat(f.mediaType," ").concat(f.port," ").concat(f.protos.join("/")," ").concat(f.fmts.join(" ")).concat(this.eol)}printSessionAttributes(f){return new x(this.eol).print(f)}printMediaAttributes(f){return new D(this.eol).print(f)}}class T{constructor(f){m(this,"eol",void 0),this.eol=f}printIceUfrag(f){return f===void 0?"":"a=ice-ufrag:".concat(f).concat(this.eol)}printIcePwd(f){return f===void 0?"":"a=ice-pwd:".concat(f).concat(this.eol)}printIceOptions(f){return f===void 0?"":"a=ice-options:".concat(f.join(c)).concat(this.eol)}printFingerprints(f){return f.length>0?f.map(R=>"a=fingerprint:".concat(R.hashFunction).concat(c).concat(R.fingerprint)).join(this.eol)+this.eol:""}printExtmap(f){return f.map(R=>"a=extmap:".concat(R.entry).concat(R.direction?"/".concat(R.direction):"").concat(c).concat(R.extensionName).concat(R.extensionAttributes?"".concat(c).concat(R.extensionAttributes):"").concat(this.eol)).join("")}printSetup(f){return f===void 0?"":"a=setup:".concat(f).concat(this.eol)}printUnrecognized(f){return f.map(R=>"a=".concat(R.attField).concat(R.attValue?":".concat(R.attValue):"").concat(this.eol)).join("")}}class x extends T{print(f){let R="";return R+=this.printGroups(f.groups),R+=this.printMsidSemantic(f.msidSemantic),R+=this.printIceLite(f.iceLite),R+=this.printIceUfrag(f.iceUfrag),R+=this.printIcePwd(f.icePwd),R+=this.printIceOptions(f.iceOptions),R+=this.printFingerprints(f.fingerprints),R+=this.printSetup(f.setup),R+=this.printTlsId(f.tlsId),R+=this.printIdentity(f.identities),R+=this.printExtmap(f.extmaps),R+=this.printUnrecognized(f.unrecognized),R}printGroups(f){let R="";return f.length>0&&(R+=f.map(B=>"a=group:".concat(B.semantic).concat(B.identificationTag.map(q=>"".concat(c).concat(q)).join("")).concat(this.eol)).join("")),R}printIceLite(f){return f===void 0?"":"a=ice-lite"+this.eol}printTlsId(f){return f?"a=tls-id:".concat(f).concat(this.eol):""}printIdentity(f){return f.length===0?"":f.map(R=>"a=identity:".concat(R.assertionValue).concat(R.extensions.map(B=>"".concat(c).concat(B.name).concat(B.value?"=".concat(B.value):"")))).join(this.eol)+this.eol}printMsidSemantic(f){if(!f)return"";let R="a=msid-semantic:".concat(f.semantic);return f.applyForAll?R+="".concat(c,"*"):f.identifierList.length>0&&(R+=f.identifierList.map(B=>"".concat(c).concat(B))),R+this.eol}}class D extends T{print(f){const R=f.attributes;let B="";return B+=this.printRTCP(R.rtcp),B+=this.printIceUfrag(R.iceUfrag),B+=this.printIcePwd(R.icePwd),B+=this.printIceOptions(R.iceOptions),B+=this.printCandidates(R.candidates),B+=this.printRemoteCandidatesList(R.remoteCandidatesList),B+=this.printEndOfCandidates(R.endOfCandidates),B+=this.printFingerprints(R.fingerprints),B+=this.printSetup(R.setup),B+=this.printMid(R.mid),B+=this.printExtmap(R.extmaps),B+=this.printRTPRelated(R),B+=this.printPtime(R.ptime),B+=this.printMaxPtime(R.maxPtime),B+=this.printDirection(R.direction),B+=this.printSSRCGroups(R.ssrcGroups),B+=this.printSSRC(R.ssrcs),B+=this.printRTCPMux(R.rtcpMux),B+=this.printRTCPMuxOnly(R.rtcpMuxOnly),B+=this.printRTCPRsize(R.rtcpRsize),B+=this.printMSId(R.msids),B+=this.printImageattr(R.imageattr),B+=this.printRid(R.rids),B+=this.printSimulcast(R.simulcast),B+=this.printSCTPPort(R.sctpPort),B+=this.printMaxMessageSize(R.maxMessageSize),B+=this.printUnrecognized(R.unrecognized),B}printCandidates(f){return f.map(R=>"a=candidate:".concat(R.foundation).concat(c).concat(R.componentId).concat(c).concat(R.transport).concat(c).concat(R.priority).concat(c).concat(R.connectionAddress).concat(c).concat(R.port).concat(c,"typ").concat(c).concat(R.type).concat(R.relAddr?"".concat(c,"raddr").concat(c).concat(R.relAddr):"").concat(R.relPort?"".concat(c,"rport").concat(c).concat(R.relPort):"").concat(Object.keys(R.extension).map(B=>"".concat(c).concat(B).concat(c).concat(R.extension[B])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(f){return f.map(R=>"a=remote-candidates:".concat(R.join(c)).concat(this.eol)).join("")}printEndOfCandidates(f){return f===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(f){if(!f.payloads)return"";const R=f.payloads;let B="";B+=f.rtcpFeedbackWildcards.map(q=>this.printRTCPFeedback("*",q)).join("");for(const q of R)B+=this.printRtpMap(q.payloadType,q.rtpMap),B+=this.printFmtp(q.payloadType,q.fmtp),B+=q.rtcpFeedbacks.map(F=>this.printRTCPFeedback(q.payloadType,F)).join("");return B}printFmtp(f,R){if(!R)return"";const B=Object.keys(R.parameters);return B.length===1&&R.parameters[B[0]]===null?"a=fmtp:".concat(f).concat(c).concat(B[0]).concat(this.eol):"a=fmtp:".concat(f).concat(c).concat(Object.keys(R.parameters).map(q=>"".concat(q,"=").concat(R.parameters[q])).join(";")).concat(this.eol)}printRtpMap(f,R){return R?"a=rtpmap:".concat(f).concat(c).concat(R.encodingName,"/").concat(R.clockRate).concat(R.encodingParameters?"/".concat(R.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(f,R){let B="a=rtcp-fb:".concat(f).concat(c),q=R;return q.type==="trr-int"?B+="ttr-int".concat(c).concat(q.interval):(B+="".concat(q.type),q.parameter&&(B+="".concat(c).concat(q.parameter),q.additional&&(B+="".concat(c).concat(q.additional)))),B+this.eol}printPtime(f){return f===void 0?"":"a=ptime:".concat(f).concat(this.eol)}printMaxPtime(f){return f===void 0?"":"a=maxptime:".concat(f).concat(this.eol)}printDirection(f){return f===void 0?"":"a=".concat(f).concat(this.eol)}printSSRC(f){return f.map(R=>Object.keys(R.attributes).map(B=>"a=ssrc:".concat(R.ssrcId.toString(10)).concat(c).concat(B).concat(R.attributes[B]?":".concat(R.attributes[B]):"").concat(this.eol)).join("")).join("")}printRTCPMux(f){return f===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(f){return f===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(f){return f===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(f){if(f===void 0)return"";let R="a=rtcp:".concat(f.port);return f.netType&&(R+="".concat(c).concat(f.netType)),f.addressType&&(R+="".concat(c).concat(f.addressType)),f.address&&(R+="".concat(c).concat(f.address)),R+this.eol}printMSId(f){return f.map(R=>"a=msid:".concat(R.id).concat(R.appdata?"".concat(c).concat(R.appdata):"").concat(this.eol)).join("")}printImageattr(f){return f.map(R=>"a=imageattr:".concat(R).concat(this.eol)).join("")}printRid(f){return f.map(R=>{let B="a=rid:".concat(R.id).concat(c).concat(R.direction);return R.payloads&&(B+="".concat(c,"pt=").concat(R.payloads.join(","))),R.params.length>0&&(B+="".concat(c).concat(R.params.map(q=>q.type==="depend"?"depend=".concat(q.rids.join(",")):"".concat(q.type,"=").concat(q.val)).join(";"))),B+this.eol}).join("")}printSimulcast(f){return f===void 0?"":"a=simulcast:".concat(f).concat(this.eol)}printSCTPPort(f){return f===void 0?"":"a=sctp-port:".concat(f).concat(this.eol)}printMaxMessageSize(f){return f===void 0?"":"a=max-message-size:".concat(f).concat(this.eol)}printMid(f){return f===void 0?"":"a=mid:".concat(f).concat(this.eol)}printSSRCGroups(f){return f.map(R=>"a=ssrc-group:".concat(R.semantic).concat(R.ssrcIds.map(B=>"".concat(c).concat(B.toString(10))).join("")).concat(this.eol)).join("")}}function k(y){return new z().parse(y)}function P(y,f){return new S().print(y,f)}}},t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}return r.d=(n,i)=>{for(var s in i)r.o(i,s)&&!r.o(n,s)&&Object.defineProperty(n,s,{enumerable:!0,get:i[s]})},r.o=(n,i)=>Object.prototype.hasOwnProperty.call(n,i),r.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r(8)})();var An=HJ.exports;function bN(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:W("SVC_MODE");if(W("ENABLE_SVC"))return function(t){return t in lN}(e)?e:lN.L1T3}function J7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function X7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?J7(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _E(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:s,filterAudioFec:o,filterAudioCodec:a,filterVideoCodec:c}=t,{useXR:d}=r;let l=[],u=[],h=[],p=[],_=!1,g=!1;if(An.parse(e).mediaDescriptions.forEach(b=>{n&&n!==b.attributes.direction||(b.media.mediaType!=="video"||_||(u=b.attributes.payloads,p=b.attributes.extmaps,_=!0),b.media.mediaType!=="audio"||g||(l=b.attributes.payloads,h=b.attributes.extmaps,g=!0))}),!p||u.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!h||l.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(u.forEach(b=>{var v;(v=b.rtpMap)!==null&&v!==void 0&&v.clockRate&&(b.rtpMap.clockRate=parseInt(b.rtpMap.clockRate)),d&&b.rtcpFeedbacks.push({type:"rrtr"})}),l.forEach(b=>{var v;(v=b.rtpMap)!==null&&v!==void 0&&v.clockRate&&(b.rtpMap.clockRate=parseInt(b.rtpMap.clockRate)),d&&b.rtcpFeedbacks.push({type:"rrtr"})}),i&&(l=l.filter(b=>{var v;return((v=b.rtpMap)===null||v===void 0?void 0:v.encodingName.toLowerCase())!=="rtx"}),u=u.filter(b=>{var v;return((v=b.rtpMap)===null||v===void 0?void 0:v.encodingName.toLowerCase())!=="rtx"})),s&&(u=u.filter(b=>{var v;return!/(red)|(ulpfec)|(flexfec)/i.test(((v=b.rtpMap)===null||v===void 0?void 0:v.encodingName)||"")})),o&&(l=l.filter(b=>{var v;return!/(red)|(ulpfec)|(flexfec)/i.test(((v=b.rtpMap)===null||v===void 0?void 0:v.encodingName)||"")})),a&&(a==null?void 0:a.length)>0&&(l=l.filter(b=>{var v;return Ee(a).call(a,((v=b.rtpMap)===null||v===void 0?void 0:v.encodingName.toLowerCase())||"")})),c&&(c==null?void 0:c.length)>0){const b=u.filter(v=>{var I;return Ee(c).call(c,((I=v.rtpMap)===null||I===void 0?void 0:I.encodingName.toLowerCase())||"")});u=b.concat(i?[]:M3(b,u))}const E=W("UNSUPPORTED_VIDEO_CODEC");return E&&E.length>0&&(u=u.filter(b=>!(b.rtpMap&&Ee(E).call(E,b.rtpMap.encodingName.toLowerCase())))),{audioCodecs:l,videoCodecs:u,audioExtensions:h,videoExtensions:p}}function _u(e){const t=An.parse(e);let r,n;for(const i of t.mediaDescriptions){if(!r){const s=i.attributes.iceUfrag,o=i.attributes.icePwd;if(!s||!o)throw new Error("Cannot get iceUfrag or icePwd from SDP.");r={iceUfrag:s,icePwd:o}}if(!n){const s=i.attributes.fingerprints;s.length>0&&(n={fingerprints:s})}}if(!n&&t.attributes.fingerprints.length>0&&(n={fingerprints:t.attributes.fingerprints}),!n||!r)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:r,dtlsParameters:n}}function zJ(e,t){const r=[],n=e.attributes.ssrcGroups.filter(o=>o.semantic==="FID"),i=e.attributes.ssrcGroups.find(o=>o.semantic==="SIM"),s=e.attributes.ssrcs;if(i)i.ssrcIds.forEach(o=>{var a;const c=(a=n.find(d=>d.ssrcIds[0]===o))===null||a===void 0?void 0:a.ssrcIds[1];r.push({ssrcId:o,rtx:t?c:void 0})});else if(n.length>0){const o=n[0].ssrcIds[0],a=n[0].ssrcIds[1];r.push({ssrcId:o,rtx:t?a:void 0})}else{if(s.length===0)throw new Error("No ssrcs found on local media description.");r.push({ssrcId:s[0].ssrcId})}return r}function Q7(e,t,r){const{cname:n}=e;let i=[];t&&(i=WJ(t)),i.length===0&&(i=e.iceParameters.candidates.map(l=>({foundation:l.foundation,componentId:"1",transport:l.protocol,priority:l.priority.toString(),connectionAddress:l.ip,port:l.port.toString(),type:l.type,extension:{}})),C.debug("Using candidates from gateway."));const s={fingerprints:e.dtlsParameters.fingerprints.map(l=>({hashFunction:l.algorithm,fingerprint:l.fingerprint}))},o={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let a;switch(e.dtlsParameters.role){case"server":a="passive";break;case"client":a="active";break;case"auto":a="actpass"}const c=RS(e.rtpCapabilities),d=[];return Array.isArray(r)&&r.length>0&&r.forEach(l=>{d.push({kind:Oe.VIDEO,ssrcId:l.v,rtx:l.v_rtx,mslabel:"".concat(l.v,"_").concat(l.a)},{kind:Oe.AUDIO,ssrcId:l.a,mslabel:"".concat(l.v,"_").concat(l.a)})}),{dtlsParameters:s,iceParameters:o,candidates:i,rtpCapabilities:c,setup:a,cname:n,preSSRCs:d}}function WJ(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],C.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),C.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),t}function Nh(e,t,r){const n=[],i=[];return e.forEach(s=>{let{ssrcId:o,rtx:a}=s;const c=ar(8,"track-"),d={ssrcId:o,attributes:X7({label:c,mslabel:r=r||ar(10,""),msid:"".concat(r," ").concat(c)},t&&{cname:t})};if(n.push(d),a!==void 0){const l={ssrcId:a,attributes:X7({label:c,mslabel:r,msid:"".concat(r," ").concat(c)},t&&{cname:t})};n.push(l),i.push({semantic:"FID",ssrcIds:[o,a]})}}),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map(s=>{let{ssrcId:o}=s;return o})}),{ssrcs:n,ssrcGroups:i}}function Hm(e,t){t instanceof Ir&&e.attributes.payloads.forEach(r=>{var n;const i=(n=r.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase();if(!i||["opus","pcmu","pcma","g722"].indexOf(i)===-1)return;r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.minptime="10",r.fmtp.parameters.useinbandfec="1";const s=t._encoderConfig;s&&i!=="pcmu"&&i!=="pcma"&&i!=="g722"&&(s.bitrate&&!Dr()&&(r.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*s.bitrate))),s.sampleRate&&(r.fmtp.parameters.maxplaybackrate="".concat(s.sampleRate),r.fmtp.parameters["sprop-maxcapturerate"]="".concat(s.sampleRate)),s.stereo&&(r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"))})}function L3(e){const t=e.attributes.unrecognized.findIndex(r=>r.attField==="x-google-flag"&&r.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function x3(e,t){var r;if(!(t instanceof hr&&t._encoderConfig&&t._hints.indexOf(ir.SCREEN_TRACK)===-1))return;const n=t._encoderConfig;At().supportMinBitrate&&n.bitrateMin&&e.attributes.payloads.forEach(i=>{var s,o;Ee(s=["h264","h265","vp8","vp9","av1"]).call(s,((o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-min-bitrate"]="".concat(n.bitrateMin))}),At().supportMinBitrate&&!Ee(r=t._hints).call(r,ir.LOW_STREAM)&&n.bitrateMax&&e.attributes.payloads.forEach(i=>{var s,o;Ee(s=["h264","h265","vp8","vp9","av1"]).call(s,((o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-start-bitrate"]="".concat(W("X_GOOGLE_START_BITRATE")||Math.floor(n.bitrateMax)))})}function GJ(e){if(e.media.mediaType!=="video")return;const t=Rt();if(t.name!==Ft.SAFARI&&t.os!==pn.IOS)return;const r=e.attributes.extmaps.findIndex(n=>/video-orientation/g.test(n.extensionName));r!==-1&&e.attributes.extmaps.splice(r,1)}function TS(e,t,r){if(!t)return;let n,i;if(e.media.mediaType==="video"?(n=r.videoExtensions,i=r.videoCodecs):(n=r.audioExtensions,i=r.audioCodecs),t.twcc===!0){const s=n.find(o=>o.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");s&&(e.attributes.extmaps.find(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||e.attributes.extmaps.push({entry:s.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(a,c){return c.filter(d=>!!a.find(l=>l.payloadType===d.payloadType&&!!l.rtcpFeedbacks.find(u=>u.type==="transport-cc")))}(i,e.attributes.payloads).forEach(a=>{a.rtcpFeedbacks.find(c=>c.type==="transport-cc")||a.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(t.twcc===!1){const s=e.attributes.extmaps.findIndex(o=>o.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach(o=>{const a=o.rtcpFeedbacks.findIndex(c=>c.type==="transport-cc");a!==-1&&o.rtcpFeedbacks.splice(a,1)})}if(t.remb===!0){const s=n.find(o=>o.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");s&&(e.attributes.extmaps.find(a=>a.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||e.attributes.extmaps.push({entry:s.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(a,c){return c.filter(d=>!!a.find(l=>l.payloadType===d.payloadType&&!!l.rtcpFeedbacks.find(u=>u.type==="goog-remb")))}(i,e.attributes.payloads).forEach(a=>{a.rtcpFeedbacks.find(c=>c.type==="goog-remb")||a.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(t.remb===!1){const s=e.attributes.extmaps.findIndex(o=>o.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach(o=>{const a=o.rtcpFeedbacks.findIndex(c=>c.type==="goog-remb");a!==-1&&o.rtcpFeedbacks.splice(a,1)})}}function qJ(e,t,r){if(Dr()||e.media.mediaType!=="video"||!(t instanceof hr)||r!=="vp9"&&r!=="vp8"||r==="vp8"&&!W("SIMULCAST")||r==="vp9"&&W("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const n=r==="vp8"?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],s=e.attributes.ssrcGroups.find(a=>a.semantic==="FID"&&a.ssrcIds[0]===i.ssrcId),o={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let a=1;a<n;a++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+a,attributes:Hr(i.attributes)}),o.ssrcIds.push(i.ssrcId+a),s&&(e.attributes.ssrcs.push({ssrcId:s.ssrcIds[1]+a,attributes:Hr(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+a,s.ssrcIds[1]+a]}));e.attributes.ssrcGroups.unshift(o)}async function KJ(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new RTCPeerConnection;r.addTransceiver("video",{direction:"sendonly"}),r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});const n=(await r.createOffer()).sdp,{send:i,recv:s,sendrecv:o}=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;const l=_E(d,a,c,"sendonly"),u=_E(d,a,c,"recvonly"),h={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},p={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},_={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Oa(l,u,"videoExtensions",h,p,_),Oa(l,u,"videoCodecs",h,p,_),Oa(l,u,"audioExtensions",h,p,_),Oa(l,u,"audioCodecs",h,p,_),W("RAISE_H264_BASELINE_PRIORITY")){const g=_.videoCodecs.findIndex(E=>{var b,v;return((b=E.rtpMap)===null||b===void 0?void 0:b.encodingName.toLocaleLowerCase())==="h264"&&((v=E.fmtp)===null||v===void 0?void 0:v.parameters["profile-level-id"])==="42001f"});if(g!==-1){const E=_.videoCodecs.findIndex(b=>{var v;return((v=b.rtpMap)===null||v===void 0?void 0:v.encodingName.toLocaleLowerCase())==="h264"});if(E<g){C.debug("raising H264 baseline profile priority");const b=_.videoCodecs[g];_.videoCodecs.splice(g,1),_.videoCodecs.splice(E,0,b)}E!==-1&&(p.videoCodecs=p.videoCodecs.filter(b=>{var v,I;return!(((v=b.rtpMap)===null||v===void 0?void 0:v.encodingName.toLocaleLowerCase())==="h264"&&((I=b.fmtp)===null||I===void 0?void 0:I.parameters["profile-level-id"])!=="42001f")})),E!==-1&&W("FILTER_SEND_H264_BASELINE")&&(h.videoCodecs=h.videoCodecs.filter(b=>{var v,I;return!(((v=b.rtpMap)===null||v===void 0?void 0:v.encodingName.toLocaleLowerCase())==="h264"&&((I=b.fmtp)===null||I===void 0?void 0:I.parameters["profile-level-id"])!=="42001f")}))}}return{send:h,recv:p,sendrecv:_}}(e,t,n);try{r.close()}catch{}return{send:i,recv:s,sendrecv:o}}function Z7(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=_E(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Oa(e,t,"videoExtensions",r,n,i),Oa(e,t,"videoCodecs",r,n,i),Oa(e,t,"audioExtensions",r,n,i),Oa(e,t,"audioCodecs",r,n,i),W("RAISE_H264_BASELINE_PRIORITY")){const s=i.videoCodecs.findIndex(o=>o.rtpMap&&o.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&o.fmtp&&o.fmtp.parameters["profile-level-id"]==="42001f");if(s!==-1){const o=i.videoCodecs.findIndex(a=>a.rtpMap&&a.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(o<s){C.debug("raising H264 baseline profile priority");const a=i.videoCodecs[s];i.videoCodecs.splice(s,1),i.videoCodecs.splice(o,0,a)}o!==-1&&(n.videoCodecs=n.videoCodecs.filter(a=>!(a.rtpMap&&a.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&a.fmtp&&a.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:r,recv:n,sendrecv:i}}function Oa(e,t,r,n,i,s){if(r==="videoExtensions"||r==="audioExtensions"){const o=[];return e[r].forEach(a=>{t[r].some((c,d)=>{if(a.entry===c.entry&&a.extensionName===c.extensionName)return o.push(d),!0})?s[r].push(a):n[r].push(a)}),void t[r].forEach((a,c)=>{o.indexOf(c)===-1&&i[r].push(a)})}if(r==="videoCodecs"||r==="audioCodecs"){const o=[];return e[r].forEach(a=>{t[r].some((c,d)=>{if(a.payloadType===c.payloadType&&JSON.stringify(a)===JSON.stringify(c))return o.push(d),!0})?s[r].push(a):n[r].push(a)}),void t[r].forEach((a,c)=>{o.indexOf(c)===-1&&i[r].push(a)})}}function RS(e){const{send:t,recv:r,sendrecv:n}=e;if(!n){if(!t||!r)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:r}}let i,s;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...n.audioCodecs],i.videoCodecs=[...t.videoCodecs,...n.videoCodecs],i.audioExtensions=[...t.audioExtensions,...n.audioExtensions],i.videoExtensions=[...t.videoExtensions,...n.videoExtensions]):i=n,r?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...r.audioCodecs,...n.audioCodecs],s.videoCodecs=[...r.videoCodecs,...n.videoCodecs],s.audioExtensions=[...r.audioExtensions,...n.audioExtensions],s.videoExtensions=[...r.videoExtensions,...n.videoExtensions]):s=n,{send:i,recv:s}}function zm(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var r;return((r=t.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function c_(e,t,r,n){let i=[];if(e===Oe.VIDEO){if(W("H264_PROFILE_LEVEL_ID")&&n==="h264"&&(i=t.videoCodecs.filter(s=>{var o;return Ee(o=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(o,n)&&s&&s.fmtp&&s.fmtp.parameters["profile-level-id"]===W("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i)||i.length===0){let s=[];const o=[],a=[],c=[];if(r.videoCodecs.forEach(d=>{const l=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"";Ee(l).call(l,n)?s.push(d):Ee(l).call(l,"vp9")?o.push(d):Ee(l).call(l,"vp8")?a.push(d):Ee(l).call(l,"h264")&&c.push(d)}),s.length===0){let d="";o.length!==0?(s=o,d="vp9"):a.length!==0?(s=a,d="vp8"):c.length!==0&&(s=c,d="h264"),C.warning("codec ".concat(n," not included in rtpCapabilities, fallback to default payloads: ").concat(d))}s.length!==0&&(i=t.videoCodecs.filter(d=>s.some(l=>l.payloadType===d.payloadType)))}if(i.length===0&&(C.warning("codec ".concat(n," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),W("USE_PUB_RTX")||W("USE_SUB_RTX")){const s=M3(i,t.videoCodecs);i=[...i,...s]}}else i=t.audioCodecs.filter(s=>{var o;return Ee(o=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(o,n)}),i.length===0&&(C.warning("codec ".concat(n," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter(s=>{var o;return Ee(o=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(o,"opus")}));return i}function M3(e,t){const r=e.map(n=>n.payloadType.toString());return t.filter(n=>n.rtpMap&&n.rtpMap.encodingName==="rtx"&&n.fmtp&&n.fmtp.parameters.apt&&Ee(r).call(r,n.fmtp&&n.fmtp.parameters.apt))}async function Ay(e,t,r){const n=t.toString(),i=JJ(n,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:n});const s=await e.createAnswer();if(!s.sdp)throw new Error("cannot get answer sdp");let o=s.sdp;o=YJ(o,r||{}),i==null||i(o||""),await e.setLocalDescription({type:"answer",sdp:o})}function YJ(e,t,r){const n=An.parse(e),{useXR:i}=t;return n.mediaDescriptions.forEach(s=>{var o;s.attributes.mid&&(Array.isArray(r)&&!Ee(r).call(r,s.attributes.mid)||(s.media.mediaType==="audio"&&zm(s),i&&Ee(o=["audio","video"]).call(o,s.media.mediaType)&&s.attributes.payloads.forEach(a=>{a.rtcpFeedbacks.findIndex(c=>c.type==="rrtr")===-1&&a.rtcpFeedbacks.push({type:"rrtr"})})))}),An.print(n)}function JJ(e,t,r,n){if(W("SDP_LOGGING"))return C.upload("exchanging ".concat(r," ").concat(t," SDP during P2PConnection.").concat(n,`
`),e),t==="offer"?i=>{JJ(i,"answer",r==="local"?"remote":"local",n)}:void 0}function xc(e,t){return typeof W(e)===t?W(e):void 0}function ej(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Bl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ej(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ej(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}const FC=new Map;class mLe extends Cr{get state(){return this._state}set state(t){if(t===this._state)return;const r=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(kn.CONNECTION_STATE_CHANGE,t,r,this._disconnectedReason):this.emit(kn.CONNECTION_STATE_CHANGE,t,r)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){C.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,r){super(),j(this,"store",void 0),j(this,"joinInfo",void 0),j(this,"key",void 0),j(this,"ntpOffset",0),j(this,"signal",void 0),j(this,"role",void 0),j(this,"inChannelInfo",{joinAt:null,duration:0}),j(this,"spec",void 0),j(this,"_state","DISCONNECTED"),j(this,"_statsCollector",void 0),j(this,"_disconnectedReason",void 0),j(this,"isSignalRecover",!1),j(this,"hasChangeBGPAddress",!1),j(this,"trafficStatsInterval",void 0),j(this,"networkQualityInterval",void 0),j(this,"_joinGatewayStartTime",0),j(this,"_signalTimeout",!1),j(this,"_clientRoleOptions",void 0),j(this,"_isProactiveJoin",!1),this.store=t,this.spec=r,this.signal=this.store.useP2P?new Y7(Bl(Bl({},r),{},{retryConfig:r.websocketRetryConfig}),t):new F3e(Bl(Bl({},r),{},{retryConfig:r.websocketRetryConfig}),t),this._statsCollector=r.statsCollector,this.role=r.role||"audience",this._clientRoleOptions=r.clientRoleOptions,this.handleSignalEvents()}async join(t,r,n){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const i=Date.now();let s=FC.get(t.cname);if(s||(s=new Map,FC.set(t.cname,s)),this._isProactiveJoin=!0,s.has(t.uid)){const d=new ee($.UID_CONFLICT);throw Ce.joinGateway(t.sid,{lts:i,succ:!1,ec:d.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),this._isProactiveJoin=!1,d}s.set(t.uid,!0),this.joinInfo=t,this.key=r;let o=0;this.joinGatewayStartTime=i;const a=t.proxyServer;try{C.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(o));const d=t.gatewayAddrs.map(l=>{let{address:u}=l;const[h,p]=u.split(":"),_={host:h,port:p};return t.proxyServer&&(_.proxy=t.proxyServer),_});o=(await this.signal.init(d,n)).uid,C.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(o," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(d){var c;throw C.error("[".concat(this.store.clientId,"] User join failed"),d.toString()),Ce.joinGateway(t.sid,{lts:i,succ:!1,ec:((c=d.data)===null||c===void 0?void 0:c.desc)||d.code,errorMsg:d.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!a,signalChannel:"0",preload:t.preload}),this._isProactiveJoin=!1,s.delete(t.uid),this.signal.close(),d}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),C.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(d=>{C.warning("[".concat(this.store.clientId,"] get traffic stats error"),d.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(kn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(kn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(kn.NETWORK_QUALITY,{uplinkNetworkQuality:WU(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:WU(this._statsCollector.trafficStats.B_dnq)}):this.emit(kn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),o}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],r=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){r!==Vt.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==or.CONNECTED||await function(n,i){return i===1/0?n:_e.race([n,MPe(i)])}(this.signal.request($e.LEAVE,void 0,!0),3e3)}catch(n){C.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),n)}this.signal.close(r),r!==Vt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,r,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ee($.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={state:"offer",p2p_id:this.store.p2pId,ortc:r,mode:this.spec.mode,extend:W("PUB_EXTEND"),twcc:!!W("PUBLISH_TWCC"),rtx:!!W("USE_PUB_RTX")};try{return(await this.signal.request($e.PUBLISH,i,!0))._message}catch(s){if(n&&s.data&&s.data.code===xe.ERR_PUBLISH_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),s.toString()),await this.tryUnpubBeforeRepub(t,r),this.publish(t,r,!1);throw s}}async publishDataChannel(t,r,n){var i;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ee($.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={stream_id:r.streamId,ordered:r.ordered?1:0,max_retrans_times:(i=r.maxRetransmits)!==null&&i!==void 0?i:10,channel_id:r.channelId,metadata:r.metadata};try{await this.signal.request($e.PUBLISH_DATASTREAM,s,!0)}catch(o){if(n&&o.data&&o.data.code===xe.ERR_PUBLISH_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),o.toString()),await this.tryUnpubDataChannelBeforeRepub(t,r),this.publishDataChannel(t,r,!1);throw o}}async unpublish(t,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ee($.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request($e.UNPUBLISH,{stream_id:r,ortc:t},!0)}catch(n){C.warning("[".concat(this.store.clientId,"] unpublish warning: "),n)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ee($.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await _e.all(t.map(r=>this.signal.request($e.UNPUBLISH_DATASTREAM,{channel_id:r},!0)))}catch(r){C.warning("unpublish datachannels warning: ",r)}}async presubscribe(t,r,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ee($.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:r,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!W("SUBSCRIBE_TWCC"),rtx:!!W("USE_SUB_RTX")||void 0,extend:W("SUB_EXTEND"),svc:Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0};try{return await this.signal.request($e.PRE_SUBSCRIBE,i,!0)}catch(s){if(n&&s.data&&s.data.code===xe.ERR_SUBSCRIBE_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),s.toString()),this.presubscribe(t,r,!1);throw s}}async subscribe(t,r,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ee($.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:r.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!W("SUBSCRIBE_TWCC"),rtx:!!W("USE_SUB_RTX"),extend:W("SUB_EXTEND"),ssrcId:r.ssrcId,svc:Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0};try{return(await this.signal.request($e.SUBSCRIBE,i,!0))._message}catch(s){if(n&&s.data&&s.data.code===xe.ERR_SUBSCRIBE_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),s.toString()),await this.tryUnsubBeforeResub(t,r),await this.subscribe(t,r,!1);throw s}}async subscribeDataChannel(t,r,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ee($.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const i={uid:t,stream_id:r.id,channel_id:r.datachannelId};try{return void await this.signal.request($e.SUBSCRIBE_DATASTREAM,i,!0)}catch(s){if(n&&s.data&&s.data.code===xe.ERR_SUBSCRIBE_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),s.toString()),await this.tryUnsubDataChannelBeforeResub(t,r),await this.subscribeDataChannel(t,r,!1);throw s}}async subscribeAll(t,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ee($.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const n={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!W("USE_SUB_RTX"),twcc:!!W("SUBSCRIBE_TWCC"),svc:Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0};try{return await this.signal.request($e.SUBSCRIBE_STREAMS,n,!0)}catch(i){if(r&&i.data&&i.data.code===xe.ERR_SUBSCRIBE_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),i.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw i}}async setVideoProfile(t){const r=function(n){if(!(n.bitrateMax&&n.bitrateMin&&n.frameRate&&n.height&&n.width))return;let i=n.frameRate,s=n.width,o=n.height,a=!0;return typeof i!="number"&&(i=i.exact||i.ideal||i.max||i.min||0,i||(a=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(a=!1)),typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,i||(a=!1)),a?{stream_type:0,width:s,height:o,fps:i,start_bps:1e3*n.bitrateMax,min_bps:1e3*n.bitrateMin,target_bps:1e3*n.bitrateMax}:void 0}(t);if(r)return this.signal.request($e.SET_VIDEO_PROFILE,r);C.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,r){try{await this.signal.request($e.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:r},!0)}catch(n){C.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),n)}}async unsubscribeDataChannel(t,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ee($.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await _e.all(t.map(n=>this.signal.request($e.UNSUBSCRIBE_DATASTREAM,{stream_id:n,uid:r},!0)))}catch(n){C.warning("unsubscribeDataChannel warning: ",n)}}async massUnsubscribe(t){try{await this.signal.request($e.UNSUBSCRIBE_STREAMS,t,!0)}catch(r){C.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),r)}}async reconnectPC(t){const{iceParameters:r,dtlsParameters:n,rtpCapabilities:i}=t;return{gatewayEstablishParams:await this.signal.request($e.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:r,dtlsParameters:n,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request($e.GATEWAY_INFO)}async renewToken(t){await this.signal.request($e.RENEW_TOKEN,t),this.key=t.token}async setClientRole(t,r){if(r&&(this._clientRoleOptions=Object.assign({},r)),this.state!=="CONNECTED")return void(this.role=t);let n,i=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(n=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0,await this.signal.request($e.SET_CLIENT_ROLE,{role:t,level:i,delay:n,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,r){await this.signal.request($e.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:r})}async setDefaultRemoteVideoStreamType(t){await this.signal.request($e.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,r){await this.signal.request($e.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:r})}async pickSVCLayer(t,r){await this.signal.request($e.PICK_SVC_LAYER,{stream_id:t,spatial_layer:r.spatialLayer,temporal_layer:r.temporalLayer})}async setRTM2Flag(t){await this.signal.request($e.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,r,n){if(this.signal instanceof Y7)return this.signal.sendExtensionMessage(t,r,n)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Bl({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request($e.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=FC.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(r){let n;return n=r.startsWith("dc")?r.match(/(dc\:\/\/)?([^:]+):(\d+)/):r.match(/(wss\:\/\/)?([^:]+):(\d+)/),n?{username:Ln.username,password:Ln.password,turnServerURL:n[2],tcpport:parseInt(n[3])+30,udpport:parseInt(n[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Bl(Bl({},Ln),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request($e.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(r=>{const n=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(i=>i.peer_uid===r.peer_uid);n&&n.B_st!==r.B_st&&cT(()=>{this.emit(kn.STREAM_TYPE_CHANGE,r.peer_uid,r.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new ee($.UNEXPECTED_ERROR,"can not generate join message, no join info");const r=Object.assign({},this.joinInfo.apResponse);let n=W("REPORT_APP_SCENARIO");if(typeof n!="string")try{n=JSON.stringify(n)}catch{n=void 0}n&&n.length>128&&(n=void 0);const i=!(Dr()||$Y(87)||_9())&&typeof W("ENABLE_PRE_SUB")=="boolean"&&W("ENABLE_PRE_SUB"),s=!_9()&&xc("ENABLE_PREALLOC_PC","boolean"),o=Bl({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:xo,browser:navigator.userAgent,process_id:W("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:r,extend:W("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:n,attributes:{userAttributes:{enablePublishedUserList:W("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:W("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof W("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?W("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof W("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?W("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof W("ENABLE_USER_LICENSE_CHECK")=="boolean"?W("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:W("USE_PUB_RTX")===!0||W("USE_SUB_RTX")===!0||void 0,disableFEC:W("DISABLE_FEC"),enableNTPReport:!!W("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!W("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!W("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:xc("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!W("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!W("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:xc("USE_XR","boolean"),enableLossbasedBwe:xc("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!W("ENABLE_AUT_CC")||void 0,enableCCFallback:xc("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:s,preSubNum:i?xc("PRE_SUB_NUM","number"):void 0,enablePubTWCC:xc("PUBLISH_TWCC","boolean"),enableSubTWCC:xc("SUBSCRIBE_TWCC","boolean"),enablePubRTX:xc("USE_PUB_RTX","boolean"),enableSubRTX:xc("USE_SUB_RTX","boolean"),enableSubSVC:W("ENABLE_SVC")?W("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0}},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(o.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(o.aes_mode=this.joinInfo.aesmode,W("ENCRYPT_AES")?(o.aes_secret=this.joinInfo.aespassword,o.aes_encrypt=!0):o.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(o.aes_salt=this.joinInfo.aessalt)),r.addresses[this.signal.websocket.currentURLIndex]&&(o.ap_response.ticket=r.addresses[this.signal.websocket.currentURLIndex].ticket,delete r.addresses),this.joinInfo.defaultVideoStream!==void 0&&(o.default_video_stream=this.joinInfo.defaultVideoStream),o}getRejoinMessage(){if(!this.joinInfo)throw new ee($.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(He.WS_RECONNECT_WAITTING_FINISH,t=>{var r;Ee(r=["tryNext","recover"]).call(r,t)&&this.joinInfo&&Ce.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(He.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(He.WS_RECONNECTING,t=>{this.joinInfo&&Ce.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Un.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Ce.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:2}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(He.WS_CLOSED,t=>{let r;switch(t){case Vt.LEAVE:r=Un.LEAVE;break;case Vt.UID_BANNED:case Vt.IP_BANNED:case Vt.CHANNEL_BANNED:case Vt.SERVER_ERROR:r=Un.SERVER_ERROR;break;case Vt.FALLBACK:r=Un.FALLBACK;break;case Vt.LICENSE_MISSING:case Vt.LICENSE_EXPIRED:case Vt.LICENSE_MINUTES_EXCEEDED:case Vt.LICENSE_PERIOD_INVALID:case Vt.LICENSE_MULTIPLE_SDK_SERVICE:case Vt.LICENSE_ILLEGAL:case Vt.TOKEN_EXPIRE:r=t;break;default:r=Un.NETWORK_ERROR}C.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(r||"undefined -> "+Un.NETWORK_ERROR)),this.joinInfo&&Ce.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Vt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r}),this._disconnectedReason=t,t!==Vt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(He.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(C.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),Ce.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void C.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));Gt("EVENT_REPORT_DOMAIN",t[1]),Gt("EVENT_REPORT_BACKUP_DOMAIN",t[1]),Gt("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}),this.signal.on(ft.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(He.REQUEST_RECOVER,(t,r,n)=>{if(!this.joinInfo)return n(new ee($.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Vn(this,kn.REQUEST_NEW_GATEWAY_LIST).then(r).catch(n)}),this.signal.on(He.REQUEST_JOIN_INFO,async t=>{var r;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const{iceParameters:n,dtlsParameters:i,rtpCapabilities:s}=await Vn(this,kn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(r=this.joinInfo)===null||r===void 0?void 0:r.turnServer});t(this.getJoinMessage({ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:s,version:"2"}}))}),this.signal.on(He.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(He.REPORT_JOIN_GATEWAY,(t,r)=>{if(!this.joinInfo)return;let n,i="";var s;t instanceof ee?(n=((s=t.data)===null||s===void 0?void 0:s.desc)||t.code,i=t.message):n=t,Ce.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:n,errorMsg:i,addr:r,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1}),this.signal.on(He.IS_P2P_DISCONNECTED,t=>{t(hE(this,kn.IS_P2P_DISCONNECTED))}),this.signal.on(He.DISCONNECT_P2P,()=>{this.emit(kn.DISCONNECT_P2P)}),this.signal.on(He.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(He.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(He.JOIN_RESPONSE,t=>{const r=this.getCurrentGatewayAddress();this.emit(kn.JOIN_RESPONSE,t,r)}),this.signal.on(He.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const t=this.getCurrentGatewayAddress(),r=W("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(t&&r){const n=WJ(t);this.emit(kn.PRE_CONNECT_PC,{candidates:n,fingerprint:r})}}}),this.signal.on(He.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof W("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(W("AP_REQUEST_DETAIL"),";").concat(t))})}async tryUnsubBeforeResub(t,r){try{await this.signal.request($e.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[r]},!0)}catch(n){throw C.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),n),n}}async tryUnsubDataChannelBeforeResub(t,r){try{await this.signal.request($e.UNSUBSCRIBE,{stream_id:r.id},!0)}catch(n){throw C.warning("unsubscribe datachannel warning",n),n}}async tryUnpubBeforeRepub(t,r){try{await this.signal.request($e.UNPUBLISH,{stream_id:t,ortc:r},!0)}catch(n){throw C.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),n),n}}async tryUnpubDataChannelBeforeRepub(t,r){try{await this.signal.request($e.UNPUBLISH_DATASTREAM,{channnel_id:r.channelId},!0)}catch(n){throw C.warning("unpublish datastream warning: ",n),n}}async tryMassUnsubBeforeResub(t){const r={users:t.map(n=>({stream_id:n.stream_id,stream_type:n.stream_type}))};try{await this.signal.request($e.UNSUBSCRIBE_STREAMS,r,!0)}catch(n){throw C.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),n),n}}async muteLocal(t,r){const n={action:t.find(i=>i.stream_type===jt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request($e.CONTROL,n,!0,!0)}catch(i){throw C.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),i),i}}async unmuteLocal(t,r){const n={action:t.find(i=>i.stream_type===jt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request($e.CONTROL,n,!0,!0)}catch(i){throw C.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),i),i}}async muteRemote(t,r){const n={action:t===Oe.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request($e.CONTROL,n,!0,!0)}catch(i){throw C.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),i),i}}async unmuteRemote(t,r){const n={action:t===Oe.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request($e.CONTROL,n,!0,!0)}catch(i){throw C.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),i),i}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,r){this.signal.upload(t,r)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const r={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request($e.RESTART_ICE,r,!0)}catch(n){throw C.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),n),n}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,Un.P2P_FAILED)}getCurrentGatewayAddress(){var t,r;if(!W("GATEWAY_WSS_ADDRESS"))return W("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(C.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(r=this.joinInfo)!==null&&r!==void 0&&r.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request($e.SET_PARAMETER,{enablePublishAudioFilter:t})}}let Cy=0,BC=0;function Rc(e,t,r,n){return new _e((i,s)=>{t.timeout=t.timeout||W("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),Cy+=ed(t.data)):r&&(t.data.size?Cy+=t.data.size:t.data instanceof FormData?Cy+=ZY(t.data):Cy+=ed(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Hi.request(t).then(o=>{typeof o.data=="string"?BC+=ed(o.data):o.data instanceof ArrayBuffer||o.data instanceof Uint8Array?BC+=o.data.byteLength:BC+=ed(JSON.stringify(o.data)),n&&i({data:o.data,headers:o.headers}),i(o.data)}).catch(o=>{Hi.isCancel(o)?s(new ee($.OPERATION_ABORTED,"cancel token canceled")):o.code==="ECONNABORTED"?s(new ee($.NETWORK_TIMEOUT,o.message)):o.response?s(new ee($.NETWORK_RESPONSE_ERROR,o.response.status)):s(new ee($.NETWORK_ERROR,o.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(D){var k=0;return function(){return k<D.length?{done:!1,value:D[k++]}:{done:!0}}}var r=typeof Object.defineProperties=="function"?Object.defineProperty:function(D,k,P){return D==Array.prototype||D==Object.prototype||(D[k]=P.value),D},n,i=function(D){D=[typeof globalThis=="object"&&globalThis,D,typeof window=="object"&&window,typeof self=="object"&&self,typeof cm=="object"&&cm];for(var k=0;k<D.length;++k){var P=D[k];if(P&&P.Math==Math)return P}throw Error("Cannot find global object")}(this);function s(D,k){if(k)e:{var P=i;D=D.split(".");for(var y=0;y<D.length-1;y++){var f=D[y];if(!(f in P))break e;P=P[f]}(k=k(y=P[D=D[D.length-1]]))!=y&&k!=null&&r(P,D,{configurable:!0,writable:!0,value:k})}}function o(D){return(D={next:D})[Symbol.iterator]=function(){return this},D}function a(D){var k=typeof Symbol<"u"&&Symbol.iterator&&D[Symbol.iterator];return k?k.call(D):{next:t(D)}}if(s("Symbol",function(D){function k(f,R){this.A=f,r(this,"description",{configurable:!0,writable:!0,value:R})}if(D)return D;k.prototype.toString=function(){return this.A};var P="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",y=0;return function f(R){if(this instanceof f)throw new TypeError("Symbol is not a constructor");return new k(P+(R||"")+"_"+y++,R)}}),s("Symbol.iterator",function(D){if(D)return D;D=Symbol("Symbol.iterator");for(var k="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),P=0;P<k.length;P++){var y=i[k[P]];typeof y=="function"&&typeof y.prototype[D]!="function"&&r(y.prototype,D,{configurable:!0,writable:!0,value:function(){return o(t(this))}})}return D}),typeof Object.setPrototypeOf=="function")n=Object.setPrototypeOf;else{var c;e:{var d={};try{d.__proto__={a:!0},c=d.a;break e}catch{}c=!1}n=c?function(D,k){if(D.__proto__=k,D.__proto__!==k)throw new TypeError(D+" is not extensible");return D}:null}var l=n;function u(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function h(D){if(D.m)throw new TypeError("Generator is already running");D.m=!0}function p(D,k){return D.h=3,{value:k}}function _(D){this.g=new u,this.G=D}function g(D,k,P,y){try{var f=k.call(D.g.j,P);if(!(f instanceof Object))throw new TypeError("Iterator result "+f+" is not an object");if(!f.done)return D.g.m=!1,f;var R=f.value}catch(B){return D.g.j=null,D.g.s(B),E(D)}return D.g.j=null,y.call(D.g,R),E(D)}function E(D){for(;D.g.h;)try{var k=D.G(D.g);if(k)return D.g.m=!1,{value:k.value,done:!1}}catch(P){D.g.v=void 0,D.g.s(P)}if(D.g.m=!1,D.g.l){if(k=D.g.l,D.g.l=null,k.F)throw k.D;return{value:k.return,done:!0}}return{value:void 0,done:!0}}function b(D){this.next=function(k){return D.o(k)},this.throw=function(k){return D.s(k)},this.return=function(k){return function(P,y){h(P.g);var f=P.g.j;return f?g(P,"return"in f?f.return:function(R){return{value:R,done:!0}},y,P.g.return):(P.g.return(y),E(P))}(D,k)},this[Symbol.iterator]=function(){return this}}function v(D,k){return k=new b(new _(k)),l&&D.prototype&&l(k,D.prototype),k}if(u.prototype.o=function(D){this.v=D},u.prototype.s=function(D){this.l={D,F:!0},this.h=this.C||this.u},u.prototype.return=function(D){this.l={return:D},this.h=this.u},_.prototype.o=function(D){return h(this.g),this.g.j?g(this,this.g.j.next,D,this.g.o):(this.g.o(D),E(this))},_.prototype.s=function(D){return h(this.g),this.g.j?g(this,this.g.j.throw,D,this.g.o):(this.g.s(D),E(this))},s("Array.prototype.entries",function(D){return D||function(){return function(k,P){k instanceof String&&(k+="");var y=0,f=!1,R={next:function(){if(!f&&y<k.length){var B=y++;return{value:P(B,k[B]),done:!1}}return f=!0,{done:!0,value:void 0}}};return R[Symbol.iterator]=function(){return R},R}(this,function(k,P){return[k,P]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var I=function(D,k){for(var P=0;P<D.length;P++)k(D[P])},N=function(D){return D.replace(/\r?\n|\r/g,`\r
`)},L=function(D,k,P){return k instanceof Blob?(P=P!==void 0?P+"":typeof k.name=="string"?k.name:"blob",k.name===P&&Object.prototype.toString.call(k)!=="[object Blob]"||(k=new File([k],P)),[String(D),k]):[String(D),String(k)]},U=function(D,k){if(D.length<k)throw new TypeError(k+" argument required, but only "+D.length+" present.")},w=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,V=w.FormData,z=w.XMLHttpRequest&&w.XMLHttpRequest.prototype.send,K=w.Request&&w.fetch,H=w.navigator&&w.navigator.sendBeacon,A=w.Element&&w.Element.prototype,m=w.Symbol&&Symbol.toStringTag;m&&(Blob.prototype[m]||(Blob.prototype[m]="Blob"),"File"in w&&!File.prototype[m]&&(File.prototype[m]="File"));try{new File([],"")}catch{w.File=function(k,P,y){return k=new Blob(k,y||{}),Object.defineProperties(k,{name:{value:P},lastModified:{value:+(y&&y.lastModified!==void 0?new Date(y.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),m&&Object.defineProperty(k,m,{value:"File"}),k}}var S=function(D){return D.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},T=function(D){this.i=[];var k=this;D&&I(D.elements,function(P){if(P.name&&!P.disabled&&P.type!=="submit"&&P.type!=="button"&&!P.matches("form fieldset[disabled] *"))if(P.type==="file"){var y=P.files&&P.files.length?P.files:[new File([],"",{type:"application/octet-stream"})];I(y,function(f){k.append(P.name,f)})}else P.type==="select-multiple"||P.type==="select-one"?I(P.options,function(f){!f.disabled&&f.selected&&k.append(P.name,f.value)}):P.type==="checkbox"||P.type==="radio"?P.checked&&k.append(P.name,P.value):(y=P.type==="textarea"?N(P.value):P.value,k.append(P.name,y))})};if((e=T.prototype).append=function(D,k,P){U(arguments,2),this.i.push(L(D,k,P))},e.delete=function(D){U(arguments,1);var k=[];D=String(D),I(this.i,function(P){P[0]!==D&&k.push(P)}),this.i=k},e.entries=function D(){var k,P=this;return v(D,function(y){if(y.h==1&&(k=0),y.h!=3)return k<P.i.length?y=p(y,P.i[k]):(y.h=0,y=void 0),y;k++,y.h=2})},e.forEach=function(D,k){U(arguments,1);for(var P=a(this),y=P.next();!y.done;y=P.next()){var f=a(y.value);y=f.next().value,f=f.next().value,D.call(k,f,y,this)}},e.get=function(D){U(arguments,1);var k=this.i;D=String(D);for(var P=0;P<k.length;P++)if(k[P][0]===D)return k[P][1];return null},e.getAll=function(D){U(arguments,1);var k=[];return D=String(D),I(this.i,function(P){P[0]===D&&k.push(P[1])}),k},e.has=function(D){U(arguments,1),D=String(D);for(var k=0;k<this.i.length;k++)if(this.i[k][0]===D)return!0;return!1},e.keys=function D(){var k,P,y,f,R=this;return v(D,function(B){if(B.h==1&&(k=a(R),P=k.next()),B.h!=3)return P.done?void(B.h=0):(y=P.value,f=a(y),p(B,f.next().value));P=k.next(),B.h=2})},e.set=function(D,k,P){U(arguments,2),D=String(D);var y=[],f=L(D,k,P),R=!0;I(this.i,function(B){B[0]===D?R&&(R=!y.push(f)):y.push(B)}),R&&y.push(f),this.i=y},e.values=function D(){var k,P,y,f,R=this;return v(D,function(B){if(B.h==1&&(k=a(R),P=k.next()),B.h!=3)return P.done?void(B.h=0):(y=P.value,(f=a(y)).next(),p(B,f.next().value));P=k.next(),B.h=2})},T.prototype._asNative=function(){for(var D=new V,k=a(this),P=k.next();!P.done;P=k.next()){var y=a(P.value);P=y.next().value,y=y.next().value,D.append(P,y)}return D},T.prototype._blob=function(){var D="----formdata-polyfill-"+Math.random(),k=[],P="--"+D+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(y,f){return typeof y=="string"?k.push(P+S(N(f))+`"\r
\r
`+N(y)+`\r
`):k.push(P+S(N(f))+'"; filename="'+S(y.name)+`"\r
Content-Type: `+(y.type||"application/octet-stream")+`\r
\r
`,y,`\r
`)}),k.push("--"+D+"--"),new Blob(k,{type:"multipart/form-data; boundary="+D})},T.prototype[Symbol.iterator]=function(){return this.entries()},T.prototype.toString=function(){return"[object FormData]"},A&&!A.matches&&(A.matches=A.matchesSelector||A.mozMatchesSelector||A.msMatchesSelector||A.oMatchesSelector||A.webkitMatchesSelector||function(D){for(var k=(D=(this.document||this.ownerDocument).querySelectorAll(D)).length;0<=--k&&D.item(k)!==this;);return-1<k}),m&&(T.prototype[m]="FormData"),z){var x=w.XMLHttpRequest.prototype.setRequestHeader;w.XMLHttpRequest.prototype.setRequestHeader=function(D,k){x.call(this,D,k),D.toLowerCase()==="content-type"&&(this.B=!0)},w.XMLHttpRequest.prototype.send=function(D){D instanceof T?(D=D._blob(),this.B||this.setRequestHeader("Content-Type",D.type),z.call(this,D)):z.call(this,D)}}K&&(w.fetch=function(D,k){return k&&k.body&&k.body instanceof T&&(k.body=k.body._blob()),K.call(this,D,k)}),H&&(w.navigator.sendBeacon=function(D,k){return k instanceof T&&(k=k._asNative()),H.call(this,D,k)}),w.FormData=T}})();const EE=()=>{const e=W("AREAS");return e.length===0&&e.push(Dt.GLOBAL),yc(e).call(e,(t,r,n)=>{const i=XJ(r);return i?n===0?i:"".concat(t,",").concat(i):t},"")},XJ=e=>e===Dt.OVERSEA?"".concat(zn.ASIA,",").concat(zn.EUROPE,",").concat(zn.AFRICA,",").concat(zn.NORTH_AMERICA,",").concat(zn.SOUTH_AMERICA,",").concat(zn.OCEANIA):zn[e],gLe=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(r=>{const n=fT[r],i=Object.keys(n);i&&i.map(s=>{s!=="CODE"&&(t[s]=t[s].concat(n[s]))})}),t},Bb={GLOBAL:{ASIA:[Dt.CHINA,Dt.JAPAN,Dt.INDIA,Dt.KOREA,Dt.HKMC],EUROPE:[],NORTH_AMERICA:[Dt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Iy=Object.keys(Bb[Dt.GLOBAL]),VC=[Dt.CHINA,Dt.NORTH_AMERICA,Dt.EUROPE,Dt.ASIA,Dt.JAPAN,Dt.INDIA,Dt.OCEANIA,Dt.SOUTH_AMERICA,Dt.AFRICA,Dt.KOREA,Dt.HKMC,Dt.US],_Le=function(e,t){let r=[];if(Ee(e).call(e,Dt.GLOBAL)){const s=[Dt.GLOBAL,Dt.OVERSEA],o=Object.keys(fT);if(t===Dt.GLOBAL)throw new ee($.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Dt.CHINA)r=[Dt.OVERSEA];else if(i=t,Ee(Iy).call(Iy,i)){const a=(n=t,Bb[Dt.GLOBAL][n]||[]),c=[...s,t,...a];r=o.filter(d=>!Ee(c).call(c,d))}else if(function(a){let c=!1;return Iy.forEach(d=>{var l;Ee(l=Bb[Dt.GLOBAL][d]).call(l,a)&&(c=!0)}),c}(t)){const a=function(d){let l;return Iy.forEach(u=>{var h;Ee(h=Bb[Dt.GLOBAL][u]).call(h,d)&&(l=u)}),l}(t),c=[...s,a,t];r=o.filter(d=>!Ee(c).call(c,d))}else r=e;r=function(a){const c=[];return VC.forEach(d=>{Ee(a).call(a,d)&&c.push(d)}),c.concat(a.filter(d=>!Ee(VC).call(VC,d)))}(r)}else r=e;var n,i;return r};function tj(e){var t,r;if(!e&&Ee(t=W("AREAS")).call(t,Dt.EXTENSIONS))return C.debug("update area from ap : reset"),void U3(GPe,!0);if(!Ee(r=W("AREAS")).call(r,Dt.GLOBAL)||!e)return;let n=fT.EXTENSIONS;n&&(n={CODE:XJ(Dt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},C.debug("update area from ap success: ".concat(e,",config is "),n),Gt("AREAS",[Dt.EXTENSIONS],!0),Object.keys(n).map(i=>{i==="LOG_UPLOAD_SERVER"||i==="EVENT_REPORT_DOMAIN"||i==="EVENT_REPORT_BACKUP_DOMAIN"||i==="PROXY_SERVER_TYPE3"?Gt(i,n[i][0]):Gt(i,n[i])}))}function U3(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=Ce.reportApiInvoke(null,{name:Zr.SET_AREA,options:e,tag:Or.TRACER});try{let n=[];if(typeof e=="string"&&(n=[e]),Array.isArray(e)&&(e.forEach(s=>{if(!Ee(jU).call(jU,s))throw new ee($.INVALID_PARAMS,"invalid area code")}),n=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:s,excludedArea:o}=e;if(!s)throw new ee($.INVALID_PARAMS,"area code is needed");let a=s;typeof s=="string"&&(a=[s]),n=o?_Le(a,o):a}if(!t){if(pu.AREAS){const s=new ee($.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r.onError(s),void C.warning("setArea is prohibited because of config-distribute")}if(Ee(n).call(n,Dt.GLOBAL)&&W("AREAS")===Dt.EXTENSIONS){const s=new ee($.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r.onError(s),void C.warning("setArea is prohibited because of ap extensions")}}Gt("AREAS",n,t);const i=gLe(n);Object.keys(i).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?Gt(s,i[s][0]):Gt(s,i[s])}),C.debug("set area success:",n.join(","))}catch(n){throw r.onError(n),n}r.onSuccess()}function rj(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function AS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?rj(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rj(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}let $C=1;function ELe(e,t,r,n,i){$C+=1;const s={sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(Date.now()/1e3),seq:$C,requestId:$C,version:xo,cname:r.cname},o={service_name:t,json_body:JSON.stringify(s)};let a,c,d=e[0];return Tc(async()=>{a=Date.now();const l=await Rc(d,{data:o,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(c=Date.now()-a,l.code!==0){const p=new ee($.UNEXPECTED_RESPONSE,"live streaming ap error, code"+l.code,{retry:!0,responseTime:c});throw C.error(p.toString()),p}const u=JSON.parse(l.json_body);if(u.code!==200){const p=new ee($.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(u.code,", reason: ").concat(u.reason),{code:u.code,responseTime:c});throw C.error(p.toString()),p}if(!u.servers||u.servers.length===0){const p=new ee($.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:u.code,responseTime:c});throw C.error(p.toString()),p}const h=function(p,_){return{addressList:p.servers.map(g=>"wss://".concat(g.address.replace(/\./g,"-"),".").concat(W("WORKER_DOMAIN"),":").concat(g.wss,"?serviceName=").concat(encodeURIComponent(_))),workerToken:p.workerToken,vid:p.vid}}(u,t);return W("LIVE_STREAMING_ADDRESS")&&(h.addressList=W("LIVE_STREAMING_ADDRESS")instanceof Array?W("LIVE_STREAMING_ADDRESS"):[W("LIVE_STREAMING_ADDRESS")]),AS(AS({},h),{},{responseTime:c})},(l,u)=>(Ce.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(l.addressList),firstSuccess:u===0,responseTime:c,serverIp:e[u%e.length]}),!1),(l,u)=>(Ce.apworkerEvent(r.sid,{success:!1,sc:l.data&&l.data.code||200,serviceName:t,responseTime:c,serverIp:e[u%e.length]}),!!(l.code!==$.OPERATION_ABORTED&&l.code!==$.UNEXPECTED_RESPONSE||l.data&&l.data.retry)&&(d=e[(u+1)%e.length],!0)),i)}let HC=1;function nj(e,t,r,n){let{url:i,areaCode:s}=e;const{clientId:o,sid:a}=t,c=Date.now();let d;const[l,u]=F3(t,s,[zr.CHOOSE_SERVER]);let h=Wr.networkState;return Tc(async()=>{h&&Wr.networkState===bs.OFFLINE&&Wr.onlineWaiter&&await _e.race([Wr.onlineWaiter,In(n&&n.maxRetryTimeout||Kr.maxRetryTimeout)]),h=Wr.networkState;const{data:p,headers:_}=await Rc(i,{data:l,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);d=_.http3==="1"?1:-1,Ce.reportResourceTiming(i,a),QJ(p,i,t,c,[zr.CHOOSE_SERVER],d);const g=gE(p,zr.CHOOSE_SERVER);return j3(g),A3(g,i)},p=>(p&&Ce.joinChooseServer(a,{lts:c,succ:!0,csAddr:i,opid:u,serverList:p.gatewayAddrs.map(_=>_.address),ec:null,cid:p.cid.toString(),uid:p.uid.toString(),csIp:p.csIp,unilbsServerIds:[zr.CHOOSE_SERVER].toString(),isHttp3:d,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:p.res.detail&&p.res.detail[38]}),!1),p=>p.code!==$.OPERATION_ABORTED&&(p.code===$.CAN_NOT_GET_GATEWAY_SERVER?p.data.retry:(Ce.joinChooseServer(a,{lts:c,succ:!1,csAddr:i,serverList:null,opid:u,ec:p.code,csIp:p.data&&p.data.csIp,unilbsServerIds:[zr.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:h}),isHttp3:d,corssRegionTagReq:t.apRequestDetail}),C.warning("[".concat(o||"sid-".concat(a.slice(0,6)),"] Choose server network error, retry"),p),!0)),n)}function ij(e,t,r,n){let i,{url:s,areaCode:o,serviceIds:a}=e;const c=Date.now(),[d,l]=F3(t,o,a);let u;return Tc(async()=>{u&&Wr.networkState===bs.OFFLINE&&Wr.onlineWaiter&&await _e.race([Wr.onlineWaiter,In(n&&n.maxRetryTimeout||Kr.maxRetryTimeout)]),u=Wr.networkState;const{data:h,headers:p}=await Rc(s,{data:d,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i=p.http3==="1"?1:-1,Ce.reportResourceTiming(s,t.sid),QJ(h,s,t,c,a,i);const _=gE(h,zr.CHOOSE_SERVER),g=gE(h,t.cloudProxyServer==="proxy5"?zr.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?zr.CLOUD_PROXY:zr.CLOUD_PROXY_FALLBACK);return j3(_),{gatewayInfo:A3(_,s),proxyInfo:g,url:s}},h=>(h.gatewayInfo&&Ce.joinChooseServer(t.sid,{lts:c,succ:!0,csAddr:s,serverList:h.gatewayInfo.gatewayAddrs.map(p=>p.address),ec:null,opid:l,cid:h.gatewayInfo.cid.toString(),uid:h.gatewayInfo.uid.toString(),csIp:h.gatewayInfo.csIp,unilbsServerIds:a.toString(),isHttp3:i,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:h.gatewayInfo.res.detail&&h.gatewayInfo.res.detail[38]}),h.proxyInfo&&Ce.joinWebProxyAP(t.sid,{lts:c,sucess:1,apServerAddr:s,turnServerAddrList:h.proxyInfo.addresses.map(p=>p.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:a.toString()}),!1),h=>h.code!==$.OPERATION_ABORTED&&(h.code===$.CAN_NOT_GET_GATEWAY_SERVER?h.data.retry:(Ce.joinWebProxyAP(t.sid,{lts:c,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:h.code,eventType:t.cloudProxyServer,unilbsServerIds:a.toString(),extend:JSON.stringify({networkState:u})}),C.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),h),!0)),n)}const QJ=(e,t,r,n,i,s)=>{const{sid:o,clientId:a,cloudProxyServer:c}=r,d=[],l=u=>{u.flag===4096?Ce.joinChooseServer(o,{lts:n,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:u.error.message,csIp:u.error.data&&u.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:s,corssRegionTagReq:r.apRequestDetail}):u.flag!==1048576&&u.flag!==4194304&&u.flag!==4194310||Ce.joinWebProxyAP(o,{lts:n,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:u.error.code,eventType:c,unilbsServerIds:i.toString()})};if(e.response_body.forEach(u=>{const h=u.buffer.code;if(u.uri===23&&h===0&&!u.buffer.edges_services)if(u.buffer.flag===4194310)C.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),u.buffer.edges_services=[];else{const p={error:new ee($.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:u.buffer.flag};d.push(p),l(p)}if(h!==0){const p=Bm(h),_={error:new ee($.CAN_NOT_GET_GATEWAY_SERVER,p.desc,{desc:p.desc,retry:p.retry,csIp:e.detail[502]}),flag:u.buffer.flag};u.buffer.flag===4194310?C.warning(_.error.toString()):d.push(_),l(_)}}),d.length)throw C.warning("[".concat(a||"sid-".concat(o.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(d.map(u=>"flag: ".concat(u.flag,", message: ").concat(u.error.message,", retry: ").concat(u.error.data.retry)).join(" | "))),new ee($.CAN_NOT_GET_GATEWAY_SERVER,d.map(u=>"flag: ".concat(u.flag,", message: ").concat(u.error.message)).join(" | "),{retry:!!d.find(u=>u.error.data.retry),csIp:e.detail[502],desc:[...new Set(d.map(u=>{var h;return u==null||(h=u.error)===null||h===void 0||(h=h.data)===null||h===void 0?void 0:h.desc}).filter(u=>!!u))]})},j3=e=>{var t,r,n,i;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new ee($.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(W("AP_AREA")&&((n=e.detail)!==null&&n!==void 0&&n[23]&&typeof((i=e.detail)===null||i===void 0?void 0:i[23])=="string"?tj(e.detail[23].toLowerCase()):tj()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((r=e.detail)===null||r===void 0?void 0:r[19])=="string"){const o=e.detail[19],a=o==null?void 0:o.split(";");for(let c=0;c<a.length;c++){var s;const d=fi(s=a[c]).call(s);e.addresses[c]&&a&&(e.addresses[c].fingerprint=d)}}if(W("GATEWAY_ADDRESS")&&W("GATEWAY_ADDRESS").length>0){C.debug("assign gateway address to",W("GATEWAY_ADDRESS"));const o=W("GATEWAY_ADDRESS").map(a=>{var c,d;const l=(c=(d=e.addresses.find(u=>u.ip===a.ip&&u.port===a.port))===null||d===void 0?void 0:d.fingerprint)!==null&&c!==void 0?c:"";return{ip:a.ip,port:a.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:l}});e.addresses=o}},vLe=(e,t)=>{if(e.response_body&&e.response_body.length){const r=e.response_body[0];if(r.buffer.code!==0){const n=Bm(r.buffer.code);throw new ee($.UPDATE_TICKET_FAILED,"[".concat(r.buffer.code,"]: ").concat(n.desc),{retry:n.retry})}return r.buffer.ticket}throw C.debug("update ticket request received ap response without response body:",t),new ee($.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},F3=(e,t,r)=>{const n=Math.floor(Math.random()*1e12),i={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:AS(AS({6:e.stringUid,11:t,12:W("USE_NEW_TOKEN")?"1":void 0,22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:r,uid:e.uid||0}}]};i.request_bodies.forEach(o=>{e.multiIP&&e.multiIP.gateway_ip&&(o.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const s=new FormData;return s.append("request",JSON.stringify(i)),[s,n]},yLe=(e,t)=>{const r=Math.floor(Math.random()*1e12),n={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(s=>({ip:s.ip,port:s.port}))}}]},i=new FormData;return i.append("request",JSON.stringify(n)),[i,r]};let mm=0;function D0(e){return _e.all(e.map(t=>t.then(r=>{throw r},r=>r))).then(t=>{throw t},t=>t)}const vE=async e=>{let{fragementLength:t,referenceList:r,asyncMapHandler:n,allFailedhandler:i,promisesCollector:s}=e,o=0;const a=t;let c,d=0;const l=async()=>{const u=(()=>{const h=o*a,p=h+a;return r.slice(h,p).map(n)})();s&&s.push(...u);try{c=await D0(u)}catch(h){if(d+=a,o++,!(d>=r.length))return void await l();i(h)}u.forEach(h=>h.cancel())};return await l(),c},ZJ=async e=>{let{referenceList:t,asyncMapHandler:r,closeFn:n}=e;const i=t.length;let s=0;const o=async()=>{const a=r(t.shift());try{return await a}catch(c){if(s++,s>=i||n!=null&&n(c))throw c;return o()}};return o()};async function SN(e,t,r,n){return{gatewayInfo:await async function(s,o,a,c){let d=null;const l=[],u=async()=>{const p=W("WEBCS_DOMAIN").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(E=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(E+"/api/v2/transpond/webrtc?v=2"):"https://".concat(E,"/api/v2/transpond/webrtc?v=2"),areaCode:EE()})),_=c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:p.map(E=>E.url)}),g=await vE({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:p,asyncMapHandler:E=>(C.debug("[".concat(s.clientId,"] Connect to choose_server:"),E.url),nj(E,s,o,a)),allFailedhandler:E=>{throw c.recordJoinChannelService({endTs:Date.now(),status:"error",errors:E},_),E[0]},promisesCollector:l});return c.recordJoinChannelService({endTs:Date.now(),status:"success"},_),g},h=async()=>{if(await In(1e3),d!==null)return d;const p=W("WEBCS_DOMAIN_BACKUP_LIST").map(E=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(E+"/api/v2/transpond/webrtc?v=2"):"https://".concat(E,"/api/v2/transpond/webrtc?v=2"),areaCode:EE()})),_=c.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:p.map(E=>E.url)}),g=await vE({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:p,asyncMapHandler:E=>(C.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),E.url),nj(E,s,o,a)),allFailedhandler:E=>{throw c.recordJoinChannelService({endTs:Date.now(),status:"error",errors:E},_),E[0]},promisesCollector:l});return c.recordJoinChannelService({endTs:Date.now(),status:"success"},_),g};try{return d=await D0([u(),h()]),l.length&&l.forEach(p=>p.cancel&&typeof p.cancel=="function"&&p.cancel()),d}catch(p){throw p[0]}}(e,t,r,n)}}async function sj(e,t,r,n,i){const s=e.cloudProxyServer;if(s==="disabled"){if(e.useLocalAccessPoint)return await SN(e,t,r,i);if(W("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:h,proxyInfo:p}=await aj(e,t,r,i);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:h};const _=p.map(g=>({turnServerURL:g.address,tcpport:g.tcpport||Ln.tcpport,udpport:g.udpport||Ln.udpport,username:g.username||Ln.username,password:g.password||Ln.password,forceturn:!1,security:!0}));if(i.useP2P){var o;const g=(o=e.uid)!==null&&o!==void 0?o:h.uid,E="glb:".concat(g.toString()),b=await aN(E),v=p.map(I=>({turnServerURL:I.address,tcpport:I.tcpport||Ln.tcpport,udpport:I.udpport||Ln.udpport,username:E,password:b,forceturn:!1,security:!0}));_.push(...v)}return e.turnServer={mode:"manual",servers:_},{gatewayInfo:h}}return await SN(e,t,r,i)}const{proxyInfo:a,gatewayInfo:c}=await aj(e,t,r,i),d={gatewayInfo:c},l=a.map(h=>({turnServerURL:h.address,tcpport:s==="proxy3"?void 0:h.tcpport?h.tcpport:Ln.tcpport,udpport:s==="proxy4"?void 0:h.udpport?h.udpport:Ln.udpport,username:h.username||Ln.username,password:h.password||Ln.password,forceturn:s!=="proxy4",security:s==="proxy5"}));if(i.useP2P){var u;const h=(u=e.uid)!==null&&u!==void 0?u:c.uid,p="glb:".concat(h.toString()),_=await aN(p),g=a.map(E=>({turnServerURL:E.address,tcpport:s==="proxy3"?void 0:E.tcpport||Ln.tcpport,udpport:s==="proxy4"?void 0:E.udpport||Ln.udpport,username:p,password:_,forceturn:s!=="proxy4",security:s==="proxy5"}));l.push(...g)}return e.turnServer={mode:"manual",servers:l},C.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(s)),d}async function eX(e,t,r,n,i){const s=W("ACCOUNT_REGISTER").slice(0,W("AJAX_REQUEST_CONCURRENT"));let o=[];o=t.proxyServer?s.map(c=>"https://".concat(t.proxyServer,"/ap/?url=").concat(c+"/api/v1")):s.map(c=>"https://".concat(c,"/api/v1"));const a=i==null?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:o});try{const c=await async function(d,l,u,h,p){const _=Date.now(),g={sid:u.sid,opid:10,appid:u.appId,string_uid:l};let E=d[0];const b=await Tc(()=>Rc(E+"".concat(E.indexOf("?")===-1?"?":"&","action=stringuid"),{data:g,cancelToken:h,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(v,I)=>{if(v.code===0){if(v.uid<=0||v.uid>=Math.pow(2,32))throw C.error("Invalid Uint Uid ".concat(l," => ").concat(v.uid),v),Ce.reqUserAccount(g.sid,{lts:_,success:!1,serverAddr:E,stringUid:g.string_uid,uid:v.uid,errorCode:$.INVALID_UINT_UID_FROM_STRING_UID,extend:g}),new ee($.INVALID_UINT_UID_FROM_STRING_UID);return Ce.reqUserAccount(g.sid,{lts:_,success:!0,serverAddr:E,stringUid:g.string_uid,uid:v.uid,errorCode:null,extend:g}),!1}const N=Bm(v.code);return N.retry&&(E=d[(I+1)%d.length]),Ce.reqUserAccount(g.sid,{lts:_,success:!1,serverAddr:E,stringUid:g.string_uid,uid:v.uid,errorCode:N.desc,extend:g}),N.retry},(v,I)=>v.code!==$.OPERATION_ABORTED&&(Ce.reqUserAccount(g.sid,{lts:_,success:!1,serverAddr:E,stringUid:g.string_uid,uid:null,errorCode:v.code,extend:g}),E=d[(I+1)%d.length],!0),p);if(b.code!==0){const v=Bm(b.code);throw new ee($.UNEXPECTED_RESPONSE,v.desc)}return b}(o,e,t,r,n);return i==null||i.recordJoinChannelService({status:"success",endTs:Date.now()},a),c.uid}catch(c){throw i==null||i.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[c]},a),c}}async function bLe(e,t,r){const n=W("ACCOUNT_REGISTER");let i=[];i=t.proxyServer?n.map(s=>"https://".concat(t.proxyServer,"/ap/?url=").concat(s+"/api/v1")):n.map(s=>"https://".concat(s,"/api/v1"));try{return await ZJ({referenceList:i,asyncMapHandler:o=>async function(a,c,d,l){const u=Date.now(),h={sid:d.sid,opid:10,appid:d.appId,string_uid:c};try{const p=await Rc(a+"".concat(a.indexOf("?")===-1?"?":"&","action=stringuid"),{data:h,cancelToken:l,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(p.code!==0){const _=Bm(p.code);throw new ee($.UNEXPECTED_RESPONSE,"preload sua error:".concat(_.desc),_)}if(p.uid<=0||p.uid>=Math.pow(2,32))throw new ee($.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:u,url:a,req:h,uid:p.uid,elapse:Date.now()-u}}catch(p){throw p}}(o,e,t,r),closeFn:o=>o.code===$.OPERATION_ABORTED||o.code===$.UNEXPECTED_RESPONSE&&!o.data.retry})}catch(s){throw s}}async function SLe(e,t,r){const n=W("CDS_AP").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(c=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(c+"/api/v1"):"https://".concat(c,"/api/v1?action=config")),i=n.map(c=>function(d,l,u,h){const p=Rt(),_={flag:64,cipher_method:0,features:{device:p.name,system:p.os,system_general:navigator.userAgent,vendor:l.appId,version:xo,cname:l.cname,sid:l.sid,session_id:l.sid,detail:"",proxyServer:l.proxyServer}};return Tc(()=>Rc(d,{data:_,timeout:1e3,cancelToken:u,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,g=>g.code!==$.OPERATION_ABORTED,h)}(c,e,t,r));let s=null,o=null,a={};try{s=await D0(i)}catch(c){if(c.code===$.OPERATION_ABORTED)throw c;o=c}if(i.forEach(c=>c.cancel()),Ce.reportApiInvoke(e.sid,{name:Zr.REQUEST_CONFIG_DISTRIBUTE,options:{error:o,res:s}}).onSuccess(),s&&s.test_tags)try{a=function(c){if(!c.test_tags)return{};const d=c.test_tags,l=Object.keys(d),u={};return l.forEach(h=>{var p;const _=fi(p=h.slice(4)).call(p),g=JSON.parse(d[h])[1];u[_]=g}),u}(s)}catch{}return a}async function oj(e,t){const r=W("WEBCS_DOMAIN").concat(W("WEBCS_DOMAIN_BACKUP_LIST")).map(n=>({url:"https://".concat(n,"/api/v2/transpond/webrtc?v=2"),areaCode:EE(),serviceIds:[zr.CHOOSE_SERVER,zr.CLOUD_PROXY_FALLBACK]}));try{return await ZJ({referenceList:r,asyncMapHandler:i=>async function(s,o,a){let c,{url:d,areaCode:l,serviceIds:u}=s;const h=Date.now(),[p,_]=F3(o,l,u);let g=Wr.networkState;try{g&&Wr.networkState===bs.OFFLINE&&Wr.onlineWaiter&&await _e.race([Wr.onlineWaiter,In(Kr.maxRetryTimeout)]),g=Wr.networkState;const{data:E,headers:b}=await Rc(d,{data:p,cancelToken:a,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=b.http3==="1"?1:-1,(L=>{const U=[];if(L.response_body.forEach(w=>{const V=w.buffer.code;if(w.uri===23&&V===0&&!w.buffer.edges_services)if(w.buffer.flag===4194310)w.buffer.edges_services=[];else{const z={error:new ee($.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:L.detail[502]}),flag:w.buffer.flag};U.push(z)}if(V!==0){const z=Bm(V),K={error:new ee($.CAN_NOT_GET_GATEWAY_SERVER,z.desc,{desc:z.desc,retry:z.retry,csIp:L.detail[502]}),flag:w.buffer.flag};w.buffer.flag===4194310?C.warning(K.error.toString()):U.push(K)}}),U.length)throw new ee($.CAN_NOT_GET_GATEWAY_SERVER,U.map(w=>"flag: ".concat(w.flag,", message: ").concat(w.error.message)).join(" | "),{retry:!!U.find(w=>w.error.data.retry),csIp:L.detail[502],desc:[...new Set(U.map(w=>{var V;return w==null||(V=w.error)===null||V===void 0||(V=V.data)===null||V===void 0?void 0:V.desc}).filter(w=>!!w))]})})(E);const I=gE(E,zr.CHOOSE_SERVER),N=gE(E,zr.CLOUD_PROXY_FALLBACK);return j3(I),{gatewayInfo:A3(I,d),proxyInfo:N,opid:_,requestTime:h,url:d,isHttp3:c,elapse:Date.now()-h}}catch(E){throw E}}(i,e,t),closeFn:i=>i.code===$.OPERATION_ABORTED||i.code===$.CAN_NOT_GET_GATEWAY_SERVER&&!i.data.retry})}catch(n){throw n}}async function aj(e,t,r,n){const i=W("PROXY_SERVER_TYPE3"),s=(p,_,g)=>{let E=g||i;return Array.isArray(E)&&(E=_%2==0?i[1]:i[0]),"https://".concat(E,"/ap/?url=").concat(p)};let o=null;const a=[],c=async()=>{const p=W("WEBCS_DOMAIN").slice(0,W("AJAX_REQUEST_CONCURRENT")).map((E,b)=>{let v;return v=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(E,"/api/v2/transpond/webrtc?v=2"),b,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(E,"/api/v2/transpond/webrtc?v=2"):s("".concat(E,"/api/v2/transpond/webrtc?v=2"),b),{url:v,areaCode:EE(),serviceIds:[zr.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?zr.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?zr.CLOUD_PROXY:zr.CLOUD_PROXY_FALLBACK]}}),_=n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:p.map(E=>E.url)}),g=await vE({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:p,asyncMapHandler:E=>(C.debug("[".concat(e.clientId,"] Connect to choose_server:"),E.url),ij(E,e,t,r)),allFailedhandler:E=>{throw n.recordJoinChannelService({endTs:Date.now(),status:"error",errors:E},_),E[0]},promisesCollector:a});return n.recordJoinChannelService({endTs:Date.now(),status:"success"},_),g},d=async()=>{if(await In(1e3),o!==null)return o;const p=W("WEBCS_DOMAIN_BACKUP_LIST").map((E,b)=>{let v;return v=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(E,"/api/v2/transpond/webrtc?v=2"),b,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(E,"/api/v2/transpond/webrtc?v=2"):s("".concat(E,"/api/v2/transpond/webrtc?v=2"),b),{url:v,areaCode:EE(),serviceIds:[zr.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?zr.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?zr.CLOUD_PROXY:zr.CLOUD_PROXY_FALLBACK]}}),_=n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:p.map(E=>E.url)}),g=await vE({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:p,asyncMapHandler:E=>(C.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),E.url),ij(E,e,t,r)),allFailedhandler:E=>{throw n.recordJoinChannelService({endTs:Date.now(),status:"error",errors:E},_),E[0]},promisesCollector:a});return n.recordJoinChannelService({endTs:Date.now(),status:"success"},_),g};let l,u,h;try{({gatewayInfo:l,proxyInfo:u,url:h}=await D0([c(),d()]))}catch(p){throw p[0]}if(a.length&&a.forEach(p=>p.cancel&&typeof p.cancel=="function"&&p.cancel()),!l||!u)throw new ee($.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=h,e.cloudProxyServer!=="disabled"&&Array.isArray(i)&&h){const p=/^https?:\/\/(.+?)(\/.*)?$/.exec(h)[1];Ee(i).call(i,p)&&(e.proxyServer=p,C.setProxyServer(p),Ce.setProxyServer(p))}return o={gatewayInfo:l,proxyInfo:await lJ(u,l.uid)},o}async function wLe(e,t,r){const n=W("UAP_AP").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(s=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap")),i=n.map(s=>function(o,a,c,d){const l={command:"convergeAllocateEdge",sid:a.sid,appId:a.appId,token:a.token,ts:Date.now(),version:xo,cname:a.cname,uid:a.uid.toString(),requestId:HC,seq:HC};HC+=1;const u={service_name:"tele_channel",json_body:JSON.stringify(l)};return Tc(async()=>{const h=await Rc(o,{data:u,cancelToken:c,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(h.code!==0){const _=new ee($.UNEXPECTED_RESPONSE,"cross channel ap error, code"+h.code,{retry:!0});throw C.error(_.toString()),_}const p=JSON.parse(h.json_body);if(p.code!==200){const _=new ee($.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(p.code,", reason: ").concat(p.reason));throw C.error(_.toString()),_}if(!p.servers||p.servers.length===0){const _=new ee($.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw C.error(_.toString()),_}return{vid:p.vid,workerToken:p.workerToken,addressList:(W("CHANNEL_MEDIA_RELAY_SERVERS")||p.servers).map(_=>"wss://".concat(_.address.replace(/\./g,"-"),".").concat(W("WORKER_DOMAIN"),":").concat(_.wss))}},void 0,h=>!!(h.code!==$.OPERATION_ABORTED&&h.code!==$.UNEXPECTED_RESPONSE||h.data&&h.data.retry),d)}(s,e,t,r));try{const s=await D0(i);return i.forEach(o=>o.cancel()),s}catch(s){throw s[0]}}async function TLe(e,t,r){let n=null;const i=[],s=async o=>{const a=W(o?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(c=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(c+"/api/v2/transpond/webrtc?v=2"):"https://".concat(c,"/api/v2/transpond/webrtc?v=2"));return o&&(await In(1e3),n!==null)?n:await vE({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:c=>(C.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(o?"backup":""," choose_server:"),c),function(d,l,u,h){const[p]=yLe(l,[zr.CHOOSE_SERVER]);let _=Wr.networkState;return Tc(async()=>{_&&Wr.networkState===bs.OFFLINE&&Wr.onlineWaiter&&await _e.race([Wr.onlineWaiter,In(h&&h.maxRetryTimeout||Kr.maxRetryTimeout)]),_=Wr.networkState;const g=await Rc(d,{data:p,cancelToken:u,headers:{"Content-Type":"multipart/form-data;"}},!0);return vLe(g,d)},()=>!1,g=>g.code!==$.OPERATION_ABORTED&&(g.code===$.UPDATE_TICKET_FAILED?g.data.retry:(C.warning("[".concat(l.clientId,"] update ticket network error, retry"),g),!0)),h)}(c,e,t,r)),allFailedhandler:c=>{throw c[0]},promisesCollector:i})};try{return n=await D0([s(!1),s(!0)]),i.length&&i.forEach(o=>o.cancel&&typeof o.cancel=="function"&&o.cancel()),n}catch(o){throw o[0]}}function cj(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function dj(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?cj(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cj(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}class RLe extends Cr{get isSuccess(){return!!this.configs}constructor(){super(),j(this,"configs",void 0),j(this,"joinInfo",void 0),j(this,"cancelToken",void 0),j(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),j(this,"interval",void 0),j(this,"mutex",new Jn("config-distribute")),j(this,"mutableParamsRead",!1)}startGetConfigDistribute(t,r){this.joinInfo=t,this.cancelToken=r,this.interval&&this.stopGetConfigDistribute(),W("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},W("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Ce.reportApiInvoke(null,{options:void 0,name:Zr.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Or.TRACER}).onSuccess(JSON.stringify(pu))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void C.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const r=await this.mutex.lock();try{t=await SLe(this.joinInfo,this.cancelToken,this.retryConfig),C.debug("[config-distribute] get config distribute",JSON.stringify(t)),t.limit_bitrate&&this.handleBitrateLimit(t.limit_bitrate),this.cacheGlobalParameterConfig(t),this.configs=t}catch(n){const i=new ee($.NETWORK_RESPONSE_ERROR,n);C.warning("[config-distribute] ".concat(i.toString()))}finally{r()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(t){var r;(r=t)&&r.uplink&&r.id&&r.uplink.max_bitrate!==void 0&&r.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==t.id&&this.emit(hN.UPDATE_BITRATE_LIMIT,t):this.emit(hN.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&dj({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(t){var r;const n=sv(r=Object.keys(t).filter(s=>/^webrtc_ng_global_parameter/.test(s))).call(r);for(let s=0;s<n.length;s++)for(let o=n.length-1;o>s;o--){const a=n[o];if(typeof t[a].__priority=="number"){const c=t[a].__priority,d=n[o-1];if(typeof t[d].__priority=="number"){if(!(c>t[d].__priority))continue;{const l=a;n[o]=n[o-1],n[o-1]=l}}else{const l=a;n[o]=n[o-1],n[o-1]=l}}}const i={};n.forEach(s=>{const o=t[s],a=o.__expires;Object.keys(o).forEach(c=>{c==="__priority"||c==="__expires"||Object.prototype.hasOwnProperty.call(i,c)||(i[c]=dj({value:o[c]},a&&{expires:a}))})});try{(function(a){try{const c=Date.now();Object.keys(a).forEach(d=>{switch(d){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(Fr,d)){const{value:l,expires:u}=a[d];if(u&&u<=c)return;pu[d]=l,Fr[d]=l,C.debug("Update global parameters from config distribute",d,l)}}})}catch(c){C.error("Error update config immediately: ".concat(a),c.message)}})(i);const s=JSON.stringify(i),o=window.btoa(s);window.localStorage.setItem("websdk_ng_global_parameter",o),C.debug("Caching global parameters ".concat(s))}catch(s){C.error("Error caching global parameters:",s.message)}}}class ALe extends Cr{constructor(){super(...arguments),j(this,"resultStorage",new Map)}setLocalAudioStats(t,r,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(n,r)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(n,r))}setLocalVideoStats(t,r,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(n,r)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(n,r)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(n))}setRemoteAudioStats(t,r){const n=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(r))}setRemoteVideoStats(t,r){const n=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(r))}record(t,r,n){if(W("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const i=this.resultStorage.get(t);if(i&&(i.result.push(n),i.result.length>=5)){var s;const o=Ee(s=i.result).call(s,!0);i.isPrevNormal&&!o&&this.emit("exception",lj[t],t,r),!i.isPrevNormal&&o&&this.emit("exception",lj[t]+2e3,t+"_RECOVER",r),i.isPrevNormal=o,i.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,r){return r instanceof Qr&&!r.isActive||!!r.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,r){let n=null;r._encoderConfig&&r._encoderConfig.frameRate&&(n=Rs(r._encoderConfig.frameRate));const i=t.captureFrameRate;return!n||!i||!(n>10&&i<5||n<10&&n>=5&&i<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,r){return!!r.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,r){return r instanceof Qr&&!r.isActive||!!r.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const lj={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Kn=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(r.length>0){const n=r[r.length-1];return Math.round(performance.now()-n.startTime)}return 0}measureFromPublishStart(e,t){const r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(r.length>0){const n=r[r.length-1];return Math.round(performance.now()-n.startTime)}return 0}};var uj=Pr(Ko.Object.getOwnPropertySymbols),CLe=Jt,ILe=UP.indexOf,OLe=Hw,wN=iE([].indexOf),hj=!!wN&&1/wN([1],1,-0)<0;CLe({target:"Array",proto:!0,forced:hj||!OLe("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return hj?wN(this,e,t)||0:ILe(this,e,t)}});var NLe=ja("Array").indexOf,DLe=ki,PLe=NLe,zC=Array.prototype,kLe=function(e){var t=e.indexOf;return e===zC||DLe(zC,e)&&t===zC.indexOf?PLe:t},fj=Pr(kLe);function LLe(e,t){if(e==null)return{};var r,n,i=function(o,a){if(o==null)return{};var c,d,l={},u=iJ(o);for(d=0;d<u.length;d++)c=u[d],fj(a).call(a,c)>=0||(l[c]=o[c]);return l}(e,t);if(uj){var s=uj(e);for(n=0;n<s.length;n++)r=s[n],fj(t).call(t,r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function Ra(e){if(Array.isArray(e))return e.map(r=>r);if(!pj(e))return e;const t={};for(const r in e){const n=e[r];pj(n)||Array.isArray(n)?t[r]=Ra(n):t[r]=n}return t}function pj(e){return!(typeof e!="object"||Array.isArray(e)||!e)}class WC{constructor(t){j(this,"input",[]),j(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const bd={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},yE={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:bd,remoteCandidate:bd}},tX={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},rX={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},nX={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},iX={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function mj(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function gj(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?mj(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mj(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}class B3{constructor(t,r){j(this,"onFirstVideoReceived",void 0),j(this,"onFirstVideoDecoded",void 0),j(this,"onFirstAudioReceived",void 0),j(this,"onFirstVideoDecodedTimeout",void 0),j(this,"onFirstAudioDecoded",void 0),j(this,"onSelectedLocalCandidateChanged",void 0),j(this,"onSelectedRemoteCandidateChanged",void 0),j(this,"videoIsReady",!1),j(this,"videoIsReady2",{}),j(this,"pc",void 0),j(this,"options",void 0),j(this,"intervalTimer",void 0),j(this,"stats",Ra(yE)),j(this,"isFirstVideoReceived",{}),j(this,"isFirstVideoDecoded",{}),j(this,"isFirstAudioReceived",{}),j(this,"isFirstAudioDecoded",{}),j(this,"isFirstVideoDecodedTimeout",{}),j(this,"lossRateWindowStats",[]),this.pc=t,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new _e(t=>{t({local:gj({},bd),remote:gj({},bd)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,r){this.videoIsReady2[t]=r}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,s=0,o=0,a=0;for(const c of n)t[c].forEach((d,l)=>{if(!this.lossRateWindowStats[r-1][c][l]||!this.lossRateWindowStats[0][c][l])return;const u=this.lossRateWindowStats[r-1][c][l].packets-this.lossRateWindowStats[0][c][l].packets,h=this.lossRateWindowStats[r-1][c][l].packetsLost-this.lossRateWindowStats[0][c][l].packetsLost;c==="videoSend"||c==="audioSend"?(i+=u,o+=h):(s+=u,a+=h),Number.isNaN(u)||Number.isNaN(u)?d.packetLostRate=0:d.packetLostRate=u<=0||h<=0?0:h/(u+h)});t.sendPacketLossRate=i<=0||o<=0?0:o/(i+o),t.recvPacketLossRate=s<=0||a<=0?0:a/(s+a)}}function _j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function xLe(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_j(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_j(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}class MLe extends B3{constructor(){super(...arguments),j(this,"_stats",yE),j(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),r=this.statsResponsesToObjects(t);this._stats=Ra(yE);const n=r.filter(s=>s.type==="ssrc");this.processSSRCStats(n);const i=r.find(s=>s.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(r=>{var n;const i=Ee(n=r.id).call(n,"send");switch("".concat(r.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const s=Ra(rX);s.codec=r.googCodecName,s.adaptionChangeReason="none",r.googCpuLimitedResolution&&(s.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(s.adaptionChangeReason="bandwidth"),s.avgEncodeMs=Number(r.googAvgEncodeMs),s.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},s.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},s.firsCount=Number(r.googFirReceived),s.nacksCount=Number(r.googNacksReceived),s.plisCount=Number(r.googPlisReceived),s.frameCount=Number(r.framesEncoded),s.bytes=Number(r.bytesSent),s.packets=Number(r.packetsSent),s.packetsLost=Number(r.packetsLost),s.ssrc=Number(r.ssrc),s.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(s),this._stats.rtt=s.rttMs;break}case"video_recv":{const s=Ra(tX),o=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(s.codec=r.googCodecName,s.targetDelayMs=Number(r.googTargetDelayMs),s.renderDelayMs=Number(r.googRenderDelayMs),s.currentDelayMs=Number(r.googCurrentDelayMs),s.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),s.decodeMs=Number(r.googDecodeMs),s.maxDecodeMs=Number(r.googMaxDecodeMs),s.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},s.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},s.decodeFrameRate=Number(r.googFrameRateDecoded),s.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},s.jitterBufferMs=Number(r.googJitterBufferMs),s.firsCount=Number(r.googFirsSent),s.nacksCount=Number(r.googNacksSent),s.plisCount=Number(r.googPlisSent),s.framesDecodeCount=Number(r.framesDecoded),s.bytes=Number(r.bytesReceived),s.packets=Number(r.packetsReceived),s.packetsLost=Number(r.packetsLost),s.ssrc=Number(r.ssrc),s.packets>0&&!this.isFirstVideoReceived[s.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(s.ssrc),this.isFirstVideoReceived[s.ssrc]=!0),s.framesDecodeCount>0&&!this.isFirstVideoDecoded[s.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(s.ssrc,s.decodedFrame.width,s.decodedFrame.height),this.isFirstVideoDecoded[s.ssrc]=!0),o){const a=o.stats,c=Date.now()-o.lts;s.framesDecodeFreezeTime=a.framesDecodeFreezeTime,s.framesDecodeInterval=a.framesDecodeInterval,s.framesDecodeCount>a.framesDecodeCount&&this.isFirstVideoDecoded[s.ssrc]?(o.lts=Date.now(),s.framesDecodeInterval=c,s.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?s.framesDecodeFreezeTime+=s.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):s.framesDecodeCount<o.stats.framesDecodeCount&&(s.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(s.ssrc,{stats:xLe({},s),lts:Date.now()}),this._stats.videoRecv.push(s);break}case"audio_recv":{const s=Ra(iX);s.codec=r.googCodecName,s.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,s.decodingCNG=Number(r.googDecodingCNG),s.decodingCTN=Number(r.googDecodingCTN),s.decodingCTSG=Number(r.googDecodingCTSG),s.decodingNormal=Number(r.googDecodingNormal),s.decodingPLC=Number(r.googDecodingPLC),s.decodingPLCCNG=Number(r.googDecodingPLCCNG),s.expandRate=Number(r.googExpandRate),s.accelerateRate=Number(r.googAccelerateRate),s.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),s.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),s.speechExpandRate=Number(r.googSpeechExpandRate),s.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),s.jitterBufferMs=Number(r.googJitterBufferMs),s.jitterMs=Number(r.googJitterReceived),s.bytes=Number(r.bytesReceived),s.packets=Number(r.packetsReceived),s.packetsLost=Number(r.packetsLost),s.ssrc=Number(r.ssrc),s.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),s.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),s.receivedFrames>0&&!this.isFirstAudioReceived[s.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(s.ssrc),this.isFirstAudioReceived[s.ssrc]=!0),s.decodingNormal>0&&!this.isFirstAudioDecoded[s.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(s.ssrc),this.isFirstAudioDecoded[s.ssrc]=!0),this._stats.audioRecv.push(s);break}case"audio_send":{const s=Ra(nX);s.codec=r.googCodecName,s.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,s.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),s.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),s.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),s.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),s.bytes=Number(r.bytesSent),s.packets=Number(r.packetsSent),s.packetsLost=Number(r.packetsLost),s.ssrc=Number(r.ssrc),s.rttMs=Number(r.googRtt||0),this._stats.rtt=s.rttMs,this._stats.audioSend.push(s);break}}})}_getStats(){return new _e((t,r)=>{this.pc.getStats(t,r)})}statsResponsesToObjects(t){const r=[];return t.result().forEach(n=>{const i={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(s=>{i[s]=n.stat(s)}),r.push(i)}),r}}function Ej(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function _h(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ej(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ej(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}class vj extends B3{constructor(){super(...arguments),j(this,"_stats",yE),j(this,"report",void 0),j(this,"lastDecodeVideoReceiverStats",new Map),j(this,"lastVideoFramesRecv",new Map),j(this,"lastVideoFramesSent",new Map),j(this,"lastVideoFramesDecode",new Map),j(this,"lastVideoFramesOutput",new Map),j(this,"lastVideoJBDelay",new Map),j(this,"lastAudioJBDelay",new Map),j(this,"mediaBytesSent",new Map),j(this,"mediaBytesRetransmit",new Map),j(this,"mediaBytesTargetEncode",new Map),j(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Ra(yE),this.report.forEach(t=>{switch(t.type){case Bs.OUTBOUND:case Bs.INBOUND:{const r=t.mediaType||t.kind,n=!r&&"frameWidth"in t,i=!r&&!("frameWidth"in t);t.type===Bs.OUTBOUND?r==="audio"||i?this.processAudioOutboundStats(t):(r==="video"||n)&&this.processVideoOutboundStats(t):t.type===Bs.INBOUND&&(r==="audio"||i?this.processAudioInboundStats(t):(r==="video"||n)&&this.processVideoInboundStats(t));break}case Bs.TRANSPORT:{const r=this.report.get(t.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case Bs.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),r={local:_h({},bd),remote:_h({},bd)};return t.forEach(n=>{let i;if(n.type===Bs.TRANSPORT&&(i=t.get(n.selectedCandidatePairId)),n.type===Bs.CANDIDATE_PAIR&&n.selected&&(i=n),i){const s=(o,a)=>{o.type=a.type,o.id=a.id,a.address&&(o.address=a.address),a.candidateType&&(o.candidateType=a.candidateType),a.port&&(o.port=a.port),a.priority&&(o.priority=a.priority),a.protocol&&(o.protocol=a.protocol),a.relayProtocol&&(o.relayProtocol=a.relayProtocol)};if(i.localCandidateId){const o=t.get(i.localCandidateId);o&&s(r.local,o)}if(i.remoteCandidateId){const o=t.get(i.remoteCandidateId);o&&s(r.remote,o)}}}),r}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const r=this.report.get(t.localCandidateId);r&&this.processCandidateStats(r)}if(t.remoteCandidateId){const r=this.report.get(t.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(t){let r;t.type===Bs.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),t.type===Bs.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=t.type,r.id=t.id,t.address&&(r.address=t.address),t.candidateType&&(r.candidateType=t.candidateType),t.port&&(r.port=t.port),t.priority&&(r.priority=t.priority),t.protocol&&(r.protocol=t.protocol),t.relayProtocol&&(r.relayProtocol=t.relayProtocol),t.type===Bs.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(_h({},r),_h({},this.stats.selectedCandidatePair.localCandidate)),t.type===Bs.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(_h({},r),_h({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let r=this._stats.audioRecv.find(n=>n.ssrc===t.ssrc);r||(r=Ra(iX),this._stats.audioRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.packetsDiscarded=t.packetsDiscarded,r.bytes=t.bytesReceived,r.jitterMs=1e3*t.jitter,this.processAudioTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),r.receivedFrames||(r.receivedFrames=t.packetsReceived),r.droppedFrames||(r.droppedFrames=t.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof t.concealedSamples=="number"&&(r.concealedSamples=t.concealedSamples)}processVideoInboundStats(t){let r=this._stats.videoRecv.find(a=>a.ssrc===t.ssrc);r||(r=Ra(tX),this._stats.videoRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.bytes=t.bytesReceived,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.framesDecodeCount=t.framesDecoded,r.framesDroppedCount=t.framesDropped,r.totalInterFrameDelay=t.totalInterFrameDelay,r.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,r.totalFreezesDuration=t.totalFreezesDuration;const n=this.lastDecodeVideoReceiverStats.get(r.ssrc),i=this.lastVideoFramesDecode.get(r.ssrc),s=this.lastVideoFramesOutput.get(r.ssrc),o=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const a=r.decodedFrame?r.decodedFrame.width:0,c=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,a,c),this.isFirstVideoDecoded[r.ssrc]=!0}if(n){const a=n.stats,c=o-n.lts;r.framesDecodeFreezeTime=a.framesDecodeFreezeTime,r.framesDecodeInterval=a.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&c>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>a.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(n.lts=Date.now(),r.framesDecodeInterval=c,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):r.framesDecodeCount<a.framesDecodeCount&&(r.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(n.stats.framesDecodeCount>t.framesDecoded?r.qpSumPerFrame=t.qpSum/t.framesDecoded:r.qpSumPerFrame=(t.qpSum-n.qpSum)/(t.framesDecoded-n.stats.framesDecodeCount))}i&&o-i.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-i.count)/((o-i.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:o,rate:r.decodeFrameRate})):i?r.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:o,rate:0}),r.framesDroppedCount&&t.framesReceived&&(s&&o-s.lts>=800?(r.outputFrameRate=Math.round((t.framesReceived-r.framesDroppedCount-s.count)/((o-s.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:o,rate:Math.max(r.outputFrameRate,0)})):s?r.outputFrameRate=s.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:o,rate:0})),t.totalDecodeTime&&(r.decodeMs=1e3*t.totalDecodeTime),this.processVideoTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(r.framesRateFirefox=t.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:_h({},r),lts:n?n.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let r=this._stats.videoSend.find(i=>i.ssrc===t.ssrc);r||(r=Ra(rX),this._stats.videoSend.push(r));const n=this.mediaBytesSent.get(t.ssrc);if(n)n.add(t.bytesSent);else{const i=new WC(10);i.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,i)}if(t.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(t.ssrc);if(i)i.add(t.retransmittedBytesSent);else{const s=new WC(10);s.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,s)}}if(t.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(t.ssrc);if(i)i.add(t.totalEncodedBytesTarget);else{const s=new WC(10);s.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,s)}}if(r.ssrc=t.ssrc,r.bytes=t.bytesSent,r.packets=t.packetsSent,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.frameCount=t.framesEncoded,r.adaptionChangeReason=t.qualityLimitationReason,r.scalabilityMode=t.scalabilityMode,t.totalEncodeTime&&t.framesEncoded){const i=this.lastEncoderMs.get(t.ssrc);if(!i||i.lastFrameCount>t.framesEncoded)r.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const s=t.framesEncoded-i.lastFrameCount,o=t.totalEncodeTime-i.lastEncoderTime;r.avgEncodeMs=1e3*o/s}}if(t.framesEncoded&&t.qpSum){const i=this.lastEncoderMs.get(t.ssrc);!i||i.lastFrameCount>t.framesEncoded?r.qpSumPerFrame=t.qpSum/t.framesEncoded:r.qpSumPerFrame=(t.qpSum-i.lastQpSum)/(t.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,r),this.processVideoTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const i=this.findRemoteStatsId(t.ssrc,Bs.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,r)}}processAudioOutboundStats(t){let r=this._stats.audioSend.find(n=>n.ssrc===t.ssrc);if(r||(r=Ra(nX),this._stats.audioSend.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsSent,r.bytes=t.bytesSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const n=this.findRemoteStatsId(t.ssrc,Bs.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,r)}}findRemoteStatsId(t,r){var n;const i=Array.from(_l(n=this.report).call(n)).find(s=>s.type===r&&s.ssrc===t);return i?i.id:null}processVideoMediaSource(t,r){const n=this.report.get(t);n&&n.width&&n.height&&n.framesPerSecond&&(r.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(t,r){const n=this.report.get(t);n&&(r.inputLevel=n.audioLevel)}processVideoTrackSenderStats(t,r,n){var i,s,o,a;const c=r?this.report.get(r):void 0,d=(i=c==null?void 0:c.framesSent)!==null&&i!==void 0?i:t.framesSent;if(typeof d!="number")return;let l=(s=c==null?void 0:c.frameWidth)!==null&&s!==void 0?s:t.frameWidth,u=(o=c==null?void 0:c.frameHeight)!==null&&o!==void 0?o:t.frameHeight,h=(a=c==null?void 0:c.framesPerSecond)!==null&&a!==void 0?a:t.framesPerSecond;if(typeof l=="number"&&typeof u=="number"||(l=0,u=0),h==null){const p=Date.now(),_=this.lastVideoFramesSent.get(n.ssrc);_&&p-_.lts>=800?(h=Math.round((d-_.count)/((p-_.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:d,lts:p,rate:h})):_?h=_.rate:this.lastVideoFramesSent.set(n.ssrc,{count:d,lts:p,rate:0})}n.sentFrame={width:l,height:u,frameRate:Math.max(0,h)}}processVideoTrackReceiverStats(t,r,n){var i,s,o,a,c;const d=r?this.report.get(r):void 0,l=(i=d==null?void 0:d.framesReceived)!==null&&i!==void 0?i:t.framesReceived,u=(s=d==null?void 0:d.frameWidth)!==null&&s!==void 0?s:t.frameWidth,h=(o=d==null?void 0:d.frameHeight)!==null&&o!==void 0?o:t.frameHeight,p=(a=d==null?void 0:d.jitterBufferDelay)!==null&&a!==void 0?a:t.jitterBufferDelay,_=(c=d==null?void 0:d.jitterBufferEmittedCount)!==null&&c!==void 0?c:t.jitterBufferEmittedCount;if(typeof l=="number"){const g=this.lastVideoFramesRecv.get(n.ssrc),E=Date.now();n.framesReceivedCount=l;let b=0;g&&E-g.lts>=800?(b=Math.round((l-g.count)/((E-g.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:l,lts:E,rate:b})):g?b=g.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:l,lts:E,rate:0}),n.receivedFrame={width:u||0,height:h||0,frameRate:b||0},n.decodedFrame={width:u||0,height:h||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:u||0,height:h||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(p&&_){const g=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let E=g.jitterBufferMs;const b=_-g.jitterBufferEmittedCount;b>0&&(E=1e3*(p-g.jitterBufferDelay)/b),n.jitterBufferMs=E,n.currentDelayMs=Math.round(E),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:p,jitterBufferEmittedCount:_,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(t,r,n){var i,s,o,a;const c=r?this.report.get(r):void 0,d=(i=(s=c==null?void 0:c.echoReturnLoss)!==null&&s!==void 0?s:t.echoReturnLoss)!==null&&i!==void 0?i:0,l=(o=(a=c==null?void 0:c.echoReturnLossEnhancement)!==null&&a!==void 0?a:t.echoReturnLossEnhancement)!==null&&o!==void 0?o:0;n.aecReturnLoss=d,n.aecReturnLossEnhancement=l}processAudioTrackReceiverStats(t,r,n){var i,s,o,a,c,d,l;const u=r?this.report.get(r):void 0,h=(i=u==null?void 0:u.removedSamplesForAcceleration)!==null&&i!==void 0?i:t.removedSamplesForAcceleration,p=(s=u==null?void 0:u.totalSamplesReceived)!==null&&s!==void 0?s:t.totalSamplesReceived,_=(o=u==null?void 0:u.jitterBufferDelay)!==null&&o!==void 0?o:t.jitterBufferDelay,g=(a=u==null?void 0:u.jitterBufferEmittedCount)!==null&&a!==void 0?a:t.jitterBufferEmittedCount,E=(c=u==null?void 0:u.audioLevel)!==null&&c!==void 0?c:t==null?void 0:t.audioLevel,b=(d=u==null?void 0:u.totalSamplesDuration)!==null&&d!==void 0?d:t==null?void 0:t.totalSamplesDuration,v=(l=u==null?void 0:u.concealedSamples)!==null&&l!==void 0?l:t.concealedSamples;if(h&&p&&(n.accelerateRate=h/p),_&&g){const N=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let L=N.jitterBufferMs;const U=g-N.jitterBufferEmittedCount;U>0&&(L=1e3*(_-N.jitterBufferDelay)/U),n.jitterBufferMs=Math.round(L),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:_,jitterBufferEmittedCount:g,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=E;let I=1920;b&&p&&(I=p/b/50,n.receivedFrames=Math.round(p/I)),v&&(n.droppedFrames=Math.round(v/I))}processRemoteInboundStats(t,r){const n=this.report.get(t);n&&(r.packetsLost=n.packetsLost,n.roundTripTime&&(r.rttMs=1e3*n.roundTripTime),n.jitter&&(r.jitterMs=1e3*n.jitter),n.timestamp&&(r.timestamp=n.timestamp))}getCodecFromCodecStats(t){const r=this.report.get(t);if(!r)return"";const n=r.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let t=0,r=null,n=null;this.mediaBytesSent.forEach(s=>{t+=s.diffMean()}),this.mediaBytesRetransmit.forEach(s=>{r=r===null?s.diffMean():r+s.diffMean()}),this.mediaBytesTargetEncode.forEach(s=>{n=n===null?s.diffMean():n+s.diffMean()});const i=r!==null?t-r:t;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}}class ULe extends B3{updateStats(){return _e.resolve()}}function V3(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const s=function(){const o=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return o&&o[0]?Number(o[0].split("/")[1]):null}();return s?s<76?new MLe(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:n,firstVideoDecodedTimeout:i}):new vj(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:n,firstVideoDecodedTimeout:i}):function(o){if(!window.RTCStatsReport)return!1;const a=o.getStats();return!!(a instanceof _e||function(c){return!!c&&(typeof c=="object"||typeof c=="function")&&typeof c.then=="function"}(a))}(e)?new vj(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:n,firstVideoDecodedTimeout:i}):new ULe(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:n,firstVideoDecodedTimeout:i})}let yj=class{get localCapabilities(){return Hr(this._localCapabilities)}get rtpCapabilities(){return Hr(this._rtpCapabilities)}get candidates(){return Hr(this._candidates)}get iceParameters(){return Hr(this._iceParameters)}get dtlsParameters(){return Hr(this._dtlsParameters)}constructor(e){j(this,"sessionDesc",void 0),j(this,"_localCapabilities",void 0),j(this,"_rtpCapabilities",void 0),j(this,"_candidates",void 0),j(this,"_iceParameters",void 0),j(this,"_dtlsParameters",void 0),j(this,"setup",void 0),j(this,"currentMidIndex",void 0),j(this,"cname","o/i14u9pJrxRKAsu"),j(this,"firefoxSsrcMidMap",new Map),e=Hr(e);const{remoteIceParameters:t,remoteDtlsParameters:r,candidates:n,remoteRTPCapabilities:i,localCapabilities:s,direction:o,setup:a,videoCodec:c,audioCodec:d}=e;let l;this.setup=a,l=o===Ri.RECEIVE_ONLY?An.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):An.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=i,this._candidates=n,this._iceParameters=t,this._dtlsParameters=r,this._localCapabilities=s;const u=o===Ri.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,h=o===Ri.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,p=o===Ri.RECEIVE_ONLY?i.send.videoCodecs:c_(Oe.VIDEO,u,h,c),_=o===Ri.RECEIVE_ONLY?i.send.audioCodecs:c_(Oe.AUDIO,u,h,d);for(const g of l.mediaDescriptions)g.attributes.iceUfrag=t.iceUfrag,g.attributes.icePwd=t.icePwd,g.attributes.fingerprints=r.fingerprints,g.attributes.candidates=n,g.attributes.setup=this.setup,g.media.mediaType==="application"&&(g.attributes.sctpPort="5000"),g.media.mediaType==="video"&&(g.media.fmts=p.map(E=>E.payloadType.toString(10)),g.attributes.payloads=p,g.attributes.extmaps=u.videoExtensions),g.media.mediaType==="audio"&&(g.media.fmts=_.map(E=>E.payloadType.toString(10)),g.attributes.payloads=_,g.attributes.extmaps=u.audioExtensions,zm(g));this.sessionDesc=l,this.currentMidIndex=l.mediaDescriptions.length-1}toString(){return An.print(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,r,n,i){r=r.replace(/ /g,"-");const{ssrcs:s,ssrcGroups:o}=Nh(t,this.cname,W("SYNC_GROUP")?r:void 0),a=this.findPreloadMediaDesc(s);if(a){if(Dr()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,a.attributes.mid),i&&(i.twcc||i.remb)){const c=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[c]=this.mungSendMediaDesc(a,i),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{const c=this.findAvailableMediaIndex(e,s,n);let d;return c===-1?(d=this.createOrRecycleSendMedia(e,s,o,"sendonly",n,i),this.updateBundleMids()):(d=Hr(this.sessionDesc.mediaDescriptions[c]),d.attributes.direction="sendonly",d.attributes.ssrcs=s,d.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[c]=this.mungSendMediaDesc(d,i)),Dr()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,d.attributes.mid),{needExchangeSDP:!0,mid:d.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(r=>{r.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,r){const n=[];return e.forEach(i=>{const s=i._mediaStreamTrack.kind,o=this.findAvailableRecvMediaIndex(s);let a,c=!1;o===-1?(c=!0,a=this.createOrRecycleRecvMedia(i,[],"recvonly",t,r),this.updateBundleMids()):(a=Hr(this.sessionDesc.mediaDescriptions[o]),a.attributes.direction="recvonly"),n.push({mid:a.attributes.mid,needCreateTransceiver:c})}),n}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:r,address:n,port:i,type:s,relatedAddress:o,relatedPort:a,priority:c}=new RTCIceCandidate(e),d={foundation:t??"",componentId:"1",transport:r??"",priority:c?c+"":"",connectionAddress:n??"",port:i?i+"":"",type:s?s+"":"",relAddr:o??"",relPort:a?a+"":"",extension:{}};this.candidates.some(l=>l.priority===d.priority&&l.connectionAddress===d.connectionAddress&&l.port===d.port)||(this._candidates.push(d),this.sessionDesc.mediaDescriptions.forEach(l=>{l.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,r,n,i){const s=e._mediaStreamTrack.kind,o=this.rtpCapabilities.recv,a=c_(s,o,this.localCapabilities.send,s===Oe.AUDIO?i:n),c=s===Oe.VIDEO?o.videoExtensions:o.audioExtensions,d="".concat(++this.currentMidIndex);let l={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(h=>h.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(d)}};l=this.mungRecvMediaDsec(l,e);const u=this.findFirstClosedMedia(s);if(u){const h=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[h]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>Ee(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(r=>Ee(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,r){return this.sessionDesc.mediaDescriptions.findIndex(n=>{const i=n.media.mediaType===e&&n.media.port!=="0"&&(n.attributes.direction==="sendonly"||n.attributes.direction==="sendrecv")&&n.attributes.ssrcs.length===0;if(Dr()){if(i){const s=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(s||n.attributes.mid!=="0"&&n.attributes.mid!=="1")||!(!s||s!==n.attributes.mid)}return!1}return i&&n.attributes.mid===r})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const r=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&r})}predictReceivingMids(e){const t=[];for(let r=0;r<e;r++)t.push((this.currentMidIndex+r+1).toString(10));return t}restartICE(e){e=Hr(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,r,n,i,s){const o=this.rtpCapabilities.send,a=e===Oe.VIDEO?o.videoCodecs:o.audioCodecs,c=e===Oe.VIDEO?o.videoExtensions:o.audioExtensions;Dr()&&(i="".concat(++this.currentMidIndex));let d={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(u=>u.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:i}};d=this.mungSendMediaDesc(d,s);const l=this.findFirstClosedMedia(e);if(l){const u=this.sessionDesc.mediaDescriptions.indexOf(l);this.sessionDesc.mediaDescriptions[u]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}mungRecvMediaDsec(e,t,r){const n=Hr(e);return L3(n),Hm(n,t),x3(n,t),GJ(n),TS(n,r,this.localCapabilities.send),n}mungSendMediaDesc(e,t){const r=Hr(e);return TS(r,t,this.localCapabilities.recv),zm(r),r}updateRecvMedia(e,t){const r=this.sessionDesc.mediaDescriptions.findIndex(n=>n.attributes.mid===e);if(r!==-1){const n=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],t);this.sessionDesc.mediaDescriptions[r]=n}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var r;return((r=t.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Dr()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const jLe=["sdp"];var dr;function bj(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Vl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?bj(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bj(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}let Sj=(dr=class wp extends oJ{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,r,n){super(t,r),j(this,"direction",void 0),j(this,"name",void 0),j(this,"store",void 0),j(this,"spec",void 0),j(this,"peerConnection",void 0),j(this,"initialOffer",void 0),j(this,"transport",void 0),j(this,"statsFilter",void 0),j(this,"localCandidateCount",0),j(this,"_isInRestartIce",!1),j(this,"mutex",new Jn("P2PConnection-mutex")),j(this,"onLocalCandidate",void 0),j(this,"remoteSDP",void 0),j(this,"pendingCandidates",[]),j(this,"localCapabilities",void 0),j(this,"isReady",!1),j(this,"restartCnt",0),j(this,"curTurnServerIndex",0),this.store=r,this.spec=t,this.peerConnection=new RTCPeerConnection(wp.resolvePCConfiguration(t,r.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=n??Ri.SEND_ONLY,this.name=this.direction===Ri.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=V3(this.peerConnection,W("STATS_UPDATE_INTERVAL"),void 0,Dr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const r=await KJ();if(this.localCapabilities=RS(r),t){const{sdp:n}=t,i=LLe(t,jLe),s=function(){const l={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},u=_E(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),h={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},p={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},_={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Oa(u,l,"videoExtensions",h,p,_),Oa(u,l,"videoCodecs",h,p,_),Oa(u,l,"audioExtensions",h,p,_),Oa(u,l,"audioCodecs",h,p,_),W("RAISE_H264_BASELINE_PRIORITY")){const g=_.videoCodecs.findIndex(E=>E.rtpMap&&E.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&E.fmtp&&E.fmtp.parameters["profile-level-id"]==="42001f");if(g!==-1){const E=_.videoCodecs.findIndex(b=>b.rtpMap&&b.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(E<g){C.debug("raising H264 baseline profile priority");const b=_.videoCodecs[g];_.videoCodecs.splice(g,1),_.videoCodecs.splice(E,0,b)}E!==-1&&W("FILTER_SEND_H264_BASELINE")&&(h.videoCodecs=h.videoCodecs.filter(b=>!(b.rtpMap&&b.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&b.fmtp&&b.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:h,recv:p,sendrecv:_}}({},{},n);this.remoteSDP=new yj({remoteIceParameters:i.iceParameters,remoteDtlsParameters:i.dtlsParameters,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const o=await this.peerConnection.createAnswer();if(!o.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const a=_u(o.sdp);await this.peerConnection.setLocalDescription(o);const c=await Z7({},{},o.sdp);this.localCapabilities=RS(c);const d=this.peerConnection.getTransceivers()[0];return d!=null&&d.receiver&&d.receiver.transport&&this.tryBindTransportEvents(d.receiver.transport),Vl(Vl({},a),{},{sdp:o.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=_u(n.sdp);return this.initialOffer=n,Vl(Vl({},i),{},{sdp:n.sdp})}}catch(r){throw new ie($.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:r,iceParameters:n,dtlsParameters:i}=t,s=await Z7({},{},r);this.remoteSDP=new yj({remoteIceParameters:n,remoteDtlsParameters:i,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const o=this.peerConnection.getTransceivers()[0];o!=null&&o.sender&&o.sender.transport&&this.tryBindTransportEvents(o.sender.transport)}catch(r){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(r=>{this.peerConnection.addIceCandidate(r)}),this.pendingCandidates=[])}catch(r){throw new ie($.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(r.toString()))}}send(t,r,n){var i=this;return ko(function*(){const s=yield St(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[],a=i.remoteSDP.receive(t,r,n);t.forEach((E,b)=>{if(a[b].needCreateTransceiver){const v=i.peerConnection.addTransceiver(E._mediaStreamTrack,{direction:"sendonly"});o.push(v),E._updateRtpTransceiver(v)}else{const v=i.peerConnection.getTransceivers().find(I=>I.mid===a[b].mid);if(!v)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(a[b].mid));o.push(v),E._updateRtpTransceiver(v)}}),Dr()&&W("SIMULCAST")===!0&&(yield St(i.applySimulcastForFirefox(o,t)));const c=a.map(E=>E.mid),d=yield St(i.peerConnection.createOffer()),l=i.mungSendOfferSDP(d.sdp,t,c),u=An.parse(l),h=c.map(E=>{const b=u.mediaDescriptions.find(v=>v.attributes.mid===E);if(!b)throw new Error("Cannot extract ssrc from mediaDescription.");return zJ(b,W("USE_PUB_RTX"))}),p=o.map((E,b)=>{const v=c[b];return{localSSRC:h[b],id:v}});yield St(i.peerConnection.setLocalDescription({type:"offer",sdp:l}));try{yield p}catch(E){const b=i.remoteSDP.toString();throw yield St(i.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield St(i.peerConnection.setRemoteDescription({type:"answer",sdp:b})),yield St(i.stopSending(c,!0)),E}yield St(i.applySimulcastEncodings(o,t)),yield St(i.applySendEncodings(o,t));const _=i.remoteSDP.toString(),g=i.logSDPExchange(l,"offer","local","send");return g==null||g(_),yield St(i.setRemoteDescription({type:"answer",sdp:_})),o.map((E,b)=>{const v=c[b];return{localSSRC:h[b],id:v}})}catch(o){throw o instanceof ie?o:new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}})()}async stopSending(t,r){const n=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(c=>t.indexOf(c.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length (".concat(i.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));i.map(c=>{var d;c.direction="inactive",(d=c.stop)===null||d===void 0||d.call(c)});const s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const a=this.remoteSDP.toString();o==null||o(a),await this.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{n&&n()}}async receive(t,r,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,r,n,i);if(o){const c=this.remoteSDP.toString(),d=this.logSDPExchange(c,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:c});const l=await this.peerConnection.createAnswer(),u=this.mungReceiveAnswerSDP(l.sdp,s,t);d==null||d(u||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:u}),C.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else C.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const a=this.peerConnection.getTransceivers().find(c=>c.mid===s);if(!a||a.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,mid:a.mid,transceiver:a}}catch(s){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async mockReceive(t,r,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,r,n,i);if(o){const a=this.remoteSDP.toString(),c=this.logSDPExchange(a,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:a});const d=await this.peerConnection.createAnswer(),l=this.mungReceiveAnswerSDP(d.sdp,s,t);c==null||c(l||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:l}),C.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else C.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(s){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString(),n=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:r});const i=await this.peerConnection.createAnswer();n==null||n(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(r){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===wh.Auto&&(this.store.p2pTransport=wh.SdRtn,At().supportPCSetConfiguration&&this.peerConnection.setConfiguration(wp.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,At().supportPCSetConfiguration&&this.peerConnection.setConfiguration(wp.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const r=await this.peerConnection.createOffer({iceRestart:!0});if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:n}=_u(r.sdp);return this.store.descriptionStart(),this.direction===Ri.SEND_ONLY&&await this.peerConnection.setLocalDescription(r),n}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Ri.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const r=await this.peerConnection.createAnswer();if(!r.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:n}=_u(r.sdp);return await this.peerConnection.setLocalDescription(r),n}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(r){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(n.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),o==null||o(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new ie($.EXCHANGE_SDP_FAILED,n.toString())}}async updateSendParameters(t,r){const n=this.peerConnection.getTransceivers().filter(i=>i.mid===t);n.length===1&&(this.isVP8Simulcast(r)?Dr()||await this.applySimulcastEncodings(n,[r]):await this.applySendEncodings(n,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){const n=this.peerConnection.getTransceivers().find(i=>i.mid===r);n&&await n.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const r=t[0].transport.iceTransport,{local:n,remote:i}=r.getSelectedCandidatePair();return{local:Vl(Vl({},bd),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:Vl(Vl({},bd),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,r;Ee(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var r;t.candidate.candidate&&((r=this.onLocalCandidate)===null||r===void 0||r.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,r){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i={iceServers:[]};var s;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(aT(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...wp.turnServerConfigToIceServers(t.turnServer.servers,r,n)),W("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...wp.turnServerConfigToIceServers(t.turnServer.serversFromGateway,r,n)),Ee(s=[wh.Relay,wh.SdRtn]).call(s,r)&&(i.iceTransportPolicy="relay"),W("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),W("ENABLE_ENCODED_TRANSFORM")&&At().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),C.debug("P2PConnection p2pTransport is ".concat(r)),i}static turnServerConfigToIceServers(t,r){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=[],s=t.filter(a=>a.tcpport);C.debug("P2PConnection turnServers is ".concat(s,", current index is ").concat(n));const o=s.length>n?s[n]:s[0];switch(r){case wh.SdRtn:const a=t.filter(d=>{var l;return Ee(l=d.username).call(l,"glb:")&&d.turnServerURL==d.turnServerURL}),c=a.length>n?a[n]:a[0];c&&(i.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(Kp(c.turnServerURL),":").concat(c.tcpport,"?transport=udp")}),i.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(Kp(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}));break;case wh.Relay:o&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Kp(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}));break;default:o&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Kp(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"stun:".concat(o.turnServerURL,":").concat(o.tcpport)}))}return i}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var n;t!=null&&t.state&&((n=this.onDTLSTransportStateChange)===null||n===void 0||n.call(this,t.state))},t.onerror=n=>{var i;(i=this.onDTLSTransportError)===null||i===void 0||i.call(this,"error"in n?n.error:n)};const r=t.iceTransport;r&&(r.onstatechange=()=>{const n=t==null?void 0:t.iceTransport.state;var i;n&&((i=this.onICETransportStateChange)===null||i===void 0||i.call(this,n))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:n,remote:i}=r.getSelectedCandidatePair();C.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:n.type,protocol:n.protocol}),", remote ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var n;if(r||(r=this.peerConnection.getSenders().find(l=>l.track===t._mediaStreamTrack)),!r)return C.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return C.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!At().supportSetRtpSenderParameters)return C.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},s={};switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(t._encoderConfig){var o;const{bitrateMax:l,frameRate:u,scaleResolutionDownBy:h}=t._encoderConfig;l&&(s.maxBitrate=1e3*l),Ee(o=t._hints).call(o,ir.LOW_STREAM)&&(u&&(s.maxFramerate=Rs(u)),h&&h>=1&&(s.scaleResolutionDownBy=h))}if(W("DSCP_TYPE")&&Hu()){var a;const l=W("DSCP_TYPE");Ee(a=["very-low","low","medium","high"]).call(a,l)&&(s.networkPriority=l)}const c=r.getParameters(),d=(n=c.encodings)===null||n===void 0?void 0:n[0];Dr()&&!d&&(i.encodings=[s]),d&&Object.assign(d,s),Object.assign(c,i),C.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(c.encodings))),await r.setParameters(c)}async applySendEncodings(t,r){try{if(!At().supportSetRtpSenderParameters||t.length!==r.length)return;for(let n=0;n<t.length;n++){const i=t[n],s=r[n];s instanceof hr&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch{C.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,n){const i=An.parse(t);return r.forEach((s,o)=>{const a=n[o],c=i.mediaDescriptions.find(d=>d.attributes.mid===a);c&&(Hm(c,s),qJ(c,s,this.store.codec))}),An.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,n)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,r,n)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var n;(n=this.onSelectedLocalCandidateChanged)===null||n===void 0||n.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var n;(n=this.onSelectedRemoteCandidateChanged)===null||n===void 0||n.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let c=0;c<t.length;c++){var n,i,s,o,a;const d=t[c],l=r[c];if(l instanceof hr&&!Ee(n=l._hints).call(n,ir.LOW_STREAM)&&(i=l._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=l._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=l._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((a=l._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1&&this.store.codec==="vp8"){const u={},h={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};u.encodings=[{rid:"m",active:!0,maxBitrate:h.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:h.high}];const p=d.sender.getParameters();await d.sender.setParameters(Object.assign(p,u))}}}async applySimulcastEncodings(t,r){if(!Dr()&&t.length===r.length)for(let n=0;n<t.length;n++){const i=r[n];if(i instanceof hr&&this.isVP8Simulcast(i)){const s=t[n],o={},a={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:a.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:a.medium,scaleResolutionDownBy:4}];const c=s.sender.getParameters();await s.sender.setParameters(Object.assign(c,o))}}}isVP8Simulcast(t){var r,n,i,s,o;return!!(t instanceof hr&&W("SIMULCAST")&&this.store.codec==="vp8"&&!Ee(r=t._hints).call(r,ir.LOW_STREAM)&&(n=t._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=t._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1)}logSDPExchange(t,r,n,i){if(W("SDP_LOGGING"))return C.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(r," SDP during P2PConnection.").concat(i,`
`),t),r==="offer"?s=>{this.logSDPExchange(s,"answer",n==="local"?"remote":"local",i)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(o=>o.mid&&t.indexOf(o.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(o=>{o.direction="inactive"});const n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(t);const s=this.remoteSDP.toString();i==null||i(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(o=>o.mid&&t.indexOf(o.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async o=>{o.direction="sendonly"});const n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(t);const s=this.remoteSDP.toString();i==null||i(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}async getRemoteSSRC(t,r){var n,i;if(r=(n=r)!==null&&n!==void 0?n:(i=this.currentRemoteDescription)===null||i===void 0?void 0:i.sdp){var s;const o=(s=An.parse(r).mediaDescriptions.find(a=>a.attributes.mid===t))===null||s===void 0?void 0:s.attributes.ssrcs;return o==null?void 0:o[0].ssrcId}}async setRemoteDescription(t){var r;await this.peerConnection.setRemoteDescription(t),Ee(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,r,n){const i=An.parse(t),s=i.mediaDescriptions.find(o=>o.attributes.mid===r);return s&&n===Oe.AUDIO&&s.media.mediaType==="audio"&&zm(s),An.print(i)}},we(dr.prototype,"establish",[la],Object.getOwnPropertyDescriptor(dr.prototype,"establish"),dr.prototype),we(dr.prototype,"connect",[la],Object.getOwnPropertyDescriptor(dr.prototype,"connect"),dr.prototype),we(dr.prototype,"receive",[la],Object.getOwnPropertyDescriptor(dr.prototype,"receive"),dr.prototype),we(dr.prototype,"mockReceive",[la],Object.getOwnPropertyDescriptor(dr.prototype,"mockReceive"),dr.prototype),we(dr.prototype,"stopReceiving",[la],Object.getOwnPropertyDescriptor(dr.prototype,"stopReceiving"),dr.prototype),we(dr.prototype,"restartICE",[la],Object.getOwnPropertyDescriptor(dr.prototype,"restartICE"),dr.prototype),we(dr.prototype,"close",[la],Object.getOwnPropertyDescriptor(dr.prototype,"close"),dr.prototype),we(dr.prototype,"updateEncoderConfig",[la],Object.getOwnPropertyDescriptor(dr.prototype,"updateEncoderConfig"),dr.prototype),we(dr.prototype,"updateSendParameters",[la],Object.getOwnPropertyDescriptor(dr.prototype,"updateSendParameters"),dr.prototype),we(dr.prototype,"replaceTrack",[la],Object.getOwnPropertyDescriptor(dr.prototype,"replaceTrack"),dr.prototype),we(dr.prototype,"muteLocal",[la],Object.getOwnPropertyDescriptor(dr.prototype,"muteLocal"),dr.prototype),we(dr.prototype,"unmuteLocal",[la],Object.getOwnPropertyDescriptor(dr.prototype,"unmuteLocal"),dr.prototype),dr);function la(e,t,r){const n=e[t];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const i=this.mutex,s=await i.lock("From P2PConnection.".concat(t));try{for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];return await n.apply(this,a)}finally{s()}},r}function TN(e,t){let r=document.createElement("video"),n=document.createElement("canvas");r.setAttribute("style","display:none"),n.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),n.width=Rs(t.width),n.height=Rs(t.height);const i=Rs(t.framerate||15);document.body.append(r),document.body.append(n);let s=e._mediaStreamTrack;r.srcObject=new MediaStream([s]),r.play();const o=n.getContext("2d");if(!o)throw new ee($.UNEXPECTED_ERROR,"can not get canvas context");const a=At(),c=n.captureStream(a.supportRequestFrame?0:i).getVideoTracks()[0];c.canvas||(c.canvas=n),n.startCapture=()=>{if(!r)return n.stopCapture&&n.stopCapture();if(r.paused&&r.play(),r.videoHeight>2&&r.videoWidth>2){const l=r.videoWidth,u=r.videoHeight/l,h=n.width*u;Math.abs(h-n.height)>=2&&(C.debug("adjust low stream resolution","".concat(n.width,"x").concat(n.height," -> ").concat(n.width,"x").concat(h)),n.height=h)}o.drawImage(r,0,0,n.width,n.height),c.requestFrame&&c.requestFrame(),s!==e._mediaStreamTrack&&(s=e._mediaStreamTrack,r.srcObject=new MediaStream([s]))},n.stopCapture=D3(()=>n.startCapture&&n.startCapture(),i);const d=c.stop;return c.stop=()=>{d.call(c),r&&(r.remove(),r.srcObject=null,r=null),n&&(n.width=0,n.remove(),n.stopCapture&&n.stopCapture(),n.startCapture=void 0,n.stopCapture=void 0,n=null),C.debug("clean low stream renderer")},c}var Vb=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(Vb||{}),ln=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e}(ln||{}),Rh=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(Rh||{}),ei=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e}(ei||{}),Ah=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(Ah||{}),sX=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(sX||{}),Zd=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e}(Zd||{}),fa=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e}(fa||{}),oX=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(oX||{}),Co=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e}(Co||{});const Kd=1e3,Eh=3;function dt(e,t,r){r!=null&&Number.isFinite(r)&&(e[t]=Math.round(Math.max(0,r)))}function wj(e){const t={[Co.CONN_TYPE]:0,[Co.RTT]:e.rtt};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const r=e.selectedCandidatePair.localCandidate.relayProtocol;r==="udp"&&(t[Co.CONN_TYPE]=1),r==="tcp"&&(t[Co.CONN_TYPE]=3),r==="tls"&&(t[Co.CONN_TYPE]=4);break}case"srflx":t[Co.CONN_TYPE]=2}return t}function Tj(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class aX extends Cr{constructor(t){super(),j(this,"store",void 0),j(this,"uploadWRTCStatsTimer",void 0),j(this,"uploadOutboundDenoiserStatsTimer",void 0),j(this,"uploadExtStatsTimer",void 0),j(this,"uploadExtUsageStatsTimer",void 0),j(this,"uploadInboundExtStatsTimer",void 0),j(this,"requestStats",void 0),j(this,"requestTransportStats",void 0),j(this,"requestLocalMedia",void 0),j(this,"requestRemoteMedia",void 0),j(this,"requestAllTracks",void 0),j(this,"requestVideoIsReady",void 0),j(this,"requestUploadStats",void 0),j(this,"requestUpload",void 0),j(this,"uploadOutboundStarted",!1),j(this,"uploadInboundStarted",!1),j(this,"uploadTransportStarted",!1),j(this,"uploadExtensionUsageStarted",!1),j(this,"lastRecvStats",void 0),j(this,"lastSendStats",void 0),j(this,"lastFullRecvStats",void 0),j(this,"lastFullSendStats",void 0),j(this,"needUploadRenderFreezeTime",!0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;let r,n;if(this.uploadTransportStarted&&(r=this.requestStats(),this.store.useP2P&&(n=this.requestStats(!0))),!r&&this.uploadOutboundStarted&&(r=this.requestStats()),!n&&this.uploadInboundStarted&&(n=this.requestStats(!0)),r||n){const i={};if(this.uploadTransportStarted&&r){const s=this.getTransportStats(r,n,t);s&&(i.misc=[s])}if(this.uploadOutboundStarted&&r){const s=this.getOutboundStats(r,t?this.lastSendStats:this.lastFullSendStats,t);s&&(i.outbound=[s])}if(this.uploadInboundStarted&&n){const s=this.getInboundStats(n,t?this.lastRecvStats:this.lastFullRecvStats,t);s&&(i.inbound=s)}this.requestUploadStats(i)}this.lastRecvStats=n,this.lastSendStats=r,t||(this.lastFullRecvStats=n,this.lastFullSendStats=r)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(t!==Eh),++t===Eh+1&&(t=1)},Kd)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(t,r,n){if(!this.requestStats)return;if(n)return t.rtt==null?void 0:{addition:{[Co.RTT]:t.rtt,[Co.CONN_TYPE]:void 0}};const i=wj(t);if(this.store.useP2P){if(r){const s=wj(r);i[Co.CONN_TYPE]+=s[Co.CONN_TYPE]<<3}i[Co.CONN_TYPE]+=110}else i[Co.CONN_TYPE]+=100;return{addition:i}}getOutboundStats(t,r,n){if(!this.requestUploadStats||!this.requestLocalMedia)return;const i=this.requestLocalMedia();if(!i||i.length===0)return;let s,o,a;return i.forEach(c=>{let[d,{track:l,ssrcs:u}]=c;switch(d){case le.LocalVideoLowTrack:case le.LocalVideoTrack:if(d===le.LocalVideoTrack){const h=function(g,E,b,v,I){const N=E.videoSend.find(K=>K.ssrc===g);if(!N)return;const L={},{sentFrame:U,inputFrame:w}=N;if(w&&U){const K=w.frameRate,H=U.frameRate;L[ln.FREEZE]=function(A,m){let S=!0;return S=!(A<=5)&&(A<=10?m<3:A<=20?m<4:m<5),S}(K,H)?1:0}if(dt(L,ln.QP_SUM,N.qpSumPerFrame),I)return L;switch(U&&(dt(L,ln.HEIGHT,U.height),dt(L,ln.WIDTH,U.width),dt(L,ln.FRAME_RATE,U.frameRate)),L[ln.DISABLED]=v._originMediaStreamTrack&&!v._originMediaStreamTrack.enabled||v._mediaStreamTrack&&!v._mediaStreamTrack.enabled?1:0,N.adaptionChangeReason){case"none":L[ln.ADAPTATION]=0;break;case"cpu":L[ln.ADAPTATION]=1;break;case"bandwidth":L[ln.ADAPTATION]=2;break;case"other":L[ln.ADAPTATION]=3}let V=0;N.adaptionChangeReason&&(V+=Tj(N.adaptionChangeReason)),E.qualityLimitationReason&&(V+=Tj(E.qualityLimitationReason)<<3),L[ln.ADAPTATION]=V,L[ln.PLAYER_STATUS]=xC[v._player?v._player.videoElementStatus:"uninit"],dt(L,ln.NACKS,N.nacksCount),dt(L,ln.PLIS,N.plisCount),dt(L,ln.FIRS,N.firsCount),dt(L,ln.AVG_ENCODE,N.avgEncodeMs);const z=b&&b.videoSend.find(K=>K.ssrc===g);if(z){let K=I?Kd:Kd*Eh;z.timestamp&&N.timestamp&&(K=N.timestamp-z.timestamp),z.packets!=null&&N.packets!=null&&dt(L,ln.PACKAGE_RATE,1e3*(N.packets-z.packets)/K),N.packetsLost!=null&&z.packetsLost!=null&&dt(L,ln.PACKAGE_LOST,N.packetsLost-z.packetsLost),z.bytes!=null&&N.bytes!=null&&dt(L,ln.BITRATE,8*(N.bytes-z.bytes)/K)}return L}(u[0].ssrcId,t,r,l,n),p=n?null:function(g,E,b){const v=E.videoSend.find(V=>V.ssrc===g);if(!v)return null;const I={},N=v.inputFrame,L=N&&N.height||b&&b.videoHeight||0,U=N&&N.width||b&&b.videoWidth||0,w=N&&N.frameRate||0;return dt(I,Vb.HEIGHT,L),dt(I,Vb.WIDTH,U),dt(I,Vb.FRAME_RATE,w),I}(u[0].ssrcId,t,l),_=n?null:function(g){const E={};return dt(E,ln.RETRANSMIT,g.bitrate.retransmit),dt(E,ln.TARGET_ENCODED,g.bitrate.targetEncoded),dt(E,ln.ACTUAL_ENCODED,g.bitrate.actualEncoded),dt(E,ln.TRANSMIT,g.bitrate.transmit),dt(E,ln.BANDWIDTH,g.sendBandwidth),E}(t);o=Object.assign({},h,p,_)}else a=n?void 0:function(h,p,_){const g=p.videoSend.find(v=>v.ssrc===h);if(!g)return;const E={},b=g.sentFrame;if(b&&(dt(E,Rh.HEIGHT,b.height),dt(E,Rh.WIDTH,b.width),dt(E,Rh.FRAME_RATE,b.frameRate)),_){const v=_.videoSend.find(I=>I.ssrc===h);if(v){let I=Kd*Eh;v.timestamp&&g.timestamp&&(I=g.timestamp-v.timestamp),v.packets!=null&&g.packets!=null&&dt(E,Rh.PACKAGE_RATE,1e3*(g.packets-v.packets)/I),g.packetsLost!=null&&v.packetsLost!=null&&dt(E,Rh.PACKAGE_LOST,g.packetsLost-v.packetsLost),v.bytes!=null&&g.bytes!=null&&dt(E,Rh.BITRATE,8*(g.bytes-v.bytes)/I)}}return E}(u[0].ssrcId,t,r);break;case le.LocalAudioTrack:s=n?void 0:function(h,p,_,g){const E=p.audioSend.find(L=>L.ssrc===h);if(!E)return;const b={};b[Zd.DISABLED]=g._originMediaStreamTrack&&!g._originMediaStreamTrack.enabled||g._mediaStreamTrack&&!g._mediaStreamTrack.enabled?1:0;const v=100*g._source.getAccurateVolumeLevel(),I=E.inputLevel;if(I!=null){const L=Math.ceil(50*Math.log10(100*I+1));dt(b,Zd.LEVEL,L)}else dt(b,Zd.LEVEL,v);dt(b,sX.PCM_LEVEL,v),dt(b,Zd.AEC_RETURN_LOSS,E.aecReturnLoss),dt(b,Zd.AEC_RETURN_LOSS_ENH,E.aecReturnLossEnhancement),b[Zd.FREEZE]=0;const N=_&&_.audioSend.find(L=>L.ssrc===h);if(N){let L=Kd*Eh;N.timestamp&&E.timestamp&&(L=E.timestamp-N.timestamp),N.bytes!=null&&E.bytes!=null&&dt(b,Zd.BITRATE,8*(E.bytes-N.bytes)/L),N.packets!=null&&E.packets!=null&&dt(b,Zd.PACKAGE_RATE,1e3*(E.packets-N.packets)/L)}return b}(u[0].ssrcId,t,r,l)}}),{high:o,low:a,audio:s}}getInboundStats(t,r,n){if(!this.requestRemoteMedia)return;const i=this.requestRemoteMedia()||[],s=[];return i.forEach(o=>{let[a,c]=o;const d={peer:a.uid};if(c.has(Oe.VIDEO)&&a.videoTrack){const l=a._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(a._videoSSRC)||!1,u=a.videoTrack?function(h,p,_,g,E,b,v){var I;const N=p.videoRecv.find(H=>H.ssrc===h);if(!N)return;const L={},{receivedFrame:U,outputFrame:w,decodeFrameRate:V}=N,z=_&&_.videoRecv.find(H=>H.ssrc===h);if(L[ei.FREEZE]=E&&bE.isRemoteVideoFreeze(g,N,z)?1:0,dt(L,Ah.FRAME_RATE_DECODE,V),dt(L,ei.QP_SUM,N.qpSumPerFrame),N.framesRateFirefox&&dt(L,ei.FRAME_RATE,N.framesRateFirefox),U&&dt(L,ei.FRAME_RATE,U.frameRate),z){const H=p.timestamp-_.timestamp||(v?Kd:Eh*Kd);N.packetsLost!=null&&z.packetsLost!=null&&dt(L,ei.PACKAGE_LOST,N.packetsLost-z.packetsLost),z.bytes!=null&&N.bytes!=null&&dt(L,ei.BITRATE,8*(N.bytes-z.bytes)/H),z.packets!=null&&N.packets!=null&&dt(L,ei.PACKAGE_RATE,1e3*(N.packets-z.packets)/H)}if(v)return L;U?(dt(L,ei.HEIGHT,U.height),dt(L,ei.WIDTH,U.width)):g&&(dt(L,ei.HEIGHT,g._videoHeight||0),dt(L,ei.WIDTH,g._videoWidth||0)),w&&dt(L,Ah.FRAME_RATE_OUTPUT,w.frameRate);const K=(I=g._player)===null||I===void 0?void 0:I.rendFrameRate.toFixed(0);if(K&&dt(L,Ah.FRAME_RATE_RENDER,+K),dt(L,ei.JITTER_BUFFER,N.jitterBufferMs),dt(L,ei.CURRENT_DELAY,N.currentDelayMs),dt(L,ei.FIRS,N.firsCount),dt(L,ei.NACKS,N.nacksCount),dt(L,ei.PLIS,N.plisCount),g){L[ei.DISABLED]=g._originMediaStreamTrack.enabled&&g._mediaStreamTrack.enabled?0:1;const H=g._player;if(H){const{freezeTimeCounterList:A,renderFreezeAccTime:m,videoElementStatus:S}=H;if(A&&A.length>0&&dt(L,Ah.FREEZE_TIME,A.splice(0,1)[0]),b&&Qd.visibility==="visible"&&S===ui.PLAYING&&At().supportRequestVideoFrameCallback){const T=Math.min(6e3,m);H.renderFreezeAccTime=Math.max(0,m-T),dt(L,Ah.FREEZE_TIME_RENDER,T)}if(typeof N.totalFreezesDuration=="number"){const T=z&&z.totalFreezesDuration?N.totalFreezesDuration-z.totalFreezesDuration:N.totalFreezesDuration;dt(L,Ah.FREEZE_DURATION,1e3*T)}}}if(L[ei.PLAYER_STATUS]=xC[g._player?g._player.videoElementStatus:"uninit"],z&&N.totalInterFrameDelay!==void 0&&N.totalSquaredInterFrameDelay!==void 0&&z.totalInterFrameDelay!==void 0&&z.totalSquaredInterFrameDelay!==void 0){const H=N.totalInterFrameDelay-z.totalInterFrameDelay,A=N.totalSquaredInterFrameDelay-z.totalSquaredInterFrameDelay,m=N.framesDecodeCount-z.framesDecodeCount,S=H/m*1e3,T=Math.round(1e3*Math.sqrt((A-Math.pow(H,2)/m)/m));!isNaN(T)&&S+T>Math.max(3*S,S+150)&&(L[ei.I_FRAME_DELAY]=T)}return L}(a._videoSSRC,t,r,a.videoTrack,l===!0,this.needUploadRenderFreezeTime,n):void 0;u&&(d.video=u)}if(c.has(Oe.AUDIO)&&a.audioTrack){const l=a.audioTrack?function(u,h,p,_,g){const E=h.audioRecv.find(z=>z.ssrc===u);if(!E)return;const b={},v=p&&p.audioRecv.find(z=>z.ssrc===u),{receivedFrames:I,droppedFrames:N}=E;var L,U;if(dt(b,fa.JITTER,E.jitterMs),I!=null&&N!=null&&(b[fa.FREEZE]=(U=N,(L=I)===0||100*U/L>20?1:0)),v){const z=h.timestamp-p.timestamp||(g?Kd:Kd*Eh);E.packets!=null&&v.packets!=null&&dt(b,fa.PACKAGE_RATE,1e3*(E.packets-v.packets)/z),v.bytes!=null&&E.bytes!=null&&dt(b,fa.BITRATE,8*(E.bytes-v.bytes)/z),E.packetsLost!=null&&v.packetsLost!=null&&dt(b,fa.PACKAGE_LOST,E.packetsLost-v.packetsLost)}if(g)return b;const w=100*_._source.getAccurateVolumeLevel(),V=E.outputLevel;if(V!=null){const z=Math.ceil(50*Math.log10(100*V+1));dt(b,oX.LEVEL,z)}if(dt(b,fa.PCM_LEVEL,w),_&&(b[fa.DISABLED]=_._originMediaStreamTrack.enabled&&_._mediaStreamTrack.enabled?0:1),dt(b,fa.JITTER_BUFFER,E.jitterBufferMs),dt(b,fa.CURRENT_DELAY,E.jitterBufferMs),b[fa.PLAYER_STATUS]=xC[Fi.getPlayerState(_.getTrackId())],v){const z=E.concealedSamples-v.concealedSamples;z>0&&dt(b,fa.CONCEALED_SAMPLES,z)}return b}(a._audioSSRC,t,r,a.audioTrack,n):void 0;l&&(d.audio=l)}(d.video||d.audio)&&s.push(d)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,s}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(r=>r instanceof wS);if(t&&t._external.getDenoiserStats){const r=t._external.getDenoiserStats();r&&this.requestUpload(fE.DENOISER_STATS,r)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[r,n]=t;n.has(Oe.VIDEO)&&r.videoTrack&&r.videoTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)}),n.has(Oe.AUDIO)&&r.audioTrack&&r.audioTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const r=Date.now(),n={connectionInterval:W("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:r};let i=[];const s=this.requestAllTracks&&this.requestAllTracks()||[];for(const d of s)!d.muted&&d.enabled&&(i=i.concat(await d.getProcessorUsage()));const o=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[d,l]of o)l.has(Oe.VIDEO)&&d.videoTrack&&(i=i.concat(await d.videoTrack.getProcessorUsage())),l.has(Oe.AUDIO)&&d.audioTrack&&(i=i.concat(await d.audioTrack.getProcessorUsage()));if(i.length===0)return;n.details=function(d,l){const u={};for(const{id:g,value:E,level:b,direction:v}of d){var h;const I=(h=l.get(g))!==null&&h!==void 0?h:0,N=E===2?I+W("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:I;var p,_;l.set(g,N),u[g]?(E===2&&(u[g].value=E),b>u[g].level&&(u[g].level=b),v==="remote"&&(u[g].remoteUidCount+=1),u[g].totalTs=(p=l.get(g))!==null&&p!==void 0?p:0):u[g]={value:E,level:b,remoteUidCount:v==="local"?0:1,totalTs:(_=l.get(g))!==null&&_!==void 0?_:0}}return Object.keys(u).map(g=>{const{level:E,value:b,totalTs:v}=u[g];return{id:g,level:E,value:b,totalTs:v}})}(i,t);const a=Date.now(),c=a>r?a:r+1;this.requestUpload&&this.requestUpload(fE.EXTENSION_USAGE_STATS,{usageStats:n,sendTs:c})},W("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}}class au{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,r){j(this,"uid",void 0),j(this,"_uintid",void 0),j(this,"_trust_in_room_",!0),j(this,"_trust_audio_enabled_state_",!0),j(this,"_trust_video_enabled_state_",!0),j(this,"_trust_audio_mute_state_",!0),j(this,"_trust_video_mute_state_",!0),j(this,"_audio_muted_",!1),j(this,"_video_muted_",!1),j(this,"_audio_enabled_",!0),j(this,"_video_enabled_",!0),j(this,"_audio_added_",!1),j(this,"_video_added_",!1),j(this,"_is_pre_created",!1),j(this,"_video_pre_subscribed",!1),j(this,"_audio_pre_subscribed",!1),j(this,"_trust_video_stream_added_state_",!0),j(this,"_trust_audio_stream_added_state_",!0),j(this,"_audioTrack",void 0),j(this,"_videoTrack",void 0),j(this,"_dataChannels",[]),j(this,"_audioSSRC",void 0),j(this,"_videoSSRC",void 0),j(this,"_audioOrtc",void 0),j(this,"_videoOrtc",void 0),j(this,"_cname",void 0),j(this,"_rtxSsrcId",void 0),j(this,"_videoMid",void 0),j(this,"_audioMid",void 0),this.uid=t,this._uintid=r}}let Xa=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});function FLe(e,t){var r;let n;switch(t){case le.LocalAudioTrack:n=jt.Audio;break;case le.LocalVideoTrack:n=Ee(r=e._hints).call(r,ir.SCREEN_TRACK)?jt.Screen:jt.High;break;case le.LocalVideoLowTrack:n=jt.Low}return n}function RN(e){const t=At();if(e.some(r=>r._bypassWebAudio))throw new ie($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new ie($.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function GC(e,t){RN(e);const r=new Qr;return e.forEach(n=>r.addAudioTrack(n)),r}var Rj,Aj,Cj,Ij,Oj,Nj,Dj,Pj,kj,Lj,xj,Er;function Mj(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Oy(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Mj(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mj(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}let gs=(Rj=Ga(Xa.SEND_ONLY),Aj=Ga(Xa.SEND_ONLY),Cj=Ga(),Ij=Ga(Xa.RECEIVE_ONLY),Oj=Ga(Xa.RECEIVE_ONLY),Nj=Ga(Xa.RECEIVE_ONLY),Dj=Ga(Xa.RECEIVE_ONLY),Pj=Ga(Xa.RECEIVE_ONLY),kj=Ga(Xa.RECEIVE_ONLY),Lj=Ga(),xj=Ga(Xa.RECEIVE_ONLY),Er=class extends Cr{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Fe.StateChange,t,this._state)}constructor(e,t){super(),j(this,"isPlanB",!1),j(this,"store",void 0),j(this,"statsUploader",void 0),j(this,"sendConnection",void 0),j(this,"recvConnection",void 0),j(this,"localTrackMap",new Map),j(this,"remoteUserMap",new Map),j(this,"localDataChannels",[]),j(this,"pendingLocalTracks",[]),j(this,"pendingRemoteTracks",[]),j(this,"statsCollector",void 0),j(this,"dtlsFailedCount",0),j(this,"sendMutex",new Jn("P2PChannel2-send-mutex")),j(this,"recvMutex",new Jn("P2PChannel2-recv-mutex")),j(this,"_state",Ut.Disconnected),j(this,"_restartStates",["disconnected","failed"]),j(this,"reconnectInterval",void 0),j(this,"uploadUnplinkStarted",!1),j(this,"uploadDownlinkStarted",!1),j(this,"uplinkStateUploadInterval",void 0),j(this,"downlinkStatsUploadInterval",void 0),j(this,"handleMuteLocalTrack",async(r,n,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Ut.Connected)return void i(new ie($.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const c=this.filterTobeMutedTracks(r);if(c.length===0)return void n();const d=c.find(p=>p[0]==="videoLowTrack");d&&d[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(c.map(p=>{let[,{id:_}]=p;return _}));let l=!1;var o,a;r.trackMediaType==="video"?l=!((o=this.localTrackMap.get(le.LocalAudioTrack))===null||o===void 0||!o.track._muted):l=((a=this.localTrackMap.get(le.LocalVideoTrack))===null||a===void 0?void 0:a.id)===void 0;const u=this.createMuteMessage(c);await er(this,Fe.RequestMuteLocal,u);const h=r.trackMediaType==="video"?mu.MUTE_LOCAL_VIDEO:mu.MUTE_LOCAL_AUDIO;await er(this,Fe.RequestP2PMuteLocal,{action:h,message:u,isMuteAll:l}),n()}catch(c){i(c)}finally{s()}}),j(this,"handleUnmuteLocalTrack",async(r,n,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Ut.Connected)return void i(new ie($.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const o=this.filterTobeUnmutedTracks(r);if(o.length===0)return void n();await this.sendConnection.unmuteLocal(o.map(d=>{let[,{id:l}]=d;return l}));const a=this.createUnmuteMessage(o),c=r.trackMediaType==="video"?mu.UNMUTE_LOCAL_VIDEO:mu.UNMUTE_LOCAL_AUDIO;await er(this,Fe.RequestP2PMuteLocal,{action:c,message:a}),n()}catch(o){i(o)}finally{s()}}),j(this,"handleUpdateVideoEncoder",async(r,n,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const o=this.localTrackMap.get(le.LocalVideoTrack);if(!this.sendConnection||!o||o.track!==r||this.state!==Ut.Connected)return void n();const{id:a,track:c}=o;a&&(await this.sendConnection.updateSendParameters(a,c),await this.sendConnection.updateEncoderConfig(a,c),this.emit(Fe.UpdateVideoEncoder,c)),n()}catch(o){i(o)}finally{s()}}),j(this,"handleUpdateVideoSendParameters",async(r,n,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const o=this.localTrackMap.get(le.LocalVideoTrack);if(!this.sendConnection||!o||o.track!==r||this.state!==Ut.Connected)return void n();const{id:a,track:c}=o;a&&await this.sendConnection.updateSendParameters(a,c),n()}catch(o){i(o)}finally{s()}}),j(this,"handleReplaceTrack",async(r,n,i,s)=>{let o;C.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof s=="boolean"&&s||(o=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var a;const d=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:u}]=l;return r===u});if(!this.sendConnection||!d||d[1].id===void 0||this.state!==Ut.Connected)return void n();if(await((a=this.sendConnection)===null||a===void 0?void 0:a.replaceTrack(r,d[1].id)),d[0]===le.LocalVideoTrack&&At().supportDualStreamEncoding){const l=this.localTrackMap.get(le.LocalVideoLowTrack);if(l){const u=r._mediaStreamTrack.clone();l.track._originMediaStreamTrack.stop(),l.track._mediaStreamTrack=u,l.track._originMediaStreamTrack=u,await new _e((h,p)=>{this.handleReplaceTrack(l.track,h,p,!0)})}}n()}catch(d){i(d)}finally{var c;(c=o)===null||c===void 0||c()}}),j(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),j(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),j(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),j(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new aX(e),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(r=>{r&&(r.iceConnectionState!=="disconnected"&&r.iceConnectionState!=="failed"||this.handleDisconnect(r.direction))})},W("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new ie($.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new ie($.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let r;try{if(t){this.recvConnection&&(C.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),r=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new Sj(e,this.store,Ri.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const n=await this.recvConnection.establish(t);return{iceParameters:n.iceParameters,dtlsParameters:n.dtlsParameters,sdp:n.sdp}}{this.state=Ut.New,this.sendConnection&&(C.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),r=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new Sj(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const n=await this.sendConnection.establish();return{iceParameters:n.iceParameters,dtlsParameters:n.dtlsParameters,sdp:n.sdp}}}finally{r&&r()}}async p2pConnect(e){if(!this.sendConnection)throw new ie($.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ut.Connected}async addRemoteCandidate(e,t){if(t===Ri.RECEIVE_ONLY){if(!this.sendConnection)throw new ie($.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new ie($.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,r){var n=this;return ko(function*(){const i=yield St(n.sendMutex.lock("From P2PChannel.publish"));try{if(!n.sendConnection||n.state!==Ut.Connected){n.throwIfTrackTypeNotMatch(e);const d=e.filter(l=>n.pendingLocalTracks.indexOf(l)===-1);return void(n.pendingLocalTracks=n.pendingLocalTracks.concat(d))}n.store.pubId=n.store.pubId+1,Kn.markPublishStart(n.store.clientId,n.store.pubId);const s=n.filterTobePublishedTracks(e,t,r);if(s.length===0)return void(yield St(n.tryToUnmuteAudio(e)));s.forEach(d=>{let{track:l,type:u}=d;const h=Date.now();n.store.publish(l.getTrackId(),u===le.LocalAudioTrack?"audio":"video",h)}),n.bindLocalTrackEvents(s);const o=yield St(n.sendConnection.send(s.map(d=>{let{track:l}=d;return l}),n.store.codec,n.store.audioCodec)),a=(yield St(o.next())).value,c=n.createGatewayPublishMessage(s,a);try{yield c}catch(d){throw o.throw(d),(d==null?void 0:d.code)===$.WS_ABORT&&s.forEach(l=>{let{track:u}=l;n.pendingLocalTracks.indexOf(u)===-1&&n.pendingLocalTracks.push(u)}),n.unbindLocalTrackEvents(s),d}yield St(o.next()),s.forEach(d=>{let{type:l}=d;n.statsCollector.addLocalStats(l)}),n.statsUploader.startUploadOutboundStats(),n.assignLocalTracks(s,a),s.forEach(d=>{let{track:l,type:u}=d;const h=Date.now();n.store.publish(l.getTrackId(),u===le.LocalAudioTrack?"audio":"video",void 0,h)}),n.startUploadUplinkState()}finally{i()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Ut.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(i=>!Ee(e).call(e,i)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const r=t.find(i=>i[0]==="videoLowTrack");r&&r[1].track.close();const n=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(i=>{let[,{id:s}]=i;return s})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[s,{track:o}]=i;return{type:s,track:o}})),t.forEach(i=>{let[s]=i;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Ut.Connected)return r&&r[1].track.close(),n;e.forEach(i=>{const s=this.pendingLocalTracks.indexOf(i);s!==-1&&this.pendingLocalTracks.splice(s,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],r=[];Array.from(this.localTrackMap.entries()).forEach(n=>{let[i,{track:s,ssrcs:o}]=n;const a={stream_type:FLe(s,i),ssrcs:o};s._muted||!s._enabled?t.push(a):r.push(a)}),t.length>0&&t.forEach(n=>{er(this,Fe.RequestMuteLocal,[n])}),r.length>0&&r.forEach(n=>{er(this,Fe.RequestUnmuteLocal,[n])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return ko(function*(){throw new ie($.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(C.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Vn(this,Fe.RequestRePublish,this.pendingLocalTracks),this.emit(Fe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new ie($.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,r,n){var i;if(!this.recvConnection)throw new ie($.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((i=this.remoteUserMap.get(e))!==null&&i!==void 0&&i.has(t))return;const{track:s,mid:o,transceiver:a}=await this.recvConnection.receive(t,[{ssrcId:r}],String(e.uid),n);t===Oe.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(s):(e._audioTrack=new pm(s,e.uid,e._uintid,this.store),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),a&&e._audioTrack._updateRtpTransceiver(a),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=r,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(s):(e._videoTrack=new fm(s,e.uid,e._uintid,this.store),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),a&&e._videoTrack._updateRtpTransceiver(a),this.bindRemoteTrackEvents(e,e._videoTrack));const c=this.remoteUserMap.get(e);c?c.set(t,o):this.remoteUserMap.set(e,new Map([[t,o]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const d=this.pendingRemoteTracks.findIndex(l=>{let{user:u,kind:h}=l;return u.uid===e.uid&&t===h});d!==-1&&(this.pendingRemoteTracks.splice(d,1),this.emit(Fe.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,r,n){if(!this.recvConnection)throw new ie($.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:r}],String(e.uid),n)}async unsubscribe(e,t,r){const n=this.pendingRemoteTracks.filter(s=>{let{user:o,kind:a}=s;return t!==void 0?o.uid===e.uid&&t===a:o.uid===e.uid});if(n.forEach(s=>{const o=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(o,1)}),this.recvConnection||r||n.forEach(s=>{let{kind:o}=s;var a;if(o===Oe.AUDIO)(a=e._audioTrack)===null||a===void 0||a._destroy(),e._audioTrack=void 0;else if(o===Oe.VIDEO){var c;(c=e._videoTrack)===null||c===void 0||c._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const i=this.filterTobeUnSubscribedTracks(e,t);i.length!==0&&(await this.recvConnection.stopReceiving(i.map(s=>{let[,{id:o}]=s;return o})),this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach(s=>{let[o,{kind:a}]=s;var c,d;if(a===Oe.VIDEO&&o._videoSSRC&&((c=this.recvConnection)===null||c===void 0||c.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),a===Oe.VIDEO)this.unbindRemoteTrackEvents(o._videoTrack),r||((d=o._videoTrack)===null||d===void 0||d._destroy(),o._videoTrack=void 0);else if(a===Oe.AUDIO){var l;this.unbindRemoteTrackEvents(o._audioTrack),!r&&((l=o._audioTrack)===null||l===void 0||l._destroy(),o._audioTrack=void 0)}}),i.forEach(s=>{let[,{kind:o}]=s;er(this,Fe.RequestP2PMuteRemote,o)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,r]=t;[Oe.VIDEO,Oe.AUDIO].forEach(n=>{r.has(n)?er(this,Fe.RequestP2PUnmuteRemote,n):er(this,Fe.RequestP2PMuteRemote,n)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new ie($.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new ie($.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new ie($.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new ie($.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const r=this.remoteUserMap.get(e);if(!r)return void C.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void C.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const n=t===Oe.VIDEO?e._videoSSRC:e._audioSSRC;n!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(n,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const r=this.remoteUserMap.get(e);if(!r)return void C.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||C.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(le.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Qr){const r=t.track;return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return i!==le.LocalAudioTrack}).filter(n=>{let[i]=n;return!(e&&i===le.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[n]=r;return!(e&&n===le.LocalVideoLowTrack)}).map(r=>{let[,{track:n}]=r;return n})}reportPublishEvent(e,t,r,n,i){if(e){const o=this.localTrackMap.get(le.LocalAudioTrack),a=n?this.localTrackMap.get(le.LocalVideoLowTrack):this.localTrackMap.get(le.LocalVideoTrack);Ce.publish(this.store.sessionId,{eventElapse:Kn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o==null?void 0:o.track.getTrackLabel(),videoName:a==null?void 0:a.track.getTrackLabel(),screenshare:(a==null?void 0:a.track._hints.indexOf(ir.SCREEN_TRACK))!==-1,audio:!!o,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;r||(r=[]);const o=r.find(c=>c instanceof Ir),a=n?(s=this.localTrackMap.get(le.LocalVideoTrack))===null||s===void 0?void 0:s.track:r.find(c=>c instanceof hr);Ce.publish(this.store.sessionId,{eventElapse:Kn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o==null?void 0:o.getTrackLabel(),videoName:a==null?void 0:a.getTrackLabel(),screenshare:(a==null?void 0:a._hints.indexOf(ir.SCREEN_TRACK))!==-1,audio:!!o,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,r,n){const i=n===Oe.VIDEO?r._videoSSRC:r._audioSSRC;i&&Ce.subscribe(this.store.sessionId,{succ:e,ec:t,video:n===Oe.VIDEO,audio:n===Oe.AUDIO,peerid:r.uid,subscribeRequestid:n===Oe.VIDEO?r._videoSSRC:r._audioSSRC,p2pid:this.store.p2pId,eventElapse:Kn.measureFromSubscribeStart(this.store.clientId,i)})}reset(){C.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Jn("P2PChannel2-send-mutex"),this.sendMutex=new Jn("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(le.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Qr){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(r=>{t.removeAudioTrack(r)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Ut.Disconnected}getStats(e){var t,r;return e?(r=this.recvConnection)===null||r===void 0?void 0:r.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(le.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(le.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof hr||t&&t.track instanceof Ir?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;const r=Array.from(Ks(t=this.remoteUserMap).call(t)).find(n=>n.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(r=>{let[n]=r;return{uid:n.uid,level:n.audioTrack?100*n.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(le.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=sv(e).call(e,(r,n)=>r.level-n.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(C.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Ut.Reconnecting,W("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:n}]=e;switch(r){case le.LocalVideoTrack:Ee(t=n._hints).call(t,ir.LOW_STREAM)?n.close():this.pendingLocalTracks.push(n);break;case le.LocalAudioTrack:n instanceof Qr?this.pendingLocalTracks=this.pendingLocalTracks.concat(n.trackList):this.pendingLocalTracks.push(n);case le.LocalVideoLowTrack:}}),this.emit(Fe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(Ks(r).call(r)).forEach(n=>{this.setPendingRemoteMedia(t,n)}),this.emit(Fe.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),C.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const r of this.pendingRemoteTracks){const{user:n,kind:i}=r;if((e instanceof au?e.uid:e)===n.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let r,n;if(e===Ri.SEND_ONLY){if(!this.sendConnection)throw new ie($.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");r=await this.sendMutex.lock("From P2PChannel.restartICE"),n=this.sendConnection}else{if(!this.recvConnection)throw new ie($.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");r=await this.recvMutex.lock("From P2PChannel.restartICE"),n=this.recvConnection}try{if(t){const i=await n.restartICE(t);return n.isInRestartIce=!1,i}{const i=await n.restartICE();if(i){const s=await Vn(this,Fe.RequestP2PRestartICE,{direction:Ri.RECEIVE_ONLY,iceParameter:i});await n.restartICE(s),n.isInRestartIce=!1}}}finally{r()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(le.LocalVideoTrack),r=this.localTrackMap.get(le.LocalAudioTrack),n=e.videoSend.find(p=>{var _;return p.ssrc===(t==null||(_=t.ssrcs)===null||_===void 0?void 0:_[0].ssrcId)}),i=e.audioSend.find(p=>{var _;return p.ssrc===(r==null||(_=r.ssrcs)===null||_===void 0?void 0:_[0].ssrcId)});if(!n||!i)return 1;const s=Lo(this,Fe.NeedSignalRTT),o=n?n.rttMs:void 0,a=i?i.rttMs:void 0,c=o&&a?(o+a)/2:o||a,d=(c&&s?(c+s)/2:c||s)||0,l=100*e.sendPacketLossRate*.7/50+.3*d/1500,u=l<.17?1:l<.36?2:l<.59?3:l<.1?4:5,h=t==null?void 0:t.track;if(h&&h._encoderConfig&&h._hints.indexOf(ir.SCREEN_TRACK)===-1){const p=h._encoderConfig.bitrateMax,_=e.bitrate.actualEncoded;if(p&&_){const g=(1e3*p-_)/(1e3*p);return nJ[g<.15?0:g<.3?1:g<.45?2:g<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[n]=r;const i=n._audioSSRC,s=n._videoSSRC,o=e.audioRecv.find(_=>_.ssrc===i),a=e.videoRecv.find(_=>_.ssrc===s);if(!o&&!a)return void(t+=1);const c=Lo(this,Fe.NeedSignalRTT),d=e.rtt,l=(d&&c?(d+c)/2:d||c)||0,u=o?o.jitterMs:void 0,h=e.recvPacketLossRate;let p=.7*h*100/50+.3*l/1500;u&&(p=.6*h*100/50+.2*l/1500+.2*u/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new _e((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}filterTobePublishedTracks(e,t,r){const n=[],i=At(),s=this.getAllTracks();e=Gp(e=e.filter(c=>s.indexOf(c)===-1));let o=!1,a=!1;for(const c of e){if(c instanceof hr&&(this.localTrackMap.has(le.LocalVideoTrack)||o?new ie($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(n.push({track:c,type:le.LocalVideoTrack}),o=!0),t)){const d=this.getLowVideoTrack(c,r);n.push({track:d,type:le.LocalVideoLowTrack})}if(c instanceof Ir){const d=this.localTrackMap.get(le.LocalAudioTrack);if(d){if(!(d.track instanceof Qr))throw new ie($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new ie($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");d.track.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0)}else if(a){const l=n.find(u=>{let{type:h}=u;return h===le.LocalAudioTrack});if(!(l.track instanceof Qr))throw new ie($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new ie($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");l.track.addAudioTrack(c)}else{if(!i.webAudioMediaStreamDest||c instanceof Qr||c._bypassWebAudio)n.push({track:c,type:le.LocalAudioTrack});else{const l=new Qr;l.addAudioTrack(c),n.push({track:l,type:le.LocalAudioTrack})}a=!0}}}return n}filterTobeUnpublishedTracks(e){const t=[],r=this.getAllTracks();e=Gp(e=e.filter(n=>r.indexOf(n)!==-1));for(const n of e){if(n instanceof Ir){const i=this.localTrackMap.get(le.LocalAudioTrack);if(!i)continue;i.track instanceof Qr?(i.track.removeAudioTrack(n),this.unbindLocalAudioTrackEvents(n),i.track.trackList.length===0&&(t.push([le.LocalAudioTrack,i]),i.track.close())):t.push([le.LocalAudioTrack,i])}if(n instanceof hr){const i=this.localTrackMap.get(le.LocalVideoTrack);if(!i)continue;t.push([le.LocalVideoTrack,i]);const s=this.localTrackMap.get(le.LocalVideoLowTrack);s&&t.push([le.LocalVideoLowTrack,s])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:r,type:n}=t;switch(n){case le.LocalVideoTrack:r.addListener(be.GET_STATS,this.handleGetLocalVideoStats),r.addListener(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(be.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(be.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(be.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case le.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case le.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Qr?e.trackList.forEach(r=>{r.addListener(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(be.GET_STATS,this.handleGetLocalAudioStats),r.addListener(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(be.GET_STATS,this.handleGetLocalAudioStats),e.addListener(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(be.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[r,{track:n}]=t;return{track:n,type:r}})),e.forEach(t=>{let{track:r,type:n}=t;switch(n){case le.LocalVideoTrack:r.off(be.GET_STATS,this.handleGetLocalVideoStats),r.off(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(be.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(be.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(be.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case le.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case le.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Qr?e.trackList.forEach(t=>{t.off(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(be.GET_STATS,this.handleGetLocalAudioStats),t.off(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(be.GET_STATS,this.handleGetLocalAudioStats),e.off(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(be.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof fm&&t.addListener(be.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(e))}),t instanceof pm&&t.addListener(be.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(be.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has(Oe.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(Oe.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((r,n)=>{var i;let s,{track:o,type:a}=r;switch(a){case le.LocalAudioTrack:s=jt.Audio;break;case le.LocalVideoTrack:s=Ee(i=o._hints).call(i,ir.SCREEN_TRACK)?jt.Screen:jt.High;break;case le.LocalVideoLowTrack:s=jt.Low}return{kind:a===le.LocalAudioTrack?Oe.AUDIO:Oe.VIDEO,stream_type:s,mid:t[n].id,ssrcs:t[n].localSSRC,isMuted:o.muted||!o.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var r;let n,[i,{track:s,ssrcs:o,id:a}]=t;switch(i){case le.LocalVideoTrack:n=Ee(r=s._hints).call(r,ir.SCREEN_TRACK)?jt.Screen:jt.High;break;case le.LocalAudioTrack:n=jt.Audio;break;case le.LocalVideoLowTrack:n=jt.Low}return{stream_type:n,ssrcs:o,mid:a}})}assignLocalTracks(e,t){e.forEach((r,n)=>{let{track:i,type:s}=r;this.localTrackMap.set(s,{track:i,id:t[n].id,ssrcs:t[n].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[r]=t;this.localTrackMap.delete(r)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var r;C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Fe.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),Ee(r=this._restartStates).call(r,t)&&!e.isInRestartIce&&(t==="disconnected"&&await In(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Ce.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Or.TRACER}).onSuccess(),this.emit(Fe.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;const n=Array.from(Ks(r=this.remoteUserMap).call(r)).find(s=>s._audioSSRC===t);var i;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),(i=n.audioTrack)===null||i===void 0||i.emit(hm.FIRST_FRAME_DECODED),Ce.firstRemoteFrame(this.store.sessionId,bn.FIRST_AUDIO_DECODE,Rr.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:Kn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;const n=Array.from(Ks(r=this.remoteUserMap).call(r)).find(i=>i._audioSSRC===t);n&&Ce.firstRemoteFrame(this.store.sessionId,bn.FIRST_AUDIO_RECEIVED,Rr.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:Kn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,n)=>{this.reportVideoFirstFrameDecoded(t,r,n)},e.onFirstVideoReceived=t=>{var r;const n=Array.from(Ks(r=this.remoteUserMap).call(r)).find(i=>i._videoSSRC===t);n&&Ce.firstRemoteFrame(this.store.sessionId,bn.FIRST_VIDEO_RECEIVED,Rr.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:Kn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,r)=>{const n=t.candidateType==="relay",i=r.candidateType==="relay";r.candidateType!=="unknown"&&n===i||this.emit(Fe.ConnectionTypeChange,n),C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(gu(r))," -> ").concat(JSON.stringify(gu(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(gu(r))," -> ").concat(JSON.stringify(gu(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Fe.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===Ri.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,C.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Ri.SEND_ONLY?this.restartICE(e):Vn(this,Fe.RequestP2PRestartICE,{direction:Ri.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const r=this.localTrackMap.get(le.LocalAudioTrack);if(e instanceof Ir&&(r==null?void 0:r.track)instanceof Qr)return r.track.isActive||t.push([le.LocalAudioTrack,r]),t;const n=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(n&&(t.push(n),n[0]===le.LocalVideoTrack)){const i=this.localTrackMap.get(le.LocalVideoLowTrack);i&&t.push([le.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],r=this.localTrackMap.get(le.LocalAudioTrack);if(e instanceof Ir&&(r==null?void 0:r.track)instanceof Qr)return r.track.isActive&&t.push([le.LocalAudioTrack,r]),t;const n=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(n)if(n[0]===le.LocalVideoTrack){t.push(n);const i=this.localTrackMap.get(le.LocalVideoLowTrack);i&&t.push([le.LocalVideoLowTrack,i])}else t.push(n);return t}createMuteMessage(e){return e.map(t=>{var r;let n,[i,{track:s,ssrcs:o,id:a}]=t;switch(i){case le.LocalAudioTrack:n=jt.Audio;break;case le.LocalVideoTrack:n=Ee(r=s._hints).call(r,ir.SCREEN_TRACK)?jt.Screen:jt.High;break;case le.LocalVideoLowTrack:n=jt.Low}return{stream_type:n,ssrcs:o,mid:a}})}createUnmuteMessage(e){return e.map(t=>{var r;let n,[i,{track:s,ssrcs:o,id:a}]=t;switch(i){case le.LocalAudioTrack:n=jt.Audio;break;case le.LocalVideoTrack:n=Ee(r=s._hints).call(r,ir.SCREEN_TRACK)?jt.Screen:jt.High;break;case le.LocalVideoLowTrack:n=jt.Low}return{stream_type:n,ssrcs:o,mid:a}})}filterTobeUnSubscribedTracks(e,t){const r=[],n=this.remoteUserMap.get(e);if(!n)return r;if(t){const i=n.get(t);if(!i)return r;r.push([e,{kind:t,id:i}])}else Array.from(n.entries()).forEach(i=>{let[s,o]=i;r.push([e,{kind:s,id:o}])});return r}createUnsubscribeMessage(e){const t=[];return e.forEach(r=>{let[n,{kind:i,id:s}]=r;switch(i){case Oe.VIDEO:return void(n._videoSSRC&&t.push({stream_type:Oe.VIDEO,ssrcId:n._videoSSRC}));case Oe.AUDIO:return void(n._audioSSRC&&t.push({stream_type:Oe.AUDIO,ssrcId:n._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[r,{kind:n}]=t;const i=this.remoteUserMap.get(r);i&&(i.delete(n),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(le.LocalVideoTrack),r=this.localTrackMap.get(le.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),r&&e.low_stream_uplink&&await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Ir){const r=this.filterTobeUnmutedTracks(e[t]);if(r.length===0)continue;const n=this.createUnmuteMessage(r);return void await er(this,Fe.RequestUnmuteLocal,n)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Fe.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Fe.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await In(b3(this.dtlsFailedCount,Kr)),this.emit(Fe.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(le.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof hr)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof hr).length>1)throw new ie($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Ir).length>1&&(e.some(t=>t instanceof Ir&&t._bypassWebAudio)||!At().webAudioMediaStreamDest))throw new ie($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof hr&&this.pendingLocalTracks.some(r=>r instanceof hr))throw new ie($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Ir&&this.pendingLocalTracks.some(r=>r instanceof Ir)&&(!At().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof Ir&&r._bypassWebAudio)))throw new ie($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const r=!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&At().supportDualStreamEncoding,n=Oy(Oy({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=r?e._mediaStreamTrack.clone():TN(e,n);const s=ar(8,"track-low-"),o=new hr(i,Oy(Oy({},r&&{scaleResolutionDownBy:fN(n,e)}),{},{frameRate:n.framerate,bitrateMax:n.bitrate,bitrateMin:n.bitrate}),void 0,void 0,s);return o.on(nf.TRANSCEIVER_UPDATED,a=>{e._updateRtpTransceiver(a,$m.LOW_STREAM)}),o._hints.push(ir.LOW_STREAM),e.addListener(be.NEED_CLOSE,()=>{o.close()}),o}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,r,n){var i;const s=Array.from(Ks(i=this.remoteUserMap).call(i)).find(o=>o._videoSSRC===e);if(s){n||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const o=this.store.keyMetrics,a=o.subscribe.find(c=>c.userId===s.uid&&c.type==="video");Ce.firstRemoteVideoDecode(this.store.sessionId,bn.FIRST_VIDEO_DECODE,Rr.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:r,subscribeElapse:Kn.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:(a==null?void 0:a.subscribeEnd)||0,subscriberStart:(a==null?void 0:a.subscribeStart)||0,videoAddNotify:(a==null?void 0:a.streamAdded)||0,state:n?1:0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.recvConnection)return!1;const n=this.remoteUserMap.get(e);if(!n)return!1;const i=n.get(t);if(!i)return!1;const s=await this.recvConnection.getRemoteSSRC(i);return s!==void 0&&s!==r}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new ie($.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new ie($.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new ie($.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new ie($.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new ie($.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new ie($.NOT_SUPPORTED)}async preConnect(e){throw new ie($.NOT_SUPPORTED)}getEstablishParams(){throw new ie($.NOT_SUPPORTED)}async reSubscribe(e){throw new ie($.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new ie($.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===le.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,$m.LOW_STREAM):r._updateRtpTransceiver(void 0)})}},we(Er.prototype,"p2pConnect",[Rj],Object.getOwnPropertyDescriptor(Er.prototype,"p2pConnect"),Er.prototype),we(Er.prototype,"unpublish",[Aj],Object.getOwnPropertyDescriptor(Er.prototype,"unpublish"),Er.prototype),we(Er.prototype,"unpublishLowStream",[Cj],Object.getOwnPropertyDescriptor(Er.prototype,"unpublishLowStream"),Er.prototype),we(Er.prototype,"subscribe",[Ij],Object.getOwnPropertyDescriptor(Er.prototype,"subscribe"),Er.prototype),we(Er.prototype,"mockSubscribe",[Oj],Object.getOwnPropertyDescriptor(Er.prototype,"mockSubscribe"),Er.prototype),we(Er.prototype,"unsubscribe",[Nj],Object.getOwnPropertyDescriptor(Er.prototype,"unsubscribe"),Er.prototype),we(Er.prototype,"muteRemote",[Dj],Object.getOwnPropertyDescriptor(Er.prototype,"muteRemote"),Er.prototype),we(Er.prototype,"unmuteRemote",[Pj],Object.getOwnPropertyDescriptor(Er.prototype,"unmuteRemote"),Er.prototype),we(Er.prototype,"hasRemoteMediaWithLock",[kj],Object.getOwnPropertyDescriptor(Er.prototype,"hasRemoteMediaWithLock"),Er.prototype),we(Er.prototype,"disconnectForReconnect",[Lj],Object.getOwnPropertyDescriptor(Er.prototype,"disconnectForReconnect"),Er.prototype),we(Er.prototype,"remoteMediaSsrcChanged",[xj],Object.getOwnPropertyDescriptor(Er.prototype,"remoteMediaSsrcChanged"),Er.prototype),Er);function Ga(e){return function(t,r,n){const i=t[r];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];switch(e){case Xa.SEND_ONLY:{const c=await this.sendMutex.lock("From P2PChannel2.".concat(r));try{return await i.apply(this,o)}finally{c()}}case Xa.RECEIVE_ONLY:{const c=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await i.apply(this,o)}finally{c()}}default:{const c=await this.sendMutex.lock("From P2PChannel2.".concat(r)),d=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await i.apply(this,o)}finally{c(),d()}}}},n}}function Uj(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function vh(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Uj(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Uj(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}class bE{constructor(t){j(this,"store",void 0),j(this,"onStatsException",void 0),j(this,"onUploadPublishDuration",void 0),j(this,"onStatsChanged",void 0),j(this,"localStats",new Map),j(this,"remoteStats",new Map),j(this,"updateStatsInterval",void 0),j(this,"trafficStats",void 0),j(this,"trafficStatsPeerList",[]),j(this,"uplinkStats",void 0),j(this,"exceptionMonitor",void 0),j(this,"p2pChannel",void 0),j(this,"scalabilityMode",lN.L1T1),j(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new ALe,this.exceptionMonitor.on("exception",(r,n,i)=>{this.onStatsException&&this.onStatsException(r,n,i)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(le.LocalAudioTrack)||vh({},gN)}getLocalVideoTrackStats(){return this.localStats.get(le.LocalVideoTrack)||vh({},_N)}getRemoteAudioTrackStats(t){const r=(s,o)=>{if(!this.trafficStats)return o;const a=this.trafficStats.peer_delay.find(c=>c.peer_uid===s);return a&&(o.publishDuration=a.B_ppad+(Date.now()-this.trafficStats.timestamp)),o},n={};if(t){var i;const s=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.audioStats;s&&(n[t]=r(t,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[o,{audioStats:a}]=s;a&&(n[o]=r(o,a))});return n}getRemoteNetworkQualityStats(t){const r={};if(t){var n;const i=(n=this.remoteStats.get(t))===null||n===void 0?void 0:n.networkStats;i&&(r[t]=i)}else Array.from(this.remoteStats.entries()).forEach(i=>{let[s,{networkStats:o}]=i;o&&(r[s]=o)});return r}getRemoteVideoTrackStats(t){const r=(s,o)=>{if(!this.trafficStats)return o;const a=this.trafficStats.peer_delay.find(c=>c.peer_uid===s);return a&&(o.publishDuration=a.B_ppvd+(Date.now()-this.trafficStats.timestamp)),o},n={};if(t){var i;const s=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.videoStats;s&&(n[t]=r(t,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[o,{videoStats:a}]=s;a&&(n[o]=r(o,a))});return n}getRTCStats(){let t=0,r=0,n=0,i=0;const s=this.localStats.get(le.LocalAudioTrack);s&&(t+=s.sendBytes,r+=s.sendBitrate);const o=this.localStats.get(le.LocalVideoTrack);o&&(t+=o.sendBytes,r+=o.sendBitrate);const a=this.localStats.get(le.LocalVideoLowTrack);a&&(t+=a.sendBytes,r+=a.sendBitrate),this.remoteStats.forEach(d=>{let{audioStats:l,videoStats:u}=d;l&&(n+=l.receiveBytes,i+=l.receiveBitrate),u&&(n+=u.receiveBytes,i+=u.receiveBitrate)});let c=1;return this.trafficStats&&(c+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:c,SendBitrate:r,SendBytes:t,RecvBytes:n,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(r=>r.B_ppad!==void 0||r.B_ppvd!==void 0),t.peer_delay.filter(r=>this.trafficStatsPeerList.indexOf(r.peer_uid)===-1).forEach(r=>{var n;const i=(n=this.p2pChannel)===null||n===void 0?void 0:n.getRemoteMedia(r.peer_uid),s=i!=null&&i.videoSSRC?Kn.measureFromSubscribeStart(this.store.clientId,i.videoSSRC):0,o=i!=null&&i.audioSSRC?Kn.measureFromSubscribeStart(this.store.clientId,i.audioSSRC):0;r.B_ppad!==void 0&&r.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(r.peer_uid,r.B_ppad,r.B_ppvd,s>o?s:o),this.trafficStatsPeerList.push(r.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&C.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,r,n){if(!t)return!1;const i=!!n&&r.framesDecodeFreezeTime>n.framesDecodeFreezeTime,s=!n||r.framesDecodeCount>n.framesDecodeCount;return i||!s}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(r=>{let[n,i]=r;switch(n){case le.LocalVideoTrack:case le.LocalVideoLowTrack:{const o=i,a=vh({},_N),c=t.getStats(),d=t.getLocalMedia(n);if(c){const l=c.videoSend.find(u=>u.ssrc===(d==null?void 0:d.ssrcs[0].ssrcId));if(l){const u=t.getLocalVideoSize(),h=t.getEncoderConfig(le.LocalVideoTrack);l.codec!=="H264"&&l.codec!=="H265"&&l.codec!=="VP8"&&l.codec!=="VP9"&&l.codec!=="AV1X"&&l.codec!=="AV1"||(a.codecType=l.codec),a.sendBytes=l.bytes,a.sendBitrate=o?8*Math.max(0,a.sendBytes-o.sendBytes):0,l.inputFrame?(a.captureFrameRate=l.inputFrame.frameRate,a.captureResolutionHeight=l.inputFrame.height,a.captureResolutionWidth=l.inputFrame.width):u&&(a.captureResolutionWidth=u.width,a.captureResolutionHeight=u.height),l.sentFrame?(a.sendFrameRate=l.sentFrame.frameRate,a.sendResolutionHeight=l.sentFrame.height,a.sendResolutionWidth=l.sentFrame.width):u&&(a.sendResolutionWidth=u.width,a.sendResolutionHeight=u.height),l.avgEncodeMs&&(a.encodeDelay=l.avgEncodeMs),h&&h.bitrateMax&&(a.targetSendBitrate=1e3*h.bitrateMax),a.sendPackets=l.packets,a.sendPacketsLost=l.packetsLost,a.sendJitterMs=l.jitterMs,a.sendRttMs=l.rttMs,a.totalDuration=o?o.totalDuration+1:1,a.totalFreezeTime=o?o.totalFreezeTime:0,this.isLocalVideoFreeze(l)&&(a.totalFreezeTime+=1),l.scalabilityMode&&this.scalabilityMode!==l.scalabilityMode&&(C.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(l.scalabilityMode)),this.scalabilityMode=l.scalabilityMode)}this.trafficStats&&(a.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var s;this.localStats.set(n,a),((o==null?void 0:o.sendResolutionWidth)!==a.sendResolutionWidth||(o==null?void 0:o.sendResolutionHeight)!==a.sendResolutionHeight)&&((s=this.onStatsChanged)===null||s===void 0||s.call(this,"resolution",{width:a.sendResolutionWidth,height:a.sendResolutionHeight})),a&&d&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,d.track,a);break}case le.LocalAudioTrack:{const o=i,a=vh({},gN),c=t.getStats(),d=t.getLocalMedia(n);if(c){const l=c.audioSend.find(u=>u.ssrc===(d==null?void 0:d.ssrcs[0].ssrcId));if(l){if(l.codec!=="opus"&&l.codec!=="aac"&&l.codec!=="PCMU"&&l.codec!=="PCMA"&&l.codec!=="G722"||(a.codecType=l.codec),l.inputLevel)a.sendVolumeLevel=Math.round(32767*l.inputLevel);else{const u=t.getLocalAudioVolume();u&&(a.sendVolumeLevel=Math.round(32767*u))}a.sendBytes=l.bytes,a.sendPackets=l.packets,a.sendPacketsLost=l.packetsLost,a.sendJitterMs=l.jitterMs,a.sendRttMs=l.rttMs,a.sendBitrate=o?8*Math.max(0,a.sendBytes-o.sendBytes):0}}this.trafficStats&&(a.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(le.LocalAudioTrack,a),a&&d&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,d.track,a);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(r=>{var n,i;let[s,{videoStats:o,audioStats:a,videoPcStats:c}]=r;const d=a,l=o,u=c,h=vh({},vJ),p=vh({},yJ),_=vh({},nLe),{audioTrack:g,videoTrack:E,audioSSRC:b,videoSSRC:v}=t.getRemoteMedia(s);let I;I=t instanceof gs?t.getStats(!0):t.getStats();const N=(n=I)===null||n===void 0?void 0:n.audioRecv.find(w=>w.ssrc===b),L=(i=I)===null||i===void 0?void 0:i.videoRecv.find(w=>w.ssrc===v),U=this.trafficStats&&this.trafficStats.peer_delay.find(w=>w.peer_uid===s);if(N&&(N.codec!=="opus"&&N.codec!=="aac"&&N.codec!=="PCMU"&&N.codec!=="PCMA"&&N.codec!=="G722"||(h.codecType=N.codec),N.outputLevel?h.receiveLevel=Math.round(32767*N.outputLevel):g&&(h.receiveLevel=Math.round(32767*g.getVolumeLevel())),h.receiveBytes=N.bytes,h.receivePackets=N.packets,h.receivePacketsLost=N.packetsLost,h.receivePacketsDiscarded=N.packetsDiscarded,h.packetLossRate=h.receivePacketsLost/(h.receivePackets+h.receivePacketsLost),h.receiveBitrate=d?8*Math.max(0,h.receiveBytes-d.receiveBytes):0,h.totalDuration=d?d.totalDuration+1:1,h.totalFreezeTime=d?d.totalFreezeTime:0,h.freezeRate=h.totalFreezeTime/h.totalDuration,h.receiveDelay=N.jitterBufferMs,h.totalDuration>10&&bE.isRemoteAudioFreeze(g)&&(h.totalFreezeTime+=1)),L){L.codec!=="H264"&&L.codec!=="H265"&&L.codec!=="VP8"&&L.codec!=="VP9"&&L.codec!=="AV1X"&&L.codec!=="AV1"||(p.codecType=L.codec),p.receiveBytes=L.bytes,p.receiveBitrate=l?8*Math.max(0,p.receiveBytes-l.receiveBytes):0,p.decodeFrameRate=L.decodeFrameRate<0?0:L.decodeFrameRate,p.renderFrameRate=L.decodeFrameRate<0?0:L.decodeFrameRate,L.outputFrame&&(p.renderFrameRate=L.outputFrame.frameRate),L.receivedFrame?(p.receiveFrameRate=L.receivedFrame.frameRate,p.receiveResolutionHeight=L.receivedFrame.height,p.receiveResolutionWidth=L.receivedFrame.width):E&&(p.receiveResolutionHeight=E._videoHeight||0,p.receiveResolutionWidth=E._videoWidth||0),L.framesRateFirefox!==void 0&&(p.receiveFrameRate=Math.round(L.framesRateFirefox)),p.receivePackets=L.packets,p.receivePacketsLost=L.packetsLost,p.packetLossRate=p.receivePacketsLost/(p.receivePackets+p.receivePacketsLost),p.totalDuration=l?l.totalDuration+1:1,p.totalFreezeTime=l?l.totalFreezeTime:0,p.receiveDelay=L.jitterBufferMs||0;const w=!!v&&t.getRemoteVideoIsReady(v);E&&w&&bE.isRemoteVideoFreeze(E,L,u)&&(p.totalFreezeTime+=1),p.freezeRate=p.totalFreezeTime/p.totalDuration}U&&(h.end2EndDelay=U.B_ad,p.end2EndDelay=U.B_vd,h.transportDelay=U.B_ed,p.transportDelay=U.B_ed,h.currentPacketLossRate=U.B_ealr4/100,p.currentPacketLossRate=U.B_evlr4/100,_.uplinkNetworkQuality=U.B_punq?U.B_punq:0,_.downlinkNetworkQuality=U.B_pdnq?U.B_pdnq:0),this.remoteStats.set(s,{audioStats:h,videoStats:p,videoPcStats:L,networkStats:_}),g&&this.exceptionMonitor.setRemoteAudioStats(g,h),E&&this.exceptionMonitor.setRemoteVideoStats(E,p)})}}class cX{constructor(){j(this,"destChannelMediaInfos",new Map),j(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){UU(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){UU(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){uT(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function jj(e){if(!(e instanceof cX))return new ee($.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),r=e.getDestChannelMediaInfo();if(!t)return new ee($.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(r.size===0)return new ee($.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}function Fj(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Bj(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Fj(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fj(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Zt;function Vj(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Ny(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Vj(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vj(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}let _g=(Zt=class Ug extends aJ{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return Ee(r=Object.keys(lT)).call(r,t)}))]}constructor(t,r){super(t,r),j(this,"store",void 0),j(this,"peerConnection",void 0),j(this,"remoteSDP",void 0),j(this,"initialOffer",void 0),j(this,"statsFilter",void 0),j(this,"useRTX",!1),j(this,"localCapabilities",void 0),j(this,"localCandidateCount",0),j(this,"allCandidatesReceived",!1),j(this,"establishPromise",void 0),j(this,"mutex",new Jn("P2PConnection-mutex")),this.store=r,this.peerConnection=new RTCPeerConnection(Ug.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=V3(this.peerConnection,W("STATS_UPDATE_INTERVAL"),void 0,Dr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=_u(t.sdp),n=_E(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:W("FILTER_VIDEO_FEC"),filterAudioFec:W("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=n,this.initialOffer=t,Ny(Ny({},r),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:n},offerSDP:t.sdp})}catch(t){throw new ie($.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(n){j(this,"sessionDesc",void 0),j(this,"localCapabilities",void 0),j(this,"rtpCapabilities",void 0),j(this,"candidates",void 0),j(this,"iceParameters",void 0),j(this,"dtlsParameters",void 0),j(this,"setup",void 0),j(this,"currentMidIndex",void 0),j(this,"cname",void 0),n=Hr(n);const{iceParameters:i,dtlsParameters:s,candidates:o,rtpCapabilities:a,setup:c,localCapabilities:d,sdkCodec:l,cname:u}=n,h=An.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=a,this.candidates=o,this.iceParameters=i,this.dtlsParameters=s,this.setup=c,this.localCapabilities=d,this.cname=u;for(let p=0;p<h.mediaDescriptions.length;p++){const _=h.mediaDescriptions[p];if(_.attributes.iceUfrag=i.iceUfrag,_.attributes.icePwd=i.icePwd,_.attributes.fingerprints=s.fingerprints,_.attributes.candidates=o,_.attributes.setup=c,_.media.mediaType==="video"){_.media.fmts=a.videoCodecs.map(E=>E.payloadType.toString(10));let g=a.videoCodecs.filter(E=>{var b,v;return(b=E.rtpMap)===null||b===void 0?void 0:Ee(v=b.encodingName.toLowerCase()).call(v,l)});g.length===0&&(g=a.videoCodecs),_.attributes.payloads=g,_.attributes.extmaps=a.videoExtensions}_.media.mediaType==="audio"&&(_.media.fmts=a.audioCodecs.map(g=>g.payloadType.toString(10)),_.attributes.payloads=a.audioCodecs,_.attributes.extmaps=a.audioExtensions),h.mediaDescriptions[p]=this.mungMediaDesc(_)}this.sessionDesc=h,this.currentMidIndex=h.mediaDescriptions.length-1}toString(){return An.print(this.sessionDesc)}send(n,i,s){const{ssrcs:o,ssrcGroups:a}=Nh(i,this.cname),c=this.sessionDesc.mediaDescriptions.find(u=>n===Oe.VIDEO?u.media.mediaType==="video":u.media.mediaType==="audio"),d=o[0].attributes.label,l=o[0].attributes.mslabel;return c.attributes.ssrcs=c.attributes.ssrcs.concat(o),c.attributes.ssrcGroups=c.attributes.ssrcGroups.concat(a),{id:d,mslabel:l}}batchSend(n){return n.map(i=>{let{kind:s,ssrcMsg:o}=i;return this.send(s,o,void 0)})}stopSending(n){this.sessionDesc.mediaDescriptions.forEach(i=>{const s=[],o=[],a=[];i.attributes.ssrcs.forEach(c=>{Ee(n).call(n,c.attributes.label||"")?a.push(c):s.push(c)}),i.attributes.ssrcGroups.forEach(c=>{var d;Ee(d=a.map(l=>l.ssrcId)).call(d,c.ssrcIds[0])||o.push(c)}),i.attributes.ssrcs=s,i.attributes.ssrcGroups=o})}mute(n){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===n);if(!i)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(n){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===n);if(!i)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(n,i,s){n.forEach((o,a)=>{const c=o._mediaStreamTrack,d=this.sessionDesc.mediaDescriptions.findIndex(u=>u.attributes.mid===c.kind),l=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[d],o);this.sessionDesc.mediaDescriptions[d]=l})}stopReceiving(n){}updateCandidates(n){n===Ss.TCP?this.candidates.forEach(i=>{this.candidates.findIndex(s=>s.transport==="tcp"&&s.connectionAddress===i.connectionAddress&&s.port===i.port)===-1&&this.candidates.push(Bj(Bj({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}):this.candidates=this.candidates.filter(i=>i.transport!=="tcp");for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}restartICE(n){n=Hr(n),this.iceParameters=n,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=n.iceUfrag,i.attributes.icePwd=n.icePwd})}predictReceivingMids(n){const i=[];for(let s=0;s<n;s++)i.push((this.currentMidIndex+s+1).toString(10));return i}mungRecvMediaDsec(n,i){const s=Hr(n);return Hm(s,i),x3(s,i),s}updateRecvMedia(n,i){const s=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===n);if(s!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],i);this.sessionDesc.mediaDescriptions[s]=o}}bumpMid(n){this.currentMidIndex+=n}updateTrackLabel(n,i,s){const o=this.sessionDesc.mediaDescriptions.find(c=>n===Oe.VIDEO?c.attributes.mid==="video":c.attributes.mid==="audio");if(o){const c=o.attributes.ssrcs.find(d=>d.attributes.label===i);var a;c&&(c.attributes.label=s,(a=c.attributes.msid)===null||a===void 0||a.replace(i,s))}}mungMediaDesc(n){const i=Hr(n);return L3(i),function(s){const o=s.attributes.extmaps.find(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");o&&s.attributes.extmaps.splice(s.attributes.extmaps.indexOf(o),1),s.attributes.payloads.forEach(a=>{const c=a.rtcpFeedbacks.findIndex(d=>d.type==="transport-cc");c!==-1&&a.rtcpFeedbacks.splice(c,1)})}(i),i}getSSRC(n){for(const i of this.sessionDesc.mediaDescriptions)for(const s of i.attributes.ssrcs)if(s.attributes.label===n)return[s]}}(Ny(Ny({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(r){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async updateRemoteRTPCapabilities(t,r){throw new ie($.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,r){var n=this;return ko(function*(){const i=yield St(n.mutex.lock());try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=t.map(h=>n.peerConnection.addTrack(h._mediaStreamTrack)),o=yield St(n.peerConnection.createOffer()),a=An.parse(o.sdp),c=t.map(h=>{const p=h._mediaStreamTrack,_=a.mediaDescriptions.find(g=>g.attributes.mid===p.kind);if(!_)throw new Error("Cannot extract ssrc from mediaDescription.");return function(g,E,b){const v=g.attributes.ssrcs.filter(N=>N.attributes.label===E),I=g.attributes.ssrcGroups;if(v.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(I&&v.length>1){const N=I.find(L=>L.ssrcIds.indexOf(v[0].ssrcId)!==-1);return N?[{ssrcId:N.ssrcIds[0],rtx:b?N.ssrcIds[1]:void 0}]:[{ssrcId:v[0].ssrcId}]}return[{ssrcId:v[0].ssrcId}]}(_,p.id,n.useRTX)});let d;try{d=yield c}catch(h){throw s.forEach(p=>{Bn()&&p.replaceTrack(null),n.peerConnection.removeTrack(p)}),h}const l=n.mungSendOfferSDP(o.sdp,t);n.remoteSDP.receive(t,r,d);const u=n.remoteSDP.toString();return yield St(n.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield St(n.applySendEncodings(s,t)),yield St(n.peerConnection.setRemoteDescription({type:"answer",sdp:u})),t.map((h,p)=>{const _=h._mediaStreamTrack.id;return{localSSRC:c[p],id:_}})}catch(s){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{i()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getSenders().filter(s=>{var o;return t.indexOf(((o=s.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(s=>{Bn()&&s.replaceTrack(null),this.peerConnection.removeTrack(s)});const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(t);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(r){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}}async receive(t,r,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:s,mslabel:o}=this.remoteSDP.send(t,r,i),a=new _e((l,u)=>{const h=setTimeout(()=>{u(new Error("Cannot receive track, id: ".concat(s)))},1e4),p=_=>{const g=Rt();if((g.name==="Safari"&&Number(g.version)===11||Ci())&&_.track.id!==s&&_.streams[0].id===o){var E;const b=_.streams[0].getTracks()[0];return(E=this.remoteSDP)===null||E===void 0||E.updateTrackLabel(t,s,_.track.id),this.peerConnection.removeEventListener("track",p),clearTimeout(h),void l(b)}if(_.track.id===s)return this.peerConnection.removeEventListener("track",p),clearTimeout(h),void l(_.track)};this.peerConnection.addEventListener("track",p)}),c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:c});const d=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(d),{track:await a,id:s}}catch(s){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n)}catch(r){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getSenders().filter(n=>{var i;return t.indexOf(((i=n.track)===null||i===void 0?void 0:i.id)||"")!==-1});if(r.length!==t.length)throw new Error("sender' length doesn't match mids' length.");r.map(n=>{if(Bn()&&n.track)n.track.enabled=!1;else{const i=n.getParameters();i.encodings.forEach(s=>s.active=!1),n.setParameters(i)}})}catch(r){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getSenders().filter(s=>{var o;return t.indexOf(((o=s.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(r.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");r.map(async s=>{if(Bn()&&s.track)s.track.enabled=!0;else{const o=s.getParameters();o.encodings.forEach(a=>a.active=!0),await s.setParameters(o)}});const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(r){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return ko(function*(){const n=yield St(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(At().supportPCSetConfiguration){const c=r.peerConnection.getConfiguration(),d=t===Ss.RELAY?"relay":"all";c.iceTransportPolicy!==d&&(C.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(c.iceTransportPolicy,"] to [").concat(d,"]")),c.iceTransportPolicy=d,r.peerConnection.setConfiguration(c))}else if(t===Ss.RELAY)return;t!==Ss.RELAY&&r.remoteSDP.updateCandidates(t);const i=yield St(r.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const s=_u(i.sdp),{remoteIceParameters:o}=yield s.iceParameters;r.remoteSDP.restartICE(o);const a=r.remoteSDP.toString();yield St(r.peerConnection.setLocalDescription(i)),yield St(r.peerConnection.setRemoteDescription({type:"answer",sdp:a}))}catch(i){C.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),i)}finally{n()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(n.sdp,[r]);this.remoteSDP.updateRecvMedia(r._mediaStreamTrack.kind,r);const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new ie($.EXCHANGE_SDP_FAILED,n.toString())}}async updateSendParameters(t,r){const n=this.peerConnection.getSenders().filter(i=>{var s;return((s=i.track)===null||s===void 0?void 0:s.id)===t});n.length===1&&await this.applySendEncodings(n,[r])}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){const n=this.peerConnection.getSenders().find(i=>{var s;return((s=i.track)===null||s===void 0?void 0:s.id)===r});n&&await n.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,r){throw new ie($.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new ie($.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},W("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const r={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(aT(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...Ug.turnServerConfigToIceServers(t.turnServer.servers)),W("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...Ug.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(n=>{n.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(t){const r=[];return t.forEach(n=>{n.security?n.tcpport&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turns:".concat(n.turnServerURL,":").concat(n.tcpport,"?transport=tcp")}):(n.udpport&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.udpport,"?transport=udp")}),n.tcpport&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.tcpport,"?transport=tcp")}))}),r}async updateRtpSenderEncodings(t,r){var n;if(r||(r=this.peerConnection.getSenders().find(d=>{var l;return((l=d.track)===null||l===void 0?void 0:l.id)===t._mediaStreamTrack.id})),!r)return C.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!At().supportSetRtpSenderParameters)return C.warn("Browser not support set rtp-sender parameters");const i={},s={};if(t instanceof hr)switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(W("DSCP_TYPE")&&Hu()){var o;const d=W("DSCP_TYPE");Ee(o=["very-low","low","medium","high"]).call(o,d)&&(s.networkPriority=d)}const a=r.getParameters(),c=(n=a.encodings)===null||n===void 0?void 0:n[0];c&&Object.assign(c,s),Object.assign(a,i),C.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(a.encodings))),await r.setParameters(a)}async applySendEncodings(t,r){try{if(!At().supportSetRtpSenderParameters||t.length!==r.length)return;for(let n=0;n<t.length;n++){const i=t[n],s=r[n];i&&s&&await this.updateRtpSenderEncodings(s,i)}}catch{C.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r){const n=An.parse(t);return r.forEach((i,s)=>{const o=i._mediaStreamTrack,a=n.mediaDescriptions.find(c=>c.attributes.mid===o.kind);a&&Hm(a,i)}),An.print(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,n)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,r,n)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var n;(n=this.onSelectedLocalCandidateChanged)===null||n===void 0||n.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var n;(n=this.onSelectedRemoteCandidateChanged)===null||n===void 0||n.call(this,t,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const r=this.remoteSDP.batchSend(t).map((s,o)=>{let{id:a,mslabel:c}=s;const{kind:d}=t[o];return new _e((l,u)=>{const h=setTimeout(()=>{u(new Error("Cannot receive track, id: ".concat(a)))},1e4),p=_=>{const g=Rt();if(g.name==="Safari"&&Number(g.version)===11&&_.track.id!==a&&_.streams[0].id===c){var E;const b=_.streams[0].getTracks()[0];return(E=this.remoteSDP)===null||E===void 0||E.updateTrackLabel(d,a,_.track.id),this.peerConnection.removeEventListener("track",p),clearTimeout(h),void l({track:b,id:a})}if(_.track.id===a)return this.peerConnection.removeEventListener("track",p),clearTimeout(h),void l({track:_.track,id:a})};this.peerConnection.addEventListener("track",p)})}),n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i),await _e.all(r)}catch(r){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const r=this.remoteSDP.getSSRC(t);return r==null?void 0:r[0].ssrcId}setConfiguration(t){if(At().supportPCSetConfiguration){const r=Ug.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}},we(Zt.prototype,"connect",[bo],Object.getOwnPropertyDescriptor(Zt.prototype,"connect"),Zt.prototype),we(Zt.prototype,"stopSending",[bo],Object.getOwnPropertyDescriptor(Zt.prototype,"stopSending"),Zt.prototype),we(Zt.prototype,"receive",[bo],Object.getOwnPropertyDescriptor(Zt.prototype,"receive"),Zt.prototype),we(Zt.prototype,"stopReceiving",[bo],Object.getOwnPropertyDescriptor(Zt.prototype,"stopReceiving"),Zt.prototype),we(Zt.prototype,"muteRemote",[bo],Object.getOwnPropertyDescriptor(Zt.prototype,"muteRemote"),Zt.prototype),we(Zt.prototype,"unmuteRemote",[bo],Object.getOwnPropertyDescriptor(Zt.prototype,"unmuteRemote"),Zt.prototype),we(Zt.prototype,"muteLocal",[bo],Object.getOwnPropertyDescriptor(Zt.prototype,"muteLocal"),Zt.prototype),we(Zt.prototype,"unmuteLocal",[bo],Object.getOwnPropertyDescriptor(Zt.prototype,"unmuteLocal"),Zt.prototype),we(Zt.prototype,"close",[bo],Object.getOwnPropertyDescriptor(Zt.prototype,"close"),Zt.prototype),we(Zt.prototype,"updateEncoderConfig",[bo],Object.getOwnPropertyDescriptor(Zt.prototype,"updateEncoderConfig"),Zt.prototype),we(Zt.prototype,"updateSendParameters",[bo],Object.getOwnPropertyDescriptor(Zt.prototype,"updateSendParameters"),Zt.prototype),we(Zt.prototype,"replaceTrack",[bo],Object.getOwnPropertyDescriptor(Zt.prototype,"replaceTrack"),Zt.prototype),we(Zt.prototype,"getRemoteSSRC",[bo],Object.getOwnPropertyDescriptor(Zt.prototype,"getRemoteSSRC"),Zt.prototype),Zt);function bo(e,t,r){const n=e[t];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const i=this.mutex,s=await i.lock("Locking from P2PConnection.".concat(t));try{for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];return await n.apply(this,a)}finally{s()}},r}function $j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function $l(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$j(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$j(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}const Eg="9",Hj=4e4;class BLe{get localCapabilities(){return Hr(this._localCapabilities)}get rtpCapabilities(){return Hr(this._rtpCapabilities)}get candidates(){return Hr(this._candidates)}get iceParameters(){return Hr(this._iceParameters)}get dtlsParameters(){return Hr(this._dtlsParameters)}constructor(t){j(this,"sessionDesc",void 0),j(this,"_localCapabilities",void 0),j(this,"_rtpCapabilities",void 0),j(this,"_candidates",void 0),j(this,"_iceParameters",void 0),j(this,"_dtlsParameters",void 0),j(this,"setup",void 0),j(this,"currentMidIndex",void 0),j(this,"cname",void 0),j(this,"firefoxSsrcMidMap",new Map),t=Hr(t);const{iceParameters:r,dtlsParameters:n,candidates:i,rtpCapabilities:s,setup:o,localCapabilities:a,cname:c}=t;this._rtpCapabilities=s,this._candidates=i,this._iceParameters=r,this._dtlsParameters=n,this._localCapabilities=a,this.setup=o,this.cname=c,this.sessionDesc=this.updateRemoteRTPCapabilities(s),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(t){const r=this.candidates,n=this.dtlsParameters,i=this.iceParameters,s=this.rtpCapabilities.send;let o=this.sessionDesc.mediaDescriptions.length-1;for(let a=1;a<t;a++){const c=2*a+2e4,d=2*a+Hj,{ssrcs:l,ssrcGroups:u}=Nh([{ssrcId:c}],this.cname),{ssrcs:h,ssrcGroups:p}=Nh([{ssrcId:d,rtx:W("USE_SUB_RTX")?d+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Eg,protos:["UDP","TLS","RTP","SAVPF"],fmts:s.videoCodecs.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:r,extmaps:s.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:h,ssrcGroups:p,rtcpFeedbackWildcards:[],payloads:s.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Eg,protos:["UDP","TLS","RTP","SAVPF"],fmts:s.audioCodecs.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:r,extmaps:s.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:l,ssrcGroups:u,rtcpFeedbackWildcards:[],payloads:s.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return An.print(this.sessionDesc)}send(t,r,n,i){const{ssrcs:s,ssrcGroups:o}=Nh(r,this.cname,W("SYNC_GROUP")?n:void 0),a=this.findPreloadMediaDesc(s);if(a){if(Dr()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,a.attributes.mid),i&&(i.twcc||i.remb)){const c=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[c]=this.mungSendMediaDesc(a,i),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{const c=this.findAvailableMediaIndex(t,s);let d;return c===-1||c===1&&(Bn()||function(){const l=Rt();return!(l.name!==Ft.CHROME||!l.osVersion)&&Number(l.version)<=90}())||c===0&&W("USE_SUB_RTX")||pU()?(d=this.createOrRecycleSendMedia(t,s,o,"sendonly",i),this.updateBundleMids()):(d=Hr(this.sessionDesc.mediaDescriptions[c]),d.attributes.direction="sendonly",d.attributes.ssrcs=s,d.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[c]=this.mungSendMediaDesc(d,i)),Dr()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,d.attributes.mid),{mid:d.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:t,needExchangeSDP:r}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:t.attributes.mid,needExchangeSDP:r}}batchSend(t){const r=t.map(s=>{let{kind:o,ssrcMsg:a,mslabel:c}=s;return this.send(o,a,c)}),n=[];let i=!1;return r.forEach(s=>{let{mid:o,needExchangeSDP:a}=s;a&&(i=!0),n.push(o)}),{mids:n,needExchangeSDP:i}}stopSending(t){const r=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&t.indexOf(n.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(n=>{n.attributes.mid==="0"||Dr()||pU()?n.attributes.ssrcs=[]:(n.attributes.ssrcs=[],n.attributes.direction="inactive",n.media.port="0")}),this.updateBundleMids()}mute(t){const r=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(t){const r=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}muteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(n=>Ee(t).call(t,n.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(n=>Ee(t).call(t,n.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(n=>{n.attributes.direction="recvonly"})}receive(t,r,n,i){t.forEach((s,o)=>{this.createOrRecycleRecvMedia(s,[],"recvonly",r,n,i[o])}),this.updateBundleMids()}stopReceiving(t){const r=this.sessionDesc.mediaDescriptions.filter(n=>t.indexOf(n.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(t){const r=this.sessionDesc||An.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=t;const n=this.rtpCapabilities.send,i=this.localCapabilities.send;for(const s of r.mediaDescriptions){if(s.attributes.iceUfrag=this._iceParameters.iceUfrag,s.attributes.icePwd=this._iceParameters.icePwd,s.attributes.fingerprints=this._dtlsParameters.fingerprints,s.attributes.candidates=this._candidates,s.attributes.setup=this.setup,s.media.mediaType==="application"&&(s.attributes.sctpPort="5000"),s.media.mediaType==="video"){if(n.videoCodecs.length===0){const o=i.videoCodecs.filter(a=>{var c,d;return(c=a.rtpMap)===null||c===void 0?void 0:Ee(d=c.encodingName.toLowerCase()).call(d,"vp8")})||[i.videoCodecs[0]];s.media.fmts=o.map(a=>a.payloadType.toString(10)),s.attributes.payloads=o,s.attributes.extmaps=[]}else if(s.media.fmts=n.videoCodecs.map(o=>o.payloadType.toString(10)),s.attributes.payloads=n.videoCodecs,s.attributes.extmaps=n.videoExtensions,W("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:o,ssrcGroups:a}=Nh([{ssrcId:Hj,rtx:W("USE_SUB_RTX")?40001:void 0}],this.cname);s.attributes.ssrcs=o,s.attributes.ssrcGroups=a}}if(s.media.mediaType==="audio"){if(n.audioCodecs.length===0){const o=i.audioCodecs.filter(a=>{var c,d;return(c=a.rtpMap)===null||c===void 0?void 0:Ee(d=c.encodingName.toLowerCase()).call(d,"opus")})||[i.audioCodecs[0]];s.media.fmts=o.map(a=>a.payloadType.toString(10)),s.attributes.payloads=o,s.attributes.extmaps=[]}else if(s.media.fmts=n.audioCodecs.map(o=>o.payloadType.toString(10)),s.attributes.payloads=n.audioCodecs,s.attributes.extmaps=n.audioExtensions,zm(s),W("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:o,ssrcGroups:a}=Nh([{ssrcId:2e4}],this.cname);s.attributes.ssrcs=o,s.attributes.ssrcGroups=a}}}return this.sessionDesc=r,this.currentMidIndex=r.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(t){const r=this._candidates.filter(n=>n.transport==="udp");if(t===Ss.TCP){if(r.length===0)return;if(W("TCP_CANDIDATE_ONLY")){const n=this._candidates.filter(i=>i.transport==="tcp");r.forEach(i=>{n.findIndex(s=>s.connectionAddress===i.connectionAddress)===-1&&n.push($l($l({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),this._candidates=n}else{const n=[];r.forEach(i=>{n.push($l($l({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),this._candidates=[...r,...n]}}else if(t===Ss.RELAY){if(r.length!==0)return;{const n=this._candidates.filter(i=>i.transport==="tcp");n.forEach(i=>{r.push($l($l({},i),{},{foundation:"udpcandidate",priority:Number(i.priority)+1+"",transport:"udp",port:Number(i.port)-90+""}))}),this._candidates=[...r,...n]}}else r.length===0?(this._candidates.filter(n=>n.transport==="tcp").forEach(n=>{r.push($l($l({},n),{},{foundation:"udpcandidate",priority:Number(n.priority)+1+"",transport:"udp",port:Number(n.port)-90+""}))}),this._candidates=r):this._candidates=this._candidates.filter(n=>n.transport!=="tcp");for(const n of this.sessionDesc.mediaDescriptions)n.attributes.candidates=this.candidates}restartICE(t){t=Hr(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const r=[];for(let n=0;n<t;n++)r.push((this.currentMidIndex+n+1).toString(10));return r}findAvailableMediaIndex(t,r){return this.sessionDesc.mediaDescriptions.findIndex(n=>{const i=n.media.mediaType===t&&n.media.port!=="0"&&(n.attributes.direction==="sendonly"||n.attributes.direction==="sendrecv")&&n.attributes.ssrcs.length===0;if(Dr()){if(i){const s=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(s||n.attributes.mid!=="0"&&n.attributes.mid!=="1")||!(!s||s!==n.attributes.mid)}return!1}return i})}createOrRecycleDataChannel(){for(const n of this.sessionDesc.mediaDescriptions)if(n.media.mediaType==="application")return{mediaDesc:n,needExchangeSDP:!1};this.currentMidIndex+=1;const t="".concat(this.currentMidIndex),r={media:{mediaType:"application",port:Eg,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(t),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(r),{mediaDesc:r,needExchangeSDP:!0}}createOrRecycleRecvMedia(t,r,n,i,s,o){const a=t._mediaStreamTrack.kind,c=this.rtpCapabilities.recv,d=c_(a,c,this.localCapabilities.send,a===Oe.VIDEO?i:s),l=a===Oe.VIDEO?c.videoExtensions:c.audioExtensions;this.currentMidIndex+=1;const u="".concat(this.currentMidIndex);let h={media:{mediaType:a,port:Eg,protos:["UDP","TLS","RTP","SAVPF"],fmts:d.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:d,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};h=this.mungRecvMediaDsec(h,t,o);const p=this.findFirstClosedMedia(a);if(p){const _=this.sessionDesc.mediaDescriptions.indexOf(p);this.sessionDesc.mediaDescriptions[_]=h}else this.sessionDesc.mediaDescriptions.push(h);return h}updateRemoteCodec(t,r,n){const i=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(h=>h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").filter(h=>{var p;return Ee(p=Object.keys(lT)).call(p,h)}))],s=new Set(r);if(i.every(h=>s.has(h)))return C.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(r)),!1;const o=this._rtpCapabilities.recv.videoCodecs.filter(h=>r.some(p=>{var _;return Ee(_=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(_,p)}));if(o.length===0)return C.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(i," codecs: ").concat(r)),!1;const a=[...new Set(o.map(h=>h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||""))];let c;if(C.debug("updateRemoteCodec, from ".concat(i," to ").concat(a)),t.length===0)c=this.sessionDesc.mediaDescriptions.filter(h=>h.media.mediaType==="video"&&h.attributes.direction==="recvonly");else if(c=this.sessionDesc.mediaDescriptions.filter(h=>h.attributes.mid&&Ee(t).call(t,h.attributes.mid)&&h.attributes.direction==="recvonly"),c.length!==t.length)return C.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(t,", codecs: ").concat(r)),!1;if(W("USE_PUB_RTX")||W("USE_SUB_RTX")){const h=M3(o,this.rtpCapabilities.recv.videoCodecs);o.push(...h)}this._rtpCapabilities.recv.videoCodecs=o;const d=this.localCapabilities.send,l=this.rtpCapabilities.recv,u=c_(Oe.VIDEO,l,d,n);return c.forEach(h=>{const p=u.map(_=>_.payloadType.toString(10));C.debug("updateRemoteCodec mid: ".concat(h.attributes.mid,", from ").concat(h.attributes.payloads," to ").concat(u)),h.attributes.payloads=u,h.media.fmts=p}),!0}createOrRecycleSendMedia(t,r,n,i,s){const o=this.rtpCapabilities.send,a=t===Oe.VIDEO?o.videoCodecs:o.audioCodecs,c=t===Oe.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;const d="".concat(this.currentMidIndex);let l={media:{mediaType:t,port:Eg,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(h=>h.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(d)}};l=this.mungSendMediaDesc(l,s);const u=this.findFirstClosedMedia(t);if(u){const h=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[h]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,r,n){const i=Hr(t);return L3(i),Hm(i,r),x3(i,r),GJ(i),TS(i,n,this.localCapabilities.send),i}mungSendMediaDesc(t,r){const n=Hr(t);return TS(n,r,this.localCapabilities.recv),zm(n),n}updateRecvMedia(t,r){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],r);this.sessionDesc.mediaDescriptions[n]=i}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(r=>Dr()?r.media.port==="0"&&r.media.mediaType===t:r.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(r=>{var n;return((n=r.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===t[0].ssrcId})}getSSRC(t){var r;return(r=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===t))===null||r===void 0?void 0:r.attributes.ssrcs}}function zj(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function el(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?zj(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zj(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}let d_=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({});var gm=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(gm||{});const CS=new Map;function Wj(e,t,r,n){let{scale:i}=e;if(i===0&&n===gm.UP||i>=t.length-1&&n===gm.DOWN)return e;let s=el(el({},e),{},{scale:n===gm.DOWN?++i:--i});switch(r){case"maintain-framerate":s=el(el({},s),t[i].motion);break;case"maintain-resolution":s=el(el({},s),t[i].detail);break;case"balanced":s=el(el({},s),t[i].balanced)}return s}function dX(e,t){if(t){const r={overUse:0,underUse:0,adaptationList:lX(t)};CS.set(e,r)}else CS.delete(e)}function lX(e){const t=el({},e),{bitrateMax:r,frameRate:n,scaleResolutionDownBy:i,bitrateMin:s}=t,{MIN_FRAME_RATE:o,MAX_THRESHOLD_FRAMERATE:a,MAX_SCALE:c,BITRATE_MIN_THRESHOLD:d,BITRATE_MAX_THRESHOLD:l,BWE_SCALE_UP_THRESHOLD:u,BWE_SCALE_DOWN_THRESHOLD:h,PERF_SCALE_DOWN_THRESHOLD:p,PERF_SCALE_UP_THRESHOLD:_,BALANCE_BITRATE_FACTOR:g,BALANCE_FRAMERATE_FACTOR:E,BALANCE_RESOLUTION_FACTOR:b,MOTION_RESOLUTION_FACTOR:v,MOTION_BITRATE_FACTOR:I,DETAIL_FRAMERATE_FACTOR:N,DETAIL_BITRATE_FACTOR:L}=w3,U=Math.min(t.frameRate,a),w=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(h,1)*r),bwe_up:r,fps_down:Math.round(Math.pow(p,1)*U),fps_up:n},balanced:{scaleResolutionDownBy:1,frameRate:n,bitrateMax:r,bitrateMin:s},motion:{scaleResolutionDownBy:1,frameRate:n,bitrateMax:r,bitrateMin:s},detail:{scaleResolutionDownBy:1,frameRate:n,bitrateMax:r,bitrateMin:s}}];for(let V=1;V<=c;V++){const z={bwe_up:Math.round(Math.pow(u,V)*r),bwe_down:Math.round(Math.pow(h,V+1)*r),fps_up:Math.round(Math.pow(_,V)*U),fps_down:Math.round(Math.pow(p,V+1)*U)},K={scaleResolutionDownBy:i/Math.pow(b,V),frameRate:Math.max(Math.round(Math.pow(E,V)*n),o),bitrateMax:Math.max(Math.round(Math.pow(g,V)*r),l),bitrateMin:Math.max(Math.round(Math.pow(g,V)*s),d)},H={scaleResolutionDownBy:i/Math.pow(v,V),frameRate:n,bitrateMax:Math.max(Math.round(Math.pow(I,V)*r),l),bitrateMin:Math.max(Math.round(Math.pow(I,V)*s),d)},A={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(N,V)*n),o),bitrateMax:Math.max(Math.round(Math.pow(L,V)*r),l),bitrateMin:Math.max(Math.round(Math.pow(L,V)*s),d)};w.push({scale:V,threshold:z,balanced:K,motion:H,detail:A})}return w}function VLe(e,t,r,n,i,s){const o=CS.get(e)||{overUse:0,underUse:0,adaptationList:lX(i)},{adaptationList:a}=o;CS.set(e,o);const{OVERUSE_TIMES_THRESHOLD:c,UNDERUSE_TIMES_THRESHOLD:d}=w3,{scale:l}=n;let u,h;return typeof t=="number"&&t>0&&function(p,_,g,E){if(_>=g.length)return!1;let{threshold:{fps_down:b}}=g[_];return W("FORCE_AG_HIGH_FRAMERATE")&&E==="maintain-framerate"&&(b=g[0].threshold.fps_down),p<b}(t,l,a,s)&&(o.overUse++,h=d_.CPU,o.overUse>c)||typeof r=="number"&&r>0&&function(p,_,g){if(_>=g.length)return!1;const{threshold:{bwe_down:E}}=g[_];return p<E}(r,l,a)&&(o.overUse++,h=d_.BANDWIDTH,o.overUse>c)?(o.overUse=0,o.underUse=0,u=Wj(n,a,s,gm.DOWN),[u,h]):(typeof t=="number"&&t>0&&typeof r=="number"&&r>0&&function(p,_,g,E){if(_===0)return;let{threshold:{fps_up:b}}=g[_];return W("FORCE_AG_HIGH_FRAMERATE")&&E==="maintain-framerate"&&(b=g[1].threshold.fps_up),p>b}(t,l,a,s)&&function(p,_,g){if(_===0)return;const{threshold:{bwe_up:E}}=g[_];return p>E}(r,l,a)&&(o.underUse++,o.underUse>d&&(o.overUse=0,o.underUse=0,u=Wj(n,a,s,gm.UP),u.scale===0&&(h=d_.NONE))),[u,h])}function Gj(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function qC(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Gj(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gj(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function $Le(e){var t;return!!W("ENABLE_AG_ADAPTATION")&&!!(e instanceof yN||Ee(t=e._hints).call(t,ir.CUSTOM_TRACK))&&(!!W("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(r){const n=Rt();if(n.os!==pn.IOS||!n.osVersion)return!1;const i=n.osVersion.split(".");return Number(i[0])>=r}(14)&&zY(17,4)||HY(14)&&WY(17,4)))}const IS=new Map;function Dy(e,t){const r=IS.get(e);if(r){const{timer:n}=r;window.clearTimeout(n),IS.delete(e)}t.qualityLimitationReason=d_.NONE,dX(e)}var Et;function qj(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Mc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?qj(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qj(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}let qa=(Et=class jg extends aJ{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return Ee(r=Object.keys(lT)).call(r,t)}))]}constructor(t,r){super(t,r),j(this,"store",void 0),j(this,"peerConnection",void 0),j(this,"id",ar(5,"connection-")),j(this,"remoteSDP",void 0),j(this,"initialOffer",void 0),j(this,"transportEventReceiver",void 0),j(this,"statsFilter",void 0),j(this,"extension",{useXR:W("USE_XR")}),j(this,"localCapabilities",void 0),j(this,"remoteCodecs",void 0),j(this,"localCandidateCount",0),j(this,"allCandidatesReceived",!1),j(this,"isPreallocation",!1),j(this,"preSSRCMap",new Map),j(this,"dataStreamChannelMap",new Map),j(this,"establishPromise",void 0),j(this,"recoveredDataChannelIds",[]),j(this,"currentDataChannelId",1),j(this,"mutex",new Jn("P2PConnection-mutex")),j(this,"qualityLimitationReason",d_.NONE),this.store=r,this.peerConnection=new RTCPeerConnection(jg.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=V3(this.peerConnection,W("STATS_UPDATE_INTERVAL"),void 0,Dr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(t){const r=this.preSSRCMap.get(t);if(r!==void 0){const n=this.peerConnection.getTransceivers().find(i=>i.mid===r);if(n)return{transceiver:n,track:n.receiver.track,id:r}}}async updateRemoteRTPCapabilities(t,r){if(this.remoteCodecs=r,!this.remoteSDP)return void C.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(r));if(this.remoteSDP.updateRemoteCodec(t,r,this.store.codec)){const n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n);const s=this.remoteSDP.toString();i==null||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else C.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=_u(t.sdp),n=await KJ({filterRTX:!W("USE_PUB_RTX")&&!W("USE_SUB_RTX"),filterVideoFec:W("FILTER_VIDEO_FEC"),filterAudioFec:W("FILTER_AUDIO_FEC"),filterVideoCodec:W("FILTER_VIDEO_CODEC")},this.extension);return this.localCapabilities=RS(n),this.initialOffer=t,Mc(Mc({},r),{},{rtpCapabilities:n,offerSDP:t.sdp})}catch(t){throw new ie($.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new BLe(Mc(Mc({},t),{},{localCapabilities:this.localCapabilities})),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const r=this.remoteSDP.toString(),n=YJ(this.initialOffer.sdp,this.extension),i=this.logSDPExchange(n||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),i==null||i(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});const s=this.peerConnection.getTransceivers()[0];if(s!=null&&s.receiver&&this.tryBindTransportEvents(s.receiver),W("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(W("PRELOAD_MEDIA_COUNT"));const a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c)}const{preSSRCs:o}=t;if(Array.isArray(o)&&o.length>0){const{mids:a}=this.remoteSDP.batchSend(o.map(c=>({kind:c.kind,ssrcMsg:[{ssrcId:c.ssrcId,rtx:c.rtx}],mslabel:c.mslabel})));a.forEach((c,d)=>{this.preSSRCMap.set(o[d].ssrcId,c)}),await Ay(this.peerConnection,this.remoteSDP,this.extension),C.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(r){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:r}=t;this.remoteSDP.updateRemoteRTPCapabilities(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:n}=t;if(Array.isArray(n)&&n.length>0){const{mids:i}=this.remoteSDP.batchSend(n.map(s=>Object.assign({},{kind:s.kind,ssrcMsg:[{ssrcId:s.ssrcId,rtx:s.rtx}],mslabel:s.mslabel})));i.forEach((s,o)=>{this.preSSRCMap.set(n[o].ssrcId,s)})}await Ay(this.peerConnection,this.remoteSDP,this.extension),C.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(r){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(r.toString()))}}send(t,r,n){var i=this;return ko(function*(){const s=yield St(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[];t.forEach(g=>{const E=i.peerConnection.addTransceiver(g._mediaStreamTrack,{direction:"sendonly"});o.push(E),g._updateRtpTransceiver(E)}),Dr()&&W("SIMULCAST")===!0&&(yield St(i.applySimulcastForFirefox(o,t)));const a=yield St(i.peerConnection.createOffer()),c=i.remoteSDP.predictReceivingMids(t.length),d=i.mungSendOfferSDP(a.sdp,t,c),l=An.parse(d),u=c.map(g=>{const E=l.mediaDescriptions.find(b=>b.attributes.mid===g);if(!E)throw new Error("Cannot extract ssrc from mediaDescription.");return zJ(E,W("USE_PUB_RTX"))});let h;try{h=yield u}catch(g){h=[],i.remoteSDP.receive(t,r,n,h);const E=i.remoteSDP.toString();throw yield St(i.peerConnection.setLocalDescription({type:"offer",sdp:d})),yield St(i.peerConnection.setRemoteDescription({type:"answer",sdp:E})),yield St(i.stopSending(c,!0)),g}i.remoteSDP.receive(t,r,n,h);const p=i.remoteSDP.toString(),_=i.logSDPExchange(d,"offer","local","send");return yield St(i.peerConnection.setLocalDescription({type:"offer",sdp:d})),yield St(i.applySimulcastEncodings(o,t)),yield St(i.applySendEncodings(o,t)),_==null||_(p),yield St(i.peerConnection.setRemoteDescription({type:"answer",sdp:p})),o.map((g,E)=>{const b=c[E];return{localSSRC:u[E],id:b,transceiver:g}})}catch(o){throw o instanceof ie?o:new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}})()}async createDataChannels(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let n=this.dataStreamChannelMap.get(t);if(n&&n.readyState==="open")C.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const s=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof s!="number")throw new Error("create DataChannel error, because cannot get dc id");n=this.peerConnection.createDataChannel("datastream-channel",{id:s,negotiated:!0,ordered:!1,maxRetransmits:W("DATASTREAM_MAX_RETRANSMITS")}),n.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,n)}r.forEach(s=>{s._updateOriginDataChannel(n)});const{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o),C.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else C.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(n){throw n instanceof ie?n:new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(n.toString()))}}async stopDataChannels(t){try{const r=this.dataStreamChannelMap.get(t);return r&&(r.id&&this.recoveredDataChannelIds.push(r.id),r.close()),void this.dataStreamChannelMap.delete(t)}catch(r){throw r instanceof ie?r:new ie($.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(r.toString()))}}async stopSending(t,r){const n=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(c=>t.indexOf(c.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(c=>{var d;Dy(this.id+c.mid,this),c.direction="inactive",(d=c.stop)===null||d===void 0||d.call(c)});const s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{n&&n()}}async receive(t,r,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,r,n,i);o&&(await Ay(this.peerConnection,this.remoteSDP,this.extension),C.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const a=this.peerConnection.getTransceivers().find(c=>c.mid===s);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:s,transceiver:a}}catch(s){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:r,needExchangeSDP:n}=this.remoteSDP.batchSend(t);return n&&(await Ay(this.peerConnection,this.remoteSDP,this.extension),C.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),r.map(i=>{const s=this.peerConnection.getTransceivers().find(o=>o.mid===i);if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:i,transceiver:s}})}catch(r){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(s=>{Array.from(this.preSSRCMap.entries()).some(o=>{let[a,c]=o;if(c===s)return this.preSSRCMap.delete(a),!0})}),this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString(),n=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const i=await this.peerConnection.createAnswer();n==null||n(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(r){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const r=this.remoteSDP.toString(),n=this.logSDPExchange(r,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const i=await this.peerConnection.createAnswer();n==null||n(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(r){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(r.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const r=this.remoteSDP.toString(),n=this.logSDPExchange(r,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const i=await this.peerConnection.createAnswer();n==null||n(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(r){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(r.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(o=>o.mid&&t.indexOf(o.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(o=>{o.direction="inactive"});const n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(t);const s=this.remoteSDP.toString();i==null||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(o=>o.mid&&t.indexOf(o.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async(o,a)=>{o.direction="sendonly"});const n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(t);const s=this.remoteSDP.toString();i==null||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new ie($.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return ko(function*(){const n=yield St(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(At().supportPCSetConfiguration){const d=r.peerConnection.getConfiguration(),l=t===Ss.RELAY?"relay":"all";d.iceTransportPolicy!==l&&(C.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(d.iceTransportPolicy,"] to [").concat(l,"]")),d.iceTransportPolicy=l,r.peerConnection.setConfiguration(d))}else if(t===Ss.RELAY)return;r.remoteSDP.updateCandidates(t);const i=yield St(r.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const s=_u(i.sdp),{remoteIceParameters:o}=yield s.iceParameters;r.remoteSDP.restartICE(o);const a=r.remoteSDP.toString(),c=r.logSDPExchange(i.sdp||"","offer","local","restartICE");r.store.descriptionStart(),yield St(r.peerConnection.setLocalDescription(i)),c==null||c(a),yield St(r.peerConnection.setRemoteDescription({type:"answer",sdp:a}))}catch(i){C.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),i)}finally{n()}})()}close(){var t;this.peerConnection.getTransceivers().forEach(r=>{Dy(this.id+r.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Mc(Mc({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(n.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),o==null||o(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new ie($.EXCHANGE_SDP_FAILED,n.toString())}}async updateSendParameters(t,r){const n=this.peerConnection.getTransceivers().filter(i=>i.mid===t);n.length===1&&(this.isVP8Simulcast(r)?Dr()||await this.applySimulcastEncodings(n,[r]):await this.applySendEncodings(n,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){const n=this.peerConnection.getTransceivers().find(i=>i.mid===r);n&&await n.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const r=t[0].transport.iceTransport,{local:n,remote:i}=r.getSelectedCandidatePair();return{local:Mc(Mc({},bd),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:Mc(Mc({},bd),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},W("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const r={iceServers:[]};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(aT(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...jg.turnServerConfigToIceServers(t.turnServer.servers)),W("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...jg.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),W("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(n=>{n.forceturn&&(r.iceTransportPolicy="relay")}))),W("ENABLE_ENCODED_TRANSFORM")&&At().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(t){const r=[];return t.forEach(n=>{n.security?n.tcpport&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turns:".concat(Kp(n.turnServerURL),":").concat(n.tcpport,"?transport=tcp")}):(n.udpport&&!W("FORCE_TURN_TCP")&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.udpport,"?transport=udp")}),n.tcpport&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.tcpport,"?transport=tcp")}))}),r}tryBindTransportEvents(t){const r=t.transport;if(r){this.transportEventReceiver=t,r.onstatechange=()=>{var i;r!=null&&r.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,r.state))},r.onerror=i=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in i?i.error:i)};const n=r.iceTransport;n&&(n.onstatechange=()=>{const i=r==null?void 0:r.iceTransport.state;var s;i&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:i,remote:s}=n.getSelectedCandidatePair();C.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol}),", remote ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var n,i;if(r||(r=this.peerConnection.getSenders().find(E=>E.track===t._mediaStreamTrack)),!r)return C.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return C.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!At().supportSetRtpSenderParameters)return C.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},o={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}const a=function(g,E){return g.getTransceivers().find(b=>b.sender.track===E||b.receiver.track===E)}(this.peerConnection,t._mediaStreamTrack),c=cLe(t);if($Le(t)&&a&&r&&c&&this.getLocalVideoStats&&Ee(n=["vp8","vp9"]).call(n,this.store.codec)){var d;const g=s.degradationPreference||(Ee(d=t._hints).call(d,ir.CUSTOM_TRACK)?W("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(E,b,v,I,N,L){if(Dy(E,v),N(b),I!=="balanced"&&I!=="maintain-framerate"&&I!=="maintain-resolution")return;let U=-1;dX(E,b);const w=window.setInterval(()=>{const z=IS.get(E);if(!W("ENABLE_AG_ADAPTATION")||!z)return Dy(E,v),void N(b);const K=L();if(K.sendPackets>0&&K.OutgoingAvailableBandwidth>0){if(U===-1)return void(U=Date.now());if(Date.now()-U<1e3)return;const H=K.sendFrameRate,A=K.OutgoingAvailableBandwidth,[m,S]=VLe(E,H,A,z.adaptationConfig,b,I);S&&(v.qualityLimitationReason=S),m&&z.adaptationConfig.scale!==m.scale&&(C.debug("[".concat(E,"] applyAdaptation: ").concat(v.qualityLimitationReason,`
           sendFps `).concat(H,", bwe ").concat(A,", switch from ").concat(z.adaptationConfig.scale," to ").concat(m.scale," ")),z.adaptationConfig=qC(qC({},z.adaptationConfig),m),N(m))}},W("CHECK_LOCAL_STATS_INTERVAL")),V=qC({},b);IS.set(E,{timer:w,adaptationConfig:V,originConfig:b,adaptationFunc:N}),C.debug("[".concat(E,"] start adaptation, originConfig: ").concat(JSON.stringify(b),", degradationPreference: ").concat(I))})(this.id+a.mid,c,this,g,E=>{r&&this.updateAdaptation(r,E)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var l;const{bitrateMax:g,frameRate:E,scaleResolutionDownBy:b}=t._encoderConfig;g&&(o.maxBitrate=1e3*g),(Ee(l=t._hints).call(l,ir.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(E&&(o.maxFramerate=Rs(E)),b&&b>=1&&(o.scaleResolutionDownBy=b))}const{maxFramerate:u}=W("ENCODER_CONFIG_LIMIT");if(u&&typeof u=="number"&&(o.maxFramerate=o.maxFramerate?Math.min(o.maxFramerate,u):u),W("DSCP_TYPE")&&Hu()){var h;const g=W("DSCP_TYPE");Ee(h=["very-low","low","medium","high"]).call(h,g)&&(o.networkPriority=g)}const p=r.getParameters(),_=(i=p.encodings)===null||i===void 0?void 0:i[0];Dr()&&!_&&(s.encodings=[o]),_&&Object.assign(_,o),Object.assign(p,s),C.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(p.encodings))),await r.setParameters(p),await async function(g,E,b){try{var v;if(!At().supportSetRtpSenderParameters||!function(w){return w==="vp9"}(g)||!W("ENABLE_SVC"))return;const I={},N={},L=E.getParameters(),U=(v=L.encodings)===null||v===void 0?void 0:v[0];N.scalabilityMode=bN(b),U&&Object.assign(U,N),Object.assign(L,I),await E.setParameters(L),C.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(L.encodings)))}catch(I){C.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",I)}}(this.store.codec,r,W("SVC_MODE"))}async updateAdaptation(t,r){var n,i;if(!t)return C.debug("[updateAdaptation] no rtpSender found");if(!At().supportSetRtpSenderParameters)return C.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const s={},{bitrateMax:o,frameRate:a,scaleResolutionDownBy:c}=r;o&&(s.maxBitrate=1e3*o),a&&(s.maxFramerate=Rs(a)),c&&c>=1&&Ee(n=["vp8","vp9"]).call(n,this.store.codec)&&(s.scaleResolutionDownBy=c);const d=t.getParameters(),l=(i=d.encodings)===null||i===void 0?void 0:i[0];l&&Object.assign(l,s),Object.assign(d,{});try{await t.setParameters(d),C.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(d.encodings)))}catch(u){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?C.debug("[updateAdaptation] peerConnection not connected}"):C.debug("[updateAdaptation] updateRtpSenderEncodings failed",u):C.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,r){try{if(!At().supportSetRtpSenderParameters||t.length!==r.length)return;for(let n=0;n<t.length;n++){const i=t[n],s=r[n];s instanceof hr&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch{C.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,n){const i=An.parse(t);return r.forEach((s,o)=>{const a=n[o],c=i.mediaDescriptions.find(d=>d.attributes.mid===a);c&&(Hm(c,s),qJ(c,s,this.store.codec))}),An.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,n)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,r,n)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var n;(n=this.onSelectedLocalCandidateChanged)===null||n===void 0||n.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var n;(n=this.onSelectedRemoteCandidateChanged)===null||n===void 0||n.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let c=0;c<t.length;c++){var n,i,s,o,a;const d=t[c],l=r[c];if(l instanceof hr&&!Ee(n=l._hints).call(n,ir.LOW_STREAM)&&(i=l._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=l._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=l._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((a=l._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1&&this.store.codec==="vp8"){const u={},h={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};u.encodings=[{rid:"m",active:!0,maxBitrate:h.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:h.high}];const p=d.sender.getParameters();await d.sender.setParameters(Object.assign(p,u))}}}async applySimulcastEncodings(t,r){if(!Dr()&&t.length===r.length)for(let n=0;n<t.length;n++){const i=r[n];if(i instanceof hr&&this.isVP8Simulcast(i)){const s=t[n],o={},a={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:a.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:a.medium,scaleResolutionDownBy:4}];const c=s.sender.getParameters();await s.sender.setParameters(Object.assign(c,o))}}}isVP8Simulcast(t){var r,n,i,s,o;return!!(t instanceof hr&&W("SIMULCAST")&&this.store.codec==="vp8"&&!Ee(r=t._hints).call(r,ir.LOW_STREAM)&&(n=t._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=t._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1)}logSDPExchange(t,r,n,i){if(W("SDP_LOGGING"))return C.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(r," SDP during P2PConnection.").concat(i,`
`),t),r==="offer"?s=>{this.logSDPExchange(s,"answer",n==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const r=this.remoteSDP.getSSRC(t);return r&&r.length!==0?r[0].ssrcId:void 0}setConfiguration(t){if(At().supportPCSetConfiguration){const r=jg.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}},we(Et.prototype,"updateRemoteRTPCapabilities",[Mi],Object.getOwnPropertyDescriptor(Et.prototype,"updateRemoteRTPCapabilities"),Et.prototype),we(Et.prototype,"connect",[Mi],Object.getOwnPropertyDescriptor(Et.prototype,"connect"),Et.prototype),we(Et.prototype,"updateRemoteConnect",[Mi],Object.getOwnPropertyDescriptor(Et.prototype,"updateRemoteConnect"),Et.prototype),we(Et.prototype,"createDataChannels",[Mi],Object.getOwnPropertyDescriptor(Et.prototype,"createDataChannels"),Et.prototype),we(Et.prototype,"receive",[Mi],Object.getOwnPropertyDescriptor(Et.prototype,"receive"),Et.prototype),we(Et.prototype,"batchReceive",[Mi],Object.getOwnPropertyDescriptor(Et.prototype,"batchReceive"),Et.prototype),we(Et.prototype,"stopReceiving",[Mi],Object.getOwnPropertyDescriptor(Et.prototype,"stopReceiving"),Et.prototype),we(Et.prototype,"muteRemote",[Mi],Object.getOwnPropertyDescriptor(Et.prototype,"muteRemote"),Et.prototype),we(Et.prototype,"unmuteRemote",[Mi],Object.getOwnPropertyDescriptor(Et.prototype,"unmuteRemote"),Et.prototype),we(Et.prototype,"muteLocal",[Mi],Object.getOwnPropertyDescriptor(Et.prototype,"muteLocal"),Et.prototype),we(Et.prototype,"unmuteLocal",[Mi],Object.getOwnPropertyDescriptor(Et.prototype,"unmuteLocal"),Et.prototype),we(Et.prototype,"close",[Mi],Object.getOwnPropertyDescriptor(Et.prototype,"close"),Et.prototype),we(Et.prototype,"updateEncoderConfig",[Mi],Object.getOwnPropertyDescriptor(Et.prototype,"updateEncoderConfig"),Et.prototype),we(Et.prototype,"updateSendParameters",[Mi],Object.getOwnPropertyDescriptor(Et.prototype,"updateSendParameters"),Et.prototype),we(Et.prototype,"replaceTrack",[Mi],Object.getOwnPropertyDescriptor(Et.prototype,"replaceTrack"),Et.prototype),we(Et.prototype,"updateAdaptation",[Mi],Object.getOwnPropertyDescriptor(Et.prototype,"updateAdaptation"),Et.prototype),we(Et.prototype,"getRemoteSSRC",[Mi],Object.getOwnPropertyDescriptor(Et.prototype,"getRemoteSSRC"),Et.prototype),Et);function Mi(e,t,r){const n=e[t];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const i=this.mutex,s=await i.lock("From P2PConnection.".concat(t));try{for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];return await n.apply(this,a)}finally{s()}},r}var lt;function Kj(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Uc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Kj(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kj(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Yj(e){var t,r,n,i=2;for(typeof Symbol<"u"&&(r=g3,n=Symbol.iterator);i--;){if(r&&(t=e[r])!=null)return t.call(e);if(n&&(t=e[n])!=null)return new $b(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function $b(e){function t(r){if(Object(r)!==r)return _e.reject(new TypeError(r+" is not an object."));var n=r.done;return _e.resolve(r.value).then(function(i){return{value:i,done:n}})}return $b=function(r){this.s=r,this.n=r.next},$b.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var n=this.s.return;return n===void 0?_e.resolve({value:r,done:!0}):t(n.apply(this.s,arguments))},throw:function(r){var n=this.s.return;return n===void 0?_e.reject(r):t(n.apply(this.s,arguments))}},new $b(e)}let Py=(lt=class extends Cr{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Fe.StateChange,t,this._state)}constructor(e,t){super(),j(this,"isPlanB",void 0),j(this,"store",void 0),j(this,"statsUploader",void 0),j(this,"connection",void 0),j(this,"localTrackMap",new Map),j(this,"remoteUserMap",new Map),j(this,"localDataChannels",[]),j(this,"remoteDataChannelMap",new Map),j(this,"pendingLocalTracks",[]),j(this,"pendingRemoteTracks",[]),j(this,"pendingLocalDataChannels",[]),j(this,"pendingRemoteDataChannels",[]),j(this,"statsCollector",void 0),j(this,"shouldForwardP2PCreation",void 0),j(this,"iceFailedCount",0),j(this,"dtlsFailedCount",0),j(this,"mutex",new Jn("P2PChannel-mutex")),j(this,"_state",Ut.Disconnected),j(this,"_pcStatsUploadType",W("NEW_ICE_RESTART")?Gd.FIRST_CONNECTION:Gd.OLD_FIRST_CONNECTION),j(this,"_isInRestartIce",!1),j(this,"_isStartRestartIce",!1),j(this,"_restartStates",["disconnected","failed"]),j(this,"_restartTimer",void 0),j(this,"_isFirstConnected",!0),j(this,"handleMuteLocalTrack",async(r,n,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Ut.Connected)return void i(new ie($.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const o=this.filterTobeMutedTracks(r);if(o.length===0)return void n();const a=o.find(d=>d[0]==="videoLowTrack");a&&a[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(o.map(d=>{let[,{id:l}]=d;return l}));const c=this.createMuteMessage(o);await er(this,Fe.RequestMuteLocal,c),n()}catch(o){i(o)}finally{s()}}),j(this,"handleUnmuteLocalTrack",async(r,n,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Ut.Connected)return void i(new ie($.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const o=this.filterTobeUnmutedTracks(r);if(o.length===0)return void n();const a=o.find(d=>d[0]==="videoLowTrack");if(a){const d=a[1];if(d.track._originMediaStreamTrack.stop(),!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&At().supportDualStreamEncoding){const l=r._mediaStreamTrack.clone();d.track._mediaStreamTrack=l,d.track._originMediaStreamTrack=l}else{const l=TN(r,hE(this,Fe.RequestLowStreamParameter));d.track._mediaStreamTrack=l,d.track._originMediaStreamTrack=l}await new _e((l,u)=>{this.handleReplaceTrack(d.track,l,u,!0)})}await this.connection.unmuteLocal(o.map(d=>{let[,{id:l}]=d;return l}));const c=this.createUnmuteMessage(o);await er(this,Fe.RequestUnmuteLocal,c),n()}catch(o){i(o)}finally{s()}}),j(this,"handleUpdateVideoEncoder",async(r,n,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const o=this.localTrackMap.get(le.LocalVideoTrack);if(!this.connection||!o||o.track!==r||this.state!==Ut.Connected)return void n();const{id:a,track:c}=o;await this.connection.updateSendParameters(a,c),await this.connection.updateEncoderConfig(a,c),this.emit(Fe.UpdateVideoEncoder,c),n()}catch(o){i(o)}finally{s()}}),j(this,"handleUpdateVideoSendParameters",async(r,n,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const o=this.localTrackMap.get(le.LocalVideoTrack);if(!this.connection||!o||o.track!==r||this.state!==Ut.Connected)return void n();const{id:a,track:c}=o;await this.connection.updateSendParameters(a,c),n()}catch(o){i(o)}finally{s()}}),j(this,"handleReplaceMixingTrack",async(r,n,i,s)=>{if(!this.connection||this.state!==Ut.Connected)return void n();const o=GC([r]);let a;C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(o.getTrackId(),"]")),typeof s=="boolean"&&s||(a=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(r,o),n()}catch(d){i(d)}finally{var c;(c=a)===null||c===void 0||c()}}),j(this,"handleReplaceTrack",async(r,n,i,s)=>{let o;C.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof s=="boolean"&&s||(o=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var a;const d=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:u}]=l;return r===u});if(!this.connection||!d||this.state!==Ut.Connected)return void n();if(await((a=this.connection)===null||a===void 0?void 0:a.replaceTrack(r,d[1].id)),this.isPlanB){const l=d[1];l.id=r._mediaStreamTrack.id,this.localTrackMap.set(d[0],l)}if(d[0]===le.LocalVideoTrack&&!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&At().supportDualStreamEncoding){const l=this.localTrackMap.get(le.LocalVideoLowTrack);if(l){const u=r._mediaStreamTrack.clone();l.track._originMediaStreamTrack.stop(),l.track._mediaStreamTrack=u,l.track._originMediaStreamTrack=u,await new _e((h,p)=>{this.handleReplaceTrack(l.track,h,p,!0)})}}n()}catch(d){i(d)}finally{var c;(c=o)===null||c===void 0||c()}}),j(this,"handleGetRTCStats",r=>{r(this.statsCollector.getRTCStats())}),j(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),j(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),j(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),j(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new aX(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!At().supportUnifiedPlan||W("CHROME_FORCE_PLAN_B")&&Hu(),this.shouldForwardP2PCreation=W("FORWARD_P2P_CREATION")&&At().supportPCSetConfiguration&&v3(),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new _g({},this.store):new qa({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var t;this.state=Ut.New;const r=this.shouldForwardP2PCreation&&((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!r||(r&&this.connection&&(C.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.isPlanB?new _g(e,this.store):new qa(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new ie($.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=W("NEW_ICE_RESTART")?Gd.FIRST_CONNECTION:Gd.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new ie($.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");W("ENABLE_PREALLOC_PC")&&this.state===Ut.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ut.Connected)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(i=>{var s;let[o]=i;return Ee(s=[le.LocalVideoLowTrack,le.LocalVideoTrack]).call(s,o)}),r=t.map(i=>{let[,{id:s}]=i;return s}),n=t.map(i=>{let[s]=i;return s});if(this.connection instanceof qa){if(Ce.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(n),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Ee(e).call(e,this.store.codec)){const i=["vp9","vp8","h264"].find(s=>Ee(e).call(e,s));i&&(this.store.codec=i,C.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i,".")))}this.connection.updateRemoteRTPCapabilities(r,e)}}async getEstablishParams(){var e;if(this.connection instanceof qa&&this.connection.peerConnectionState!=="closed"&&Ee(e=[Ut.New,Ut.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Ut.Connected){if(this.state===Ut.Disconnected)throw new ie($.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(r=>{var n;Ee(n=this.pendingLocalDataChannels).call(n,r)||this.pendingLocalDataChannels.push(r)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(r=>{const n=Date.now();this.store.publish(r.id.toString(),"datachannel",n)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(r=>{this.localDataChannels.push(r);const n=Date.now();this.store.publish(r.id+"","datachannel",void 0,n)}),e.map(r=>({streamId:r.id,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:r.metadata,channelId:r._originDataChannelId})))}publish(e,t,r){var n=this;return ko(function*(){const i=yield St(n.mutex.lock("From P2PChannel.publish"));try{if(!n.connection||n.state!==Ut.Connected){if(n.state===Ut.Disconnected)throw new ie($.UNEXPECTED_ERROR,"PeerConnection already disconnected.");n.throwIfTrackTypeNotMatch(e);const o=e.filter(a=>n.pendingLocalTracks.indexOf(a)===-1);return void(n.pendingLocalTracks=n.pendingLocalTracks.concat(o))}n.store.pubId=n.store.pubId+1,Kn.markPublishStart(n.store.clientId,n.store.pubId);const s=n.filterTobePublishedTracks(e,t,r);if(s.length===0)return void(yield St(n.tryToUnmuteAudio(e)));yield*gS(Yj(n.doPublish(n.connection,s)))}finally{i()}})()}doPublish(e,t){var r=this;return ko(function*(){t.forEach(u=>{let{track:h,type:p}=u;const _=Date.now();r.store.publish(h.getTrackId(),p===le.LocalAudioTrack?"audio":"video",_)}),r.bindLocalTrackEvents(t);const n=t.map(u=>{let{track:h}=u;return h}),i=yield St(e.send(n,r.store.codec,r.store.audioCodec)),s=(yield St(i.next())).value,o=r.createGatewayPublishMessage(t,s);let a;try{a=yield o}catch(u){throw i.throw(u),(u==null?void 0:u.code)===$.WS_ABORT&&t.forEach(h=>{let{track:p}=h;r.pendingLocalTracks.indexOf(p)===-1&&r.pendingLocalTracks.push(p)}),r.unbindLocalTrackEvents(t),u}const c=r.mapPubResToRemoteConfig(o,a,n),d=(yield St(i.next(c))).value,l=W("ENABLE_VIDEO_SEI");n.forEach(async u=>{const h=u.getRTCRtpTransceiver();h&&l&&(u.trackMediaType===Oe.VIDEO?await pLe(h.sender,u):u.trackMediaType===Oe.AUDIO&&await async function(p){if(!At().supportWebRTCEncodedTransform)return void C.warning("browser not support audio encoded transform");if(wy.has(p)||!p.track)return;const _={track:p.track};if(Iu()){if(!p.createEncodedStreams)return void C.warning("browser not support createEncodedStreams() API");let E=null;try{E=p.createEncodedStreams()}catch(v){return void C.error("create audio-encoded-streams error",v&&v.message)}const b=new TransformStream({transform(v,I){_.controller||(_.controller=I),p.track&&p.track.id!==_.track.id&&(C.debug("audio track changed: ".concat(_.track.id," => ").concat(p.track.id)),_.track.removeEventListener("ended",g),_.track=p.track,_.track.addEventListener("ended",g)),I.enqueue(v)}});E.readable.pipeThrough(b).pipeTo(E.writable)}else if(Bn()){if(typeof RTCRtpScriptTransform>"u")return void C.warning("browser not support RTCRtpScriptTransform");const E=Fb(),b=new MessageChannel;await new _e(I=>E.onmessage=N=>{N.data==="registered"&&I(void 0)});const v=new RTCRtpScriptTransform(E,{name:"tx",port:b.port2},[b.port2]);p.transform=v,await new _e(I=>E.onmessage=N=>{N.data==="started"&&I(void 0)}),b.port1.onmessage=I=>{var N;I.data.transformed&&p.track&&((N=p.track)===null||N===void 0?void 0:N.id)!==_.track.id&&(C.debug("audio track changed: ".concat(_.track.id," => ").concat(p.track.id)),_.track.removeEventListener("ended",g),_.track=p.track,_.track.addEventListener("ended",g))},_.worker=E}function g(){if(p.track){if(this.id!==p.track.id)return;p.track.removeEventListener("ended",g)}const E=wy.get(p);if(E){wy.delete(p);try{var b,v;(b=E.controller)===null||b===void 0||b.terminate(),(v=E.worker)===null||v===void 0||v.terminate()}catch(I){C.warning(I&&I.message)}}}wy.set(p,_),p.track.addEventListener("ended",g)}(h.sender))}),t.forEach(u=>{let{type:h}=u;r.statsCollector.addLocalStats(h)}),r.assignLocalTracks(t,d),r.statsUploader.startUploadOutboundStats(),t.forEach(u=>{let{track:h,type:p}=u;const _=Date.now();r.store.publish(h.getTrackId(),p===le.LocalAudioTrack?"audio":"video",void 0,_)})})()}async updateVideoStreamParameter(e,t){const r=this.localTrackMap.get(t);if(!r)return;if(!(r.track instanceof hr))return C.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof qa||this.connection instanceof _g))return C.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:n}=r,i=function(s,o){const a={};return s.height&&s.width&&(a.scaleResolutionDownBy=fN(s,o)),a.maxFramerate=s.framerate?Rs(s.framerate):void 0,a.maxBitrate=s.bitrate?1e3*s.bitrate:void 0,a}(e,n);if(n._encoderConfig||(n._encoderConfig={}),t!==le.LocalVideoLowTrack||!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&At().supportDualStreamEncoding)i.scaleResolutionDownBy!=null&&(n._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const s=n._originMediaStreamTrack;if(!s.canvas)return C.warn("[".concat(n.getTrackId(),"] no canvas on track"));(function(o,a){const c=o.canvas;a.width&&(c.width=Rs(a.width)),a.height&&(c.height=Rs(a.height)),a.framerate&&(c.stopCapture&&c.stopCapture(),c.stopCapture=D3(()=>{!c.startCapture&&c.stopCapture&&c.stopCapture(),c.startCapture&&c.startCapture()},Rs(a.framerate)))})(s,e)}i.maxBitrate!=null&&(n._encoderConfig.bitrateMax=i.maxBitrate/1e3),i.maxFramerate!=null&&(n._encoderConfig.frameRate&&typeof n._encoderConfig.frameRate=="object"?n._encoderConfig.frameRate.max=i.maxFramerate:n._encoderConfig.frameRate={max:i.maxFramerate}),C.debug("[".concat(n.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(n._encoderConfig))),await this.connection.updateRtpSenderEncodings(n)}publishLowStream(e){var t=this;return ko(function*(){if(!t.connection||t.state!==Ut.Connected)return;const r=yield St(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const i=t.localTrackMap.get(le.LocalVideoTrack);if(!i)throw new ie($.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(le.LocalVideoLowTrack))throw new ie($.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const s=[{track:t.getLowVideoTrack(i.track,e),type:le.LocalVideoLowTrack}];if(yield*gS(Yj(t.doPublish(t.connection,s))),i.track.muted||!i.track.enabled){var n;const o=(n=t.localTrackMap.get(le.LocalVideoLowTrack))===null||n===void 0?void 0:n.id;o!==void 0&&(yield St(t.connection.muteLocal([o])))}}finally{r()}})()}async republish(){this.pendingLocalTracks.length>0&&(C.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Vn(this,Fe.RequestRePublish,this.pendingLocalTracks),this.emit(Fe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(C.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Vn(this,Fe.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:r,kind:n}=this.pendingRemoteTracks[t];(n!==Oe.AUDIO||r._audio_added_&&r._audioSSRC)&&(n!==Oe.VIDEO||r._video_added_&&r._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Vn(this,Fe.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:r}of this.pendingRemoteTracks)await this.subscribe(t,r,r===Oe.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:r}=t;this.emit(Fe.MediaReconnectEnd,r.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Ut.Connected)return void e.forEach(n=>{const i=this.pendingLocalTracks.indexOf(n);i!==-1&&this.pendingLocalTracks.splice(i,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const r=t.find(n=>n[0]==="videoLowTrack");return r&&r[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Ut.Connected)return void e.forEach(r=>{const n=this.pendingLocalDataChannels.indexOf(r);n!==-1&&this.pendingLocalDataChannels.splice(n,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(r=>{const n=this.localDataChannels.indexOf(r);n!==-1&&this.localDataChannels.splice(n,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(r=>r.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Ut.Connected)return;const e=this.localTrackMap.get(le.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[le.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const r=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(n=>{let[,{id:i}]=n;return i})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(n=>{let[i,{track:s}]=n;return{type:i,track:s}})),t.forEach(n=>{let[i]=n;this.statsCollector.removeLocalStats(i)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),r}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Ut.Connected)throw new ie($.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const r=t.filter(n=>{var i;return!((i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.get(n.id))});if(r.length!==0)return await this.connection.createDataChannels(e.uid,r),r.forEach(n=>{var i;this.remoteDataChannelMap.has(e)?(i=this.remoteDataChannelMap.get(e))===null||i===void 0||i.set(n.id,n):this.remoteDataChannelMap.set(e,new Map([[n.id,n]]));const s=this.pendingRemoteDataChannels.findIndex(o=>{let{user:a,id:c}=o;return a.uid===e.uid&&c===n.id});s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),r.map(n=>n.id)}async subscribe(e,t,r,n,i){var s;if(!this.connection||this.state!==Ut.Connected)throw new ie($.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((s=this.remoteUserMap.get(e))!==null&&s!==void 0&&s.has(t))return;let o,a,c;const d=this.connection.getPreMedia(r);if(d)C.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(r,", no need to send sub to gateway.")),c=d.transceiver,o=d.track,a=d.id;else if(i){const h=i.find(_=>{let{stream_type:g}=_;return g===t});if(!h)throw new ie($.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const p=await this.connection.receive(t,h.ssrcs,String(e._uintid),h.attributes);this.connection instanceof qa&&(c=p.transceiver),o=p.track,a=p.id}else{const h=await this.connection.receive(t,[{ssrcId:r,rtx:n}],String(e._uintid),void 0);this.connection instanceof qa&&(c=h.transceiver),o=h.track,a=h.id}t===Oe.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(o):(e._audioTrack=new pm(o,e.uid,e._uintid,this.store),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(o):(e._videoTrack=new fm(o,e.uid,e._uintid,this.store),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack)),W("ENABLE_VIDEO_SEI")&&c&&(t==Oe.VIDEO?await async function(h){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!At().supportWebRTCEncodedTransform)return void C.warning("browser not support video encoded transform");if(!h.track)return;if(gg.has(h)){const E=gg.get(h);return void(E&&(E.onSei=p.onSei))}const _={track:h.track,onSei:p.onSei};if(Iu()){if(!h.createEncodedStreams)return void C.warning("browser not support createEncodedStreams() API");let E=null;try{E=h.createEncodedStreams()}catch(v){return void C.error("create video-encoded-streams error",v&&v.message)}const b=new TransformStream({transform(v,I){_.controller||(_.controller=I),h.track&&h.track.id!==_.track.id&&(C.debug("video track changed: ".concat(_.track.id," => ").concat(h.track.id)),_.track.removeEventListener("ended",g),_.track=h.track,_.track.addEventListener("ended",g));const N=function(L){const U=new DataView(L.data);let w=0;for(;w+4<L.data.byteLength;){if(U.getUint8(w+0)===0&&U.getUint8(w+1)===0&&U.getUint8(w+2)===0&&U.getUint8(w+3)===1&&U.getUint8(w+4)===6){let V=w+6,z=0,K=0;for(;(K=U.getUint8(V++))===255;)z+=255;z+=K;const H=fLe(L.data,V,z);return new Uint8Array(H)}w++}return null}(v);N&&_.onSei&&_.onSei(N),I.enqueue(v)}});E.readable.pipeThrough(b).pipeTo(E.writable)}else if(Bn()){if(typeof RTCRtpScriptTransform>"u")return void C.warning("browser not support RTCRtpScriptTransform");const E=Fb(),b=new MessageChannel;await new _e(I=>E.onmessage=N=>{N.data==="registered"&&I(void 0)});const v=new RTCRtpScriptTransform(E,{name:"rx",port:b.port2},[b.port2]);h.transform=v,await new _e(I=>E.onmessage=N=>{N.data==="started"&&I(void 0)}),b.port1.onmessage=I=>{var N;I.data.transformed&&h.track&&((N=h.track)===null||N===void 0?void 0:N.id)!==_.track.id?(C.debug("video track changed: ".concat(_.track.id," => ").concat(h.track.id)),_.track.removeEventListener("ended",g),_.track=h.track,_.track.addEventListener("ended",g)):I.data.sei&&_.onSei&&_.onSei(I.data.sei)},_.worker=E}function g(){if(h.track){if(this.id!==h.track.id)return;h.track.removeEventListener("ended",g)}(function(E){const b=gg.get(E);if(b){gg.delete(E);try{var v,I;(v=b.controller)===null||v===void 0||v.terminate(),(I=b.worker)===null||I===void 0||I.terminate()}catch(N){C.warning(N&&N.message)}}})(h)}gg.set(h,_),h.track.addEventListener("ended",g)}(c.receiver,{onSei:h=>{var p;(p=e._videoTrack)===null||p===void 0||p._onSei(h)}}):t==Oe.AUDIO&&await async function(h){if(!At().supportWebRTCEncodedTransform)return void C.warning("browser not support audio encoded transform");if(Ty.has(h))return;const p={track:h.track};if(Iu()){if(!h.createEncodedStreams)return void C.warning("browser not support createEncodedStreams() API");let g=null;try{g=h.createEncodedStreams()}catch(b){return void C.error("create audio-encoded-streams error",b&&b.message)}const E=new TransformStream({transform(b,v){p.controller||(p.controller=v),h.track&&h.track.id!==p.track.id&&(C.debug("audio track changed: ".concat(p.track.id," => ").concat(h.track.id)),p.track.removeEventListener("ended",_),p.track=h.track,p.track.addEventListener("ended",_)),v.enqueue(b)}});g.readable.pipeThrough(E).pipeTo(g.writable)}else if(Bn()){if(typeof RTCRtpScriptTransform>"u")return void C.warning("browser not support RTCRtpScriptTransform");const g=Fb(),E=new MessageChannel;await new _e(v=>g.onmessage=I=>{I.data==="registered"&&v(void 0)});const b=new RTCRtpScriptTransform(g,{name:"rx",port:E.port2},[E.port2]);h.transform=b,await new _e(v=>g.onmessage=I=>{I.data==="started"&&v(void 0)}),E.port1.onmessage=v=>{var I;v.data.transformed&&h.track&&((I=h.track)===null||I===void 0?void 0:I.id)!==p.track.id&&(C.debug("audio track changed: ".concat(p.track.id," => ").concat(h.track.id)),p.track.removeEventListener("ended",_),p.track=h.track,p.track.addEventListener("ended",_))},p.worker=g}function _(){h.track.removeEventListener("ended",_),function(g){const E=Ty.get(g);if(E){Ty.delete(g);try{var b,v;(b=E.controller)===null||b===void 0||b.terminate(),(v=E.worker)===null||v===void 0||v.terminate()}catch(I){C.warning(I&&I.message)}}}(h)}Ty.set(h,p),h.track.addEventListener("ended",_)}(c.receiver));const l=this.remoteUserMap.get(e);l?l.set(t,a):this.remoteUserMap.set(e,new Map([[t,a]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const u=this.pendingRemoteTracks.findIndex(h=>{let{user:p,kind:_}=h;return p.uid===e.uid&&t===_});u!==-1&&(this.pendingRemoteTracks.splice(u,1),this.emit(Fe.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Ut.Connected)throw new ie($.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(i=>{var s;let{user:o,mediaType:a}=i;return!((s=this.remoteUserMap.get(o))!==null&&s!==void 0&&s.has(a))});const t=[],r=new Map;e.forEach(i=>{if(!this.connection)return;const s=this.connection.getPreMedia(i.ssrcId);s?r.set(i.ssrcId,s):t.push(i)});const n=await this.connection.batchReceive(t.map(i=>{let{user:s,mediaType:o,ssrcId:a,rtxSsrcId:c}=i;return{kind:o,ssrcMsg:[{ssrcId:a,rtx:c}],mslabel:String(s._uintid)}}));t.forEach((i,s)=>{r.set(i.ssrcId,n[s])}),e.forEach(i=>{let{user:s,mediaType:o,ssrcId:a}=i;const c=r.get(a);if(!c)return void C.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(s.uid," subscribe data,").concat(o,", ").concat(a));const{track:d,id:l,transceiver:u}=c;o===Oe.AUDIO?(s._audioTrack?s._audioTrack._updateOriginMediaStreamTrack(d):(s._audioTrack=new pm(d,s.uid,s._uintid,this.store),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(s._audioTrack.getTrackId()))),u&&s._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(s,s._audioTrack)):(s._videoTrack?s._videoTrack._updateOriginMediaStreamTrack(d):(s._videoTrack=new fm(d,s.uid,s._uintid,this.store),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(s._videoTrack.getTrackId()))),u&&s._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(s,s._videoTrack));const h=this.remoteUserMap.get(s);h?h.set(o,l):this.remoteUserMap.set(s,new Map([[o,l]])),this.statsCollector.addRemoteStats(s.uid),this.statsUploader.startUploadInboundStats();const p=this.pendingRemoteTracks.findIndex(_=>{let{user:g,kind:E}=_;return g.uid===s.uid&&o===E});p!==-1&&(this.pendingRemoteTracks.splice(p,1),this.emit(Fe.MediaReconnectEnd,s.uid))})}async unsubscribe(e,t,r){const n=this.pendingRemoteTracks.filter(o=>{let{user:a,kind:c}=o;return t!==void 0?a.uid===e.uid&&t===c:a.uid===e.uid});if(n.forEach(o=>{const a=this.pendingRemoteTracks.indexOf(o);this.pendingRemoteTracks.splice(a,1)}),this.connection&&this.state===Ut.Connected||r||n.forEach(o=>{let{kind:a}=o;var c;if(a===Oe.AUDIO)(c=e._audioTrack)===null||c===void 0||c._destroy(),e._audioTrack=void 0;else if(a===Oe.VIDEO){var d;(d=e._videoTrack)===null||d===void 0||d._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Ut.Connected)return;const i=this.filterTobeUnSubscribedTracks(e,t);if(i.length===0)return;await this.connection.stopReceiving(i.map(o=>{let[,{id:a}]=o;return a}));const s=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(o=>{let[a,{kind:c}]=o;var d,l;if(c===Oe.VIDEO&&a._videoSSRC&&((d=this.connection)===null||d===void 0||d.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),c===Oe.VIDEO)this.unbindRemoteTrackEvents(a._videoTrack),r||((l=a._videoTrack)===null||l===void 0||l._destroy(),a._videoTrack=void 0);else if(c===Oe.AUDIO){var u;this.unbindRemoteTrackEvents(a._audioTrack),!r&&((u=a._audioTrack)===null||u===void 0||u._destroy(),a._audioTrack=void 0)}}),s}async unsubscribeDataChannel(e,t){if(t.forEach(i=>{const s=this.pendingRemoteDataChannels.findIndex(o=>o.id===i.id);s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),!this.connection)return;const r=this.filterTobeUnSubscribedDataChannels(e,t);if(r.length===0)return;t.forEach(i=>{i._close()});const n=this.remoteDataChannelMap.get(e);return r.forEach(i=>{n&&n.delete(i.id)}),n&&n.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),r.map(i=>i.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:i,mediaType:s}of e){const o=this.pendingRemoteTracks.filter(a=>{let{user:c,kind:d}=a;return s!==void 0?c.uid===i.uid&&s===d:c.uid===i.uid});o.forEach(a=>{const c=this.pendingRemoteTracks.indexOf(a);this.pendingRemoteTracks.splice(c,1)}),t=t.concat(o)}if(!this.connection||this.state!==Ut.Connected)return void t.forEach(i=>{let{user:s,kind:o}=i;var a;if(o===Oe.AUDIO)(a=s._audioTrack)===null||a===void 0||a._destroy(),s._audioTrack=void 0;else if(o===Oe.VIDEO){var c;(c=s._videoTrack)===null||c===void 0||c._destroy(),s._videoTrack=void 0}});const r=yc(e).call(e,(i,s)=>{let{user:o,mediaType:a}=s;const c=this.filterTobeUnSubscribedTracks(o,a);return i.concat(c)},[]);if(r.length===0)return;await this.connection.stopReceiving(r.map(i=>{let[,{id:s}]=i;return s}));const n=this.createUnsubscribeAllMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(i=>{let[s,{kind:o}]=i;var a,c;if(o===Oe.VIDEO&&s._videoSSRC&&((a=this.connection)===null||a===void 0||a.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),o===Oe.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),(c=s._videoTrack)===null||c===void 0||c._destroy(),s._videoTrack=void 0;else if(o===Oe.AUDIO){var d;this.unbindRemoteTrackEvents(s._audioTrack),(d=s._audioTrack)===null||d===void 0||d._destroy(),s._audioTrack=void 0}}),n}isPreSubScribe(e){return!this.connection||this.state!==Ut.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const r=this.remoteUserMap.get(e);if(!r)return void C.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void C.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const n=t===Oe.VIDEO?e._videoSSRC:e._audioSSRC;n!==void 0&&this.connection.setStatsRemoteVideoIsReady(n,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const r=this.remoteUserMap.get(e);if(!r)return void C.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||C.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(le.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Qr){const r=t.track;return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return i!==le.LocalAudioTrack}).filter(n=>{let[i]=n;return!(e&&i===le.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[n]=r;return!(e&&n===le.LocalVideoLowTrack)}).map(r=>{let[,{track:n}]=r;return n})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,r,n,i){if(e){const o=this.localTrackMap.get(le.LocalAudioTrack),a=n?this.localTrackMap.get(le.LocalVideoLowTrack):this.localTrackMap.get(le.LocalVideoTrack);Ce.publish(this.store.sessionId,{eventElapse:Kn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o==null?void 0:o.track.getTrackLabel(),videoName:a==null?void 0:a.track.getTrackLabel(),screenshare:(a==null?void 0:a.track._hints.indexOf(ir.SCREEN_TRACK))!==-1,audio:!!o,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;r||(r=[]);const o=r.find(c=>c instanceof Ir),a=n?(s=this.localTrackMap.get(le.LocalVideoTrack))===null||s===void 0?void 0:s.track:r.find(c=>c instanceof hr);Ce.publish(this.store.sessionId,{eventElapse:Kn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o==null?void 0:o.getTrackLabel(),videoName:a==null?void 0:a.getTrackLabel(),screenshare:(a==null?void 0:a._hints.indexOf(ir.SCREEN_TRACK))!==-1,audio:!!o,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,r,n){const i=n===Oe.VIDEO?r._videoSSRC:r._audioSSRC;i&&Ce.subscribe(this.store.sessionId,{succ:e,ec:t,video:n===Oe.VIDEO,audio:n===Oe.AUDIO,peerid:r.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:Kn.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){C.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Jn("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new _g({},this.store):new qa({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(le.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Qr){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(r=>{t.removeAudioTrack(r)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Ut.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(le.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(le.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof hr||t&&t.track instanceof Ir?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;const r=Array.from(Ks(t=this.remoteUserMap).call(t)).find(n=>n.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(r=>{let[n]=r;return{uid:n.uid,level:n.audioTrack?100*n.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(le.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=sv(e).call(e,(r,n)=>r.level-n.level),e}async disconnectForReconnect(){this.connection&&(C.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Ut.Reconnecting,W("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new _g({},this.store):new qa({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:n}]=e;switch(r){case le.LocalVideoTrack:Ee(t=n._hints).call(t,ir.LOW_STREAM)?n.close():this.pendingLocalTracks.push(n);break;case le.LocalAudioTrack:n instanceof Qr?this.pendingLocalTracks=this.pendingLocalTracks.concat(n.trackList):this.pendingLocalTracks.push(n);case le.LocalVideoLowTrack:}}),this.emit(Fe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(Ks(r).call(r)).forEach(n=>{this.setPendingRemoteMedia(t,n)}),this.emit(Fe.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,r]=e;Array.from(Ks(r).call(r)).forEach(n=>{this.setPendingRemoteDataChannel(t,n)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),C.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const r of this.pendingRemoteDataChannels){const{user:n,id:i}=r;if((e instanceof au?e.uid:e)===n.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const r of this.pendingRemoteTracks){const{user:n,kind:i}=r;if((e instanceof au?e.uid:e)===n.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return ko(function*(){if(!t.connection||t.state!==Ut.Connected)return;const r=yield St(t.mutex.lock("From P2PChannel.restartICE"));let n;try{n=yield St(t.connection.restartICE(e));const s=yield St(n.next());if(s.done)return;const o=s.value,a=yield o;switch(t.reportPCDisconnectedOrFailed(e),e){case Ss.TCP:t._pcStatsUploadType=Gd.TCP_RESTART;break;case Ss.RELAY:t._pcStatsUploadType=Gd.RELAY_RESTART;break;default:t._pcStatsUploadType=Gd.OLD_RESTART}t._isInRestartIce=!0,n.next(a)}catch(s){var i;(i=n)===null||i===void 0||i.throw(s)}finally{r()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(le.LocalVideoTrack),r=this.localTrackMap.get(le.LocalAudioTrack),n=e.videoSend.find(p=>p.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),i=e.audioSend.find(p=>p.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId));if(!n||!i)return 1;const s=Lo(this,Fe.NeedSignalRTT),o=n?n.rttMs:void 0,a=i?i.rttMs:void 0,c=o&&a?(o+a)/2:o||a,d=(c&&s?(c+s)/2:c||s)||0,l=100*e.sendPacketLossRate*.7/50+.3*d/1500,u=l<.17?1:l<.36?2:l<.59?3:l<.1?4:5,h=t==null?void 0:t.track;if(h&&h._encoderConfig&&h._hints.indexOf(ir.SCREEN_TRACK)===-1){const p=h._encoderConfig.bitrateMax,_=e.bitrate.actualEncoded;if(p&&_){const g=(1e3*p-_)/(1e3*p);return nJ[g<.15?0:g<.3?1:g<.45?2:g<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[n]=r;const i=n._audioSSRC,s=n._videoSSRC,o=e.audioRecv.find(_=>_.ssrc===i),a=e.videoRecv.find(_=>_.ssrc===s);if(!o&&!a)return void(t+=1);const c=Lo(this,Fe.NeedSignalRTT),d=e.rtt,l=(d&&c?(d+c)/2:d||c)||0,u=o?o.jitterMs:void 0,h=e.recvPacketLossRate;let p=.7*h*100/50+.3*l/1500;u&&(p=.6*h*100/50+.2*l/1500+.2*u/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new _e((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}async replaceTrack(e,t){var r;if(C.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Ut.Connected)return;const n=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:o}]=s;return e===o});if(!n)return;const i=n[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),n[1].track=t),await((r=this.connection)===null||r===void 0?void 0:r.replaceTrack(t,n[1].id)),this.isPlanB){const s=n[1];s.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,s)}if(i===le.LocalVideoTrack&&!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&At().supportDualStreamEncoding){const s=this.localTrackMap.get(le.LocalVideoLowTrack);if(s){const o=e._mediaStreamTrack.clone();s.track._originMediaStreamTrack.stop(),s.track._mediaStreamTrack=o,s.track._originMediaStreamTrack=o,await new _e((a,c)=>{this.handleReplaceTrack(s.track,a,c,!0)})}}}filterTobePublishedTracks(e,t,r){const n=[],i=this.getAllTracks();e=Gp(e=e.filter(c=>i.indexOf(c)===-1));let s,o=!1;const a=this.localTrackMap.get(le.LocalAudioTrack);for(const c of e){if(c instanceof hr&&(this.localTrackMap.has(le.LocalVideoTrack)||o?new ie($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(n.push({track:c,type:le.LocalVideoTrack}),o=!0),t)){const d=this.getLowVideoTrack(c,r);n.push({track:d,type:le.LocalVideoLowTrack})}if(c instanceof Ir)if(a){const d=a.track;if(d instanceof Qr)RN([c]),d.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0);else{const l=GC([d,c]);C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(l.getTrackId(),"]")),this.replaceTrack(d,l)}}else s instanceof Qr?(RN([c]),s.addAudioTrack(c)):s||!c._useAudioElement&&At().webAudioMediaStreamDest&&!c._bypassWebAudio?s=GC(s?[c,s]:[c]):s=c}return s&&(C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(s.getTrackId(),"]")),n.push({track:s,type:le.LocalAudioTrack})),n}filterTobeUnpublishedTracks(e){const t=[],r=this.getAllTracks();e=Gp(e=e.filter(n=>r.indexOf(n)!==-1));for(const n of e){if(n instanceof Ir){const i=this.localTrackMap.get(le.LocalAudioTrack);if(!i)continue;i.track instanceof Qr?(i.track.removeAudioTrack(n),this.unbindLocalAudioTrackEvents(n),i.track.trackList.length===0&&(t.push([le.LocalAudioTrack,i]),i.track.close())):t.push([le.LocalAudioTrack,i])}if(n instanceof hr){const i=this.localTrackMap.get(le.LocalVideoTrack);if(!i)continue;t.push([le.LocalVideoTrack,i]);const s=this.localTrackMap.get(le.LocalVideoLowTrack);s&&t.push([le.LocalVideoLowTrack,s])}}return t}filterTobePublishedDataChannels(e){return e=(e=Gp(e)).filter(t=>this.localDataChannels.findIndex(r=>r.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Gp(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:r,type:n}=t;switch(n){case le.LocalVideoTrack:r.addListener(be.GET_STATS,this.handleGetLocalVideoStats),r.addListener(be.GET_RTC_STATS,this.handleGetRTCStats),r.addListener(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(be.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(be.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(be.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case le.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case le.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Qr?e.trackList.forEach(r=>{r.addListener(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(be.GET_STATS,this.handleGetLocalAudioStats),r.addListener(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(be.GET_STATS,this.handleGetLocalAudioStats),e.addListener(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(be.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(be.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[r,{track:n}]=t;return{track:n,type:r}})),e.forEach(t=>{let{track:r,type:n}=t;switch(n){case le.LocalVideoTrack:r.off(be.GET_STATS,this.handleGetLocalVideoStats),r.off(be.GET_RTC_STATS,this.handleGetRTCStats),r.off(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(be.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(be.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(be.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case le.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case le.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Qr?e.trackList.forEach(t=>{t.off(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(be.GET_STATS,this.handleGetLocalAudioStats),t.off(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(be.GET_STATS,this.handleGetLocalAudioStats),e.off(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(be.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(be.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof fm&&t.addListener(be.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(e))}),t instanceof pm&&t.addListener(be.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(be.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has(Oe.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(Oe.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((r,n)=>{var i;let s,o,{track:a,type:c}=r;switch(c){case le.LocalAudioTrack:s=jt.Audio,o={dtx:a instanceof wS&&a._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case le.LocalVideoTrack:s=Ee(i=a._hints).call(i,ir.SCREEN_TRACK)?jt.Screen:jt.High,o=Uc(Uc({},zU(a)),{},{codec:this.store.codec,svc_mode:bN()});break;case le.LocalVideoLowTrack:s=jt.Low,o=Uc(Uc({},zU(a)),{},{codec:this.store.codec,svc_mode:bN()})}return{stream_type:s,attributes:o,ssrcs:t[n]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var r;let n,[i,{track:s,ssrcs:o,id:a}]=t;switch(i){case le.LocalVideoTrack:n=Ee(r=s._hints).call(r,ir.SCREEN_TRACK)?jt.Screen:jt.High;break;case le.LocalAudioTrack:n=jt.Audio;break;case le.LocalVideoLowTrack:n=jt.Low}return{stream_type:n,ssrcs:o,mid:a}})}assignLocalTracks(e,t){e.forEach((r,n)=>{let{track:i,type:s}=r;this.localTrackMap.set(s,{track:i,id:t[n].id,ssrcs:t[n].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[r]=t;this.localTrackMap.delete(r)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Fe.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),W("NEW_ICE_RESTART")){var r;if(Ee(r=this._restartStates).call(r,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=o=>{(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")&&(C.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(o)),Lo(this,Fe.QueryClientConnectionState)==="CONNECTED"&&this.emit(Fe.RequestRestartICE,o))},i=()=>{e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="checking"&&e.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),C.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Fe.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},s=W("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(W("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&At().supportPCSetConfiguration)n(Ss.RELAY),this._restartTimer=window.setTimeout(i,s);else if(Dr())n(Ss.UDP),this._restartTimer=window.setTimeout(i,4e3);else{if(n(Ss.TCP),At().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{n(Ss.RELAY),this._restartTimer=window.setTimeout(i,s)},s));this._restartTimer=window.setTimeout(i,s)}},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&W("ICE_RESTART")&&Lo(this,Fe.QueryClientConnectionState)==="CONNECTED"&&this.emit(Fe.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(Fe.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(Fe.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Ce.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Or.TRACER}).onSuccess(),this.emit(Fe.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;const n=Array.from(Ks(r=this.remoteUserMap).call(r)).find(s=>s._audioSSRC===t);var i;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),(i=n.audioTrack)===null||i===void 0||i.emit(hm.FIRST_FRAME_DECODED),Ce.firstRemoteFrame(this.store.sessionId,bn.FIRST_AUDIO_DECODE,Rr.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:Kn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;const n=Array.from(Ks(r=this.remoteUserMap).call(r)).find(i=>i._audioSSRC===t);n&&Ce.firstRemoteFrame(this.store.sessionId,bn.FIRST_AUDIO_RECEIVED,Rr.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:Kn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,n)=>{this.reportVideoFirstFrameDecoded(t,r,n)},e.onFirstVideoReceived=t=>{var r;const n=Array.from(Ks(r=this.remoteUserMap).call(r)).find(i=>i._videoSSRC===t);n&&Ce.firstRemoteFrame(this.store.sessionId,bn.FIRST_VIDEO_RECEIVED,Rr.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:Kn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,r)=>{const n=t.candidateType==="relay",i=r.candidateType==="relay";r.candidateType!=="unknown"&&n===i||this.emit(Fe.ConnectionTypeChange,n),C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(gu(r))," -> ").concat(JSON.stringify(gu(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(gu(r))," -> ").concat(JSON.stringify(gu(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),r=this.statsCollector.getRTCStats();return Uc(Uc({},t),r)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const r=this.localTrackMap.get(le.LocalAudioTrack);if(e instanceof Ir&&(r==null?void 0:r.track)instanceof Qr)return r.track.isActive||t.push([le.LocalAudioTrack,r]),t;const n=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(n&&(t.push(n),n[0]===le.LocalVideoTrack)){const i=this.localTrackMap.get(le.LocalVideoLowTrack);i&&t.push([le.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],r=this.localTrackMap.get(le.LocalAudioTrack);if(e instanceof Ir&&(r==null?void 0:r.track)instanceof Qr)return r.track.isActive&&t.push([le.LocalAudioTrack,r]),t;const n=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(n)if(n[0]===le.LocalVideoTrack){t.push(n);const i=this.localTrackMap.get(le.LocalVideoLowTrack);i&&t.push([le.LocalVideoLowTrack,i])}else t.push(n);return t}createMuteMessage(e){return e.map(t=>{var r;let n,[i,{track:s,ssrcs:o,id:a}]=t;switch(i){case le.LocalAudioTrack:n=jt.Audio;break;case le.LocalVideoTrack:n=Ee(r=s._hints).call(r,ir.SCREEN_TRACK)?jt.Screen:jt.High;break;case le.LocalVideoLowTrack:n=jt.Low}return{stream_type:n,ssrcs:o,mid:a}})}createUnmuteMessage(e){return e.map(t=>{var r;let n,[i,{track:s,ssrcs:o,id:a}]=t;switch(i){case le.LocalAudioTrack:n=jt.Audio;break;case le.LocalVideoTrack:n=Ee(r=s._hints).call(r,ir.SCREEN_TRACK)?jt.Screen:jt.High;break;case le.LocalVideoLowTrack:n=jt.Low}return{stream_type:n,ssrcs:o,mid:a}})}filterTobeUnSubscribedTracks(e,t){const r=[],n=this.remoteUserMap.get(e);if(!n)return r;if(t){const i=n.get(t);if(!i)return r;r.push([e,{kind:t,id:i}])}else Array.from(n.entries()).forEach(i=>{let[s,o]=i;r.push([e,{kind:s,id:o}])});return r}filterTobeUnSubscribedDataChannels(e,t){const r=[];return t.forEach(n=>{var i;(i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.has(n.id)&&r.push(n)}),r}createUnsubscribeMessage(e){const t=[];return e.forEach(r=>{let[n,{kind:i,id:s}]=r;switch(i){case Oe.VIDEO:return void(n._videoSSRC&&t.push({stream_type:Oe.VIDEO,ssrcId:n._videoSSRC}));case Oe.AUDIO:return void(n._audioSSRC&&t.push({stream_type:Oe.AUDIO,ssrcId:n._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(r=>{let[n,{kind:i}]=r;if(t.has(n)){let s=t.get(n);i===Oe.VIDEO?s|=hn.Video:s|=hn.Audio,t.set(n,s)}else i===Oe.VIDEO?t.set(n,hn.Video):t.set(n,hn.Audio)}),{users:Array.from(t.entries()).map(r=>{let[n,i]=r;return{stream_id:n.uid,stream_type:i}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[r,{kind:n}]=t;const i=this.remoteUserMap.get(r);i&&(i.delete(n),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(le.LocalVideoTrack),r=this.localTrackMap.get(le.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),r&&e.low_stream_uplink&&await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t,r){return e.map((n,i)=>{var s;let{stream_type:o}=n;const a=(s=t.find(c=>{let{stream_type:d}=c;return o===d}))===null||s===void 0?void 0:s.attributes;if(a&&W("DISABLE_SCREEN_SHARE_REMB")){const c=r[i]._hints;(Ee(c).call(c,ir.SCREEN_TRACK)||Ee(c).call(c,ir.SCREEN_LOW_TRACK))&&(a.remb=!1,C.debug("disable remb for screen share, hints:",c))}return a})}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof Ir){var t;const n=this.filterTobeUnmutedTracks(e[r]);if(n.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(n.map(s=>{let[,{id:o}]=s;return o})));const i=this.createUnmuteMessage(n);return void await er(this,Fe.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Fe.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Fe.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await In(b3(this.dtlsFailedCount,Kr)),this.emit(Fe.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Vn(this,Fe.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Fe.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(le.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof hr)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof hr).length>1)throw new ie($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Ir).length>1&&(e.some(t=>t instanceof Ir&&t._bypassWebAudio)||!At().webAudioMediaStreamDest))throw new ie($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof hr&&this.pendingLocalTracks.some(r=>r instanceof hr))throw new ie($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Ir&&this.pendingLocalTracks.some(r=>r instanceof Ir)&&(!At().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof Ir&&r._bypassWebAudio)))throw new ie($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var r;const n=!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&At().supportDualStreamEncoding,i=Uc(Uc({},{width:160,height:120,framerate:15,bitrate:50}),t);let s;s=n?e._mediaStreamTrack.clone():TN(e,i);const o=ar(8,"track-low-"),a=new hr(s,Uc(Uc({},n&&{scaleResolutionDownBy:fN(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,o);return a.on(nf.TRANSCEIVER_UPDATED,c=>{e._updateRtpTransceiver(c,$m.LOW_STREAM)}),a._hints.push(ir.LOW_STREAM),Ee(r=e._hints).call(r,ir.SCREEN_TRACK)&&a._hints.push(ir.SCREEN_LOW_TRACK),e.on("sei-to-send",c=>{a.emit("sei-to-send",c)}),e.addListener(be.NEED_CLOSE,()=>{a.close()}),a}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof qa){var i,s,o,a;const c=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:d,dtlsTransportState:l,peerConnectionState:u}=this.connection,{local:h,remote:p}=await this.connection.getSelectedCandidatePair();Ce.pcStats(this.store.sessionId,{startTime:c,eventElapse:e-c||0,iceconnectionsate:d,dtlsstate:l,connectionstate:u,intSucc:t?1:2,error:n,selectedLocalCandidateProtocol:(i=h==null?void 0:h.protocol)!==null&&i!==void 0?i:"",selectedLocalCandidateType:(s=h.candidateType)!==null&&s!==void 0?s:"",selectedLocalCandidateAddress:"".concat(h.address,":").concat(h.port),selectedRemoteCandidateProtocol:(o=p.protocol)!==null&&o!==void 0?o:"",selectedRemoteCandidateType:(a=p.candidateType)!==null&&a!==void 0?a:"",selectedRemoteCandidateAddress:"".concat(p.address,":").concat(p.port),restartCnt:r,preallocation:this.connection.isPreallocation})}}reportVideoFirstFrameDecoded(e,t,r,n){var i;const s=Array.from(Ks(i=this.remoteUserMap).call(i)).find(o=>o._videoSSRC===e);if(s){n||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const o=this.store.keyMetrics,a=o.subscribe.find(c=>c.userId===s.uid&&c.type==="video");Ce.firstRemoteVideoDecode(this.store.sessionId,bn.FIRST_VIDEO_DECODE,Rr.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:r,subscribeElapse:Kn.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:(a==null?void 0:a.subscribeEnd)||0,subscriberStart:(a==null?void 0:a.subscribeStart)||0,videoAddNotify:(a==null?void 0:a.streamAdded)||0,state:n?1:0,firstFrame:(a==null?void 0:a.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.connection)return!1;const n=this.remoteUserMap.get(e);if(!n)return!1;const i=n.get(t);if(!i)return!1;const s=await this.connection.getRemoteSSRC(i);return s!==void 0&&s!==r}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===le.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,$m.LOW_STREAM):r._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof qa&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===Gd.TCP_RESTART&&e===Ss.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,Gd.DISCONNECTED_OR_FAILED)))}},we(lt.prototype,"startP2PConnection",[oi],Object.getOwnPropertyDescriptor(lt.prototype,"startP2PConnection"),lt.prototype),we(lt.prototype,"connect",[oi],Object.getOwnPropertyDescriptor(lt.prototype,"connect"),lt.prototype),we(lt.prototype,"updateRemoteRTPCapabilities",[oi],Object.getOwnPropertyDescriptor(lt.prototype,"updateRemoteRTPCapabilities"),lt.prototype),we(lt.prototype,"publishDataChannel",[oi],Object.getOwnPropertyDescriptor(lt.prototype,"publishDataChannel"),lt.prototype),we(lt.prototype,"unpublish",[oi],Object.getOwnPropertyDescriptor(lt.prototype,"unpublish"),lt.prototype),we(lt.prototype,"unpublishDataChannel",[oi],Object.getOwnPropertyDescriptor(lt.prototype,"unpublishDataChannel"),lt.prototype),we(lt.prototype,"unpublishLowStream",[oi],Object.getOwnPropertyDescriptor(lt.prototype,"unpublishLowStream"),lt.prototype),we(lt.prototype,"subscribeDataChannel",[oi],Object.getOwnPropertyDescriptor(lt.prototype,"subscribeDataChannel"),lt.prototype),we(lt.prototype,"subscribe",[oi],Object.getOwnPropertyDescriptor(lt.prototype,"subscribe"),lt.prototype),we(lt.prototype,"massSubscribe",[oi],Object.getOwnPropertyDescriptor(lt.prototype,"massSubscribe"),lt.prototype),we(lt.prototype,"unsubscribe",[oi],Object.getOwnPropertyDescriptor(lt.prototype,"unsubscribe"),lt.prototype),we(lt.prototype,"unsubscribeDataChannel",[oi],Object.getOwnPropertyDescriptor(lt.prototype,"unsubscribeDataChannel"),lt.prototype),we(lt.prototype,"massUnsubscribe",[oi],Object.getOwnPropertyDescriptor(lt.prototype,"massUnsubscribe"),lt.prototype),we(lt.prototype,"muteRemote",[oi],Object.getOwnPropertyDescriptor(lt.prototype,"muteRemote"),lt.prototype),we(lt.prototype,"unmuteRemote",[oi],Object.getOwnPropertyDescriptor(lt.prototype,"unmuteRemote"),lt.prototype),we(lt.prototype,"hasRemoteMediaWithLock",[oi],Object.getOwnPropertyDescriptor(lt.prototype,"hasRemoteMediaWithLock"),lt.prototype),we(lt.prototype,"disconnectForReconnect",[oi],Object.getOwnPropertyDescriptor(lt.prototype,"disconnectForReconnect"),lt.prototype),we(lt.prototype,"updateBitrateLimit",[oi],Object.getOwnPropertyDescriptor(lt.prototype,"updateBitrateLimit"),lt.prototype),we(lt.prototype,"remoteMediaSsrcChanged",[oi],Object.getOwnPropertyDescriptor(lt.prototype,"remoteMediaSsrcChanged"),lt.prototype),lt);function oi(e,t,r){const n=e[t];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const i=this.mutex,s=await i.lock("From P2PChannel.".concat(t));try{for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];return await n.apply(this,a)}finally{s()}},r}const uX={};function vg(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&C.debug("install service ".concat(e.name)),uX[e.name]=e}function Fg(e){const t=uX[e];if(!t)throw new ie($.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function Jj(e,t){return Fg("DataStream").create(e,t)}function Xj(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Qj(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Xj(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xj(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}const HLe=Date.now(),zLe=20,AN=new Map,Hb=new Map;async function hX(e){const t=AN.get(e),r=Array.isArray(t)&&t[t.length-1],n=Hb.get(e);if(!r)return void(n.isSyncing=!1);const i={uid:r.uid,payload:r.payload};n.firstRecvTs===0&&(n.firstRecvTs=r.recvTs,n.firstSendTs=r.sendTs);const s=r.sendTs-n.firstSendTs,o=s-(Date.now()-n.firstRecvTs);o>0&&(n.firstRecvTs=Date.now()-s);let a=r.mediaDelay+o;a<=0?(t.pop(),fX(r.context,i),a=0):a=Math.min(a,zLe),setTimeout(()=>t.length&&hX(e),a)}function fX(e,t){e.safeEmit(mt.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function WLe(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return fX(r,{uid:e.uid,payload:e.payload});const n="".concat(r.id,"-").concat(e.uid),i=AN.get(n)||[],s=i.findIndex(d=>e.sendTs>=d.sendTs),o=Qj(Qj({},e),{},{context:r,mediaDelay:t,recvTs:Date.now()});s===-1?i.push(o):i.splice(s,0,o),AN.set(n,i);let a=!1;var c;Hb.has(n)?a=!((c=Hb.get(n))===null||c===void 0||!c.isSyncing):Hb.set(n,{isSyncing:a,firstRecvTs:0,firstSendTs:0}),a||hX(n)}const GLe=Rt().name;function Zj(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function eF(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Zj(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zj(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}const _m="websdk_ng_cache_parameter",qLe=W("MAX_PRELOAD_ASYNC_LENGTH"),KLe=1e4,Dh=new Map,Ph=[];let KC=null,YC=0,JC=0;const ky=new Map,YLe=function(e,t){const r=[];let n=0;const i=async()=>{const s=r.shift();s&&await s(),r.length>0&&n<t?i():n--};return async function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];return new _e(async(c,d)=>{r.push(async()=>{try{const l=await e(...o);c(l)}catch(l){d(l)}}),n<t&&(n++,i())})}}(pX,qLe),XC=Hi.CancelToken.source();async function pX(e,t,r,n,i,s){try{if(!W("ENABLE_PRELOAD"))return;if(!At().supportWebCrypto)return void zu(()=>{C.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!r&&r!==null)throw new ie($.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&wn(r,"token",1,2047),wn(e,"appid",1,2047),uT(t),n&&hT(n);const o=qp();C.debug("preload channel ".concat(t,", uid is ").concat(n));const a={appId:e,cname:t,token:r||e,uid:typeof n!="string"?n:null,sid:o,proxyServer:i};let c,d;typeof n=="string"?(a.stringUid=n,[d,c]=await _e.all([bLe(n,{sid:o,appId:e},XC.token),oj(eF(eF({},a),{},{token:r||e,uid:0}),XC.token)]),a.uid=d.uid,c.gatewayInfo.uid=a.uid,c.gatewayInfo.res.uid=a.uid):(s&&(a.stringUid=s),c=await oj(a,XC.token));const l={sid:o,appId:e,cname:t,token:r||e,uid:a.stringUid||n,intUid:a.uid||c.gatewayInfo.uid,stringUid:a.stringUid,ts:Date.now(),sua:d,ap:c};await async function(u){let h;try{u.uid&&mX({appId:u.appId,cname:u.cname,token:u.token,uid:u.uid,stringUid:u.stringUid});const p=EX(u),_=await async function(E,b){try{const v=await window.crypto.subtle.importKey("raw",QY(b),"AES-GCM",!1,["encrypt"]),I=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},v,zh(window.btoa(JSON.stringify(E))));return Ou(new Uint8Array(I))}catch{return}}(u,u.token||u.appId);if(!_)return;h=_X(_m);const g=h?JSON.parse(h):[];g.push({[p]:_}),g.length>W("AP_CACHE_NUM")&&g.shift(),OS(_m,JSON.stringify(g))}catch(p){C.warn("Error caching server parameters:",p.message),OS(_m,"")}}(l),YC++}catch(o){throw JC++,function(a){KC||(KC=window.setTimeout(()=>{let d="";ky.forEach((l,u)=>{d+="".concat(u,": ").concat(l," ;")}),Ce.reportApiInvoke(null,{name:Zr.PRELOAD,options:{success:YC,failed:JC,err:d}}).onError(a),YC=0,JC=0,ky.clear(),KC=null},KLe));const c=ky.get(a.code)||0;ky.set(a.code,c+1)}(o),o}}async function tF(e){try{if(W("AP_REQUEST_DETAIL"))return;const t=mX(e);if(!t||e.cloudProxyServer!=="disabled")return;const r=await async function(n,i){try{const s=await window.crypto.subtle.importKey("raw",QY(i),"AES-GCM",!1,["decrypt"]),o=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},s,zh(n));return JSON.parse(window.atob(Ou(new Uint8Array(o))))}catch{return}}(t,e.token||e.appId);if(!r||!function(n,i){return n.cname===i.cname&&n.appId===i.appId&&n.token===i.token?i.stringUid?n.stringUid===i.stringUid:typeof i.uid=="number"?n.uid===i.uid:n.uid==i.uid:!1}(r,e))return;if(r&&Date.now()-r.ts<W("AP_CACHE_LIFETIME"))return r}catch(t){C.warn("Error get preloadInfo",t.message)}}function mX(e){let t;try{if(t=_X(_m),!t)return;const r=JSON.parse(t),n=EX(e),i=function(o,a){for(let c=o.length-1;c>=0;c--)if(a(o[c]))return c;return-1}(r,o=>n in o);if(i===-1)return;const s=r.splice(i,1)[0];return OS(_m,JSON.stringify(r)),s[n]}catch(r){C.warn("Error delete preload info: ".concat(t),r.message),OS(_m,"")}}function $3(e){if(e){let t=Dh.get(e);t&&(window.clearTimeout(t),t=null,Dh.delete(e)),Ee(Ph).call(Ph,e)||e.cloudProxyServer!=="disabled"||Ph.push(e)}if(Dh.size<W("AP_CACHE_NUM")&&Ph.length>0){const t=Ph.shift();Dh.set(t,window.setTimeout(async()=>{const{appId:r,cname:n,token:i,stringUid:s,uid:o,proxyServer:a}=t;try{await YLe(r,n,i,o,a,s),Dh.has(t)&&$3(t)}catch(c){C.warn("update preload failed",c.message),gX(t)}},W("AP_UPDATE_INTERVAL")))}}function gX(e){const t=Ph.indexOf(e);t!==-1&&Ph.splice(t,1);let r=Dh.get(e);r&&(window.clearTimeout(r),r=null,Dh.delete(e),$3())}function rF(e,t){const r=e.sua,n=e.ap;t&&r&&Ce.reqUserAccount(e.sid,{lts:r.requestTime,elapse:r.elapse,success:!0,serverAddr:r.url,stringUid:t,uid:e.intUid,errorCode:null,extend:r.req}),Ce.reportResourceTiming(e.ap.url,e.sid),Ce.joinWebProxyAP(e.sid,{lts:n.requestTime,elapse:n.elapse,sucess:1,apServerAddr:n.url,turnServerAddrList:n.proxyInfo.addresses.map(i=>i.ip).join(","),eventType:"disabled",unilbsServerIds:[zr.CHOOSE_SERVER,zr.CLOUD_PROXY_FALLBACK].toString()}),Ce.joinChooseServer(e.sid,{lts:n.requestTime,elapse:n.elapse,succ:!0,csAddr:n.url,opid:n.opid,serverList:n.gatewayInfo.gatewayAddrs.map(i=>i.address),ec:null,cid:n.gatewayInfo.cid.toString(),uid:n.gatewayInfo.uid.toString(),csIp:n.gatewayInfo.csIp,unilbsServerIds:[zr.CHOOSE_SERVER].toString(),isHttp3:n.isHttp3})}function _X(e){return window.atob(window.localStorage.getItem(e)||"")}function OS(e,t){window.localStorage.setItem(e,window.btoa(t))}function EX(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),eJ(t)}function JLe(e){let t=function(){const r=ZLe.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(r,n){let i=r.appId;i!==void 0&&(Vr(n,10),Hl(n,i));let s=r.cid;s!==void 0&&(Vr(n,16),Vr(n,s));let o=r.cname;o!==void 0&&(Vr(n,26),Hl(n,o));let a=r.deviceId;a!==void 0&&(Vr(n,34),Hl(n,a));let c=r.elapse;c!==void 0&&(Vr(n,40),zl(n,c));let d=r.fileSize;d!==void 0&&(Vr(n,48),zl(n,hp(d)));let l=r.height;l!==void 0&&(Vr(n,56),zl(n,hp(l)));let u=r.jpg;u!==void 0&&(Vr(n,66),Vr(n,u.length),nF(n,u));let h=r.networkType;h!==void 0&&(Vr(n,72),zl(n,hp(h)));let p=r.osType;p!==void 0&&(Vr(n,80),zl(n,hp(p)));let _=r.requestId;_!==void 0&&(Vr(n,90),Hl(n,_));let g=r.sdkVersion;g!==void 0&&(Vr(n,98),Hl(n,g));let E=r.sequence;E!==void 0&&(Vr(n,104),zl(n,hp(E)));let b=r.sid;b!==void 0&&(Vr(n,114),Hl(n,b));let v=r.timestamp;v!==void 0&&(Vr(n,120),zl(n,v));let I=r.uid;I!==void 0&&(Vr(n,128),Vr(n,I));let N=r.vid;N!==void 0&&(Vr(n,136),Vr(n,N));let L=r.width;L!==void 0&&(Vr(n,144),zl(n,hp(L)));let U=r.service;U!==void 0&&(Vr(n,152),Vr(n,U));let w=r.callbackData;w!==void 0&&(Vr(n,162),Vr(n,w.length),nF(n,w));let V=r.ticket;V!==void 0&&(Vr(n,170),Hl(n,V));let z=r.vendorConfigs;z!==void 0&&(Vr(n,178),Hl(n,z))}(e,t),function(r){let n=r.bytes,i=r.limit;return n.length===i?n:n.subarray(0,i)}(t)}function XLe(e){return function(r){let n={};e:for(;!exe(r);){let i=Bg(r);switch(i>>>3){case 0:break e;case 1:n.code=Bg(r);break;case 2:n.msg=iF(r,Bg(r));break;case 3:n.requestId=iF(r,Bg(r));break;case 4:n.timestamp=txe(r,!1);break;default:QLe(r,7&i)}}return n}({bytes:t=e,offset:0,limit:t.length});var t}function QLe(e,t){switch(t){case 0:for(;128&ga(e););break;case 2:QC(e,Bg(e));break;case 5:QC(e,4);break;case 1:QC(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function hp(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let ZLe=[];function QC(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function exe(e){return e.offset>=e.limit}function pT(e,t){let r=e.bytes,n=e.offset,i=e.limit,s=n+t;if(s>r.length){let o=new Uint8Array(2*s);o.set(r),e.bytes=o}return e.offset=s,s>i&&(e.limit=s),n}function vX(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function nF(e,t){let r=pT(e,t.length);e.bytes.set(t,r)}function iF(e,t){let r=vX(e,t),n=String.fromCharCode,i=e.bytes,s="�",o="";for(let a=0;a<t;a++){let c,d,l,u,h=i[a+r];128&h?(224&h)==192?a+1>=t?o+=s:(c=i[a+r+1],(192&c)!=128?o+=s:(u=(31&h)<<6|63&c,u<128?o+=s:(o+=n(u),a++))):(240&h)==224?a+2>=t?o+=s:(c=i[a+r+1],d=i[a+r+2],(49344&(c|d<<8))!=32896?o+=s:(u=(15&h)<<12|(63&c)<<6|63&d,u<2048||u>=55296&&u<=57343?o+=s:(o+=n(u),a+=2))):(248&h)==240?a+3>=t?o+=s:(c=i[a+r+1],d=i[a+r+2],l=i[a+r+3],(12632256&(c|d<<8|l<<16))!=8421504?o+=s:(u=(7&h)<<18|(63&c)<<12|(63&d)<<6|63&l,u<65536||u>1114111?o+=s:(u-=65536,o+=n(55296+(u>>10),56320+(1023&u)),a+=3))):o+=s:o+=n(h)}return o}function Hl(e,t){let r=t.length,n=0;for(let o=0;o<r;o++){let a=t.charCodeAt(o);a>=55296&&a<=56319&&o+1<r&&(a=(a<<10)+t.charCodeAt(++o)-56613888),n+=a<128?1:a<2048?2:a<65536?3:4}Vr(e,n);let i=pT(e,n),s=e.bytes;for(let o=0;o<r;o++){let a=t.charCodeAt(o);a>=55296&&a<=56319&&o+1<r&&(a=(a<<10)+t.charCodeAt(++o)-56613888),a<128?s[i++]=a:(a<2048?s[i++]=a>>6&31|192:(a<65536?s[i++]=a>>12&15|224:(s[i++]=a>>18&7|240,s[i++]=a>>12&63|128),s[i++]=a>>6&63|128),s[i++]=63&a|128)}}function ga(e){return e.bytes[vX(e,1)]}function sF(e,t){let r=pT(e,1);e.bytes[r]=t}function Bg(e){let t,r=0,n=0;do t=ga(e),r<32&&(n|=(127&t)<<r),r+=7;while(128&t);return n}function Vr(e,t){for(t>>>=0;t>=128;)sF(e,127&t|128),t>>>=7;sF(e,t)}function txe(e,t){let r,n=0,i=0,s=0;return r=ga(e),n=127&r,128&r&&(r=ga(e),n|=(127&r)<<7,128&r&&(r=ga(e),n|=(127&r)<<14,128&r&&(r=ga(e),n|=(127&r)<<21,128&r&&(r=ga(e),i=127&r,128&r&&(r=ga(e),i|=(127&r)<<7,128&r&&(r=ga(e),i|=(127&r)<<14,128&r&&(r=ga(e),i|=(127&r)<<21,128&r&&(r=ga(e),s=127&r,128&r&&(r=ga(e),s|=(127&r)<<7))))))))),{low:n|i<<28,high:i>>>4|s<<24,unsigned:t}}function zl(e,t){let r=t.low>>>0,n=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,s=i===0?n===0?r<16384?r<128?1:2:r<1<<21?3:4:n<16384?n<128?5:6:n<1<<21?7:8:i<128?9:10,o=pT(e,s),a=e.bytes;switch(s){case 10:a[o+9]=i>>>7&1;case 9:a[o+8]=s!==9?128|i:127&i;case 8:a[o+7]=s!==8?n>>>21|128:n>>>21&127;case 7:a[o+6]=s!==7?n>>>14|128:n>>>14&127;case 6:a[o+5]=s!==6?n>>>7|128:n>>>7&127;case 5:a[o+4]=s!==5?128|n:127&n;case 4:a[o+3]=s!==4?r>>>21|128:r>>>21&127;case 3:a[o+2]=s!==3?r>>>14|128:r>>>14&127;case 2:a[o+1]=s!==2?r>>>7|128:r>>>7&127;case 1:a[o]=s!==1?128|r:127&r}}const oF={},aF={},NS=4294967296,rxe=NS*NS,cF=rxe/2;yX(0,!0);const dF=yX(0),nxe=SE(0,-2147483648,!1),ixe=SE(-1,2147483647,!1);function yX(e,t){let r,n,i;return t?(i=0<=(e>>>=0)&&e<256)&&(n=aF[e],n)?n:(r=SE(e,0,!0),i&&(aF[e]=r),r):(i=-128<=(e|=0)&&e<128)&&(n=oF[e],n)?n:(r=SE(e,e<0?-1:0,!1),i&&(oF[e]=r),r)}function SE(e,t,r){return{low:0|e,high:0|t,unsigned:!!r}}function sxe(e,t){if(isNaN(e))return dF;{if(e<=-cF)return nxe;if(e+1>=cF)return ixe}return e<0?dF:SE(e%NS|0,e/NS|0,t)}function lF(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}class H3 extends Cr{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const r=this._connectionState;this._connectionState=t,this.emit(Ja.CONNECTION_STATE_CHANGE,t,r)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var r;super(),j(this,"name","AgoraRTCImageModeration"),j(this,"_connectionState",wo.CONNECTING),j(this,"_sequence",0),j(this,"_moderationStartTime",void 0),j(this,"_workerConnection",void 0),j(this,"_workerMessageLengthLimit",void 0),j(this,"_qualityRatio",void 0),j(this,"_connectInfo",void 0),j(this,"_cancelTokenSource",Hi.CancelToken.source()),j(this,"_retryConfig",void 0),j(this,"_moderationInterval",void 0),j(this,"_moderationTimer",null),j(this,"_moderationMode",1),j(this,"_quality",1),j(this,"_qualityTimer",null),j(this,"_ticket",void 0),j(this,"_moderationIntervalMinimum",void 0),j(this,"_uploadFailedNum",0),j(this,"_uploadNum",0),j(this,"_uploadTimer",null),j(this,"_extraInfo",void 0),j(this,"_vendor",""),j(this,"_encoder",new TextEncoder),j(this,"_moderationId",void 0),j(this,"inspectImage",()=>{if(this.connectionState!==wo.CONNECTED)throw new ee($.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===wo.CONNECTED?this.requestToInspectImage():C.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=ar(5,"image-moderation-"),this._workerMessageLengthLimit=W("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=W("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=W("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new mE("worker-"+this._moderationId,Kr),this.on(Ja.STATE_CHANGE,(n,i)=>{C.debug("[".concat(this._moderationId,"] Moderation operation :").concat(ip[n]," ").concat(i||""))}),this.handleWorkerEvents()}async init(t,r){this.emit(Ja.STATE_CHANGE,ip.CONNECT_AP),this._connectInfo=t;const n=this._cancelTokenSource.token;return this._retryConfig=r,new _e((i,s)=>{this.on(Ja.CONNECTION_STATE_CHANGE,(o,a)=>{o===wo.CONNECTED&&i()}),this.requestAP(t,n,r).then(o=>{this.connectWorker(o)}).catch(o=>{s(o)})})}updateConfig(t){var r;this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),C.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===wo.CONNECTED&&this.inspectImage()}async requestAP(t,r,n){const i=W("WEBCS_DOMAIN").map(c=>"https://".concat(c,"/api/v1")),s=await function(c,d,l,u){let{appId:h,areaCode:p,cname:_,sid:g,token:E,uid:b}=d;mm++;const v="moderation_plugin",I={service_name:v,json_body:JSON.stringify({appId:h,areaCode:p,cname:_,command:"allocateEdge",requestId:mm,seq:mm,sid:g,appToken:E,ts:Date.now(),uid:b+""})};let N,L,U=c[0];return Tc(async()=>{N=Date.now();const w=await Rc(U,{data:I,cancelToken:l,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(L=Date.now()-N,w.code!==0){const K=new ee($.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+w.code,{retry:!0,responseTime:L});throw C.error(K.toString()),K}const V=JSON.parse(w.json_body);if(V.code!==200){const K=new ee($.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(V.code,", reason: ").concat(V.reason),{code:V.code,responseTime:L});throw C.error(K.toString()),K}if(!V.servers||!Array.isArray(V.servers)||V.servers.length===0){const K=new ee($.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:V.code,responseTime:L});throw C.error(K.toString()),K}if(!V.servers.some(K=>!!K.wss)){const K=new ee($.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:V.code,responseTime:L});throw C.error(K.toString()),K}const z=W("IMAGE_MODERATION_WORKER_HOST");return{addressList:V.servers.map(K=>{let{address:H,wss:A}=K;if(H&&A)return"wss://".concat(H.replace(/\./g,"-"),".").concat(z,":").concat(A,"/moderation")}).filter(K=>!!K),workerToken:V.workerToken,vid:V.vid,ticket:V.appTicket,responseTime:L}},(w,V)=>(Ce.apworkerEvent(g,{success:!0,sc:200,serviceName:v,responseDetail:JSON.stringify(w.addressList),firstSuccess:V===0,responseTime:L,serverIp:c[V%c.length]}),!1),(w,V)=>(Ce.apworkerEvent(g,{success:!1,sc:w.data&&w.data.code||200,serviceName:v,responseTime:L,serverIp:c[V%c.length]}),!!(w.code!==$.OPERATION_ABORTED&&w.code!==$.UNEXPECTED_RESPONSE||w.data&&w.data.retry)&&(U=c[(V+1)%c.length],!0)),u)}(i,t,r,n);this.emit(Ja.STATE_CHANGE,ip.AP_CONNECTED);const{addressList:o,ticket:a}=s;return this._ticket=a,o}async connectWorker(t){this.emit(Ja.STATE_CHANGE,ip.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(We.CONNECTED,async()=>{this.emit(Ja.STATE_CHANGE,ip.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=wo.CONNECTED}),this._workerConnection.on(We.CLOSED,()=>{this.connectionState=wo.CLOSED}),this._workerConnection.on(We.FAILED,()=>{this.connectionState=wo.CLOSED}),this._workerConnection.on(We.RECONNECTING,()=>{this.connectionState=this.connectionState===wo.CONNECTED?wo.RECONNECTING:wo.CONNECTING}),this._workerConnection.on(We.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const r=XLe(new Uint8Array(t.data));W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&C.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(r)),this._uploadNum++,r.code===void 0||r.code===0||(this._uploadFailedNum++,C.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(r.code,", msg is ").concat(r.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Ce.reportApiInvoke(this._connectInfo.sid||null,{name:Zr.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,r.code],tag:Or.TRACER}).onError(new ee($.IMAGE_MODERATION_UPLOAD_FAILED,r.msg)),this._uploadTimer=null},W("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else C.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(We.WILL_RECONNECT,(t,r,n)=>{t==="recover"&&n(t),n("tryNext")}),this._workerConnection.on(We.REQUEST_NEW_URLS,(t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=Lo(this,Ja.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&C.debug("Only the track being played can be inspected"));this._sequence++;const n=await this.generateRequestData(t,r);this._workerConnection.sendMessage(n,!0,!0)}else W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&C.debug("Only the track being published can be inspected")}async generateRequestData(t,r){let{appId:n,cname:i,cid:s,vid:o,sid:a,uid:c}=r;const d=Date.now(),l=await t.getCurrentFrameImage("image/jpeg",this.quality),u=await MJ(l,n,i),h=this._sequence+"-"+s+"-"+c+"-"+d+"-"+ar(12,""),p={appId:n,cid:s,cname:i,deviceId:"",elapse:H3.intToLong(Number(d-this._moderationStartTime)),fileSize:l.buffer.byteLength,height:l.height,width:l.width,jpg:u,networkType:6,osType:7,requestId:h,sdkVersion:"4.22.1",sequence:this._sequence,sid:a,timestamp:sxe(d),uid:c,vid:o,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete p.callbackData;const _=JLe(p);if(_.byteLength<this._workerMessageLengthLimit){if(W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const g=function(E){for(var b=1;b<arguments.length;b++){var v=arguments[b]!=null?arguments[b]:{};b%2?lF(Object(v),!0).forEach(function(I){j(E,I,v[I])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(v)):lF(Object(v)).forEach(function(I){Object.defineProperty(E,I,Object.getOwnPropertyDescriptor(v,I))})}return E}({},p);delete g.jpg,C.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(g))}return _}{const g=this.quality*this._qualityRatio;return this.quality=g,await this.generateRequestData(t,{appId:n,cname:i,cid:s,vid:o,sid:a,uid:c})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Hi.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=wo.CLOSED,this.emit(Ja.STATE_CHANGE,ip.CLOSED)}}function bX(e){if(qt(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new ee($.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new ee($.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const oxe={name:"ImageModeration",create:function(e){let{config:t}=e;return bX(t),new H3(t)}};var uF,hF,fF,pF,mF,gF,_F,EF,vF,yF,bF,SF,wF,TF,RF,AF,CF,IF,OF,NF,DF,PF,kF,LF,xF,MF,UF,jF,FF,BF,VF,$F,HF,zF,WF,GF,qF,KF,YF,JF,ve;function XF(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function _a(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?XF(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):XF(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}Jn.setLogger(C);let axe=(uF=je(),hF=je({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof Jp))return[t];t=[t]}return t.map(r=>r?Object(r).toString():"null")}}),fF=je({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==O0.DATA?(Array.isArray(t)||(t=[t]),t.map(r=>r.getTrackId())):[t.getChannelId()])}),pF=je({argsMap:(e,t,r,n)=>[typeof t=="object"?t.uid:t,r,n]}),mF=je({argsMap:(e,t,r)=>[t,r]}),gF=je({argsMap:(e,t)=>t.map(r=>{let{user:n,mediaType:i}=r;return[n==null?void 0:n.uid,i]})}),_F=je({argsMap:(e,t,r,n)=>[typeof t=="object"?t.uid:t,r,n]}),EF=je({argsMap:(e,t)=>t.map(r=>{let{user:n,mediaType:i}=r;return{uid:n==null?void 0:n.uid,mediaType:i}})}),vF=je(),yF=je(),bF=je(),SF=je(),wF=je(),TF=je(),RF=je(),AF=je(),CF=je(),IF=je(),OF=je(),NF=je(),DF=je(),PF=je(),kF=je({argsMap:(e,t)=>[t]}),LF=je(),xF=je(),MF=je(),UF=je(),jF=je(),FF=je(),BF=je(),VF=je(),$F=je({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),HF=je(),zF=je(),WF=je(),GF=je(),qF=je(),KF=je(),YF=je({reportResult:!0}),JF=je(),ve=class extends Cr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let t;if(super(),j(this,"store",void 0),j(this,"_uid",void 0),j(this,"_channelName",void 0),j(this,"_uintUid",void 0),j(this,"_users",[]),j(this,"_config",void 0),j(this,"_clientId",void 0),j(this,"_appId",void 0),j(this,"_sessionId",null),j(this,"_key",void 0),j(this,"_rtmConfig",{}),j(this,"_joinInfo",void 0),j(this,"_gateway",void 0),j(this,"_statsCollector",void 0),j(this,"_configDistribute",void 0),j(this,"_leaveMutex",new Jn("client-leave")),j(this,"_publishMutex",new Jn("client-publish")),j(this,"_renewTokenMutex",new Jn("client-renewtoken")),j(this,"_subscribeMutex",new Jn("client-subscribe")),j(this,"_encryptionMode","none"),j(this,"_encryptionSecret",null),j(this,"_encryptionSalt",null),j(this,"_encryptDataStream",!1),j(this,"_encryptDataStreamKey",null),j(this,"_encryptDataStreamIv",null),j(this,"_proxyServer",void 0),j(this,"_turnServer",{servers:[],mode:"auto"}),j(this,"_cloudProxyServerMode","disabled"),j(this,"_isDualStreamEnabled",!1),j(this,"_defaultStreamFallbackType",void 0),j(this,"_lowStreamParameter",void 0),j(this,"_streamFallbackTypeCacheMap",new Map),j(this,"_remoteStreamTypeCacheMap",new Map),j(this,"_axiosCancelSource",Hi.CancelToken.source()),j(this,"_audioVolumeIndicationInterval",void 0),j(this,"_networkQualityInterval",void 0),j(this,"_userOfflineTimeout",void 0),j(this,"_streamRemovedTimeout",void 0),j(this,"_liveTranscodeStreamingClient",void 0),j(this,"_liveRawStreamingClient",void 0),j(this,"_channelMediaRelayClient",void 0),j(this,"_networkQualitySensitivity","normal"),j(this,"_p2pChannel",void 0),j(this,"_useLocalAccessPoint",!1),j(this,"_setLocalAPVersion",void 0),j(this,"_joinAndNotLeaveYet",!1),j(this,"_numberOfJoinCount",0),j(this,"_remoteDefaultVideoStreamType",void 0),j(this,"_inspect",void 0),j(this,"_moderation",void 0),j(this,"_license",void 0),j(this,"_pendingPublishedUsers",[]),j(this,"ntpAlignErrorCount",0),j(this,"remoteInboundOffset",0),j(this,"_handleLocalTrackEnable",(r,n,i)=>{this.publish(r,!1).then(n).catch(i)}),j(this,"_handleLocalTrackDisable",(r,n,i)=>{this.unpublish(r).then(n).catch(i)}),j(this,"_handleUserOnline",r=>{if(W("BLOCK_LOCAL_CLIENT")&&ph(r.uid,this.channelName))return void C.debug("[".concat(r.uid,"] will be ignored in local"));this.isStringUID&&typeof r.uid!="string"&&C.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const n=this._users.find(i=>i.uid===r.uid);if(n)n._trust_in_room_=!0,n._is_pre_created&&(n._is_pre_created=!1,this.safeEmit(mt.USER_JOINED,n));else{const i=new au(r.uid,r.uint_id||r.uid);this._users.push(i),C.debug("[".concat(this._clientId,"] user online"),r.uid),this.safeEmit(mt.USER_JOINED,i)}}),j(this,"_handleUserOffline",r=>{if(W("BLOCK_LOCAL_CLIENT")&&ph(r.uid,this.channelName))return;const n=this._users.find(i=>i.uid===r.uid);n&&(this._handleRemoveStream(r),this._handleRemoveDataChannels(r),n._audio_pre_subscribed||n._video_pre_subscribed?n._is_pre_created=!0:vS(this._users,n),this._remoteStreamTypeCacheMap.delete(n.uid),this._streamFallbackTypeCacheMap.delete(n.uid),C.debug("[".concat(this._clientId,"] user offline"),r.uid,"reason:",r.reason),this.safeEmit(mt.USER_LEAVED,n,r.reason))}),j(this,"_handleAddAudioOrVideoStream",(r,n,i,s,o,a,c)=>{if(W("BLOCK_LOCAL_CLIENT")&&ph(n,this.channelName))return;const d=this._users.find(u=>u.uid===n);if(!d)return void C.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));C.debug("[".concat(this._clientId,"] stream added with uid ").concat(n,", type ").concat(r)),this.store.subscribe(d.uid,r,void 0,void 0,void 0,Date.now());const l=r==="audio"?d.hasAudio:d.hasVideo;d._uintid||(d._uintid=o||n),r==="audio"?d._trust_audio_stream_added_state_=!0:d._trust_video_stream_added_state_=!0,r==="audio"?(d._audio_added_=!0,i!==void 0&&(d._audioSSRC=i),s!==void 0&&(d._cname=s),a&&(d._audioOrtc=a)):(d._video_added_=!0,i!==void 0&&(d._videoSSRC=i),s!==void 0&&(d._cname=s),c!==void 0&&(d._rtxSsrcId=c),a&&(d._videoOrtc=a)),(r==="audio"?d.hasAudio:d.hasVideo)&&!l&&(C.info("[".concat(this._clientId,"] remote user ").concat(d.uid," published ").concat(r)),this.safeEmit(mt.USER_PUBLISHED,d,r)),r==="video"?Ce.onGatewayStream(this._sessionId,bn.ON_ADD_VIDEO_STREAM,Rr.ON_ADD_VIDEO_STREAM,{peer:o||n,ssrc:d._videoSSRC}):Ce.onGatewayStream(this._sessionId,bn.ON_ADD_AUDIO_STREAM,Rr.ON_ADD_AUDIO_STREAM,{peer:o||n,ssrc:d._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(d,r,i).then(u=>{if(u&&(C.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(d.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Py))return this._p2pChannel.unsubscribe(d,r,!0).then(()=>this._subscribe(d,r,!0).catch(h=>{C.error("[".concat(this._clientId,"] resubscribe error"),h.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(d,r)&&(C.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(d.uid," after reconnect.")),this._subscribe(d,r,!0).catch(u=>{C.error("[".concat(this._clientId,"] resubscribe error"),u.toString())}))}),j(this,"_handleRemoveStream",r=>{if(W("BLOCK_LOCAL_CLIENT")&&ph(r.uid,this.channelName))return;const n=this._users.find(s=>s.uid===r.uid);if(!n)return void C.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));C.debug("[".concat(this._clientId,"] stream removed with uid ").concat(r.uid));let i=()=>{};n.hasAudio&&n.hasVideo?i=()=>{C.info("[".concat(this._clientId,"] remote user ").concat(n.uid," unpublished audio track")),this.safeEmit(mt.USER_UNPUBLISHED,n,"audio"),C.info("[".concat(this._clientId,"] remote user ").concat(n.uid," unpublished video track")),this.safeEmit(mt.USER_UNPUBLISHED,n,"video")}:n.hasVideo?i=()=>{C.info("[".concat(this._clientId,"] remote user ").concat(n.uid," unpublished video track")),this.safeEmit(mt.USER_UNPUBLISHED,n,"video")}:n.hasAudio&&(i=()=>{C.info("[".concat(this._clientId,"] remote user ").concat(n.uid," unpublished audio track")),this.safeEmit(mt.USER_UNPUBLISHED,n,"audio")}),n._video_pre_subscribed||n._audio_pre_subscribed||(n._trust_audio_stream_added_state_=!0,n._trust_video_stream_added_state_=!0,n._audio_added_=!1,n._video_added_=!1,this._p2pChannel instanceof Py&&this._p2pChannel.unsubscribe(n).then(s=>{if(s)return this._gateway.unsubscribe(s,n.uid)}),n._audioSSRC=void 0,n._videoSSRC=void 0,n._audioOrtc=void 0,n._videoOrtc=void 0,n._rtxSsrcId=void 0),Ce.onGatewayStream(this._sessionId,bn.ON_REMOVE_STREAM,Rr.ON_REMOVE_STREAM,{peer:r.uint_id||r.uid}),i()}),j(this,"_handleSetStreamLocalEnable",(r,n,i)=>{if(W("BLOCK_LOCAL_CLIENT")&&ph(n,this.channelName))return;const s=this._users.find(c=>c.uid===n);if(!s)return void C.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));C.debug("[".concat(this._clientId,"] local ").concat(r," ").concat(i?"enabled":"disabled"," with uid ").concat(n));const o=r==="audio"?s.hasAudio:s.hasVideo;if(r==="audio"){s._trust_audio_enabled_state_=!0;const c=s._audio_enabled_;if(s._audio_enabled_=i,s._audio_enabled_===c)return;{const d=s._audio_enabled_?"enable-local-audio":"disable-local-audio";C.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(n,", msg: ").concat(d)),this.safeEmit(mt.USER_INFO_UPDATED,n,d)}}else{s._trust_video_enabled_state_=!0;const c=s._video_enabled_;if(s._video_enabled_=i,s._video_enabled_===c)return;{const d=s._video_enabled_?"enable-local-video":"disable-local-video";C.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(d)),this.safeEmit(mt.USER_INFO_UPDATED,n,d)}}const a=r==="audio"?s.hasAudio:s.hasVideo;return o!==a?!o&&a?(C.info("[".concat(this._clientId,"] remote user ").concat(n," published ").concat(r)),void this.safeEmit(mt.USER_PUBLISHED,s,r)):(r==="video"&&s._videoTrack&&s._videoTrack._destroy(),r==="audio"&&s._audioTrack,this._p2pChannel.muteRemote(s,r),C.info("[".concat(this._clientId,"] remote user ").concat(n," unpublished ").concat(r)),void this.safeEmit(mt.USER_UNPUBLISHED,s,r)):void 0}),j(this,"_handleMuteStream",(r,n,i)=>{if(W("BLOCK_LOCAL_CLIENT")&&ph(r,this.channelName))return;C.debug("[".concat(this._clientId,"] receive mute message"),r,n,i);const s=this._users.find(c=>c.uid===r);if(!s)return void C.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r));const o=n==="audio"?s.hasAudio:s.hasVideo;if(n==="audio"){s._trust_audio_mute_state_=!0;const c=s._audio_muted_;if(s._audio_muted_=i,s._audio_muted_===c)return;{const d=s._audio_muted_?"mute-audio":"unmute-audio";C.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(d)),this.safeEmit(mt.USER_INFO_UPDATED,r,d)}}else{s._trust_video_mute_state_=!0;const c=s._video_muted_;if(s._video_muted_=i,s._video_muted_===c)return;{const d=s._video_muted_?"mute-video":"unmute-video";C.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(d)),this.safeEmit(mt.USER_INFO_UPDATED,r,d)}}const a=n==="audio"?s.hasAudio:s.hasVideo;if(o!==a){if(!o&&a)return(n==="audio"?s._audioSSRC:s._videoSSRC)?(C.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(n)),void this.safeEmit(mt.USER_PUBLISHED,s,n)):void C.warning("[".concat(this._clientId,"] remote user ").concat(r," receive ").concat(n," unmute message  before add stream message, ").concat(n," SSRC doesn't exist yet."));n==="video"&&s._videoTrack&&!s._video_pre_subscribed&&s._videoTrack._destroy(),n==="audio"&&s._audioTrack,this._p2pChannel.muteRemote(s,n),C.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(n)),this.safeEmit(mt.USER_UNPUBLISHED,s,n)}}),j(this,"_handleP2PLost",async r=>{C.debug("[".concat(this._clientId,"] receive p2p lost"),r),parseInt(r.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():C.warning("[".concat(this._clientId,"] P2PLost stream not found"),r)}),j(this,"_handleTokenWillExpire",()=>{C.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(mt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),j(this,"_handleBeforeUnload",r=>{r.type==="beforeunload"&&r.returnValue!==void 0&&r.returnValue!==""||(this.leave(),C.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),j(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(mt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const r={downlinkNetworkQuality:0,uplinkNetworkQuality:0};r.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),r.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(mt.NETWORK_QUALITY,r)}),j(this,"_handleP2PAddAudioOrVideoStream",(r,n,i,s)=>{const o=this._users.find(c=>c.uid===n);if(!o)return void C.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));C.debug("[".concat(this._clientId,"] stream added with uid ").concat(n,", type ").concat(r)),this.store.subscribe(o.uid,r,void 0,void 0,void 0,Date.now());const a=r==="audio"?o.hasAudio:o.hasVideo;r==="audio"?o._trust_audio_stream_added_state_=!0:o._trust_video_stream_added_state_=!0,r==="audio"?(o._audio_added_=!0,i!==void 0&&(o._audioSSRC=i),s!==void 0&&(o._audioMid=s)):(o._video_added_=!0,i!==void 0&&(o._videoSSRC=i),s!==void 0&&(o._videoMid=s)),(r==="audio"?o.hasAudio:o.hasVideo)&&!a&&(C.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published ").concat(r)),this.safeEmit(mt.USER_PUBLISHED,o,r)),this._p2pChannel.hasPendingRemoteMedia(o,r)&&(C.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(o.uid," after reconnect.")),this._subscribe(o,r,!0).catch(c=>{C.error("[".concat(this._clientId,"] resubscribe error"),c.toString())}))}),this._config=e,this._clientId=ar(5,"client-"),this.store=new FPe(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),C.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(xo," build: ").concat(T3,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{vU(e.clientRoleOptions),t=Object.assign({},e.clientRoleOptions)}catch(r){C.warning("[".concat(this._clientId,"] ").concat(r.toString()))}this._statsCollector=new bE(this.store),this._statsCollector.onStatsException=(r,n,i)=>{C.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(r,", msg: ").concat(n,", uid: ").concat(i)),this.safeEmit(mt.EXCEPTION,{code:r,msg:n,uid:i})},this._statsCollector.onUploadPublishDuration=(r,n,i,s)=>{const o=this._users.find(a=>a.uid===r);o&&Ce.peerPublishStatus(this._sessionId,{subscribeElapse:s,audioPublishDuration:n,videoPublishDuration:i,peer:o._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new mLe(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Kr,httpRetryConfig:e.httpRetryConfig||Kr,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:t}),this._configDistribute=new RLe,this.store.useP2P?(this._p2pChannel=new gs(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new Py(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,r,n,i){let s=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],o=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Gt("JOIN_GATEWAY_USE_443PORT_ONLY",s),Gt("JOIN_GATEWAY_USE_DUAL_DOMAIN",o);const a=this._gateway.signal.websocket;return a instanceof R3&&(a.use443PortOnly=s,a.tryDoubleDomain=o),async function(c,d,l){ly.get(c)||ly.set(c,[]),uy.get(c)||uy.set(c,d),Dc.get(c)||Dc.set(c,0);const u=ly.get(c),h=uy.get(c);if(!u||!h)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Dc.get(c)===h){const b=lE();u.push(b),await b.promise}Dc.set(c,Dc.get(c)+1);for(var p=arguments.length,_=new Array(p>3?p-3:0),g=3;g<p;g++)_[g-3]=arguments[g];const E=await l(..._);return Dc.set(c,Dc.get(c)-1),Dc.get(c)===h-1&&u.length>0&&(u[0].resolve(),u.shift()),Dc.get(c)===0&&(ly.set(c,[]),uy.set(c,0),Dc.set(c,0)),E}("client.join",W("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,r,n,i)}async join(e,t,r,n,i){const s=++this._numberOfJoinCount;this.store.joinStart(),n&&(this.store.uid=n);const o=(fy||fy||(fy=(window.location.protocol.split(":")[0]||"").toUpperCase(),fy))==="HTTPS",a=AU()?window.isSecureContext:"Browser Not Support";(!AU()&&!o||!window.isSecureContext)&&C.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),C.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),Ce.setAppId(e);try{if(!r&&r!==null)throw new ee($.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&wn(r,"token",1,2047),wn(e,"appid",1,2047),uT(t),n&&hT(n),i&&wn(i,"optionalInfo",1,2047)}catch(g){throw Ce.reportApiInvoke(qp(),{name:Zr.JOIN,options:[e,t,r,n],states:{isHttps:o,isSecureContext:a},tag:Or.TRACER}).onError(g),g}if(this._leaveMutex.isLocked&&(C.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),C.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const g=new ee($.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Ce.reportApiInvoke(qp(),{name:Zr.JOIN,options:[e,t,r,n],states:{isHttps:o,isSecureContext:a},tag:Or.TRACER}).onError(g),g}this._gateway.state="CONNECTING";const c=await tF({appId:e,cname:t,uid:n,stringUid:typeof n=="string"?n:void 0,token:r||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new ee($.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const d=(c==null?void 0:c.sid)||qp();C.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(s)),this._sessionId||(this._sessionId=d,this.store.sessionId=this._sessionId);const l=Ce.reportApiInvoke(d,{name:Zr.JOIN,options:[e,t,r,n],states:{isHttps:o,isSecureContext:a},tag:Or.TRACER}),u=_a(_a(_a({},this._rtmConfig),{},{clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof n!="string"?n:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:r||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:i,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!c},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:W("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(u.setLocalAPVersion=this._setLocalAPVersion),typeof n=="string"&&(u.stringUid=n,this._uintUid?(u.uid=this._uintUid,this._uintUid=void 0):u.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(u.aesmode=this._encryptionMode,u.aespassword=await(async g=>{const E=function(N){const L=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),U=new Uint8Array(new ArrayBuffer(L.length));for(let w=0;w<L.length;w+=1)U[w]=L.charCodeAt(w);return U}(),b=await window.crypto.subtle.importKey("spki",E,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),v=y3(g),I=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},b,v);return function(N){let L="";for(let U=0;U<N.length;U+=1)L+=String.fromCharCode(N[U]);return window.btoa(L)}(new Uint8Array(I))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new ee($.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(u.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const g=new TextEncoder,E=W("USE_PURE_ENCRYPTION_MASTER_KEY")?g.encode(u.appId+this._encryptionSecret+this._encryptionSecret):g.encode(u.appId+u.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(b,v,I){const N=await window.crypto.subtle.importKey("raw",v,"PBKDF2",!1,["deriveBits","deriveKey"]),L=b==="aes-128-gcm2"?128:256,U=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:IU,hash:"SHA-256",salt:I},N,L+BPe);return new Uint8Array(U).subarray(L/8)}(this._encryptionMode,E,zh(this._encryptionSalt)),this._encryptDataStreamKey=await async function(b,v,I){const N=await window.crypto.subtle.importKey("raw",v,"PBKDF2",!1,["deriveBits","deriveKey"]),L=b==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:IU,hash:"SHA-256",salt:I},N,{name:"AES-GCM",length:L},!0,["encrypt","decrypt"])}(this._encryptionMode,E,zh(this._encryptionSalt))}else a?C.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):C.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,C.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:u.stringUid});const h=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&h===this._sessionId&&Ce.joinChannelTimeout(this._sessionId,5)},5e3);try{var p;let g;const E=u.cloudProxyServer;if(Ee(p=["proxy3","proxy4","proxy5"]).call(p,E)){const L=W("PROXY_SERVER_TYPE3");Array.isArray(L)?u.proxyServer=L[0]:u.proxyServer=L}if(Ce.setProxyServer(u.proxyServer),C.setProxyServer(u.proxyServer),this.store.requestAPStart(),c){if(C.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(u.stringUid?", ".concat(u.stringUid," => ").concat(c.intUid):""," ")),u.stringUid&&!u.uid&&(u.uid=c.intUid),g={gatewayInfo:c.ap.gatewayInfo},W("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&u.turnServer.mode==="auto")if(c.ap.proxyInfo.addresses.length===0)C.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const L=(await lJ(c.ap.proxyInfo,c.ap.gatewayInfo.uid)).map(U=>({turnServerURL:U.address,tcpport:U.tcpport||Ln.tcpport,udpport:U.udpport||Ln.udpport,username:U.username||Ln.username,password:U.password||Ln.password,forceturn:!1,security:!0}));u.turnServer={mode:"manual",servers:L}}rF(c,u.stringUid)}else{if(u.stringUid&&!u.uid){let L;[L,g]=await _e.all([eX(u.stringUid,u,this._axiosCancelSource.token,this._config.httpRetryConfig||Kr,this.store),sj(u,this._axiosCancelSource.token,this._config.httpRetryConfig||Kr,!0,this.store)]),C.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(u.stringUid," => ").concat(L)),u.uid=L,g.gatewayInfo.uid=L,g.gatewayInfo.res.uid=L}else g=await sj(u,this._axiosCancelSource.token,this._config.httpRetryConfig||Kr,!0,this.store);if(!this._joinAndNotLeaveYet)throw new ee($.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(u,this._axiosCancelSource.token),this._configDistribute.on(hN.UPDATE_BITRATE_LIMIT,L=>{this._p2pChannel.updateBitrateLimit(L)})},0),this._key=r||e;const b=g.gatewayInfo,v=u.uid?u.uid:b.uid;this._joinInfo=_a(_a({},u),{},{cid:b.cid,uid:v,vid:b.vid,apResponse:b.res,apGatewayAddress:b.apGatewayAddress,uni_lbs_ip:b.uni_lbs_ip,gatewayAddrs:b.gatewayAddrs}),this.store.intUid=v;const I=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new ee($.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));l.onSuccess(I),this._appId=e,this._channelName=u.cname,this._uid=I,this.store.uid=I,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Bn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const N=u.stringUid?"string uid: ".concat(u.stringUid,",uid: ").concat(u.uid):"uid: ".concat(this._uid);return C.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(N)),setTimeout(()=>{C.startUpload()},5e3),this.store.joinEnd(),_=this,Ee(Oh).call(Oh,_)||Oh.push(_),this._cloudProxyServerMode==="disabled"&&At().supportWebCrypto&&W("ENABLE_PRELOAD")&&$3(this._joinInfo),I}catch(g){const E=Array.isArray(g)?g[0]:g;throw E&&E.code===$.OPERATION_ABORTED?C.warning("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),E):C.error("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),E),E.code!==$.OPERATION_ABORTED&&this._numberOfJoinCount===s&&(this._gateway.state="DISCONNECTED",this._reset()),l.onError(E),E}var _}_joinGateway(){if(!this._joinInfo||!this._key)throw new ee($.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!W("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){C.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Bn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const r=Oh.indexOf(t);r!==-1&&Oh.splice(r,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return C.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED"),C.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Jp))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new ee($.INVALID_PARAMS,"param list is empty");const r=e;if(this._gateway.role==="audience")throw new ee($.INVALID_OPERATION,"audience can not publish stream");for(const i of r){if(!(i instanceof Jp))throw new ee($.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new ee($.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}C.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r.map(i=>"".concat(i.getTrackId()," "))));const n=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&r.forEach(i=>{const s=this._configDistribute.getBitrateLimit();i instanceof hr&&s&&i.setBitrateLimit(s.uplink)});try{await this._publishHighStream(r),C.info("[".concat(this._clientId,"] Publish success, id ").concat(r.map(i=>"".concat(i.getTrackId()," "))))}catch(i){throw C.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{n()}}async _publishDataChannel(e){qt(e.id,"id",0,65535,!0),dl(e.ordered,"ordered"),wn(e.metadata,"metadata",0,512),C.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(i=>i.id===e.id)!==-1)throw new ee($.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new ee($.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ee($.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&W("FORCE_TURN")&&!W("TURN_ENABLE_TCP")&&!W("TURN_ENABLE_UDP"))throw new ee($.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const r=function(i){return Jj(i,!1)}(e),n=await this._p2pChannel.publishDataChannel([r]);if(n.length>0){if(typeof r._originDataChannelId!="number")throw C.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new ee($.CREATE_DATACHANNEL_ERROR);try{await _e.all(n.map(i=>this._uid&&this._gateway.publishDataChannel(this._uid,i,!0))),await r._waitTillOpen()}catch(i){if(i.code!==$.DISCONNECT_P2P)throw i}}return C.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(r.id)),r}catch(r){throw C.error("[".concat(this._clientId,"] publish datachannels error"),r.toString()),r}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new ee($.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof Jp))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);C.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(n=>"".concat(n.getTrackId()," "))," "));const r=await this._publishMutex.lock();try{if(this._p2pChannel instanceof gs){const n=await this._p2pChannel.unpublish(t);n&&await this._gateway.sendExtensionMessage(jr.UNPUBLISH,{unpubMsg:n},!0)}else{const n=await this._p2pChannel.unpublish(t);n&&await this._gateway.unpublish(n,this._uid),C.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(i=>"".concat(i.getTrackId()))))}}catch(n){throw C.error("[".concat(this._clientId,"] unpublish error"),n.toString()),n}finally{r&&r()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),C.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(r=>"".concat(r.id," "))," "));const t=await this._publishMutex.lock();try{const r=await this._p2pChannel.unpublishDataChannel(e);r&&await this._gateway.unpublishDataChannel(r),C.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(n=>"".concat(n.id))))}catch(r){throw C.error("[".concat(this._clientId,"] unpublish dataChannel error"),r.toString()),r}finally{t&&t()}}async subscribe(e,t,r){if(!(e instanceof au)){const n=this.remoteUsers.find(i=>i.uid===e);if(!n)throw new ee($.INVALID_REMOTE_USER,"user is not in the channel");e=n}return t==="datachannel"?this._subscribeDataChannel(e,r):this._subscribe(e,t)}async presubscribe(e,t){if(rn(t,"mediaType",["audio","video"]),this._p2pChannel instanceof gs)throw new ee($.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new ee($.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ee($.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const r=t===Oe.AUDIO,n=t===Oe.VIDEO,i=await this._subscribeMutex.lock();try{const{ssrcId:s,ortc:o,rtxSsrcId:a,cname:c,uint_id:d}=await this._gateway.presubscribe(e,t,!0);if(s==null)throw new ee($.UNEXPECTED_RESPONSE,"no ssrc id");let l=this._users.find(h=>h.uid===e);l||(l=new au(e,d||e),l._is_pre_created=!0,this._users.push(l)),c&&(l._cname=c),l._uintid||(l._uintid=d||e),r&&(l._audioSSRC=s,l._audio_pre_subscribed=!0,o&&(l._audioOrtc=o)),n&&(l._videoSSRC=s,l._video_pre_subscribed=!0,o&&(l._videoOrtc=o),a!=null&&(l._rtxSsrcId=a)),C.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(s)),await this._p2pChannel.subscribe(l,t,s,a,o);const u=r?l._audioTrack:l._videoTrack;if(!u)throw new ee($.UNEXPECTED_ERROR,"can not find remote track in user");return r&&(l._trust_audio_stream_added_state_=!0,l._audio_added_=!0),n&&(l._trust_video_stream_added_state_=!0,l._video_added_=!0),u}catch(s){throw C.error("[".concat(this._clientId,"] presub user ").concat(e," error"),s),s}finally{i()}}async _subscribeDataChannel(e,t){var r;if(qt(t,"channelId",0,65535,!0),!this._joinInfo)throw new ee($.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ee($.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(a=>a===e))throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new ee($.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new ee($.INVALID_REMOTE_USER,"user is not published");const i=(r=e._dataChannels)===null||r===void 0?void 0:r.find(a=>a.id===t);if(!i)throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new ee($.REMOTE_USER_IS_NOT_PUBLISHED);const s=await this._subscribeMutex.lock();C.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const a=await this._p2pChannel.subscribeDataChannel(e,[i]);if(a&&Ee(a).call(a,i.id))try{var o;if(typeof i._originDataChannelId!="number")throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new ee($.CREATE_DATACHANNEL_ERROR);const c={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:(o=i.metadata)!==null&&o!==void 0?o:""};await this._gateway.subscribeDataChannel(e.uid,c,!0),await i._waitTillOpen()}catch(c){if((c==null?void 0:c.code)!==$.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[i]),c;await this._p2pChannel.unsubscribeDataChannel(e,[i]),this._p2pChannel.setPendingRemoteDataChannel(e,i.id)}return C.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),i}finally{s()}}async _p2pSubscribe(e,t,r){if(rn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ee($.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ee($.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(s=>s===e)){const s=new ee($.INVALID_REMOTE_USER,"user is not in the channel");throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),s}if(!e.hasAudio&&!e.hasVideo){const s=new ee($.INVALID_REMOTE_USER,"user is not published");throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),s}if(!r&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const s=new ee($.REMOTE_USER_IS_NOT_PUBLISHED);throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),s}const i=await this._subscribeMutex.lock();C.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const o=t==="audio"?e._audioSSRC:e._videoSSRC,a=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this._p2pChannel instanceof gs&&await this._p2pChannel.subscribe(e,t,o,a)}catch(o){throw o}C.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(o=>{C.warning("[".concat(this._clientId,"] auto set fallback failed"),o)});const s=t==="audio"?e._audioTrack:e._videoTrack;if(!s)throw new ee($.UNEXPECTED_ERROR,"can not find remote track in user object");return s}catch(s){throw C.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),s),s}finally{i()}}async _subscribe(e,t,r){if(this._p2pChannel instanceof gs)return this._p2pSubscribe(e,t);if(rn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ee($.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ee($.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(d=>d===e)){const d=new ee($.INVALID_REMOTE_USER,"user is not in the channel");throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),d}if(!e.hasAudio&&!e.hasVideo){const d=new ee($.INVALID_REMOTE_USER,"user is not published");throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),d}if(!(r||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const d=new ee($.REMOTE_USER_IS_NOT_PUBLISHED);throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),d}let i=t==="audio"?e._audioSSRC:e._videoSSRC,s=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,a={stream_type:t==="audio"?Oe.AUDIO:Oe.VIDEO,ssrcId:i};const c=await this._subscribeMutex.lock();C.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const l=t==="audio"?e._audioSSRC:e._videoSSRC;l!==void 0&&l!==i&&(i=l,s=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,a={stream_type:t==="audio"?Oe.AUDIO:Oe.VIDEO,ssrcId:i}),Kn.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,o,s);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(e.uid,a,!0)}catch(u){if((u==null?void 0:u.code)!==$.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),u;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(l){throw this._p2pChannel.reportSubscribeEvent(!1,l==null?void 0:l.code,e,t),l}C.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(l=>{C.warning("[".concat(this._clientId,"] auto set fallback failed"),l)});const d=t==="audio"?e._audioTrack:e._videoTrack;if(!d)throw new ee($.UNEXPECTED_ERROR,"can not find remote track in user object");return d}catch(d){throw C.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),d),d}finally{c()}}async massSubscribe(e){if(nl(e,"subscribeList"),!this._joinInfo)throw new ee($.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ee($.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),r=new Map,n=await this._subscribeMutex.lock();C.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(a=>{let{user:c,mediaType:d}=a;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(d)}).join("; ")));const i=(e=[...e]).map(a=>{let{user:c,mediaType:d}=a;return{user:c,mediaType:d}}),s=await this._p2pChannel.globalLock();try{var o;for(let c=e.length-1;c>=0;c--){const d=e[c],{user:l,mediaType:u}=d;if(rn(u,"mediaType",["audio","video"]),!l){const g=new ee($.INVALID_PARAMS,"user property does not exist in subscribeList item");throw C.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),g}if(!this._users.find(g=>g===l)){const g=new ee($.INVALID_REMOTE_USER,"user is not in the channel");C.error("[".concat(this._clientId,"] can not massSubscribe ").concat(l.uid,", this user is not in the channel")),i[c].error=g,e.splice(c,1);continue}if(u==="audio"&&(!l.hasAudio||l._audioSSRC===void 0)||u==="video"&&(!l.hasVideo||l._videoSSRC===void 0)){const g=new ee($.REMOTE_USER_IS_NOT_PUBLISHED);C.error("[".concat(this._clientId,"] can not subscribe ").concat(l.uid," with mediaType ").concat(u,", remote user is not published")),i[c].error=g,e.splice(c,1);continue}const p=hn.Video|hn.LwoVideo,_=r.get(l);if(_){if(u==="video"?_&p:_&hn.Audio){e.splice(c,1),C.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(l.uid,", mediaType:").concat(u," twice"));continue}r.set(l,_|(u==="video"?p:hn.Audio))}else r.set(l,u==="video"?p:hn.Audio)}for(let c=e.length-1;c>=0;c--){const d=e[c],{user:l,mediaType:u}=d,h=hn.Video|hn.LwoVideo;if(this._p2pChannel.hasRemoteMedia(l,u)){await this._p2pChannel.unmuteRemoteNoLock(l,u);const p=r.get(l);r.set(l,u==="video"?p^h:p^hn.Audio),e.splice(c,1)}}this.store.massSubscribe(e.map(c=>({userId:c.user.uid,type:c.mediaType})),t);let a=yc(o=Array.from(r.entries())).call(o,(c,d)=>{let[l,u]=d;if(u===0)return c;const h={stream_id:l.uid,stream_type:u};return u&hn.Audio&&(h.audio_ssrc=l._audioSSRC),u&hn.Video&&(h.video_ssrc=l._videoSSRC),c.push(h),c},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(d=>{let{user:l,mediaType:u}=d;return{user:l,mediaType:u,ssrcId:u===Oe.VIDEO?l._videoSSRC:l._audioSSRC,rtxSsrcId:u===Oe.VIDEO?l._rtxSsrcId:void 0}}));const c=new Map;if(a=a.filter(d=>d.video_ssrc&&!this._p2pChannel.isPreSubScribe(d.video_ssrc)||d.audio_ssrc&&!this._p2pChannel.isPreSubScribe(d.audio_ssrc)||!d.video_ssrc&&!d.audio_ssrc),a.length>0){const d=await this._gateway.subscribeAll(a,!0);((d==null?void 0:d.users)||[]).forEach(l=>{let{stream_id:u,video_error_code:h,audio_error_code:p,error_code:_}=l;(h||p||_)&&c.set(u,{video_error_code:h,audio_error_code:p,error_code:_})})}if(Array.from(c.entries()).length>0){const d=[];Array.from(c.entries()).forEach(l=>{let[u,h]=l;const p=this.remoteUsers.find(_=>_.uid===u);if(p){let _;h.error_code||h.video_error_code&&h.audio_error_code?_=void 0:h.video_error_code?_=Oe.VIDEO:h.audio_error_code&&(_=Oe.AUDIO),d.push({user:p,mediaType:_})}}),d.length>0&&await this._p2pChannel.massUnsubscribeNoLock(d)}for(const d of i){const l=c.get(d.user.uid);if(l){const u=l.error_code||d.mediaType==="audio"&&l.audio_error_code||d.mediaType==="video"&&l.video_error_code;if(u){const h=pE(u);C.error("user:".concat(d.user.uid," mediaType:").concat(d.mediaType," has massSubscribe error ").concat(h.desc)),d.error=new ee($.SUBSCRIBE_FAILED,"code ".concat(u,": ").concat(h.desc))}}d.error||(d.mediaType==="video"?d.track=d.user.videoTrack:d.track=d.user.audioTrack)}return this.store.massSubscribe(i.filter(d=>!d.error).map(d=>({userId:d.user.uid,type:d.mediaType})),void 0,Date.now()),i.forEach(d=>{var l;Ce.subscribe(this.store.sessionId,{succ:!!d.error,ec:((l=d.error)===null||l===void 0?void 0:l.code)||null,video:d.mediaType===Oe.VIDEO,audio:d.mediaType===Oe.AUDIO,peerid:d.user.uid,subscribeRequestid:d.mediaType===Oe.VIDEO?d.user._videoSSRC:d.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(d.user._videoSSRC)},!0)}),C.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(d=>{let{user:l,mediaType:u}=d;return"user: ".concat(l==null?void 0:l.uid,", mediaType: ").concat(u)}).join("; "))),i}catch(c){throw await this._p2pChannel.massUnsubscribeNoLock(e),c}}finally{s(),n()}}async unsubscribe(e,t,r){if(!(e instanceof au)){const s=this.remoteUsers.find(o=>o.uid===e);if(!s)throw new ee($.INVALID_REMOTE_USER,"user is not in the channel");e=s}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,r)}else await this._unsubscribeDataChannel(e,r);if(t&&rn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ee($.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(s=>s===e)){const s=new ee($.INVALID_REMOTE_USER,"user is not in the channel");throw C.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),s}C.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const i=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof gs)await this._p2pChannel.unsubscribe(e,t);else{const s=await this._p2pChannel.unsubscribe(e,t);s&&await this._gateway.unsubscribe(s,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&vS(this._users,e),C.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(s){if(s.code===$.DISCONNECT_P2P)return void C.warning("disconnecting p2p, abort unsubscribe request.");throw C.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),s.toString()),s}finally{i()}}async _unsubscribeDataChannel(e,t){if(t&&qt(t,"id",0,65535,!0),!this._joinInfo)throw new ee($.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(i=>i===e)){const i=new ee($.INVALID_REMOTE_USER,"user is not in the channel");throw C.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),i}let n;if(typeof t=="number"){const i=e._dataChannels.find(s=>s.id===t);i&&(n=[i])}else n=e._dataChannels;if(n===void 0){const i=new ee($.REMOTE_USER_IS_NOT_PUBLISHED);throw C.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),i}C.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(n.map(i=>i.id)));try{const i=await this._p2pChannel.unsubscribeDataChannel(e,n);i&&await this._gateway.unsubscribeDataChannel(i,e.uid),C.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i))}catch(i){if(i.code===$.DISCONNECT_P2P)return void C.warning("disconnecting p2p, abort unsubscribe request.");throw C.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),i.toString()),i}}async massUnsubscribe(e){if(nl(e,"unsubscribeList"),!this._joinInfo)throw new ee($.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");C.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(r=>{let{user:n,mediaType:i}=r;return"user: ".concat(n==null?void 0:n.uid,", mediaType: ").concat(i,";")}).join())),e=[...e];const t=new Map;for(let r=e.length-1;r>=0;r--){const{user:n,mediaType:i}=e[r];if(!n){const a=new ee($.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw C.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),a}if(rn(i,"mediaType",["video","audio",void 0]),!this._users.find(a=>a===n)){C.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),e.splice(r,1);continue}const o=hn.Video|hn.LwoVideo;if(t.has(n)){const a=t.get(n);let c;switch(i){case"video":c=a&o;break;case"audio":c=a&hn.Audio;break;default:c=a&(hn.Audio|o)}if(c){C.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(n.uid,",mediaType:").concat(i," twice.")),e.splice(r,1);continue}i?i==="audio"?t.set(n,a|hn.Audio):i==="video"&&t.set(n,a|o):t.set(n,a|hn.Audio|o)}else i?i==="audio"?t.set(n,hn.Audio):i==="video"&&t.set(n,o):t.set(n,hn.Audio|o)}try{const r=await this._p2pChannel.massUnsubscribe(e);r&&await this._gateway.massUnsubscribe(r),C.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(n=>{let{user:i,mediaType:s}=n;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(s,";")}).join()))}catch(r){if(r.code===$.DISCONNECT_P2P)return void C.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw C.error("[".concat(this._clientId,"] massUnsubscribe error"),r.toString()),r}}async setLowStreamParameter(e){(function(r){if(!r)throw new ie($.INVALID_PARAMS);Tr(r.width)||sC(r.width,"streamParameter.width"),Tr(r.height)||sC(r.height,"streamParameter.height"),Tr(r.framerate)||sC(r.framerate,"streamParameter.framerate"),Tr(r.bitrate)||qt(r.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&C.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),C.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,le.LocalVideoLowTrack)}async enableDualStream(){if(!At().supportDualStream)throw Ce.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new ee($.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new ee($.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw Ce.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,Ce.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),C.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new ee($.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(le.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw Ce.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,Ce.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),C.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(r){rn(r,"role",["audience","host"])}(e),t&&vU(t),this.mode==="rtc"||this.mode==="p2p")throw C.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new ee($.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new ee($.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new ee($.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),this._config.role=e,C.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const r=t.timestamp-Date.now();return Math.abs(r)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?r:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(wn(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new ee($.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ee($.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Ce.setProxyServer(this._proxyServer),C.setProxyServer(this._proxyServer),C.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new ee($.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ee($.INVALID_OPERATION,"You have already set the proxy")}if(aT(e))return this._turnServer={servers:e,mode:"original-manual"},void C.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(r=>r.urls).join(","),"."));e.forEach(r=>XY(r)),this._turnServer={servers:e,mode:"manual"},C.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new ee($.INVALID_OPERATION,"you should set license before join channel");if(wn(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new ee($.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,C.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new ee($.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new ee($.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let r;switch(e===void 0&&(e=3),e){case 1:case 2:throw new ee($.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:r="proxy3";break;case 4:r="proxy4";break;case 5:r="proxy5";break;default:throw new ee($.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=r,this.store.cloudProxyServerMode=r,C.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new ee($.INVALID_OPERATION,"Stop proxy server after leave channel");Ce.setProxyServer(),C.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",C.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new ee($.INVALID_PARAMS,"accessPoints is required.");nl(e.accessPoints.serverList,"accessPoints.serverList"),wn(e.accessPoints.domain,"accessPoints.domain");const t=(h,p)=>{qt(h,p,0,65535,!0)};let r=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),r=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ee($.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");W("CLOSE_AFB_FOR_LOCAL_AP")&&(Gt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Gt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const n=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,s=e.accessPoints.serverList.map(h=>n.test(h)?"".concat(h.replace(/\./g,"-"),".").concat(i):h),o=s.map(h=>"".concat(h,":").concat(r));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Gt("WEBCS_DOMAIN",o),Gt("WEBCS_DOMAIN_BACKUP_LIST",o),Gt("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(nl(e.report.hostname,"report.hostname"),Gt("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Gt("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Gt("EVENT_REPORT_DOMAIN",s[0]),Gt("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]));let a=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),a=e.report.port),Gt("STATS_COLLECTOR_PORT",a),e.report?Gt("ENABLE_EVENT_REPORT",!0):Gt("ENABLE_EVENT_REPORT",!1);let c="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(nl(e.log.hostname,"log.hostname"),c=e.log.hostname[0]):c=s[0];let d=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),d=e.log.port),Gt("LOG_UPLOAD_SERVER","".concat(c,":").concat(d));let l=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(nl(e.cds.hostname,"cds.hostname"),l=e.cds.hostname):l=s;let u=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),u=e.cds.port),Gt("CDS_AP",l.map(h=>"".concat(h,":").concat(u))),e.cds?Gt("ENABLE_CONFIG_DISTRIBUTE",!0):Gt("ENABLE_CONFIG_DISTRIBUTE",!1),C.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(nl(e,"serverList"),wn(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ee($.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const r=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(n=>r.test(n)?"".concat(n.replace(/\./g,"-"),".").concat(t):n),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Gt("WEBCS_DOMAIN",e),Gt("WEBCS_DOMAIN_BACKUP_LIST",e),Gt("GATEWAY_DOMAINS",[t]),Gt("EVENT_REPORT_DOMAIN",e[0]),Gt("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Gt("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),C.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(rn(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw C.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else C.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){rn(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const r=this._users.find(n=>n.uid===e);r&&r.videoTrack&&r.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(r){throw C.error("[".concat(this._clientId,"] set remote video stream type error"),r.toString()),r}C.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){rn(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(r){throw C.error("[".concat(this._clientId,"] set stream fallback option"),r.toString()),r}C.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,r,n){(function(s){rn(s,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),wn(t,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if(Ee(i).call(i,e)){if(!r||!(r instanceof Uint8Array&&r.length===32))throw new ee($.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(r)throw new ee($.INVALID_PARAMS,"current encrypt mode does not need salt");if(n){if(dl(n,"encryptDataStream"),!Ee(i).call(i,e))throw new ee($.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||C.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,r&&(this._encryptionSalt=Ou(r))}async renewToken(e){if(wn(e,"token",1,2047),!this._key||!this._joinInfo)throw new ee($.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const r=await this._renewTokenMutex.lock();try{if(W("USE_NEW_TOKEN")){C.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const n=await TLe(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Kr);C.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:n})}else C.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});C.debug("[".concat(this._clientId,"] renewToken success"))}catch(n){throw this._key=t,this._joinInfo.token=t,C.error("[".concat(this._clientId,"] renewToken failed"),n.toString()),n}finally{r()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?C.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(mt.VOLUME_INDICATOR,e)},W("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new ee($.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new ee($.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new ee($.LIVE_STREAMING_TASK_CONFLICT);const r=t?pl.TRANSCODE:pl.RAW;return this._createLiveStreamingClient(r).startLiveStreamingTask(e,r)}setLiveTranscoding(e){return this._createLiveStreamingClient(pl.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(r=>r&&r.hasUrl(e));if(!t.length)throw new ee($.INVALID_PARAMS,"can not find live streaming url to stop");await _e.all(t.map(r=>r&&r.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){jj(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){jj(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(e){var t;let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new ee($.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const i=new TextEncoder;e.payload=i.encode(e.payload)}let n=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ee(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(n=!0,e.payload=await async function(i,s,o){var a;const c=yc(a=Array.from(o)).call(a,(g,E)=>g+E,0),d={serverTs:0,seq:VPe++,length:o.length,checkSum:c},l=new Uint8Array(RU(c,2)),u=new ArrayBuffer(np),h=new DataView(u);h.setUint32(0,d.serverTs),h.setUint16(4,d.seq),h.setUint16(6,d.length),h.setUint16(8,d.checkSum);const p=16-o.length%16;o=bU(o,new Uint8Array(p));const _=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i,tagLength:CU,additionalData:l},s,o);return bU(new Uint8Array(u),new Uint8Array(_))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new ee($.INVALID_PARAMS,n?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request($e.DATA_STREAM,{payload:Ou(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-HLe},!r)}sendMetadata(e){if(!this._joinInfo)throw new ee($.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new ee($.METADATA_OUT_OF_RANGE);return this._gateway.signal.request($e.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Ou(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(HPe),!this._joinInfo)throw new ee($.INVALID_OPERATION,"can not send custom report, not joined");await Ce.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){rn(t.spatialLayer,"spatialLayer",[0,1,2,3]),rn(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(r){throw C.error("[".concat(this._clientId,"] pick SVC layer failed"),r.toString()),r}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:r}=e;if(dl(t,"apRTM"),qt(r,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=r,C.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=r,this._gateway.setRTM2Flag(r)}_reset(){if(C.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Hi.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&gX(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Ce.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Jn("client-publish"),this._subscribeMutex=new Jn("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var r;const n=e||qp();e?C.debug("[".concat(this._clientId,"] new Session ").concat(n)):C.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(n));const i=e?"":this._sessionId||"";this._sessionId=n,this.store.sessionId=n,Ce.addSid(n);const s={lts:new Date().getTime(),mode:this.mode,buildFormat:2,stringUid:(t==null?void 0:t.stringUid)||((r=this._joinInfo)===null||r===void 0?void 0:r.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:this.role==="audience"?2:1};Ce.sessionInit(this._sessionId,_a({cname:t.channel,appid:t.appId},s)),this._joinInfo&&(this._joinInfo.sid=n),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=n)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new ee($.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ee($.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&W("FORCE_TURN")&&!W("TURN_ENABLE_TCP")&&!W("TURN_ENABLE_UDP"))throw new ee($.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");C.debug("[".concat(this._clientId,"] publish high stream"));try{const r=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof gs){const n=(await r.next()).value;if(n){try{await this._gateway.sendExtensionMessage(jr.PUBLISH,n,!0)}catch(i){throw r.throw(i),i}await r.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const n=(await r.next()).value;if(n){var t;let i;try{i=await this._gateway.publish(this._uid,n,!0)}catch(s){if(s.code!==$.DISCONNECT_P2P)throw r.throw(s),s}await r.next(((t=i)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const i of e)i instanceof hr&&i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig),!i.muted&&i.enabled||await this._p2pChannel.muteLocalTrack(i)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r==null?void 0:r.code,e),(r==null?void 0:r.code)===$.WS_ABORT)return;throw r}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new ee($.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ee($.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));C.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const r=await this._p2pChannel.publishLowStream(this._lowStreamParameter),n=(await r.next()).value;if(n){var t;let i;try{i=await this._gateway.publish(this._uid,n,!0)}catch(s){if(s.code!==$.DISCONNECT_P2P)throw r.throw(s),s}r.next(((t=i)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r==null?void 0:r.code,void 0,!0),(r==null?void 0:r.code)===$.WS_ABORT)return;throw r}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new ee($.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const r=(n={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Fg("LiveStreaming").create(n));var n;return r.onLiveStreamError=(i,s)=>{Ce.reportApiInvoke(this._sessionId,{name:Zr.ON_LIVE_STREAM_ERROR,options:[i,s],tag:Or.TRACER}).onSuccess(),this.safeEmit(mt.LIVE_STREAMING_ERROR,i,s)},r.onLiveStreamWarning=(i,s)=>{Ce.reportApiInvoke(this._sessionId,{name:Zr.ON_LIVE_STREAM_WARNING,options:[i,s],tag:Or.TRACER}).onSuccess(),this.safeEmit(mt.LIVE_STREAMING_WARNING,i,s)},r.on(uN.REQUEST_WORKER_MANAGER_LIST,(i,s,o)=>{if(!this._joinInfo)return o(new ee($.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(a,c,d,l){const u=W("UAP_AP").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(h=>c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(h+"/api/v1?action=uap"):"https://".concat(h,"/api/v1?action=uap"));return await ELe(u,a,c,d,l)})(i,this._joinInfo,this._axiosCancelSource.token,Kr).then(s).catch(o)}),r};return e===pl.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new ee($.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:r}=this.getLocalVideoStats(),n=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:r}},Fg("ChannelMediaRelay").create(e));n.on("state",i=>{i===is.RELAY_STATE_FAILURE&&n&&n.dispose(),this.safeEmit(mt.CHANNEL_MEDIA_RELAY_STATE,i)}),n.on("event",i=>{this.safeEmit(mt.CHANNEL_MEDIA_RELAY_EVENT,i)}),this._channelMediaRelayClient=n,this._statsCollector.onStatsChanged=(i,s)=>{var o;i==="resolution"&&((o=this._channelMediaRelayClient)===null||o===void 0||o.setVideoProfile(s))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:r,deleted:n}=e,i=[];if(t){const s=[];this._users.forEach(o=>{o._dataChannels.forEach(a=>{r.every(c=>c.uid!==o._uintid||c.stream_id!==a.id)&&s.push({uid:o._uintid,stream_id:a.id,ordered:a.ordered,max_retrans_times:a.maxRetransmits,metadata:a.metadata})})}),s.length>0&&this._handleUpdateDataChannel({added:[],deleted:s})}Array.isArray(r)&&r.length>0&&r.forEach(s=>{const{uid:o,stream_id:a,ordered:c,max_retrans_times:d,metadata:l}=s,u=this._users.find(h=>h._uintid===o);if(!u)return void C.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(C.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(o)),Ee(i).call(i,u)||i.push(u),u._uintid||(u._uintid=o),u._dataChannels.findIndex(h=>h.id===s.stream_id)===-1){const h={id:a,ordered:!!c,maxRetransmits:d,metadata:l},p=function(_){return Jj(_,!0)}(h);u._dataChannels.push(p),C.info("[".concat(this._clientId,"] remote user ").concat(u.uid," published datachannel")),t||this.safeEmit(mt.USER_PUBLISHED,u,"datachannel",h)}this._p2pChannel.hasPendingRemoteDataChannel(u,s.stream_id)&&(C.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(u.uid," after reconnect.")),this._subscribeDataChannel(u,s.stream_id).catch(h=>{C.error("[".concat(this._clientId,"] resubscribe datachannel error"),h.toString())}))}),t&&(this.safeEmit(mt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(n)&&n.length>0&&n.forEach(s=>{const{uid:o,stream_id:a}=s,c=this._users.find(l=>l._uintid===o);if(!c)return void C.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const d=c._dataChannels.find(l=>l.id===s.stream_id);d&&(C.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(o)),this._p2pChannel.unsubscribeDataChannel(c,[d]).then(l=>{if(c._dataChannels=c._dataChannels.filter(u=>u!==d),l)return this._gateway.unsubscribeDataChannel(l,c.uid)}),C.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished datachannel ,id:").concat(d.id)),this.safeEmit(mt.USER_UNPUBLISHED,c,"datachannel",d._config))})}_handleRemoveDataChannels(e){const t=this._users.find(r=>r.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){C.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const r=()=>{C.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(n=>{this.safeEmit(mt.USER_UNPUBLISHED,t,"datachannel",n._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(n=>{if(n)return this._gateway.unsubscribeDataChannel(n,t.uid)}),r()}}else C.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(kn.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(kn.CONNECTION_STATE_CHANGE,(e,t,r)=>{var n;if(r===Vt.FALLBACK)return;const i=()=>{this.safeEmit(mt.CONNECTION_STATE_CHANGE,e,t,r)};if(Ce.reportApiInvoke(this._sessionId||((n=this._gateway.joinInfo)===null||n===void 0?void 0:n.sid)||null,{name:Zr.CONNECTION_STATE_CHANGE,options:[e,t,r],tag:Or.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:r})),C.info("[".concat(this._clientId,"] connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void i();if(e==="RECONNECTING")this._users.forEach(o=>{o._trust_in_room_=!1,o._trust_audio_enabled_state_=!1,o._trust_video_enabled_state_=!1,o._trust_audio_mute_state_=!1,o._trust_video_mute_state_=!1,o._trust_audio_stream_added_state_=!1,o._trust_video_stream_added_state_=!1,o._is_pre_created||(o._audio_pre_subscribed||(o._audioSSRC=void 0,o._audioOrtc=void 0),o._video_pre_subscribed||(o._videoSSRC=void 0,o._videoOrtc=void 0,o._rtxSsrcId=void 0),o._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var s;this._streamFallbackTypeCacheMap.forEach((o,a)=>{this._gateway.setStreamFallbackOption(a,o).catch(c=>{C.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),c)})}),this._remoteStreamTypeCacheMap.forEach((o,a)=>{this._gateway.setRemoteVideoStreamType(a,o).catch(c=>{C.warning("[".concat(this._clientId,"] auto set remote stream type failed"),c)})}),this._remoteDefaultVideoStreamType!==void 0&&((s=this._joinInfo)===null||s===void 0?void 0:s.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{C.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(o=>{C.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(o))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(o=>!o._trust_in_room_).forEach(o=>{C.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(o.uid)),this._handleUserOffline({uid:o.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(o=>{o._trust_audio_mute_state_||(C.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(o.uid)),this._handleMuteStream(o.uid,Oe.AUDIO,!1)),o._trust_video_mute_state_||(C.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(o.uid)),this._handleMuteStream(o.uid,Oe.VIDEO,!1)),o._trust_audio_enabled_state_||(C.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(o.uid)),this._handleSetStreamLocalEnable("audio",o.uid,!0)),o._trust_video_enabled_state_||(C.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(o.uid)),this._handleSetStreamLocalEnable("video",o.uid,!0)),o._trust_video_stream_added_state_||(C.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(o.uid)),this._handleResetAddStream(o,"video")),o._trust_audio_stream_added_state_||(C.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(o.uid)),this._handleResetAddStream(o,"audio")),o._video_added_||o._audio_added_||(C.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(o.uid)),this._handleRemoveStream({uid:o.uid,uint_id:o._uintid}))}))},1e3))}i()}),this._gateway.on(kn.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new ee($.UNEXPECTED_ERROR,"can not recover, no join info"));try{let r;const n=await tF(_a(_a({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));n?(r=n.ap,rF(n),this._joinInfo.preload=!0):(r=await SN(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Kr,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=r.gatewayInfo.res,this._joinInfo.gatewayAddrs=r.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=r.gatewayInfo.uni_lbs_ip);const i=[];r.gatewayInfo.gatewayAddrs.forEach(s=>{let{address:o}=s;const[a,c]=o.split(":");this._joinInfo&&this._joinInfo.proxyServer?i.push({proxy:this._joinInfo.proxyServer,host:a,port:c}):i.push({host:a,port:c})}),e(i)}catch(r){t(r)}}),this._gateway.on(kn.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(mt.NETWORK_QUALITY,e)}),this._gateway.on(kn.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(mt.STREAM_TYPE_CHANGED,e,t),Ce.reportApiInvoke(this._sessionId,{name:Zr.STREAM_TYPE_CHANGE,options:[e,t],tag:Or.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(kn.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(kn.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,r)=>{try{let n=await this._p2pChannel.getEstablishParams();W("ENABLE_PREALLOC_PC")&&n||(n=await this._p2pChannel.startP2PConnection(e)),t(n)}catch(n){r(n)}}),this._gateway.on(kn.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;const r=Q7(e.ortc,t,e.attributes.userAttributes.preSubSsrcs);this._p2pChannel.connect(r)}),this._gateway.on(kn.PRE_CONNECT_PC,async e=>{const{candidates:t,fingerprint:r}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){var n;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:i,cid:s}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(s,"_").concat(i),icePwd:"".concat(s,"_").concat(i)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(n=W("FINGERPRINT"))!==null&&n!==void 0?n:r}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(ft.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(ft.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(ft.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(ft.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(ft.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(ft.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(ft.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(ft.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(ft.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,Oe.AUDIO,!0)),this._gateway.signal.on(ft.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,Oe.AUDIO,!1)),this._gateway.signal.on(ft.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,Oe.VIDEO,!0)),this._gateway.signal.on(ft.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,Oe.VIDEO,!1)),this._gateway.signal.on(ft.RECEIVE_METADATA,e=>{const t=zh(e.metadata);this.safeEmit(mt.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(ft.ON_DATA_STREAM,async e=>{var t;if(!e)return;let r=zh(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ee(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<np)throw new ee($.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(np));r=await async function(s,o,a){const c=a.subarray(0,np),d=c.slice(8,np),l=(d[0]<<8)+d[1],u=(c[6]<<8)+c[7],h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:s,tagLength:CU,additionalData:new Uint8Array(RU(l,2))},o,a.subarray(np));return new Uint8Array(h).subarray(0,u)}(this._encryptDataStreamIv,this._encryptDataStreamKey,r)}let n=0;if(e.ordered||e.syncWithAudio){const i=this._p2pChannel.getStats(),s=this.remoteUsers.find(a=>a.uid===e.uid),o=i==null?void 0:i.audioRecv.find(a=>a.ssrc===(s==null?void 0:s._audioSSRC));n=o==null?void 0:o.jitterBufferMs}n==null&&(n=0),WLe(_a(_a({},e),{},{payload:r}),n,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(ft.ON_CRYPT_ERROR,()=>{zu(()=>{C.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(mt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(ft.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(ft.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{C.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Vt.TOKEN_EXPIRE),this.safeEmit(mt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(ft.ON_STREAM_FALLBACK_UPDATE,e=>{C.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(mt.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(ft.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),C.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(ft.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(ft.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(He.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case $e.PUBLISH:{if(!t)return;const i=t.ortc;if(i){var r,n;const s=i.some(c=>{let{stream_type:d}=c;return d===jt.Audio}),o=i.some(c=>{let{stream_type:d}=c;return d!==jt.Audio}),a=i.some(c=>{let{stream_type:d}=c;return d===jt.Screen||d===jt.ScreenLow});t.state==="offer"&&Ce.publish(this._joinInfo.sid,{eventElapse:Kn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:$.TIMEOUT,audio:s,video:o,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:a,audioName:s?(r=i.find(c=>{let{stream_type:d}=c;return d===jt.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0,videoName:o?(n=i.find(c=>{let{stream_type:d}=c;return d!==jt.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0})}break}case $e.SUBSCRIBE:t&&Ce.subscribe(this._joinInfo.sid,{succ:!1,ec:$.TIMEOUT,audio:t.stream_type===Oe.AUDIO,video:t.stream_type===Oe.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Kn.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(ft.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(ft.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;W("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(n=>!ph(n.string_id||n.stream_id,this.channelName)));const t=[],r=[];for(const n of e.users){let i=this._users.find(l=>l._uintid===n.stream_id);i?i._trust_in_room_=!0:(i=new au(n.string_id||n.stream_id,n.stream_id),this._users.push(i),this.getListeners(mt.PUBLISHED_USER_LIST).length===0&&(C.debug("[".concat(this._clientId,"] user online"),n.stream_id),this.safeEmit(mt.USER_JOINED,i)));const s=hn.Audio&n.stream_type,o=(hn.Video|hn.LwoVideo)&n.stream_type,a=(65280&n.stream_type)!=0,c=s&&i.hasAudio,d=o&&i.hasVideo;o&&(i._trust_video_stream_added_state_=!0,i._video_added_=!0,i._videoSSRC=n.video_ssrc,i._rtxSsrcId=n.video_rtx),s&&(i._trust_audio_stream_added_state_=!0,i._audio_added_=!0,i._audioSSRC=n.audio_ssrc),s&&!c&&this.getListeners(mt.PUBLISHED_USER_LIST).length===0&&(C.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published audio")),this.safeEmit(mt.USER_PUBLISHED,i,"audio")),o&&!d&&this.getListeners(mt.PUBLISHED_USER_LIST).length===0&&(C.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published video")),this.safeEmit(mt.USER_PUBLISHED,i,"video")),(s&&!c||o&&!d||a)&&t.push(i),o&&this._p2pChannel.hasPendingRemoteMedia(i,"video")&&r.push({user:i,mediaType:"video"}),s&&this._p2pChannel.hasPendingRemoteMedia(i,"audio")&&r.push({user:i,mediaType:"audio"})}r.length>0&&(C.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(r.map(n=>"user: ".concat(n.user.uid,", mediaType: ").concat(n.mediaType)).join("; ")," ")),this.massSubscribe(r).catch(n=>{C.error("[".concat(this._clientId,"] mass resubscribe error"),n.toString())})),this.getListeners(mt.PUBLISHED_USER_LIST).length>0?W("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(C.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(n=>n.uid).join(", "))),this.safeEmit(mt.PUBLISHED_USER_LIST,t)):C.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(n=>n.uid).join(", ")))}),this._gateway.signal.on(ft.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof Py&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(r=>r.toLowerCase()).filter(r=>{var n;return Ee(n=Object.keys(lT)).call(n,r)}))})}_handleP2PEvents(){this._gateway.signal.on(ft.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(jr.PUBLISH,(e,t,r)=>{const{uid:n}=e;e.forEach(i=>{const{kind:s,ssrcs:o,mid:a,isMuted:c}=i;this._handleP2PAddAudioOrVideoStream(s,n,o[0].ssrcId,a);const d=this._users.find(l=>l.uid===n);return d&&this._p2pChannel instanceof gs?this._p2pChannel.mockSubscribe(d,s,o[0].ssrcId,a).then(()=>{t()}).catch(r):t(),this._handleMuteStream(n,s,!!c)})}),this._gateway.signal.on(jr.CALL,async(e,t,r)=>{if(this._p2pChannel instanceof gs)try{var n;t(await this._p2pChannel.startP2P({turnServer:(n=this._joinInfo)===null||n===void 0?void 0:n.turnServer},e))}catch(i){r(i)}}),this._gateway.signal.on(He.P2P_CONNECTION,async e=>{this._p2pChannel instanceof gs&&await this._p2pChannel.p2pConnect(e)}),this._gateway.signal.on(jr.UNPUBLISH,async(e,t,r)=>{if(this._p2pChannel instanceof gs){const{unpubMsg:n,uid:i}=e,s=this._users.find(o=>o.uid===i);if(!s)return C.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();try{n.forEach(async o=>{let{stream_type:a}=o;const c=a===jt.Audio?Oe.AUDIO:Oe.VIDEO;await this._p2pChannel.unsubscribe(s,c),this._handleMuteStream(i,c,!0)}),t()}catch(o){r(o)}}}),this._gateway.signal.on(jr.CONTROL,async(e,t)=>{const{action:r}=e;switch(r){case mu.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Oe.VIDEO,!0);break;case mu.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Oe.AUDIO,!0);break;case mu.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Oe.VIDEO,!1);break;case mu.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Oe.AUDIO,!1)}}),this._gateway.signal.on(jr.RESTART_ICE,async(e,t,r)=>{if(this._p2pChannel instanceof gs)try{const{direction:n,iceParameter:i}=e;n!==Ri.SEND_ONLY||i?t(await this._p2pChannel.restartICE(n,i)):(this._p2pChannel.handleDisconnect(n),t())}catch(n){r(n)}}),this._gateway.signal.on(jr.CANDIDATE,e=>{if(this._p2pChannel instanceof gs){const{candidate:t,direction:r}=e;this._p2pChannel.addRemoteCandidate(t,r)}}),this._p2pChannel.on(Fe.RequestP2PRestartICE,async(e,t,r)=>{try{const{direction:n}=e;t(await this._gateway.sendExtensionMessage(jr.RESTART_ICE,e,n===Ri.SEND_ONLY))}catch(n){r(n)}}),this._p2pChannel.on(Fe.LocalCandidate,e=>{this._gateway.sendExtensionMessage(jr.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Fe.RequestP2PMuteLocal,async(e,t,r)=>{try{await this._gateway.sendExtensionMessage(jr.CONTROL,e,!0),t()}catch(n){r(n)}}),this._p2pChannel.on(Fe.RequestP2PUnmuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(n){n.code===$.DISCONNECT_P2P?t():r(n)}else t()}),this._p2pChannel.on(Fe.RequestP2PMuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(n){n.code===$.DISCONNECT_P2P?t():r(n)}else t()}),this._p2pChannel.on(Fe.StateChange,(e,t)=>{t===Ut.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Fe.RequestMuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(n){n.code===$.DISCONNECT_P2P?t():r(n)}else t()}),this._p2pChannel.on(Fe.RequestUnmuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(n){n.code===$.DISCONNECT_P2P?t():r(n)}else t()}),this._p2pChannel.on(Fe.RequestRePublish,(e,t,r)=>{this.publish(e,!1).then(t).catch(r)}),this._p2pChannel.on(Fe.RequestRePublishDataChannel,(e,t,r)=>{_e.all(e.map(async n=>{const i=await this._p2pChannel.publishDataChannel([n]);try{i.forEach(s=>{this._uid&&this._gateway.publishDataChannel(this._uid,s,!0)})}catch(s){if(s.code!==$.DISCONNECT_P2P)throw s}})).then(t).catch(r)}),this._p2pChannel.on(Fe.RequestReSubscribe,async(e,t,r)=>{try{for(const{user:n,kind:i}of e)i===Oe.VIDEO?await this.subscribe(n,"video"):await this.subscribe(n,"audio");t()}catch(n){r(n)}}),this._p2pChannel.on(Fe.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Fe.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Fe.MediaReconnectStart,e=>{this.safeEmit(mt.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Fe.MediaReconnectEnd,e=>{this.safeEmit(mt.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Fe.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Fe.RequestRestartICE,async e=>{if(this._p2pChannel instanceof gs)return;const t=await this._p2pChannel.restartICE(e),r=await t.next();if(r.done)return;const n=r.value;let i;try{i=await this._gateway.restartICE({iceParameters:n})}catch(o){return void t.throw(o)}const{iceParameters:s}=function(o){const a=o.iceParameters;return{iceParameters:{iceUfrag:a.iceUfrag,icePwd:a.icePwd}}}(i);await t.next({remoteIceParameters:s})}),this._p2pChannel.on(Fe.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Fe.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:r,rtpCapabilities:n}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:s}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:r,rtpCapabilities:n}),o=Q7(i,s);await this._p2pChannel.connect(o),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Fe.RequestUnpublishForReconnectPC,async(e,t,r)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):r()}),this._p2pChannel.on(Fe.P2PLost,()=>{this.safeEmit(mt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Fe.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Fe.ConnectionTypeChange,e=>{this.safeEmit(mt.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Fe.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Fe.QueryClientConnectionState,e=>{e(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new ee($.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new ee($.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const r=(t={config:e},Fg("ContentInspect").create(t));this._inspect=r,this.handleVideoInspectEvents(r);const{appId:n,cname:i,sid:s,token:o,uid:a,cid:c,vid:d}=this._joinInfo;await r.init({appId:n,areaCode:"",cname:i,sid:s,token:o,uid:a,cid:c,vid:d?Number(d):0},Kr)}catch(r){throw Array.isArray(r)?r[0]:r}var t}handleVideoInspectEvents(e){e.on(_n.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(mt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,r),r===ha.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(mt.CONTENT_INSPECT_ERROR,new ee($.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(_n.INSPECT_RESULT,(t,r)=>{var n;if((r==null?void 0:r.code)===$.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return C.debug("Stop inspect content because that has left channel"),this==null||(n=this._inspect)===null||n===void 0||n.close(),void(this._inspect=void 0);this.safeEmit(mt.CONTENT_INSPECT_RESULT,t,r)}),e.on(_n.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new ee($.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(dl(e,"enabled"),e){if(!t)throw new ee($.INVALID_PARAMS,"config is required");if(bX(t),!this._joinInfo)throw new ee($.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const n=(r={config:t},Fg("ImageModeration").create(r));this._moderation=n,this.handleImageModerationEvents(n);const{appId:i,cname:s,sid:o,token:a,uid:c,cid:d,vid:l}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:s,sid:o,token:a,uid:c,cid:d,vid:l?Number(l):0},Kr)}}catch(n){throw Array.isArray(n)?n[0]:n}}else{var r;if(!this._moderation)throw new ee($.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(n){throw Array.isArray(n)?n[0]:n}}}handleImageModerationEvents(e){e.on(Ja.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(mt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,r),t===wo.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new ee($.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Ja.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){rn(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new ee($.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,C.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return C.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){dl(e,"enabled"),Gt("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},we(ve.prototype,"leave",[uF],Object.getOwnPropertyDescriptor(ve.prototype,"leave"),ve.prototype),we(ve.prototype,"publish",[hF],Object.getOwnPropertyDescriptor(ve.prototype,"publish"),ve.prototype),we(ve.prototype,"unpublish",[fF],Object.getOwnPropertyDescriptor(ve.prototype,"unpublish"),ve.prototype),we(ve.prototype,"subscribe",[pF],Object.getOwnPropertyDescriptor(ve.prototype,"subscribe"),ve.prototype),we(ve.prototype,"presubscribe",[mF],Object.getOwnPropertyDescriptor(ve.prototype,"presubscribe"),ve.prototype),we(ve.prototype,"massSubscribe",[gF],Object.getOwnPropertyDescriptor(ve.prototype,"massSubscribe"),ve.prototype),we(ve.prototype,"unsubscribe",[_F],Object.getOwnPropertyDescriptor(ve.prototype,"unsubscribe"),ve.prototype),we(ve.prototype,"massUnsubscribe",[EF],Object.getOwnPropertyDescriptor(ve.prototype,"massUnsubscribe"),ve.prototype),we(ve.prototype,"setLowStreamParameter",[vF],Object.getOwnPropertyDescriptor(ve.prototype,"setLowStreamParameter"),ve.prototype),we(ve.prototype,"enableDualStream",[yF],Object.getOwnPropertyDescriptor(ve.prototype,"enableDualStream"),ve.prototype),we(ve.prototype,"disableDualStream",[bF],Object.getOwnPropertyDescriptor(ve.prototype,"disableDualStream"),ve.prototype),we(ve.prototype,"setClientRole",[SF],Object.getOwnPropertyDescriptor(ve.prototype,"setClientRole"),ve.prototype),we(ve.prototype,"setProxyServer",[wF],Object.getOwnPropertyDescriptor(ve.prototype,"setProxyServer"),ve.prototype),we(ve.prototype,"setTurnServer",[TF],Object.getOwnPropertyDescriptor(ve.prototype,"setTurnServer"),ve.prototype),we(ve.prototype,"setLicense",[RF],Object.getOwnPropertyDescriptor(ve.prototype,"setLicense"),ve.prototype),we(ve.prototype,"startProxyServer",[AF],Object.getOwnPropertyDescriptor(ve.prototype,"startProxyServer"),ve.prototype),we(ve.prototype,"stopProxyServer",[CF],Object.getOwnPropertyDescriptor(ve.prototype,"stopProxyServer"),ve.prototype),we(ve.prototype,"setLocalAccessPointsV2",[IF],Object.getOwnPropertyDescriptor(ve.prototype,"setLocalAccessPointsV2"),ve.prototype),we(ve.prototype,"setLocalAccessPoints",[OF],Object.getOwnPropertyDescriptor(ve.prototype,"setLocalAccessPoints"),ve.prototype),we(ve.prototype,"setRemoteDefaultVideoStreamType",[NF],Object.getOwnPropertyDescriptor(ve.prototype,"setRemoteDefaultVideoStreamType"),ve.prototype),we(ve.prototype,"setRemoteVideoStreamType",[DF],Object.getOwnPropertyDescriptor(ve.prototype,"setRemoteVideoStreamType"),ve.prototype),we(ve.prototype,"setStreamFallbackOption",[PF],Object.getOwnPropertyDescriptor(ve.prototype,"setStreamFallbackOption"),ve.prototype),we(ve.prototype,"setEncryptionConfig",[kF],Object.getOwnPropertyDescriptor(ve.prototype,"setEncryptionConfig"),ve.prototype),we(ve.prototype,"renewToken",[LF],Object.getOwnPropertyDescriptor(ve.prototype,"renewToken"),ve.prototype),we(ve.prototype,"enableAudioVolumeIndicator",[xF],Object.getOwnPropertyDescriptor(ve.prototype,"enableAudioVolumeIndicator"),ve.prototype),we(ve.prototype,"startLiveStreaming",[MF],Object.getOwnPropertyDescriptor(ve.prototype,"startLiveStreaming"),ve.prototype),we(ve.prototype,"setLiveTranscoding",[UF],Object.getOwnPropertyDescriptor(ve.prototype,"setLiveTranscoding"),ve.prototype),we(ve.prototype,"stopLiveStreaming",[jF],Object.getOwnPropertyDescriptor(ve.prototype,"stopLiveStreaming"),ve.prototype),we(ve.prototype,"startChannelMediaRelay",[FF],Object.getOwnPropertyDescriptor(ve.prototype,"startChannelMediaRelay"),ve.prototype),we(ve.prototype,"updateChannelMediaRelay",[BF],Object.getOwnPropertyDescriptor(ve.prototype,"updateChannelMediaRelay"),ve.prototype),we(ve.prototype,"stopChannelMediaRelay",[VF],Object.getOwnPropertyDescriptor(ve.prototype,"stopChannelMediaRelay"),ve.prototype),we(ve.prototype,"sendCustomReportMessage",[$F],Object.getOwnPropertyDescriptor(ve.prototype,"sendCustomReportMessage"),ve.prototype),we(ve.prototype,"pickSVCLayer",[HF],Object.getOwnPropertyDescriptor(ve.prototype,"pickSVCLayer"),ve.prototype),we(ve.prototype,"setRTMConfig",[zF],Object.getOwnPropertyDescriptor(ve.prototype,"setRTMConfig"),ve.prototype),we(ve.prototype,"enableContentInspect",[WF],Object.getOwnPropertyDescriptor(ve.prototype,"enableContentInspect"),ve.prototype),we(ve.prototype,"disableContentInspect",[GF],Object.getOwnPropertyDescriptor(ve.prototype,"disableContentInspect"),ve.prototype),we(ve.prototype,"setImageModeration",[qF],Object.getOwnPropertyDescriptor(ve.prototype,"setImageModeration"),ve.prototype),we(ve.prototype,"setP2PTransport",[KF],Object.getOwnPropertyDescriptor(ve.prototype,"setP2PTransport"),ve.prototype),we(ve.prototype,"getJoinChannelServiceRecords",[YF],Object.getOwnPropertyDescriptor(ve.prototype,"getJoinChannelServiceRecords"),ve.prototype),we(ve.prototype,"setPublishAudioFilterEnabled",[JF],Object.getOwnPropertyDescriptor(ve.prototype,"setPublishAudioFilterEnabled"),ve.prototype),ve);class wE{constructor(t,r){j(this,"id",0),j(this,"element",void 0),j(this,"peerPair",void 0),j(this,"context",void 0),j(this,"audioPlayerElement",void 0),j(this,"audioTrack",void 0),wE.count+=1,this.id=wE.count,this.element=t,this.context=r}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const r=document.createElement("audio");r.srcObject=new MediaStream([t.track]),r.play(),this.audioPlayerElement=r}}async switchSdp(){if(!this.peerPair)return;const t=async(n,i)=>{const s=i==="offer"?await n.createOffer():await n.createAnswer();return await n.setLocalDescription(s),n.iceGatheringState==="complete"?n.localDescription:new _e(o=>{n.onicegatheringstatechange=()=>{n.iceGatheringState==="complete"&&o(n.localDescription)}})},r=async(n,i)=>await n.setRemoteDescription(i);try{const n=await t(this.peerPair[0],"offer");await r(this.peerPair[1],n);const i=await t(this.peerPair[1],"answer");await r(this.peerPair[0],i)}catch(n){throw new ee($.LOCAL_AEC_ERROR,n.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let r;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),r=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(r)}catch(i){throw new ee($.LOCAL_AEC_ERROR,i.toString()).print()}if(!r)throw new ee($.LOCAL_AEC_ERROR,"no dest node when local aec").print();const n=r.stream.getAudioTracks()[0];return this.audioTrack=n,n}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,r=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(r),await this.switchSdp()}close(){C.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var QF,Ly;j(wE,"count",0);const cxe=window.AudioContext||window.webkitAudioContext,dxe=new(QF=je({report:Ce}),we((Ly=class{constructor(){j(this,"units",[]),j(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return C.debug("the system does not need to process local aec"),-1;this.context||(this.context=new cxe);let t=this.units.find(r=>r&&r.getElement()===e);return t||(t=new wE(e,this.context),this.units.push(t)),t.startEchoCancellation(),C.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return Rt().name!==Ft.SAFARI}}).prototype,"processExternalMediaAEC",[QF],Object.getOwnPropertyDescriptor(Ly.prototype,"processExternalMediaAEC"),Ly.prototype),Ly);function ZF(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function eB(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ZF(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ZF(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}const ZC=window||document;function SX(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!ZC)return;const r=$r._cspEventHandlerPointer;if(r&&t)return void console.error(r,t);const n=i=>{if(!(i&&i.blockedURI&&($r.onSecurityPolicyViolation||$r.getListeners(Jc.SECURITY_POLICY_VIOLATION).length>0)))return;const s=i.blockedURI;W("CSP_DETECTED_HOSTNAME_LIST").some(o=>Ee(s).call(s,o))&&($r.onSecurityPolicyViolation&&typeof $r.onSecurityPolicyViolation=="function"&&$r.onSecurityPolicyViolation(i),$r.getListeners(Jc.SECURITY_POLICY_VIOLATION).length>0&&$r.safeEmit(Jc.SECURITY_POLICY_VIOLATION,i))};r&&ZC.removeEventListener("securitypolicyviolation",r),(t||e&&typeof e=="function"||$r.getListeners(Jc.SECURITY_POLICY_VIOLATION).length>0)&&ZC.addEventListener("securitypolicyviolation",n),$r._cspEventHandlerPointer=n}var lxe=ki,uxe=wY,tB=RegExp.prototype,hxe=function(e){return e===tB||lxe(tB,e)?uxe(e):e.flags},ai=Pr(hxe);function P0(e){let t=e.length;for(;--t>=0;)e[t]=0}const z3=256,wX=286,l_=30,u_=15,CN=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),zb=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),fxe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),rB=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),sl=new Array(576);P0(sl);const h_=new Array(60);P0(h_);const TE=new Array(512);P0(TE);const RE=new Array(256);P0(RE);const W3=new Array(29);P0(W3);const DS=new Array(l_);function eI(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}let nB,iB,sB;function tI(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}P0(DS);const TX=e=>e<256?TE[e]:TE[256+(e>>>7)],AE=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Qs=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,AE(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},Xc=(e,t,r)=>{Qs(e,r[2*t],r[2*t+1])},RX=(e,t)=>{let r=0;do r|=1&e,e>>>=1,r<<=1;while(--t>0);return r>>>1},AX=(e,t,r)=>{const n=new Array(16);let i,s,o=0;for(i=1;i<=u_;i++)o=o+r[i-1]<<1,n[i]=o;for(s=0;s<=t;s++){let a=e[2*s+1];a!==0&&(e[2*s]=RX(n[a]++,a))}},CX=e=>{let t;for(t=0;t<wX;t++)e.dyn_ltree[2*t]=0;for(t=0;t<l_;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},IX=e=>{e.bi_valid>8?AE(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},oB=(e,t,r,n)=>{const i=2*t,s=2*r;return e[i]<e[s]||e[i]===e[s]&&n[t]<=n[r]},rI=(e,t,r)=>{const n=e.heap[r];let i=r<<1;for(;i<=e.heap_len&&(i<e.heap_len&&oB(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!oB(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n},aB=(e,t,r)=>{let n,i,s,o,a=0;if(e.sym_next!==0)do n=255&e.pending_buf[e.sym_buf+a++],n+=(255&e.pending_buf[e.sym_buf+a++])<<8,i=e.pending_buf[e.sym_buf+a++],n===0?Xc(e,i,t):(s=RE[i],Xc(e,s+z3+1,t),o=CN[s],o!==0&&(i-=W3[s],Qs(e,i,o)),n--,s=TX(n),Xc(e,s,r),o=zb[s],o!==0&&(n-=DS[s],Qs(e,n,o)));while(a<e.sym_next);Xc(e,256,t)},nI=(e,t)=>{const r=t.dyn_tree,n=t.stat_desc.static_tree,i=t.stat_desc.has_stree,s=t.stat_desc.elems;let o,a,c,d=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<s;o++)r[2*o]!==0?(e.heap[++e.heap_len]=d=o,e.depth[o]=0):r[2*o+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=d<2?++d:0,r[2*c]=1,e.depth[c]=0,e.opt_len--,i&&(e.static_len-=n[2*c+1]);for(t.max_code=d,o=e.heap_len>>1;o>=1;o--)rI(e,r,o);c=s;do o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],rI(e,r,1),a=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=a,r[2*c]=r[2*o]+r[2*a],e.depth[c]=(e.depth[o]>=e.depth[a]?e.depth[o]:e.depth[a])+1,r[2*o+1]=r[2*a+1]=c,e.heap[1]=c++,rI(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((l,u)=>{const h=u.dyn_tree,p=u.max_code,_=u.stat_desc.static_tree,g=u.stat_desc.has_stree,E=u.stat_desc.extra_bits,b=u.stat_desc.extra_base,v=u.stat_desc.max_length;let I,N,L,U,w,V,z=0;for(U=0;U<=u_;U++)l.bl_count[U]=0;for(h[2*l.heap[l.heap_max]+1]=0,I=l.heap_max+1;I<573;I++)N=l.heap[I],U=h[2*h[2*N+1]+1]+1,U>v&&(U=v,z++),h[2*N+1]=U,N>p||(l.bl_count[U]++,w=0,N>=b&&(w=E[N-b]),V=h[2*N],l.opt_len+=V*(U+w),g&&(l.static_len+=V*(_[2*N+1]+w)));if(z!==0){do{for(U=v-1;l.bl_count[U]===0;)U--;l.bl_count[U]--,l.bl_count[U+1]+=2,l.bl_count[v]--,z-=2}while(z>0);for(U=v;U!==0;U--)for(N=l.bl_count[U];N!==0;)L=l.heap[--I],L>p||(h[2*L+1]!==U&&(l.opt_len+=(U-h[2*L+1])*h[2*L],h[2*L+1]=U),N--)}})(e,t),AX(r,d,e.bl_count)},cB=(e,t,r)=>{let n,i,s=-1,o=t[1],a=0,c=7,d=4;for(o===0&&(c=138,d=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=o,o=t[2*(n+1)+1],++a<c&&i===o||(a<d?e.bl_tree[2*i]+=a:i!==0?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,s=i,o===0?(c=138,d=3):i===o?(c=6,d=3):(c=7,d=4))},dB=(e,t,r)=>{let n,i,s=-1,o=t[1],a=0,c=7,d=4;for(o===0&&(c=138,d=3),n=0;n<=r;n++)if(i=o,o=t[2*(n+1)+1],!(++a<c&&i===o)){if(a<d)do Xc(e,i,e.bl_tree);while(--a!=0);else i!==0?(i!==s&&(Xc(e,i,e.bl_tree),a--),Xc(e,16,e.bl_tree),Qs(e,a-3,2)):a<=10?(Xc(e,17,e.bl_tree),Qs(e,a-3,3)):(Xc(e,18,e.bl_tree),Qs(e,a-11,7));a=0,s=i,o===0?(c=138,d=3):i===o?(c=6,d=3):(c=7,d=4)}};let lB=!1;const OX=(e,t,r,n)=>{Qs(e,0+(n?1:0),3),IX(e),AE(e,r),AE(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};var pxe=e=>{lB||((()=>{let t,r,n,i,s;const o=new Array(16);for(n=0,i=0;i<28;i++)for(W3[i]=n,t=0;t<1<<CN[i];t++)RE[n++]=i;for(RE[n-1]=i,s=0,i=0;i<16;i++)for(DS[i]=s,t=0;t<1<<zb[i];t++)TE[s++]=i;for(s>>=7;i<l_;i++)for(DS[i]=s<<7,t=0;t<1<<zb[i]-7;t++)TE[256+s++]=i;for(r=0;r<=u_;r++)o[r]=0;for(t=0;t<=143;)sl[2*t+1]=8,t++,o[8]++;for(;t<=255;)sl[2*t+1]=9,t++,o[9]++;for(;t<=279;)sl[2*t+1]=7,t++,o[7]++;for(;t<=287;)sl[2*t+1]=8,t++,o[8]++;for(AX(sl,287,o),t=0;t<l_;t++)h_[2*t+1]=5,h_[2*t]=RX(t,5);nB=new eI(sl,CN,257,wX,u_),iB=new eI(h_,zb,0,l_,u_),sB=new eI(new Array(0),fxe,0,19,7)})(),lB=!0),e.l_desc=new tI(e.dyn_ltree,nB),e.d_desc=new tI(e.dyn_dtree,iB),e.bl_desc=new tI(e.bl_tree,sB),e.bi_buf=0,e.bi_valid=0,CX(e)},mxe=(e,t,r,n)=>{let i,s,o=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(a=>{let c,d=4093624447;for(c=0;c<=31;c++,d>>>=1)if(1&d&&a.dyn_ltree[2*c]!==0)return 0;if(a.dyn_ltree[18]!==0||a.dyn_ltree[20]!==0||a.dyn_ltree[26]!==0)return 1;for(c=32;c<z3;c++)if(a.dyn_ltree[2*c]!==0)return 1;return 0})(e)),nI(e,e.l_desc),nI(e,e.d_desc),o=(a=>{let c;for(cB(a,a.dyn_ltree,a.l_desc.max_code),cB(a,a.dyn_dtree,a.d_desc.max_code),nI(a,a.bl_desc),c=18;c>=3&&a.bl_tree[2*rB[c]+1]===0;c--);return a.opt_len+=3*(c+1)+5+5+4,c})(e),i=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=i&&(i=s)):i=s=r+5,r+4<=i&&t!==-1?OX(e,t,r,n):e.strategy===4||s===i?(Qs(e,2+(n?1:0),3),aB(e,sl,h_)):(Qs(e,4+(n?1:0),3),((a,c,d,l)=>{let u;for(Qs(a,c-257,5),Qs(a,d-1,5),Qs(a,l-4,4),u=0;u<l;u++)Qs(a,a.bl_tree[2*rB[u]+1],3);dB(a,a.dyn_ltree,c-1),dB(a,a.dyn_dtree,d-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),aB(e,e.dyn_ltree,e.dyn_dtree)),CX(e),n&&IX(e)},gxe=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,t===0?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(RE[r]+z3+1)]++,e.dyn_dtree[2*TX(t)]++),e.sym_next===e.sym_end),_xe=e=>{Qs(e,2,3),Xc(e,256,sl),(t=>{t.bi_valid===16?(AE(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},Exe={_tr_init:pxe,_tr_stored_block:OX,_tr_flush_block:mxe,_tr_tally:gxe,_tr_align:_xe},CE=(e,t,r,n)=>{let i=65535&e|0,s=e>>>16&65535|0,o=0;for(;r!==0;){o=r>2e3?2e3:r,r-=o;do i=i+t[n++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0};const vxe=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var wi=(e,t,r,n)=>{const i=vxe,s=n+r;e^=-1;for(let o=n;o<s;o++)e=e>>>8^i[255&(e^t[o])];return-1^e},Tf={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},k0={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:yxe,_tr_stored_block:IN,_tr_flush_block:bxe,_tr_tally:Nu,_tr_align:Sxe}=Exe,{Z_NO_FLUSH:Du,Z_PARTIAL_FLUSH:wxe,Z_FULL_FLUSH:Txe,Z_FINISH:Aa,Z_BLOCK:uB,Z_OK:ji,Z_STREAM_END:hB,Z_STREAM_ERROR:hd,Z_DATA_ERROR:Rxe,Z_BUF_ERROR:iI,Z_DEFAULT_COMPRESSION:Axe,Z_FILTERED:Cxe,Z_HUFFMAN_ONLY:xy,Z_RLE:Ixe,Z_FIXED:Oxe,Z_DEFAULT_STRATEGY:Nxe,Z_UNKNOWN:Dxe,Z_DEFLATED:mT}=k0,ON=286,Pxe=30,kxe=19,Lxe=2*ON+1,xxe=15,Gh=258,fd=262,Wm=42,qh=113,Vg=666,Kh=(e,t)=>(e.msg=Tf[t],t),fB=e=>2*e-(e>4?9:0),cu=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Mxe=e=>{let t,r,n,i=e.w_size;t=e.hash_size,n=t;do r=e.head[--n],e.head[n]=r>=i?r-i:0;while(--t);t=i,n=t;do r=e.prev[--n],e.prev[n]=r>=i?r-i:0;while(--t)};let Pu=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask;const Ro=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))},Io=(e,t)=>{bxe(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Ro(e.strm)},kr=(e,t)=>{e.pending_buf[e.pending++]=t},yg=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},NN=(e,t,r,n)=>{let i=e.avail_in;return i>n&&(i=n),i===0?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),r),e.state.wrap===1?e.adler=CE(e.adler,t,i,r):e.state.wrap===2&&(e.adler=wi(e.adler,t,i,r)),e.next_in+=i,e.total_in+=i,i)},NX=(e,t)=>{let r,n,i=e.max_chain_length,s=e.strstart,o=e.prev_length,a=e.nice_match;const c=e.strstart>e.w_size-fd?e.strstart-(e.w_size-fd):0,d=e.window,l=e.w_mask,u=e.prev,h=e.strstart+Gh;let p=d[s+o-1],_=d[s+o];e.prev_length>=e.good_match&&(i>>=2),a>e.lookahead&&(a=e.lookahead);do if(r=t,d[r+o]===_&&d[r+o-1]===p&&d[r]===d[s]&&d[++r]===d[s+1]){s+=2,r++;do;while(d[++s]===d[++r]&&d[++s]===d[++r]&&d[++s]===d[++r]&&d[++s]===d[++r]&&d[++s]===d[++r]&&d[++s]===d[++r]&&d[++s]===d[++r]&&d[++s]===d[++r]&&s<h);if(n=Gh-(h-s),s=h-Gh,n>o){if(e.match_start=t,o=n,n>=a)break;p=d[s+o-1],_=d[s+o]}}while((t=u[t&l])>c&&--i!=0);return o<=e.lookahead?o:e.lookahead},Gm=e=>{const t=e.w_size;let r,n,i;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-fd)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Mxe(e),n+=t),e.strm.avail_in===0)break;if(r=NN(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=r,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=Pu(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=Pu(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<fd&&e.strm.avail_in!==0)},DX=(e,t)=>{let r,n,i,s=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,a=e.strm.avail_in;do{if(r=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i||(i=e.strm.avail_out-i,n=e.strstart-e.block_start,r>n+e.strm.avail_in&&(r=n+e.strm.avail_in),r>i&&(r=i),r<s&&(r===0&&t!==Aa||t===Du||r!==n+e.strm.avail_in)))break;o=t===Aa&&r===n+e.strm.avail_in?1:0,IN(e,0,0,o),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,Ro(e.strm),n&&(n>r&&(n=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+n),e.strm.next_out),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n,e.block_start+=n,r-=n),r&&(NN(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(o===0);return a-=e.strm.avail_in,a&&(a>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=a&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-a,e.strm.next_in),e.strstart),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==Du&&t!==Aa&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(NN(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,s=i>e.w_size?e.w_size:i,n=e.strstart-e.block_start,(n>=s||(n||t===Aa)&&t!==Du&&e.strm.avail_in===0&&n<=i)&&(r=n>i?i:n,o=t===Aa&&e.strm.avail_in===0&&r===n?1:0,IN(e,e.block_start,r,o),e.block_start+=r,Ro(e.strm)),o?3:1)},sI=(e,t)=>{let r,n;for(;;){if(e.lookahead<fd){if(Gm(e),e.lookahead<fd&&t===Du)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=Pu(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-fd&&(e.match_length=NX(e,r)),e.match_length>=3)if(n=Nu(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Pu(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Pu(e,e.ins_h,e.window[e.strstart+1]);else n=Nu(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(Io(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Aa?(Io(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Io(e,!1),e.strm.avail_out===0)?1:2},fp=(e,t)=>{let r,n,i;for(;;){if(e.lookahead<fd){if(Gm(e),e.lookahead<fd&&t===Du)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=Pu(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-fd&&(e.match_length=NX(e,r),e.match_length<=5&&(e.strategy===Cxe||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,n=Nu(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=Pu(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(Io(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(n=Nu(e,0,e.window[e.strstart-1]),n&&Io(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=Nu(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Aa?(Io(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Io(e,!1),e.strm.avail_out===0)?1:2};function jc(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}const $g=[new jc(0,0,0,0,DX),new jc(4,4,8,4,sI),new jc(4,5,16,8,sI),new jc(4,6,32,32,sI),new jc(4,4,16,16,fp),new jc(8,16,32,32,fp),new jc(8,16,128,128,fp),new jc(8,32,128,256,fp),new jc(32,128,258,1024,fp),new jc(32,258,258,4096,fp)];function Uxe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=mT,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Lxe),this.dyn_dtree=new Uint16Array(2*(2*Pxe+1)),this.bl_tree=new Uint16Array(2*(2*kxe+1)),cu(this.dyn_ltree),cu(this.dyn_dtree),cu(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(xxe+1),this.heap=new Uint16Array(2*ON+1),cu(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*ON+1),cu(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const IE=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Wm&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==qh&&t.status!==Vg?1:0},PX=e=>{if(IE(e))return Kh(e,hd);e.total_in=e.total_out=0,e.data_type=Dxe;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Wm:qh,e.adler=t.wrap===2?0:1,t.last_flush=-2,yxe(t),ji},kX=e=>{const t=PX(e);return t===ji&&(r=>{r.window_size=2*r.w_size,cu(r.head),r.max_lazy_match=$g[r.level].max_lazy,r.good_match=$g[r.level].good_length,r.nice_match=$g[r.level].nice_length,r.max_chain_length=$g[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0})(e.state),t},pB=(e,t,r,n,i,s)=>{if(!e)return hd;let o=1;if(t===Axe&&(t=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),i<1||i>9||r!==mT||n<8||n>15||t<0||t>9||s<0||s>Oxe||n===8&&o!==1)return Kh(e,hd);n===8&&(n=9);const a=new Uxe;return e.state=a,a.strm=e,a.status=Wm,a.wrap=o,a.gzhead=null,a.w_bits=n,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=t,a.strategy=s,a.method=r,kX(e)};var jxe=(e,t)=>{if(IE(e)||t>uB||t<0)return e?Kh(e,hd):hd;const r=e.state;if(!e.output||e.avail_in!==0&&!e.input||r.status===Vg&&t!==Aa)return Kh(e,e.avail_out===0?iI:hd);const n=r.last_flush;if(r.last_flush=t,r.pending!==0){if(Ro(e),e.avail_out===0)return r.last_flush=-1,ji}else if(e.avail_in===0&&fB(t)<=fB(n)&&t!==Aa)return Kh(e,iI);if(r.status===Vg&&e.avail_in!==0)return Kh(e,iI);if(r.status===Wm&&r.wrap===0&&(r.status=qh),r.status===Wm){let i=mT+(r.w_bits-8<<4)<<8,s=-1;if(s=r.strategy>=xy||r.level<2?0:r.level<6?1:r.level===6?2:3,i|=s<<6,r.strstart!==0&&(i|=32),i+=31-i%31,yg(r,i),r.strstart!==0&&(yg(r,e.adler>>>16),yg(r,65535&e.adler)),e.adler=1,r.status=qh,Ro(e),r.pending!==0)return r.last_flush=-1,ji}if(r.status===57){if(e.adler=0,kr(r,31),kr(r,139),kr(r,8),r.gzhead)kr(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),kr(r,255&r.gzhead.time),kr(r,r.gzhead.time>>8&255),kr(r,r.gzhead.time>>16&255),kr(r,r.gzhead.time>>24&255),kr(r,r.level===9?2:r.strategy>=xy||r.level<2?4:0),kr(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(kr(r,255&r.gzhead.extra.length),kr(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=wi(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(kr(r,0),kr(r,0),kr(r,0),kr(r,0),kr(r,0),kr(r,r.level===9?2:r.strategy>=xy||r.level<2?4:0),kr(r,3),r.status=qh,Ro(e),r.pending!==0)return r.last_flush=-1,ji}if(r.status===69){if(r.gzhead.extra){let i=r.pending,s=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+s>r.pending_buf_size;){let a=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+a),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>i&&(e.adler=wi(e.adler,r.pending_buf,r.pending-i,i)),r.gzindex+=a,Ro(e),r.pending!==0)return r.last_flush=-1,ji;i=0,s-=a}let o=new Uint8Array(r.gzhead.extra);r.pending_buf.set(o.subarray(r.gzindex,r.gzindex+s),r.pending),r.pending+=s,r.gzhead.hcrc&&r.pending>i&&(e.adler=wi(e.adler,r.pending_buf,r.pending-i,i)),r.gzindex=0}r.status=73}if(r.status===73){if(r.gzhead.name){let i,s=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>s&&(e.adler=wi(e.adler,r.pending_buf,r.pending-s,s)),Ro(e),r.pending!==0)return r.last_flush=-1,ji;s=0}i=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,kr(r,i)}while(i!==0);r.gzhead.hcrc&&r.pending>s&&(e.adler=wi(e.adler,r.pending_buf,r.pending-s,s)),r.gzindex=0}r.status=91}if(r.status===91){if(r.gzhead.comment){let i,s=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>s&&(e.adler=wi(e.adler,r.pending_buf,r.pending-s,s)),Ro(e),r.pending!==0)return r.last_flush=-1,ji;s=0}i=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,kr(r,i)}while(i!==0);r.gzhead.hcrc&&r.pending>s&&(e.adler=wi(e.adler,r.pending_buf,r.pending-s,s))}r.status=103}if(r.status===103){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(Ro(e),r.pending!==0))return r.last_flush=-1,ji;kr(r,255&e.adler),kr(r,e.adler>>8&255),e.adler=0}if(r.status=qh,Ro(e),r.pending!==0)return r.last_flush=-1,ji}if(e.avail_in!==0||r.lookahead!==0||t!==Du&&r.status!==Vg){let i=r.level===0?DX(r,t):r.strategy===xy?((s,o)=>{let a;for(;;){if(s.lookahead===0&&(Gm(s),s.lookahead===0)){if(o===Du)return 1;break}if(s.match_length=0,a=Nu(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,a&&(Io(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===Aa?(Io(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Io(s,!1),s.strm.avail_out===0)?1:2})(r,t):r.strategy===Ixe?((s,o)=>{let a,c,d,l;const u=s.window;for(;;){if(s.lookahead<=Gh){if(Gm(s),s.lookahead<=Gh&&o===Du)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(d=s.strstart-1,c=u[d],c===u[++d]&&c===u[++d]&&c===u[++d])){l=s.strstart+Gh;do;while(c===u[++d]&&c===u[++d]&&c===u[++d]&&c===u[++d]&&c===u[++d]&&c===u[++d]&&c===u[++d]&&c===u[++d]&&d<l);s.match_length=Gh-(l-d),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(a=Nu(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(a=Nu(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),a&&(Io(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===Aa?(Io(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Io(s,!1),s.strm.avail_out===0)?1:2})(r,t):$g[r.level].func(r,t);if(i!==3&&i!==4||(r.status=Vg),i===1||i===3)return e.avail_out===0&&(r.last_flush=-1),ji;if(i===2&&(t===wxe?Sxe(r):t!==uB&&(IN(r,0,0,!1),t===Txe&&(cu(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),Ro(e),e.avail_out===0))return r.last_flush=-1,ji}return t!==Aa?ji:r.wrap<=0?hB:(r.wrap===2?(kr(r,255&e.adler),kr(r,e.adler>>8&255),kr(r,e.adler>>16&255),kr(r,e.adler>>24&255),kr(r,255&e.total_in),kr(r,e.total_in>>8&255),kr(r,e.total_in>>16&255),kr(r,e.total_in>>24&255)):(yg(r,e.adler>>>16),yg(r,65535&e.adler)),Ro(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?ji:hB)},Fxe=(e,t)=>{let r=t.length;if(IE(e))return hd;const n=e.state,i=n.wrap;if(i===2||i===1&&n.status!==Wm||n.lookahead)return hd;if(i===1&&(e.adler=CE(e.adler,t,r,0)),n.wrap=0,r>=n.w_size){i===0&&(cu(n.head),n.strstart=0,n.block_start=0,n.insert=0);let c=new Uint8Array(n.w_size);c.set(t.subarray(r-n.w_size,r),0),t=c,r=n.w_size}const s=e.avail_in,o=e.next_in,a=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,Gm(n);n.lookahead>=3;){let c=n.strstart,d=n.lookahead-2;do n.ins_h=Pu(n,n.ins_h,n.window[c+3-1]),n.prev[c&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=c,c++;while(--d);n.strstart=c,n.lookahead=2,Gm(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=o,e.input=a,e.avail_in=s,n.wrap=i,ji},f_={deflateInit:(e,t)=>pB(e,t,mT,15,8,Nxe),deflateInit2:pB,deflateReset:kX,deflateResetKeep:PX,deflateSetHeader:(e,t)=>IE(e)||e.state.wrap!==2?hd:(e.state.gzhead=t,ji),deflate:jxe,deflateEnd:e=>{if(IE(e))return hd;const t=e.state.status;return e.state=null,t===qh?Kh(e,Rxe):ji},deflateSetDictionary:Fxe,deflateInfo:"pako deflate (from Nodeca project)"};const Bxe=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var gT={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(const n in r)Bxe(r,n)&&(e[n]=r[n])}}return e},flattenChunks:e=>{let t=0;for(let n=0,i=e.length;n<i;n++)t+=e[n].length;const r=new Uint8Array(t);for(let n=0,i=0,s=e.length;n<s;n++){let o=e[n];r.set(o,i),i+=o.length}return r}};let LX=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{LX=!1}const OE=new Uint8Array(256);for(let e=0;e<256;e++)OE[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;OE[254]=OE[254]=1;var NE={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,r,n,i,s,o=e.length,a=0;for(i=0;i<o;i++)r=e.charCodeAt(i),(64512&r)==55296&&i+1<o&&(n=e.charCodeAt(i+1),(64512&n)==56320&&(r=65536+(r-55296<<10)+(n-56320),i++)),a+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(a),s=0,i=0;s<a;i++)r=e.charCodeAt(i),(64512&r)==55296&&i+1<o&&(n=e.charCodeAt(i+1),(64512&n)==56320&&(r=65536+(r-55296<<10)+(n-56320),i++)),r<128?t[s++]=r:r<2048?(t[s++]=192|r>>>6,t[s++]=128|63&r):r<65536?(t[s++]=224|r>>>12,t[s++]=128|r>>>6&63,t[s++]=128|63&r):(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63,t[s++]=128|r>>>6&63,t[s++]=128|63&r);return t},buf2string:(e,t)=>{const r=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let n,i;const s=new Array(2*r);for(i=0,n=0;n<r;){let o=e[n++];if(o<128){s[i++]=o;continue}let a=OE[o];if(a>4)s[i++]=65533,n+=a-1;else{for(o&=a===2?31:a===3?15:7;a>1&&n<r;)o=o<<6|63&e[n++],a--;a>1?s[i++]=65533:o<65536?s[i++]=o:(o-=65536,s[i++]=55296|o>>10&1023,s[i++]=56320|1023&o)}}return((o,a)=>{if(a<65534&&o.subarray&&LX)return String.fromCharCode.apply(null,o.length===a?o:o.subarray(0,a));let c="";for(let d=0;d<a;d++)c+=String.fromCharCode(o[d]);return c})(s,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&(192&e[r])==128;)r--;return r<0||r===0?t:r+OE[e[r]]>t?r:t}},xX=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const MX=Object.prototype.toString,{Z_NO_FLUSH:Vxe,Z_SYNC_FLUSH:$xe,Z_FULL_FLUSH:Hxe,Z_FINISH:zxe,Z_OK:PS,Z_STREAM_END:Wxe,Z_DEFAULT_COMPRESSION:Gxe,Z_DEFAULT_STRATEGY:qxe,Z_DEFLATED:Kxe}=k0;function p_(e){this.options=gT.assign({level:Gxe,method:Kxe,chunkSize:16384,windowBits:15,memLevel:8,strategy:qxe},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new xX,this.strm.avail_out=0;let r=f_.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==PS)throw new Error(Tf[r]);if(t.header&&f_.deflateSetHeader(this.strm,t.header),t.dictionary){let n;if(n=typeof t.dictionary=="string"?NE.string2buf(t.dictionary):MX.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,r=f_.deflateSetDictionary(this.strm,n),r!==PS)throw new Error(Tf[r]);this._dict_set=!0}}function oI(e,t){const r=new p_(t);if(r.push(e,!0),r.err)throw r.msg||Tf[r.err];return r.result}p_.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize;let i,s;if(this.ended)return!1;for(s=t===~~t?t:t===!0?zxe:Vxe,typeof e=="string"?r.input=NE.string2buf(e):MX.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(s===$xe||s===Hxe)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(i=f_.deflate(r,s),i===Wxe)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),i=f_.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===PS;if(r.avail_out!==0){if(s>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(r.avail_in===0)break}else this.onData(r.output)}return!0},p_.prototype.onData=function(e){this.chunks.push(e)},p_.prototype.onEnd=function(e){e===PS&&(this.result=gT.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Yxe={Deflate:p_,deflate:oI,deflateRaw:function(e,t){return(t=t||{}).raw=!0,oI(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,oI(e,t)},constants:k0};const My=16209;var Jxe=function(e,t){let r,n,i,s,o,a,c,d,l,u,h,p,_,g,E,b,v,I,N,L,U,w,V,z;const K=e.state;r=e.next_in,V=e.input,n=r+(e.avail_in-5),i=e.next_out,z=e.output,s=i-(t-e.avail_out),o=i+(e.avail_out-257),a=K.dmax,c=K.wsize,d=K.whave,l=K.wnext,u=K.window,h=K.hold,p=K.bits,_=K.lencode,g=K.distcode,E=(1<<K.lenbits)-1,b=(1<<K.distbits)-1;e:do{p<15&&(h+=V[r++]<<p,p+=8,h+=V[r++]<<p,p+=8),v=_[h&E];t:for(;;){if(I=v>>>24,h>>>=I,p-=I,I=v>>>16&255,I===0)z[i++]=65535&v;else{if(!(16&I)){if(!(64&I)){v=_[(65535&v)+(h&(1<<I)-1)];continue t}if(32&I){K.mode=16191;break e}e.msg="invalid literal/length code",K.mode=My;break e}N=65535&v,I&=15,I&&(p<I&&(h+=V[r++]<<p,p+=8),N+=h&(1<<I)-1,h>>>=I,p-=I),p<15&&(h+=V[r++]<<p,p+=8,h+=V[r++]<<p,p+=8),v=g[h&b];r:for(;;){if(I=v>>>24,h>>>=I,p-=I,I=v>>>16&255,!(16&I)){if(!(64&I)){v=g[(65535&v)+(h&(1<<I)-1)];continue r}e.msg="invalid distance code",K.mode=My;break e}if(L=65535&v,I&=15,p<I&&(h+=V[r++]<<p,p+=8,p<I&&(h+=V[r++]<<p,p+=8)),L+=h&(1<<I)-1,L>a){e.msg="invalid distance too far back",K.mode=My;break e}if(h>>>=I,p-=I,I=i-s,L>I){if(I=L-I,I>d&&K.sane){e.msg="invalid distance too far back",K.mode=My;break e}if(U=0,w=u,l===0){if(U+=c-I,I<N){N-=I;do z[i++]=u[U++];while(--I);U=i-L,w=z}}else if(l<I){if(U+=c+l-I,I-=l,I<N){N-=I;do z[i++]=u[U++];while(--I);if(U=0,l<N){I=l,N-=I;do z[i++]=u[U++];while(--I);U=i-L,w=z}}}else if(U+=l-I,I<N){N-=I;do z[i++]=u[U++];while(--I);U=i-L,w=z}for(;N>2;)z[i++]=w[U++],z[i++]=w[U++],z[i++]=w[U++],N-=3;N&&(z[i++]=w[U++],N>1&&(z[i++]=w[U++]))}else{U=i-L;do z[i++]=z[U++],z[i++]=z[U++],z[i++]=z[U++],N-=3;while(N>2);N&&(z[i++]=z[U++],N>1&&(z[i++]=z[U++]))}break}}break}}while(r<n&&i<o);N=p>>3,r-=N,p-=N<<3,h&=(1<<p)-1,e.next_in=r,e.next_out=i,e.avail_in=r<n?n-r+5:5-(r-n),e.avail_out=i<o?o-i+257:257-(i-o),K.hold=h,K.bits=p};const Uy=15,Xxe=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Qxe=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Zxe=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),eMe=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var m_=(e,t,r,n,i,s,o,a)=>{const c=a.bits;let d,l,u,h,p,_,g=0,E=0,b=0,v=0,I=0,N=0,L=0,U=0,w=0,V=0,z=null;const K=new Uint16Array(16),H=new Uint16Array(16);let A,m,S,T=null;for(g=0;g<=Uy;g++)K[g]=0;for(E=0;E<n;E++)K[t[r+E]]++;for(I=c,v=Uy;v>=1&&K[v]===0;v--);if(I>v&&(I=v),v===0)return i[s++]=20971520,i[s++]=20971520,a.bits=1,0;for(b=1;b<v&&K[b]===0;b++);for(I<b&&(I=b),U=1,g=1;g<=Uy;g++)if(U<<=1,U-=K[g],U<0)return-1;if(U>0&&(e===0||v!==1))return-1;for(H[1]=0,g=1;g<Uy;g++)H[g+1]=H[g]+K[g];for(E=0;E<n;E++)t[r+E]!==0&&(o[H[t[r+E]]++]=E);if(e===0?(z=T=o,_=20):e===1?(z=Xxe,T=Qxe,_=257):(z=Zxe,T=eMe,_=0),V=0,E=0,g=b,p=s,N=I,L=0,u=-1,w=1<<I,h=w-1,e===1&&w>852||e===2&&w>592)return 1;for(;;){A=g-L,o[E]+1<_?(m=0,S=o[E]):o[E]>=_?(m=T[o[E]-_],S=z[o[E]-_]):(m=96,S=0),d=1<<g-L,l=1<<N,b=l;do l-=d,i[p+(V>>L)+l]=A<<24|m<<16|S|0;while(l!==0);for(d=1<<g-1;V&d;)d>>=1;if(d!==0?(V&=d-1,V+=d):V=0,E++,--K[g]==0){if(g===v)break;g=t[r+o[E]]}if(g>I&&(V&h)!==u){for(L===0&&(L=I),p+=b,N=g-L,U=1<<N;N+L<v&&(U-=K[N+L],!(U<=0));)N++,U<<=1;if(w+=1<<N,e===1&&w>852||e===2&&w>592)return 1;u=V&h,i[u]=I<<24|N<<16|p-s|0}}return V!==0&&(i[p+V]=g-L<<24|64<<16|0),a.bits=I,0};const{Z_FINISH:mB,Z_BLOCK:tMe,Z_TREES:jy,Z_OK:sf,Z_STREAM_END:rMe,Z_NEED_DICT:nMe,Z_STREAM_ERROR:Ca,Z_DATA_ERROR:UX,Z_MEM_ERROR:jX,Z_BUF_ERROR:iMe,Z_DEFLATED:gB}=k0,_T=16180,kS=16190,Yd=16191,aI=16192,cI=16194,Fy=16199,By=16200,dI=16206,gn=16209,_B=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function sMe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const of=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<_T||t.mode>16211?1:0},FX=e=>{if(of(e))return Ca;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=_T,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,sf},BX=e=>{if(of(e))return Ca;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,FX(e)},VX=(e,t)=>{let r;if(of(e))return Ca;const n=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Ca:(n.window!==null&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,BX(e))},EB=(e,t)=>{if(!e)return Ca;const r=new sMe;e.state=r,r.strm=e,r.window=null,r.mode=_T;const n=VX(e,t);return n!==sf&&(e.state=null),n};let lI,uI,vB=!0;const oMe=e=>{if(vB){lI=new Int32Array(512),uI=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(m_(1,e.lens,0,288,lI,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;m_(2,e.lens,0,32,uI,0,e.work,{bits:5}),vB=!1}e.lencode=lI,e.lenbits=9,e.distcode=uI,e.distbits=5},$X=(e,t,r,n)=>{let i;const s=e.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(t.subarray(r-s.wsize,r),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>n&&(i=n),s.window.set(t.subarray(r-n,r-n+i),s.wnext),(n-=i)?(s.window.set(t.subarray(r-n,r),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0};var aMe=(e,t)=>{let r,n,i,s,o,a,c,d,l,u,h,p,_,g,E,b,v,I,N,L,U,w,V=0;const z=new Uint8Array(4);let K,H;const A=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(of(e)||!e.output||!e.input&&e.avail_in!==0)return Ca;r=e.state,r.mode===Yd&&(r.mode=aI),o=e.next_out,i=e.output,c=e.avail_out,s=e.next_in,n=e.input,a=e.avail_in,d=r.hold,l=r.bits,u=a,h=c,w=sf;e:for(;;)switch(r.mode){case _T:if(r.wrap===0){r.mode=aI;break}for(;l<16;){if(a===0)break e;a--,d+=n[s++]<<l,l+=8}if(2&r.wrap&&d===35615){r.wbits===0&&(r.wbits=15),r.check=0,z[0]=255&d,z[1]=d>>>8&255,r.check=wi(r.check,z,2,0),d=0,l=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",r.mode=gn;break}if((15&d)!==gB){e.msg="unknown compression method",r.mode=gn;break}if(d>>>=4,l-=4,U=8+(15&d),r.wbits===0&&(r.wbits=U),U>15||U>r.wbits){e.msg="invalid window size",r.mode=gn;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&d?16189:Yd,d=0,l=0;break;case 16181:for(;l<16;){if(a===0)break e;a--,d+=n[s++]<<l,l+=8}if(r.flags=d,(255&ai(r))!==gB){e.msg="unknown compression method",r.mode=gn;break}if(57344&ai(r)){e.msg="unknown header flags set",r.mode=gn;break}r.head&&(r.head.text=d>>8&1),512&ai(r)&&4&r.wrap&&(z[0]=255&d,z[1]=d>>>8&255,r.check=wi(r.check,z,2,0)),d=0,l=0,r.mode=16182;case 16182:for(;l<32;){if(a===0)break e;a--,d+=n[s++]<<l,l+=8}r.head&&(r.head.time=d),512&ai(r)&&4&r.wrap&&(z[0]=255&d,z[1]=d>>>8&255,z[2]=d>>>16&255,z[3]=d>>>24&255,r.check=wi(r.check,z,4,0)),d=0,l=0,r.mode=16183;case 16183:for(;l<16;){if(a===0)break e;a--,d+=n[s++]<<l,l+=8}r.head&&(r.head.xflags=255&d,r.head.os=d>>8),512&ai(r)&&4&r.wrap&&(z[0]=255&d,z[1]=d>>>8&255,r.check=wi(r.check,z,2,0)),d=0,l=0,r.mode=16184;case 16184:if(1024&ai(r)){for(;l<16;){if(a===0)break e;a--,d+=n[s++]<<l,l+=8}r.length=d,r.head&&(r.head.extra_len=d),512&ai(r)&&4&r.wrap&&(z[0]=255&d,z[1]=d>>>8&255,r.check=wi(r.check,z,2,0)),d=0,l=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&ai(r)&&(p=r.length,p>a&&(p=a),p&&(r.head&&(U=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(s,s+p),U)),512&ai(r)&&4&r.wrap&&(r.check=wi(r.check,n,p,s)),a-=p,s+=p,r.length-=p),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&ai(r)){if(a===0)break e;p=0;do U=n[s+p++],r.head&&U&&r.length<65536&&(r.head.name+=String.fromCharCode(U));while(U&&p<a);if(512&ai(r)&&4&r.wrap&&(r.check=wi(r.check,n,p,s)),a-=p,s+=p,U)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&ai(r)){if(a===0)break e;p=0;do U=n[s+p++],r.head&&U&&r.length<65536&&(r.head.comment+=String.fromCharCode(U));while(U&&p<a);if(512&ai(r)&&4&r.wrap&&(r.check=wi(r.check,n,p,s)),a-=p,s+=p,U)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&ai(r)){for(;l<16;){if(a===0)break e;a--,d+=n[s++]<<l,l+=8}if(4&r.wrap&&d!==(65535&r.check)){e.msg="header crc mismatch",r.mode=gn;break}d=0,l=0}r.head&&(r.head.hcrc=ai(r)>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=Yd;break;case 16189:for(;l<32;){if(a===0)break e;a--,d+=n[s++]<<l,l+=8}e.adler=r.check=_B(d),d=0,l=0,r.mode=kS;case kS:if(r.havedict===0)return e.next_out=o,e.avail_out=c,e.next_in=s,e.avail_in=a,r.hold=d,r.bits=l,nMe;e.adler=r.check=1,r.mode=Yd;case Yd:if(t===tMe||t===jy)break e;case aI:if(r.last){d>>>=7&l,l-=7&l,r.mode=dI;break}for(;l<3;){if(a===0)break e;a--,d+=n[s++]<<l,l+=8}switch(r.last=1&d,d>>>=1,l-=1,3&d){case 0:r.mode=16193;break;case 1:if(oMe(r),r.mode=Fy,t===jy){d>>>=2,l-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=gn}d>>>=2,l-=2;break;case 16193:for(d>>>=7&l,l-=7&l;l<32;){if(a===0)break e;a--,d+=n[s++]<<l,l+=8}if((65535&d)!=(d>>>16^65535)){e.msg="invalid stored block lengths",r.mode=gn;break}if(r.length=65535&d,d=0,l=0,r.mode=cI,t===jy)break e;case cI:r.mode=16195;case 16195:if(p=r.length,p){if(p>a&&(p=a),p>c&&(p=c),p===0)break e;i.set(n.subarray(s,s+p),o),a-=p,s+=p,c-=p,o+=p,r.length-=p;break}r.mode=Yd;break;case 16196:for(;l<14;){if(a===0)break e;a--,d+=n[s++]<<l,l+=8}if(r.nlen=257+(31&d),d>>>=5,l-=5,r.ndist=1+(31&d),d>>>=5,l-=5,r.ncode=4+(15&d),d>>>=4,l-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=gn;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;l<3;){if(a===0)break e;a--,d+=n[s++]<<l,l+=8}r.lens[A[r.have++]]=7&d,d>>>=3,l-=3}for(;r.have<19;)r.lens[A[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,K={bits:r.lenbits},w=m_(0,r.lens,0,19,r.lencode,0,r.work,K),r.lenbits=K.bits,w){e.msg="invalid code lengths set",r.mode=gn;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;V=r.lencode[d&(1<<r.lenbits)-1],E=V>>>24,b=V>>>16&255,v=65535&V,!(E<=l);){if(a===0)break e;a--,d+=n[s++]<<l,l+=8}if(v<16)d>>>=E,l-=E,r.lens[r.have++]=v;else{if(v===16){for(H=E+2;l<H;){if(a===0)break e;a--,d+=n[s++]<<l,l+=8}if(d>>>=E,l-=E,r.have===0){e.msg="invalid bit length repeat",r.mode=gn;break}U=r.lens[r.have-1],p=3+(3&d),d>>>=2,l-=2}else if(v===17){for(H=E+3;l<H;){if(a===0)break e;a--,d+=n[s++]<<l,l+=8}d>>>=E,l-=E,U=0,p=3+(7&d),d>>>=3,l-=3}else{for(H=E+7;l<H;){if(a===0)break e;a--,d+=n[s++]<<l,l+=8}d>>>=E,l-=E,U=0,p=11+(127&d),d>>>=7,l-=7}if(r.have+p>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=gn;break}for(;p--;)r.lens[r.have++]=U}}if(r.mode===gn)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=gn;break}if(r.lenbits=9,K={bits:r.lenbits},w=m_(1,r.lens,0,r.nlen,r.lencode,0,r.work,K),r.lenbits=K.bits,w){e.msg="invalid literal/lengths set",r.mode=gn;break}if(r.distbits=6,r.distcode=r.distdyn,K={bits:r.distbits},w=m_(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,K),r.distbits=K.bits,w){e.msg="invalid distances set",r.mode=gn;break}if(r.mode=Fy,t===jy)break e;case Fy:r.mode=By;case By:if(a>=6&&c>=258){e.next_out=o,e.avail_out=c,e.next_in=s,e.avail_in=a,r.hold=d,r.bits=l,Jxe(e,h),o=e.next_out,i=e.output,c=e.avail_out,s=e.next_in,n=e.input,a=e.avail_in,d=r.hold,l=r.bits,r.mode===Yd&&(r.back=-1);break}for(r.back=0;V=r.lencode[d&(1<<r.lenbits)-1],E=V>>>24,b=V>>>16&255,v=65535&V,!(E<=l);){if(a===0)break e;a--,d+=n[s++]<<l,l+=8}if(b&&!(240&b)){for(I=E,N=b,L=v;V=r.lencode[L+((d&(1<<I+N)-1)>>I)],E=V>>>24,b=V>>>16&255,v=65535&V,!(I+E<=l);){if(a===0)break e;a--,d+=n[s++]<<l,l+=8}d>>>=I,l-=I,r.back+=I}if(d>>>=E,l-=E,r.back+=E,r.length=v,b===0){r.mode=16205;break}if(32&b){r.back=-1,r.mode=Yd;break}if(64&b){e.msg="invalid literal/length code",r.mode=gn;break}r.extra=15&b,r.mode=16201;case 16201:if(r.extra){for(H=r.extra;l<H;){if(a===0)break e;a--,d+=n[s++]<<l,l+=8}r.length+=d&(1<<r.extra)-1,d>>>=r.extra,l-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;V=r.distcode[d&(1<<r.distbits)-1],E=V>>>24,b=V>>>16&255,v=65535&V,!(E<=l);){if(a===0)break e;a--,d+=n[s++]<<l,l+=8}if(!(240&b)){for(I=E,N=b,L=v;V=r.distcode[L+((d&(1<<I+N)-1)>>I)],E=V>>>24,b=V>>>16&255,v=65535&V,!(I+E<=l);){if(a===0)break e;a--,d+=n[s++]<<l,l+=8}d>>>=I,l-=I,r.back+=I}if(d>>>=E,l-=E,r.back+=E,64&b){e.msg="invalid distance code",r.mode=gn;break}r.offset=v,r.extra=15&b,r.mode=16203;case 16203:if(r.extra){for(H=r.extra;l<H;){if(a===0)break e;a--,d+=n[s++]<<l,l+=8}r.offset+=d&(1<<r.extra)-1,d>>>=r.extra,l-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=gn;break}r.mode=16204;case 16204:if(c===0)break e;if(p=h-c,r.offset>p){if(p=r.offset-p,p>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=gn;break}p>r.wnext?(p-=r.wnext,_=r.wsize-p):_=r.wnext-p,p>r.length&&(p=r.length),g=r.window}else g=i,_=o-r.offset,p=r.length;p>c&&(p=c),c-=p,r.length-=p;do i[o++]=g[_++];while(--p);r.length===0&&(r.mode=By);break;case 16205:if(c===0)break e;i[o++]=r.length,c--,r.mode=By;break;case dI:if(r.wrap){for(;l<32;){if(a===0)break e;a--,d|=n[s++]<<l,l+=8}if(h-=c,e.total_out+=h,r.total+=h,4&r.wrap&&h&&(e.adler=r.check=ai(r)?wi(r.check,i,h,o-h):CE(r.check,i,h,o-h)),h=c,4&r.wrap&&(ai(r)?d:_B(d))!==r.check){e.msg="incorrect data check",r.mode=gn;break}d=0,l=0}r.mode=16207;case 16207:if(r.wrap&&ai(r)){for(;l<32;){if(a===0)break e;a--,d+=n[s++]<<l,l+=8}if(4&r.wrap&&d!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=gn;break}d=0,l=0}r.mode=16208;case 16208:w=rMe;break e;case gn:w=UX;break e;case 16210:return jX;default:return Ca}return e.next_out=o,e.avail_out=c,e.next_in=s,e.avail_in=a,r.hold=d,r.bits=l,(r.wsize||h!==e.avail_out&&r.mode<gn&&(r.mode<dI||t!==mB))&&$X(e,e.output,e.next_out,h-e.avail_out),u-=e.avail_in,h-=e.avail_out,e.total_in+=u,e.total_out+=h,r.total+=h,4&r.wrap&&h&&(e.adler=r.check=ai(r)?wi(r.check,i,h,e.next_out-h):CE(r.check,i,h,e.next_out-h)),e.data_type=r.bits+(r.last?64:0)+(r.mode===Yd?128:0)+(r.mode===Fy||r.mode===cI?256:0),(u===0&&h===0||t===mB)&&w===sf&&(w=iMe),w},ol={inflateReset:BX,inflateReset2:VX,inflateResetKeep:FX,inflateInit:e=>EB(e,15),inflateInit2:EB,inflate:aMe,inflateEnd:e=>{if(of(e))return Ca;let t=e.state;return t.window&&(t.window=null),e.state=null,sf},inflateGetHeader:(e,t)=>{if(of(e))return Ca;const r=e.state;return 2&r.wrap?(r.head=t,t.done=!1,sf):Ca},inflateSetDictionary:(e,t)=>{const r=t.length;let n,i,s;return of(e)?Ca:(n=e.state,n.wrap!==0&&n.mode!==kS?Ca:n.mode===kS&&(i=1,i=CE(i,t,r,0),i!==n.check)?UX:(s=$X(e,t,r,r),s?(n.mode=16210,jX):(n.havedict=1,sf)))},inflateInfo:"pako inflate (from Nodeca project)"},cMe=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const HX=Object.prototype.toString,{Z_NO_FLUSH:dMe,Z_FINISH:lMe,Z_OK:g_,Z_STREAM_END:hI,Z_NEED_DICT:fI,Z_STREAM_ERROR:uMe,Z_DATA_ERROR:yB,Z_MEM_ERROR:hMe}=k0;function __(e){this.options=gT.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new xX,this.strm.avail_out=0;let r=ol.inflateInit2(this.strm,t.windowBits);if(r!==g_)throw new Error(Tf[r]);if(this.header=new cMe,ol.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=NE.string2buf(t.dictionary):HX.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=ol.inflateSetDictionary(this.strm,t.dictionary),r!==g_)))throw new Error(Tf[r])}function pI(e,t){const r=new __(t);if(r.push(e),r.err)throw r.msg||Tf[r.err];return r.result}__.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize,i=this.options.dictionary;let s,o,a;if(this.ended)return!1;for(o=t===~~t?t:t===!0?lMe:dMe,HX.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),s=ol.inflate(r,o),s===fI&&i&&(s=ol.inflateSetDictionary(r,i),s===g_?s=ol.inflate(r,o):s===yB&&(s=fI));r.avail_in>0&&s===hI&&r.state.wrap>0&&e[r.next_in]!==0;)ol.inflateReset(r),s=ol.inflate(r,o);switch(s){case uMe:case yB:case fI:case hMe:return this.onEnd(s),this.ended=!0,!1}if(a=r.avail_out,r.next_out&&(r.avail_out===0||s===hI))if(this.options.to==="string"){let c=NE.utf8border(r.output,r.next_out),d=r.next_out-c,l=NE.buf2string(r.output,c);r.next_out=d,r.avail_out=n-d,d&&r.output.set(r.output.subarray(c,c+d),0),this.onData(l)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(s!==g_||a!==0){if(s===hI)return s=ol.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(r.avail_in===0)break}}return!0},__.prototype.onData=function(e){this.chunks.push(e)},__.prototype.onEnd=function(e){e===g_&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=gT.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var fMe={Inflate:__,inflate:pI,inflateRaw:function(e,t){return(t=t||{}).raw=!0,pI(e,t)},ungzip:pI,constants:k0};const{Deflate:s4e,deflate:pMe,deflateRaw:o4e,gzip:a4e}=Yxe,{Inflate:c4e,inflate:mMe,inflateRaw:d4e,ungzip:l4e}=fMe;var gMe=pMe,_Me=mMe,zX=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(zX||{});class EMe{constructor(){j(this,"_sequence",0),j(this,"_startTime",Date.now()),j(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const r={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const a=new Uint8Array(4);a.set([1,0,0,0]);const c={id:0,length:4,data:a.buffer},d={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[c]};r.commonPacketHeader.extension=1,r.extension=d,r.payload=this.compress(t),r.commonPacketHeader.length=8+(r.extension.length+2)+r.payload.byteLength}else r.commonPacketHeader.length=8+r.payload.byteLength;W("SHOW_DATASTREAM2_LOG")&&C.debug("send data header: ".concat(JSON.stringify(r.commonPacketHeader)));const n=new ArrayBuffer(r.commonPacketHeader.length),i=new Uint8Array(n),s=new DataView(n);let o=0;if(s.setUint16(o,r.commonPacketHeader.extension<<15|r.commonPacketHeader.reserved<<14|r.commonPacketHeader.length,!0),o+=2,s.setUint32(o,r.commonPacketHeader.sequence,!0),o+=4,s.setUint16(o,r.commonStreamHeader,!0),o+=2,r.extension){const a=this.serializeExtension(r.extension);i.set(new Uint8Array(a),o),o+=a.byteLength}if(i.set(new Uint8Array(r.payload),o),o+=r.payload.byteLength,o!==r.commonPacketHeader.length)throw Error("serialize error!");return n}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const r=new DataView(t);let n=0;const i=r.getUint16(n,!0);n+=2;const s={length:16383&i,reserved:(16384&i)>>14,extension:(32768&i)>>15,sequence:r.getUint16(n+2,!0)<<16|r.getUint16(n,!0)};let o,a;if(n+=4,W("SHOW_DATASTREAM2_LOG")&&C.debug("receive data header: ".concat(JSON.stringify(s))),r.getUint16(n,!0),n+=2,s.extension){a=this.deserializeExtension(t.slice(n)),n+=2+a.length,o=t.slice(n);let c=!1;if(a.datas.length>0){const d=a.datas.find(l=>l.id===0);d&&(c=(1&new DataView(d.data).getUint32(0,!0))==1)}o=c?this.decompress(o):o}else o=t.slice(8);return o}serializeExtension(t){const{profile:r,length:n,datas:i}=t,s=new ArrayBuffer(n+2),o=new Uint8Array(s),a=new DataView(s);let c=0;if(a.setUint8(c++,r),a.setUint8(c++,n),i.forEach(d=>{r?(a.setUint8(c++,d.id),a.setUint8(c++,d.length),o.set(new Uint8Array(d.data),c),c+=d.data.byteLength):(a.setUint8(c++,d.id|d.length<<4),o.set(new Uint8Array(d.data),c),c+=d.data.byteLength)}),c!==n+2)throw Error("serialize extension error, is ".concat(c,"!==").concat(n+2));return s}deserializeExtension(t){const r=new DataView(t);let n=0;const i=r.getUint8(n);n++;const s=r.getUint8(n);n++;const o=i===zX.TWO_BYTE,a=[],c=new DataView(t,2);let d=0;for(;d<s;){let l=0,u=0,h=new ArrayBuffer(0);o?(l=c.getUint8(d),d++,u=c.getUint8(d),d++):(l=15&c.getUint8(d),u=c.getUint8(d)>>4,d++),u>0&&(h=c.buffer.slice(d+2,d+2+u),d+=h.byteLength),a.push({id:l,length:u,data:h})}if(d!==s)throw Error("parse error");return{profile:i,length:s,datas:a}}decompress(t){return _Me(new Uint8Array(t))}compress(t){return gMe(new Uint8Array(t))}}const vMe={name:"DataStream",create:(e,t)=>{const r=t?new uLe(e):new hLe(e);return r.useDataStream(new EMe),r}};class yMe extends Cr{constructor(t,r,n){super(),j(this,"ws",void 0),j(this,"requestId",1),j(this,"heartBeatTimer",void 0),j(this,"joinInfo",void 0),j(this,"clientId",void 0),j(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),j(this,"onClose",i=>{this.emit("close"),this.dispose()}),j(this,"onMessage",i=>{const s=JSON.parse(i.data);if(!s||s.command!=="serverResponse"||!s.requestId)return s&&s.command==="serverStatus"&&s.serverStatus&&s.serverStatus.command?(this.emit("status",s.serverStatus),void this.emit(s.serverStatus.command,s.serverStatus)):void 0;this.emit("req_".concat(s.requestId),s)}),this.joinInfo=t,this.clientId=r,this.ws=new mE("cross-channel-".concat(this.clientId),n),this.ws.on(We.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(We.CONNECTED,this.onOpen),this.ws.on(We.ON_MESSAGE,this.onMessage),this.ws.on(We.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const r=this.requestId++;return t.requestId=r,t.seq=r,this.ws.sendMessage(t),r}waitStatus(t){return new _e((r,n)=>{const i=window.setTimeout(()=>{n(new ee($.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,s=>{window.clearTimeout(i),s.state&&s.state!==0?n(new ee($.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):r(void 0)}),this.once("dispose",()=>{window.clearTimeout(i),n(new ee($.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new ee($.WS_DISCONNECT);const r=()=>new _e((o,a)=>{this.ws.once(We.CLOSED,()=>a(new ee($.WS_ABORT))),this.ws.once(We.CONNECTED,o)});this.ws.state!=="connected"&&await r();const n=this.sendMessage(t),i=new _e((o,a)=>{const c=()=>{a(new ee($.WS_ABORT))};this.ws.once(We.RECONNECTING,c),this.ws.once(We.CLOSED,c),this.once("req_".concat(n),o),In(3e3).then(()=>{this.removeAllListeners("req_".concat(n)),this.ws.off(We.RECONNECTING,c),this.ws.off(We.CLOSED,c),a(new ee($.TIMEOUT,"cross channel ws request timeout"))})}),s=await i;if(!s||s.code!==200)throw new ee($.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(s)));return s}async connect(t){this.ws.removeAllListeners(We.REQUEST_NEW_URLS),this.ws.on(We.REQUEST_NEW_URLS,r=>{r(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const r=this.requestId++;return t.requestId=r,this.ws.sendMessage(t),r}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class bMe extends Cr{set state(t){t!==this._state&&(t!==is.RELAY_STATE_FAILURE&&(this.errorCode=bp.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,r,n,i,s){super(),j(this,"joinInfo",void 0),j(this,"sid",void 0),j(this,"clientId",void 0),j(this,"cancelToken",Hi.CancelToken.source()),j(this,"workerToken",void 0),j(this,"requestId",0),j(this,"signal",void 0),j(this,"prevChannelMediaConfig",void 0),j(this,"httpRetryConfig",void 0),j(this,"_resolution",void 0),j(this,"_state",is.RELAY_STATE_IDLE),j(this,"errorCode",bp.RELAY_OK),j(this,"onStatus",o=>{C.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(o))),o&&o.command&&(o.command==="onAudioPacketReceived"&&this.emit("event",Jd.PACKET_RECEIVED_AUDIO_FROM_SRC),o.command==="onVideoPacketReceived"&&this.emit("event",Jd.PACKET_RECEIVED_VIDEO_FROM_SRC),o.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=bp.SRC_TOKEN_EXPIRED,this.state=is.RELAY_STATE_FAILURE),o.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=bp.DEST_TOKEN_EXPIRED,this.state=is.RELAY_STATE_FAILURE))}),j(this,"onReconnect",async()=>{C.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Jd.NETWORK_DISCONNECTED),this.state=is.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(o=>{this.state!==is.RELAY_STATE_IDLE&&(C.error("auto restart channel media relay failed",o.toString()),this.errorCode=bp.SERVER_CONNECTION_LOST,this.state=is.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=r,this.sid=qp(),this.signal=new yMe(this.joinInfo,this.clientId,n),this.httpRetryConfig=i,this._resolution=s}async startChannelMediaRelay(t){if(this.state!==is.RELAY_STATE_IDLE)throw new ee($.INVALID_OPERATION);this.state=is.RELAY_STATE_CONNECTING,await this.connect(),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(r){throw r.data&&r.data.serverResponse&&r.data.serverResponse.command==="SetSourceChannel"?new ee($.CROSS_CHANNEL_FAILED_JOIN_SRC):r.data&&r.data.serverResponse&&r.serverResponse.command==="SetDestChannelStatus"?new ee($.CROSS_CHANNEL_FAILED_JOIN_DEST):r.data&&r.data.serverResponse&&r.serverResponse.command==="StartPacketTransfer"?new ee($.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):r}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==is.RELAY_STATE_RUNNING)throw new ee($.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==is.RELAY_STATE_RUNNING)throw new ee($.INVALID_OPERATION);const r=this.genMessage(bi.SetVideoProfile);await this.signal.request(r),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),C.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=is.RELAY_STATE_IDLE,this.dispose()}dispose(){C.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Hi.CancelToken.source(),this.state=is.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await wLe(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",Jd.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const r=this.genMessage(bi.StopPacketTransfer);await this.signal.request(r),await this.signal.waitStatus("Normal Quit"),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const n=this.genMessage(bi.SetSdkProfile,t);await this.signal.request(n),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const i=this.genMessage(bi.SetSourceChannel,t);await this.signal.request(i),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Jd.PACKET_JOINED_SRC_CHANNEL),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const s=this.genMessage(bi.SetSourceUserId,t);await this.signal.request(s),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const o=this.genMessage(bi.SetDestChannel,t);await this.signal.request(o),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Jd.PACKET_JOINED_DEST_CHANNEL),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const a=this.genMessage(bi.StartPacketTransfer,t);await this.signal.request(a),this.emit("event",Jd.PACKET_SENT_TO_DEST_CHANNEL),this.state=is.RELAY_STATE_RUNNING,C.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const r=this.genMessage(bi.UpdateDestChannel,t);await this.signal.request(r),this.emit("event",Jd.PACKET_UPDATE_DEST_CHANNEL),C.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(bi.StopPacketTransfer);await this.signal.request(t),C.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,r){const n=[],i=[],s=[];this.requestId+=1;const o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:xo,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};o.sdkVersion==="4.22.1"&&(o.sdkVersion="0.0.1");let a=null,c=null;switch(t){case bi.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case bi.SetSourceChannel:if(c=r&&r.getSrcChannelMediaInfo(),!c)throw new ee($.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:c.channelName,token:c.token||this.joinInfo.appId},o;case bi.SetSourceUserId:if(c=r&&r.getSrcChannelMediaInfo(),!c)throw new ee($.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:c.uid+""},o;case bi.SetDestChannel:if(a=r&&r.getDestChannelMediaInfo(),!a)throw new ee($.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(d=>{n.push(d.channelName),i.push(d.uid+""),s.push(d.token||this.joinInfo.appId)}),o.clientRequest={command:"SetDestChannel",channelName:n,uid:i,token:s},o;case bi.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case bi.Reconnect:return o.clientRequest={command:"Reconnect"},o;case bi.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case bi.UpdateDestChannel:if(a=r&&r.getDestChannelMediaInfo(),!a)throw new ee($.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(d=>{n.push(d.channelName),i.push(d.uid+""),s.push(d.token||this.joinInfo.appId)}),o.clientRequest={command:"UpdateDestChannel",channelName:n,uid:i,token:s},o;case bi.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o}}const SMe={name:"ChannelMediaRelay",create:function(e){return new bMe(e.joinInfo,e.clientId,e.websocketRetryConfig||Kr,e.httpRetryConfig||Kr,e.resolution)}};function bB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function bg(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?bB(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bB(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}class wMe extends Cr{constructor(t,r,n,i){super(),j(this,"spec",void 0),j(this,"token",void 0),j(this,"websocket",void 0),j(this,"pingpongTimer",void 0),j(this,"reconnectMode","retry"),j(this,"serviceMode",void 0),j(this,"reqId",0),j(this,"commandReqId",0),j(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),j(this,"handleWebSocketMessage",s=>{if(!s.data)return;const o=JSON.parse(s.data);o.requestId?this.emit("@".concat(o.requestId,"-").concat(o.sid),o):(Ce.workerEvent(this.spec.sid,{actionType:"status",serverCode:o.code,workerType:this.serviceMode===pl.TRANSCODE?1:2}),this.emit(ou.PUBLISH_STREAM_STATUS,o))}),this.spec=r,this.token=t,this.serviceMode=i,this.websocket=new mE("live-streaming",n),this.websocket.on(We.CONNECTED,this.handleWebSocketOpen),this.websocket.on(We.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(We.REQUEST_NEW_URLS,(s,o)=>{Vn(this,ou.REQUEST_NEW_ADDRESS).then(s).catch(o)}),this.websocket.on(We.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,r,n,i){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const s=this.commandReqId,o=this.reqId;if(!o||!this.websocket)throw new ee($.UNEXPECTED_ERROR);const a=bg({command:t,sdkVersion:xo==="4.22.1"?"0.0.1":xo,seq:o,requestId:o,allocate:n,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},r);if(this.websocket.state==="closed")throw new ee($.WS_DISCONNECT);const c=()=>new _e((h,p)=>{this.websocket.once(We.CLOSED,()=>p(new ee($.WS_ABORT))),this.websocket.once(We.CONNECTED,h)});this.websocket.state!=="connected"&&await c(),a.clientRequest&&(a.clientRequest.workerToken=this.token);const d=new _e((h,p)=>{const _=()=>{p(new ee($.WS_ABORT))};this.websocket.once(We.RECONNECTING,_),this.websocket.once(We.CLOSED,_),this.once("@".concat(o,"-").concat(this.spec.sid),g=>{h(g)})});i&&Ce.workerEvent(this.spec.sid,bg(bg({},i),{},{requestId:s,actionType:"request",payload:JSON.stringify(r.clientRequest),serverCode:0,code:0}));const l=Date.now();this.websocket.sendMessage(a);let u=null;try{u=await d}catch(h){if(this.websocket.state==="closed")throw h;return await c(),await this.request(t,r,n)}return i&&Ce.workerEvent(this.spec.sid,bg(bg({},i),{},{requestId:s,actionType:"response",payload:JSON.stringify(u.serverResponse),serverCode:u.code,success:u.code===200,responseTime:Date.now()-l})),u.code!==200&&this.handleResponseError(u),u}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=xo==="4.22.1"?"0.0.1":xo;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Xr.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void C.warning("live stream response already exists stream");case Xr.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Xr.LIVE_STREAM_RESPONSE_BAD_STREAM:case Xr.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new ee($.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Xr.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new ee($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Xr.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new ee($.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Xr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const r=new ee($.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(ou.WARNING,r,t.serverResponse.url)}case Xr.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const r=new ee($.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(ou.WARNING,r,t.serverResponse.url)}case Xr.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new ee($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Xr.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new ee($.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Xr.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const r=new ee($.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(ou.WARNING,r,t.serverResponse.url)}case Xr.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new ee($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Xr.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new ee($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Xr.LIVE_STREAM_RESPONSE_WORKER_LOST:case Xr.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new ee($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Xr.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new ee($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new ee($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Xr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Xr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Xr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Xr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new ee($.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(dT)},6e3)}}function SB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function es(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?SB(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):SB(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}class TMe extends Cr{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Kr,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Kr;super(),j(this,"onLiveStreamWarning",void 0),j(this,"onLiveStreamError",void 0),j(this,"spec",void 0),j(this,"retryTimeout",1e4),j(this,"connection",void 0),j(this,"httpRetryConfig",void 0),j(this,"wsRetryConfig",void 0),j(this,"streamingTasks",new Map),j(this,"isStartingStreamingTask",!1),j(this,"taskMutex",new Jn("live-streaming")),j(this,"cancelToken",Hi.CancelToken.source()),j(this,"transcodingConfig",void 0),j(this,"uapResponse",void 0),j(this,"lastTaskId",1),j(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=n,this.wsRetryConfig=r}async setTranscodingConfig(t){const r=es(es({},O3e),t);r.videoCodecProfile!==66&&r.videoCodecProfile!==77&&r.videoCodecProfile!==100&&(C.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(r.videoCodecProfile," -> 100")),r.videoCodecProfile=100),r.transcodingUsers||(r.transcodingUsers=r.userConfigs),r.transcodingUsers&&(r.transcodingUsers=r.transcodingUsers.map(o=>es(es(es({},I3e),o),{},{zOrder:o.zOrder?o.zOrder+1:1}))),function(o){Tr(o.width)||qt(o.width,"config.width",0,1e4),Tr(o.height)||qt(o.height,"config.height",0,1e4),Tr(o.videoBitrate)||qt(o.videoBitrate,"config.videoBitrate",1,1e6),Tr(o.videoFrameRate)||qt(o.videoFrameRate,"config.videoFrameRate"),Tr(o.lowLatency)||dl(o.lowLatency,"config.lowLatency"),Tr(o.audioSampleRate)||rn(o.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Tr(o.audioBitrate)||qt(o.audioBitrate,"config.audioBitrate",1,128),Tr(o.audioChannels)||rn(o.audioChannels,"config.audioChannels",[1,2,3,4,5]),Tr(o.videoGop)||qt(o.videoGop,"config.videoGop"),Tr(o.videoCodecProfile)||rn(o.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Tr(o.userCount)||qt(o.userCount,"config.userCount",0,17),Tr(o.backgroundColor)||qt(o.backgroundColor,"config.backgroundColor",0,16777215),Tr(o.userConfigExtraInfo)||wn(o.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),o.transcodingUsers&&!Tr(o.transcodingUsers)&&(nl(o.transcodingUsers,"config.transcodingUsers"),o.transcodingUsers.forEach((a,c)=>{hT(a.uid),Tr(a.x)||qt(a.x,"transcodingUser[".concat(c,"].x"),0,1e4),Tr(a.y)||qt(a.y,"transcodingUser[".concat(c,"].y"),0,1e4),Tr(a.width)||qt(a.width,"transcodingUser[".concat(c,"].width"),0,1e4),Tr(a.height)||qt(a.height,"transcodingUser[".concat(c,"].height"),0,1e4),Tr(a.zOrder)||qt(a.zOrder-1,"transcodingUser[".concat(c,"].zOrder"),0,100),Tr(a.alpha)||qt(a.alpha,"transcodingUser[".concat(c,"].alpha"),0,1,!1)})),Tr(o.watermark)||mC(o.watermark,"watermark"),Tr(o.backgroundImage)||mC(o.backgroundImage,"backgroundImage"),o.images&&!Tr(o.images)&&(nl(o.images,"config.images"),o.images.forEach((a,c)=>{mC(a,"images[".concat(c,"]"))}))}(r);const n=[];r.images&&n.push(...r.images.map(o=>es(es(es({},pC),o),{},{zOrder:255}))),r.backgroundImage&&(n.push(es(es(es({},pC),r.backgroundImage),{},{zOrder:0})),delete r.backgroundImage),r.watermark&&(n.push(es(es(es({},pC),r.watermark),{},{zOrder:255})),delete r.watermark),r.images=n,r.transcodingUsers&&(r.userConfigs=r.transcodingUsers.map(o=>es({},o)),r.userCount=r.transcodingUsers.length,delete r.transcodingUsers);const i=(r.userConfigs||[]).map(o=>typeof o.uid=="number"?_e.resolve(o.uid):eX(o.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await _e.all(i)).forEach((o,a)=>{r.userConfigs&&r.userConfigs[a]&&(r.userConfigs[a].uid=o)}),this.transcodingConfig=r,this.connection)try{var s;const o=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(_l(s=this.streamingTasks).call(s)).map(a=>a.taskId).join("#")});C.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(o.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(o){if(!o.data||!o.data.retry)throw o;o.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(a=>{C.warning("[".concat(this.spec.clientId,"] live streaming receive error"),o.toString(),"try to republish",a.url),this.startLiveStreamingTask(a.url,a.mode,o).then(()=>{C.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(a.url," success"))}).catch(c=>{C.error("[".concat(this.spec.clientId,"] live streaming republish failed"),a.url,c.toString()),this.onLiveStreamError&&this.onLiveStreamError(a.url,c)})})}}async startLiveStreamingTask(t,r,n){if(!this.transcodingConfig&&r===pl.TRANSCODE)throw new ee($.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const i={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};C.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(r));const s=await this.taskMutex.lock();if(!this.connection&&n)return void s();if(this.streamingTasks.get(t)&&!n)return s(),new ee($.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(r))}catch(a){throw s(),a}switch(r){case pl.TRANSCODE:i.transcodingConfig=es({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const o=this.lastTaskId++;try{const a=new _e((d,l)=>{In(this.retryTimeout).then(()=>{if(n)return l(n);const u=this.statusError.get(t);return u?(this.statusError.delete(t),l(u)):void 0})}),c=await _e.race([this.connection.request("request",{clientRequest:i},!0,{url:t,command:"PublishStream",workerType:r===pl.TRANSCODE?1:2,requestByUser:!n,tid:o.toString()}),a]);this.isStartingStreamingTask=!1,C.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(c.code)),this.streamingTasks.set(t,{clientRequest:i,mode:r,url:t,taskId:o}),s()}catch(a){if(s(),this.isStartingStreamingTask=!1,!a.data||!a.data.retry||n)throw a;return a.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,r,a)):await this.startLiveStreamingTask(t,r,a)}}stopLiveStreamingTask(t){return new _e((r,n)=>{const i=this.streamingTasks.get(t);if(!i||!this.connection)return new ee($.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const s=i.mode;i.abortTask=()=>{C.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),r()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:i.url}},!1,{url:t,command:"UnPublishStream",workerType:s===pl.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(o=>{C.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(o.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),r()}).catch(n)})}resetAllTask(){var t;const r=Array.from(_l(t=this.streamingTasks).call(t));this.terminate();for(const n of r)this.startLiveStreamingTask(n.url,n.mode).catch(i=>{this.onLiveStreamError&&this.onLiveStreamError(n.url,i)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Hi.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new ee($.UNEXPECTED_ERROR,"live streaming connection has already connected");const r=await Vn(this,uN.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=r,this.connection=new wMe(r.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(ou.WARNING,(n,i)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(i,n)),this.connection.on(ou.PUBLISH_STREAM_STATUS,n=>this.handlePublishStreamServer(n)),this.connection.on(ou.REQUEST_NEW_ADDRESS,(n,i)=>{if(!this.connection)return i(new ee($.UNEXPECTED_ERROR,"can not get new live streaming address list"));Vn(this,uN.REQUEST_WORKER_MANAGER_LIST,t).then(s=>{this.uapResponse=s,n(s.addressList)}).catch(i)}),await this.connection.init(r.addressList),this.connection}handlePublishStreamServer(t){const r=t.serverStatus&&t.serverStatus.url||"empty_url",n=this.streamingTasks.get(r),i=t.reason;switch(t.code){case Xr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Xr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Xr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Xr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const o=new ee($.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(n)return C.error(o.toString()),this.onLiveStreamError&&this.onLiveStreamError(r,o);if(!this.isStartingStreamingTask)return;this.statusError.set(r,o)}case Xr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const o=new ee($.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(r,o)}case Xr.LIVE_STREAM_RESPONSE_WORKER_LOST:case Xr.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var s;if(!this.connection)return;this.connection.tryNextAddress();const o=Array.from(_l(s=this.streamingTasks).call(s));for(const a of o)a.abortTask?a.abortTask():(C.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",a.url),this.startLiveStreamingTask(a.url,a.mode,new ee($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{C.debug("[".concat(this.spec.clientId,"] republish live stream success"),a.url)}).catch(c=>{C.error(c.toString()),this.onLiveStreamError&&this.onLiveStreamError(a.url,c)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const RMe={name:"LiveStreaming",create:function(e){return new TMe(e.joinInfo,e.websocketRetryConfig||Kr,e.httpRetryConfig||Kr)}};function AMe(e){let t=wB();return function(r,n){let i=r.appId;i!==void 0&&(Bt(n,10),zc(n,i));let s=r.cid;s!==void 0&&(Bt(n,16),Bt(n,s));let o=r.cname;o!==void 0&&(Bt(n,26),zc(n,o));let a=r.deviceId;a!==void 0&&(Bt(n,34),zc(n,a));let c=r.elapse;c!==void 0&&(Bt(n,40),Wl(n,c));let d=r.fileSize;d!==void 0&&(Bt(n,48),Wl(n,pp(d)));let l=r.height;l!==void 0&&(Bt(n,56),Wl(n,pp(l)));let u=r.jpg;u!==void 0&&(Bt(n,66),Bt(n,u.length),function(x,D){let k=L0(x,D.length);x.bytes.set(D,k)}(n,u));let h=r.networkType;h!==void 0&&(Bt(n,72),Wl(n,pp(h)));let p=r.osType;p!==void 0&&(Bt(n,80),Wl(n,pp(p)));let _=r.requestId;_!==void 0&&(Bt(n,90),zc(n,_));let g=r.sdkVersion;g!==void 0&&(Bt(n,98),zc(n,g));let E=r.sequence;E!==void 0&&(Bt(n,104),Wl(n,pp(E)));let b=r.sid;b!==void 0&&(Bt(n,114),zc(n,b));let v=r.timestamp;v!==void 0&&(Bt(n,120),Wl(n,v));let I=r.uid;I!==void 0&&(Bt(n,128),Bt(n,I));let N=r.vid;N!==void 0&&(Bt(n,136),Bt(n,N));let L=r.width;L!==void 0&&(Bt(n,144),Wl(n,pp(L)));let U=r.service;U!==void 0&&(Bt(n,152),Bt(n,U));let w=r.callbackData;w!==void 0&&(Bt(n,162),zc(n,w));let V=r.jpgEncryption;V!==void 0&&(Bt(n,168),Bt(n,V));let z=r.requestType;z!==void 0&&(Bt(n,176),Bt(n,z));let K=r.scorePorn;K!==void 0&&(Bt(n,185),_I(n,K));let H=r.scoreSexy;H!==void 0&&(Bt(n,193),_I(n,H));let A=r.scoreNeutral;A!==void 0&&(Bt(n,201),_I(n,A));let m=r.scene;m!==void 0&&(Bt(n,208),Bt(n,m));let S=r.ossFilePrefix;S!==void 0&&(Bt(n,218),zc(n,S));let T=r.serviceVendor;if(T!==void 0)for(let x of T){Bt(n,226);let D=wB();OMe(x,D),Bt(n,D.limit),kMe(n,D),PMe(D)}}(e,t),function(r){let n=r.bytes,i=r.limit;return n.length===i?n:n.subarray(0,i)}(t)}function CMe(e){return function(r){let n={};e:for(;!qX(r);){let i=Qc(r);switch(i>>>3){case 0:break e;case 1:n.code=Qc(r);break;case 2:n.msg=KX(r,Qc(r));break;case 3:{let s=NMe(r);n.data=IMe(r),r.limit=s;break}default:WX(r,7&i)}}return n}({bytes:t=e,offset:0,limit:t.length});var t}function IMe(e){let t={};e:for(;!qX(e);){let r=Qc(e);switch(r>>>3){case 0:break e;case 1:t.requestId=KX(e,Qc(e));break;case 2:t.requestType=Qc(e)>>>0;break;case 3:t.scorePorn=gI(e);break;case 4:t.scoreSexy=gI(e);break;case 5:t.scoreNeutral=gI(e);break;case 6:t.requestScene=Qc(e)>>>0;break;case 7:t.scene=Qc(e)>>>0;break;default:WX(e,7&r)}}return t}function OMe(e,t){let r=e.service;r!==void 0&&(Bt(t,8),Bt(t,r));let n=e.vendor;n!==void 0&&(Bt(t,16),Bt(t,n));let i=e.token;i!==void 0&&(Bt(t,26),zc(t,i));let s=e.callbackUrl;s!==void 0&&(Bt(t,34),zc(t,s))}function NMe(e){let t=Qc(e),r=e.limit;return e.limit=e.offset+t,r}function WX(e,t){switch(t){case 0:for(;128&YX(e););break;case 2:mI(e,Qc(e));break;case 5:mI(e,4);break;case 1:mI(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let DMe=new Float32Array(1);new Uint8Array(DMe.buffer);let G3=new Float64Array(1),as=new Uint8Array(G3.buffer);function pp(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let GX=[];function wB(){const e=GX.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function PMe(e){GX.push(e)}function mI(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function qX(e){return e.offset>=e.limit}function L0(e,t){let r=e.bytes,n=e.offset,i=e.limit,s=n+t;if(s>r.length){let o=new Uint8Array(2*s);o.set(r),e.bytes=o}return e.offset=s,s>i&&(e.limit=s),n}function q3(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function KX(e,t){let r=q3(e,t),n=String.fromCharCode,i=e.bytes,s="�",o="";for(let a=0;a<t;a++){let c,d,l,u,h=i[a+r];128&h?(224&h)==192?a+1>=t?o+=s:(c=i[a+r+1],(192&c)!=128?o+=s:(u=(31&h)<<6|63&c,u<128?o+=s:(o+=n(u),a++))):(240&h)==224?a+2>=t?o+=s:(c=i[a+r+1],d=i[a+r+2],(49344&(c|d<<8))!=32896?o+=s:(u=(15&h)<<12|(63&c)<<6|63&d,u<2048||u>=55296&&u<=57343?o+=s:(o+=n(u),a+=2))):(248&h)==240?a+3>=t?o+=s:(c=i[a+r+1],d=i[a+r+2],l=i[a+r+3],(12632256&(c|d<<8|l<<16))!=8421504?o+=s:(u=(7&h)<<18|(63&c)<<12|(63&d)<<6|63&l,u<65536||u>1114111?o+=s:(u-=65536,o+=n(55296+(u>>10),56320+(1023&u)),a+=3))):o+=s:o+=n(h)}return o}function zc(e,t){let r=t.length,n=0;for(let o=0;o<r;o++){let a=t.charCodeAt(o);a>=55296&&a<=56319&&o+1<r&&(a=(a<<10)+t.charCodeAt(++o)-56613888),n+=a<128?1:a<2048?2:a<65536?3:4}Bt(e,n);let i=L0(e,n),s=e.bytes;for(let o=0;o<r;o++){let a=t.charCodeAt(o);a>=55296&&a<=56319&&o+1<r&&(a=(a<<10)+t.charCodeAt(++o)-56613888),a<128?s[i++]=a:(a<2048?s[i++]=a>>6&31|192:(a<65536?s[i++]=a>>12&15|224:(s[i++]=a>>18&7|240,s[i++]=a>>12&63|128),s[i++]=a>>6&63|128),s[i++]=63&a|128)}}function kMe(e,t){let r=L0(e,t.limit),n=e.bytes,i=t.bytes;for(let s=0,o=t.limit;s<o;s++)n[s+r]=i[s]}function YX(e){return e.bytes[q3(e,1)]}function TB(e,t){let r=L0(e,1);e.bytes[r]=t}function gI(e){let t=q3(e,8),r=e.bytes;return as[0]=r[t++],as[1]=r[t++],as[2]=r[t++],as[3]=r[t++],as[4]=r[t++],as[5]=r[t++],as[6]=r[t++],as[7]=r[t++],G3[0]}function _I(e,t){let r=L0(e,8),n=e.bytes;G3[0]=t,n[r++]=as[0],n[r++]=as[1],n[r++]=as[2],n[r++]=as[3],n[r++]=as[4],n[r++]=as[5],n[r++]=as[6],n[r++]=as[7]}function Qc(e){let t,r=0,n=0;do t=YX(e),r<32&&(n|=(127&t)<<r),r+=7;while(128&t);return n}function Bt(e,t){for(t>>>=0;t>=128;)TB(e,127&t|128),t>>>=7;TB(e,t)}function Wl(e,t){let r=t.low>>>0,n=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,s=i===0?n===0?r<16384?r<128?1:2:r<1<<21?3:4:n<16384?n<128?5:6:n<1<<21?7:8:i<128?9:10,o=L0(e,s),a=e.bytes;switch(s){case 10:a[o+9]=i>>>7&1;case 9:a[o+8]=s!==9?128|i:127&i;case 8:a[o+7]=s!==8?n>>>21|128:n>>>21&127;case 7:a[o+6]=s!==7?n>>>14|128:n>>>14&127;case 6:a[o+5]=s!==6?n>>>7|128:n>>>7&127;case 5:a[o+4]=s!==5?128|n:127&n;case 4:a[o+3]=s!==4?r>>>21|128:r>>>21&127;case 3:a[o+2]=s!==3?r>>>14|128:r>>>14&127;case 2:a[o+1]=s!==2?r>>>7|128:r>>>7&127;case 1:a[o]=s!==1?128|r:127&r}}function RB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}const LMe=new Map([["moderation",1],["supervise",2]]);function AB(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}class xMe extends Cr{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const r=this._connectionState;this._connectionState=t,this.emit(_n.CONNECTION_STATE_CHANGE,r,t)}get inspectType(){return this._inspectType}set inspectType(t){var r;this._inspectMode=yc(r=t.map(n=>LMe.get(n)||0)).call(r,(n,i)=>n+i),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),j(this,"name","AgoraRTCVideoContentInspect"),j(this,"_connectionState",ha.CONNECTING),j(this,"_innerConnectionState",void 0),j(this,"sequence",0),j(this,"inspectStartTime",void 0),j(this,"workerManagerConnection",void 0),j(this,"workerConnection",void 0),j(this,"workerMessageLengthLimit",void 0),j(this,"inspectIntervalMinimum",void 0),j(this,"qualityRatio",void 0),j(this,"_connectInfo",void 0),j(this,"_cancelTokenSource",Hi.CancelToken.source()),j(this,"_retryConfig",void 0),j(this,"wmSequence",0),j(this,"inspectInterval",void 0),j(this,"inspectTimer",null),j(this,"ossFilePrefix",void 0),j(this,"extraInfo",void 0),j(this,"_inspectType",void 0),j(this,"_inspectMode",void 0),j(this,"_quality",1),j(this,"qualityTimer",null),j(this,"_inspectId",void 0),j(this,"_needWorkUrlOnly",!1),j(this,"inspectImage",()=>{if(this.connectionState!==ha.CONNECTED)throw new ee($.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===ha.CONNECTED?this.requestToInspectImage():C.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=ar(5,"inspect-"),this.workerMessageLengthLimit=W("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=W("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=W("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new mE("worker-manager-"+this._inspectId,Kr),this.on(_n.STATE_CHANGE,(r,n)=>{this._innerConnectionState=r,C.debug("[".concat(this._inspectId,"] Inspect operation :").concat(sa[r]," ").concat(n||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new mE("worker-"+this._inspectId,Kr),this.handleWorkerEvents()}async init(t,r){this.emit(_n.STATE_CHANGE,sa.CONNECT_AP),this._connectInfo=t;const n=this._cancelTokenSource.token;return this._retryConfig=r,new _e((i,s)=>{this.on(_n.CONNECTION_STATE_CHANGE,(o,a)=>{a===ha.CONNECTED&&i()}),this.requestAP(t,n,r).then(o=>{this.connectWorkerManager(o)}).catch(o=>{s(o)})})}async requestAP(t,r,n){const i=W("WEBCS_DOMAIN").map(a=>"https://".concat(a,"/api/v1")),s=await function(a,c,d,l){let{appId:u,areaCode:h,cname:p,sid:_,token:g,uid:E}=c;mm++;const b="image_moderation_api",v={service_name:b,json_body:JSON.stringify({appId:u,areaCode:h,cname:p,command:"allocateEdge",requestId:mm,seq:mm,sid:_,token:g,ts:Date.now(),uid:E+""})};let I,N,L=a[0];return Tc(async()=>{I=Date.now();const U=await Rc(L,{data:v,cancelToken:d,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(N=Date.now()-I,U.code!==0){const K=new ee($.UNEXPECTED_RESPONSE,"image inspect ap error, code"+U.code,{retry:!0,responseTime:N});throw C.error(K.toString()),K}const w=JSON.parse(U.json_body);if(w.code!==200){const K=new ee($.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(w.code,", reason: ").concat(w.reason),{code:w.code,responseTime:N});throw C.error(K.toString()),K}if(!w.servers||!Array.isArray(w.servers)||w.servers.length===0){const K=new ee($.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:w.code,responseTime:N});throw C.error(K.toString()),K}const V=W("VIDEO_INSPECT_WORKER_MANAGER_HOST"),z=W("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:w.servers.map(K=>{let{address:H,wss:A}=K;if(H&&A)return"wss://".concat(H.replace(/\./g,"-"),".").concat(V,":").concat(z||A)}).filter(K=>!!K),workerToken:w.workerToken,vid:w.vid,responseTime:N}},(U,w)=>(Ce.apworkerEvent(_,{success:!0,sc:200,serviceName:b,responseDetail:JSON.stringify(U.addressList),firstSuccess:w===0,responseTime:N,serverIp:a[w%a.length]}),!1),(U,w)=>(Ce.apworkerEvent(_,{success:!1,sc:U.data&&U.data.code||200,serviceName:b,responseTime:N,serverIp:a[w%a.length]}),!!(U.code!==$.OPERATION_ABORTED&&U.code!==$.UNEXPECTED_RESPONSE||U.data&&U.data.retry)&&(L=a[(w+1)%a.length],!0)),l)}(i,t,r,n);this.emit(_n.STATE_CHANGE,sa.AP_CONNECTED);const{addressList:o}=s;return this.wmSequence++,o}async connectWorkerManager(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=r,this.emit(_n.STATE_CHANGE,sa.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(We.CONNECTED,async()=>{this.emit(_n.STATE_CHANGE,sa.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.22.1",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(We.CLOSED,()=>{this._innerConnectionState<sa.GET_WORKER_MANAGER_RESPONSE&&C.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(We.FAILED,()=>{this._innerConnectionState<sa.GET_WORKER_MANAGER_RESPONSE&&C.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(We.RECONNECTING,()=>{this._innerConnectionState<sa.GET_WORKER_MANAGER_RESPONSE&&C.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(We.ON_MESSAGE,async t=>{this.emit(_n.STATE_CHANGE,sa.GET_WORKER_MANAGER_RESPONSE);const r=this.workerManagerConnection.url;this.workerManagerConnection.close();const n=JSON.parse(t.data);if(n.code!==200)throw C.error("[".concat(this._inspectId,"] Unexpected code ").concat(n.code," from worker manager")),new ee($.UNEXPECTED_RESPONSE,"response code of worker is unexpected",n);if(!(n.serverResponse&&n.serverResponse.portWss&&r))throw C.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(n))),new ee($.UNEXPECTED_RESPONSE,"response content of worker is unexpected",n);{const i=W("VIDEO_INSPECT_WORKER_PORT")||n.serverResponse.portWss,s=r.replace(/:\d+\/?$/,":".concat(i));this.emit(_n.STATE_CHANGE,sa.CONNECT_WORKER,s),this._needWorkUrlOnly?this.emit(_n.REQUEST_NEW_WORKER_URL,s):await this.connectWorker(s)}}),this.workerManagerConnection.on(We.WILL_RECONNECT,(t,r,n)=>{n(t)}),this.workerManagerConnection.on(We.REQUEST_NEW_URLS,(t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)})}handleWorkerEvents(){this.workerConnection.on(We.CONNECTED,async()=>{this.emit(_n.STATE_CHANGE,sa.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=ha.CONNECTED}),this.workerConnection.on(We.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const n=CMe(new Uint8Array(t.data));if(W("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&C.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(n)),n.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(_n.INSPECT_RESULT,void 0,void 0);if(n.data&&n.data.scorePorn&&n.data.scoreSexy&&n.data.scoreNeutral){var r;const i={porn:n.data.scorePorn,sexy:n.data.scoreSexy,neutral:n.data.scoreNeutral},s=yc(r=Object.keys(i)).call(r,(a,c)=>i[a]>i[c]?a:c,"porn"),o=Object.keys(i).find(a=>a===s);this.emit(_n.INSPECT_RESULT,o)}else this.emit(_n.INSPECT_RESULT,void 0,new ee($.UNEXPECTED_RESPONSE,n.code+"","There is an unexpected data on message"))}else this.emit(_n.INSPECT_RESULT,void 0,new ee($.UNEXPECTED_RESPONSE,n.code+"",n.msg))}else C.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(_n.INSPECT_RESULT,void 0,new ee($.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(We.CLOSED,()=>{this.connectionState=ha.CLOSED}),this.workerConnection.on(We.FAILED,()=>{this.connectionState=ha.CLOSED}),this.workerConnection.on(We.RECONNECTING,()=>{this.connectionState=this.connectionState===ha.CONNECTED?ha.RECONNECTING:ha.CONNECTING}),this.workerConnection.on(We.WILL_RECONNECT,(t,r,n)=>{t==="recover"&&n(t),n("tryNext")}),this.workerConnection.on(We.REQUEST_NEW_URLS,(t,r)=>{this.workerManagerConnection.close(),this.once(_n.REQUEST_NEW_WORKER_URL,n=>{t([n])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(n=>{this.connectWorkerManager(n,!0)}).catch(n=>{r(n)})})}async requestToInspectImage(){this.sequence++;const t=Lo(this,_n.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(_n.INSPECT_RESULT,void 0,new ee($.INVALID_OPERATION,"Only the track being played can be inspected"));const n=await this.generateRequestData(t,r);this.workerConnection.sendMessage(n,!0,!0)}else this.emit(_n.INSPECT_RESULT,void 0,new ee($.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,r){let{appId:n,cname:i,cid:s,vid:o,sid:a,uid:c}=r;const d=Date.now(),l=await t.getCurrentFrameImage("image/jpeg",this.quality),u=await MJ(l,n,i),h=this.sequence+"-"+s+"-"+c+"-"+d+"-"+ar(12,""),p={appId:n,cid:s,cname:i,deviceId:"",elapse:AB(Number(d-this.inspectStartTime)),fileSize:u.byteLength,jpgEncryption:2,height:l.height,width:l.width,jpg:u,networkType:6,osType:7,requestId:h,sdkVersion:"4.22.1",sequence:this.sequence,sid:a,timestamp:AB(d),uid:c,vid:o,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete p.callbackData,this.ossFilePrefix===void 0&&delete p.ossFilePrefix;const _=AMe(p);if(_.byteLength<this.workerMessageLengthLimit){if(W("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const g=function(E){for(var b=1;b<arguments.length;b++){var v=arguments[b]!=null?arguments[b]:{};b%2?RB(Object(v),!0).forEach(function(I){j(E,I,v[I])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(v)):RB(Object(v)).forEach(function(I){Object.defineProperty(E,I,Object.getOwnPropertyDescriptor(v,I))})}return E}({},p);delete g.jpg,C.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(g))}return _}{const g=this.quality*this.qualityRatio;return this.quality=g,await this.generateRequestData(t,{appId:n,cname:i,cid:s,vid:o,sid:a,uid:c})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Hi.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=ha.CLOSED,this.emit(_n.STATE_CHANGE,sa.CLOSED)}}const MMe={name:"ContentInspect",create:function(e){let{config:t}=e;return function(r){if(!r)throw new ee($.INVALID_PARAMS,"inspectConfig is necessary.");if(!r.inspectType||!Array.isArray(r.inspectType))throw new ee($.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const n=[...new Set(r.inspectType)];n.forEach(i=>{var s;if(!Ee(s=["supervise","moderation"]).call(s,i))throw new ee($.INVALID_PARAMS,"".concat(i," is not a valid inspect type."))}),r.inspectType=n}if(r&&r.extraInfo&&r.extraInfo.length>1024)throw new ee($.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new xMe(t)}};Gt("PROCESS_ID","process-".concat(ar(8,""),"-").concat(ar(4,""),"-").concat(ar(4,""),"-").concat(ar(4,""),"-").concat(ar(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void C.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),r=Date.now();C.debug("Loading global parameters from cache",t),Object.keys(t).forEach(n=>{if(Object.prototype.hasOwnProperty.call(Fr,n)){const{value:i,expires:s}=t[n];if(s&&s<=r)return;pu[n]=i,Fr[n]=i}})}catch(t){C.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(pu.AREAS)&&pu.AREAS.length>0&&U3(pu.AREAS,!0);const CB=(e,t,r)=>{C.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),Gt(e,t,r)};vg(SMe,!1),vg(RMe,!1),vg(oxe,!1),vg(MMe,!1),vg(vMe,!1);const $r=function(e){const t=new Cr,r=e,n={getListeners:t.getListeners.bind(t),on:(i,s)=>(function(o,a){o===Jc.SECURITY_POLICY_VIOLATION&&SX(a,!0)}(i,s),t.on.bind(t)(i,s)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return eB(eB({},r),n)}({__TRACK_LIST__:Sp,VERSION:xo,BUILD:T3,ESM_BUNDLER:!1,ESM:!0,UMD:!1,DEV:!1,setParameter:CB,getParameter:W,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const r=await async function(n){let i;return At().supportUnifiedPlan?(n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"}),i=(await n.createOffer()).sdp):i=(await n.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,i}(t);if(!r)return e;t.close(),t=null,e=function(n){const i={video:[],audio:[]};return n.match(/ VP8/i)&&i.video.push("VP8"),n.match(/ VP9/i)&&i.video.push("VP9"),n.match(/ AV1/i)&&i.video.push("AV1"),n.match(/ H264/i)&&i.video.push("H264"),n.match(/ H265/i)&&i.video.push("H265"),n.match(/ opus/i)&&i.audio.push("OPUS"),n.match(/ PCMU/i)&&i.audio.push("PCMU"),n.match(/ PCMA/i)&&i.audio.push("PCMA"),n.match(/ G722/i)&&i.audio.push("G722"),i}(r)}catch(t){throw new ee($.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=Ce.reportApiInvoke(null,{name:Zr.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Or.TRACER});let t=!1;try{const s=window.RTCPeerConnection,o=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,a=window.WebSocket;t=!!(s&&o&&a),t&&v3()&&$Y(75)&&new s().close()}catch(s){return C.error("check system requirement failed: ",s),!1}let r=!1;const n=Rt();n.name===Ft.CHROME&&Number(n.version)>=58&&(nc.engine.name!=="WebKit"||function(){const s=Rt();if(ES()){if(s.os===pn.MAC_OS)return!0;if(s.os===pn.IOS){const o=nc.os.version&&nc.os.version.split(".");if(o&&Number(o[0])===14&&o[1]&&Number(o[1])>=3||o&&Number(o[0])>14)return!0}}return!1}())&&(r=!0),(n.name===Ft.FIREFOX&&Number(n.version)>=56||n.name===Ft.OPERA&&Number(n.version)>=45||n.name===Ft.SAFARI&&Number(n.version)>=11||n.name==="WebKit"&&(Ci()||Da())&&n.osVersion&&Number(n.osVersion.split(".")[0])>=11||GY()||Rt().name===Ft.QQ)&&(r=!0),C.debug("checkSystemRequirements, api:",t,"browser",r);const i=t&&r;return e.onSuccess(i),i},getDevices:function(e){return io.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return io.getRecordingDevices(e)},getCameras:function(e){return io.getCamerasDevices(e)},getElectronScreenSources:AJ,getPlaybackDevices:function(e){return io.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const r=Ce.reportApiInvoke(null,{name:Zr.CREATE_CLIENT,options:[t],tag:Or.TRACER});try{(function(n){rn(n.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),rn(n.mode,"config.mode",["rtc","live","p2p"]),n.audioCodec!==void 0&&rn(n.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),n.proxyServer!==void 0&&wn(n.proxyServer,"config.proxyServer",1,1e4),n.turnServer!==void 0&&XY(n.turnServer),n.httpRetryConfig!==void 0&&EU(n.httpRetryConfig),n.websocketRetryConfig!==void 0&&EU(n.websocketRetryConfig)})(t)}catch(n){throw r.onError(n),n}return(zY(16,0)||WY(16,0))&&(t.codec==="vp9"&&(t.codec="vp8",C.debug("browser not support vp9, force use vp8")),Gt("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),r.onSuccess(),new axe(_a(_a({forceWaitGatewayResponse:!0},t),{},{role:Ee(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=W("CAMERA_CAPTURE_CONFIG"),r=Ce.reportApiInvoke(null,{tag:Or.TRACER,name:Zr.CREATE_CAM_VIDEO_TRACK,options:[yr({},e),t]});t&&(e.encoderConfig=t);const n=SS(e),i=ar(8,"track-cam-");let s=null;C.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{s=(await Xs({video:n},i)).getVideoTracks()[0]||null}catch(a){throw r.onError(a),a}if(!s){const a=new ie($.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(a),a.throw(C)}e.optimizationMode&&jC(i,s,e,td(e.encoderConfig));const o=new yN(s,e,n,e.scalabiltyMode?Sy(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return r.onSuccess(o.getTrackId()),C.info("create camera video success, trackId:",i),o},createCustomVideoTrack:function(e){const t=Ce.reportApiInvoke(null,{tag:Or.TRACER,name:Zr.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),r=new hr(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?Sy(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,ar(8,"track-cus-"),[ir.CUSTOM_TRACK]);return t.onSuccess(r.getTrackId()),C.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const r=Ce.reportApiInvoke(null,{tag:Or.TRACER,name:Zr.CREATE_SCREEN_VIDEO_TRACK,options:[yr({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const n=function(l){const u={};l.screenSourceType&&(u.mediaSource=l.screenSourceType),l.extensionId&&Iu()&&(u.extensionId=l.extensionId);const{displaySurface:h,selfBrowserSurface:p,surfaceSwitching:_,systemAudio:g}=l;(iN(107)||hU(107)||fU(93))&&(h&&(rn(h,"displaySurface",["browser","window","monitor"]),u.displaySurface=h),p?(rn(p,"selfBrowserSurface",["exclude","include"]),u.selfBrowserSurface=p):u.selfBrowserSurface="include",_&&(rn(_,"surfaceSwitching",["exclude","include"]),u.surfaceSwitching=_)),(iN(105)||hU(105)||fU(91))&&g&&(rn(g,"systemAudio",["exclude","include"]),u.systemAudio=g),l.electronScreenSourceId&&(u.sourceId=l.electronScreenSourceId);const E=l.encoderConfig?LC(l.encoderConfig):null;return u.mandatory={chromeMediaSource:"desktop",maxWidth:E?E.width:void 0,maxHeight:E?E.height:void 0},E&&(E.frameRate&&(typeof E.frameRate=="number"?(u.mandatory.maxFrameRate=E.frameRate,u.mandatory.minFrameRate=E.frameRate):(u.mandatory.maxFrameRate=E.frameRate.max||E.frameRate.ideal||E.frameRate.exact||void 0,u.mandatory.minFrameRate=E.frameRate.min||E.frameRate.ideal||E.frameRate.exact||void 0),u.frameRate=E.frameRate),E.width&&(u.width=E.width),E.height&&(u.height=E.height)),u}(e),i=ar(8,"track-scr-v-");let s=null,o=null;const a=At();if(!a.supportShareAudio&&t==="enable"){const l=new ie($.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return r.onError(l),l.throw(C)}C.info("start create screen video track with config",e,"withAudio",t,"trackId",i);try{const l=await Xs({screen:n,screenAudio:t==="auto"?a.supportShareAudio:t==="enable"},i);s=l.getVideoTracks()[0]||null,o=l.getAudioTracks()[0]||null}catch(l){throw r.onError(l),l}if(!s){const l=new ie($.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(l),l.throw(C)}if(!o&&t==="enable"){s&&s.stop();const l=new ie($.SHARE_AUDIO_NOT_ALLOWED);return r.onError(l),l.throw(C)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(jC(i,s,e,e.encoderConfig&&LC(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const c=new hr(s,e.encoderConfig?LC(e.encoderConfig):{},e.scalabiltyMode?Sy(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i,[ir.SCREEN_TRACK]);if(!o)return r.onSuccess(c.getTrackId()),C.info("create screen video track success","video:",c.getTrackId()),c;const d=new Ir(o,void 0,ar(8,"track-scr-a-"),!1);return r.onSuccess([c.getTrackId(),d.getTrackId()]),C.info("create screen video track success","video:",c.getTrackId(),"audio:",d.getTrackId()),[c,d]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=W("CAMERA_CAPTURE_CONFIG"),n=Ce.reportApiInvoke(null,{tag:Or.TRACER,name:Zr.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,r]});r&&(t.encoderConfig=r);const i=SS(t),s=b9(e),o=ar(8,"track-mic-"),a=ar(8,"track-cam-");let c=null,d=null;C.info("start create camera video track(".concat(a,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const h=await Xs({audio:s,video:i},"".concat(o,"-").concat(a));c=h.getAudioTracks()[0],d=h.getVideoTracks()[0]}catch(h){throw n.onError(h),h}if(!c||!d){const h=new ie($.UNEXPECTED_ERROR,"can not find tracks in media stream");return n.onError(h),h.throw(C)}t.optimizationMode&&jC(a,d,t,td(t.encoderConfig));const l=new wS(c,e,s,o),u=new yN(d,t,i,t.scalabiltyMode?Sy(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,a);return n.onSuccess([l.getTrackId(),u.getTrackId()]),C.info("create camera video track(".concat(a,") and microphone audio track(").concat(o,") success")),[l,u]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Ce.reportApiInvoke(null,{tag:Or.TRACER,name:Zr.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=b9(e),n=ar(8,"track-mic-");let i=null;C.info("start create microphone audio track with config",JSON.stringify(e),"trackId",n);try{i=(await Xs({audio:r},n)).getAudioTracks()[0]||null}catch(o){throw t.onError(o),o}if(!i){const o=new ie($.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(o),o.throw(C)}const s=new wS(i,e,r,n);return t.onSuccess(s.getTrackId()),C.info("create microphone audio track success, trackId:",n),s},createCustomAudioTrack:function(e){const t=Ce.reportApiInvoke(null,{tag:Or.TRACER,name:Zr.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new Ir(e.mediaStreamTrack,e.encoderConfig?bS(e.encoderConfig):{},ar(8,"track-cus-"),!1);return C.info("create custom audio track success with config",e,"trackId",r.getTrackId()),t.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:r,encoderConfig:n}=e;let{source:i}=e;const s={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":i,cacheOnlineFile:r,encoderConfig:n},o=Ce.reportApiInvoke(null,{tag:Or.TRACER,name:Zr.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(W("DISABLE_WEBAUDIO"))throw new ie($.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const a=ar(8,"track-buf-");C.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",a);const c=i;if(!(i instanceof AudioBuffer))try{i=await async function(u,h){let p=null;if(typeof u=="string"){const g=s7.get(u);if(g)return C.debug("use cached audio resource: ",u),g;try{p=(await Tc(()=>Hi.get(u,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(E){throw new ie($.FETCH_AUDIO_FILE_FAILED,E.toString())}}else p=await new _e((E,b)=>{const v=new FileReader;v.onload=I=>{I.target?E(I.target.result):b(new ie($.READ_LOCAL_AUDIO_FILE_ERROR))},v.onerror=()=>{b(new ie($.READ_LOCAL_AUDIO_FILE_ERROR))},v.readAsArrayBuffer(u)});const _=await function(g){const E=N0();return new _e((b,v)=>{E.decodeAudioData(g,I=>{b(I)},I=>{v(new ie($.DECODE_AUDIO_FILE_FAILED,I.toString()))})})}(p);return typeof u=="string"&&h&&s7.set(u,_),_}(i,r)}catch(u){return o.onError(u),u.throw(C)}const d=new lLe(i),l=new dLe(c,d,n?bS(n):{},a);return C.info("create buffer source audio track success, trackId:",a),o.onSuccess(l.getTrackId()),l},setAppType:function(e){if(C.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw C.debug("Invalid appType"),new ee($.INVALID_PARAMS,"invalid app type",e);Gt("APP_TYPE",Math.floor(e))},setLogLevel:function(e){C.setLogLevel(e)},enableLogUpload:function(){W("USE_NEW_LOG")?Gt("UPLOAD_LOG",!0):C.enableLogUpload()},disableLogUpload:function(){W("USE_NEW_LOG")?Gt("UPLOAD_LOG",!1):C.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new cX},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=Ce.reportApiInvoke(null,{tag:Or.TRACER,name:Zr.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Ir||e instanceof pm)){const c=new ee($.INVALID_TRACK,"the parameter is not a audio track");return r.onError(c),c.throw()}t&&t<1e3&&(t=1e3);const n=e instanceof Ir?e.getTrackLabel():"remote_track",i=e.getVolumeLevel();let s=i,o=i;const a=Date.now();return new _e(c=>{const d=setInterval(()=>{const l=e.getVolumeLevel();s=l>s?l:s,o=l<o?l:o;const u=s-o>1e-4,h=Date.now()-a;if(u||h>t){clearInterval(d);const p=u,_={duration:h,deviceLabel:n,maxVolumeLevel:s,result:p};C.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(_))),r.onSuccess(_),c(p)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=Ce.reportApiInvoke(null,{tag:Or.TRACER,name:Zr.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof hr||e instanceof fm)){const u=new ee($.INVALID_TRACK,"the parameter is not a video track");return r.onError(u),u.throw()}t&&t<1e3&&(t=1e3);const n=e instanceof hr?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(Bn()||ES())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([i]),s.play();const o=document.createElement("canvas");o.width=160,o.height=120;let a=0,c=0;try{const u=Date.now();a=await function(h,p,_,g){let E,b=0,v=null;return new _e((I,N)=>{function L(){b>g&&E&&(E(),I(b));const U=_.getContext("2d");if(!U){const z=new ee($.UNEXPECTED_ERROR,"can not get canvas 2d context.");return C.error(z.toString()),void N(z)}U.drawImage(h,0,0,160,120);const w=U.getImageData(0,0,_.width,_.height),V=Math.floor(w.data.length/3);if(v){for(let z=0;z<V;z+=3)if(w.data[z]!==v[z])return b+=1,void(v=w.data);v=w.data}else v=w.data}setTimeout(()=>{E&&(E(),I(b))},p),E=D3(()=>{L()},30)})}(s,t,o,4),c=Date.now()-u}catch(u){throw r.onError(u),u}GLe===Ft.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;const d=a>4,l={duration:c,changedPicNum:a,deviceLabel:n,result:d};return C.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(l))),r.onSuccess(l),d},setArea:U3,audioElementPlayCenter:Fi,resumeAudioContext:function(){Fi.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){dxe.processExternalMediaAEC(e)},registerExtensions:function(e){const t=W("PLUGIN_INFO")||[];e.forEach(r=>{"name"in r&&!Ee(t).call(t,r.name)&&t.push(r.name);const n=r;n.__registered__=!0,n.logger.hookLog=C.extLog,n.reporter.hookApiInvoke=Ce.extApiInvoke,n.parameters&&Object.keys(n.parameters).forEach(i=>{n.parameters[i]=W(i)})}),CB("PLUGIN_INFO",t)},ChannelMediaRelayError:bp,ChannelMediaRelayEvent:Jd,ChannelMediaRelayState:is,RemoteStreamFallbackType:rLe,RemoteStreamType:tLe,ConnectionDisconnectedReason:Vt,AudienceLatencyLevelType:xPe,AREAS:Dt,preload:async function(e,t,r,n){return pX(e,t,r,n)}});Object.defineProperties($r,{onAudioAutoplayFailed:{get:()=>qs.onAudioAutoplayFailed,set:e=>{qs.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>qs.onAutoplayFailed,set:e=>{qs.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>$r._onSecurityPolicyViolation,set(e){$r._onSecurityPolicyViolation=e,SX(e)}},__CLIENT_LIST__:{get:()=>W("SHOW_GLOBAL_CLIENT_LIST")?Oh:[]}}),io.on(Wh.CAMERA_DEVICE_CHANGED,e=>{C.info("camera device changed",JSON.stringify(e)),$r.onCameraChanged&&$r.onCameraChanged(e),$r.safeEmit(Jc.CAMERA_CHANGED,e)}),io.on(Wh.RECORDING_DEVICE_CHANGED,e=>{C.info("microphone device changed",JSON.stringify(e)),$r.onMicrophoneChanged&&$r.onMicrophoneChanged(e),$r.safeEmit(Jc.MICROPHONE_CHANGED,e)}),io.on(Wh.PLAYOUT_DEVICE_CHANGED,e=>{C.debug("playout device changed",JSON.stringify(e)),$r.onPlaybackDeviceChanged&&$r.onPlaybackDeviceChanged(e),$r.safeEmit(Jc.PLAYBACK_DEVICE_CHANGED,e)}),Fi.onAutoplayFailed=()=>{C.info("detect audio element autoplay failed"),qs.onAudioAutoplayFailed&&qs.onAudioAutoplayFailed()},Ht.on("autoplay-failed",()=>{C.info("detect webaudio autoplay failed"),qs.onAudioAutoplayFailed&&qs.onAudioAutoplayFailed(),$r.safeEmit(Jc.AUTOPLAY_FAILED)}),Ht.on(Rn.STATE_CHANGE,(e,t)=>{C.info("audio context state changed: ".concat(t," => ").concat(e)),$r.onAudioContextStateChanged&&$r.onAudioContextStateChanged(e,t),$r.safeEmit(Jc.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Wr.on(Wp.NETWORK_STATE_CHANGE,(e,t)=>{C.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=$r);const Sd=Object.create(null);Sd.open="0";Sd.close="1";Sd.ping="2";Sd.pong="3";Sd.message="4";Sd.upgrade="5";Sd.noop="6";const Wb=Object.create(null);Object.keys(Sd).forEach(e=>{Wb[Sd[e]]=e});const DN={type:"error",data:"parser error"},JX=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",XX=typeof ArrayBuffer=="function",QX=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,K3=({type:e,data:t},r,n)=>JX&&t instanceof Blob?r?n(t):IB(t,n):XX&&(t instanceof ArrayBuffer||QX(t))?r?n(t):IB(new Blob([t]),n):n(Sd[e]+(t||"")),IB=(e,t)=>{const r=new FileReader;return r.onload=function(){const n=r.result.split(",")[1];t("b"+(n||""))},r.readAsDataURL(e)};function OB(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let EI;function UMe(e,t){if(JX&&e.data instanceof Blob)return e.data.arrayBuffer().then(OB).then(t);if(XX&&(e.data instanceof ArrayBuffer||QX(e.data)))return t(OB(e.data));K3(e,!1,r=>{EI||(EI=new TextEncoder),t(EI.encode(r))})}const NB="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Hg=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<NB.length;e++)Hg[NB.charCodeAt(e)]=e;const jMe=e=>{let t=e.length*.75,r=e.length,n,i=0,s,o,a,c;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const d=new ArrayBuffer(t),l=new Uint8Array(d);for(n=0;n<r;n+=4)s=Hg[e.charCodeAt(n)],o=Hg[e.charCodeAt(n+1)],a=Hg[e.charCodeAt(n+2)],c=Hg[e.charCodeAt(n+3)],l[i++]=s<<2|o>>4,l[i++]=(o&15)<<4|a>>2,l[i++]=(a&3)<<6|c&63;return d},FMe=typeof ArrayBuffer=="function",Y3=(e,t)=>{if(typeof e!="string")return{type:"message",data:ZX(e,t)};const r=e.charAt(0);return r==="b"?{type:"message",data:BMe(e.substring(1),t)}:Wb[r]?e.length>1?{type:Wb[r],data:e.substring(1)}:{type:Wb[r]}:DN},BMe=(e,t)=>{if(FMe){const r=jMe(e);return ZX(r,t)}else return{base64:!0,data:e}},ZX=(e,t)=>{switch(t){case"blob":return e instanceof Blob?e:new Blob([e]);case"arraybuffer":default:return e instanceof ArrayBuffer?e:e.buffer}},eQ="",VMe=(e,t)=>{const r=e.length,n=new Array(r);let i=0;e.forEach((s,o)=>{K3(s,!1,a=>{n[o]=a,++i===r&&t(n.join(eQ))})})},$Me=(e,t)=>{const r=e.split(eQ),n=[];for(let i=0;i<r.length;i++){const s=Y3(r[i],t);if(n.push(s),s.type==="error")break}return n};function HMe(){return new TransformStream({transform(e,t){UMe(e,r=>{const n=r.length;let i;if(n<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,n);else if(n<65536){i=new Uint8Array(3);const s=new DataView(i.buffer);s.setUint8(0,126),s.setUint16(1,n)}else{i=new Uint8Array(9);const s=new DataView(i.buffer);s.setUint8(0,127),s.setBigUint64(1,BigInt(n))}e.data&&typeof e.data!="string"&&(i[0]|=128),t.enqueue(i),t.enqueue(r)})}})}let vI;function Vy(e){return e.reduce((t,r)=>t+r.length,0)}function $y(e,t){if(e[0].length===t)return e.shift();const r=new Uint8Array(t);let n=0;for(let i=0;i<t;i++)r[i]=e[0][n++],n===e[0].length&&(e.shift(),n=0);return e.length&&n<e[0].length&&(e[0]=e[0].slice(n)),r}function zMe(e,t){vI||(vI=new TextDecoder);const r=[];let n=0,i=-1,s=!1;return new TransformStream({transform(o,a){for(r.push(o);;){if(n===0){if(Vy(r)<1)break;const c=$y(r,1);s=(c[0]&128)===128,i=c[0]&127,i<126?n=3:i===126?n=1:n=2}else if(n===1){if(Vy(r)<2)break;const c=$y(r,2);i=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),n=3}else if(n===2){if(Vy(r)<8)break;const c=$y(r,8),d=new DataView(c.buffer,c.byteOffset,c.length),l=d.getUint32(0);if(l>Math.pow(2,21)-1){a.enqueue(DN);break}i=l*Math.pow(2,32)+d.getUint32(4),n=3}else{if(Vy(r)<i)break;const c=$y(r,i);a.enqueue(Y3(s?c:vI.decode(c),t)),n=0}if(i===0||i>e){a.enqueue(DN);break}}}})}const tQ=4;function ri(e){if(e)return WMe(e)}function WMe(e){for(var t in ri.prototype)e[t]=ri.prototype[t];return e}ri.prototype.on=ri.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this};ri.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this};ri.prototype.off=ri.prototype.removeListener=ri.prototype.removeAllListeners=ri.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var r=this._callbacks["$"+e];if(!r)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var n,i=0;i<r.length;i++)if(n=r[i],n===t||n.fn===t){r.splice(i,1);break}return r.length===0&&delete this._callbacks["$"+e],this};ri.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(r){r=r.slice(0);for(var n=0,i=r.length;n<i;++n)r[n].apply(this,t)}return this};ri.prototype.emitReserved=ri.prototype.emit;ri.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};ri.prototype.hasListeners=function(e){return!!this.listeners(e).length};const ET=typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,r)=>r(t,0),Ta=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),GMe="arraybuffer";function rQ(e,...t){return t.reduce((r,n)=>(e.hasOwnProperty(n)&&(r[n]=e[n]),r),{})}const qMe=Ta.setTimeout,KMe=Ta.clearTimeout;function vT(e,t){t.useNativeTimers?(e.setTimeoutFn=qMe.bind(Ta),e.clearTimeoutFn=KMe.bind(Ta)):(e.setTimeoutFn=Ta.setTimeout.bind(Ta),e.clearTimeoutFn=Ta.clearTimeout.bind(Ta))}const YMe=1.33;function JMe(e){return typeof e=="string"?XMe(e):Math.ceil((e.byteLength||e.size)*YMe)}function XMe(e){let t=0,r=0;for(let n=0,i=e.length;n<i;n++)t=e.charCodeAt(n),t<128?r+=1:t<2048?r+=2:t<55296||t>=57344?r+=3:(n++,r+=4);return r}function nQ(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function QMe(e){let t="";for(let r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t}function ZMe(e){let t={},r=e.split("&");for(let n=0,i=r.length;n<i;n++){let s=r[n].split("=");t[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return t}class e6e extends Error{constructor(t,r,n){super(t),this.description=r,this.context=n,this.type="TransportError"}}class J3 extends ri{constructor(t){super(),this.writable=!1,vT(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,r,n){return super.emitReserved("error",new e6e(t,r,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const r=Y3(t,this.socket.binaryType);this.onPacket(r)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,r={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(r)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const r=QMe(t);return r.length?"?"+r:""}}class t6e extends J3{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const r=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let n=0;this._polling&&(n++,this.once("pollComplete",function(){--n||r()})),this.writable||(n++,this.once("drain",function(){--n||r()}))}else r()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const r=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};$Me(t,this.socket.binaryType).forEach(r),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,VMe(t,r=>{this.doWrite(r,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",r=this.query||{};return this.opts.timestampRequests!==!1&&(r[this.opts.timestampParam]=nQ()),!this.supportsBinary&&!r.sid&&(r.b64=1),this.createUri(t,r)}}let iQ=!1;try{iQ=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const r6e=iQ;function n6e(){}class i6e extends t6e{constructor(t){if(super(t),typeof location<"u"){const r=location.protocol==="https:";let n=location.port;n||(n=r?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||n!==t.port}}doWrite(t,r){const n=this.request({method:"POST",data:t});n.on("success",r),n.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(r,n)=>{this.onError("xhr poll error",r,n)}),this.pollXhr=t}}let Em=class Gb extends ri{constructor(t,r,n){super(),this.createRequest=t,vT(this,n),this._opts=n,this._method=n.method||"GET",this._uri=r,this._data=n.data!==void 0?n.data:null,this._create()}_create(){var t;const r=rQ(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");r.xdomain=!!this._opts.xd;const n=this._xhr=this.createRequest(r);try{n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&n.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var i;n.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(n.getResponseHeader("set-cookie"))),n.readyState===4&&(n.status===200||n.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof n.status=="number"?n.status:0)},0))},n.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=Gb.requestsCount++,Gb.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=n6e,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Gb.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};Em.requestsCount=0;Em.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",DB);else if(typeof addEventListener=="function"){const e="onpagehide"in Ta?"pagehide":"unload";addEventListener(e,DB,!1)}}function DB(){for(let e in Em.requests)Em.requests.hasOwnProperty(e)&&Em.requests[e].abort()}const s6e=function(){const e=sQ({xdomain:!1});return e&&e.responseType!==null}();class o6e extends i6e{constructor(t){super(t);const r=t&&t.forceBase64;this.supportsBinary=s6e&&!r}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new Em(sQ,this.uri(),t)}}function sQ(e){const t=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||r6e))return new XMLHttpRequest}catch{}if(!t)try{return new Ta[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const oQ=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class a6e extends J3{get name(){return"websocket"}doOpen(){const t=this.uri(),r=this.opts.protocols,n=oQ?{}:rQ(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,r,n)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let r=0;r<t.length;r++){const n=t[r],i=r===t.length-1;K3(n,this.supportsBinary,s=>{try{this.doWrite(n,s)}catch{}i&&ET(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",r=this.query||{};return this.opts.timestampRequests&&(r[this.opts.timestampParam]=nQ()),this.supportsBinary||(r.b64=1),this.createUri(t,r)}}const yI=Ta.WebSocket||Ta.MozWebSocket;class c6e extends a6e{createSocket(t,r,n){return oQ?new yI(t,r,n):r?new yI(t,r):new yI(t)}doWrite(t,r){this.ws.send(r)}}class d6e extends J3{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const r=zMe(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=t.readable.pipeThrough(r).getReader(),i=HMe();i.readable.pipeTo(t.writable),this._writer=i.writable.getWriter();const s=()=>{n.read().then(({done:a,value:c})=>{a||(this.onPacket(c),s())}).catch(a=>{})};s();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let r=0;r<t.length;r++){const n=t[r],i=r===t.length-1;this._writer.write(n).then(()=>{i&&ET(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const l6e={websocket:c6e,webtransport:d6e,polling:o6e},u6e=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,h6e=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function PN(e){if(e.length>8e3)throw"URI too long";const t=e,r=e.indexOf("["),n=e.indexOf("]");r!=-1&&n!=-1&&(e=e.substring(0,r)+e.substring(r,n).replace(/:/g,";")+e.substring(n,e.length));let i=u6e.exec(e||""),s={},o=14;for(;o--;)s[h6e[o]]=i[o]||"";return r!=-1&&n!=-1&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=f6e(s,s.path),s.queryKey=p6e(s,s.query),s}function f6e(e,t){const r=/\/{2,9}/g,n=t.replace(r,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&n.splice(0,1),t.slice(-1)=="/"&&n.splice(n.length-1,1),n}function p6e(e,t){const r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,s){i&&(r[i]=s)}),r}const kN=typeof addEventListener=="function"&&typeof removeEventListener=="function",qb=[];kN&&addEventListener("offline",()=>{qb.forEach(e=>e())},!1);class ku extends ri{constructor(t,r){if(super(),this.binaryType=GMe,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(r=t,t=null),t){const n=PN(t);r.hostname=n.host,r.secure=n.protocol==="https"||n.protocol==="wss",r.port=n.port,n.query&&(r.query=n.query)}else r.host&&(r.hostname=PN(r.host).host);vT(this,r),this.secure=r.secure!=null?r.secure:typeof location<"u"&&location.protocol==="https:",r.hostname&&!r.port&&(r.port=this.secure?"443":"80"),this.hostname=r.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=r.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},r.transports.forEach(n=>{const i=n.prototype.name;this.transports.push(i),this._transportsByName[i]=n}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},r),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=ZMe(this.opts.query)),kN&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},qb.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const r=Object.assign({},this.opts.query);r.EIO=tQ,r.transport=t,this.id&&(r.sid=this.id);const n=Object.assign({},this.opts,{query:r,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](n)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&ku.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const r=this.createTransport(t);r.open(),this.setTransport(r)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",r=>this._onClose("transport close",r))}onOpen(){this.readyState="open",ku.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const r=new Error("server error");r.code=t.data,this._onError(r);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let r=1;for(let n=0;n<this.writeBuffer.length;n++){const i=this.writeBuffer[n].data;if(i&&(r+=JMe(i)),n>0&&r>this._maxPayload)return this.writeBuffer.slice(0,n);r+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,ET(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,r,n){return this._sendPacket("message",t,r,n),this}send(t,r,n){return this._sendPacket("message",t,r,n),this}_sendPacket(t,r,n,i){if(typeof r=="function"&&(i=r,r=void 0),typeof n=="function"&&(i=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const s={type:t,data:r,options:n};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},r=()=>{this.off("upgrade",r),this.off("upgradeError",r),t()},n=()=>{this.once("upgrade",r),this.once("upgradeError",r)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():t()}):this.upgrading?n():t()),this}_onError(t){if(ku.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,r){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),kN&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const n=qb.indexOf(this._offlineEventListener);n!==-1&&qb.splice(n,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,r),this.writeBuffer=[],this._prevBufferLen=0}}}ku.protocol=tQ;class m6e extends ku{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let r=this.createTransport(t),n=!1;ku.priorWebsocketSuccess=!1;const i=()=>{n||(r.send([{type:"ping",data:"probe"}]),r.once("packet",u=>{if(!n)if(u.type==="pong"&&u.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",r),!r)return;ku.priorWebsocketSuccess=r.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(l(),this.setTransport(r),r.send([{type:"upgrade"}]),this.emitReserved("upgrade",r),r=null,this.upgrading=!1,this.flush())})}else{const h=new Error("probe error");h.transport=r.name,this.emitReserved("upgradeError",h)}}))};function s(){n||(n=!0,l(),r.close(),r=null)}const o=u=>{const h=new Error("probe error: "+u);h.transport=r.name,s(),this.emitReserved("upgradeError",h)};function a(){o("transport closed")}function c(){o("socket closed")}function d(u){r&&u.name!==r.name&&s()}const l=()=>{r.removeListener("open",i),r.removeListener("error",o),r.removeListener("close",a),this.off("close",c),this.off("upgrading",d)};r.once("open",i),r.once("error",o),r.once("close",a),this.once("close",c),this.once("upgrading",d),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{n||r.open()},200):r.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const r=[];for(let n=0;n<t.length;n++)~this.transports.indexOf(t[n])&&r.push(t[n]);return r}}let g6e=class extends m6e{constructor(t,r={}){const n=typeof t=="object"?t:r;(!n.transports||n.transports&&typeof n.transports[0]=="string")&&(n.transports=(n.transports||["polling","websocket","webtransport"]).map(i=>l6e[i]).filter(i=>!!i)),super(t,n)}};function _6e(e,t="",r){let n=e;r=r||typeof location<"u"&&location,e==null&&(e=r.protocol+"//"+r.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=r.protocol+e:e=r.host+e),/^(https?|wss?):\/\//.test(e)||(typeof r<"u"?e=r.protocol+"//"+e:e="https://"+e),n=PN(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const s=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port+t,n.href=n.protocol+"://"+s+(r&&r.port===n.port?"":":"+n.port),n}const E6e=typeof ArrayBuffer=="function",v6e=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,aQ=Object.prototype.toString,y6e=typeof Blob=="function"||typeof Blob<"u"&&aQ.call(Blob)==="[object BlobConstructor]",b6e=typeof File=="function"||typeof File<"u"&&aQ.call(File)==="[object FileConstructor]";function X3(e){return E6e&&(e instanceof ArrayBuffer||v6e(e))||y6e&&e instanceof Blob||b6e&&e instanceof File}function Kb(e,t){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let r=0,n=e.length;r<n;r++)if(Kb(e[r]))return!0;return!1}if(X3(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return Kb(e.toJSON(),!0);for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&Kb(e[r]))return!0;return!1}function S6e(e){const t=[],r=e.data,n=e;return n.data=LN(r,t),n.attachments=t.length,{packet:n,buffers:t}}function LN(e,t){if(!e)return e;if(X3(e)){const r={_placeholder:!0,num:t.length};return t.push(e),r}else if(Array.isArray(e)){const r=new Array(e.length);for(let n=0;n<e.length;n++)r[n]=LN(e[n],t);return r}else if(typeof e=="object"&&!(e instanceof Date)){const r={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=LN(e[n],t));return r}return e}function w6e(e,t){return e.data=xN(e.data,t),delete e.attachments,e}function xN(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let r=0;r<e.length;r++)e[r]=xN(e[r],t);else if(typeof e=="object")for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e[r]=xN(e[r],t));return e}const T6e=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],R6e=5;var vr;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(vr||(vr={}));class A6e{constructor(t){this.replacer=t}encode(t){return(t.type===vr.EVENT||t.type===vr.ACK)&&Kb(t)?this.encodeAsBinary({type:t.type===vr.EVENT?vr.BINARY_EVENT:vr.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let r=""+t.type;return(t.type===vr.BINARY_EVENT||t.type===vr.BINARY_ACK)&&(r+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(r+=t.nsp+","),t.id!=null&&(r+=t.id),t.data!=null&&(r+=JSON.stringify(t.data,this.replacer)),r}encodeAsBinary(t){const r=S6e(t),n=this.encodeAsString(r.packet),i=r.buffers;return i.unshift(n),i}}function PB(e){return Object.prototype.toString.call(e)==="[object Object]"}class Q3 extends ri{constructor(t){super(),this.reviver=t}add(t){let r;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");r=this.decodeString(t);const n=r.type===vr.BINARY_EVENT;n||r.type===vr.BINARY_ACK?(r.type=n?vr.EVENT:vr.ACK,this.reconstructor=new C6e(r),r.attachments===0&&super.emitReserved("decoded",r)):super.emitReserved("decoded",r)}else if(X3(t)||t.base64)if(this.reconstructor)r=this.reconstructor.takeBinaryData(t),r&&(this.reconstructor=null,super.emitReserved("decoded",r));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let r=0;const n={type:Number(t.charAt(0))};if(vr[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===vr.BINARY_EVENT||n.type===vr.BINARY_ACK){const s=r+1;for(;t.charAt(++r)!=="-"&&r!=t.length;);const o=t.substring(s,r);if(o!=Number(o)||t.charAt(r)!=="-")throw new Error("Illegal attachments");n.attachments=Number(o)}if(t.charAt(r+1)==="/"){const s=r+1;for(;++r&&!(t.charAt(r)===","||r===t.length););n.nsp=t.substring(s,r)}else n.nsp="/";const i=t.charAt(r+1);if(i!==""&&Number(i)==i){const s=r+1;for(;++r;){const o=t.charAt(r);if(o==null||Number(o)!=o){--r;break}if(r===t.length)break}n.id=Number(t.substring(s,r+1))}if(t.charAt(++r)){const s=this.tryParse(t.substr(r));if(Q3.isPayloadValid(n.type,s))n.data=s;else throw new Error("invalid payload")}return n}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,r){switch(t){case vr.CONNECT:return PB(r);case vr.DISCONNECT:return r===void 0;case vr.CONNECT_ERROR:return typeof r=="string"||PB(r);case vr.EVENT:case vr.BINARY_EVENT:return Array.isArray(r)&&(typeof r[0]=="number"||typeof r[0]=="string"&&T6e.indexOf(r[0])===-1);case vr.ACK:case vr.BINARY_ACK:return Array.isArray(r)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class C6e{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const r=w6e(this.reconPack,this.buffers);return this.finishedReconstruction(),r}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const I6e=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Q3,Encoder:A6e,get PacketType(){return vr},protocol:R6e},Symbol.toStringTag,{value:"Module"}));function ic(e,t,r){return e.on(t,r),function(){e.off(t,r)}}const O6e=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class cQ extends ri{constructor(t,r,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=r,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[ic(t,"open",this.onopen.bind(this)),ic(t,"packet",this.onpacket.bind(this)),ic(t,"error",this.onerror.bind(this)),ic(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...r){var n,i,s;if(O6e.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(r.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(r),this;const o={type:vr.EVENT,data:r};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof r[r.length-1]=="function"){const l=this.ids++,u=r.pop();this._registerAckCallback(l,u),o.id=l}const a=(i=(n=this.io.engine)===null||n===void 0?void 0:n.transport)===null||i===void 0?void 0:i.writable,c=this.connected&&!(!((s=this.io.engine)===null||s===void 0)&&s._hasPingExpired());return this.flags.volatile&&!a||(c?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(t,r){var n;const i=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(i===void 0){this.acks[t]=r;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===t&&this.sendBuffer.splice(a,1);r.call(this,new Error("operation has timed out"))},i),o=(...a)=>{this.io.clearTimeoutFn(s),r.apply(this,a)};o.withError=!0,this.acks[t]=o}emitWithAck(t,...r){return new Promise((n,i)=>{const s=(o,a)=>o?i(o):n(a);s.withError=!0,r.push(s),this.emit(t,...r)})}_addToQueue(t){let r;typeof t[t.length-1]=="function"&&(r=t.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((i,...s)=>n!==this._queue[0]?void 0:(i!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),r&&r(i)):(this._queue.shift(),r&&r(null,...s)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const r=this._queue[0];r.pending&&!t||(r.pending=!0,r.tryCount++,this.flags=r.flags,this.emit.apply(this,r.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:vr.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,r){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,r),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(n=>String(n.id)===t)){const n=this.acks[t];delete this.acks[t],n.withError&&n.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case vr.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case vr.EVENT:case vr.BINARY_EVENT:this.onevent(t);break;case vr.ACK:case vr.BINARY_ACK:this.onack(t);break;case vr.DISCONNECT:this.ondisconnect();break;case vr.CONNECT_ERROR:this.destroy();const n=new Error(t.data.message);n.data=t.data.data,this.emitReserved("connect_error",n);break}}onevent(t){const r=t.data||[];t.id!=null&&r.push(this.ack(t.id)),this.connected?this.emitEvent(r):this.receiveBuffer.push(Object.freeze(r))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const r=this._anyListeners.slice();for(const n of r)n.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const r=this;let n=!1;return function(...i){n||(n=!0,r.packet({type:vr.ACK,id:t,data:i}))}}onack(t){const r=this.acks[t.id];typeof r=="function"&&(delete this.acks[t.id],r.withError&&t.data.unshift(null),r.apply(this,t.data))}onconnect(t,r){this.id=t,this.recovered=r&&this._pid===r,this._pid=r,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:vr.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const r=this._anyListeners;for(let n=0;n<r.length;n++)if(t===r[n])return r.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const r=this._anyOutgoingListeners;for(let n=0;n<r.length;n++)if(t===r[n])return r.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const r=this._anyOutgoingListeners.slice();for(const n of r)n.apply(this,t.data)}}}function x0(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}x0.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=Math.floor(t*10)&1?e+r:e-r}return Math.min(e,this.max)|0};x0.prototype.reset=function(){this.attempts=0};x0.prototype.setMin=function(e){this.ms=e};x0.prototype.setMax=function(e){this.max=e};x0.prototype.setJitter=function(e){this.jitter=e};class MN extends ri{constructor(t,r){var n;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(r=t,t=void 0),r=r||{},r.path=r.path||"/socket.io",this.opts=r,vT(this,r),this.reconnection(r.reconnection!==!1),this.reconnectionAttempts(r.reconnectionAttempts||1/0),this.reconnectionDelay(r.reconnectionDelay||1e3),this.reconnectionDelayMax(r.reconnectionDelayMax||5e3),this.randomizationFactor((n=r.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new x0({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(r.timeout==null?2e4:r.timeout),this._readyState="closed",this.uri=t;const i=r.parser||I6e;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=r.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var r;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(r=this.backoff)===null||r===void 0||r.setMin(t),this)}randomizationFactor(t){var r;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(r=this.backoff)===null||r===void 0||r.setJitter(t),this)}reconnectionDelayMax(t){var r;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(r=this.backoff)===null||r===void 0||r.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new g6e(this.uri,this.opts);const r=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const i=ic(r,"open",function(){n.onopen(),t&&t()}),s=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),t?t(a):this.maybeReconnectOnOpen()},o=ic(r,"error",s);if(this._timeout!==!1){const a=this._timeout,c=this.setTimeoutFn(()=>{i(),s(new Error("timeout")),r.close()},a);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(i),this.subs.push(o),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(ic(t,"ping",this.onping.bind(this)),ic(t,"data",this.ondata.bind(this)),ic(t,"error",this.onerror.bind(this)),ic(t,"close",this.onclose.bind(this)),ic(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(r){this.onclose("parse error",r)}}ondecoded(t){ET(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,r){let n=this.nsps[t];return n?this._autoConnect&&!n.active&&n.connect():(n=new cQ(this,t,r),this.nsps[t]=n),n}_destroy(t){const r=Object.keys(this.nsps);for(const n of r)if(this.nsps[n].active)return;this._close()}_packet(t){const r=this.encoder.encode(t);for(let n=0;n<r.length;n++)this.engine.write(r[n],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,r){var n;this.cleanup(),(n=this.engine)===null||n===void 0||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,r),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const r=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(i=>{i?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",i)):t.onreconnect()}))},r);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const Sg={};function Yb(e,t){typeof e=="object"&&(t=e,e=void 0),t=t||{};const r=_6e(e,t.path||"/socket.io"),n=r.source,i=r.id,s=r.path,o=Sg[i]&&s in Sg[i].nsps,a=t.forceNew||t["force new connection"]||t.multiplex===!1||o;let c;return a?c=new MN(n,t):(Sg[i]||(Sg[i]=new MN(n,t)),c=Sg[i]),r.query&&!t.query&&(t.query=r.queryKey),c.socket(r.path,t)}Object.assign(Yb,{Manager:MN,Socket:cQ,io:Yb,connect:Yb});const kB=Yb("http://localhost:5000");function N6e(){me.useState("");const e=Ho(),t=Qm(),r=new URLSearchParams(t.search).get("bondId"),[n,i]=me.useState(0),[s,o]=me.useState(0),[a,c]=me.useState(0),d=me.useRef(null);return me.useEffect(()=>{const l="ec25ce97bff34518acf16768af88b377";let u=sessionStorage.getItem("uid");u||(u=String(Math.floor(Math.random()*1e4)),sessionStorage.setItem("uid",u));let h=null,p;const _=window.location.search;console.log("Heyyy",_),new URLSearchParams(_).get("room");let E=[],b={};const v=document.getElementById("stream__box");if(console.log("Hello",v),!v){console.error("Element with id 'stream__box' not found.");return}const I=document.getElementsByClassName("encapsulator");let N=null;const L=m=>{let S=v.children[0];S&&document.getElementById("streams__container").appendChild(S),v.style.display="block",v.appendChild(m.currentTarget),N=m.currentTarget.id;for(let T=0;T<I.length;T++)I[T].id!==N&&(I[T].style.height="50px",I[T].style.width="50px")};let U=async()=>{E=await $r.createMicrophoneAndCameraTracks({},{encoderConfig:{width:{min:640,ideal:1920,max:1920},height:{min:480,ideal:1080,max:1080}}});let m=`<div class="encapsulator">
                        <div class="video__container" id="user-container-${u}">
                            <div class="video-player" id="user-${u}"><div>
                        </div>
                        <p>${u}</p>
                    </div>`;console.log("ZXSello",u),document.getElementById("streams__container").insertAdjacentHTML("beforeend",m),document.getElementById(`user-container-${u}`).addEventListener("click",L),E[1].play(`user-${u}`),await p.publish([E[0],E[1]])},w=async(m,S)=>{b[m.uid]=m,await p.subscribe(m,S);let T=document.getElementById(`user-container-${m.uid}`);if(T===null&&(T=`<div class="video__container" id="user-container-${m.uid}">
                        <div class="video-player" id="user-${m.uid}"><div>
                    </div>`,document.getElementById("streams__container").insertAdjacentHTML("beforeend",T),document.getElementById(`user-container-${m.uid}`).addEventListener("click",L)),v.style.display){let x=document.getElementById(`user-container-${m.uid}`);x.style.height="50px",x.style.width="50px"}S==="video"&&m.videoTrack.play(`user-${m.uid}`),S==="audio"&&m.audioTrack.play(`user-${m.uid}`)},V=async m=>{delete b[m.uid];let S=document.getElementById(`user-container-${m.uid}`);if(S&&S.remove(),N===`user-container-${m.uid}`){v.style.display=null;let T=document.getElementsByClassName("encapsulator");for(let x=0;T.length>x;x++)T[x].style.height="50px",T[x].style.width="50px"}},z=async()=>{p=$r.createClient({mode:"rtc",codec:"vp8"}),await p.join(l,r,h,u),p.on("user-published",w),p.on("user-left",V),U()},K=async m=>{let S=m.currentTarget;E[0].muted?(await E[0].setMuted(!1),S.classList.add("active")):(await E[0].setMuted(!0),S.classList.remove("active"))},H=async m=>{let S=m.currentTarget;E[1].muted?(await E[1].setMuted(!1),S.classList.add("active")):(await E[1].setMuted(!0),S.classList.remove("active"))},A=async m=>{e("/home");for(let S=0;E.length>S;S++)E[S].stop(),E[S].close();if(await p.unpublish([E[0],E[1]]),document.getElementById(`user-container-${u}`).remove(),N===`user-container-${u}`){v.style.display=null;for(let S=0;I.length>S;S++)I[S].style.height="50px",I[S].style.width="50px"}};document.getElementById("camera-btn").addEventListener("click",H),document.getElementById("mic-btn").addEventListener("click",K),document.getElementById("leave-btn").addEventListener("click",A),z();for(let m=0;I.length>m;m++)I[m].addEventListener("click",L)},[]),me.useEffect(()=>(kB.on("musicStatus",({loopCount:l,timeInCurrentLoop:u})=>{i(l),o(u),d.current&&a>0&&(d.current.currentTime=u/1e3,d.current.paused&&d.current.play())}),()=>{kB.off("musicStatus")}),[a]),O.jsx(O.Fragment,{children:O.jsxs("div",{style:{color:"white",height:"610px",width:"100%",marginTop:12,float:"left"},children:[O.jsxs("div",{id:"nav",children:[O.jsx("button",{id:"camera-btn",class:"active",children:O.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",children:O.jsx("path",{d:"M5 4h-3v-1h3v1zm10.93 0l.812 1.219c.743 1.115 1.987 1.781 3.328 1.781h1.93v13h-20v-13h3.93c1.341 0 2.585-.666 3.328-1.781l.812-1.219h5.86zm1.07-2h-8l-1.406 2.109c-.371.557-.995.891-1.664.891h-5.93v17h24v-17h-3.93c-.669 0-1.293-.334-1.664-.891l-1.406-2.109zm-11 8c0-.552-.447-1-1-1s-1 .448-1 1 .447 1 1 1 1-.448 1-1zm7 0c1.654 0 3 1.346 3 3s-1.346 3-3 3-3-1.346-3-3 1.346-3 3-3zm0-2c-2.761 0-5 2.239-5 5s2.239 5 5 5 5-2.239 5-5-2.239-5-5-5z"})})}),O.jsx("button",{id:"mic-btn",class:"active",children:O.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",children:O.jsx("path",{d:"M12 2c1.103 0 2 .897 2 2v7c0 1.103-.897 2-2 2s-2-.897-2-2v-7c0-1.103.897-2 2-2zm0-2c-2.209 0-4 1.791-4 4v7c0 2.209 1.791 4 4 4s4-1.791 4-4v-7c0-2.209-1.791-4-4-4zm8 9v2c0 4.418-3.582 8-8 8s-8-3.582-8-8v-2h2v2c0 3.309 2.691 6 6 6s6-2.691 6-6v-2h2zm-7 13v-2h-2v2h-4v2h10v-2h-4z"})})})]}),O.jsxs("div",{style:{display:"flex",marginTop:1},children:[O.jsx(tr,{to:"/home",id:"leave-btn",style:{textDecoration:"none"},children:O.jsx("p",{style:{width:"17%",whiteSpace:"nowrap"},children:" Back"})}),O.jsxs("p",{style:{width:"100%",fontSize:12,lineHeight:2,marginRight:40},children:["You've pulsed ",n,"/20 times, 15 more to go!",O.jsx("br",{}),O.jsx("marquee",{children:O.jsx("b",{children:"TOMI OBANURE - FLATLINE"})})]})]}),O.jsx("div",{children:O.jsx("div",{className:"activeDateFrame",style:{width:"90%",height:410,border:"3px solid yellow",borderRadius:14},children:O.jsx("main",{class:"container",children:O.jsx("div",{id:"room__container",children:O.jsxs("section",{id:"stream__container",children:[O.jsx("div",{id:"stream__box"}),O.jsxs("div",{id:"streams__container",children:[O.jsxs("div",{class:"encapsulator",children:[O.jsx("div",{class:"video__container",id:"user-container-1",children:O.jsx("img",{src:VG,className:"date-profile-icons"})}),O.jsx("p",{style:{fontSize:12},children:"Ojims"})]}),O.jsxs("div",{class:"encapsulator",children:[O.jsx("div",{class:"video__container",id:"user-container-1",children:O.jsx("img",{src:$G,className:"date-profile-icons"})}),O.jsx("p",{style:{fontSize:12},children:"Bluesea_ASBM"})]})]})]})})})})})]})})}function D6e(){return O.jsx(O.Fragment,{children:O.jsxs("center",{children:[O.jsx("div",{class:"activeDate",style:{display:"flex",justifyContent:"flex-end",width:"50%",minWidth:300,height:"100%",borderRadius:40},children:O.jsx(N6e,{})}),O.jsx(mi,{})]})})}const P6e="/assets/cruel-MCNbqR3U.mp3";function k6e(){return O.jsx(O.Fragment,{children:O.jsxs("div",{style:{color:"white",width:"80%",marginTop:12,float:"left"},children:[O.jsxs("div",{style:{display:"flex",marginTop:20},children:[O.jsx(tr,{to:"/home",style:{textDecoration:"none"},children:O.jsx("p",{style:{width:"17%",whiteSpace:"nowrap"},children:" Back"})}),O.jsxs("p",{style:{width:"90%",fontSize:12,lineHeight:2},children:["Created by ",O.jsx("b",{children:"Ojiims"}),O.jsx("br",{}),O.jsx("marquee",{children:O.jsx("b",{children:"TYLER TURNER, GENIO BAMBINO, CRUEL SANTINO - MATILDA"})})]})]}),O.jsx("div",{style:{overflowX:"auto"},children:O.jsx("div",{className:"activeDateFrame",style:{width:530,height:474,border:"3px solid yellow",borderRadius:14},children:O.jsxs("div",{className:"video-container",children:[O.jsx("video",{autoplay:"autoplay",loop:!0,height:"480",width:"500",src:e1e,muted:!0}),O.jsx("audio",{autoplay:"autoplay",loop:!0,src:P6e}),O.jsxs("div",{className:"image-container",children:[O.jsxs("div",{title:"click to move profile to enlarged pane",className:"date-profile-container",children:[O.jsx("img",{src:WD,style:{borderRadius:60,border:"5px solid #ff008c"},className:"date-profile-icons"}),O.jsx("p",{style:{fontSize:12},children:"Me"})]}),O.jsxs("div",{title:"click to move profile to enlarged pane",className:"date-profile-container",children:[O.jsx("img",{src:Zbe,style:{borderRadius:60,border:"5px solid #ff008c"},className:"date-profile-icons"}),O.jsx("p",{style:{fontSize:12},children:"Nduk3"})]}),O.jsxs("div",{title:"click to move profile to enlarged pane",className:"date-profile-container",children:[O.jsx("img",{src:VG,style:{borderRadius:60,border:"5px solid rgb(119, 63, 248)"},className:"date-profile-icons"}),O.jsx("p",{style:{fontSize:12},children:"Ojiims"})]}),O.jsxs("div",{title:"click to move profile to enlarged pane",className:"date-profile-container",children:[O.jsx("img",{src:$G,style:{borderRadius:60,border:"5px solid #ff008c"},className:"date-profile-icons"}),O.jsx("p",{style:{fontSize:12},children:"Bluesea"})]})]})]})})})]})})}function L6e(){return O.jsx(O.Fragment,{children:O.jsxs("center",{children:[O.jsxs("div",{class:"activeDate",style:{display:"flex",justifyContent:"flex-end",width:"50%",minWidth:300,height:"100%",borderRadius:40},children:[O.jsx(k6e,{}),O.jsx(mo,{})]}),O.jsx(mi,{})]})})}function x6e(e){return O.jsx(O.Fragment,{children:O.jsx(tr,{to:"/formabonditem",style:{textDecoration:"none"},children:O.jsxs("div",{className:"formAbond-element",style:{lineHeight:.9,borderRadius:12,color:"black",cursor:"pointer"},children:[O.jsx("img",{src:e.songPic,className:"formABondImage"}),O.jsxs("div",{className:"formABondImageContent",children:[O.jsxs("div",{style:{display:"flex",justifyContent:"end"},children:[O.jsx("p",{style:{fontSize:14,paddingRight:4,color:"white"},children:O.jsx("b",{children:e.timeStarting})}),O.jsx(tr,{to:"/profile",style:{textDecoration:"none"},children:O.jsx("img",{src:e.ownerPic,style:{borderRadius:19,border:"2px solid limegreen",width:38,height:38,marginTop:16,marginRight:12}})})]}),O.jsxs("p",{style:{fontSize:14,color:"white"},children:[e.artistName,": ",O.jsx("br",{}),O.jsx("b",{children:e.songTitle})]})]})]})})})}function M6e(e){const t=Ho(),r=()=>{localStorage.removeItem("token"),t("/login")};return O.jsxs(O.Fragment,{children:[O.jsx("div",{style:{lineHeight:.7},children:O.jsx("button",{onClick:r,style:{fontSize:16},children:"Logout"})}),O.jsxs("div",{style:{lineHeight:.1,paddingTop:19},children:[O.jsx("p",{style:{fontSize:16},children:"Username:"}),O.jsx("span",{style:{fontSize:12,padding:6,border:"1px solid yellow"},children:e.username})]}),O.jsxs("div",{style:{lineHeight:.1,paddingTop:19},children:[O.jsx("p",{style:{fontSize:16},children:"Bio:"}),O.jsx("span",{style:{fontSize:12,padding:6,border:"1px solid yellow"},children:e.bio})]})]})}function U6e(){const[e,t]=me.useState(""),r=Ho(),[n,i]=me.useState(null),[s,o]=me.useState(null),[a,c]=me.useState(!1);me.useEffect(()=>{const g=localStorage.getItem("token");if(g)try{const E=t0(g);t(E.userId)}catch{console.error("Invalid token")}else r("/home")},[r]);const d=localStorage.getItem("token"),l=async()=>{try{const g=await xr.get(`http://localhost:5000/profile-photo/${e}`,{responseType:"blob"});i(URL.createObjectURL(g.data))}catch(g){console.error("Error fetching profile photo:",g)}},u=g=>{o(g.target.files[0])},h=async()=>{if(!s)return;c(!0);const g=new FormData;g.append("profilePhoto",s);try{await xr.post(`http://localhost:5000/upload-profile-photo/${e}`,g,{headers:{Authorization:`Bearer ${d}`,"Content-Type":"multipart/form-data"}}),alert("Profile photo uploaded successfully!"),l()}catch(E){console.error("Upload error:",E),alert("Failed to upload profile photo.")}finally{c(!1)}};me.useEffect(()=>{l()},[e]);const p=TO.map(g=>O.jsx(x6e,{songPic:g.dates[0].songPic,ownerPic:g.dates[0].ownerPic,timeStarting:g.dates[0].timeStarting,artistName:g.dates[0].artistName,songTitle:g.dates[0].songTitle})),_=TO.map(g=>O.jsx(M6e,{username:g.username,bio:g.bio}));return O.jsx(O.Fragment,{children:O.jsxs("div",{style:{color:"white",width:"80%",marginTop:0,float:"left"},children:[O.jsxs("div",{style:{display:"flex",marginTop:20},children:[O.jsx(tr,{to:"/home",style:{textDecoration:"none"},children:O.jsx("p",{style:{width:"17%",whiteSpace:"nowrap"},children:" Back"})}),O.jsx("div",{style:{width:"80%",marginTop:16},children:O.jsxs("div",{children:[n?O.jsx("img",{src:n,alt:"Profile",style:{width:"60px",height:"60px",borderRadius:"50%"}}):O.jsx("img",{src:FH,alt:"Profile",style:{width:"60px",height:"60px",borderRadius:"50%"}}),O.jsx("br",{}),O.jsx("input",{type:"file",onChange:u}),O.jsx("button",{style:{fontSize:16},onClick:h,disabled:a,children:a?"Uploading...":"Change Profile Photo"})]})})]}),_,O.jsx("p",{style:{fontSize:16,paddingTop:19},children:"My Dates"}),O.jsx("div",{style:{overflowY:"auto",display:"flow",height:120},children:O.jsx("div",{className:"formABond-Item-Container",children:p})})]})})}function j6e(){return O.jsx(O.Fragment,{children:O.jsx("div",{children:O.jsxs("center",{children:[O.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",width:"50%",minWidth:300,height:"100%",backgroundColor:"rgb(119, 63, 248)",borderRadius:40},children:[O.jsx(U6e,{}),O.jsx(mo,{})]}),O.jsx(mi,{})]})})})}function F6e(){const e=UH.map(t=>O.jsx(BG,{bgImg:t.bgImg,profileImg:t.profileImg,artistName:t.artistName,songTitle:t.songTitle,username:t.username}));return O.jsx(O.Fragment,{children:O.jsxs("div",{style:{color:"white",width:"80%",marginTop:0,float:"left"},children:[O.jsxs("div",{style:{display:"flex",marginTop:20},children:[O.jsx(tr,{to:"/home",style:{textDecoration:"none"},children:O.jsx("p",{style:{width:"17%",whiteSpace:"nowrap"},children:" Back"})}),O.jsx("div",{style:{width:"80%",marginTop:2},children:O.jsx("p",{children:O.jsx("b",{children:"Search Bonds"})})})]}),O.jsx("div",{style:{overflowY:"auto",lineHeight:.1,paddingTop:36,paddingBottom:30},children:O.jsx("input",{type:"text",placeholder:"search with name of song or name of artist or bonds username",style:{width:350,height:20,fontSize:12,padding:6,border:"1px solid yellow"}})}),O.jsx("div",{style:{overflowY:"auto",display:"flow",height:400},children:O.jsx("div",{className:"formABond-Item-Container",children:e})})]})})}function B6e(){return O.jsx(O.Fragment,{children:O.jsx("div",{children:O.jsxs("center",{children:[O.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",width:"50%",minWidth:300,height:"100%",backgroundColor:"rgb(119, 63, 248)",borderRadius:40},children:[O.jsx(F6e,{}),O.jsx(mo,{})]}),O.jsx(mi,{})]})})})}const V6e="/assets/finesse-C-iUsg_u.mp3",$6e="/assets/confettii-C9F3LJ33.gif";function H6e(){const[e,t]=me.useState("");me.useState(`tx-${Date.now()}`),Ho();const[r,n]=me.useState(""),[i,s]=me.useState(""),[o,a]=me.useState(""),[c,d]=me.useState(""),[l,u]=me.useState(""),[h,p]=me.useState(""),[_,g]=me.useState(""),[E,b]=me.useState(""),[v,I]=me.useState(!1),[N,L]=me.useState(!1),[U,w]=me.useState(""),[V,z]=me.useState(!1),K=100,H=async f=>{f.preventDefault();const R={card_number:r,cvv:i,email:e,expiry_month:o,expiry_year:c,currency:"NGN",amount:K,fullname:l,phone_number:h,tx_ref:`MC-${Date.now()}`};try{z(!0);const B=await axios.post("http://localhost:5000/pay",R);console.log(B.data),B.data.meta.authorization.mode==="pin"?I(!0):B.data.meta.authorization.mode==="redirect"&&(window.location.href=B.data.meta.authorization.redirect)}catch(B){console.error("Payment Error:",B)}finally{z(!1)}},A=async f=>{f.preventDefault();const R={card_number:r,cvv:i,email:e,expiry_month:o,expiry_year:c,currency:"NGN",amount:K,fullname:l,phone_number:h,tx_ref:`MC-${Date.now()}`,pin:_};try{const B=await axios.post("http://localhost:5000/pay/pin",R);console.log(B.data),B.data.message==="OTP required"?(L(!0),b(B.data.flw_ref)):alert("Payment Successful!")}catch(B){console.error("Error Submitting PIN:",B)}},m=async f=>{f.preventDefault();const R={otp:U,flw_ref:E};try{const B=await axios.post("http://localhost:5000/validate-otp",R);console.log(B.data),B.data.status==="success"&&alert("Payment Successful!")}catch(B){console.error("OTP Submission Error:",B)}},S={maxWidth:"400px",margin:"0 auto",padding:"20px",backgroundImage:`url(${$6e})`,borderRadius:"8px",boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.1)",fontFamily:'"Helvetica Neue", Helvetica, Arial, sans-serif'},T={marginBottom:"20px"},x={display:"block",marginBottom:"5px",fontWeight:"600",fontSize:"14px",color:"#333"},D={width:"100%",padding:"12px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"16px",boxSizing:"border-box"},k={width:"100%",padding:"12px",backgroundColor:"#007bff",color:"#fff",border:"none",borderRadius:"4px",fontSize:"16px",fontWeight:"600",cursor:"pointer",marginTop:"20px"},P={...k,backgroundColor:"#cccccc",cursor:"not-allowed"},y={textAlign:"center",marginBottom:"20px",fontWeight:"600",color:"#333"};return{...D},O.jsx(O.Fragment,{children:O.jsxs("div",{style:{color:"white",width:"80%",marginTop:0,float:"left"},children:[O.jsxs("div",{style:{display:"flex",marginTop:20},children:[O.jsx(tr,{to:"/formabond",style:{textDecoration:"none"},children:O.jsx("p",{style:{width:"17%",whiteSpace:"nowrap"},children:" Back"})}),O.jsx("p",{style:{width:"80%"},children:O.jsx("b",{children:"Form a Bond"})})]}),O.jsx("div",{className:"formABond-Bg-Image",style:{height:147,lineHeight:1,width:147,borderRadius:12},children:O.jsxs("div",{style:{display:"flex",justifyContent:"end"},children:[O.jsx("p",{style:{fontSize:14,marginTop:22,paddingRight:4,color:"white"},children:O.jsx("b",{children:"thevictorjimmy"})}),O.jsx(tr,{to:"/profile",style:{textDecoration:"none"},children:O.jsx("img",{src:sw,style:{display:"block",borderRadius:19,width:30,height:30,marginTop:16,marginRight:12}})})]})}),O.jsx("div",{style:{width:"100%"},children:O.jsx("p",{style:{fontSize:15},children:O.jsx("b",{children:"Odunsi (The Engine) : No PDA!"})})}),O.jsx("audio",{loop:!0,src:V6e,controls:!0,style:{height:20,width:200}}),O.jsx("br",{}),O.jsx("div",{style:{marginTop:20,marginLeft:15,marginRight:15,whiteSpace:"wrap",overflowY:"auto",height:235},children:O.jsxs("div",{style:S,children:[O.jsx("h2",{style:y,children:"Form a Bond"}),!v&&!N&&O.jsxs("form",{onSubmit:H,children:[O.jsxs("div",{style:T,children:[O.jsx("label",{style:x,htmlFor:"fullname",children:"Full Name"}),O.jsx("input",{style:D,type:"text",id:"fullname",placeholder:"Full Name",value:l,onChange:f=>u(f.target.value),required:!0})]}),O.jsxs("div",{style:T,children:[O.jsx("label",{style:x,htmlFor:"cardNumber",children:"Card Number"}),O.jsx("input",{style:D,type:"text",id:"cardNumber",placeholder:"1234 1234 1234 1234",value:r,onChange:f=>n(f.target.value),required:!0})]}),O.jsxs("div",{style:T,children:[O.jsx("label",{style:x,htmlFor:"expiryMonth",children:"Expiry Month"}),O.jsx("input",{style:D,type:"text",id:"expiryMonth",placeholder:"MM",value:o,onChange:f=>a(f.target.value),required:!0})]}),O.jsxs("div",{style:T,children:[O.jsx("label",{style:x,htmlFor:"expiryYear",children:"Expiry Year"}),O.jsx("input",{style:D,type:"text",id:"expiryYear",placeholder:"YY",value:c,onChange:f=>d(f.target.value),required:!0})]}),O.jsxs("div",{style:T,children:[O.jsx("label",{style:x,htmlFor:"cvv",children:"CVV"}),O.jsx("input",{style:D,type:"text",id:"cvv",placeholder:"123",value:i,onChange:f=>s(f.target.value),required:!0})]}),O.jsxs("div",{style:T,children:[O.jsx("label",{style:x,htmlFor:"amount",children:"Amount"}),O.jsxs("p",{style:{color:"black"},children:["NGN ",K]})]}),O.jsxs("div",{style:T,children:[O.jsx("label",{style:x,htmlFor:"phoneNumber",children:"Phone Number"}),O.jsx("input",{style:D,type:"text",id:"phoneNumber",placeholder:"Phone Number",value:h,onChange:f=>p(f.target.value),required:!0})]}),O.jsx("button",{type:"submit",style:V?P:k,disabled:V,children:V?"Processing...":"Form Bond"})]}),v&&!N&&O.jsxs("form",{onSubmit:A,children:[O.jsx("h2",{style:y,children:"Enter Your PIN"}),O.jsx("div",{style:T,children:O.jsx("input",{style:D,type:"password",placeholder:"Enter PIN",value:_,onChange:f=>g(f.target.value),required:!0})}),O.jsx("button",{type:"submit",style:k,children:"Submit PIN"})]}),N&&O.jsxs("form",{onSubmit:m,children:[O.jsx("h2",{style:y,children:"Enter OTP"}),O.jsx("div",{style:T,children:O.jsx("input",{style:D,type:"text",placeholder:"Enter OTP",value:U,onChange:f=>w(f.target.value),required:!0})}),O.jsx("button",{type:"submit",style:k,children:"Submit OTP"})]})]})})]})})}function z6e(){return O.jsx(O.Fragment,{children:O.jsx("div",{children:O.jsxs("center",{children:[O.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",width:"50%",minWidth:300,height:"100%",backgroundColor:"rgb(119, 63, 248)",borderRadius:40},children:[O.jsx(H6e,{}),O.jsx(mo,{})]}),O.jsx(mi,{})]})})})}function W6e(e){return O.jsxs(O.Fragment,{children:[O.jsxs("div",{style:{display:"flex",marginTop:20},children:[O.jsx(tr,{to:"/formabond",style:{textDecoration:"none"},children:O.jsx("p",{style:{width:"17%",whiteSpace:"nowrap"},children:" Back"})}),O.jsxs("div",{style:{width:"80%",marginTop:16},children:[O.jsx("p",{style:{fontSize:16},children:O.jsx("b",{children:e.username})}),O.jsx("img",{src:e.profilePhoto,style:{width:60,height:60,borderRadius:30}})]})]}),O.jsxs("div",{style:{lineHeight:.1,paddingTop:19},children:[O.jsx("p",{style:{fontSize:16},children:O.jsx("b",{children:e.location})}),O.jsx("p",{style:{fontSize:16},children:e.bio})]})]})}function G6e(e){return O.jsx(O.Fragment,{children:O.jsx(tr,{to:"/formabonditem",style:{textDecoration:"none"},children:O.jsxs("div",{className:"formAbond-element",style:{lineHeight:.9,borderRadius:12,color:"black",cursor:"pointer"},children:[O.jsx("img",{src:e.songPic,className:"formABondImage"}),O.jsx("div",{className:"formABondImageContent",style:{bottom:28},children:O.jsx("div",{style:{justifyContent:"center"},children:O.jsxs("p",{style:{fontSize:14,color:"white"},children:[e.artistName,": ",O.jsx("br",{}),O.jsx("b",{children:e.songTitle})]})})})]})})})}function q6e(){const[e,t]=me.useState(""),[r,n]=me.useState(!1),[i,s]=me.useState(!1),o=Ho();me.useEffect(()=>{const u=localStorage.getItem("token");if(u)try{const h=t0(u);t(h.username)}catch{console.error("Invalid token")}else o("/home")},[o]);const a=e,c="thevictorjimmy";me.useEffect(()=>{(async()=>{try{const h=await xr.get(`http://localhost:5000/users/${a}/adored/${c}`);n(h.data.adored)}catch(h){console.error("Error fetching adored status",h)}})()},[a,c]);const d=async()=>{s(!0);try{(await xr.patch(`http://localhost:5000/addToAdoredList/${a}`,{targetUser:c})).data.adored.includes(c)?n(!0):n(!1)}catch(u){console.error("Error updating adore list",u)}finally{s(!1)}},l=TO.map(u=>u.dates.map(h=>O.jsx(G6e,{songPic:h.songPic,ownerPic:h.ownerPic,timeStarting:h.timeStarting,artistName:h.artistName,songTitle:h.songTitle})));return O.jsx(O.Fragment,{children:O.jsxs("div",{style:{color:"white",width:"80%",marginTop:0,float:"left"},children:[O.jsx(W6e,{username:"thevictorjimmy",profilePhoto:sw,location:"Japan",bio:"Visual and Interaction Designer."}),O.jsx("div",{style:{lineHeight:.1},children:O.jsx("button",{onClick:d,style:{backgroundColor:i?"#ccc":r?"#535455":"#0e8bfd",color:"white",padding:"10px 40px",border:"none",fontSize:"17px",fontWeight:"bold",borderRadius:"12px",cursor:i?"not-allowed":"pointer"},disabled:i,children:i?"Loading...":r?"Adored":"Adore"})}),O.jsxs("p",{style:{fontSize:16,paddingTop:19},children:["Owned Assets ",O.jsx("b",{children:"(6)"})]}),O.jsx("div",{style:{overflowY:"auto",display:"flow",height:205},children:O.jsx("div",{className:"formABond-Item-Container",children:l})})]})})}function K6e(){return O.jsx(O.Fragment,{children:O.jsx("div",{children:O.jsxs("center",{children:[O.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",width:"50%",minWidth:300,height:"100%",backgroundColor:"rgb(119, 63, 248)",borderRadius:40},children:[O.jsx(q6e,{}),O.jsx(mo,{})]}),O.jsx(mi,{})]})})})}function Y6e(){return O.jsx(O.Fragment,{children:O.jsxs("div",{style:{color:"white",width:"80%",marginTop:0,float:"left"},children:[O.jsxs("div",{style:{display:"flex",marginTop:20},children:[O.jsx(tr,{to:"/uploadNFT",style:{textDecoration:"none"},children:O.jsx("p",{style:{width:"17%",whiteSpace:"nowrap"},children:" Back"})}),O.jsx("p",{style:{width:"80%"},children:O.jsx("b",{children:"Upload NFT Finish"})})]}),O.jsx("img",{src:FH,style:{height:147,width:147,borderRadius:12}}),O.jsxs("div",{style:{marginTop:30,whiteSpace:"nowrap"},children:[O.jsx("p",{style:{fontSize:16},children:"Input Name of Producer:"}),O.jsx("input",{style:{color:"white",backgroundColor:"black",width:214,height:7,fontSize:12},placeholder:"Enter Name of Producer",type:"text"}),O.jsx("br",{}),O.jsx("p",{style:{fontSize:16},children:"Exclusivity Agreement:"}),O.jsx("div",{style:{height:80,whiteSpace:"wrap"},children:O.jsx("p",{style:{fontSize:16},children:'By clicking "Upload NFT" you agree that;- This music is available exclusively on the Bonds platform and not anywhere else on the internet. Failure to abide by this will lead to Bonds taking legal action against you.'})})]}),O.jsx("br",{}),O.jsx("button",{style:{whiteSpace:"nowrap",backgroundColor:"white",color:"black",paddingTop:6,paddingBottom:6,paddingLeft:66,paddingRight:66},children:"Upload NFT"})]})})}function J6e(){return O.jsx(O.Fragment,{children:O.jsxs("center",{children:[O.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",width:"50%",minWidth:300,height:"100%",backgroundColor:"rgb(119, 63, 248)",borderRadius:40},children:[O.jsx(Y6e,{}),O.jsx(mo,{})]}),O.jsx(mi,{})]})})}CG("Bonds");function X6e(){const[e,t]=me.useState(""),[r,n]=me.useState(!1),[i,s]=me.useState(),[o,a]=me.useState(null),[c,d]=me.useState(null),[l,u]=me.useState(!1),h=Ho();me.useEffect(()=>{const g=localStorage.getItem("token");if(g)try{const E=t0(g);t(E.username)}catch{console.error("Invalid token")}else h("/home")},[h]);const p=e,_=async()=>{var g,E,b,v;n(!0),s(void 0),u(!1);try{const I=await Dye();a(I),console.log("Session details:",I);const N=(E=(g=I.namespaces)==null?void 0:g.aleo)==null?void 0:E.accounts[0],L=N.substring(7);d(L),console.log("Connected wallet address:",N),(await xr.patch(`http://localhost:5000/updateWalletAddress/${p}`,{walletAddress:c})).status===200&&u(!0)}catch(I){s(((v=(b=I.response)==null?void 0:b.data)==null?void 0:v.message)||I.message)}finally{n(!1)}};return O.jsx(O.Fragment,{children:O.jsxs("div",{style:{color:"white",width:"80%",marginTop:0,float:"left"},children:[O.jsxs("div",{style:{display:"flex",marginTop:20},children:[O.jsx(tr,{to:"/home",style:{textDecoration:"none"},children:O.jsx("p",{style:{width:"17%",whiteSpace:"nowrap"},children:" Back"})}),O.jsx("div",{style:{width:"80%",marginTop:2},children:O.jsx("p",{children:O.jsx("b",{children:"Connect Wallet"})})})]}),O.jsxs("div",{style:{whiteSpace:"wrap",paddingLeft:"20px",paddingRight:"20px",maxWidth:"400px",margin:"0 auto"},children:[O.jsx("button",{onClick:_,disabled:r,style:{padding:"10px",width:"100%"},children:c?"Wallet connected!":"Connect to wallet"}),c&&O.jsxs("div",{children:[O.jsx("p",{style:{whiteSpace:"wrap"},children:"Wallet address:"}),O.jsx("p",{style:{fontSize:18},children:c}),O.jsx("p",{style:{fontSize:12},children:O.jsx("b",{children:"Puzzle wallet has chosen your first account by default"})}),O.jsx("br",{}),O.jsx("p",{style:{fontSize:15},children:O.jsx("b",{children:"Make sure this account has enough PRIVATE balance, unless your transactions won't work"})})]})]})]})})}function Q6e(){return O.jsx(O.Fragment,{children:O.jsxs("center",{children:[O.jsxs("div",{class:"activeDate",style:{display:"flex",justifyContent:"flex-end",width:"50%",minWidth:300,height:"100%",borderRadius:40},children:[O.jsx(X6e,{}),O.jsx(mo,{})]}),O.jsx(mi,{})]})})}const Z6e=()=>{const[e,t]=me.useState(!!localStorage.getItem("token")),r=()=>{t(!0)},n=()=>{localStorage.removeItem("token"),t(!1)};return O.jsx(Kbe,{dAppName:"Bonds",dAppDescription:"Social NFT Msuic Streaming Service",dAppUrl:"http://localhost:5173/",dAppIconURL:"file:///C:/Users/Stephen/Desktop/bonds.live/front-end/src/assets/Bonds_new.png",projectId:"<YOUR WALLETCONNECT PROJECT ID>",children:O.jsx(Gte,{children:O.jsxs(Fte,{children:[O.jsx(Hn,{path:"/forgotpassword",element:O.jsx(Xne,{})}),O.jsx(Hn,{path:"/resetpassword",element:O.jsx(Zne,{})}),O.jsx(Hn,{path:"/signup",element:O.jsx(qne,{})}),O.jsx(Hn,{path:"/login",element:O.jsx(Yne,{onLoginSuccess:r})}),O.jsx(Hn,{path:"/home",element:e?O.jsx(gie,{onLogout:n}):O.jsx(Xi,{to:"/login"})}),O.jsx(Hn,{path:"/options",element:e?O.jsx(wie,{}):O.jsx(Xi,{to:"/login"})}),O.jsx(Hn,{path:"/ownedAsset",element:e?O.jsx(Rie,{}):O.jsx(Xi,{to:"/login"})}),O.jsx(Hn,{path:"/sellNFT",element:e?O.jsx(Cie,{}):O.jsx(Xi,{to:"/login"})}),O.jsx(Hn,{path:"/uploadAsset",element:e?O.jsx(Oie,{}):O.jsx(Xi,{to:"/login"})}),O.jsx(Hn,{path:"/ongoingswap",element:e?O.jsx(Jbe,{}):O.jsx(Xi,{to:"/login"})}),O.jsx(Hn,{path:"/formabond",element:e?O.jsx(Qbe,{}):O.jsx(Xi,{to:"/login"})}),O.jsx(Hn,{path:"/activedate",element:e?O.jsx(D6e,{}):O.jsx(Xi,{to:"/login"})}),O.jsx(Hn,{path:"/bondhighlight",element:e?O.jsx(L6e,{}):O.jsx(Xi,{to:"/login"})}),O.jsx(Hn,{path:"/myprofile",element:e?O.jsx(j6e,{}):O.jsx(Xi,{to:"/login"})}),O.jsx(Hn,{path:"/search",element:e?O.jsx(B6e,{}):O.jsx(Xi,{to:"/login"})}),O.jsx(Hn,{path:"/formabonditem",element:e?O.jsx(z6e,{}):O.jsx(Xi,{to:"/login"})}),O.jsx(Hn,{path:"/profile",element:e?O.jsx(K6e,{}):O.jsx(Xi,{to:"/login"})}),O.jsx(Hn,{path:"/uploadAssetFinish",element:e?O.jsx(J6e,{}):O.jsx(Xi,{to:"/login"})}),O.jsx(Hn,{path:"/connectwallet",element:e?O.jsx(Q6e,{}):O.jsx(Xi,{to:"/login"})}),O.jsx(Hn,{path:"/",element:O.jsx(Xi,{to:e?"/home":"/login"})})]})})})};gO.createRoot(document.getElementById("root")).render(O.jsx(Es.StrictMode,{children:O.jsx(Z6e,{})}));export{Vie as R,BH as T,os as i,ox as n,t5e as o,cc as p,rR as s,e5e as t,Am as y};
